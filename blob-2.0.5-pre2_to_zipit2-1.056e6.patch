Index: build_tree/bootLoader/.cvsignore
diff -u /dev/null build_tree/bootLoader/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,10 @@
+aclocal.m4
+configure
+config.cache
+config.log
+config.status
+Makefile.in
+Makefile
+*.diff
+junk
+autom4te.cache
Index: build_tree/bootLoader/AUTHORS
diff -u build_tree/bootLoader/AUTHORS:1.1.1.1 build_tree/bootLoader/AUTHORS:1.1.1.2
--- build_tree/bootLoader/AUTHORS:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/AUTHORS	Fri Nov  9 09:44:05 2007
@@ -10,70 +10,93 @@
   2600 GA  Delft
   The Netherlands
 
-
 * Clock switching code
 ======================
 - Johan Pouwelse <J.A.Pouwelse@its.tudelft.nl>
 
-
 * Assabet port
 ==============
 - Jeff Sutherland <jsutherland@accelent.com>
 - Chester <chester@linux.org.tw>
 
-
 * PLEB port
 ===========
 - Adam Wiggins <awiggins@cse.unsw.edu.au>
 
-
 * Brutus port
 =============
 - Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 
-
 * NESA port
 ===========
 - Russ Dill <Russ.Dill@asu.edu>
 
-
 * Shannon (aka TuxScreen) port
 ==============================
 - Tim Riker <Tim@Rikers.org>, <TimR@Debian.org>, <Tim@Lineo.com>
 
-
-* Various fixes
-===============
+* Various fixes and additions
+=============================
 - Mark Huang <mhuang@livetoy.com>, RTC fix
 - Justin M. Seger <justin.m.seger@intel.com>, Assabet fixes
 - Wookey <wookey@aleph1.co.uk>, run-from-RAM
-
+- Christopher Hoover <ch@hpl.hp.com> intel{16,32} flash re-write, xmodem,
+  md5, i2c
 
 * PT system 3 port
 ==================
-- Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+- Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
 
+* RMK's TFTP code ported to BLOB, SMC91c96 Ethernet support
+===========================================================
+- Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
 
 * Memory tester
 ===============
-- Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
-
+- Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
 
 * Ipaq H3600 port
 =================
 - Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 
-
 * Vercel UD-1 port
 ==================
 - Tim Riker <Tim@Rikers.org>, <TimR@Debian.org>, <Tim@Lineo.com>
 
-
 * Jornada 720 port
 ==================
 - Christopher Hoover <ch@hpl.hp.com>
 
-
 * Badge4
 ========
 - Christopher Hoover <ch@hpl.hp.com>
+
+* Frodo port
+============
+- Abraham vd Merwe <abz@4dllc.com>
+
+* Accelent IDP port
+===================
+- Holger Schurig <h.schurig@mn-logistik.de>
+
+* FGAG miniprint port
+=====================
+- Urs Kaufmann <u_kaufmann@bluewin.ch>
+
+* Accelent PXA IDP port
+=======================
+- Jeff Sutherland <jeffs@accelent.com>
+
+* Intel Lubbock port, PXA processor support
+===========================================
+- Russell Geldmacher <russell.r.geldmacher@intel.com>
+- Yu Tang <yu.tang@intel.com>
+
+* Iskratel CEP port
+===================
+- Matej Sekoranja <matej.sekoranja@cosylab.com>
+
+* CSIR IMS port, PXA processor support
+======================================
+- Abraham vd Merwe <abz@4dllc.com>
+
Index: build_tree/bootLoader/ChangeLog
diff -u build_tree/bootLoader/ChangeLog:1.1.1.1 build_tree/bootLoader/ChangeLog:1.1.1.2
--- build_tree/bootLoader/ChangeLog:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/ChangeLog	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,37 @@
 (If somebody can show me how to update the ChangeLog from CVS, I'd be
 more than grateful -- Erik)
 
-$Id: ChangeLog,v 1.14 2002/01/06 19:03:36 erikm Exp $
+(maybe with "rcs2log >Changelog; cvs commit ChangeLog" -- Holger)
+
+$Id: ChangeLog,v 1.26 2003/08/15 06:21:44 holgerschurig Exp $
+
+(NOTE: Please add new entries at the top, not at the bottom)
+
+
+- Ramses support					Holger Schurig
+- using new autoconf/automake				Holger Schurig
+- made it fully PXA compatible				Abraham van der Merwe
+- CSIR IMS support					Abraham van der Merwe
+- dafit support						Stefan Eletzhofer
+- PCMCIA, CF, IDE and GENERIC_IO support added to	Stefan Eletzhofer
+  automake/autoconf & some other cleanup as well
+- smc91xxx driver					Stefan Eletzhofer
+- bootp/tftp code					Stefan Eletzhofer
+
+blob-2.0.5-pre3:
+- Added printf() from linux-2.4.17-rmk3			Erik Mouw
+- Made external, bank 2/3 memory references
+  optional for SA-1110 platforms			Abraham van der Merwe
+- Added a dontdiff file for blob			Abraham van der Merwe
+- Change license for src/blob/testmem*.S from
+  GPLv2+later to GPLv2 only. My fault, I should have
+  asked	Russell.					Erik Mouw
+- Changed UU Codec support to be optional		Abraham van der Merwe
+- Accelent IDP support					Holger Schurig
+- Added a script to automate uploading of images	Abraham van der Merwe
+- Changed Xmodem support to be optional			Abraham van der Merwe
+- 2d3D SA-1110 Dev Board support			Abraham van der Merwe
+- First stage loader modularisation			Erik Mouw
 
 blob-2.0.5-pre2:
 - MD5 support						Christopher Hoover
Index: build_tree/bootLoader/INSTALL
diff -u build_tree/bootLoader/INSTALL:1.1.1.1 build_tree/bootLoader/INSTALL:1.1.1.2
--- build_tree/bootLoader/INSTALL:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/INSTALL	Fri Nov  9 10:37:08 2007
@@ -1,3 +1,9 @@
+Copyright (C) 1994, 1995, 1996, 1999, 2000, 2001, 2002 Free Software
+Foundation, Inc.
+
+   This file is free documentation; the Free Software Foundation gives
+unlimited permission to copy, distribute and modify it.
+
 Basic Installation
 ==================
 
@@ -8,20 +14,27 @@
 those values to create a `Makefile' in each directory of the package.
 It may also create one or more `.h' files containing system-dependent
 definitions.  Finally, it creates a shell script `config.status' that
-you can run in the future to recreate the current configuration, a file
-`config.cache' that saves the results of its tests to speed up
-reconfiguring, and a file `config.log' containing compiler output
-(useful mainly for debugging `configure').
+you can run in the future to recreate the current configuration, and a
+file `config.log' containing compiler output (useful mainly for
+debugging `configure').
+
+   It can also use an optional file (typically called `config.cache'
+and enabled with `--cache-file=config.cache' or simply `-C') that saves
+the results of its tests to speed up reconfiguring.  (Caching is
+disabled by default to prevent problems with accidental use of stale
+cache files.)
 
    If you need to do unusual things to compile the package, please try
 to figure out how `configure' could check whether to do them, and mail
 diffs or instructions to the address given in the `README' so they can
-be considered for the next release.  If at some point `config.cache'
-contains results you don't want to keep, you may remove or edit it.
-
-   The file `configure.in' is used to create `configure' by a program
-called `autoconf'.  You only need `configure.in' if you want to change
-it or regenerate `configure' using a newer version of `autoconf'.
+be considered for the next release.  If you are using the cache, and at
+some point `config.cache' contains results you don't want to keep, you
+may remove or edit it.
+
+   The file `configure.ac' (or `configure.in') is used to create
+`configure' by a program called `autoconf'.  You only need
+`configure.ac' if you want to change it or regenerate `configure' using
+a newer version of `autoconf'.
 
 The simplest way to compile this package is:
 
@@ -55,14 +68,16 @@
 =====================
 
    Some systems require unusual options for compilation or linking that
-the `configure' script does not know about.  You can give `configure'
-initial values for variables by setting them in the environment.  Using
-a Bourne-compatible shell, you can do that on the command line like
-this:
-     CC=c89 CFLAGS=-O2 LIBS=-lposix ./configure
+the `configure' script does not know about.  Run `./configure --help'
+for details on some of the pertinent environment variables.
 
-Or on systems that have the `env' program, you can do it like this:
-     env CPPFLAGS=-I/usr/local/include LDFLAGS=-s ./configure
+   You can give `configure' initial values for configuration parameters
+by setting variables in the command line or in the environment.  Here
+is an example:
+
+     ./configure CC=c89 CFLAGS=-O2 LIBS=-lposix
+
+   *Note Defining Variables::, for more details.
 
 Compiling For Multiple Architectures
 ====================================
@@ -75,11 +90,11 @@
 the `configure' script.  `configure' automatically checks for the
 source code in the directory that `configure' is in and in `..'.
 
-   If you have to use a `make' that does not supports the `VPATH'
-variable, you have to compile the package for one architecture at a time
-in the source code directory.  After you have installed the package for
-one architecture, use `make distclean' before reconfiguring for another
-architecture.
+   If you have to use a `make' that does not support the `VPATH'
+variable, you have to compile the package for one architecture at a
+time in the source code directory.  After you have installed the
+package for one architecture, use `make distclean' before reconfiguring
+for another architecture.
 
 Installation Names
 ==================
@@ -122,22 +137,32 @@
 Specifying the System Type
 ==========================
 
-   There may be some features `configure' can not figure out
-automatically, but needs to determine by the type of host the package
-will run on.  Usually `configure' can figure that out, but if it prints
-a message saying it can not guess the host type, give it the
-`--host=TYPE' option.  TYPE can either be a short name for the system
-type, such as `sun4', or a canonical name with three fields:
+   There may be some features `configure' cannot figure out
+automatically, but needs to determine by the type of machine the package
+will run on.  Usually, assuming the package is built to be run on the
+_same_ architectures, `configure' can figure that out, but if it prints
+a message saying it cannot guess the machine type, give it the
+`--build=TYPE' option.  TYPE can either be a short name for the system
+type, such as `sun4', or a canonical name which has the form:
+
      CPU-COMPANY-SYSTEM
 
-See the file `config.sub' for the possible values of each field.  If
+where SYSTEM can have one of these forms:
+
+     OS KERNEL-OS
+
+   See the file `config.sub' for the possible values of each field.  If
 `config.sub' isn't included in this package, then this package doesn't
-need to know the host type.
+need to know the machine type.
 
-   If you are building compiler tools for cross-compiling, you can also
+   If you are _building_ compiler tools for cross-compiling, you should
 use the `--target=TYPE' option to select the type of system they will
-produce code for and the `--build=TYPE' option to select the type of
-system on which you are compiling the package.
+produce code for.
+
+   If you want to _use_ a cross compiler, that generates code for a
+platform different from the build platform, you should specify the
+"host" platform (i.e., that on which the generated programs will
+eventually be run) with `--host=TYPE'.
 
 Sharing Defaults
 ================
@@ -150,20 +175,44 @@
 `CONFIG_SITE' environment variable to the location of the site script.
 A warning: not all `configure' scripts look for a site script.
 
-Operation Controls
+Defining Variables
 ==================
 
+   Variables not defined in a site shell script can be set in the
+environment passed to `configure'.  However, some packages may run
+configure again during the build, and the customized values of these
+variables may be lost.  In order to avoid this problem, you should set
+them in the `configure' command line, using `VAR=value'.  For example:
+
+     ./configure CC=/usr/local2/bin/gcc
+
+will cause the specified gcc to be used as the C compiler (unless it is
+overridden in the site shell script).
+
+`configure' Invocation
+======================
+
    `configure' recognizes the following options to control how it
 operates.
 
-`--cache-file=FILE'
-     Use and save the results of the tests in FILE instead of
-     `./config.cache'.  Set FILE to `/dev/null' to disable caching, for
-     debugging `configure'.
-
 `--help'
+`-h'
      Print a summary of the options to `configure', and exit.
 
+`--version'
+`-V'
+     Print the version of Autoconf used to generate the `configure'
+     script, and exit.
+
+`--cache-file=FILE'
+     Enable the cache: use and save the results of the tests in FILE,
+     traditionally `config.cache'.  FILE defaults to `/dev/null' to
+     disable caching.
+
+`--config-cache'
+`-C'
+     Alias for `--cache-file=config.cache'.
+
 `--quiet'
 `--silent'
 `-q'
@@ -175,8 +224,6 @@
      Look for the package's source code in directory DIR.  Usually
      `configure' can determine that directory automatically.
 
-`--version'
-     Print the version of Autoconf used to generate the `configure'
-     script, and exit.
+`configure' also accepts some other, not widely useful, options.  Run
+`configure --help' for more details.
 
-`configure' also accepts some other, not widely useful, options.
Index: build_tree/bootLoader/Makefile.cvs
diff -u /dev/null build_tree/bootLoader/Makefile.cvs:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/Makefile.cvs	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,6 @@
+all:
+	aclocal
+	autoheader
+	autoconf
+	automake --add-missing
+
Index: build_tree/bootLoader/Makefile.in
diff -u build_tree/bootLoader/Makefile.in:1.1.1.1 build_tree/bootLoader/Makefile.in:1.2
--- build_tree/bootLoader/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,141 +12,232 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 ###########################################################################
 ###########################################################################
-
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = .
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = .
+DIST_COMMON = README $(am__configure_deps) $(srcdir)/Makefile.am \
+	$(srcdir)/Makefile.in $(top_srcdir)/configure AUTHORS COPYING \
+	ChangeLog INSTALL NEWS
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+am__CONFIG_DISTCLEAN_FILES = config.status config.cache config.log \
+ configure.lineno configure.status.lineno
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+distdir = $(PACKAGE)-$(VERSION)
+top_distdir = $(distdir)
+am__remove_distdir = \
+  { test ! -d $(distdir) \
+    || { find $(distdir) -type d ! -perm -200 -exec chmod u+w {} ';' \
+         && rm -fr $(distdir); }; }
+DIST_ARCHIVES = $(distdir).tar.gz
+GZIP_ENV = --best
+distuninstallcheck_listfiles = find . -type f -print
+distcleancheck_listfiles = find . -type f -print
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-SUBDIRS =  	doc 	tools 	utils 	include 	src
-
-
-EXTRA_DIST =  	README 	RELEASE-NOTES 	acconfig.h
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+SUBDIRS = \
+	doc \
+	tools \
+	utils \
+	include \
+	src
+
+EXTRA_DIST = \
+	README \
+	RELEASE-NOTES \
+	acconfig.h
 
 CLEANFILES = *~
-ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ./include/blob/config.h
-CONFIG_CLEAN_FILES = 
-DIST_COMMON =  README AUTHORS COPYING ChangeLog INSTALL Makefile.am \
-Makefile.in NEWS acconfig.h aclocal.m4 configure configure.in \
-include/blob/config.h.in include/blob/stamp-h.in
-
+all: all-recursive
 
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
-$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ configure.in 
-	cd $(srcdir) && $(ACLOCAL)
+am--refresh:
+	@:
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      echo ' cd $(srcdir) && $(AUTOMAKE) --gnu '; \
+	      cd $(srcdir) && $(AUTOMAKE) --gnu  \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    echo ' $(SHELL) ./config.status'; \
+	    $(SHELL) ./config.status;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $@ $(am__depfiles_maybe);; \
+	esac;
 
-config.status: $(srcdir)/configure.in $(CONFIG_STATUS_DEPENDENCIES)
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
 	$(SHELL) ./config.status --recheck
-$(srcdir)/configure: @MAINTAINER_MODE_TRUE@$(srcdir)/configure.in $(ACLOCAL_M4) $(CONFIGURE_DEPENDENCIES)
-	cd $(srcdir) && $(AUTOCONF)
 
-include/blob/config.h: include/blob/stamp-h
-	@if test ! -f $@; then \
-		rm -f include/blob/stamp-h; \
-		$(MAKE) include/blob/stamp-h; \
-	else :; fi
-include/blob/stamp-h: $(srcdir)/include/blob/config.h.in $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES= CONFIG_HEADERS=include/blob/config.h \
-	     $(SHELL) ./config.status
-	@echo timestamp > include/blob/stamp-h 2> /dev/null
-$(srcdir)/include/blob/config.h.in: @MAINTAINER_MODE_TRUE@$(srcdir)/include/blob/stamp-h.in
-	@if test ! -f $@; then \
-		rm -f $(srcdir)/include/blob/stamp-h.in; \
-		$(MAKE) $(srcdir)/include/blob/stamp-h.in; \
-	else :; fi
-$(srcdir)/include/blob/stamp-h.in: $(top_srcdir)/configure.in $(ACLOCAL_M4) acconfig.h
-	cd $(top_srcdir) && $(AUTOHEADER)
-	@echo timestamp > $(srcdir)/include/blob/stamp-h.in 2> /dev/null
-
-mostlyclean-hdr:
-
-clean-hdr:
-
-distclean-hdr:
-	-rm -f include/blob/config.h
-
-maintainer-clean-hdr:
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(srcdir) && $(AUTOCONF)
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(srcdir) && $(ACLOCAL) $(ACLOCAL_AMFLAGS)
+uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
 # into them and run `make' without going through this Makefile.
@@ -152,13 +245,8 @@
 # (1) if the variable is set in `config.status', edit `config.status'
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
-
-@SET_MAKE@
-
-all-recursive install-data-recursive install-exec-recursive \
-installdirs-recursive install-recursive uninstall-recursive  \
-check-recursive installcheck-recursive info-recursive dvi-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -178,13 +266,18 @@
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
-	rev=''; list='$(SUBDIRS)'; for subdir in $$list; do \
-	  rev="$$subdir $$rev"; \
-	  test "$$subdir" = "." && dot_seen=yes; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
 	done; \
-	test "$$dot_seen" = "no" && rev=". $$rev"; \
+	rev="$$rev ."; \
 	target=`echo $@ | sed s/-recursive//`; \
 	for subdir in $$rev; do \
 	  echo "Making $$target in $$subdir"; \
@@ -200,170 +293,301 @@
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
 
-tags: TAGS
-
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
+	mkid -fID $$unique
+tags: TAGS
 
-TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
-   if test "$$subdir" = .; then :; else \
-	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
-   fi; \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
-maintainer-clean-tags:
-
-distdir = $(PACKAGE)-$(VERSION)
-top_distdir = $(distdir)
-
-# This target untars the dist file and tries a VPATH configuration.  Then
-# it guarantees that the distribution is self-contained by making another
-# tarfile.
-distcheck: dist
-	-rm -rf $(distdir)
-	GZIP=$(GZIP_ENV) $(TAR) zxf $(distdir).tar.gz
-	mkdir $(distdir)/=build
-	mkdir $(distdir)/=inst
-	dc_install_base=`cd $(distdir)/=inst && pwd`; \
-	cd $(distdir)/=build \
-	  && ../configure --srcdir=.. --prefix=$$dc_install_base \
-	  && $(MAKE) $(AM_MAKEFLAGS) \
-	  && $(MAKE) $(AM_MAKEFLAGS) dvi \
-	  && $(MAKE) $(AM_MAKEFLAGS) check \
-	  && $(MAKE) $(AM_MAKEFLAGS) install \
-	  && $(MAKE) $(AM_MAKEFLAGS) installcheck \
-	  && $(MAKE) $(AM_MAKEFLAGS) dist
-	-rm -rf $(distdir)
-	@banner="$(distdir).tar.gz is ready for distribution"; \
-	dashes=`echo "$$banner" | sed s/./=/g`; \
-	echo "$$dashes"; \
-	echo "$$banner"; \
-	echo "$$dashes"
-dist: distdir
-	-chmod -R a+r $(distdir)
-	GZIP=$(GZIP_ENV) $(TAR) chozf $(distdir).tar.gz $(distdir)
-	-rm -rf $(distdir)
-dist-all: distdir
-	-chmod -R a+r $(distdir)
-	GZIP=$(GZIP_ENV) $(TAR) chozf $(distdir).tar.gz $(distdir)
-	-rm -rf $(distdir)
 distdir: $(DISTFILES)
-	-rm -rf $(distdir)
+	$(am__remove_distdir)
 	mkdir $(distdir)
-	-chmod 777 $(distdir)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d $(distdir)/$$subdir \
-	    || mkdir $(distdir)/$$subdir \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
 	    || exit 1; \
-	    chmod 777 $(distdir)/$$subdir; \
-	    (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$(distdir) distdir=../$(distdir)/$$subdir distdir) \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
 	      || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-recursive
-dvi-am:
-dvi: dvi-recursive
+	-find $(distdir) -type d ! -perm -777 -exec chmod a+rwx {} \; -o \
+	  ! -type d ! -perm -444 -links 1 -exec chmod a+r {} \; -o \
+	  ! -type d ! -perm -400 -exec chmod a+r {} \; -o \
+	  ! -type d ! -perm -444 -exec $(SHELL) $(install_sh) -c -m a+r {} {} \; \
+	|| chmod -R a+r $(distdir)
+dist-gzip: distdir
+	$(AMTAR) chof - $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
+	$(am__remove_distdir)
+
+dist-bzip2: distdir
+	$(AMTAR) chof - $(distdir) | bzip2 -9 -c >$(distdir).tar.bz2
+	$(am__remove_distdir)
+
+dist-tarZ: distdir
+	$(AMTAR) chof - $(distdir) | compress -c >$(distdir).tar.Z
+	$(am__remove_distdir)
+
+dist-shar: distdir
+	shar $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).shar.gz
+	$(am__remove_distdir)
+
+dist-zip: distdir
+	-rm -f $(distdir).zip
+	zip -rq $(distdir).zip $(distdir)
+	$(am__remove_distdir)
+
+dist dist-all: distdir
+	$(AMTAR) chof - $(distdir) | GZIP=$(GZIP_ENV) gzip -c >$(distdir).tar.gz
+	$(am__remove_distdir)
+
+# This target untars the dist file and tries a VPATH configuration.  Then
+# it guarantees that the distribution is self-contained by making another
+# tarfile.
+distcheck: dist
+	case '$(DIST_ARCHIVES)' in \
+	*.tar.gz*) \
+	  GZIP=$(GZIP_ENV) gunzip -c $(distdir).tar.gz | $(AMTAR) xf - ;;\
+	*.tar.bz2*) \
+	  bunzip2 -c $(distdir).tar.bz2 | $(AMTAR) xf - ;;\
+	*.tar.Z*) \
+	  uncompress -c $(distdir).tar.Z | $(AMTAR) xf - ;;\
+	*.shar.gz*) \
+	  GZIP=$(GZIP_ENV) gunzip -c $(distdir).tar.gz | unshar ;;\
+	*.zip*) \
+	  unzip $(distdir).zip ;;\
+	esac
+	chmod -R a-w $(distdir); chmod a+w $(distdir)
+	mkdir $(distdir)/_build
+	mkdir $(distdir)/_inst
+	chmod a-w $(distdir)
+	dc_install_base=`$(am__cd) $(distdir)/_inst && pwd | sed -e 's,^[^:\\/]:[\\/],/,'` \
+	  && dc_destdir="$${TMPDIR-/tmp}/am-dc-$$$$/" \
+	  && cd $(distdir)/_build \
+	  && ../configure --srcdir=.. --prefix="$$dc_install_base" \
+	    $(DISTCHECK_CONFIGURE_FLAGS) \
+	  && $(MAKE) $(AM_MAKEFLAGS) \
+	  && $(MAKE) $(AM_MAKEFLAGS) dvi \
+	  && $(MAKE) $(AM_MAKEFLAGS) check \
+	  && $(MAKE) $(AM_MAKEFLAGS) install \
+	  && $(MAKE) $(AM_MAKEFLAGS) installcheck \
+	  && $(MAKE) $(AM_MAKEFLAGS) uninstall \
+	  && $(MAKE) $(AM_MAKEFLAGS) distuninstallcheck_dir="$$dc_install_base" \
+	        distuninstallcheck \
+	  && chmod -R a-w "$$dc_install_base" \
+	  && ({ \
+	       (cd ../.. && umask 077 && mkdir "$$dc_destdir") \
+	       && $(MAKE) $(AM_MAKEFLAGS) DESTDIR="$$dc_destdir" install \
+	       && $(MAKE) $(AM_MAKEFLAGS) DESTDIR="$$dc_destdir" uninstall \
+	       && $(MAKE) $(AM_MAKEFLAGS) DESTDIR="$$dc_destdir" \
+	            distuninstallcheck_dir="$$dc_destdir" distuninstallcheck; \
+	      } || { rm -rf "$$dc_destdir"; exit 1; }) \
+	  && rm -rf "$$dc_destdir" \
+	  && $(MAKE) $(AM_MAKEFLAGS) dist \
+	  && rm -rf $(DIST_ARCHIVES) \
+	  && $(MAKE) $(AM_MAKEFLAGS) distcleancheck
+	$(am__remove_distdir)
+	@(echo "$(distdir) archives ready for distribution: "; \
+	  list='$(DIST_ARCHIVES)'; for i in $$list; do echo $$i; done) | \
+	  sed -e '1{h;s/./=/g;p;x;}' -e '$${p;x;}'
+distuninstallcheck:
+	@cd $(distuninstallcheck_dir) \
+	&& test `$(distuninstallcheck_listfiles) | wc -l` -le 1 \
+	   || { echo "ERROR: files left after uninstall:" ; \
+	        if test -n "$(DESTDIR)"; then \
+	          echo "  (check DESTDIR support)"; \
+	        fi ; \
+	        $(distuninstallcheck_listfiles) ; \
+	        exit 1; } >&2
+distcleancheck: distclean
+	@if test '$(srcdir)' = . ; then \
+	  echo "ERROR: distcleancheck can only run from a VPATH build" ; \
+	  exit 1 ; \
+	fi
+	@test `$(distcleancheck_listfiles) | wc -l` -eq 0 \
+	  || { echo "ERROR: files left in build directory after distclean:" ; \
+	       $(distcleancheck_listfiles) ; \
+	       exit 1; } >&2
 check-am: all-am
 check: check-recursive
-installcheck-am:
-installcheck: installcheck-recursive
-install-exec-am:
+all-am: Makefile
+installdirs: installdirs-recursive
+installdirs-am:
+install: install-recursive
 install-exec: install-exec-recursive
-
-install-data-am:
 install-data: install-data-recursive
+uninstall: uninstall-recursive
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-recursive
-uninstall-am:
-uninstall: uninstall-recursive
-all-am: Makefile
-all-redirect: all-recursive
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs: installdirs-recursive
-installdirs-am:
-
 
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-hdr mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-recursive
 
-mostlyclean: mostlyclean-recursive
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-hdr clean-tags clean-generic mostlyclean-am
+distclean: distclean-recursive
+	-rm -f $(am__CONFIG_DISTCLEAN_FILES)
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
 
-clean: clean-recursive
+dvi: dvi-recursive
+
+dvi-am:
 
-distclean-am:  distclean-hdr distclean-tags distclean-generic clean-am
+html: html-recursive
 
-distclean: distclean-recursive
-	-rm -f config.status
+info: info-recursive
 
-maintainer-clean-am:  maintainer-clean-hdr maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-recursive
-	-rm -f config.status
+	-rm -f $(am__CONFIG_DISTCLEAN_FILES)
+	-rm -rf $(top_srcdir)/autom4te.cache
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-info-am
 
-.PHONY: mostlyclean-hdr distclean-hdr clean-hdr maintainer-clean-hdr \
-install-data-recursive uninstall-data-recursive install-exec-recursive \
-uninstall-exec-recursive installdirs-recursive uninstalldirs-recursive \
-all-recursive check-recursive installcheck-recursive info-recursive \
-dvi-recursive mostlyclean-recursive distclean-recursive clean-recursive \
-maintainer-clean-recursive tags tags-recursive mostlyclean-tags \
-distclean-tags clean-tags maintainer-clean-tags distdir info-am info \
-dvi-am dvi check check-am installcheck-am installcheck install-exec-am \
-install-exec install-data-am install-data install-am install \
-uninstall-am uninstall all-redirect all-am all installdirs-am \
-installdirs mostlyclean-generic distclean-generic clean-generic \
-maintainer-clean-generic clean mostlyclean distclean maintainer-clean
+uninstall-info: uninstall-info-recursive
 
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am am--refresh check \
+	check-am clean clean-generic clean-recursive ctags \
+	ctags-recursive dist dist-all dist-bzip2 dist-gzip dist-shar \
+	dist-tarZ dist-zip distcheck distclean distclean-generic \
+	distclean-recursive distclean-tags distcleancheck distdir \
+	distuninstallcheck dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-generic \
+	mostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/README
diff -u build_tree/bootLoader/README:1.1.1.1 build_tree/bootLoader/README:1.1.1.2
--- build_tree/bootLoader/README:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/README	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 (emacs users can use -*- outline -*- mode for this file)
 
-$Id: README,v 1.7 2002/01/07 20:16:49 erikm Exp $
+$Id: README,v 1.10 2003/09/03 00:32:03 russd Exp $
 
 * Info
 ======
@@ -44,9 +44,9 @@
 general blob discussion is done on the LART mailing list, see
 http://www.lart.tudelft.nl/list/ for more information.
 
-There is also a blob IRC channel: log on to irc.openprojects.net and
-join #blob. Note that this is a strictly on-topic development IRC
-channel, not a general blob help channel.
+There is also a blob IRC channel: log on to irc.oftc.net and join #blob.
+Note that this is a strictly on-topic development IRC channel, not a
+general blob help channel.
 
 Blob even has a home page: http://www.lart.tudelft.nl/lartware/blob/ .
 
@@ -102,7 +102,7 @@
 
 This step is only necessary if you build blob from CVS.
 
-- Run "tools/rebuild-gcc" ttwwiiccee
+- Run "make -f Makefile.cvs" ttwwiiccee
 
 
 
@@ -505,25 +505,14 @@
 Put this just after the CreditLART definition.
 
 
-** Define the architecture in acconfig.h
-----------------------------------------
-
-Because configure.in was instructed to define FOOBAR for the foobar
-platform, we have to define the symbol in acconfig.h as well. Add the
-following two lines to acconfig.h, just after the CLART define:
-
-  /* Define for foobar boards */
-  #undef FOOBAR
-
-
 ** Update the build system
 --------------------------
 
 Run the following commands to update the configure script,
-include/config.h.in, and the Makefile.in files:
+include/blob/config.h.in, and the Makefile.in files:
 
-  tools/rebuild-gcc
-  tools/rebuild-gcc
+  make -f Makefile.cvs
+  make -f Makefile.cvs
 
 (yes, twice)
 
Index: build_tree/bootLoader/RELEASE-NOTES
diff -u build_tree/bootLoader/RELEASE-NOTES:1.1.1.1 build_tree/bootLoader/RELEASE-NOTES:1.1.1.2
--- build_tree/bootLoader/RELEASE-NOTES:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/RELEASE-NOTES	Fri Nov  9 09:44:05 2007
@@ -1,4 +1,11 @@
-$Id: RELEASE-NOTES,v 1.7 2002/01/07 20:16:49 erikm Exp $
+$Id: RELEASE-NOTES,v 1.8 2002/02/16 00:41:06 erikm Exp $
+
+Release notes for blob-2.0.5-pre3
+=================================
+
+License for src/blob/testmem.S and src/blob/testmem2.S changed from
+GPLv2+later to GPLv2 only.
+
 
 Release notes for blob-2.0.5-pre2
 =================================
Index: build_tree/bootLoader/acconfig.h
diff -u build_tree/bootLoader/acconfig.h:1.1.1.1 build_tree/bootLoader/acconfig.h:removed
--- build_tree/bootLoader/acconfig.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/acconfig.h	Tue Jan  8 14:21:46 2008
@@ -1,109 +0,0 @@
-/*-------------------------------------------------------------------------
- * Filename:      acconfig.h
- * Version:       $Id: acconfig.h,v 1.12 2002/01/07 14:58:16 erikm Exp $
- * Copyright:     Copyright (C) 1999, Erik Mouw
- * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- * Description:   Definitions for GNU autoconf/automake/libtool
- * Created at:    Wed Jul 28 22:35:51 1999
- * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- * Modified at:   Sun Oct  3 18:47:48 1999
- *-----------------------------------------------------------------------*/
-/*
- * acconfig.h: Definitions for GNU autoconf/automake/libtool
- *
- * Copyright (C) 1999  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-/* 
- *
- * WARNING:
- *   Don't try to edit config.h.in or config.h, because your changes
- *   will be overwritten once you run automake, autoconf or
- *   configure. Edit acconfig.h instead.
- *
- */
-
-#ident "$Id: acconfig.h,v 1.12 2002/01/07 14:58:16 erikm Exp $"
-
-#ifndef BLOB_CONFIG_H
-#define BLOB_CONFIG_H
-
-@TOP@
-
-/* Define the package name here */
-#undef PACKAGE
-
-/* Define the package version here */
-#undef VERSION
-
-/* Define the board name over here */
-#undef BOARD_NAME
-
-/* Define to enable run-time debug information */
-#undef BLOB_DEBUG
-
-/* Define for Assabet boards */
-#undef ASSABET
-
-/* Define if Neponset board attached to Assabet */
-#undef NEPONSET
-
-/* Define for Badge 4 */
-#undef BADGE4
-
-/* Define for Brutus boards */
-#undef BRUTUS
-
-/* Define for CreditLART boards */
-#undef CLART
-
-/* Define for Ipaq H3600 */
-#undef H3600
-
-/* Define for Vercel UD-1 (IDR) */
-#undef IDR
-
-/* Define for Jornada 720 */
-#undef JORNADA720
-
-/* Define for LART boards */
-#undef LART
-
-/* Define for NESA boards */
-#undef NESA
-
-/* Define for PLEB boards */
-#undef PLEB
-
-/* Define for PT System 3 boards */
-#undef PT_SYSTEM3
-
-/* Define for Shannon (TuxScreen) */
-#undef SHANNON
-
-/* Define if LCD support is wanted */
-#undef CONFIG_LCD_SUPPORT
-
-/* Define if MD5 support is wanted */
-#undef CONFIG_MD5_SUPPORT
-
-/* Define the CPU type */
-#undef CPU
-
-@BOTTOM@
-
-#endif
Index: build_tree/bootLoader/aclocal.m4
diff -u build_tree/bootLoader/aclocal.m4:1.1.1.1 build_tree/bootLoader/aclocal.m4:removed
--- build_tree/bootLoader/aclocal.m4:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/aclocal.m4	Tue Jan  8 14:21:46 2008
@@ -1,160 +0,0 @@
-dnl aclocal.m4 generated automatically by aclocal 1.4-p4
-
-dnl Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
-dnl This file is free software; the Free Software Foundation
-dnl gives unlimited permission to copy and/or distribute it,
-dnl with or without modifications, as long as this notice is preserved.
-
-dnl This program is distributed in the hope that it will be useful,
-dnl but WITHOUT ANY WARRANTY, to the extent permitted by law; without
-dnl even the implied warranty of MERCHANTABILITY or FITNESS FOR A
-dnl PARTICULAR PURPOSE.
-
-# Do all the work for Automake.  This macro actually does too much --
-# some checks are only needed if your package does certain things.
-# But this isn't really a big deal.
-
-# serial 1
-
-dnl Usage:
-dnl AM_INIT_AUTOMAKE(package,version, [no-define])
-
-AC_DEFUN(AM_INIT_AUTOMAKE,
-[AC_REQUIRE([AC_PROG_INSTALL])
-PACKAGE=[$1]
-AC_SUBST(PACKAGE)
-VERSION=[$2]
-AC_SUBST(VERSION)
-dnl test to see if srcdir already configured
-if test "`cd $srcdir && pwd`" != "`pwd`" && test -f $srcdir/config.status; then
-  AC_MSG_ERROR([source directory already configured; run "make distclean" there first])
-fi
-ifelse([$3],,
-AC_DEFINE_UNQUOTED(PACKAGE, "$PACKAGE", [Name of package])
-AC_DEFINE_UNQUOTED(VERSION, "$VERSION", [Version number of package]))
-AC_REQUIRE([AM_SANITY_CHECK])
-AC_REQUIRE([AC_ARG_PROGRAM])
-dnl FIXME This is truly gross.
-missing_dir=`cd $ac_aux_dir && pwd`
-AM_MISSING_PROG(ACLOCAL, aclocal, $missing_dir)
-AM_MISSING_PROG(AUTOCONF, autoconf, $missing_dir)
-AM_MISSING_PROG(AUTOMAKE, automake, $missing_dir)
-AM_MISSING_PROG(AUTOHEADER, autoheader, $missing_dir)
-AM_MISSING_PROG(MAKEINFO, makeinfo, $missing_dir)
-AC_REQUIRE([AC_PROG_MAKE_SET])])
-
-#
-# Check to make sure that the build environment is sane.
-#
-
-AC_DEFUN(AM_SANITY_CHECK,
-[AC_MSG_CHECKING([whether build environment is sane])
-# Just in case
-sleep 1
-echo timestamp > conftestfile
-# Do `set' in a subshell so we don't clobber the current shell's
-# arguments.  Must try -L first in case configure is actually a
-# symlink; some systems play weird games with the mod time of symlinks
-# (eg FreeBSD returns the mod time of the symlink's containing
-# directory).
-if (
-   set X `ls -Lt $srcdir/configure conftestfile 2> /dev/null`
-   if test "[$]*" = "X"; then
-      # -L didn't work.
-      set X `ls -t $srcdir/configure conftestfile`
-   fi
-   if test "[$]*" != "X $srcdir/configure conftestfile" \
-      && test "[$]*" != "X conftestfile $srcdir/configure"; then
-
-      # If neither matched, then we have a broken ls.  This can happen
-      # if, for instance, CONFIG_SHELL is bash and it inherits a
-      # broken ls alias from the environment.  This has actually
-      # happened.  Such a system could not be considered "sane".
-      AC_MSG_ERROR([ls -t appears to fail.  Make sure there is not a broken
-alias in your environment])
-   fi
-
-   test "[$]2" = conftestfile
-   )
-then
-   # Ok.
-   :
-else
-   AC_MSG_ERROR([newly created file is older than distributed files!
-Check your system clock])
-fi
-rm -f conftest*
-AC_MSG_RESULT(yes)])
-
-dnl AM_MISSING_PROG(NAME, PROGRAM, DIRECTORY)
-dnl The program must properly implement --version.
-AC_DEFUN(AM_MISSING_PROG,
-[AC_MSG_CHECKING(for working $2)
-# Run test in a subshell; some versions of sh will print an error if
-# an executable is not found, even if stderr is redirected.
-# Redirect stdin to placate older versions of autoconf.  Sigh.
-if ($2 --version) < /dev/null > /dev/null 2>&1; then
-   $1=$2
-   AC_MSG_RESULT(found)
-else
-   $1="$3/missing $2"
-   AC_MSG_RESULT(missing)
-fi
-AC_SUBST($1)])
-
-# Like AC_CONFIG_HEADER, but automatically create stamp file.
-
-AC_DEFUN(AM_CONFIG_HEADER,
-[AC_PREREQ([2.12])
-AC_CONFIG_HEADER([$1])
-dnl When config.status generates a header, we must update the stamp-h file.
-dnl This file resides in the same directory as the config header
-dnl that is generated.  We must strip everything past the first ":",
-dnl and everything past the last "/".
-AC_OUTPUT_COMMANDS(changequote(<<,>>)dnl
-ifelse(patsubst(<<$1>>, <<[^ ]>>, <<>>), <<>>,
-<<test -z "<<$>>CONFIG_HEADERS" || echo timestamp > patsubst(<<$1>>, <<^\([^:]*/\)?.*>>, <<\1>>)stamp-h<<>>dnl>>,
-<<am_indx=1
-for am_file in <<$1>>; do
-  case " <<$>>CONFIG_HEADERS " in
-  *" <<$>>am_file "*<<)>>
-    echo timestamp > `echo <<$>>am_file | sed -e 's%:.*%%' -e 's%[^/]*$%%'`stamp-h$am_indx
-    ;;
-  esac
-  am_indx=`expr "<<$>>am_indx" + 1`
-done<<>>dnl>>)
-changequote([,]))])
-
-# Add --enable-maintainer-mode option to configure.
-# From Jim Meyering
-
-# serial 1
-
-AC_DEFUN(AM_MAINTAINER_MODE,
-[AC_MSG_CHECKING([whether to enable maintainer-specific portions of Makefiles])
-  dnl maintainer-mode is disabled by default
-  AC_ARG_ENABLE(maintainer-mode,
-[  --enable-maintainer-mode enable make rules and dependencies not useful
-                          (and sometimes confusing) to the casual installer],
-      USE_MAINTAINER_MODE=$enableval,
-      USE_MAINTAINER_MODE=no)
-  AC_MSG_RESULT($USE_MAINTAINER_MODE)
-  AM_CONDITIONAL(MAINTAINER_MODE, test $USE_MAINTAINER_MODE = yes)
-  MAINT=$MAINTAINER_MODE_TRUE
-  AC_SUBST(MAINT)dnl
-]
-)
-
-# Define a conditional.
-
-AC_DEFUN(AM_CONDITIONAL,
-[AC_SUBST($1_TRUE)
-AC_SUBST($1_FALSE)
-if $2; then
-  $1_TRUE=
-  $1_FALSE='#'
-else
-  $1_TRUE='#'
-  $1_FALSE=
-fi])
-
Index: build_tree/bootLoader/blob.vimproject
diff -u /dev/null build_tree/bootLoader/blob.vimproject:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/blob.vimproject	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,234 @@
+blob=/tmp/blob_head CD=. filter="AUTHORS COPYING ChangeLog INSTALL NEWS README RELEASE-NOTES configure.in *.am *.[chS] *.sh"{
+ AUTHORS
+ COPYING
+ ChangeLog
+ INSTALL
+ NEWS
+ README
+ RELEASE-NOTES
+ configure.in
+ Makefile.am
+ include=include CD=. {
+  Makefile.am
+  registers.h
+  blob=blob CD=. {
+   Makefile.am
+   arch.h
+   bitfield.h
+   cf.h
+   command.h
+   command_hist.h
+   compr_rubin.h
+   config.h
+   crc32.h
+   debug.h
+   errno.h
+   error.h
+   flash.h
+   generic_io.h
+   gio_drivers.h
+   i2c-gpio.h
+   i2c.h
+   icache.h
+   ide.h
+   init.h
+   jffs2.h
+   lcd.h
+   led.h
+   linux.h
+   load_kernel.h
+   main.h
+   md5.h
+   md5support.h
+   memory.h
+   memsetup.h
+   mini_inflate.h
+   param_block.h
+   partition.h
+   pcmcia.h
+   reboot.h
+   serial.h
+   spd.h
+   tar.h
+   time.h
+   types.h
+   util.h
+   uucodec.h
+   xmodem.h
+  }
+ }
+ doc=doc CD=. filter="*.am *.txt" {
+  Makefile.am
+  commandlist.txt
+  diag.txt
+  motto.txt
+  porting.txt
+ }
+ src=src CD=. {
+  Makefile.am
+  blob=blob CD=. {
+   Makefile.am
+   accelent_sa.c
+   amd32.c
+   assabet.c
+   badge4.c
+   bootldrpart.c
+   brutus.c
+   cep.c
+   chain.S
+   chkmem.c
+   clart.c
+   clock.c
+   commands.c
+   compr_rtime.c
+   compr_rubin.c
+   cramfs.c
+   csir_ims.c
+   dafit.c
+   flash-commands.c
+   flash.c
+   flashasm.S
+   frodo.c
+   gpio-pxa.S
+   h3600.c
+   hackkit.c
+   idr.c
+   initcalls.c
+   intel16.c
+   intel32.c
+   jffs2.c
+   jornada720.c
+   lart.c
+   ledasm-mmap.S
+   ledasm-sa11x0.S
+   linux.c
+   load_kernel.c
+   lubbock.c
+   main.c
+   memory.c
+   memsetup-pxa.S
+   memsetup-sa1100.S
+   memsetup-sa1110.S
+   miniprint.c
+   nesa.c
+   nullflash.c
+   param_block.c
+   partition.c
+   pleb.c
+   pxa_idp.c
+   ramses.c
+   reboot.c
+   shannon.c
+   smc9196.c
+   start-pxa.S
+   start-sa11x0.S
+   start.S
+   system3.c
+   testmem.S
+   testmem2.S
+   trampoline.S
+   trizeps.c
+   uucodec.c
+   xmodem.c
+   zImage.c
+  }
+  commands=commands CD=. {
+   Makefile.am
+   call.c
+   changebit.c
+   dlfile.c
+   dummy.c
+   dump.c
+   ferase.c
+   fwrite.c
+   md5chk.c
+   memcpy.c
+   peek.c
+   poke.c
+   reboot.c
+   setip.c
+   sysupd.c
+   terminal.c
+   tftp.c
+   make_commands.sh
+  }
+  lib=lib CD=. {
+   Makefile.am
+   arp.c
+   bootp.c
+   cf.c
+   command.c
+   crc32.c
+   error.c
+   ext2fs.c
+   generic_io.c
+   gio_flash.c
+   gio_part_blob.c
+   gio_ram.c
+   i2c-gpio.c
+   i2c.c
+   icache.c
+   ide.c
+   init.c
+   ip_bits.c
+   led-mmap.c
+   led-sa11x0.c
+   led.c
+   md5.c
+   md5support.c
+   memcmp.c
+   memcpy.c
+   memset.c
+   mini_inflate.c
+   pcmcia.c
+   printf.c
+   reboot-pxa.c
+   reboot-sa11x0.c
+   reboot.c
+   serial-pxa.c
+   serial-sa11x0.c
+   serial.c
+   strlen.c
+   strncmp.c
+   strncpy.c
+   strtou32.c
+   tar.c
+   tftp.c
+   time.c
+   util.c
+  }
+  diag=diag CD=. {
+   Makefile.am
+   accelent_sa.c
+   assabet.c
+   badge4.c
+   brutus.c
+   cep.c
+   clart.c
+   command_hist.c
+   csir_ims.c
+   frodo.c
+   getcommand.c
+   h3600.c
+   hackkit.c
+   idr.c
+   initcalls.c
+   jornada720.c
+   lart.c
+   lcd.c
+   lubbock.c
+   main.c
+   miniprint.c
+   nesa.c
+   pleb.c
+   pxa_idp.c
+   ramses.c
+   regs-pxa.c
+   regs-sa11x0.c
+   shannon.c
+   start.S
+   system3.c
+   trizeps.c
+  }
+ }
+}
Index: build_tree/bootLoader/configure
diff -u build_tree/bootLoader/configure:1.1.1.1 build_tree/bootLoader/configure:1.2
--- build_tree/bootLoader/configure:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/configure	Mon Nov 12 16:14:46 2007
@@ -1,102 +1,289 @@
 #! /bin/sh
-
-# From configure.in Id: configure.in,v 1.34 2002/01/07 14:58:16 erikm Exp 
-
-
-
-
+# From configure.in Id: configure.in,v 1.74 2003/09/04 18:10:39 russd Exp .
+# Guess values for system-dependent variables and create Makefiles.
+# Generated by GNU Autoconf 2.59.
+#
+# Copyright (C) 2003 Free Software Foundation, Inc.
+# This configure script is free software; the Free Software Foundation
+# gives unlimited permission to copy, distribute and modify it.
+## --------------------- ##
+## M4sh Initialization.  ##
+## --------------------- ##
+
+# Be Bourne compatible
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+"$@"}'='"$@"'
+elif test -n "${BASH_VERSION+set}" && (set -o posix) >/dev/null 2>&1; then
+  set -o posix
+fi
+DUALCASE=1; export DUALCASE # for MKS sh
+
+# Support unset when possible.
+if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+  as_unset=unset
+else
+  as_unset=false
+fi
 
 
+# Work around bugs in pre-3.0 UWIN ksh.
+$as_unset ENV MAIL MAILPATH
+PS1='$ '
+PS2='> '
+PS4='+ '
 
-# Do all the work for Automake.  This macro actually does too much --
-# some checks are only needed if your package does certain things.
-# But this isn't really a big deal.
+# NLS nuisances.
+for as_var in \
+  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
+  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
+  LC_TELEPHONE LC_TIME
+do
+  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
+    eval $as_var=C; export $as_var
+  else
+    $as_unset $as_var
+  fi
+done
 
-# serial 1
+# Required to use basename.
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+if (basename /) >/dev/null 2>&1 && test "X`basename / 2>&1`" = "X/"; then
+  as_basename=basename
+else
+  as_basename=false
+fi
 
 
+# Name of the executable.
+as_me=`$as_basename "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)$' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
+  	  /^X\/\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\/\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+
+
+# PATH needs CR, and LINENO needs CR and PATH.
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
 
 
-#
-# Check to make sure that the build environment is sane.
-#
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2"  || {
+  # Find who we are.  Look in the path if we contain no path at all
+  # relative or not.
+  case $0 in
+    *[\\/]* ) as_myself=$0 ;;
+    *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+done
 
+       ;;
+  esac
+  # We did not find ourselves, most probably we were run as `sh COMMAND'
+  # in which case we are not to be found in the path.
+  if test "x$as_myself" = x; then
+    as_myself=$0
+  fi
+  if test ! -f "$as_myself"; then
+    { echo "$as_me: error: cannot find myself; rerun with an absolute path" >&2
+   { (exit 1); exit 1; }; }
+  fi
+  case $CONFIG_SHELL in
+  '')
+    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for as_base in sh bash ksh sh5; do
+	 case $as_dir in
+	 /*)
+	   if ("$as_dir/$as_base" -c '
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2" ') 2>/dev/null; then
+	     $as_unset BASH_ENV || test "${BASH_ENV+set}" != set || { BASH_ENV=; export BASH_ENV; }
+	     $as_unset ENV || test "${ENV+set}" != set || { ENV=; export ENV; }
+	     CONFIG_SHELL=$as_dir/$as_base
+	     export CONFIG_SHELL
+	     exec "$CONFIG_SHELL" "$0" ${1+"$@"}
+	   fi;;
+	 esac
+       done
+done
+;;
+  esac
 
+  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
+  # uniformly replaced by the line number.  The first 'sed' inserts a
+  # line-number line before each line; the second 'sed' does the real
+  # work.  The second script uses 'N' to pair each line-number line
+  # with the numbered line, and appends trailing '-' during
+  # substitution so that $LINENO is not a special case at line end.
+  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
+  # second 'sed' script.  Blame Lee E. McMahon for sed's syntax.  :-)
+  sed '=' <$as_myself |
+    sed '
+      N
+      s,$,-,
+      : loop
+      s,^\(['$as_cr_digits']*\)\(.*\)[$]LINENO\([^'$as_cr_alnum'_]\),\1\2\1\3,
+      t loop
+      s,-$,,
+      s,^['$as_cr_digits']*\n,,
+    ' >$as_me.lineno &&
+  chmod +x $as_me.lineno ||
+    { echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
+   { (exit 1); exit 1; }; }
+
+  # Don't try to exec as it changes $[0], causing all sort of problems
+  # (the dirname of $[0] is not the place where we might find the
+  # original and so on.  Autoconf is especially sensible to this).
+  . ./$as_me.lineno
+  # Exit status is that of the last command.
+  exit
+}
+
+
+case `echo "testing\c"; echo 1,2,3`,`echo -n testing; echo 1,2,3` in
+  *c*,-n*) ECHO_N= ECHO_C='
+' ECHO_T='	' ;;
+  *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
+  *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
+esac
 
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
 
+rm -f conf$$ conf$$.exe conf$$.file
+echo >conf$$.file
+if ln -s conf$$.file conf$$ 2>/dev/null; then
+  # We could just check for DJGPP; but this test a) works b) is more generic
+  # and c) will remain valid once DJGPP supports symlinks (DJGPP 2.04).
+  if test -f conf$$.exe; then
+    # Don't use ln at all; we don't have any links
+    as_ln_s='cp -p'
+  else
+    as_ln_s='ln -s'
+  fi
+elif ln conf$$.file conf$$ 2>/dev/null; then
+  as_ln_s=ln
+else
+  as_ln_s='cp -p'
+fi
+rm -f conf$$ conf$$.exe conf$$.file
 
-# Like AC_CONFIG_HEADER, but automatically create stamp file.
+if mkdir -p . 2>/dev/null; then
+  as_mkdir_p=:
+else
+  test -d ./-p && rmdir ./-p
+  as_mkdir_p=false
+fi
 
+as_executable_p="test -f"
 
+# Sed expression to map a string onto a valid CPP name.
+as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
 
-# Add --enable-maintainer-mode option to configure.
-# From Jim Meyering
+# Sed expression to map a string onto a valid variable name.
+as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
 
-# serial 1
 
+# IFS
+# We need space, tab and new line, in precisely that order.
+as_nl='
+'
+IFS=" 	$as_nl"
 
+# CDPATH.
+$as_unset CDPATH
 
-# Define a conditional.
 
+# Name of the host.
+# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# so uname gets run too.
+ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
 
+exec 6>&1
 
-# Guess values for system-dependent variables and create Makefiles.
-# Generated automatically using autoconf version 2.13 
-# Copyright (C) 1992, 93, 94, 95, 96 Free Software Foundation, Inc.
 #
-# This configure script is free software; the Free Software Foundation
-# gives unlimited permission to copy, distribute and modify it.
-
-# Defaults:
-ac_help=
+# Initializations.
+#
 ac_default_prefix=/usr/local
-# Any additions from configure.in:
-ac_help="$ac_help
-  --enable-maintainer-mode enable make rules and dependencies not useful
-                          (and sometimes confusing) to the casual installer"
-ac_help="$ac_help
-  --with-board=NAME       Name of the target board
-                          Valid names are:
-                            assabet     Intel Assabet
-                            neponset    Intel Assabet with Neponset board
-                            badge4      HPL Badge 4
-                            brutus      Intel Brutus
-                            creditlart  CreditLART
-                            h3600       Compaq Ipaq H36x0
-                            idr         Vercel UD-1
-                            jornada720  HP Jornada 720 with Flash board
-                            lart        LART
-                            nesa        NESA
-                            pleb        PLEB
-                            shannon     TuxScreen (Shannon)
-			    system3     Prueftechnik Digital Board
-                          Default board is lart"
-ac_help="$ac_help
-  --with-linux-prefix=PFX Prefix where the ARM Linux sources live"
-ac_help="$ac_help
-  --enable-clock-scaling  Enable support for clock scaling (SA1100 only)"
-ac_help="$ac_help
-  --enable-memtest        Enable support for memory tests "
-ac_help="$ac_help
-  --enable-debug          Enable support for misc debugging functions "
-ac_help="$ac_help
-  --enable-lcd            Enable lcd support "
-ac_help="$ac_help
-  --enable-md5            Enable md5 support "
-ac_help="$ac_help
-  --enable-all-features   Enable all features"
-ac_help="$ac_help
-  --enable-blob-debug     Enable run-time debug information"
+ac_config_libobj_dir=.
+cross_compiling=no
+subdirs=
+MFLAGS=
+MAKEFLAGS=
+SHELL=${CONFIG_SHELL-/bin/sh}
+
+# Maximum number of lines to put in a shell here document.
+# This variable seems obsolete.  It should probably be removed, and
+# only ac_max_sed_lines should be used.
+: ${ac_max_here_lines=38}
+
+# Identity of this package.
+PACKAGE_NAME=
+PACKAGE_TARNAME=
+PACKAGE_VERSION=
+PACKAGE_STRING=
+PACKAGE_BUGREPORT=
+
+ac_unique_file="src/blob/start.S"
+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CYGPATH_W PACKAGE VERSION ACLOCAL AUTOCONF AUTOMAKE AUTOHEADER MAKEINFO AMTAR install_sh STRIP ac_ct_STRIP INSTALL_STRIP_PROGRAM mkdir_p AWK SET_MAKE am__leading_dot MAINTAINER_MODE_TRUE MAINTAINER_MODE_FALSE MAINT build build_cpu build_vendor build_os host host_cpu host_vendor host_os CC OBJCOPY RANLIB AR LD CFLAGS LDFLAGS CPPFLAGS ac_ct_CC EXEEXT OBJEXT DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CCDEPMODE am__fastdepCC_TRUE am__fastdepCC_FALSE ac_ct_RANLIB LN_S CCAS CCASFLAGS BLOB_FLASH_OBJS BLOB_PLATFORM_OBJS DIAG_PLATFORM_OBJS BLOB_STARTCODE_OBJS BLOB_MEMSETUP_OBJS BLOB_REBOOT_DRIVER_OBJS BLOB_SERIAL_DRIVER_OBJS BLOB_TIMER_DRIVER_OBJS BLOB_LED_STARTCODE BLOB_LED_DRIVER_OBJS BLOB_NETWORK_DRIVER_OBJS BLOB_TARGET LINUX_INCLUDE BLOB_CLOCK_OBJS BLOB_CHKMEM_OBJS DIAG_LCD_OBJS BLOB_XMODEM_OBJS BLOB_USBSERIAL_OBJS BLOB_UUCODEC_OBJS BLOB_JFFS2_OBJS BLOB_CRAMFS_OBJS BLOB_ZIMAGE_OBJS BLOB_NETWORK_OBJS BLOB_GIO_OBJS BLOB_PCMCIA_OBJS BLOB_IDE_OBJS BLOB_CF_OBJS ALL_COMMANDS BLOB_COMMANDS OCFLAGS LIBOBJS LTLIBOBJS BLOB_SPI_OBJS BLOB_LCD_OBJS'
+ac_subst_files=''
 
 # Initialize some variables set by options.
+ac_init_help=
+ac_init_version=false
 # The variables have the same names as the options, with
 # dashes changed to underlines.
-build=NONE
-cache_file=./config.cache
+cache_file=/dev/null
 exec_prefix=NONE
-host=NONE
 no_create=
-nonopt=NONE
 no_recursion=
 prefix=NONE
 program_prefix=NONE
@@ -105,10 +292,15 @@
 silent=
 site=
 srcdir=
-target=NONE
 verbose=
 x_includes=NONE
 x_libraries=NONE
+
+# Installation directory options.
+# These are left unexpanded so users can "make install exec_prefix=/foo"
+# and all the variables that are supposed to be based on exec_prefix
+# by default will actually change.
+# Use braces instead of parens because sh, perl, etc. also accept them.
 bindir='${exec_prefix}/bin'
 sbindir='${exec_prefix}/sbin'
 libexecdir='${exec_prefix}/libexec'
@@ -122,17 +314,9 @@
 infodir='${prefix}/info'
 mandir='${prefix}/man'
 
-# Initialize some other variables.
-subdirs=
-MFLAGS= MAKEFLAGS=
-SHELL=${CONFIG_SHELL-/bin/sh}
-# Maximum number of lines to put in a shell here document.
-ac_max_here_lines=12
-
 ac_prev=
 for ac_option
 do
-
   # If the previous option needs an argument, assign it.
   if test -n "$ac_prev"; then
     eval "$ac_prev=\$ac_option"
@@ -140,59 +324,59 @@
     continue
   fi
 
-  case "$ac_option" in
-  -*=*) ac_optarg=`echo "$ac_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
-  *) ac_optarg= ;;
-  esac
+  ac_optarg=`expr "x$ac_option" : 'x[^=]*=\(.*\)'`
 
   # Accept the important Cygnus configure options, so we can diagnose typos.
 
-  case "$ac_option" in
+  case $ac_option in
 
   -bindir | --bindir | --bindi | --bind | --bin | --bi)
     ac_prev=bindir ;;
   -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
-    bindir="$ac_optarg" ;;
+    bindir=$ac_optarg ;;
 
   -build | --build | --buil | --bui | --bu)
-    ac_prev=build ;;
+    ac_prev=build_alias ;;
   -build=* | --build=* | --buil=* | --bui=* | --bu=*)
-    build="$ac_optarg" ;;
+    build_alias=$ac_optarg ;;
 
   -cache-file | --cache-file | --cache-fil | --cache-fi \
   | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
     ac_prev=cache_file ;;
   -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
   | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
-    cache_file="$ac_optarg" ;;
+    cache_file=$ac_optarg ;;
+
+  --config-cache | -C)
+    cache_file=config.cache ;;
 
   -datadir | --datadir | --datadi | --datad | --data | --dat | --da)
     ac_prev=datadir ;;
   -datadir=* | --datadir=* | --datadi=* | --datad=* | --data=* | --dat=* \
   | --da=*)
-    datadir="$ac_optarg" ;;
+    datadir=$ac_optarg ;;
 
   -disable-* | --disable-*)
-    ac_feature=`echo $ac_option|sed -e 's/-*disable-//'`
+    ac_feature=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
     # Reject names that are not valid shell variable names.
-    if test -n "`echo $ac_feature| sed 's/[-a-zA-Z0-9_]//g'`"; then
-      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
-    fi
-    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
-    eval "enable_${ac_feature}=no" ;;
+    expr "x$ac_feature" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid feature name: $ac_feature" >&2
+   { (exit 1); exit 1; }; }
+    ac_feature=`echo $ac_feature | sed 's/-/_/g'`
+    eval "enable_$ac_feature=no" ;;
 
   -enable-* | --enable-*)
-    ac_feature=`echo $ac_option|sed -e 's/-*enable-//' -e 's/=.*//'`
+    ac_feature=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
-    if test -n "`echo $ac_feature| sed 's/[-_a-zA-Z0-9]//g'`"; then
-      { echo "configure: error: $ac_feature: invalid feature name" 1>&2; exit 1; }
-    fi
-    ac_feature=`echo $ac_feature| sed 's/-/_/g'`
-    case "$ac_option" in
-      *=*) ;;
+    expr "x$ac_feature" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid feature name: $ac_feature" >&2
+   { (exit 1); exit 1; }; }
+    ac_feature=`echo $ac_feature | sed 's/-/_/g'`
+    case $ac_option in
+      *=*) ac_optarg=`echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"`;;
       *) ac_optarg=yes ;;
     esac
-    eval "enable_${ac_feature}='$ac_optarg'" ;;
+    eval "enable_$ac_feature='$ac_optarg'" ;;
 
   -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
   | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
@@ -201,95 +385,47 @@
   -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
   | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
   | --exec=* | --exe=* | --ex=*)
-    exec_prefix="$ac_optarg" ;;
+    exec_prefix=$ac_optarg ;;
 
   -gas | --gas | --ga | --g)
     # Obsolete; use --with-gas.
     with_gas=yes ;;
 
-  -help | --help | --hel | --he)
-    # Omit some internal or obsolete options to make the list less imposing.
-    # This message is too long to be a string in the A/UX 3.1 sh.
-    cat << EOF
-Usage: configure [options] [host]
-Options: [defaults in brackets after descriptions]
-Configuration:
-  --cache-file=FILE       cache test results in FILE
-  --help                  print this message
-  --no-create             do not create output files
-  --quiet, --silent       do not print \`checking...' messages
-  --version               print the version of autoconf that created configure
-Directory and file names:
-  --prefix=PREFIX         install architecture-independent files in PREFIX
-                          [$ac_default_prefix]
-  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
-                          [same as prefix]
-  --bindir=DIR            user executables in DIR [EPREFIX/bin]
-  --sbindir=DIR           system admin executables in DIR [EPREFIX/sbin]
-  --libexecdir=DIR        program executables in DIR [EPREFIX/libexec]
-  --datadir=DIR           read-only architecture-independent data in DIR
-                          [PREFIX/share]
-  --sysconfdir=DIR        read-only single-machine data in DIR [PREFIX/etc]
-  --sharedstatedir=DIR    modifiable architecture-independent data in DIR
-                          [PREFIX/com]
-  --localstatedir=DIR     modifiable single-machine data in DIR [PREFIX/var]
-  --libdir=DIR            object code libraries in DIR [EPREFIX/lib]
-  --includedir=DIR        C header files in DIR [PREFIX/include]
-  --oldincludedir=DIR     C header files for non-gcc in DIR [/usr/include]
-  --infodir=DIR           info documentation in DIR [PREFIX/info]
-  --mandir=DIR            man documentation in DIR [PREFIX/man]
-  --srcdir=DIR            find the sources in DIR [configure dir or ..]
-  --program-prefix=PREFIX prepend PREFIX to installed program names
-  --program-suffix=SUFFIX append SUFFIX to installed program names
-  --program-transform-name=PROGRAM
-                          run sed PROGRAM on installed program names
-EOF
-    cat << EOF
-Host type:
-  --build=BUILD           configure for building on BUILD [BUILD=HOST]
-  --host=HOST             configure for HOST [guessed]
-  --target=TARGET         configure for TARGET [TARGET=HOST]
-Features and packages:
-  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
-  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
-  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
-  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
-  --x-includes=DIR        X include files are in DIR
-  --x-libraries=DIR       X library files are in DIR
-EOF
-    if test -n "$ac_help"; then
-      echo "--enable and --with options recognized:$ac_help"
-    fi
-    exit 0 ;;
+  -help | --help | --hel | --he | -h)
+    ac_init_help=long ;;
+  -help=r* | --help=r* | --hel=r* | --he=r* | -hr*)
+    ac_init_help=recursive ;;
+  -help=s* | --help=s* | --hel=s* | --he=s* | -hs*)
+    ac_init_help=short ;;
 
   -host | --host | --hos | --ho)
-    ac_prev=host ;;
+    ac_prev=host_alias ;;
   -host=* | --host=* | --hos=* | --ho=*)
-    host="$ac_optarg" ;;
+    host_alias=$ac_optarg ;;
 
   -includedir | --includedir | --includedi | --included | --include \
   | --includ | --inclu | --incl | --inc)
     ac_prev=includedir ;;
   -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
   | --includ=* | --inclu=* | --incl=* | --inc=*)
-    includedir="$ac_optarg" ;;
+    includedir=$ac_optarg ;;
 
   -infodir | --infodir | --infodi | --infod | --info | --inf)
     ac_prev=infodir ;;
   -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
-    infodir="$ac_optarg" ;;
+    infodir=$ac_optarg ;;
 
   -libdir | --libdir | --libdi | --libd)
     ac_prev=libdir ;;
   -libdir=* | --libdir=* | --libdi=* | --libd=*)
-    libdir="$ac_optarg" ;;
+    libdir=$ac_optarg ;;
 
   -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
   | --libexe | --libex | --libe)
     ac_prev=libexecdir ;;
   -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
   | --libexe=* | --libex=* | --libe=*)
-    libexecdir="$ac_optarg" ;;
+    libexecdir=$ac_optarg ;;
 
   -localstatedir | --localstatedir | --localstatedi | --localstated \
   | --localstate | --localstat | --localsta | --localst \
@@ -298,19 +434,19 @@
   -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
   | --localstate=* | --localstat=* | --localsta=* | --localst=* \
   | --locals=* | --local=* | --loca=* | --loc=* | --lo=*)
-    localstatedir="$ac_optarg" ;;
+    localstatedir=$ac_optarg ;;
 
   -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
     ac_prev=mandir ;;
   -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
-    mandir="$ac_optarg" ;;
+    mandir=$ac_optarg ;;
 
   -nfp | --nfp | --nf)
     # Obsolete; use --without-fp.
     with_fp=no ;;
 
   -no-create | --no-create | --no-creat | --no-crea | --no-cre \
-  | --no-cr | --no-c)
+  | --no-cr | --no-c | -n)
     no_create=yes ;;
 
   -no-recursion | --no-recursion | --no-recursio | --no-recursi \
@@ -324,26 +460,26 @@
   -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
   | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
   | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
-    oldincludedir="$ac_optarg" ;;
+    oldincludedir=$ac_optarg ;;
 
   -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
     ac_prev=prefix ;;
   -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
-    prefix="$ac_optarg" ;;
+    prefix=$ac_optarg ;;
 
   -program-prefix | --program-prefix | --program-prefi | --program-pref \
   | --program-pre | --program-pr | --program-p)
     ac_prev=program_prefix ;;
   -program-prefix=* | --program-prefix=* | --program-prefi=* \
   | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
-    program_prefix="$ac_optarg" ;;
+    program_prefix=$ac_optarg ;;
 
   -program-suffix | --program-suffix | --program-suffi | --program-suff \
   | --program-suf | --program-su | --program-s)
     ac_prev=program_suffix ;;
   -program-suffix=* | --program-suffix=* | --program-suffi=* \
   | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
-    program_suffix="$ac_optarg" ;;
+    program_suffix=$ac_optarg ;;
 
   -program-transform-name | --program-transform-name \
   | --program-transform-nam | --program-transform-na \
@@ -360,7 +496,7 @@
   | --program-transfo=* | --program-transf=* \
   | --program-trans=* | --program-tran=* \
   | --progr-tra=* | --program-tr=* | --program-t=*)
-    program_transform_name="$ac_optarg" ;;
+    program_transform_name=$ac_optarg ;;
 
   -q | -quiet | --quiet | --quie | --qui | --qu | --q \
   | -silent | --silent | --silen | --sile | --sil)
@@ -370,7 +506,7 @@
     ac_prev=sbindir ;;
   -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
   | --sbi=* | --sb=*)
-    sbindir="$ac_optarg" ;;
+    sbindir=$ac_optarg ;;
 
   -sharedstatedir | --sharedstatedir | --sharedstatedi \
   | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
@@ -381,58 +517,57 @@
   | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
   | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
   | --sha=* | --sh=*)
-    sharedstatedir="$ac_optarg" ;;
+    sharedstatedir=$ac_optarg ;;
 
   -site | --site | --sit)
     ac_prev=site ;;
   -site=* | --site=* | --sit=*)
-    site="$ac_optarg" ;;
+    site=$ac_optarg ;;
 
   -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
     ac_prev=srcdir ;;
   -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
-    srcdir="$ac_optarg" ;;
+    srcdir=$ac_optarg ;;
 
   -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
   | --syscon | --sysco | --sysc | --sys | --sy)
     ac_prev=sysconfdir ;;
   -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
   | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
-    sysconfdir="$ac_optarg" ;;
+    sysconfdir=$ac_optarg ;;
 
   -target | --target | --targe | --targ | --tar | --ta | --t)
-    ac_prev=target ;;
+    ac_prev=target_alias ;;
   -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
-    target="$ac_optarg" ;;
+    target_alias=$ac_optarg ;;
 
   -v | -verbose | --verbose | --verbos | --verbo | --verb)
     verbose=yes ;;
 
-  -version | --version | --versio | --versi | --vers)
-    echo "configure generated by autoconf version 2.13"
-    exit 0 ;;
+  -version | --version | --versio | --versi | --vers | -V)
+    ac_init_version=: ;;
 
   -with-* | --with-*)
-    ac_package=`echo $ac_option|sed -e 's/-*with-//' -e 's/=.*//'`
+    ac_package=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
     # Reject names that are not valid shell variable names.
-    if test -n "`echo $ac_package| sed 's/[-_a-zA-Z0-9]//g'`"; then
-      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
-    fi
+    expr "x$ac_package" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid package name: $ac_package" >&2
+   { (exit 1); exit 1; }; }
     ac_package=`echo $ac_package| sed 's/-/_/g'`
-    case "$ac_option" in
-      *=*) ;;
+    case $ac_option in
+      *=*) ac_optarg=`echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"`;;
       *) ac_optarg=yes ;;
     esac
-    eval "with_${ac_package}='$ac_optarg'" ;;
+    eval "with_$ac_package='$ac_optarg'" ;;
 
   -without-* | --without-*)
-    ac_package=`echo $ac_option|sed -e 's/-*without-//'`
+    ac_package=`expr "x$ac_option" : 'x-*without-\(.*\)'`
     # Reject names that are not valid shell variable names.
-    if test -n "`echo $ac_package| sed 's/[-a-zA-Z0-9_]//g'`"; then
-      { echo "configure: error: $ac_package: invalid package name" 1>&2; exit 1; }
-    fi
-    ac_package=`echo $ac_package| sed 's/-/_/g'`
-    eval "with_${ac_package}=no" ;;
+    expr "x$ac_package" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid package name: $ac_package" >&2
+   { (exit 1); exit 1; }; }
+    ac_package=`echo $ac_package | sed 's/-/_/g'`
+    eval "with_$ac_package=no" ;;
 
   --x)
     # Obsolete; use --with-x.
@@ -443,99 +578,110 @@
     ac_prev=x_includes ;;
   -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
   | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
-    x_includes="$ac_optarg" ;;
+    x_includes=$ac_optarg ;;
 
   -x-libraries | --x-libraries | --x-librarie | --x-librari \
   | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
     ac_prev=x_libraries ;;
   -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
   | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
-    x_libraries="$ac_optarg" ;;
+    x_libraries=$ac_optarg ;;
 
-  -*) { echo "configure: error: $ac_option: invalid option; use --help to show usage" 1>&2; exit 1; }
+  -*) { echo "$as_me: error: unrecognized option: $ac_option
+Try \`$0 --help' for more information." >&2
+   { (exit 1); exit 1; }; }
     ;;
 
+  *=*)
+    ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_envvar" : ".*[^_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid variable name: $ac_envvar" >&2
+   { (exit 1); exit 1; }; }
+    ac_optarg=`echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"`
+    eval "$ac_envvar='$ac_optarg'"
+    export $ac_envvar ;;
+
   *)
-    if test -n "`echo $ac_option| sed 's/[-a-z0-9.]//g'`"; then
-      echo "configure: warning: $ac_option: invalid host type" 1>&2
-    fi
-    if test "x$nonopt" != xNONE; then
-      { echo "configure: error: can only configure for one host and one target at a time" 1>&2; exit 1; }
-    fi
-    nonopt="$ac_option"
+    # FIXME: should be removed in autoconf 3.0.
+    echo "$as_me: WARNING: you should use --build, --host, --target" >&2
+    expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
+      echo "$as_me: WARNING: invalid host type: $ac_option" >&2
+    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
     ;;
 
   esac
 done
 
 if test -n "$ac_prev"; then
-  { echo "configure: error: missing argument to --`echo $ac_prev | sed 's/_/-/g'`" 1>&2; exit 1; }
-fi
-
-trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
-
-# File descriptor usage:
-# 0 standard input
-# 1 file creation
-# 2 errors and warnings
-# 3 some systems may open it to /dev/tty
-# 4 used on the Kubota Titan
-# 6 checking for... messages and results
-# 5 compiler messages saved in config.log
-if test "$silent" = yes; then
-  exec 6>/dev/null
-else
-  exec 6>&1
+  ac_option=--`echo $ac_prev | sed 's/_/-/g'`
+  { echo "$as_me: error: missing argument to $ac_option" >&2
+   { (exit 1); exit 1; }; }
 fi
-exec 5>./config.log
 
-echo "\
-This file contains any messages produced by compilers while
-running configure, to aid debugging if configure makes a mistake.
-" 1>&5
+# Be sure to have absolute paths.
+for ac_var in exec_prefix prefix
+do
+  eval ac_val=$`echo $ac_var`
+  case $ac_val in
+    [\\/$]* | ?:[\\/]* | NONE | '' ) ;;
+    *)  { echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
+   { (exit 1); exit 1; }; };;
+  esac
+done
 
-# Strip out --no-create and --no-recursion so they do not pile up.
-# Also quote any args containing shell metacharacters.
-ac_configure_args=
-for ac_arg
+# Be sure to have absolute paths.
+for ac_var in bindir sbindir libexecdir datadir sysconfdir sharedstatedir \
+	      localstatedir libdir includedir oldincludedir infodir mandir
 do
-  case "$ac_arg" in
-  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
-  | --no-cr | --no-c) ;;
-  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
-  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r) ;;
-  *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?]*)
-  ac_configure_args="$ac_configure_args '$ac_arg'" ;;
-  *) ac_configure_args="$ac_configure_args $ac_arg" ;;
+  eval ac_val=$`echo $ac_var`
+  case $ac_val in
+    [\\/$]* | ?:[\\/]* ) ;;
+    *)  { echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
+   { (exit 1); exit 1; }; };;
   esac
 done
 
-# NLS nuisances.
-# Only set these to C if already set.  These must not be set unconditionally
-# because not all systems understand e.g. LANG=C (notably SCO).
-# Fixing LC_MESSAGES prevents Solaris sh from translating var values in `set'!
-# Non-C LC_CTYPE values break the ctype check.
-if test "${LANG+set}"   = set; then LANG=C;   export LANG;   fi
-if test "${LC_ALL+set}" = set; then LC_ALL=C; export LC_ALL; fi
-if test "${LC_MESSAGES+set}" = set; then LC_MESSAGES=C; export LC_MESSAGES; fi
-if test "${LC_CTYPE+set}"    = set; then LC_CTYPE=C;    export LC_CTYPE;    fi
+# There might be people who depend on the old broken behavior: `$host'
+# used to hold the argument of --host etc.
+# FIXME: To remove some day.
+build=$build_alias
+host=$host_alias
+target=$target_alias
+
+# FIXME: To remove some day.
+if test "x$host_alias" != x; then
+  if test "x$build_alias" = x; then
+    cross_compiling=maybe
+    echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
+    If a cross compiler is detected then cross compile mode will be used." >&2
+  elif test "x$build_alias" != "x$host_alias"; then
+    cross_compiling=yes
+  fi
+fi
 
-# confdefs.h avoids OS command line length limits that DEFS can exceed.
-rm -rf conftest* confdefs.h
-# AIX cpp loses on an empty file, so make sure it contains at least a newline.
-echo > confdefs.h
+ac_tool_prefix=
+test -n "$host_alias" && ac_tool_prefix=$host_alias-
+
+test "$silent" = yes && exec 6>/dev/null
 
-# A filename unique to this package, relative to the directory that
-# configure is in, which we can look for to find out if srcdir is correct.
-ac_unique_file=src/blob/start.S
 
 # Find the source files, if location was not specified.
 if test -z "$srcdir"; then
   ac_srcdir_defaulted=yes
   # Try the directory containing this script, then its parent.
-  ac_prog=$0
-  ac_confdir=`echo $ac_prog|sed 's%/[^/][^/]*$%%'`
-  test "x$ac_confdir" = "x$ac_prog" && ac_confdir=.
+  ac_confdir=`(dirname "$0") 2>/dev/null ||
+$as_expr X"$0" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$0" : 'X\(//\)[^/]' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$0" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
   srcdir=$ac_confdir
   if test ! -r $srcdir/$ac_unique_file; then
     srcdir=..
@@ -545,13 +691,532 @@
 fi
 if test ! -r $srcdir/$ac_unique_file; then
   if test "$ac_srcdir_defaulted" = yes; then
-    { echo "configure: error: can not find sources in $ac_confdir or .." 1>&2; exit 1; }
+    { echo "$as_me: error: cannot find sources ($ac_unique_file) in $ac_confdir or .." >&2
+   { (exit 1); exit 1; }; }
   else
-    { echo "configure: error: can not find sources in $srcdir" 1>&2; exit 1; }
+    { echo "$as_me: error: cannot find sources ($ac_unique_file) in $srcdir" >&2
+   { (exit 1); exit 1; }; }
   fi
 fi
-srcdir=`echo "${srcdir}" | sed 's%\([^/]\)/*$%\1%'`
+(cd $srcdir && test -r ./$ac_unique_file) 2>/dev/null ||
+  { echo "$as_me: error: sources are in $srcdir, but \`cd $srcdir' does not work" >&2
+   { (exit 1); exit 1; }; }
+srcdir=`echo "$srcdir" | sed 's%\([^\\/]\)[\\/]*$%\1%'`
+ac_env_build_alias_set=${build_alias+set}
+ac_env_build_alias_value=$build_alias
+ac_cv_env_build_alias_set=${build_alias+set}
+ac_cv_env_build_alias_value=$build_alias
+ac_env_host_alias_set=${host_alias+set}
+ac_env_host_alias_value=$host_alias
+ac_cv_env_host_alias_set=${host_alias+set}
+ac_cv_env_host_alias_value=$host_alias
+ac_env_target_alias_set=${target_alias+set}
+ac_env_target_alias_value=$target_alias
+ac_cv_env_target_alias_set=${target_alias+set}
+ac_cv_env_target_alias_value=$target_alias
+ac_env_CC_set=${CC+set}
+ac_env_CC_value=$CC
+ac_cv_env_CC_set=${CC+set}
+ac_cv_env_CC_value=$CC
+ac_env_CFLAGS_set=${CFLAGS+set}
+ac_env_CFLAGS_value=$CFLAGS
+ac_cv_env_CFLAGS_set=${CFLAGS+set}
+ac_cv_env_CFLAGS_value=$CFLAGS
+ac_env_LDFLAGS_set=${LDFLAGS+set}
+ac_env_LDFLAGS_value=$LDFLAGS
+ac_cv_env_LDFLAGS_set=${LDFLAGS+set}
+ac_cv_env_LDFLAGS_value=$LDFLAGS
+ac_env_CPPFLAGS_set=${CPPFLAGS+set}
+ac_env_CPPFLAGS_value=$CPPFLAGS
+ac_cv_env_CPPFLAGS_set=${CPPFLAGS+set}
+ac_cv_env_CPPFLAGS_value=$CPPFLAGS
+ac_env_CCAS_set=${CCAS+set}
+ac_env_CCAS_value=$CCAS
+ac_cv_env_CCAS_set=${CCAS+set}
+ac_cv_env_CCAS_value=$CCAS
+ac_env_CCASFLAGS_set=${CCASFLAGS+set}
+ac_env_CCASFLAGS_value=$CCASFLAGS
+ac_cv_env_CCASFLAGS_set=${CCASFLAGS+set}
+ac_cv_env_CCASFLAGS_value=$CCASFLAGS
+
+#
+# Report the --help message.
+#
+if test "$ac_init_help" = "long"; then
+  # Omit some internal or obsolete options to make the list less imposing.
+  # This message is too long to be a string in the A/UX 3.1 sh.
+  cat <<_ACEOF
+\`configure' configures this package to adapt to many kinds of systems.
+
+Usage: $0 [OPTION]... [VAR=VALUE]...
+
+To assign environment variables (e.g., CC, CFLAGS...), specify them as
+VAR=VALUE.  See below for descriptions of some of the useful variables.
+
+Defaults for the options are specified in brackets.
+
+Configuration:
+  -h, --help              display this help and exit
+      --help=short        display options specific to this package
+      --help=recursive    display the short help of all the included packages
+  -V, --version           display version information and exit
+  -q, --quiet, --silent   do not print \`checking...' messages
+      --cache-file=FILE   cache test results in FILE [disabled]
+  -C, --config-cache      alias for \`--cache-file=config.cache'
+  -n, --no-create         do not create output files
+      --srcdir=DIR        find the sources in DIR [configure dir or \`..']
+
+_ACEOF
+
+  cat <<_ACEOF
+Installation directories:
+  --prefix=PREFIX         install architecture-independent files in PREFIX
+			  [$ac_default_prefix]
+  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
+			  [PREFIX]
+
+By default, \`make install' will install all the files in
+\`$ac_default_prefix/bin', \`$ac_default_prefix/lib' etc.  You can specify
+an installation prefix other than \`$ac_default_prefix' using \`--prefix',
+for instance \`--prefix=\$HOME'.
+
+For better control, use the options below.
+
+Fine tuning of the installation directories:
+  --bindir=DIR           user executables [EPREFIX/bin]
+  --sbindir=DIR          system admin executables [EPREFIX/sbin]
+  --libexecdir=DIR       program executables [EPREFIX/libexec]
+  --datadir=DIR          read-only architecture-independent data [PREFIX/share]
+  --sysconfdir=DIR       read-only single-machine data [PREFIX/etc]
+  --sharedstatedir=DIR   modifiable architecture-independent data [PREFIX/com]
+  --localstatedir=DIR    modifiable single-machine data [PREFIX/var]
+  --libdir=DIR           object code libraries [EPREFIX/lib]
+  --includedir=DIR       C header files [PREFIX/include]
+  --oldincludedir=DIR    C header files for non-gcc [/usr/include]
+  --infodir=DIR          info documentation [PREFIX/info]
+  --mandir=DIR           man documentation [PREFIX/man]
+_ACEOF
+
+  cat <<\_ACEOF
+
+Program names:
+  --program-prefix=PREFIX            prepend PREFIX to installed program names
+  --program-suffix=SUFFIX            append SUFFIX to installed program names
+  --program-transform-name=PROGRAM   run sed PROGRAM on installed program names
+
+System types:
+  --build=BUILD     configure for building on BUILD [guessed]
+  --host=HOST       cross-compile to build programs to run on HOST [BUILD]
+_ACEOF
+fi
+
+if test -n "$ac_init_help"; then
+
+  cat <<\_ACEOF
+
+Optional Features:
+  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
+  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --enable-maintainer-mode  enable make rules and dependencies not useful
+			  (and sometimes confusing) to the casual installer
+  --disable-dependency-tracking  speeds up one-time build
+  --enable-dependency-tracking   do not reject slow dependency extractors
+  --enable-xlli  Use XLLI as start code
+  --enable-usbdnet  Use USBDNET as ethernet driver
+  --enable-clock-scaling  Enable support for clock scaling (SA1100 only)
+  --enable-memtest        Enable support for memory tests
+  --enable-lcd            Enable lcd support
+  --enable-md5            Enable md5 support
+  --enable-xmodem         Enable Xmodem support
+  --enable-usbserial      Enable serial over USB support
+  --enable-uucodec        Enable UU Codec support
+  --enable-jffs2          Enable support for loading kernel from jffs2
+  --enable-cramfs         Enable support for loading kernel from cramfs
+  --enable-zimage         Enable support for loading zImage directly from flash
+  --enable-network         Enable networking (bootp/tftp)
+  --enable-gio         Enable generic IO (sysupd command)
+  --enable-all-features   Enable all features
+  --enable-blob-debug     Enable run-time debug information
+
+Optional Packages:
+  --with-PACKAGE[=ARG]    use PACKAGE [ARG=yes]
+  --without-PACKAGE       do not use PACKAGE (same as --with-PACKAGE=no)
+  --with-board=NAME       Name of the target board
+                          Valid names are:
+                            accelent_sa  Accelent IDP
+                            assabet      Intel Assabet
+                            badge4       HPL Badge 4
+                            brutus       Intel Brutus
+                            cep          Iskratel CEP
+                            creditlart   CreditLART
+                            csir_ims     CSIR Incident Management System
+                            dafit        Prueftechnik VibXpert
+                            frodo        2d3D, Inc. SA-1110 Development Board
+                            h3600        Compaq Ipaq H36x0
+                            hackkit      The Hack Kit base board
+                            idr          Vercel UD-1
+                            jornada720   HP Jornada 720 with Flash board
+                            lart         LART
+                            lubbock      Intel HCDDBCTA1 (Lubbock)
+                            mainstone    Intel HCDDBBVA0 (Mainstone)
+                            miniprint    FGAG Miniprint
+                            neponset     Intel Assabet with Neponset board
+                            nesa         NESA
+                            pleb         PLEB
+                            pxa_idp      Accelent PXA-based IDP
+                            ramses       M&N "MN-CI" Logistics Terminal
+                            shannon      TuxScreen (Shannon)
+                            smdk2500     Samsung s3c2500a Evaluation Board
+                            system3      Prueftechnik Digital Board
+                            trizeps      Keith & Koep Trizeps Board
+                          Default board is lart
+  --with-linux-prefix=PFX Prefix where the ARM Linux sources live
+  --with-commands=<list>  compile blob with commands in <list>
+                          commands may be separated with commas;
+                          'all' compiles all commands;
+                          Valid commands are:
+                           bogomips, call, chgbit, dummy, dump, md5chk, memcpy, poke, peek
+  --with-kernel-xip=Kernel XIP address
+
+Some influential environment variables:
+  CC          C compiler command
+  CFLAGS      C compiler flags
+  LDFLAGS     linker flags, e.g. -L<lib dir> if you have libraries in a
+              nonstandard directory <lib dir>
+  CPPFLAGS    C/C++ preprocessor flags, e.g. -I<include dir> if you have
+              headers in a nonstandard directory <include dir>
+  CCAS        assembler compiler command (defaults to CC)
+  CCASFLAGS   assembler compiler flags (defaults to CFLAGS)
+
+Use these variables to override the choices made by `configure' or to help
+it to find libraries and programs with nonstandard names/locations.
+
+_ACEOF
+fi
+
+if test "$ac_init_help" = "recursive"; then
+  # If there are subdirs, report their specific --help.
+  ac_popdir=`pwd`
+  for ac_dir in : $ac_subdirs_all; do test "x$ac_dir" = x: && continue
+    test -d $ac_dir || continue
+    ac_builddir=.
+
+if test "$ac_dir" != .; then
+  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  # A "../" for each directory in $ac_dir_suffix.
+  ac_top_builddir=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,../,g'`
+else
+  ac_dir_suffix= ac_top_builddir=
+fi
+
+case $srcdir in
+  .)  # No --srcdir option.  We are building in place.
+    ac_srcdir=.
+    if test -z "$ac_top_builddir"; then
+       ac_top_srcdir=.
+    else
+       ac_top_srcdir=`echo $ac_top_builddir | sed 's,/$,,'`
+    fi ;;
+  [\\/]* | ?:[\\/]* )  # Absolute path.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir ;;
+  *) # Relative path.
+    ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_builddir$srcdir ;;
+esac
+
+# Do not use `cd foo && pwd` to compute absolute paths, because
+# the directories may not exist.
+case `pwd` in
+.) ac_abs_builddir="$ac_dir";;
+*)
+  case "$ac_dir" in
+  .) ac_abs_builddir=`pwd`;;
+  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
+  *) ac_abs_builddir=`pwd`/"$ac_dir";;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_builddir=${ac_top_builddir}.;;
+*)
+  case ${ac_top_builddir}. in
+  .) ac_abs_top_builddir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
+  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_srcdir=$ac_srcdir;;
+*)
+  case $ac_srcdir in
+  .) ac_abs_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
+  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_srcdir=$ac_top_srcdir;;
+*)
+  case $ac_top_srcdir in
+  .) ac_abs_top_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
+  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
+  esac;;
+esac
+
+    cd $ac_dir
+    # Check for guested configure; otherwise get Cygnus style configure.
+    if test -f $ac_srcdir/configure.gnu; then
+      echo
+      $SHELL $ac_srcdir/configure.gnu  --help=recursive
+    elif test -f $ac_srcdir/configure; then
+      echo
+      $SHELL $ac_srcdir/configure  --help=recursive
+    elif test -f $ac_srcdir/configure.ac ||
+	   test -f $ac_srcdir/configure.in; then
+      echo
+      $ac_configure --help
+    else
+      echo "$as_me: WARNING: no configuration information is in $ac_dir" >&2
+    fi
+    cd $ac_popdir
+  done
+fi
+
+test -n "$ac_init_help" && exit 0
+if $ac_init_version; then
+  cat <<\_ACEOF
+
+Copyright (C) 2003 Free Software Foundation, Inc.
+This configure script is free software; the Free Software Foundation
+gives unlimited permission to copy, distribute and modify it.
+_ACEOF
+  exit 0
+fi
+exec 5>config.log
+cat >&5 <<_ACEOF
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+
+It was created by $as_me, which was
+generated by GNU Autoconf 2.59.  Invocation command line was
+
+  $ $0 $@
+
+_ACEOF
+{
+cat <<_ASUNAME
+## --------- ##
+## Platform. ##
+## --------- ##
+
+hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+
+/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
+hostinfo               = `(hostinfo) 2>/dev/null               || echo unknown`
+/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
+/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+
+_ASUNAME
+
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  echo "PATH: $as_dir"
+done
+
+} >&5
+
+cat >&5 <<_ACEOF
+
+
+## ----------- ##
+## Core tests. ##
+## ----------- ##
+
+_ACEOF
+
+
+# Keep a trace of the command line.
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Strip out --silent because we don't want to record it for future runs.
+# Also quote any args containing shell meta-characters.
+# Make two passes to allow for proper duplicate-argument suppression.
+ac_configure_args=
+ac_configure_args0=
+ac_configure_args1=
+ac_sep=
+ac_must_keep_next=false
+for ac_pass in 1 2
+do
+  for ac_arg
+  do
+    case $ac_arg in
+    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
+    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+    | -silent | --silent | --silen | --sile | --sil)
+      continue ;;
+    *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?\"\']*)
+      ac_arg=`echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    case $ac_pass in
+    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
+    2)
+      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
+      if test $ac_must_keep_next = true; then
+	ac_must_keep_next=false # Got value, back to normal.
+      else
+	case $ac_arg in
+	  *=* | --config-cache | -C | -disable-* | --disable-* \
+	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
+	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
+	  | -with-* | --with-* | -without-* | --without-* | --x)
+	    case "$ac_configure_args0 " in
+	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
+	    esac
+	    ;;
+	  -* ) ac_must_keep_next=true ;;
+	esac
+      fi
+      ac_configure_args="$ac_configure_args$ac_sep'$ac_arg'"
+      # Get rid of the leading space.
+      ac_sep=" "
+      ;;
+    esac
+  done
+done
+$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
+$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
 
+# When interrupted or exit'd, cleanup temporary files, and complete
+# config.log.  We remove comments because anyway the quotes in there
+# would cause problems or look ugly.
+# WARNING: Be sure not to use single quotes in there, as some shells,
+# such as our DU 5.0 friend, will then `close' the trap.
+trap 'exit_status=$?
+  # Save into config.log some information that might help in debugging.
+  {
+    echo
+
+    cat <<\_ASBOX
+## ---------------- ##
+## Cache variables. ##
+## ---------------- ##
+_ASBOX
+    echo
+    # The following way of writing the cache mishandles newlines in values,
+{
+  (set) 2>&1 |
+    case `(ac_space='"'"' '"'"'; set | grep ac_space) 2>&1` in
+    *ac_space=\ *)
+      sed -n \
+	"s/'"'"'/'"'"'\\\\'"'"''"'"'/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='"'"'\\2'"'"'/p"
+      ;;
+    *)
+      sed -n \
+	"s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
+      ;;
+    esac;
+}
+    echo
+
+    cat <<\_ASBOX
+## ----------------- ##
+## Output variables. ##
+## ----------------- ##
+_ASBOX
+    echo
+    for ac_var in $ac_subst_vars
+    do
+      eval ac_val=$`echo $ac_var`
+      echo "$ac_var='"'"'$ac_val'"'"'"
+    done | sort
+    echo
+
+    if test -n "$ac_subst_files"; then
+      cat <<\_ASBOX
+## ------------- ##
+## Output files. ##
+## ------------- ##
+_ASBOX
+      echo
+      for ac_var in $ac_subst_files
+      do
+	eval ac_val=$`echo $ac_var`
+	echo "$ac_var='"'"'$ac_val'"'"'"
+      done | sort
+      echo
+    fi
+
+    if test -s confdefs.h; then
+      cat <<\_ASBOX
+## ----------- ##
+## confdefs.h. ##
+## ----------- ##
+_ASBOX
+      echo
+      sed "/^$/d" confdefs.h | sort
+      echo
+    fi
+    test "$ac_signal" != 0 &&
+      echo "$as_me: caught signal $ac_signal"
+    echo "$as_me: exit $exit_status"
+  } >&5
+  rm -f core *.core &&
+  rm -rf conftest* confdefs* conf$$* $ac_clean_files &&
+    exit $exit_status
+     ' 0
+for ac_signal in 1 2 13 15; do
+  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
+done
+ac_signal=0
+
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -rf conftest* confdefs.h
+# AIX cpp loses on an empty file, so make sure it contains at least a newline.
+echo >confdefs.h
+
+# Predefined preprocessor variables.
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_NAME "$PACKAGE_NAME"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_VERSION "$PACKAGE_VERSION"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_STRING "$PACKAGE_STRING"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
+_ACEOF
+
+
+# Let the site file select an alternate cache file if it wants to.
 # Prefer explicitly selected file to automatically selected ones.
 if test -z "$CONFIG_SITE"; then
   if test "x$prefix" != xNONE; then
@@ -562,39 +1227,103 @@
 fi
 for ac_site_file in $CONFIG_SITE; do
   if test -r "$ac_site_file"; then
-    echo "loading site script $ac_site_file"
+    { echo "$as_me:$LINENO: loading site script $ac_site_file" >&5
+echo "$as_me: loading site script $ac_site_file" >&6;}
+    sed 's/^/| /' "$ac_site_file" >&5
     . "$ac_site_file"
   fi
 done
 
 if test -r "$cache_file"; then
-  echo "loading cache $cache_file"
-  . $cache_file
+  # Some versions of bash will fail to source /dev/null (special
+  # files actually), so we avoid doing that.
+  if test -f "$cache_file"; then
+    { echo "$as_me:$LINENO: loading cache $cache_file" >&5
+echo "$as_me: loading cache $cache_file" >&6;}
+    case $cache_file in
+      [\\/]* | ?:[\\/]* ) . $cache_file;;
+      *)                      . ./$cache_file;;
+    esac
+  fi
 else
-  echo "creating cache $cache_file"
-  > $cache_file
+  { echo "$as_me:$LINENO: creating cache $cache_file" >&5
+echo "$as_me: creating cache $cache_file" >&6;}
+  >$cache_file
+fi
+
+# Check that the precious variables saved in the cache have kept the same
+# value.
+ac_cache_corrupted=false
+for ac_var in `(set) 2>&1 |
+	       sed -n 's/^ac_env_\([a-zA-Z_0-9]*\)_set=.*/\1/p'`; do
+  eval ac_old_set=\$ac_cv_env_${ac_var}_set
+  eval ac_new_set=\$ac_env_${ac_var}_set
+  eval ac_old_val="\$ac_cv_env_${ac_var}_value"
+  eval ac_new_val="\$ac_env_${ac_var}_value"
+  case $ac_old_set,$ac_new_set in
+    set,)
+      { echo "$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,set)
+      { echo "$as_me:$LINENO: error: \`$ac_var' was not set in the previous run" >&5
+echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,);;
+    *)
+      if test "x$ac_old_val" != "x$ac_new_val"; then
+	{ echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
+echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
+	{ echo "$as_me:$LINENO:   former value:  $ac_old_val" >&5
+echo "$as_me:   former value:  $ac_old_val" >&2;}
+	{ echo "$as_me:$LINENO:   current value: $ac_new_val" >&5
+echo "$as_me:   current value: $ac_new_val" >&2;}
+	ac_cache_corrupted=:
+      fi;;
+  esac
+  # Pass precious variables to config.status.
+  if test "$ac_new_set" = set; then
+    case $ac_new_val in
+    *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?\"\']*)
+      ac_arg=$ac_var=`echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
+    *) ac_arg=$ac_var=$ac_new_val ;;
+    esac
+    case " $ac_configure_args " in
+      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
+      *) ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+    esac
+  fi
+done
+if $ac_cache_corrupted; then
+  { echo "$as_me:$LINENO: error: changes in the environment can compromise the build" >&5
+echo "$as_me: error: changes in the environment can compromise the build" >&2;}
+  { { echo "$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
+echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
+   { (exit 1); exit 1; }; }
 fi
 
 ac_ext=c
-# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
 ac_cpp='$CPP $CPPFLAGS'
-ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
-ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
-cross_compiling=$ac_cv_prog_cc_cross
-
-ac_exeext=
-ac_objext=o
-if (echo "testing\c"; echo 1,2,3) | grep c >/dev/null; then
-  # Stardent Vistra SVR4 grep lacks -e, says ghazi@caip.rutgers.edu.
-  if (echo -n testing; echo 1,2,3) | sed s/-n/xn/ | grep xn >/dev/null; then
-    ac_n= ac_c='
-' ac_t='	'
-  else
-    ac_n=-n ac_c= ac_t=
-  fi
-else
-  ac_n= ac_c='\c' ac_t=
-fi
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
 
 
 ac_aux_dir=
@@ -607,14 +1336,20 @@
     ac_aux_dir=$ac_dir
     ac_install_sh="$ac_aux_dir/install.sh -c"
     break
+  elif test -f $ac_dir/shtool; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/shtool install -c"
+    break
   fi
 done
 if test -z "$ac_aux_dir"; then
-  { echo "configure: error: can not find install-sh or install.sh in tools $srcdir/tools" 1>&2; exit 1; }
-fi
-ac_config_guess=$ac_aux_dir/config.guess
-ac_config_sub=$ac_aux_dir/config.sub
-ac_configure=$ac_aux_dir/configure # This should be Cygnus configure.
+  { { echo "$as_me:$LINENO: error: cannot find install-sh or install.sh in tools $srcdir/tools" >&5
+echo "$as_me: error: cannot find install-sh or install.sh in tools $srcdir/tools" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+ac_config_guess="$SHELL $ac_aux_dir/config.guess"
+ac_config_sub="$SHELL $ac_aux_dir/config.sub"
+ac_configure="$SHELL $ac_aux_dir/configure" # This should be Cygnus configure.
 
 
 
@@ -623,10 +1358,11 @@
 PACKAGE=blob
 BLOB_MAJOR_VERSION=2
 BLOB_MINOR_VERSION=0
-BLOB_MICRO_VERSION=5-pre2
+BLOB_MICRO_VERSION=5-pre3
 BLOB_VERSION=$BLOB_MAJOR_VERSION.$BLOB_MINOR_VERSION.$BLOB_MICRO_VERSION
 VERSION=$BLOB_VERSION
 
+am__api_version="1.8"
 # Find a good install program.  We prefer a C program (faster),
 # so one script is as good as another.  But avoid the broken or
 # incompatible versions:
@@ -634,250 +1370,415 @@
 # SunOS /usr/etc/install
 # IRIX /sbin/install
 # AIX /bin/install
+# AmigaOS /C/install, which installs bootblocks on floppy discs
 # AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
 # AFS /usr/afsws/bin/install, which mishandles nonexistent args
 # SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
+# OS/2's system install, which has a completely different semantic
 # ./install, which can be erroneously created by make from ./install.sh.
-echo $ac_n "checking for a BSD compatible install""... $ac_c" 1>&6
-echo "configure:643: checking for a BSD compatible install" >&5
+echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
+echo $ECHO_N "checking for a BSD-compatible install... $ECHO_C" >&6
 if test -z "$INSTALL"; then
-if eval "test \"`echo '$''{'ac_cv_path_install'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+if test "${ac_cv_path_install+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-    IFS="${IFS= 	}"; ac_save_IFS="$IFS"; IFS=":"
-  for ac_dir in $PATH; do
-    # Account for people who put trailing slashes in PATH elements.
-    case "$ac_dir/" in
-    /|./|.//|/etc/*|/usr/sbin/*|/usr/etc/*|/sbin/*|/usr/afsws/bin/*|/usr/ucb/*) ;;
-    *)
-      # OSF1 and SCO ODT 3.0 have their own names for install.
-      # Don't use installbsd from OSF since it installs stuff as root
-      # by default.
-      for ac_prog in ginstall scoinst install; do
-        if test -f $ac_dir/$ac_prog; then
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in
+  ./ | .// | /cC/* | \
+  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
+  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
+  /usr/ucb/* ) ;;
+  *)
+    # OSF1 and SCO ODT 3.0 have their own names for install.
+    # Don't use installbsd from OSF since it installs stuff as root
+    # by default.
+    for ac_prog in ginstall scoinst install; do
+      for ac_exec_ext in '' $ac_executable_extensions; do
+	if $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
-            grep dspmsg $ac_dir/$ac_prog >/dev/null 2>&1; then
+	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
 	    :
+	  elif test $ac_prog = install &&
+	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # program-specific install script used by HP pwplus--don't use.
+	    :
 	  else
-	    ac_cv_path_install="$ac_dir/$ac_prog -c"
-	    break 2
+	    ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+	    break 3
 	  fi
 	fi
       done
-      ;;
-    esac
-  done
-  IFS="$ac_save_IFS"
+    done
+    ;;
+esac
+done
+
 
 fi
   if test "${ac_cv_path_install+set}" = set; then
-    INSTALL="$ac_cv_path_install"
+    INSTALL=$ac_cv_path_install
   else
     # As a last resort, use the slow shell script.  We don't cache a
     # path for INSTALL within a source directory, because that will
     # break other packages using the cache if that directory is
     # removed, or if the path is relative.
-    INSTALL="$ac_install_sh"
+    INSTALL=$ac_install_sh
   fi
 fi
-echo "$ac_t""$INSTALL" 1>&6
+echo "$as_me:$LINENO: result: $INSTALL" >&5
+echo "${ECHO_T}$INSTALL" >&6
 
 # Use test -z because SunOS4 sh mishandles braces in ${var-val}.
 # It thinks the first close brace ends the variable substitution.
 test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
 
-test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL_PROGRAM}'
+test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
 
 test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
-echo $ac_n "checking whether build environment is sane""... $ac_c" 1>&6
-echo "configure:696: checking whether build environment is sane" >&5
+echo "$as_me:$LINENO: checking whether build environment is sane" >&5
+echo $ECHO_N "checking whether build environment is sane... $ECHO_C" >&6
 # Just in case
 sleep 1
-echo timestamp > conftestfile
+echo timestamp > conftest.file
 # Do `set' in a subshell so we don't clobber the current shell's
 # arguments.  Must try -L first in case configure is actually a
 # symlink; some systems play weird games with the mod time of symlinks
 # (eg FreeBSD returns the mod time of the symlink's containing
 # directory).
 if (
-   set X `ls -Lt $srcdir/configure conftestfile 2> /dev/null`
+   set X `ls -Lt $srcdir/configure conftest.file 2> /dev/null`
    if test "$*" = "X"; then
       # -L didn't work.
-      set X `ls -t $srcdir/configure conftestfile`
+      set X `ls -t $srcdir/configure conftest.file`
    fi
-   if test "$*" != "X $srcdir/configure conftestfile" \
-      && test "$*" != "X conftestfile $srcdir/configure"; then
+   rm -f conftest.file
+   if test "$*" != "X $srcdir/configure conftest.file" \
+      && test "$*" != "X conftest.file $srcdir/configure"; then
 
       # If neither matched, then we have a broken ls.  This can happen
       # if, for instance, CONFIG_SHELL is bash and it inherits a
       # broken ls alias from the environment.  This has actually
       # happened.  Such a system could not be considered "sane".
-      { echo "configure: error: ls -t appears to fail.  Make sure there is not a broken
-alias in your environment" 1>&2; exit 1; }
+      { { echo "$as_me:$LINENO: error: ls -t appears to fail.  Make sure there is not a broken
+alias in your environment" >&5
+echo "$as_me: error: ls -t appears to fail.  Make sure there is not a broken
+alias in your environment" >&2;}
+   { (exit 1); exit 1; }; }
    fi
 
-   test "$2" = conftestfile
+   test "$2" = conftest.file
    )
 then
    # Ok.
    :
 else
-   { echo "configure: error: newly created file is older than distributed files!
-Check your system clock" 1>&2; exit 1; }
-fi
-rm -f conftest*
-echo "$ac_t""yes" 1>&6
-if test "$program_transform_name" = s,x,x,; then
-  program_transform_name=
-else
-  # Double any \ or $.  echo might interpret backslashes.
-  cat <<\EOF_SED > conftestsed
-s,\\,\\\\,g; s,\$,$$,g
-EOF_SED
-  program_transform_name="`echo $program_transform_name|sed -f conftestsed`"
-  rm -f conftestsed
+   { { echo "$as_me:$LINENO: error: newly created file is older than distributed files!
+Check your system clock" >&5
+echo "$as_me: error: newly created file is older than distributed files!
+Check your system clock" >&2;}
+   { (exit 1); exit 1; }; }
 fi
+echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
 test "$program_prefix" != NONE &&
-  program_transform_name="s,^,${program_prefix},; $program_transform_name"
+  program_transform_name="s,^,$program_prefix,;$program_transform_name"
 # Use a double $ so make ignores it.
 test "$program_suffix" != NONE &&
-  program_transform_name="s,\$\$,${program_suffix},; $program_transform_name"
+  program_transform_name="s,\$,$program_suffix,;$program_transform_name"
+# Double any \ or $.  echo might interpret backslashes.
+# By default was `s,x,x', remove it if useless.
+cat <<\_ACEOF >conftest.sed
+s/[\\$]/&&/g;s/;s,x,x,$//
+_ACEOF
+program_transform_name=`echo $program_transform_name | sed -f conftest.sed`
+rm conftest.sed
+
+# expand $ac_aux_dir to an absolute path
+am_aux_dir=`cd $ac_aux_dir && pwd`
+
+test x"${MISSING+set}" = xset || MISSING="\${SHELL} $am_aux_dir/missing"
+# Use eval to expand $SHELL
+if eval "$MISSING --run true"; then
+  am_missing_run="$MISSING --run "
+else
+  am_missing_run=
+  { echo "$as_me:$LINENO: WARNING: \`missing' script is too old or missing" >&5
+echo "$as_me: WARNING: \`missing' script is too old or missing" >&2;}
+fi
+
+if mkdir -p --version . >/dev/null 2>&1 && test ! -d ./--version; then
+  # Keeping the `.' argument allows $(mkdir_p) to be used without
+  # argument.  Indeed, we sometimes output rules like
+  #   $(mkdir_p) $(somedir)
+  # where $(somedir) is conditionally defined.
+  # (`test -n '$(somedir)' && $(mkdir_p) $(somedir)' is a more
+  # expensive solution, as it forces Make to start a sub-shell.)
+  mkdir_p='mkdir -p -- .'
+else
+  # On NextStep and OpenStep, the `mkdir' command does not
+  # recognize any option.  It will interpret all options as
+  # directories to create, and then abort because `.' already
+  # exists.
+  for d in ./-p ./--version;
+  do
+    test -d $d && rmdir $d
+  done
+  # $(mkinstalldirs) is defined by Automake if mkinstalldirs exists.
+  if test -f "$ac_aux_dir/mkinstalldirs"; then
+    mkdir_p='$(mkinstalldirs)'
+  else
+    mkdir_p='$(install_sh) -d'
+  fi
+fi
+
+for ac_prog in gawk mawk nawk awk
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_AWK+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$AWK"; then
+  ac_cv_prog_AWK="$AWK" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AWK="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+AWK=$ac_cv_prog_AWK
+if test -n "$AWK"; then
+  echo "$as_me:$LINENO: result: $AWK" >&5
+echo "${ECHO_T}$AWK" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
 
-# sed with no file args requires a program.
-test "$program_transform_name" = "" && program_transform_name="s,x,x,"
+  test -n "$AWK" && break
+done
 
-echo $ac_n "checking whether ${MAKE-make} sets \${MAKE}""... $ac_c" 1>&6
-echo "configure:753: checking whether ${MAKE-make} sets \${MAKE}" >&5
-set dummy ${MAKE-make}; ac_make=`echo "$2" | sed 'y%./+-%__p_%'`
-if eval "test \"`echo '$''{'ac_cv_prog_make_${ac_make}_set'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking whether ${MAKE-make} sets \$(MAKE)" >&5
+echo $ECHO_N "checking whether ${MAKE-make} sets \$(MAKE)... $ECHO_C" >&6
+set dummy ${MAKE-make}; ac_make=`echo "$2" | sed 'y,:./+-,___p_,'`
+if eval "test \"\${ac_cv_prog_make_${ac_make}_set+set}\" = set"; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-  cat > conftestmake <<\EOF
+  cat >conftest.make <<\_ACEOF
 all:
-	@echo 'ac_maketemp="${MAKE}"'
-EOF
+	@echo 'ac_maketemp="$(MAKE)"'
+_ACEOF
 # GNU make sometimes prints "make[1]: Entering...", which would confuse us.
-eval `${MAKE-make} -f conftestmake 2>/dev/null | grep temp=`
+eval `${MAKE-make} -f conftest.make 2>/dev/null | grep temp=`
 if test -n "$ac_maketemp"; then
   eval ac_cv_prog_make_${ac_make}_set=yes
 else
   eval ac_cv_prog_make_${ac_make}_set=no
 fi
-rm -f conftestmake
+rm -f conftest.make
 fi
 if eval "test \"`echo '$ac_cv_prog_make_'${ac_make}_set`\" = yes"; then
-  echo "$ac_t""yes" 1>&6
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
   SET_MAKE=
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
   SET_MAKE="MAKE=${MAKE-make}"
 fi
 
+rm -rf .tst 2>/dev/null
+mkdir .tst 2>/dev/null
+if test -d .tst; then
+  am__leading_dot=.
+else
+  am__leading_dot=_
+fi
+rmdir .tst 2>/dev/null
+
+# test to see if srcdir already configured
+if test "`cd $srcdir && pwd`" != "`pwd`" &&
+   test -f $srcdir/config.status; then
+  { { echo "$as_me:$LINENO: error: source directory already configured; run \"make distclean\" there first" >&5
+echo "$as_me: error: source directory already configured; run \"make distclean\" there first" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+# test whether we have cygpath
+if test -z "$CYGPATH_W"; then
+  if (cygpath --version) >/dev/null 2>/dev/null; then
+    CYGPATH_W='cygpath -w'
+  else
+    CYGPATH_W=echo
+  fi
+fi
+
 
-PACKAGE=$PACKAGE
+# Define the identity of the package.
+ PACKAGE=$PACKAGE
+ VERSION=$VERSION
 
-VERSION=$VERSION
 
-if test "`cd $srcdir && pwd`" != "`pwd`" && test -f $srcdir/config.status; then
-  { echo "configure: error: source directory already configured; run "make distclean" there first" 1>&2; exit 1; }
-fi
-cat >> confdefs.h <<EOF
+cat >>confdefs.h <<_ACEOF
 #define PACKAGE "$PACKAGE"
-EOF
+_ACEOF
 
-cat >> confdefs.h <<EOF
+
+cat >>confdefs.h <<_ACEOF
 #define VERSION "$VERSION"
-EOF
+_ACEOF
 
+# Some tools Automake needs.
 
+ACLOCAL=${ACLOCAL-"${am_missing_run}aclocal-${am__api_version}"}
 
-missing_dir=`cd $ac_aux_dir && pwd`
-echo $ac_n "checking for working aclocal""... $ac_c" 1>&6
-echo "configure:799: checking for working aclocal" >&5
-# Run test in a subshell; some versions of sh will print an error if
-# an executable is not found, even if stderr is redirected.
-# Redirect stdin to placate older versions of autoconf.  Sigh.
-if (aclocal --version) < /dev/null > /dev/null 2>&1; then
-   ACLOCAL=aclocal
-   echo "$ac_t""found" 1>&6
-else
-   ACLOCAL="$missing_dir/missing aclocal"
-   echo "$ac_t""missing" 1>&6
-fi
 
-echo $ac_n "checking for working autoconf""... $ac_c" 1>&6
-echo "configure:812: checking for working autoconf" >&5
-# Run test in a subshell; some versions of sh will print an error if
-# an executable is not found, even if stderr is redirected.
-# Redirect stdin to placate older versions of autoconf.  Sigh.
-if (autoconf --version) < /dev/null > /dev/null 2>&1; then
-   AUTOCONF=autoconf
-   echo "$ac_t""found" 1>&6
-else
-   AUTOCONF="$missing_dir/missing autoconf"
-   echo "$ac_t""missing" 1>&6
-fi
+AUTOCONF=${AUTOCONF-"${am_missing_run}autoconf"}
+
+
+AUTOMAKE=${AUTOMAKE-"${am_missing_run}automake-${am__api_version}"}
+
+
+AUTOHEADER=${AUTOHEADER-"${am_missing_run}autoheader"}
+
+
+MAKEINFO=${MAKEINFO-"${am_missing_run}makeinfo"}
+
 
-echo $ac_n "checking for working automake""... $ac_c" 1>&6
-echo "configure:825: checking for working automake" >&5
-# Run test in a subshell; some versions of sh will print an error if
-# an executable is not found, even if stderr is redirected.
-# Redirect stdin to placate older versions of autoconf.  Sigh.
-if (automake --version) < /dev/null > /dev/null 2>&1; then
-   AUTOMAKE=automake
-   echo "$ac_t""found" 1>&6
+AMTAR=${AMTAR-"${am_missing_run}tar"}
+
+install_sh=${install_sh-"$am_aux_dir/install-sh"}
+
+# Installed binaries are usually stripped using `strip' when the user
+# run `make install-strip'.  However `strip' might not be the right
+# tool to use in cross-compilation environments, therefore Automake
+# will honor the `STRIP' environment variable to overrule this program.
+if test "$cross_compiling" != no; then
+  if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}strip", so it can be a program name with args.
+set dummy ${ac_tool_prefix}strip; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_STRIP+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
-   AUTOMAKE="$missing_dir/missing automake"
-   echo "$ac_t""missing" 1>&6
+  if test -n "$STRIP"; then
+  ac_cv_prog_STRIP="$STRIP" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_STRIP="${ac_tool_prefix}strip"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 fi
+fi
+STRIP=$ac_cv_prog_STRIP
+if test -n "$STRIP"; then
+  echo "$as_me:$LINENO: result: $STRIP" >&5
+echo "${ECHO_T}$STRIP" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+fi
+if test -z "$ac_cv_prog_STRIP"; then
+  ac_ct_STRIP=$STRIP
+  # Extract the first word of "strip", so it can be a program name with args.
+set dummy strip; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_STRIP+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_STRIP"; then
+  ac_cv_prog_ac_ct_STRIP="$ac_ct_STRIP" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_STRIP="strip"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
 
-echo $ac_n "checking for working autoheader""... $ac_c" 1>&6
-echo "configure:838: checking for working autoheader" >&5
-# Run test in a subshell; some versions of sh will print an error if
-# an executable is not found, even if stderr is redirected.
-# Redirect stdin to placate older versions of autoconf.  Sigh.
-if (autoheader --version) < /dev/null > /dev/null 2>&1; then
-   AUTOHEADER=autoheader
-   echo "$ac_t""found" 1>&6
+  test -z "$ac_cv_prog_ac_ct_STRIP" && ac_cv_prog_ac_ct_STRIP=":"
+fi
+fi
+ac_ct_STRIP=$ac_cv_prog_ac_ct_STRIP
+if test -n "$ac_ct_STRIP"; then
+  echo "$as_me:$LINENO: result: $ac_ct_STRIP" >&5
+echo "${ECHO_T}$ac_ct_STRIP" >&6
 else
-   AUTOHEADER="$missing_dir/missing autoheader"
-   echo "$ac_t""missing" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
-echo $ac_n "checking for working makeinfo""... $ac_c" 1>&6
-echo "configure:851: checking for working makeinfo" >&5
-# Run test in a subshell; some versions of sh will print an error if
-# an executable is not found, even if stderr is redirected.
-# Redirect stdin to placate older versions of autoconf.  Sigh.
-if (makeinfo --version) < /dev/null > /dev/null 2>&1; then
-   MAKEINFO=makeinfo
-   echo "$ac_t""found" 1>&6
+  STRIP=$ac_ct_STRIP
 else
-   MAKEINFO="$missing_dir/missing makeinfo"
-   echo "$ac_t""missing" 1>&6
+  STRIP="$ac_cv_prog_STRIP"
 fi
 
+fi
+INSTALL_STRIP_PROGRAM="\${SHELL} \$(install_sh) -c -s"
+
+# We need awk for the "check" target.  The system "awk" is bad on
+# some platforms.
 
 
 
+          ac_config_headers="$ac_config_headers include/blob/config.h"
 
 
 
 
-echo $ac_n "checking whether to enable maintainer-specific portions of Makefiles""... $ac_c" 1>&6
-echo "configure:871: checking whether to enable maintainer-specific portions of Makefiles" >&5
+echo "$as_me:$LINENO: checking whether to enable maintainer-specific portions of Makefiles" >&5
+echo $ECHO_N "checking whether to enable maintainer-specific portions of Makefiles... $ECHO_C" >&6
     # Check whether --enable-maintainer-mode or --disable-maintainer-mode was given.
 if test "${enable_maintainer_mode+set}" = set; then
   enableval="$enable_maintainer_mode"
   USE_MAINTAINER_MODE=$enableval
 else
   USE_MAINTAINER_MODE=no
-fi
+fi;
+  echo "$as_me:$LINENO: result: $USE_MAINTAINER_MODE" >&5
+echo "${ECHO_T}$USE_MAINTAINER_MODE" >&6
 
-  echo "$ac_t""$USE_MAINTAINER_MODE" 1>&6
-  
 
 if test $USE_MAINTAINER_MODE = yes; then
   MAINTAINER_MODE_TRUE=
@@ -886,8 +1787,8 @@
   MAINTAINER_MODE_TRUE='#'
   MAINTAINER_MODE_FALSE=
 fi
+
   MAINT=$MAINTAINER_MODE_TRUE
-  
 
 
 
@@ -895,387 +1796,925 @@
 
 
 # Make sure we can run config.sub.
-if ${CONFIG_SHELL-/bin/sh} $ac_config_sub sun4 >/dev/null 2>&1; then :
-else { echo "configure: error: can not run $ac_config_sub" 1>&2; exit 1; }
+$ac_config_sub sun4 >/dev/null 2>&1 ||
+  { { echo "$as_me:$LINENO: error: cannot run $ac_config_sub" >&5
+echo "$as_me: error: cannot run $ac_config_sub" >&2;}
+   { (exit 1); exit 1; }; }
+
+echo "$as_me:$LINENO: checking build system type" >&5
+echo $ECHO_N "checking build system type... $ECHO_C" >&6
+if test "${ac_cv_build+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_build_alias=$build_alias
+test -z "$ac_cv_build_alias" &&
+  ac_cv_build_alias=`$ac_config_guess`
+test -z "$ac_cv_build_alias" &&
+  { { echo "$as_me:$LINENO: error: cannot guess build type; you must specify one" >&5
+echo "$as_me: error: cannot guess build type; you must specify one" >&2;}
+   { (exit 1); exit 1; }; }
+ac_cv_build=`$ac_config_sub $ac_cv_build_alias` ||
+  { { echo "$as_me:$LINENO: error: $ac_config_sub $ac_cv_build_alias failed" >&5
+echo "$as_me: error: $ac_config_sub $ac_cv_build_alias failed" >&2;}
+   { (exit 1); exit 1; }; }
+
 fi
+echo "$as_me:$LINENO: result: $ac_cv_build" >&5
+echo "${ECHO_T}$ac_cv_build" >&6
+build=$ac_cv_build
+build_cpu=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
+build_vendor=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
+build_os=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
 
-echo $ac_n "checking host system type""... $ac_c" 1>&6
-echo "configure:904: checking host system type" >&5
 
-host_alias=$host
-case "$host_alias" in
-NONE)
-  case $nonopt in
-  NONE)
-    if host_alias=`${CONFIG_SHELL-/bin/sh} $ac_config_guess`; then :
-    else { echo "configure: error: can not guess host type; you must specify one" 1>&2; exit 1; }
-    fi ;;
-  *) host_alias=$nonopt ;;
-  esac ;;
-esac
+echo "$as_me:$LINENO: checking host system type" >&5
+echo $ECHO_N "checking host system type... $ECHO_C" >&6
+if test "${ac_cv_host+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_host_alias=$host_alias
+test -z "$ac_cv_host_alias" &&
+  ac_cv_host_alias=$ac_cv_build_alias
+ac_cv_host=`$ac_config_sub $ac_cv_host_alias` ||
+  { { echo "$as_me:$LINENO: error: $ac_config_sub $ac_cv_host_alias failed" >&5
+echo "$as_me: error: $ac_config_sub $ac_cv_host_alias failed" >&2;}
+   { (exit 1); exit 1; }; }
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_host" >&5
+echo "${ECHO_T}$ac_cv_host" >&6
+host=$ac_cv_host
+host_cpu=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
+host_vendor=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
+host_os=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
 
-host=`${CONFIG_SHELL-/bin/sh} $ac_config_sub $host_alias`
-host_cpu=`echo $host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
-host_vendor=`echo $host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
-host_os=`echo $host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
-echo "$ac_t""$host" 1>&6
 
 
 
 
 
-for ac_prog in arm-linux-gcc gcc
+for ac_prog in armv5l-linux-gcc gcc
 do
-# Extract the first word of "$ac_prog", so it can be a program name with args.
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:933: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_CC="$ac_prog"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 fi
 fi
-CC="$ac_cv_prog_CC"
+CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$ac_t""$CC" 1>&6
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
-test -n "$CC" && break
+  test -n "$CC" && break
 done
 test -n "$CC" || CC="echo"
 
-for ac_prog in arm-linux-objcopy objcopy
+for ac_prog in armv5l-linux-objcopy objcopy
 do
-# Extract the first word of "$ac_prog", so it can be a program name with args.
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:968: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_OBJCOPY'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_OBJCOPY+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$OBJCOPY"; then
   ac_cv_prog_OBJCOPY="$OBJCOPY" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_OBJCOPY="$ac_prog"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_OBJCOPY="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 fi
 fi
-OBJCOPY="$ac_cv_prog_OBJCOPY"
+OBJCOPY=$ac_cv_prog_OBJCOPY
 if test -n "$OBJCOPY"; then
-  echo "$ac_t""$OBJCOPY" 1>&6
+  echo "$as_me:$LINENO: result: $OBJCOPY" >&5
+echo "${ECHO_T}$OBJCOPY" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
-test -n "$OBJCOPY" && break
+  test -n "$OBJCOPY" && break
 done
 test -n "$OBJCOPY" || OBJCOPY="echo"
 
-for ac_prog in arm-linux-ranlib ranlib
+for ac_prog in armv5l-linux-ranlib ranlib
 do
-# Extract the first word of "$ac_prog", so it can be a program name with args.
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1003: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_RANLIB+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$RANLIB"; then
   ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_RANLIB="$ac_prog"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_RANLIB="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 fi
 fi
-RANLIB="$ac_cv_prog_RANLIB"
+RANLIB=$ac_cv_prog_RANLIB
 if test -n "$RANLIB"; then
-  echo "$ac_t""$RANLIB" 1>&6
+  echo "$as_me:$LINENO: result: $RANLIB" >&5
+echo "${ECHO_T}$RANLIB" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
-test -n "$RANLIB" && break
+  test -n "$RANLIB" && break
 done
 test -n "$RANLIB" || RANLIB="echo"
 
-for ac_prog in arm-linux-ar ar
+for ac_prog in armv5l-linux-ar ar
 do
-# Extract the first word of "$ac_prog", so it can be a program name with args.
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
 set dummy $ac_prog; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1038: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_AR'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_AR+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$AR"; then
   ac_cv_prog_AR="$AR" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_AR="$ac_prog"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_AR="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 fi
 fi
-AR="$ac_cv_prog_AR"
+AR=$ac_cv_prog_AR
 if test -n "$AR"; then
-  echo "$ac_t""$AR" 1>&6
+  echo "$as_me:$LINENO: result: $AR" >&5
+echo "${ECHO_T}$AR" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
-test -n "$AR" && break
+  test -n "$AR" && break
 done
 test -n "$AR" || AR="echo"
 
+for ac_prog in armv5l-linux-ld ld
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_LD+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$LD"; then
+  ac_cv_prog_LD="$LD" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_LD="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+LD=$ac_cv_prog_LD
+if test -n "$LD"; then
+  echo "$as_me:$LINENO: result: $LD" >&5
+echo "${ECHO_T}$LD" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  test -n "$LD" && break
+done
+test -n "$LD" || LD="echo"
+
 
 
 
 
-# Extract the first word of "gcc", so it can be a program name with args.
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}gcc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}gcc; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}gcc"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "gcc", so it can be a program name with args.
 set dummy gcc; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1075: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="gcc"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+echo "${ECHO_T}$ac_ct_CC" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  CC=$ac_ct_CC
+else
+  CC="$ac_cv_prog_CC"
+fi
+
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}cc", so it can be a program name with args.
+set dummy ${ac_tool_prefix}cc; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_CC="gcc"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="${ac_tool_prefix}cc"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 fi
 fi
-CC="$ac_cv_prog_CC"
+CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$ac_t""$CC" 1>&6
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+fi
+if test -z "$ac_cv_prog_CC"; then
+  ac_ct_CC=$CC
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="cc"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+echo "${ECHO_T}$ac_ct_CC" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
+  CC=$ac_ct_CC
+else
+  CC="$ac_cv_prog_CC"
+fi
+
+fi
 if test -z "$CC"; then
   # Extract the first word of "cc", so it can be a program name with args.
 set dummy cc; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1105: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
   ac_prog_rejected=no
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      if test "$ac_dir/$ac_word" = "/usr/ucb/cc"; then
-        ac_prog_rejected=yes
-	continue
-      fi
-      ac_cv_prog_CC="cc"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 if test $ac_prog_rejected = yes; then
   # We found a bogon in the path, so make sure we never use it.
   set dummy $ac_cv_prog_CC
   shift
-  if test $# -gt 0; then
+  if test $# != 0; then
     # We chose a different compiler from the bogus one.
     # However, it has the same basename, so the bogon will be chosen
     # first if we set CC to just the basename; use the full file name.
     shift
-    set dummy "$ac_dir/$ac_word" "$@"
-    shift
-    ac_cv_prog_CC="$@"
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
   fi
 fi
 fi
 fi
-CC="$ac_cv_prog_CC"
+CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$ac_t""$CC" 1>&6
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
-  if test -z "$CC"; then
-    case "`uname -s`" in
-    *win32* | *WIN32*)
-      # Extract the first word of "cl", so it can be a program name with args.
-set dummy cl; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1156: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_CC'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+fi
+if test -z "$CC"; then
+  if test -n "$ac_tool_prefix"; then
+  for ac_prog in cl
+  do
+    # Extract the first word of "$ac_tool_prefix$ac_prog", so it can be a program name with args.
+set dummy $ac_tool_prefix$ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   if test -n "$CC"; then
   ac_cv_prog_CC="$CC" # Let the user override the test.
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_CC="cl"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="$ac_tool_prefix$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
 fi
 fi
-CC="$ac_cv_prog_CC"
+CC=$ac_cv_prog_CC
 if test -n "$CC"; then
-  echo "$ac_t""$CC" 1>&6
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
- ;;
-    esac
+
+    test -n "$CC" && break
+  done
+fi
+if test -z "$CC"; then
+  ac_ct_CC=$CC
+  for ac_prog in cl
+do
+  # Extract the first word of "$ac_prog", so it can be a program name with args.
+set dummy $ac_prog; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_CC"; then
+  ac_cv_prog_ac_ct_CC="$ac_ct_CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_CC="$ac_prog"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
   fi
-  test -z "$CC" && { echo "configure: error: no acceptable cc found in \$PATH" 1>&2; exit 1; }
+done
+done
+
+fi
+fi
+ac_ct_CC=$ac_cv_prog_ac_ct_CC
+if test -n "$ac_ct_CC"; then
+  echo "$as_me:$LINENO: result: $ac_ct_CC" >&5
+echo "${ECHO_T}$ac_ct_CC" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
 fi
 
-echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works""... $ac_c" 1>&6
-echo "configure:1188: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) works" >&5
+  test -n "$ac_ct_CC" && break
+done
 
-ac_ext=c
-# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
-ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
-cross_compiling=$ac_cv_prog_cc_cross
+  CC=$ac_ct_CC
+fi
+
+fi
 
-cat > conftest.$ac_ext << EOF
 
-#line 1199 "configure"
-#include "confdefs.h"
+test -z "$CC" && { { echo "$as_me:$LINENO: error: no acceptable C compiler found in \$PATH
+See \`config.log' for more details." >&5
+echo "$as_me: error: no acceptable C compiler found in \$PATH
+See \`config.log' for more details." >&2;}
+   { (exit 1); exit 1; }; }
+
+# Provide some information about the compiler.
+echo "$as_me:$LINENO:" \
+     "checking for C compiler version" >&5
+ac_compiler=`set X $ac_compile; echo $2`
+{ (eval echo "$as_me:$LINENO: \"$ac_compiler --version </dev/null >&5\"") >&5
+  (eval $ac_compiler --version </dev/null >&5) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }
+{ (eval echo "$as_me:$LINENO: \"$ac_compiler -v </dev/null >&5\"") >&5
+  (eval $ac_compiler -v </dev/null >&5) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }
+{ (eval echo "$as_me:$LINENO: \"$ac_compiler -V </dev/null >&5\"") >&5
+  (eval $ac_compiler -V </dev/null >&5) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }
+
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+ac_clean_files_save=$ac_clean_files
+ac_clean_files="$ac_clean_files a.out a.exe b.out"
+# Try to create an executable without -o first, disregard a.out.
+# It will help us diagnose broken compilers, and finding out an intuition
+# of exeext.
+echo "$as_me:$LINENO: checking for C compiler default output file name" >&5
+echo $ECHO_N "checking for C compiler default output file name... $ECHO_C" >&6
+ac_link_default=`echo "$ac_link" | sed 's/ -o *conftest[^ ]*//'`
+if { (eval echo "$as_me:$LINENO: \"$ac_link_default\"") >&5
+  (eval $ac_link_default) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  # Find the output, starting from the most likely.  This scheme is
+# not robust to junk in `.', hence go to wildcards (a.*) only as a last
+# resort.
+
+# Be careful to initialize this variable, since it used to be cached.
+# Otherwise an old cache value of `no' led to `EXEEXT = no' in a Makefile.
+ac_cv_exeext=
+# b.out is created by i960 compilers.
+for ac_file in a_out.exe a.exe conftest.exe a.out conftest a.* conftest.* b.out
+do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.o | *.obj )
+	;;
+    conftest.$ac_ext )
+	# This is the source file.
+	;;
+    [ab].out )
+	# We found the default executable, but exeext='' is most
+	# certainly right.
+	break;;
+    *.* )
+	ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	# FIXME: I believe we export ac_cv_exeext for Libtool,
+	# but it would be cool to find out if it's true.  Does anybody
+	# maintain Libtool? --akim.
+	export ac_cv_exeext
+	break;;
+    * )
+	break;;
+  esac
+done
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
-main(){return(0);}
-EOF
-if { (eval echo configure:1204: \"$ac_link\") 1>&5; (eval $ac_link) 2>&5; } && test -s conftest${ac_exeext}; then
-  ac_cv_prog_cc_works=yes
-  # If we can't run a trivial program, we are probably using a cross compiler.
-  if (./conftest; exit) 2>/dev/null; then
-    ac_cv_prog_cc_cross=no
+{ { echo "$as_me:$LINENO: error: C compiler cannot create executables
+See \`config.log' for more details." >&5
+echo "$as_me: error: C compiler cannot create executables
+See \`config.log' for more details." >&2;}
+   { (exit 77); exit 77; }; }
+fi
+
+ac_exeext=$ac_cv_exeext
+echo "$as_me:$LINENO: result: $ac_file" >&5
+echo "${ECHO_T}$ac_file" >&6
+
+# Check the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+echo "$as_me:$LINENO: checking whether the C compiler works" >&5
+echo $ECHO_N "checking whether the C compiler works... $ECHO_C" >&6
+# FIXME: These cross compiler hacks should be removed for Autoconf 3.0
+# If not cross compiling, check that we can run a simple program.
+if test "$cross_compiling" != yes; then
+  if { ac_try='./$ac_file'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+    cross_compiling=no
   else
-    ac_cv_prog_cc_cross=yes
+    if test "$cross_compiling" = maybe; then
+	cross_compiling=yes
+    else
+	{ { echo "$as_me:$LINENO: error: cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details." >&5
+echo "$as_me: error: cannot run C compiled programs.
+If you meant to cross compile, use \`--host'.
+See \`config.log' for more details." >&2;}
+   { (exit 1); exit 1; }; }
+    fi
   fi
-else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
-  ac_cv_prog_cc_works=no
-fi
-rm -fr conftest*
-ac_ext=c
-# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
-ac_cpp='$CPP $CPPFLAGS'
-ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
-ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
-cross_compiling=$ac_cv_prog_cc_cross
-
-echo "$ac_t""$ac_cv_prog_cc_works" 1>&6
-if test $ac_cv_prog_cc_works = no; then
-  { echo "configure: error: installation or configuration problem: C compiler cannot create executables." 1>&2; exit 1; }
-fi
-echo $ac_n "checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler""... $ac_c" 1>&6
-echo "configure:1230: checking whether the C compiler ($CC $CFLAGS $LDFLAGS) is a cross-compiler" >&5
-echo "$ac_t""$ac_cv_prog_cc_cross" 1>&6
-cross_compiling=$ac_cv_prog_cc_cross
-
-echo $ac_n "checking whether we are using GNU C""... $ac_c" 1>&6
-echo "configure:1235: checking whether we are using GNU C" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_gcc'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  cat > conftest.c <<EOF
-#ifdef __GNUC__
-  yes;
-#endif
-EOF
-if { ac_try='${CC-cc} -E conftest.c'; { (eval echo configure:1244: \"$ac_try\") 1>&5; (eval $ac_try) 2>&5; }; } | egrep yes >/dev/null 2>&1; then
-  ac_cv_prog_gcc=yes
-else
-  ac_cv_prog_gcc=no
 fi
-fi
-
-echo "$ac_t""$ac_cv_prog_gcc" 1>&6
+echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
 
-if test $ac_cv_prog_gcc = yes; then
-  GCC=yes
+rm -f a.out a.exe conftest$ac_cv_exeext b.out
+ac_clean_files=$ac_clean_files_save
+# Check the compiler produces executables we can run.  If not, either
+# the compiler is broken, or we cross compile.
+echo "$as_me:$LINENO: checking whether we are cross compiling" >&5
+echo $ECHO_N "checking whether we are cross compiling... $ECHO_C" >&6
+echo "$as_me:$LINENO: result: $cross_compiling" >&5
+echo "${ECHO_T}$cross_compiling" >&6
+
+echo "$as_me:$LINENO: checking for suffix of executables" >&5
+echo $ECHO_N "checking for suffix of executables... $ECHO_C" >&6
+if { (eval echo "$as_me:$LINENO: \"$ac_link\"") >&5
+  (eval $ac_link) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  # If both `conftest.exe' and `conftest' are `present' (well, observable)
+# catch `conftest.exe'.  For instance with Cygwin, `ls conftest' will
+# work properly (i.e., refer to `conftest.exe'), while it won't with
+# `rm'.
+for ac_file in conftest.exe conftest conftest.*; do
+  test -f "$ac_file" || continue
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg | *.o | *.obj ) ;;
+    *.* ) ac_cv_exeext=`expr "$ac_file" : '[^.]*\(\..*\)'`
+	  export ac_cv_exeext
+	  break;;
+    * ) break;;
+  esac
+done
 else
-  GCC=
-fi
-
-ac_test_CFLAGS="${CFLAGS+set}"
-ac_save_CFLAGS="$CFLAGS"
-CFLAGS=
-echo $ac_n "checking whether ${CC-cc} accepts -g""... $ac_c" 1>&6
-echo "configure:1263: checking whether ${CC-cc} accepts -g" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_cc_g'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+  { { echo "$as_me:$LINENO: error: cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details." >&5
+echo "$as_me: error: cannot compute suffix of executables: cannot compile and link
+See \`config.log' for more details." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+rm -f conftest$ac_cv_exeext
+echo "$as_me:$LINENO: result: $ac_cv_exeext" >&5
+echo "${ECHO_T}$ac_cv_exeext" >&6
+
+rm -f conftest.$ac_ext
+EXEEXT=$ac_cv_exeext
+ac_exeext=$EXEEXT
+echo "$as_me:$LINENO: checking for suffix of object files" >&5
+echo $ECHO_N "checking for suffix of object files... $ECHO_C" >&6
+if test "${ac_cv_objext+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.o conftest.obj
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; then
+  for ac_file in `(ls conftest.o conftest.obj; ls conftest.*) 2>/dev/null`; do
+  case $ac_file in
+    *.$ac_ext | *.xcoff | *.tds | *.d | *.pdb | *.xSYM | *.bb | *.bbg ) ;;
+    *) ac_cv_objext=`expr "$ac_file" : '.*\.\(.*\)'`
+       break;;
+  esac
+done
 else
-  echo 'void f(){}' > conftest.c
-if test -z "`${CC-cc} -g -c conftest.c 2>&1`"; then
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+{ { echo "$as_me:$LINENO: error: cannot compute suffix of object files: cannot compile
+See \`config.log' for more details." >&5
+echo "$as_me: error: cannot compute suffix of object files: cannot compile
+See \`config.log' for more details." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+rm -f conftest.$ac_cv_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: $ac_cv_objext" >&5
+echo "${ECHO_T}$ac_cv_objext" >&6
+OBJEXT=$ac_cv_objext
+ac_objext=$OBJEXT
+echo "$as_me:$LINENO: checking whether we are using the GNU C compiler" >&5
+echo $ECHO_N "checking whether we are using the GNU C compiler... $ECHO_C" >&6
+if test "${ac_cv_c_compiler_gnu+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+int
+main ()
+{
+#ifndef __GNUC__
+       choke me
+#endif
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_compiler_gnu=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_compiler_gnu=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_cv_c_compiler_gnu=$ac_compiler_gnu
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+echo "${ECHO_T}$ac_cv_c_compiler_gnu" >&6
+GCC=`test $ac_compiler_gnu = yes && echo yes`
+ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+CFLAGS="-g"
+echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+echo $ECHO_N "checking whether $CC accepts -g... $ECHO_C" >&6
+if test "${ac_cv_prog_cc_g+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
   ac_cv_prog_cc_g=yes
 else
-  ac_cv_prog_cc_g=no
-fi
-rm -f conftest*
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
 
+ac_cv_prog_cc_g=no
 fi
-
-echo "$ac_t""$ac_cv_prog_cc_g" 1>&6
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+echo "${ECHO_T}$ac_cv_prog_cc_g" >&6
 if test "$ac_test_CFLAGS" = set; then
-  CFLAGS="$ac_save_CFLAGS"
+  CFLAGS=$ac_save_CFLAGS
 elif test $ac_cv_prog_cc_g = yes; then
   if test "$GCC" = yes; then
     CFLAGS="-g -O2"
@@ -1289,126 +2728,622 @@
     CFLAGS=
   fi
 fi
+echo "$as_me:$LINENO: checking for $CC option to accept ANSI C" >&5
+echo $ECHO_N "checking for $CC option to accept ANSI C... $ECHO_C" >&6
+if test "${ac_cv_prog_cc_stdc+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_prog_cc_stdc=no
+ac_save_CC=$CC
+cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#include <stdarg.h>
+#include <stdio.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+/* Most of the following tests are stolen from RCS 5.7's src/conf.sh.  */
+struct buf { int x; };
+FILE * (*rcsopen) (struct buf *, struct stat *, int);
+static char *e (p, i)
+     char **p;
+     int i;
+{
+  return p[i];
+}
+static char *f (char * (*g) (char **, int), char **p, ...)
+{
+  char *s;
+  va_list v;
+  va_start (v,p);
+  s = g (p, va_arg (v,int));
+  va_end (v);
+  return s;
+}
+
+/* OSF 4.0 Compaq cc is some sort of almost-ANSI by default.  It has
+   function prototypes and stuff, but not '\xHH' hex character constants.
+   These don't provoke an error unfortunately, instead are silently treated
+   as 'x'.  The following induces an error, until -std1 is added to get
+   proper ANSI mode.  Curiously '\x00'!='x' always comes out true, for an
+   array size at least.  It's necessary to write '\x00'==0 to get something
+   that's true only with -std1.  */
+int osf4_cc_array ['\x00' == 0 ? 1 : -1];
+
+int test (int i, double x);
+struct s1 {int (*f) (int a);};
+struct s2 {int (*f) (double a);};
+int pairnames (int, char **, FILE *(*)(struct buf *, struct stat *, int), int, int);
+int argc;
+char **argv;
+int
+main ()
+{
+return f (e, argv, 0) != argv[0]  ||  f (e, argv, 1) != argv[1];
+  ;
+  return 0;
+}
+_ACEOF
+# Don't try gcc -ansi; that turns off useful extensions and
+# breaks some systems' header files.
+# AIX			-qlanglvl=ansi
+# Ultrix and OSF/1	-std1
+# HP-UX 10.20 and later	-Ae
+# HP-UX older versions	-Aa -D_HPUX_SOURCE
+# SVR4			-Xc -D__EXTENSIONS__
+for ac_arg in "" -qlanglvl=ansi -std1 -Ae "-Aa -D_HPUX_SOURCE" "-Xc -D__EXTENSIONS__"
+do
+  CC="$ac_save_CC $ac_arg"
+  rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_prog_cc_stdc=$ac_arg
+break
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+fi
+rm -f conftest.err conftest.$ac_objext
+done
+rm -f conftest.$ac_ext conftest.$ac_objext
+CC=$ac_save_CC
 
-if test "x$ac_cv_prog_gcc" != "xyes" ; then
-  echo "configure: warning: "C compiler is not gcc. This may lead to problems!"" 1>&2;
-  echo "configure: warning: "Trying to continue with $CC ..."" 1>&2;
 fi
-# Extract the first word of "ranlib", so it can be a program name with args.
-set dummy ranlib; ac_word=$2
-echo $ac_n "checking for $ac_word""... $ac_c" 1>&6
-echo "configure:1301: checking for $ac_word" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_RANLIB'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+
+case "x$ac_cv_prog_cc_stdc" in
+  x|xno)
+    echo "$as_me:$LINENO: result: none needed" >&5
+echo "${ECHO_T}none needed" >&6 ;;
+  *)
+    echo "$as_me:$LINENO: result: $ac_cv_prog_cc_stdc" >&5
+echo "${ECHO_T}$ac_cv_prog_cc_stdc" >&6
+    CC="$CC $ac_cv_prog_cc_stdc" ;;
+esac
+
+# Some people use a C++ compiler to compile C.  Since we use `exit',
+# in C++ we need to declare it.  In case someone uses the same compiler
+# for both compiling C and C++ we need to have the C++ compiler decide
+# the declaration of exit, since it's the most demanding environment.
+cat >conftest.$ac_ext <<_ACEOF
+#ifndef __cplusplus
+  choke me
+#endif
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  for ac_declaration in \
+   '' \
+   'extern "C" void std::exit (int) throw (); using std::exit;' \
+   'extern "C" void std::exit (int); using std::exit;' \
+   'extern "C" void exit (int) throw ();' \
+   'extern "C" void exit (int);' \
+   'void exit (int);'
+do
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_declaration
+#include <stdlib.h>
+int
+main ()
+{
+exit (42);
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  :
 else
-  if test -n "$RANLIB"; then
-  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+continue
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+$ac_declaration
+int
+main ()
+{
+exit (42);
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  break
 else
-  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
-  ac_dummy="$PATH"
-  for ac_dir in $ac_dummy; do
-    test -z "$ac_dir" && ac_dir=.
-    if test -f $ac_dir/$ac_word; then
-      ac_cv_prog_RANLIB="ranlib"
-      break
-    fi
-  done
-  IFS="$ac_save_ifs"
-  test -z "$ac_cv_prog_RANLIB" && ac_cv_prog_RANLIB=":"
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
 fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+done
+rm -f conftest*
+if test -n "$ac_declaration"; then
+  echo '#ifdef __cplusplus' >>confdefs.h
+  echo $ac_declaration      >>confdefs.h
+  echo '#endif'             >>confdefs.h
 fi
-RANLIB="$ac_cv_prog_RANLIB"
-if test -n "$RANLIB"; then
-  echo "$ac_t""$RANLIB" 1>&6
+
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+DEPDIR="${am__leading_dot}deps"
+
+          ac_config_commands="$ac_config_commands depfiles"
+
+
+am_make=${MAKE-make}
+cat > confinc << 'END'
+am__doit:
+	@echo done
+.PHONY: am__doit
+END
+# If we don't find an include directive, just comment out the code.
+echo "$as_me:$LINENO: checking for style of include used by $am_make" >&5
+echo $ECHO_N "checking for style of include used by $am_make... $ECHO_C" >&6
+am__include="#"
+am__quote=
+_am_result=none
+# First try GNU make style include.
+echo "include confinc" > confmf
+# We grep out `Entering directory' and `Leaving directory'
+# messages which can occur if `w' ends up in MAKEFLAGS.
+# In particular we don't look at `^make:' because GNU make might
+# be invoked under some other name (usually "gmake"), in which
+# case it prints its new name instead of `make'.
+if test "`$am_make -s -f confmf 2> /dev/null | grep -v 'ing directory'`" = "done"; then
+   am__include=include
+   am__quote=
+   _am_result=GNU
+fi
+# Now try BSD make style include.
+if test "$am__include" = "#"; then
+   echo '.include "confinc"' > confmf
+   if test "`$am_make -s -f confmf 2> /dev/null`" = "done"; then
+      am__include=.include
+      am__quote="\""
+      _am_result=BSD
+   fi
 fi
 
-# Find a good install program.  We prefer a C program (faster),
-# so one script is as good as another.  But avoid the broken or
-# incompatible versions:
-# SysV /etc/install, /usr/sbin/install
-# SunOS /usr/etc/install
-# IRIX /sbin/install
-# AIX /bin/install
-# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
-# AFS /usr/afsws/bin/install, which mishandles nonexistent args
-# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
-# ./install, which can be erroneously created by make from ./install.sh.
-echo $ac_n "checking for a BSD compatible install""... $ac_c" 1>&6
-echo "configure:1340: checking for a BSD compatible install" >&5
-if test -z "$INSTALL"; then
-if eval "test \"`echo '$''{'ac_cv_path_install'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+
+echo "$as_me:$LINENO: result: $_am_result" >&5
+echo "${ECHO_T}$_am_result" >&6
+rm -f confinc confmf
+
+# Check whether --enable-dependency-tracking or --disable-dependency-tracking was given.
+if test "${enable_dependency_tracking+set}" = set; then
+  enableval="$enable_dependency_tracking"
+
+fi;
+if test "x$enable_dependency_tracking" != xno; then
+  am_depcomp="$ac_aux_dir/depcomp"
+  AMDEPBACKSLASH='\'
+fi
+
+
+if test "x$enable_dependency_tracking" != xno; then
+  AMDEP_TRUE=
+  AMDEP_FALSE='#'
 else
-    IFS="${IFS= 	}"; ac_save_IFS="$IFS"; IFS=":"
-  for ac_dir in $PATH; do
-    # Account for people who put trailing slashes in PATH elements.
-    case "$ac_dir/" in
-    /|./|.//|/etc/*|/usr/sbin/*|/usr/etc/*|/sbin/*|/usr/afsws/bin/*|/usr/ucb/*) ;;
-    *)
-      # OSF1 and SCO ODT 3.0 have their own names for install.
-      # Don't use installbsd from OSF since it installs stuff as root
-      # by default.
-      for ac_prog in ginstall scoinst install; do
-        if test -f $ac_dir/$ac_prog; then
+  AMDEP_TRUE='#'
+  AMDEP_FALSE=
+fi
+
+
+
+
+depcc="$CC"   am_compiler_list=
+
+echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
+echo $ECHO_N "checking dependency style of $depcc... $ECHO_C" >&6
+if test "${am_cv_CC_dependencies_compiler_type+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
+  # We make a subdir and do the tests there.  Otherwise we can end up
+  # making bogus files that we don't know about and never remove.  For
+  # instance it was reported that on HP-UX the gcc test will end up
+  # making a dummy file named `D' -- because `-MD' means `put the output
+  # in D'.
+  mkdir conftest.dir
+  # Copy depcomp to subdir because otherwise we won't find it if we're
+  # using a relative directory.
+  cp "$am_depcomp" conftest.dir
+  cd conftest.dir
+  # We will build objects and dependencies in a subdirectory because
+  # it helps to detect inapplicable dependency modes.  For instance
+  # both Tru64's cc and ICC support -MD to output dependencies as a
+  # side effect of compilation, but ICC will put the dependencies in
+  # the current directory while Tru64 will put them in the object
+  # directory.
+  mkdir sub
+
+  am_cv_CC_dependencies_compiler_type=none
+  if test "$am_compiler_list" = ""; then
+     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
+  fi
+  for depmode in $am_compiler_list; do
+    # Setup a source with many dependencies, because some compilers
+    # like to wrap large dependency lists on column 80 (with \), and
+    # we should not choose a depcomp mode which is confused by this.
+    #
+    # We need to recreate these files for each test, as the compiler may
+    # overwrite some of them when testing with obscure command lines.
+    # This happens at least with the AIX C compiler.
+    : > sub/conftest.c
+    for i in 1 2 3 4 5 6; do
+      echo '#include "conftst'$i'.h"' >> sub/conftest.c
+      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
+      # Solaris 8's {/usr,}/bin/sh.
+      touch sub/conftst$i.h
+    done
+    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+
+    case $depmode in
+    nosideeffect)
+      # after this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested
+      if test "x$enable_dependency_tracking" = xyes; then
+	continue
+      else
+	break
+      fi
+      ;;
+    none) break ;;
+    esac
+    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle `-M -o', and we need to detect this.
+    if depmode=$depmode \
+       source=sub/conftest.c object=sub/conftest.${OBJEXT-o} \
+       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
+       $SHELL ./depcomp $depcc -c -o sub/conftest.${OBJEXT-o} sub/conftest.c \
+         >/dev/null 2>conftest.err &&
+       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep sub/conftest.${OBJEXT-o} sub/conftest.Po > /dev/null 2>&1 &&
+       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
+      # icc doesn't choke on unknown options, it will just issue warnings
+      # (even with -Werror).  So we grep stderr for any message
+      # that says an option was ignored.
+      if grep 'ignoring option' conftest.err >/dev/null 2>&1; then :; else
+        am_cv_CC_dependencies_compiler_type=$depmode
+        break
+      fi
+    fi
+  done
+
+  cd ..
+  rm -rf conftest.dir
+else
+  am_cv_CC_dependencies_compiler_type=none
+fi
+
+fi
+echo "$as_me:$LINENO: result: $am_cv_CC_dependencies_compiler_type" >&5
+echo "${ECHO_T}$am_cv_CC_dependencies_compiler_type" >&6
+CCDEPMODE=depmode=$am_cv_CC_dependencies_compiler_type
+
+
+
+if
+  test "x$enable_dependency_tracking" != xno \
+  && test "$am_cv_CC_dependencies_compiler_type" = gcc3; then
+  am__fastdepCC_TRUE=
+  am__fastdepCC_FALSE='#'
+else
+  am__fastdepCC_TRUE='#'
+  am__fastdepCC_FALSE=
+fi
+
+
+if test "x$ac_cv_c_compiler_gnu" != "xyes" ; then
+  { echo "$as_me:$LINENO: WARNING: \"C compiler is not gcc. This may lead to problems!\"" >&5
+echo "$as_me: WARNING: \"C compiler is not gcc. This may lead to problems!\"" >&2;};
+  { echo "$as_me:$LINENO: WARNING: \"Trying to continue with $CC ...\"" >&5
+echo "$as_me: WARNING: \"Trying to continue with $CC ...\"" >&2;};
+fi
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
+set dummy ${ac_tool_prefix}ranlib; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_RANLIB+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+RANLIB=$ac_cv_prog_RANLIB
+if test -n "$RANLIB"; then
+  echo "$as_me:$LINENO: result: $RANLIB" >&5
+echo "${ECHO_T}$RANLIB" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+fi
+if test -z "$ac_cv_prog_RANLIB"; then
+  ac_ct_RANLIB=$RANLIB
+  # Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_RANLIB"; then
+  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_RANLIB="ranlib"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+  test -z "$ac_cv_prog_ac_ct_RANLIB" && ac_cv_prog_ac_ct_RANLIB=":"
+fi
+fi
+ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
+if test -n "$ac_ct_RANLIB"; then
+  echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
+echo "${ECHO_T}$ac_ct_RANLIB" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  RANLIB=$ac_ct_RANLIB
+else
+  RANLIB="$ac_cv_prog_RANLIB"
+fi
+
+# Find a good install program.  We prefer a C program (faster),
+# so one script is as good as another.  But avoid the broken or
+# incompatible versions:
+# SysV /etc/install, /usr/sbin/install
+# SunOS /usr/etc/install
+# IRIX /sbin/install
+# AIX /bin/install
+# AmigaOS /C/install, which installs bootblocks on floppy discs
+# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
+# AFS /usr/afsws/bin/install, which mishandles nonexistent args
+# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
+# OS/2's system install, which has a completely different semantic
+# ./install, which can be erroneously created by make from ./install.sh.
+echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
+echo $ECHO_N "checking for a BSD-compatible install... $ECHO_C" >&6
+if test -z "$INSTALL"; then
+if test "${ac_cv_path_install+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in
+  ./ | .// | /cC/* | \
+  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
+  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
+  /usr/ucb/* ) ;;
+  *)
+    # OSF1 and SCO ODT 3.0 have their own names for install.
+    # Don't use installbsd from OSF since it installs stuff as root
+    # by default.
+    for ac_prog in ginstall scoinst install; do
+      for ac_exec_ext in '' $ac_executable_extensions; do
+	if $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
 	  if test $ac_prog = install &&
-            grep dspmsg $ac_dir/$ac_prog >/dev/null 2>&1; then
+	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
 	    # AIX install.  It has an incompatible calling convention.
 	    :
+	  elif test $ac_prog = install &&
+	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # program-specific install script used by HP pwplus--don't use.
+	    :
 	  else
-	    ac_cv_path_install="$ac_dir/$ac_prog -c"
-	    break 2
+	    ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+	    break 3
 	  fi
 	fi
       done
-      ;;
-    esac
-  done
-  IFS="$ac_save_IFS"
+    done
+    ;;
+esac
+done
+
 
 fi
   if test "${ac_cv_path_install+set}" = set; then
-    INSTALL="$ac_cv_path_install"
+    INSTALL=$ac_cv_path_install
   else
     # As a last resort, use the slow shell script.  We don't cache a
     # path for INSTALL within a source directory, because that will
     # break other packages using the cache if that directory is
     # removed, or if the path is relative.
-    INSTALL="$ac_install_sh"
+    INSTALL=$ac_install_sh
   fi
 fi
-echo "$ac_t""$INSTALL" 1>&6
+echo "$as_me:$LINENO: result: $INSTALL" >&5
+echo "${ECHO_T}$INSTALL" >&6
 
 # Use test -z because SunOS4 sh mishandles braces in ${var-val}.
 # It thinks the first close brace ends the variable substitution.
 test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
 
-test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL_PROGRAM}'
+test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
 
 test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
 
-echo $ac_n "checking whether ln -s works""... $ac_c" 1>&6
-echo "configure:1393: checking whether ln -s works" >&5
-if eval "test \"`echo '$''{'ac_cv_prog_LN_S'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
-else
-  rm -f conftestdata
-if ln -s X conftestdata 2>/dev/null
-then
-  rm -f conftestdata
-  ac_cv_prog_LN_S="ln -s"
-else
-  ac_cv_prog_LN_S=ln
-fi
-fi
-LN_S="$ac_cv_prog_LN_S"
-if test "$ac_cv_prog_LN_S" = "ln -s"; then
-  echo "$ac_t""yes" 1>&6
+echo "$as_me:$LINENO: checking whether ln -s works" >&5
+echo $ECHO_N "checking whether ln -s works... $ECHO_C" >&6
+LN_S=$as_ln_s
+if test "$LN_S" = "ln -s"; then
+  echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
 else
-  echo "$ac_t""no" 1>&6
+  echo "$as_me:$LINENO: result: no, using $LN_S" >&5
+echo "${ECHO_T}no, using $LN_S" >&6
 fi
 
+# By default we simply use the C compiler to build assembly code.
+
+test "${CCAS+set}" = set || CCAS=$CC
+test "${CCASFLAGS+set}" = set || CCASFLAGS=$CFLAGS
+
+
+
 
 
 
@@ -1425,207 +3360,573 @@
   board_name="$withval"
 else
   board_name="lart"
-fi
+fi;
+
 
+BLOB_TARGET="$board_name"
 
-echo $ac_n "checking target board""... $ac_c" 1>&6
-echo "configure:1433: checking target board" >&5
+echo "$as_me:$LINENO: checking target board" >&5
+echo $ECHO_N "checking target board... $ECHO_C" >&6
 case "$board_name" in
+    accelent_sa)
+	board_name="Accelent IDP"
+
+cat >>confdefs.h <<\_ACEOF
+#define ACCELENT_SA 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="accelent_sa.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="accelent_sa.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
     assabet)
 	board_name="Intel Assabet"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define ASSABET 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="assabet.o"
-	echo "configure: warning: Please check assabet memory config in arch/assabet.h" 1>&2
+	BLOB_PLATFORM_OBJS="assabet.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Please check assabet memory config in arch/assabet.h" >&5
+echo "$as_me: WARNING: Please check assabet memory config in arch/assabet.h" >&2;}
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="assabet.o"
+	DIAG_PLATFORM_OBJS="assabet.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     neponset)
 	board_name="Intel Assabet with Neponset Expansion Board"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define ASSABET 1
-EOF
+_ACEOF
+
 
-	cat >> confdefs.h <<\EOF
+cat >>confdefs.h <<\_ACEOF
 #define NEPONSET 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="assabet.o"
-	echo "configure: warning: Please check assabet memory config in arch/assabet.h" 1>&2
+	BLOB_PLATFORM_OBJS="assabet.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Please check assabet memory config in arch/assabet.h" >&5
+echo "$as_me: WARNING: Please check assabet memory config in arch/assabet.h" >&2;}
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="assabet.o"
+	DIAG_PLATFORM_OBJS="assabet.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    badge4)
+	board_name="Hewlett-Packard Laboratories Badge-4"
+
+cat >>confdefs.h <<\_ACEOF
+#define BADGE4 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="badge4.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel16.o"
+	DIAG_PLATFORM_OBJS="badge4.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     brutus)
 	board_name="Intel Brutus"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define BRUTUS 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="brutus.o"
-	echo "configure: warning: Please check Brutus flash" 1>&2
+	BLOB_PLATFORM_OBJS="brutus.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Please check Brutus flash" >&5
+echo "$as_me: WARNING: Please check Brutus flash" >&2;}
 	BLOB_FLASH_OBJS="nullflash.o"
-	DIAG_PLATFORM_OBJ="brutus.o"
+	DIAG_PLATFORM_OBJS="brutus.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    cep)
+        board_name="Iskratel CEP"
+
+cat >>confdefs.h <<\_ACEOF
+#define CEP 1
+_ACEOF
+
+        BLOB_PLATFORM_OBJS="cep.o"
+        BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+        BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+        { echo "$as_me:$LINENO: WARNING: Please check configuration in arch/cep.h" >&5
+echo "$as_me: WARNING: Please check configuration in arch/cep.h" >&2;}
+        BLOB_FLASH_OBJS="intel32.o"
+        DIAG_PLATFORM_OBJS="cep.o"
+        use_cpu="sa1110"
+        use_lcd="no"
+        ;;
     creditlart)
 	board_name="Delft University of Technology CreditLART"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define CLART 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="clart.o"
-	echo "configure: warning: Please check creditlart memory config in arch/clart.h" 1>&2
+	BLOB_PLATFORM_OBJS="clart.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Please check creditlart memory config in arch/clart.h" >&5
+echo "$as_me: WARNING: Please check creditlart memory config in arch/clart.h" >&2;}
 	BLOB_FLASH_OBJS="intel16.o"
-	DIAG_PLATFORM_OBJ="clart.o"
+	DIAG_PLATFORM_OBJS="clart.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    dafit)
+	board_name="Prueftechnik VibXpert"
+
+cat >>confdefs.h <<\_ACEOF
+#define PT_DAFIT 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="dafit.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc9196.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="dafit.o"
+	use_cpu="sa1110"
+	use_lcd="yes"
+	;;
+    frodo)
+	board_name="2d3D, Inc. SA-1110 Development Board"
+
+cat >>confdefs.h <<\_ACEOF
+#define FRODO 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="frodo.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="frodo.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     h3600)
 	board_name="Compaq Ipaq H3600 series"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define H3600 1
-EOF
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="h3600.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Warning: untested platform!" >&5
+echo "$as_me: WARNING: Warning: untested platform!" >&2;}
+	{ echo "$as_me:$LINENO: WARNING: Please check h3600 memory config in arch/h3600.h" >&5
+echo "$as_me: WARNING: Please check h3600 memory config in arch/h3600.h" >&2;}
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="h3600.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    hackkit)
+	board_name="The Hack Kit base cpu board"
 
-	BLOB_PLATFORM_OBJ="h3600.o"
-	echo "configure: warning: Warning: untested platform!" 1>&2
-	echo "configure: warning: Please check h3600 memory config in arch/h3600.h" 1>&2
+cat >>confdefs.h <<\_ACEOF
+#define HKIT 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="hackkit.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="h3600.o"
+	DIAG_PLATFORM_OBJS="hackkit.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     idr)
 	board_name="Vercel UD-1 (IDR)"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define IDR 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="idr.o"
+	BLOB_PLATFORM_OBJS="idr.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="intel16.o"
-	DIAG_PLATFORM_OBJ="idr.o"
+	DIAG_PLATFORM_OBJS="idr.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    jornada720)
+	board_name="Hewlett-Packard Jornada 720 with flash daughter board"
+
+cat >>confdefs.h <<\_ACEOF
+#define JORNADA720 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="jornada720.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Warning: untested platform!" >&5
+echo "$as_me: WARNING: Warning: untested platform!" >&2;}
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="jornada720.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     lart)
 	board_name="Delft University of Technology LART"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define LART 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="lart.o"
+	BLOB_PLATFORM_OBJS="lart.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="lart.o"
+	DIAG_PLATFORM_OBJS="lart.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    lubbock)
+    	board_name="Intel HCDDBCTA1 (Lubbock)"
+
+cat >>confdefs.h <<\_ACEOF
+#define LUBBOCK 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="lubbock.o"
+	BLOB_LED_DRIVER_OBJS="led-mmap.o"
+	BLOB_LED_STARTCODE="ledasm-mmap.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc91x.o"
+	DIAG_PLATFORM_OBJS="lubbock.o"
+	use_cpu="pxa250"
+	use_lcd="no"
+	;;
+    mainstone)
+    	board_name="Intel HCDDBBVA0 (Mainstone)"
+
+cat >>confdefs.h <<\_ACEOF
+#define MAINSTONE 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="mainstone.o"
+	BLOB_LED_DRIVER_OBJS="led-mmap.o"
+	BLOB_LED_STARTCODE="ledasm-mmap.o"
+	BLOB_FLASH_OBJS="intel16.o"
+        BLOB_SPI_OBJS="pxa-bb-spi.o"
+		BLOB_LCD_OBJS="pxa-lcd.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc91x.o"
+	DIAG_PLATFORM_OBJS="mainstone.o"
+	use_cpu="pxa250"
+	use_lcd="yes"
+	;;
+    miniprint)
+        board_name="FGAG miniprint"
+
+cat >>confdefs.h <<\_ACEOF
+#define MINIPRINT 1
+_ACEOF
+
+        BLOB_PLATFORM_OBJS="miniprint.o"
+        BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+        BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+        BLOB_FLASH_OBJS="intel32.o"
+        DIAG_PLATFORM_OBJS="miniprint.o"
+        use_cpu="sa1110"
+        use_lcd="yes"
+        ;;
     nesa)
 	board_name="NESA"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define NESA 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="nesa.o"
+	BLOB_PLATFORM_OBJS="nesa.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="amd32.o"
-	DIAG_PLATFORM_OBJ="nesa.o"
+	DIAG_PLATFORM_OBJS="nesa.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
     pleb)
 	board_name="University of New South Wales PLEB"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define PLEB 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="pleb.o"
-	echo "configure: warning: Please check PLEB flash" 1>&2
+	BLOB_PLATFORM_OBJS="pleb.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Please check PLEB flash" >&5
+echo "$as_me: WARNING: Please check PLEB flash" >&2;}
 	BLOB_FLASH_OBJS="nullflash.o"
-	DIAG_PLATFORM_OBJ="pleb.o"
+	DIAG_PLATFORM_OBJS="pleb.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    pxa_idp)
+	board_name="Accelent PXA250 IDP"
+
+cat >>confdefs.h <<\_ACEOF
+#define PXA_IDP 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="pxa_idp.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="pxa_idp.o"
+	use_cpu="pxa250"
+	use_lcd="no"
+	;;
+    ramses)
+	board_name="M&N MN-CI Logistic Terminal (ramses)"
+
+cat >>confdefs.h <<\_ACEOF
+#define RAMSES 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="ramses.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="ramses.o"
+	use_cpu="pxa250"
+	use_lcd="no"
+	;;
     shannon)
 	board_name="TuxScreen (Shannon)"
-	cat >> confdefs.h <<\EOF
+
+cat >>confdefs.h <<\_ACEOF
 #define SHANNON 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="shannon.o"
+	BLOB_PLATFORM_OBJS="shannon.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="amd32.o"
-	DIAG_PLATFORM_OBJ="shannon.o"
+	DIAG_PLATFORM_OBJS="shannon.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    smdk2500)
+	board_name="SMDK2500 Evaluation Board"
+
+cat >>confdefs.h <<\_ACEOF
+#define SMDK2500 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="smdk2500.o"
+	BLOB_LED_DRIVER_OBJS="led-s3c2500.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-s3c2500.o"
+	BLOB_LED_STARTCODE="ledasm-s3c2500.o"
+	BLOB_FLASH_OBJS="amd16.o"
+	DIAG_PLATFORM_OBJS="smdk2500.o"
+	use_cpu="s3c2500"
+	use_lcd="no"
+	;;
     system3)
-	board_name="Prueftechnik Digital Board"
-	cat >> confdefs.h <<\EOF
+	board_name="Prueftechnik Digital Board REV 0802"
+
+cat >>confdefs.h <<\_ACEOF
 #define PT_SYSTEM3 1
-EOF
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="system3.o"
+	BLOB_PLATFORM_OBJS="system3.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc9196.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="system3.o"
+	DIAG_PLATFORM_OBJS="system3.o"
 	use_cpu="sa1110"
 	use_lcd="yes"
 	;;
-    jornada720)
-	board_name="Hewlett-Packard Jornada 720 with flash daughter board"
-	cat >> confdefs.h <<\EOF
-#define JORNADA720 1
-EOF
+    trizeps)
+	board_name="Keith & Koep Trizeps Board"
 
-	BLOB_PLATFORM_OBJ="jornada720.o"
-	echo "configure: warning: Warning: untested platform!" 1>&2
-	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="jornada720.o"
+cat >>confdefs.h <<\_ACEOF
+#define TRIZEPS 1
+_ACEOF
+
+	BLOB_PLATFORM_OBJS="trizeps.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	{ echo "$as_me:$LINENO: WARNING: Warning: untested platform!" >&5
+echo "$as_me: WARNING: Warning: untested platform!" >&2;}
+	{ echo "$as_me:$LINENO: WARNING: Please check trizeps memory config in arch/trizeps.h" >&5
+echo "$as_me: WARNING: Please check trizeps memory config in arch/trizeps.h" >&2;}
+	BLOB_FLASH_OBJS="intel16.o"
+	DIAG_PLATFORM_OBJS="trizeps.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
-    badge4)
-	board_name="Hewlett-Packard Laboratories Badge-4"
-	cat >> confdefs.h <<\EOF
-#define BADGE4 1
-EOF
+    csir_ims)
+	board_name="CSIR Incident Management System"
+
+cat >>confdefs.h <<\_ACEOF
+#define CSIR_IMS 1
+_ACEOF
 
-	BLOB_PLATFORM_OBJ="badge4.o"
+	BLOB_PLATFORM_OBJS="csir_ims.o"
 	BLOB_FLASH_OBJS="intel16.o"
-	DIAG_PLATFORM_OBJ="badge4.o"
-	use_cpu="sa1110"
+	DIAG_PLATFORM_OBJS="csir_ims.o"
+	use_cpu="pxa250"
 	use_lcd="no"
 	;;
     *)
-	echo "$ac_t""unknown" 1>&6
-	{ echo "configure: error: Unknown board name, bailing out" 1>&2; exit 1; }
+	echo "$as_me:$LINENO: result: unknown" >&5
+echo "${ECHO_T}unknown" >&6
+	{ { echo "$as_me:$LINENO: error: Unknown board name \"$board_name\", bailing out" >&5
+echo "$as_me: error: Unknown board name \"$board_name\", bailing out" >&2;}
+   { (exit 1); exit 1; }; }
 	;;
 esac
 
-echo "$ac_t"""${board_name}"" 1>&6
-cat >> confdefs.h <<EOF
+
+
+
+
+
+
+
+
+echo "$as_me:$LINENO: result: \"${board_name}\"" >&5
+echo "${ECHO_T}\"${board_name}\"" >&6
+
+cat >>confdefs.h <<_ACEOF
 #define BOARD_NAME "${board_name}"
-EOF
+_ACEOF
 
 
+cat >>confdefs.h <<_ACEOF
+#define CPU "${use_cpu}"
+_ACEOF
+
+
+
+case "$use_cpu" in
+    s3c2500)
+
+cat >>confdefs.h <<\_ACEOF
+#define S3C2500 1
+_ACEOF
+
+	BLOB_STARTCODE_OBJS="start-s3c2500.o"
+	BLOB_MEMSETUP_OBJS="memsetup-s3c2500.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-s3c2500.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-s3c2500.o"
+	BLOB_TIMER_DRIVER_OBJS="time-s3c2500.o"
+	;;
+    sa1100)
+
+cat >>confdefs.h <<\_ACEOF
+#define SA1100 1
+_ACEOF
+
+	BLOB_STARTCODE_OBJS="start-sa11x0.o"
+	BLOB_MEMSETUP_OBJS="memsetup-sa1100.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-sa11x0.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-sa11x0.o"
+	BLOB_TIMER_DRIVER_OBJS="time-intelarm.o"
+	;;
+    sa1110)
+
+cat >>confdefs.h <<\_ACEOF
+#define SA1110 1
+_ACEOF
+
+	BLOB_STARTCODE_OBJS="start-sa11x0.o"
+	BLOB_MEMSETUP_OBJS="memsetup-sa1110.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-sa11x0.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-sa11x0.o"
+	BLOB_TIMER_DRIVER_OBJS="time-intelarm.o"
+	;;
+    pxa250)
+
+cat >>confdefs.h <<\_ACEOF
+#define PXA250 1
+_ACEOF
+
+	BLOB_STARTCODE_OBJS="start-pxa.o gpio-pxa.o"
+	BLOB_MEMSETUP_OBJS="memsetup-pxa.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-pxa.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-pxa.o"
+	BLOB_TIMER_DRIVER_OBJS="time-intelarm.o"
+	;;
+    *)
+	{ { echo "$as_me:$LINENO: error: Unknown CPU name \"$use_cpu\", bailing out" >&5
+echo "$as_me: error: Unknown CPU name \"$use_cpu\", bailing out" >&2;}
+   { (exit 1); exit 1; }; };
+	;;
+esac
+
+# Check whether --enable-xlli or --disable-xlli was given.
+if test "${enable_xlli+set}" = set; then
+  enableval="$enable_xlli"
+  use_xlli_flag=$enable_xlli
+else
+  use_xlli_flag=no
+fi;
+
+if test "x$use_xlli_flag" = "xyes" ; then
+	BLOB_STARTCODE_OBJS="xlli/$BLOB_TARGET/libxlli.a"
+	BLOB_MEMSETUP_OBJS=""
+else
+	BLOB_TARGET=""
+fi
+
+# Check whether --enable-usbdnet or --disable-usbdnet was given.
+if test "${enable_usbdnet+set}" = set; then
+  enableval="$enable_usbdnet"
+  usbdnet_flag=$enable_usbdnet
+else
+  usbdnet_flag=no
+fi;
+
+if test "x$usbdnet_flag" = "xyes" ; then
+	case "$BLOB_TARGET" in
+	     lubbock)
+		BLOB_NETWORK_DRIVER_OBJS="ether-pxausb.o pxa_usb_ctl.o pxa_usb_ep0.o pxa_usb_ep1.o pxa_usb_ep2.o"
+		;;
+	     mainstone)
+		BLOB_NETWORK_DRIVER_OBJS="ether-bvdusb.o bvd_usb_ctl.o bvd_usb_ep0.o bvd_usb_ep1.o bvd_usb_ep2.o"
+		;;
+	    *)
+		{ { echo "$as_me:$LINENO: error: No USBDNET support for Target Board \"$BLOB_TARGET\", bailing out" >&5
+echo "$as_me: error: No USBDNET support for Target Board \"$BLOB_TARGET\", bailing out" >&2;}
+   { (exit 1); exit 1; }; };
+		;;
+	esac
+
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_USBDNET_SUPPORT no
+_ACEOF
 
-if test "x$use_cpu" = "xsa1100" ; then
-		MEMSETUP="memsetup-sa1100.o"
-elif test "x$use_cpu" = "xsa1110" ; then
-		MEMSETUP="memsetup-sa1110.o"
-else
-	echo "configure: warning: No CPU defined!" 1>&2;
-	use_cpu="(none)"
-	MEMSETUP=""
 fi
 
 
-cat >> confdefs.h <<EOF
-#define CPU "${use_cpu}"
-EOF
+
+
+
+
+
+
+
+
 
 
 
@@ -1637,28 +3938,77 @@
   linux_prefix="$withval"
 else
   linux_prefix="/usr/src/linux"
-fi
+fi;
 
-
-echo $ac_n "checking if the Linux source tree in $linux_prefix is sane""... $ac_c" 1>&6
-echo "configure:1645: checking if the Linux source tree in $linux_prefix is sane" >&5
+echo "$as_me:$LINENO: checking if the Linux source tree in $linux_prefix is sane" >&5
+echo $ECHO_N "checking if the Linux source tree in $linux_prefix is sane... $ECHO_C" >&6
 if test ! -d "$linux_prefix/include" ; then
-	echo "$ac_t""no" 1>&6
-	{ echo "configure: error: $linux_prefix doesn't look like a configured Linux source tree." 1>&2; exit 1; }
-	{ echo "configure: error: Please supply a proper prefix with the --with-linux-prefix flag" 1>&2; exit 1; }
+	echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+	{ { echo "$as_me:$LINENO: error: $linux_prefix doesn't look like a configured Linux source tree." >&5
+echo "$as_me: error: $linux_prefix doesn't look like a configured Linux source tree." >&2;}
+   { (exit 1); exit 1; }; }
+	{ { echo "$as_me:$LINENO: error: Please supply a proper prefix with the --with-linux-prefix flag" >&5
+echo "$as_me: error: Please supply a proper prefix with the --with-linux-prefix flag" >&2;}
+   { (exit 1); exit 1; }; }
 	exit -1
 fi
-if test ! -f "$linux_prefix/include/asm/setup.h" ; then
-	echo "$ac_t""no" 1>&6
-	{ echo "configure: error: The Linux source tree in $linux_prefix is not configured." 1>&2; exit 1; }
-	{ echo "configure: error: Please run "make lart_config ; yes no | make old_config" in the" 1>&2; exit 1; }
-	{ echo "configure: error: Linux source tree and retry." 1>&2; exit 1; }
+if test ! -f "$linux_prefix/include/asm-arm/setup.h" ; then
+	echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+	{ { echo "$as_me:$LINENO: error: The Linux source tree in $linux_prefix is not configured." >&5
+echo "$as_me: error: The Linux source tree in $linux_prefix is not configured." >&2;}
+   { (exit 1); exit 1; }; }
+	{ { echo "$as_me:$LINENO: error: Please run \"make lart_config ; yes no | make old_config\" in the" >&5
+echo "$as_me: error: Please run \"make lart_config ; yes no | make old_config\" in the" >&2;}
+   { (exit 1); exit 1; }; }
+	{ { echo "$as_me:$LINENO: error: Linux source tree and retry." >&5
+echo "$as_me: error: Linux source tree and retry." >&2;}
+   { (exit 1); exit 1; }; }
 	exit -1
 fi
-echo "$ac_t""yes" 1>&6
-CFLAGS=`echo $CFLAGS -I${linux_prefix}/include`
+echo "$as_me:$LINENO: result: yes" >&5
+echo "${ECHO_T}yes" >&6
+LINUX_INCLUDE=${linux_prefix}/include
+
+CFLAGS=`echo $AM_CFLAGS -I$LINUX_INCLUDE`
+
+
+
+
+
+# Check whether --with-commands or --without-commands was given.
+if test "${with_commands+set}" = set; then
+  withval="$with_commands"
+  blob_commands="$withval"
+else
+  blob_commands=""
+fi;
+
+default_commands="reset, reboot"
+all_commands="bogomips, call, chgbit, dummy, dump, md5chk, memcpy, poke, peek"
+
+if test "$blob_commands" = "all" ; then
+	blob_commands="$all_commands"
+fi
+
+
+
+# Check whether --with-kernel-xip or --without-kernel-xip was given.
+if test "${with_kernel_xip+set}" = set; then
+  withval="$with_kernel_xip"
+  kernel_xip=$withval
+else
+  kernel_xip="no"
+fi;
+
+if test "$kernel_xip" != "no" ; then
 
+cat >>confdefs.h <<_ACEOF
+#define KERNEL_XIP_BASE ${kernel_xip}
+_ACEOF
 
+fi
 
 # Check whether --enable-clock-scaling or --disable-clock-scaling was given.
 if test "${enable_clock_scaling+set}" = set; then
@@ -1666,8 +4016,7 @@
   clock_scaling_flag=$enable_clock_scaling
 else
   clock_scaling_flag=no
-fi
-
+fi;
 
 # Check whether --enable-memtest or --disable-memtest was given.
 if test "${enable_memtest+set}" = set; then
@@ -1675,17 +4024,7 @@
   chkmem_flag=$enable_memtest
 else
   chkmem_flag=no
-fi
-
-
-# Check whether --enable-debug or --disable-debug was given.
-if test "${enable_debug+set}" = set; then
-  enableval="$enable_debug"
-  debug_flag=$enable_debug
-else
-  debug_flag=no
-fi
-
+fi;
 
 # Check whether --enable-lcd or --disable-lcd was given.
 if test "${enable_lcd+set}" = set; then
@@ -1693,8 +4032,7 @@
   lcd_flag=$enable_lcd
 else
   lcd_flag=no
-fi
-
+fi;
 
 # Check whether --enable-md5 or --disable-md5 was given.
 if test "${enable_md5+set}" = set; then
@@ -1702,36 +4040,109 @@
   md5_flag=$enable_md5
 else
   md5_flag=no
-fi
+fi;
 
+# Check whether --enable-xmodem or --disable-xmodem was given.
+if test "${enable_xmodem+set}" = set; then
+  enableval="$enable_xmodem"
+  xmodem_flag=$enable_xmodem
+else
+  xmodem_flag=no
+fi;
 
+# Check whether --enable-usbserial or --disable-usbserial was given.
+if test "${enable_usbserial+set}" = set; then
+  enableval="$enable_usbserial"
+  usbserial_flag=$enable_usbserial
+else
+  usbserial_flag=no
+fi;
 
-# Check whether --enable-all-features or --disable-all-features was given.
-if test "${enable_all_features+set}" = set; then
-  enableval="$enable_all_features"
-  all_features_flag=$enable_all_features
+# Check whether --enable-uucodec or --disable-uucodec was given.
+if test "${enable_uucodec+set}" = set; then
+  enableval="$enable_uucodec"
+  uucodec_flag=$enable_uucodec
 else
-  all_features_flag=no
-fi
+  uucodec_flag=no
+fi;
+
+# Check whether --enable-jffs2 or --disable-jffs2 was given.
+if test "${enable_jffs2+set}" = set; then
+  enableval="$enable_jffs2"
+  jffs2_flag=$enable_jffs2
+else
+  jffs2_flag=no
+fi;
+
+# Check whether --enable-cramfs or --disable-cramfs was given.
+if test "${enable_cramfs+set}" = set; then
+  enableval="$enable_cramfs"
+  cramfs_flag=$enable_cramfs
+else
+  cramfs_flag=no
+fi;
+
+# Check whether --enable-zimage or --disable-zimage was given.
+if test "${enable_zimage+set}" = set; then
+  enableval="$enable_zimage"
+  zimage_flag=$enable_zimage
+else
+  zimage_flag=no
+fi;
+
+# Check whether --enable-network or --disable-network was given.
+if test "${enable_network+set}" = set; then
+  enableval="$enable_network"
+  network_flag=$enable_network
+else
+  network_flag=no
+fi;
+
 
+# Check whether --enable-gio or --disable-gio was given.
+if test "${enable_gio+set}" = set; then
+  enableval="$enable_gio"
+  gio_flag=$enable_gio
+else
+  gio_flag=no
+fi;
+
+
+
+# Check whether --enable-all-features or --disable-all-features was given.
+if test "${enable_all_features+set}" = set; then
+  enableval="$enable_all_features"
+  all_features_flag=$enable_all_features
+else
+  all_features_flag=no
+fi;
 
 if test "x$all_features_flag" = "xyes" ; then
 	clock_scaling_flag=yes
 	chkmem_flag=yes
-	debug_flag=yes
 	lcd_flag=yes
 	md5_flag=yes
+	xmodem_flag=yes
+	usbserial_flag=yes
+	uucodec_flag=yes
+	jffs2_flag=yes
+	cramfs_flag=yes
+	zimage_flag=yes
+	network_flag=yes
+	network_flag=yes
 fi
 
 
 
+
 if test "x$clock_scaling_flag" = "xyes" ; then
 	if test "x$use_cpu" = "xsa1100"; then
-		CLOCK="clock.o"
+		BLOB_CLOCK_OBJS="clock.o"
 	else
-		echo "configure: warning: No clock scaling support for SA1110 CPUs, disabling" 1>&2
+		{ echo "$as_me:$LINENO: WARNING: No clock scaling support for SA1110 CPUs, disabling" >&5
+echo "$as_me: WARNING: No clock scaling support for SA1110 CPUs, disabling" >&2;}
 		clock_scaling_flag=no
-		CLOCK=""
+		BLOB_CLOCK_OBJS=""
 	fi
 fi
 
@@ -1741,26 +4152,25 @@
 
 
 if test "x$chkmem_flag" = "xyes" ; then
-	CHKMEM="chkmem.o"
+	BLOB_CHKMEM_OBJS="chkmem.o"
 fi
 
 
 
-if test "x$debug_flag" = "xyes" ; then
-	DEBUG="debug.o"
-fi
 
 
 
 if test "x$lcd_flag" = "xyes" ; then
 	if test "x$use_lcd" = "xyes" ; then
-		LCD="lcd.o"
-		cat >> confdefs.h <<\EOF
-#define CONFIG_LCD_SUPPORT 1
-EOF
+		DIAG_LCD_OBJS="lcd.o"
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_LCD_SUPPORT no
+_ACEOF
 
 	else
-		echo "configure: warning: No LCD support for ${board_name}, disabling" 1>&2
+		{ echo "$as_me:$LINENO: WARNING: No LCD support for ${board_name}, disabling" >&5
+echo "$as_me: WARNING: No LCD support for ${board_name}, disabling" >&2;}
 		LCD=""
 		lcd_flag="no"
 	fi
@@ -1768,19 +4178,155 @@
 
 
 
+
+
+
 if test "x$md5_flag" = "xyes" ; then
-        cat >> confdefs.h <<\EOF
-#define CONFIG_MD5_SUPPORT 1
-EOF
 
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_MD5_SUPPORT no
+_ACEOF
+
+fi
+
+
+
+
+if test "x$xmodem_flag" = "xyes" ; then
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_XMODEM_SUPPORT no
+_ACEOF
+
+	BLOB_XMODEM_OBJS="xmodem.o"
+	blob_commands="$blob_commands, xdownload";
+fi
+
+
+
+if test "x$usbserial_flag" = "xyes" ; then
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_USBSERIAL_SUPPORT no
+_ACEOF
+
+	BLOB_USBSERIAL_OBJS="serial-bvdusb.o bvd_usb_ctl.o bvd_usb_ep0.o bvd_usb_ep1.o bvd_usb_ep2.o"
+	blob_commands="$blob_commands, udownload";
 fi
 
 
 
 
+if test "x$uucodec_flag" = "xyes"; then
 
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_UUCODEC_SUPPORT no
+_ACEOF
+
+	BLOB_UUCODEC_OBJS="uucodec.o"
+	blob_commands="$blob_commands, download";
+fi
+
+
+
+
+
+
+if test "x$jffs2_flag" = "xyes" ; then
+	BLOB_JFFS2_OBJS="compr_rtime.o compr_rubin.o jffs2.o"
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_JFFS2_SUPPORT no
+_ACEOF
+
+fi
+
+
+
+
+
+
+if test "x$cramfs_flag" = "xyes" ; then
+	BLOB_CRAMFS_OBJS="cramfs.o"
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_CRAMFS_SUPPORT no
+_ACEOF
+
+fi
+
+
+
+
+if test "x$zimage_flag" = "xyes" ; then
+	BLOB_ZIMAGE_OBJS="zImage.o"
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_ZIMAGE_SUPPORT no
+_ACEOF
+
+fi
+
+
+
+if test "x$network_flag" = "xyes" ; then
+	BLOB_NETWORK_OBJS="bootp.o arp.o tftp.o ip_bits.o"
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_NETWORK_SUPPORT no
+_ACEOF
+
+	blob_commands="$blob_commands, arp, autoip, setip, tdownload, tftp";
+
+fi
+
+
+
+if test "x$gio_flag" = "xyes" ; then
+	BLOB_GIO_OBJS="generic_io.o gio_flash.o gio_part_blob.o gio_ram.o tar.o"
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_GIO_SUPPORT no
+_ACEOF
+
+	pcmcia_flag="yes";
+	ide_flag="yes";
+	cf_flag="yes";
+
+	blob_commands="$blob_commands, sysupd";
+fi
 
 
+if test "x$pcmcia_flag" = "xyes" ; then
+	BLOB_PCMCIA_OBJS="pcmcia.o"
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_PCMCIA_SUPPORT no
+_ACEOF
+
+
+fi
+
+
+if test "x$ide_flag" = "xyes" ; then
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_IDE_SUPPORT no
+_ACEOF
+
+	BLOB_IDE_OBJS="ide.o"
+fi
+
+
+if test "x$cf_flag" = "xyes" ; then
+
+cat >>confdefs.h <<\_ACEOF
+#define CONFIG_CF_SUPPORT no
+_ACEOF
+
+	BLOB_CF_OBJS="cf.o"
+fi
+
 
 # Check whether --enable-blob-debug or --disable-blob-debug was given.
 if test "${enable_blob_debug+set}" = set; then
@@ -1788,57 +4334,93 @@
   blob_debug_flag=$enable_blob_debug
 else
   blob_debug_flag=no
-fi
-
+fi;
 
 if test "x$blob_debug_flag" = "xyes" ; then
-  cat >> confdefs.h <<\EOF
-#define BLOB_DEBUG 1
-EOF
+
+cat >>confdefs.h <<\_ACEOF
+#define BLOB_DEBUG no
+_ACEOF
 
 fi
 
 
+ALL_COMMANDS=`echo $default_commands $all_commands | sed 's/,//g'`
+BLOB_COMMANDS=`echo $default_commands $blob_commands | sed 's/,//g'`
+
+
+
 
 
-echo $ac_n "checking for inline""... $ac_c" 1>&6
-echo "configure:1806: checking for inline" >&5
-if eval "test \"`echo '$''{'ac_cv_c_inline'+set}'`\" = set"; then
-  echo $ac_n "(cached) $ac_c" 1>&6
+echo "$as_me:$LINENO: checking for inline" >&5
+echo $ECHO_N "checking for inline... $ECHO_C" >&6
+if test "${ac_cv_c_inline+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
 else
   ac_cv_c_inline=no
 for ac_kw in inline __inline__ __inline; do
-  cat > conftest.$ac_ext <<EOF
-#line 1813 "configure"
-#include "confdefs.h"
-
-int main() {
-} $ac_kw foo() {
-; return 0; }
-EOF
-if { (eval echo configure:1820: \"$ac_compile\") 1>&5; (eval $ac_compile) 2>&5; }; then
-  rm -rf conftest*
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+#ifndef __cplusplus
+typedef int foo_t;
+static $ac_kw foo_t static_foo () {return 0; }
+$ac_kw foo_t foo () {return 0; }
+#endif
+
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
   ac_cv_c_inline=$ac_kw; break
 else
-  echo "configure: failed program was:" >&5
-  cat conftest.$ac_ext >&5
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
 fi
-rm -f conftest*
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
 done
 
 fi
+echo "$as_me:$LINENO: result: $ac_cv_c_inline" >&5
+echo "${ECHO_T}$ac_cv_c_inline" >&6
+
 
-echo "$ac_t""$ac_cv_c_inline" 1>&6
-case "$ac_cv_c_inline" in
+case $ac_cv_c_inline in
   inline | yes) ;;
-  no) cat >> confdefs.h <<\EOF
-#define inline 
-EOF
- ;;
-  *)  cat >> confdefs.h <<EOF
-#define inline $ac_cv_c_inline
-EOF
- ;;
+  *)
+    case $ac_cv_c_inline in
+      no) ac_val=;;
+      *) ac_val=$ac_cv_c_inline;;
+    esac
+    cat >>confdefs.h <<_ACEOF
+#ifndef __cplusplus
+#define inline $ac_val
+#endif
+_ACEOF
+    ;;
 esac
 
 
@@ -1847,451 +4429,1587 @@
 
 
 
+pcmcia_flag=${pcmcia_flag-no}
+cf_flag=${cf_flag-no}
+ide_flag=${ide_flag-no}
+
+echo "$as_me:$LINENO: checking for C flags to get more warnings" >&5
+echo $ECHO_N "checking for C flags to get more warnings... $ECHO_C" >&6
+ac_save_CFLAGS="$AM_CFLAGS"
 
-echo $ac_n "checking for C flags to get more warnings""... $ac_c" 1>&6
-echo "configure:1853: checking for C flags to get more warnings" >&5
-ac_save_CFLAGS="$CFLAGS"
 
-if test "x$ac_cv_prog_gcc" = "xyes" ; then
+if test "x$ac_cv_c_compiler_gnu" = "xyes" ; then
     warning_CFLAGS="-Wall"
 fi
 ac_ext=c
-# CFLAGS is not in ac_cpp because -g, -O, etc. are not valid cpp options.
 ac_cpp='$CPP $CPPFLAGS'
-ac_compile='${CC-cc} -c $CFLAGS $CPPFLAGS conftest.$ac_ext 1>&5'
-ac_link='${CC-cc} -o conftest${ac_exeext} $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS 1>&5'
-cross_compiling=$ac_cv_prog_cc_cross
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
 
-CFLAGS="$ac_save_CFLAGS"
+AM_CFLAGS="$ac_save_CFLAGS"
 if test "$warning_CFLAGS" = "none" ; then
-  echo "$ac_t""none" 1>&6
+  echo "$as_me:$LINENO: result: none" >&5
+echo "${ECHO_T}none" >&6
 else
-  CFLAGS="$CFLAGS $warning_CFLAGS"
-  echo "$ac_t""$warning_CFLAGS" 1>&6
-fi  
+  AM_CFLAGS="$CFLAGS $warning_CFLAGS"
+  echo "$as_me:$LINENO: result: $warning_CFLAGS" >&5
+echo "${ECHO_T}$warning_CFLAGS" >&6
+fi
 
+AM_CFLAGS=`echo $AM_CFLAGS | sed 's/\ *-g\ */\ /'`
+AM_LDFLAGS=`echo $AM_LDFLAGS | sed 's/\ *-g\ */\ /'`
 
-CFLAGS=`echo $CFLAGS | sed 's/\ *-g\ */\ /'`
-LDFLAGS=`echo $LDFLAGS | sed 's/\ *-g\ */\ /'`
+AM_CFLAGS=`echo $AM_CFLAGS | sed 's/-O2/-Os/'`
 
-CFLAGS=`echo $CFLAGS | sed 's/-O2/-Os/'`
 
-CFLAGS=`echo $CFLAGS -march=armv4 -mtune=strongarm1100 -fomit-frame-pointer -fno-builtin -mapcs-32 -nostdinc`
-LDFLAGS=`echo $LDFLAGS -static -nostdlib`
+case "$use_cpu" in
+    s3c2500)
+	cpu_cflags="-march=armv4"
+	;;
+    sa11?0)
+	cpu_cflags="-march=armv4 -mtune=strongarm1100"
+	;;
+    pxa2?0)
+		cpu_cflags="-march=armv4"
+	;;
+    *)
+	cpu_cflags=""
+	;;
+esac
+
+
+AM_CFLAGS=`echo $AM_CFLAGS $cpu_cflags -mapcs-32 -fomit-frame-pointer -fno-builtin`
+AM_LDFLAGS=`echo $AM_LDFLAGS -static -nostdlib`
 OCFLAGS="-O binary -R .note -R .comment -S"
 
 
 
-trap '' 1 2 15
-cat > confcache <<\EOF
+                                                                                                                                                                                              ac_config_files="$ac_config_files Makefile
+ doc/Makefile
+ include/Makefile
+ include/blob/Makefile
+ include/blob/arch/Makefile
+ include/blob/proc/Makefile
+ include/net/Makefile
+ src/Makefile
+ src/blob/Makefile
+ src/blob/xlli/Makefile
+ src/blob/xlli/mainstone/Makefile
+ src/commands/Makefile
+ src/diag/Makefile
+ src/lib/Makefile
+ tools/Makefile
+ utils/Makefile
+ utils/build/Makefile
+ utils/mkparamblock/Makefile"
+cat >confcache <<\_ACEOF
 # This file is a shell script that caches the results of configure
 # tests run on this system so they can be shared between configure
-# scripts and configure runs.  It is not useful on other systems.
-# If it contains results you don't want to keep, you may remove or edit it.
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
 #
-# By default, configure uses ./config.cache as the cache file,
-# creating it if it does not exist already.  You can give configure
-# the --cache-file=FILE option to use a different cache file; that is
-# what configure does when it calls configure scripts in
-# subdirectories, so they share the cache.
-# Giving --cache-file=/dev/null disables caching, for debugging configure.
-# config.status only pays attention to the cache file if you give it the
-# --recheck option to rerun configure.
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
 #
-EOF
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
 # The following way of writing the cache mishandles newlines in values,
 # but we know of no workaround that is simple, portable, and efficient.
 # So, don't put newlines in cache variables' values.
 # Ultrix sh set writes to stderr and can't be redirected directly,
 # and sets the high bit in the cache file unless we assign to the vars.
-(set) 2>&1 |
-  case `(ac_space=' '; set | grep ac_space) 2>&1` in
-  *ac_space=\ *)
-    # `set' does not quote correctly, so add quotes (double-quote substitution
-    # turns \\\\ into \\, and sed turns \\ into \).
-    sed -n \
-      -e "s/'/'\\\\''/g" \
-      -e "s/^\\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\\)=\\(.*\\)/\\1=\${\\1='\\2'}/p"
-    ;;
-  *)
-    # `set' quotes correctly as required by POSIX, so do not add quotes.
-    sed -n -e 's/^\([a-zA-Z0-9_]*_cv_[a-zA-Z0-9_]*\)=\(.*\)/\1=${\1=\2}/p'
-    ;;
-  esac >> confcache
-if cmp -s $cache_file confcache; then
-  :
-else
+{
+  (set) 2>&1 |
+    case `(ac_space=' '; set | grep ac_space) 2>&1` in
+    *ac_space=\ *)
+      # `set' does not quote correctly, so add quotes (double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;;
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n \
+	"s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
+      ;;
+    esac;
+} |
+  sed '
+     t clear
+     : clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     /^ac_cv_env/!s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     : end' >>confcache
+if diff $cache_file confcache >/dev/null 2>&1; then :; else
   if test -w $cache_file; then
-    echo "updating cache $cache_file"
-    cat confcache > $cache_file
+    test "x$cache_file" != "x/dev/null" && echo "updating cache $cache_file"
+    cat confcache >$cache_file
   else
     echo "not updating unwritable cache $cache_file"
   fi
 fi
 rm -f confcache
 
-trap 'rm -fr conftest* confdefs* core core.* *.core $ac_clean_files; exit 1' 1 2 15
-
 test "x$prefix" = xNONE && prefix=$ac_default_prefix
 # Let make expand exec_prefix.
 test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
 
-# Any assignment to VPATH causes Sun make to only execute
-# the first set of double-colon rules, so remove it if not needed.
-# If there is a colon in the path, we need to keep it.
+# VPATH may cause trouble with some makes, so we remove $(srcdir),
+# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# trailing colons and then remove the whole line if VPATH becomes empty
+# (actually we leave an empty line to preserve line numbers).
 if test "x$srcdir" = x.; then
-  ac_vpsub='/^[ 	]*VPATH[ 	]*=[^:]*$/d'
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
+s/:*\$(srcdir):*/:/;
+s/:*\${srcdir}:*/:/;
+s/:*@srcdir@:*/:/;
+s/^\([^=]*=[	 ]*\):*/\1/;
+s/:*$//;
+s/^[^=]*=[	 ]*$//;
+}'
 fi
 
-trap 'rm -f $CONFIG_STATUS conftest*; exit 1' 1 2 15
-
 DEFS=-DHAVE_CONFIG_H
 
-# Without the "./", some shells look in PATH for config.status.
-: ${CONFIG_STATUS=./config.status}
+ac_libobjs=
+ac_ltlibobjs=
+for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
+  # 1. Remove the extension, and $U if already installed.
+  ac_i=`echo "$ac_i" |
+	 sed 's/\$U\././;s/\.o$//;s/\.obj$//'`
+  # 2. Add them.
+  ac_libobjs="$ac_libobjs $ac_i\$U.$ac_objext"
+  ac_ltlibobjs="$ac_ltlibobjs $ac_i"'$U.lo'
+done
+LIBOBJS=$ac_libobjs
 
-echo creating $CONFIG_STATUS
-rm -f $CONFIG_STATUS
-cat > $CONFIG_STATUS <<EOF
-#! /bin/sh
-# Generated automatically by configure.
+LTLIBOBJS=$ac_ltlibobjs
+
+
+if test -z "${MAINTAINER_MODE_TRUE}" && test -z "${MAINTAINER_MODE_FALSE}"; then
+  { { echo "$as_me:$LINENO: error: conditional \"MAINTAINER_MODE\" was never defined.
+Usually this means the macro was only invoked conditionally." >&5
+echo "$as_me: error: conditional \"MAINTAINER_MODE\" was never defined.
+Usually this means the macro was only invoked conditionally." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+if test -z "${AMDEP_TRUE}" && test -z "${AMDEP_FALSE}"; then
+  { { echo "$as_me:$LINENO: error: conditional \"AMDEP\" was never defined.
+Usually this means the macro was only invoked conditionally." >&5
+echo "$as_me: error: conditional \"AMDEP\" was never defined.
+Usually this means the macro was only invoked conditionally." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+if test -z "${am__fastdepCC_TRUE}" && test -z "${am__fastdepCC_FALSE}"; then
+  { { echo "$as_me:$LINENO: error: conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." >&5
+echo "$as_me: error: conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+: ${CONFIG_STATUS=./config.status}
+ac_clean_files_save=$ac_clean_files
+ac_clean_files="$ac_clean_files $CONFIG_STATUS"
+{ echo "$as_me:$LINENO: creating $CONFIG_STATUS" >&5
+echo "$as_me: creating $CONFIG_STATUS" >&6;}
+cat >$CONFIG_STATUS <<_ACEOF
+#! $SHELL
+# Generated by $as_me.
 # Run this file to recreate the current configuration.
-# This directory was configured as follows,
-# on host `(hostname || uname -n) 2>/dev/null | sed 1q`:
-#
-# $0 $ac_configure_args
-#
 # Compiler output produced by configure, useful for debugging
-# configure, is in ./config.log if it exists.
+# configure, is in config.log if it exists.
 
-ac_cs_usage="Usage: $CONFIG_STATUS [--recheck] [--version] [--help]"
-for ac_option
+debug=false
+ac_cs_recheck=false
+ac_cs_silent=false
+SHELL=\${CONFIG_SHELL-$SHELL}
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+## --------------------- ##
+## M4sh Initialization.  ##
+## --------------------- ##
+
+# Be Bourne compatible
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+"$@"}'='"$@"'
+elif test -n "${BASH_VERSION+set}" && (set -o posix) >/dev/null 2>&1; then
+  set -o posix
+fi
+DUALCASE=1; export DUALCASE # for MKS sh
+
+# Support unset when possible.
+if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+  as_unset=unset
+else
+  as_unset=false
+fi
+
+
+# Work around bugs in pre-3.0 UWIN ksh.
+$as_unset ENV MAIL MAILPATH
+PS1='$ '
+PS2='> '
+PS4='+ '
+
+# NLS nuisances.
+for as_var in \
+  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
+  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
+  LC_TELEPHONE LC_TIME
 do
-  case "\$ac_option" in
+  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
+    eval $as_var=C; export $as_var
+  else
+    $as_unset $as_var
+  fi
+done
+
+# Required to use basename.
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+if (basename /) >/dev/null 2>&1 && test "X`basename / 2>&1`" = "X/"; then
+  as_basename=basename
+else
+  as_basename=false
+fi
+
+
+# Name of the executable.
+as_me=`$as_basename "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)$' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
+  	  /^X\/\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\/\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+
+
+# PATH needs CR, and LINENO needs CR and PATH.
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
+
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2"  || {
+  # Find who we are.  Look in the path if we contain no path at all
+  # relative or not.
+  case $0 in
+    *[\\/]* ) as_myself=$0 ;;
+    *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+done
+
+       ;;
+  esac
+  # We did not find ourselves, most probably we were run as `sh COMMAND'
+  # in which case we are not to be found in the path.
+  if test "x$as_myself" = x; then
+    as_myself=$0
+  fi
+  if test ! -f "$as_myself"; then
+    { { echo "$as_me:$LINENO: error: cannot find myself; rerun with an absolute path" >&5
+echo "$as_me: error: cannot find myself; rerun with an absolute path" >&2;}
+   { (exit 1); exit 1; }; }
+  fi
+  case $CONFIG_SHELL in
+  '')
+    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for as_base in sh bash ksh sh5; do
+	 case $as_dir in
+	 /*)
+	   if ("$as_dir/$as_base" -c '
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2" ') 2>/dev/null; then
+	     $as_unset BASH_ENV || test "${BASH_ENV+set}" != set || { BASH_ENV=; export BASH_ENV; }
+	     $as_unset ENV || test "${ENV+set}" != set || { ENV=; export ENV; }
+	     CONFIG_SHELL=$as_dir/$as_base
+	     export CONFIG_SHELL
+	     exec "$CONFIG_SHELL" "$0" ${1+"$@"}
+	   fi;;
+	 esac
+       done
+done
+;;
+  esac
+
+  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
+  # uniformly replaced by the line number.  The first 'sed' inserts a
+  # line-number line before each line; the second 'sed' does the real
+  # work.  The second script uses 'N' to pair each line-number line
+  # with the numbered line, and appends trailing '-' during
+  # substitution so that $LINENO is not a special case at line end.
+  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
+  # second 'sed' script.  Blame Lee E. McMahon for sed's syntax.  :-)
+  sed '=' <$as_myself |
+    sed '
+      N
+      s,$,-,
+      : loop
+      s,^\(['$as_cr_digits']*\)\(.*\)[$]LINENO\([^'$as_cr_alnum'_]\),\1\2\1\3,
+      t loop
+      s,-$,,
+      s,^['$as_cr_digits']*\n,,
+    ' >$as_me.lineno &&
+  chmod +x $as_me.lineno ||
+    { { echo "$as_me:$LINENO: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&5
+echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2;}
+   { (exit 1); exit 1; }; }
+
+  # Don't try to exec as it changes $[0], causing all sort of problems
+  # (the dirname of $[0] is not the place where we might find the
+  # original and so on.  Autoconf is especially sensible to this).
+  . ./$as_me.lineno
+  # Exit status is that of the last command.
+  exit
+}
+
+
+case `echo "testing\c"; echo 1,2,3`,`echo -n testing; echo 1,2,3` in
+  *c*,-n*) ECHO_N= ECHO_C='
+' ECHO_T='	' ;;
+  *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
+  *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
+esac
+
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+rm -f conf$$ conf$$.exe conf$$.file
+echo >conf$$.file
+if ln -s conf$$.file conf$$ 2>/dev/null; then
+  # We could just check for DJGPP; but this test a) works b) is more generic
+  # and c) will remain valid once DJGPP supports symlinks (DJGPP 2.04).
+  if test -f conf$$.exe; then
+    # Don't use ln at all; we don't have any links
+    as_ln_s='cp -p'
+  else
+    as_ln_s='ln -s'
+  fi
+elif ln conf$$.file conf$$ 2>/dev/null; then
+  as_ln_s=ln
+else
+  as_ln_s='cp -p'
+fi
+rm -f conf$$ conf$$.exe conf$$.file
+
+if mkdir -p . 2>/dev/null; then
+  as_mkdir_p=:
+else
+  test -d ./-p && rmdir ./-p
+  as_mkdir_p=false
+fi
+
+as_executable_p="test -f"
+
+# Sed expression to map a string onto a valid CPP name.
+as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
+
+# Sed expression to map a string onto a valid variable name.
+as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
+
+
+# IFS
+# We need space, tab and new line, in precisely that order.
+as_nl='
+'
+IFS=" 	$as_nl"
+
+# CDPATH.
+$as_unset CDPATH
+
+exec 6>&1
+
+# Open the log real soon, to keep \$[0] and so on meaningful, and to
+# report actual input values of CONFIG_FILES etc. instead of their
+# values after options handling.  Logging --version etc. is OK.
+exec 5>>config.log
+{
+  echo
+  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
+## Running $as_me. ##
+_ASBOX
+} >&5
+cat >&5 <<_CSEOF
+
+This file was extended by $as_me, which was
+generated by GNU Autoconf 2.59.  Invocation command line was
+
+  CONFIG_FILES    = $CONFIG_FILES
+  CONFIG_HEADERS  = $CONFIG_HEADERS
+  CONFIG_LINKS    = $CONFIG_LINKS
+  CONFIG_COMMANDS = $CONFIG_COMMANDS
+  $ $0 $@
+
+_CSEOF
+echo "on `(hostname || uname -n) 2>/dev/null | sed 1q`" >&5
+echo >&5
+_ACEOF
+
+# Files that config.status was made for.
+if test -n "$ac_config_files"; then
+  echo "config_files=\"$ac_config_files\"" >>$CONFIG_STATUS
+fi
+
+if test -n "$ac_config_headers"; then
+  echo "config_headers=\"$ac_config_headers\"" >>$CONFIG_STATUS
+fi
+
+if test -n "$ac_config_links"; then
+  echo "config_links=\"$ac_config_links\"" >>$CONFIG_STATUS
+fi
+
+if test -n "$ac_config_commands"; then
+  echo "config_commands=\"$ac_config_commands\"" >>$CONFIG_STATUS
+fi
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+
+ac_cs_usage="\
+\`$as_me' instantiates files from templates according to the
+current configuration.
+
+Usage: $0 [OPTIONS] [FILE]...
+
+  -h, --help       print this help, then exit
+  -V, --version    print version number, then exit
+  -q, --quiet      do not print progress messages
+  -d, --debug      don't remove temporary files
+      --recheck    update $as_me by reconfiguring in the same conditions
+  --file=FILE[:TEMPLATE]
+		   instantiate the configuration file FILE
+  --header=FILE[:TEMPLATE]
+		   instantiate the configuration header FILE
+
+Configuration files:
+$config_files
+
+Configuration headers:
+$config_headers
+
+Configuration commands:
+$config_commands
+
+Report bugs to <bug-autoconf@gnu.org>."
+_ACEOF
+
+cat >>$CONFIG_STATUS <<_ACEOF
+ac_cs_version="\\
+config.status
+configured by $0, generated by GNU Autoconf 2.59,
+  with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
+
+Copyright (C) 2003 Free Software Foundation, Inc.
+This config.status script is free software; the Free Software Foundation
+gives unlimited permission to copy, distribute and modify it."
+srcdir=$srcdir
+INSTALL="$INSTALL"
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+# If no file are specified by the user, then we need to provide default
+# value.  By we need to know if files were specified by the user.
+ac_need_defaults=:
+while test $# != 0
+do
+  case $1 in
+  --*=*)
+    ac_option=`expr "x$1" : 'x\([^=]*\)='`
+    ac_optarg=`expr "x$1" : 'x[^=]*=\(.*\)'`
+    ac_shift=:
+    ;;
+  -*)
+    ac_option=$1
+    ac_optarg=$2
+    ac_shift=shift
+    ;;
+  *) # This is not an option, so the user has probably given explicit
+     # arguments.
+     ac_option=$1
+     ac_need_defaults=false;;
+  esac
+
+  case $ac_option in
+  # Handling of the options.
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
   -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
-    echo "running \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion"
-    exec \${CONFIG_SHELL-/bin/sh} $0 $ac_configure_args --no-create --no-recursion ;;
-  -version | --version | --versio | --versi | --vers | --ver | --ve | --v)
-    echo "$CONFIG_STATUS generated by autoconf version 2.13"
-    exit 0 ;;
-  -help | --help | --hel | --he | --h)
-    echo "\$ac_cs_usage"; exit 0 ;;
-  *) echo "\$ac_cs_usage"; exit 1 ;;
+    ac_cs_recheck=: ;;
+  --version | --vers* | -V )
+    echo "$ac_cs_version"; exit 0 ;;
+  --he | --h)
+    # Conflict between --help and --header
+    { { echo "$as_me:$LINENO: error: ambiguous option: $1
+Try \`$0 --help' for more information." >&5
+echo "$as_me: error: ambiguous option: $1
+Try \`$0 --help' for more information." >&2;}
+   { (exit 1); exit 1; }; };;
+  --help | --hel | -h )
+    echo "$ac_cs_usage"; exit 0 ;;
+  --debug | --d* | -d )
+    debug=: ;;
+  --file | --fil | --fi | --f )
+    $ac_shift
+    CONFIG_FILES="$CONFIG_FILES $ac_optarg"
+    ac_need_defaults=false;;
+  --header | --heade | --head | --hea )
+    $ac_shift
+    CONFIG_HEADERS="$CONFIG_HEADERS $ac_optarg"
+    ac_need_defaults=false;;
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil | --si | --s)
+    ac_cs_silent=: ;;
+
+  # This is an error.
+  -*) { { echo "$as_me:$LINENO: error: unrecognized option: $1
+Try \`$0 --help' for more information." >&5
+echo "$as_me: error: unrecognized option: $1
+Try \`$0 --help' for more information." >&2;}
+   { (exit 1); exit 1; }; } ;;
+
+  *) ac_config_targets="$ac_config_targets $1" ;;
+
   esac
+  shift
 done
 
-ac_given_srcdir=$srcdir
-ac_given_INSTALL="$INSTALL"
+ac_configure_extra_args=
 
-trap 'rm -fr `echo "Makefile
-doc/Makefile
-include/Makefile
-include/blob/Makefile
-include/blob/arch/Makefile
-src/Makefile
-src/blob/Makefile
-src/diag/Makefile
-src/lib/Makefile
-tools/Makefile
-utils/Makefile
-utils/build/Makefile
-utils/mkparamblock/Makefile include/blob/config.h" | sed "s/:[^ ]*//g"` conftest*; exit 1' 1 2 15
-EOF
-cat >> $CONFIG_STATUS <<EOF
-
-# Protect against being on the right side of a sed subst in config.status.
-sed 's/%@/@@/; s/@%/@@/; s/%g\$/@g/; /@g\$/s/[\\\\&%]/\\\\&/g;
- s/@@/%@/; s/@@/@%/; s/@g\$/%g/' > conftest.subs <<\\CEOF
-$ac_vpsub
-$extrasub
-s%@SHELL@%$SHELL%g
-s%@CFLAGS@%$CFLAGS%g
-s%@CPPFLAGS@%$CPPFLAGS%g
-s%@CXXFLAGS@%$CXXFLAGS%g
-s%@FFLAGS@%$FFLAGS%g
-s%@DEFS@%$DEFS%g
-s%@LDFLAGS@%$LDFLAGS%g
-s%@LIBS@%$LIBS%g
-s%@exec_prefix@%$exec_prefix%g
-s%@prefix@%$prefix%g
-s%@program_transform_name@%$program_transform_name%g
-s%@bindir@%$bindir%g
-s%@sbindir@%$sbindir%g
-s%@libexecdir@%$libexecdir%g
-s%@datadir@%$datadir%g
-s%@sysconfdir@%$sysconfdir%g
-s%@sharedstatedir@%$sharedstatedir%g
-s%@localstatedir@%$localstatedir%g
-s%@libdir@%$libdir%g
-s%@includedir@%$includedir%g
-s%@oldincludedir@%$oldincludedir%g
-s%@infodir@%$infodir%g
-s%@mandir@%$mandir%g
-s%@INSTALL_PROGRAM@%$INSTALL_PROGRAM%g
-s%@INSTALL_SCRIPT@%$INSTALL_SCRIPT%g
-s%@INSTALL_DATA@%$INSTALL_DATA%g
-s%@PACKAGE@%$PACKAGE%g
-s%@VERSION@%$VERSION%g
-s%@ACLOCAL@%$ACLOCAL%g
-s%@AUTOCONF@%$AUTOCONF%g
-s%@AUTOMAKE@%$AUTOMAKE%g
-s%@AUTOHEADER@%$AUTOHEADER%g
-s%@MAKEINFO@%$MAKEINFO%g
-s%@SET_MAKE@%$SET_MAKE%g
-s%@MAINTAINER_MODE_TRUE@%$MAINTAINER_MODE_TRUE%g
-s%@MAINTAINER_MODE_FALSE@%$MAINTAINER_MODE_FALSE%g
-s%@MAINT@%$MAINT%g
-s%@host@%$host%g
-s%@host_alias@%$host_alias%g
-s%@host_cpu@%$host_cpu%g
-s%@host_vendor@%$host_vendor%g
-s%@host_os@%$host_os%g
-s%@CC@%$CC%g
-s%@OBJCOPY@%$OBJCOPY%g
-s%@RANLIB@%$RANLIB%g
-s%@AR@%$AR%g
-s%@LN_S@%$LN_S%g
-s%@MEMSETUP@%$MEMSETUP%g
-s%@CLOCK@%$CLOCK%g
-s%@CHKMEM@%$CHKMEM%g
-s%@DEBUG@%$DEBUG%g
-s%@LCD@%$LCD%g
-s%@BLOB_FLASH_OBJS@%$BLOB_FLASH_OBJS%g
-s%@BLOB_PLATFORM_OBJ@%$BLOB_PLATFORM_OBJ%g
-s%@DIAG_PLATFORM_OBJ@%$DIAG_PLATFORM_OBJ%g
-s%@OCFLAGS@%$OCFLAGS%g
+if $ac_cs_silent; then
+  exec 6>/dev/null
+  ac_configure_extra_args="$ac_configure_extra_args --silent"
+fi
+
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF
+if \$ac_cs_recheck; then
+  echo "running $SHELL $0 " $ac_configure_args \$ac_configure_extra_args " --no-create --no-recursion" >&6
+  exec $SHELL $0 $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+fi
+
+_ACEOF
+
+cat >>$CONFIG_STATUS <<_ACEOF
+#
+# INIT-COMMANDS section.
+#
+
+AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"
+
+_ACEOF
+
+
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+for ac_config_target in $ac_config_targets
+do
+  case "$ac_config_target" in
+  # Handling of arguments.
+  "Makefile
+" ) CONFIG_FILES="$CONFIG_FILES Makefile
+" ;;
+  "doc/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES doc/Makefile
+" ;;
+  "include/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES include/Makefile
+" ;;
+  "include/blob/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES include/blob/Makefile
+" ;;
+  "include/blob/arch/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES include/blob/arch/Makefile
+" ;;
+  "include/blob/proc/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES include/blob/proc/Makefile
+" ;;
+  "include/net/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES include/net/Makefile
+" ;;
+  "src/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES src/Makefile
+" ;;
+  "src/blob/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES src/blob/Makefile
+" ;;
+  "src/blob/xlli/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES src/blob/xlli/Makefile
+" ;;
+  "src/blob/xlli/mainstone/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES src/blob/xlli/mainstone/Makefile
+" ;;
+  "src/commands/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES src/commands/Makefile
+" ;;
+  "src/diag/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES src/diag/Makefile
+" ;;
+  "src/lib/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES src/lib/Makefile
+" ;;
+  "tools/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES tools/Makefile
+" ;;
+  "utils/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES utils/Makefile
+" ;;
+  "utils/build/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES utils/build/Makefile
+" ;;
+  "utils/mkparamblock/Makefile
+" ) CONFIG_FILES="$CONFIG_FILES utils/mkparamblock/Makefile
+" ;;
+  "utils/test/Makefile" ) CONFIG_FILES="$CONFIG_FILES utils/test/Makefile" ;;
+  "depfiles" ) CONFIG_COMMANDS="$CONFIG_COMMANDS depfiles" ;;
+  "include/blob/config.h" ) CONFIG_HEADERS="$CONFIG_HEADERS include/blob/config.h" ;;
+  *) { { echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
+echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
+   { (exit 1); exit 1; }; };;
+  esac
+done
+
+# If the user did not use the arguments to specify the items to instantiate,
+# then the envvar interface is used.  Set only those that are not.
+# We use the long form for the default assignment because of an extremely
+# bizarre bug on SunOS 4.1.3.
+if $ac_need_defaults; then
+  test "${CONFIG_FILES+set}" = set || CONFIG_FILES=$config_files
+  test "${CONFIG_HEADERS+set}" = set || CONFIG_HEADERS=$config_headers
+  test "${CONFIG_COMMANDS+set}" = set || CONFIG_COMMANDS=$config_commands
+fi
+
+# Have a temporary directory for convenience.  Make it in the build tree
+# simply because there is no reason to put it here, and in addition,
+# creating and moving files from /tmp can sometimes cause problems.
+# Create a temporary directory, and hook for its removal unless debugging.
+$debug ||
+{
+  trap 'exit_status=$?; rm -rf $tmp && exit $exit_status' 0
+  trap '{ (exit 1); exit 1; }' 1 2 13 15
+}
+
+# Create a (secure) tmp directory for tmp files.
+
+{
+  tmp=`(umask 077 && mktemp -d -q "./confstatXXXXXX") 2>/dev/null` &&
+  test -n "$tmp" && test -d "$tmp"
+}  ||
+{
+  tmp=./confstat$$-$RANDOM
+  (umask 077 && mkdir $tmp)
+} ||
+{
+   echo "$me: cannot create a temporary directory in ." >&2
+   { (exit 1); exit 1; }
+}
+
+_ACEOF
 
+cat >>$CONFIG_STATUS <<_ACEOF
+
+#
+# CONFIG_FILES section.
+#
+
+# No need to generate the scripts if there are no CONFIG_FILES.
+# This happens for instance when ./config.status config.h
+if test -n "\$CONFIG_FILES"; then
+  # Protect against being on the right side of a sed subst in config.status.
+  sed 's/,@/@@/; s/@,/@@/; s/,;t t\$/@;t t/; /@;t t\$/s/[\\\\&,]/\\\\&/g;
+   s/@@/,@/; s/@@/@,/; s/@;t t\$/,;t t/' >\$tmp/subs.sed <<\\CEOF
+s,@SHELL@,$SHELL,;t t
+s,@PATH_SEPARATOR@,$PATH_SEPARATOR,;t t
+s,@PACKAGE_NAME@,$PACKAGE_NAME,;t t
+s,@PACKAGE_TARNAME@,$PACKAGE_TARNAME,;t t
+s,@PACKAGE_VERSION@,$PACKAGE_VERSION,;t t
+s,@PACKAGE_STRING@,$PACKAGE_STRING,;t t
+s,@PACKAGE_BUGREPORT@,$PACKAGE_BUGREPORT,;t t
+s,@exec_prefix@,$exec_prefix,;t t
+s,@prefix@,$prefix,;t t
+s,@program_transform_name@,$program_transform_name,;t t
+s,@bindir@,$bindir,;t t
+s,@sbindir@,$sbindir,;t t
+s,@libexecdir@,$libexecdir,;t t
+s,@datadir@,$datadir,;t t
+s,@sysconfdir@,$sysconfdir,;t t
+s,@sharedstatedir@,$sharedstatedir,;t t
+s,@localstatedir@,$localstatedir,;t t
+s,@libdir@,$libdir,;t t
+s,@includedir@,$includedir,;t t
+s,@oldincludedir@,$oldincludedir,;t t
+s,@infodir@,$infodir,;t t
+s,@mandir@,$mandir,;t t
+s,@build_alias@,$build_alias,;t t
+s,@host_alias@,$host_alias,;t t
+s,@target_alias@,$target_alias,;t t
+s,@DEFS@,$DEFS,;t t
+s,@ECHO_C@,$ECHO_C,;t t
+s,@ECHO_N@,$ECHO_N,;t t
+s,@ECHO_T@,$ECHO_T,;t t
+s,@LIBS@,$LIBS,;t t
+s,@INSTALL_PROGRAM@,$INSTALL_PROGRAM,;t t
+s,@INSTALL_SCRIPT@,$INSTALL_SCRIPT,;t t
+s,@INSTALL_DATA@,$INSTALL_DATA,;t t
+s,@CYGPATH_W@,$CYGPATH_W,;t t
+s,@PACKAGE@,$PACKAGE,;t t
+s,@VERSION@,$VERSION,;t t
+s,@ACLOCAL@,$ACLOCAL,;t t
+s,@AUTOCONF@,$AUTOCONF,;t t
+s,@AUTOMAKE@,$AUTOMAKE,;t t
+s,@AUTOHEADER@,$AUTOHEADER,;t t
+s,@MAKEINFO@,$MAKEINFO,;t t
+s,@AMTAR@,$AMTAR,;t t
+s,@install_sh@,$install_sh,;t t
+s,@STRIP@,$STRIP,;t t
+s,@ac_ct_STRIP@,$ac_ct_STRIP,;t t
+s,@INSTALL_STRIP_PROGRAM@,$INSTALL_STRIP_PROGRAM,;t t
+s,@mkdir_p@,$mkdir_p,;t t
+s,@AWK@,$AWK,;t t
+s,@SET_MAKE@,$SET_MAKE,;t t
+s,@am__leading_dot@,$am__leading_dot,;t t
+s,@MAINTAINER_MODE_TRUE@,$MAINTAINER_MODE_TRUE,;t t
+s,@MAINTAINER_MODE_FALSE@,$MAINTAINER_MODE_FALSE,;t t
+s,@MAINT@,$MAINT,;t t
+s,@build@,$build,;t t
+s,@build_cpu@,$build_cpu,;t t
+s,@build_vendor@,$build_vendor,;t t
+s,@build_os@,$build_os,;t t
+s,@host@,$host,;t t
+s,@host_cpu@,$host_cpu,;t t
+s,@host_vendor@,$host_vendor,;t t
+s,@host_os@,$host_os,;t t
+s,@CC@,$CC,;t t
+s,@OBJCOPY@,$OBJCOPY,;t t
+s,@RANLIB@,$RANLIB,;t t
+s,@AR@,$AR,;t t
+s,@LD@,$LD,;t t
+s,@CFLAGS@,$CFLAGS,;t t
+s,@LDFLAGS@,$LDFLAGS,;t t
+s,@CPPFLAGS@,$CPPFLAGS,;t t
+s,@ac_ct_CC@,$ac_ct_CC,;t t
+s,@EXEEXT@,$EXEEXT,;t t
+s,@OBJEXT@,$OBJEXT,;t t
+s,@DEPDIR@,$DEPDIR,;t t
+s,@am__include@,$am__include,;t t
+s,@am__quote@,$am__quote,;t t
+s,@AMDEP_TRUE@,$AMDEP_TRUE,;t t
+s,@AMDEP_FALSE@,$AMDEP_FALSE,;t t
+s,@AMDEPBACKSLASH@,$AMDEPBACKSLASH,;t t
+s,@CCDEPMODE@,$CCDEPMODE,;t t
+s,@am__fastdepCC_TRUE@,$am__fastdepCC_TRUE,;t t
+s,@am__fastdepCC_FALSE@,$am__fastdepCC_FALSE,;t t
+s,@ac_ct_RANLIB@,$ac_ct_RANLIB,;t t
+s,@LN_S@,$LN_S,;t t
+s,@CCAS@,$CCAS,;t t
+s,@CCASFLAGS@,$CCASFLAGS,;t t
+s,@BLOB_FLASH_OBJS@,$BLOB_FLASH_OBJS,;t t
+s,@BLOB_PLATFORM_OBJS@,$BLOB_PLATFORM_OBJS,;t t
+s,@DIAG_PLATFORM_OBJS@,$DIAG_PLATFORM_OBJS,;t t
+s,@BLOB_STARTCODE_OBJS@,$BLOB_STARTCODE_OBJS,;t t
+s,@BLOB_MEMSETUP_OBJS@,$BLOB_MEMSETUP_OBJS,;t t
+s,@BLOB_REBOOT_DRIVER_OBJS@,$BLOB_REBOOT_DRIVER_OBJS,;t t
+s,@BLOB_SPI_OBJS@,$BLOB_SPI_OBJS,;t t
+s,@BLOB_LCD_OBJS@,$BLOB_LCD_OBJS,;t t
+s,@BLOB_SERIAL_DRIVER_OBJS@,$BLOB_SERIAL_DRIVER_OBJS,;t t
+s,@BLOB_TIMER_DRIVER_OBJS@,$BLOB_TIMER_DRIVER_OBJS,;t t
+s,@BLOB_LED_STARTCODE@,$BLOB_LED_STARTCODE,;t t
+s,@BLOB_LED_DRIVER_OBJS@,$BLOB_LED_DRIVER_OBJS,;t t
+s,@BLOB_NETWORK_DRIVER_OBJS@,$BLOB_NETWORK_DRIVER_OBJS,;t t
+s,@BLOB_TARGET@,$BLOB_TARGET,;t t
+s,@LINUX_INCLUDE@,$LINUX_INCLUDE,;t t
+s,@BLOB_CLOCK_OBJS@,$BLOB_CLOCK_OBJS,;t t
+s,@BLOB_CHKMEM_OBJS@,$BLOB_CHKMEM_OBJS,;t t
+s,@DIAG_LCD_OBJS@,$DIAG_LCD_OBJS,;t t
+s,@BLOB_XMODEM_OBJS@,$BLOB_XMODEM_OBJS,;t t
+s,@BLOB_USBSERIAL_OBJS@,$BLOB_USBSERIAL_OBJS,;t t
+s,@BLOB_UUCODEC_OBJS@,$BLOB_UUCODEC_OBJS,;t t
+s,@BLOB_JFFS2_OBJS@,$BLOB_JFFS2_OBJS,;t t
+s,@BLOB_CRAMFS_OBJS@,$BLOB_CRAMFS_OBJS,;t t
+s,@BLOB_ZIMAGE_OBJS@,$BLOB_ZIMAGE_OBJS,;t t
+s,@BLOB_NETWORK_OBJS@,$BLOB_NETWORK_OBJS,;t t
+s,@BLOB_GIO_OBJS@,$BLOB_GIO_OBJS,;t t
+s,@BLOB_PCMCIA_OBJS@,$BLOB_PCMCIA_OBJS,;t t
+s,@BLOB_IDE_OBJS@,$BLOB_IDE_OBJS,;t t
+s,@BLOB_CF_OBJS@,$BLOB_CF_OBJS,;t t
+s,@ALL_COMMANDS@,$ALL_COMMANDS,;t t
+s,@BLOB_COMMANDS@,$BLOB_COMMANDS,;t t
+s,@OCFLAGS@,$OCFLAGS,;t t
+s,@LIBOBJS@,$LIBOBJS,;t t
+s,@LTLIBOBJS@,$LTLIBOBJS,;t t
 CEOF
-EOF
 
-cat >> $CONFIG_STATUS <<\EOF
+_ACEOF
 
-# Split the substitutions into bite-sized pieces for seds with
-# small command number limits, like on Digital OSF/1 and HP-UX.
-ac_max_sed_cmds=90 # Maximum number of lines to put in a sed script.
-ac_file=1 # Number of current file.
-ac_beg=1 # First line for current file.
-ac_end=$ac_max_sed_cmds # Line after last line for current file.
-ac_more_lines=:
-ac_sed_cmds=""
-while $ac_more_lines; do
-  if test $ac_beg -gt 1; then
-    sed "1,${ac_beg}d; ${ac_end}q" conftest.subs > conftest.s$ac_file
-  else
-    sed "${ac_end}q" conftest.subs > conftest.s$ac_file
-  fi
-  if test ! -s conftest.s$ac_file; then
-    ac_more_lines=false
-    rm -f conftest.s$ac_file
-  else
-    if test -z "$ac_sed_cmds"; then
-      ac_sed_cmds="sed -f conftest.s$ac_file"
+  cat >>$CONFIG_STATUS <<\_ACEOF
+  # Split the substitutions into bite-sized pieces for seds with
+  # small command number limits, like on Digital OSF/1 and HP-UX.
+  ac_max_sed_lines=48
+  ac_sed_frag=1 # Number of current file.
+  ac_beg=1 # First line for current file.
+  ac_end=$ac_max_sed_lines # Line after last line for current file.
+  ac_more_lines=:
+  ac_sed_cmds=
+  while $ac_more_lines; do
+    if test $ac_beg -gt 1; then
+      sed "1,${ac_beg}d; ${ac_end}q" $tmp/subs.sed >$tmp/subs.frag
     else
-      ac_sed_cmds="$ac_sed_cmds | sed -f conftest.s$ac_file"
+      sed "${ac_end}q" $tmp/subs.sed >$tmp/subs.frag
     fi
-    ac_file=`expr $ac_file + 1`
-    ac_beg=$ac_end
-    ac_end=`expr $ac_end + $ac_max_sed_cmds`
-  fi
-done
-if test -z "$ac_sed_cmds"; then
-  ac_sed_cmds=cat
-fi
-EOF
-
-cat >> $CONFIG_STATUS <<EOF
-
-CONFIG_FILES=\${CONFIG_FILES-"Makefile
-doc/Makefile
-include/Makefile
-include/blob/Makefile
-include/blob/arch/Makefile
-src/Makefile
-src/blob/Makefile
-src/diag/Makefile
-src/lib/Makefile
-tools/Makefile
-utils/Makefile
-utils/build/Makefile
-utils/mkparamblock/Makefile"}
-EOF
-cat >> $CONFIG_STATUS <<\EOF
-for ac_file in .. $CONFIG_FILES; do if test "x$ac_file" != x..; then
+    if test ! -s $tmp/subs.frag; then
+      ac_more_lines=false
+    else
+      # The purpose of the label and of the branching condition is to
+      # speed up the sed processing (if there are no `@' at all, there
+      # is no need to browse any of the substitutions).
+      # These are the two extra sed commands mentioned above.
+      (echo ':t
+  /@[a-zA-Z_][a-zA-Z_0-9]*@/!b' && cat $tmp/subs.frag) >$tmp/subs-$ac_sed_frag.sed
+      if test -z "$ac_sed_cmds"; then
+	ac_sed_cmds="sed -f $tmp/subs-$ac_sed_frag.sed"
+      else
+	ac_sed_cmds="$ac_sed_cmds | sed -f $tmp/subs-$ac_sed_frag.sed"
+      fi
+      ac_sed_frag=`expr $ac_sed_frag + 1`
+      ac_beg=$ac_end
+      ac_end=`expr $ac_end + $ac_max_sed_lines`
+    fi
+  done
+  if test -z "$ac_sed_cmds"; then
+    ac_sed_cmds=cat
+  fi
+fi # test -n "$CONFIG_FILES"
+
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+for ac_file in : $CONFIG_FILES; do test "x$ac_file" = x: && continue
   # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
-  case "$ac_file" in
-  *:*) ac_file_in=`echo "$ac_file"|sed 's%[^:]*:%%'`
-       ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
-  *) ac_file_in="${ac_file}.in" ;;
+  case $ac_file in
+  - | *:- | *:-:* ) # input from stdin
+	cat >$tmp/stdin
+	ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  *:* ) ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  * )   ac_file_in=$ac_file.in ;;
   esac
 
-  # Adjust a relative srcdir, top_srcdir, and INSTALL for subdirectories.
-
-  # Remove last slash and all that follows it.  Not all systems have dirname.
-  ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
-  if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
-    # The file is in a subdirectory.
-    test ! -d "$ac_dir" && mkdir "$ac_dir"
-    ac_dir_suffix="/`echo $ac_dir|sed 's%^\./%%'`"
-    # A "../" for each directory in $ac_dir_suffix.
-    ac_dots=`echo $ac_dir_suffix|sed 's%/[^/]*%../%g'`
-  else
-    ac_dir_suffix= ac_dots=
-  fi
-
-  case "$ac_given_srcdir" in
-  .)  srcdir=.
-      if test -z "$ac_dots"; then top_srcdir=.
-      else top_srcdir=`echo $ac_dots|sed 's%/$%%'`; fi ;;
-  /*) srcdir="$ac_given_srcdir$ac_dir_suffix"; top_srcdir="$ac_given_srcdir" ;;
+  # Compute @srcdir@, @top_srcdir@, and @INSTALL@ for subdirectories.
+  ac_dir=`(dirname "$ac_file") 2>/dev/null ||
+$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_file" : 'X\(//\)[^/]' \| \
+	 X"$ac_file" : 'X\(//\)$' \| \
+	 X"$ac_file" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$ac_file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+  { if $as_mkdir_p; then
+    mkdir -p "$ac_dir"
+  else
+    as_dir="$ac_dir"
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory \"$ac_dir\"" >&5
+echo "$as_me: error: cannot create directory \"$ac_dir\"" >&2;}
+   { (exit 1); exit 1; }; }; }
+
+  ac_builddir=.
+
+if test "$ac_dir" != .; then
+  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  # A "../" for each directory in $ac_dir_suffix.
+  ac_top_builddir=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,../,g'`
+else
+  ac_dir_suffix= ac_top_builddir=
+fi
+
+case $srcdir in
+  .)  # No --srcdir option.  We are building in place.
+    ac_srcdir=.
+    if test -z "$ac_top_builddir"; then
+       ac_top_srcdir=.
+    else
+       ac_top_srcdir=`echo $ac_top_builddir | sed 's,/$,,'`
+    fi ;;
+  [\\/]* | ?:[\\/]* )  # Absolute path.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir ;;
   *) # Relative path.
-    srcdir="$ac_dots$ac_given_srcdir$ac_dir_suffix"
-    top_srcdir="$ac_dots$ac_given_srcdir" ;;
-  esac
+    ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_builddir$srcdir ;;
+esac
+
+# Do not use `cd foo && pwd` to compute absolute paths, because
+# the directories may not exist.
+case `pwd` in
+.) ac_abs_builddir="$ac_dir";;
+*)
+  case "$ac_dir" in
+  .) ac_abs_builddir=`pwd`;;
+  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
+  *) ac_abs_builddir=`pwd`/"$ac_dir";;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_builddir=${ac_top_builddir}.;;
+*)
+  case ${ac_top_builddir}. in
+  .) ac_abs_top_builddir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
+  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_srcdir=$ac_srcdir;;
+*)
+  case $ac_srcdir in
+  .) ac_abs_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
+  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_srcdir=$ac_top_srcdir;;
+*)
+  case $ac_top_srcdir in
+  .) ac_abs_top_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
+  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
+  esac;;
+esac
 
-  case "$ac_given_INSTALL" in
-  [/$]*) INSTALL="$ac_given_INSTALL" ;;
-  *) INSTALL="$ac_dots$ac_given_INSTALL" ;;
-  esac
 
-  echo creating "$ac_file"
-  rm -f "$ac_file"
-  configure_input="Generated automatically from `echo $ac_file_in|sed 's%.*/%%'` by configure."
-  case "$ac_file" in
-  *Makefile*) ac_comsub="1i\\
-# $configure_input" ;;
-  *) ac_comsub= ;;
+  case $INSTALL in
+  [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
+  *) ac_INSTALL=$ac_top_builddir$INSTALL ;;
   esac
 
-  ac_file_inputs=`echo $ac_file_in|sed -e "s%^%$ac_given_srcdir/%" -e "s%:% $ac_given_srcdir/%g"`
-  sed -e "$ac_comsub
-s%@configure_input@%$configure_input%g
-s%@srcdir@%$srcdir%g
-s%@top_srcdir@%$top_srcdir%g
-s%@INSTALL@%$INSTALL%g
-" $ac_file_inputs | (eval "$ac_sed_cmds") > $ac_file
-fi; done
-rm -f conftest.s*
+  if test x"$ac_file" != x-; then
+    { echo "$as_me:$LINENO: creating $ac_file" >&5
+echo "$as_me: creating $ac_file" >&6;}
+    rm -f "$ac_file"
+  fi
+  # Let's still pretend it is `configure' which instantiates (i.e., don't
+  # use $as_me), people would be surprised to read:
+  #    /* config.h.  Generated by config.status.  */
+  if test x"$ac_file" = x-; then
+    configure_input=
+  else
+    configure_input="$ac_file.  "
+  fi
+  configure_input=$configure_input"Generated from `echo $ac_file_in |
+				     sed 's,.*/,,'` by configure."
+
+  # First look for the input files in the build tree, otherwise in the
+  # src tree.
+  ac_file_inputs=`IFS=:
+    for f in $ac_file_in; do
+      case $f in
+      -) echo $tmp/stdin ;;
+      [\\/$]*)
+	 # Absolute (can't be DOS-style, as IFS=:)
+	 test -f "$f" || { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 echo "$f";;
+      *) # Relative
+	 if test -f "$f"; then
+	   # Build tree
+	   echo "$f"
+	 elif test -f "$srcdir/$f"; then
+	   # Source tree
+	   echo "$srcdir/$f"
+	 else
+	   # /dev/null tree
+	   { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 fi;;
+      esac
+    done` || { (exit 1); exit 1; }
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF
+  sed "$ac_vpsub
+$extrasub
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+:t
+/@[a-zA-Z_][a-zA-Z_0-9]*@/!b
+s,@configure_input@,$configure_input,;t t
+s,@srcdir@,$ac_srcdir,;t t
+s,@abs_srcdir@,$ac_abs_srcdir,;t t
+s,@top_srcdir@,$ac_top_srcdir,;t t
+s,@abs_top_srcdir@,$ac_abs_top_srcdir,;t t
+s,@builddir@,$ac_builddir,;t t
+s,@abs_builddir@,$ac_abs_builddir,;t t
+s,@top_builddir@,$ac_top_builddir,;t t
+s,@abs_top_builddir@,$ac_abs_top_builddir,;t t
+s,@INSTALL@,$ac_INSTALL,;t t
+" $ac_file_inputs | (eval "$ac_sed_cmds") >$tmp/out
+  rm -f $tmp/stdin
+  if test x"$ac_file" != x-; then
+    mv $tmp/out $ac_file
+  else
+    cat $tmp/out
+    rm -f $tmp/out
+  fi
+
+done
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+
+#
+# CONFIG_HEADER section.
+#
 
 # These sed commands are passed to sed as "A NAME B NAME C VALUE D", where
 # NAME is the cpp macro being defined and VALUE is the value it is being given.
 #
 # ac_d sets the value in "#define NAME VALUE" lines.
-ac_dA='s%^\([ 	]*\)#\([ 	]*define[ 	][ 	]*\)'
-ac_dB='\([ 	][ 	]*\)[^ 	]*%\1#\2'
-ac_dC='\3'
-ac_dD='%g'
-# ac_u turns "#undef NAME" with trailing blanks into "#define NAME VALUE".
-ac_uA='s%^\([ 	]*\)#\([ 	]*\)undef\([ 	][ 	]*\)'
-ac_uB='\([ 	]\)%\1#\2define\3'
+ac_dA='s,^\([	 ]*\)#\([	 ]*define[	 ][	 ]*\)'
+ac_dB='[	 ].*$,\1#\2'
+ac_dC=' '
+ac_dD=',;t'
+# ac_u turns "#undef NAME" without trailing blanks into "#define NAME VALUE".
+ac_uA='s,^\([	 ]*\)#\([	 ]*\)undef\([	 ][	 ]*\)'
+ac_uB='$,\1#\2define\3'
 ac_uC=' '
-ac_uD='\4%g'
-# ac_e turns "#undef NAME" without trailing blanks into "#define NAME VALUE".
-ac_eA='s%^\([ 	]*\)#\([ 	]*\)undef\([ 	][ 	]*\)'
-ac_eB='$%\1#\2define\3'
-ac_eC=' '
-ac_eD='%g'
-
-if test "${CONFIG_HEADERS+set}" != set; then
-EOF
-cat >> $CONFIG_STATUS <<EOF
-  CONFIG_HEADERS="include/blob/config.h"
-EOF
-cat >> $CONFIG_STATUS <<\EOF
-fi
-for ac_file in .. $CONFIG_HEADERS; do if test "x$ac_file" != x..; then
+ac_uD=',;t'
+
+for ac_file in : $CONFIG_HEADERS; do test "x$ac_file" = x: && continue
   # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
-  case "$ac_file" in
-  *:*) ac_file_in=`echo "$ac_file"|sed 's%[^:]*:%%'`
-       ac_file=`echo "$ac_file"|sed 's%:.*%%'` ;;
-  *) ac_file_in="${ac_file}.in" ;;
+  case $ac_file in
+  - | *:- | *:-:* ) # input from stdin
+	cat >$tmp/stdin
+	ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  *:* ) ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  * )   ac_file_in=$ac_file.in ;;
   esac
 
-  echo creating $ac_file
+  test x"$ac_file" != x- && { echo "$as_me:$LINENO: creating $ac_file" >&5
+echo "$as_me: creating $ac_file" >&6;}
 
-  rm -f conftest.frag conftest.in conftest.out
-  ac_file_inputs=`echo $ac_file_in|sed -e "s%^%$ac_given_srcdir/%" -e "s%:% $ac_given_srcdir/%g"`
-  cat $ac_file_inputs > conftest.in
-
-EOF
-
-# Transform confdefs.h into a sed script conftest.vals that substitutes
-# the proper values into config.h.in to produce config.h.  And first:
-# Protect against being on the right side of a sed subst in config.status.
-# Protect against being in an unquoted here document in config.status.
-rm -f conftest.vals
-cat > conftest.hdr <<\EOF
-s/[\\&%]/\\&/g
-s%[\\$`]%\\&%g
-s%#define \([A-Za-z_][A-Za-z0-9_]*\) *\(.*\)%${ac_dA}\1${ac_dB}\1${ac_dC}\2${ac_dD}%gp
-s%ac_d%ac_u%gp
-s%ac_u%ac_e%gp
-EOF
-sed -n -f conftest.hdr confdefs.h > conftest.vals
-rm -f conftest.hdr
+  # First look for the input files in the build tree, otherwise in the
+  # src tree.
+  ac_file_inputs=`IFS=:
+    for f in $ac_file_in; do
+      case $f in
+      -) echo $tmp/stdin ;;
+      [\\/$]*)
+	 # Absolute (can't be DOS-style, as IFS=:)
+	 test -f "$f" || { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 # Do quote $f, to prevent DOS paths from being IFS'd.
+	 echo "$f";;
+      *) # Relative
+	 if test -f "$f"; then
+	   # Build tree
+	   echo "$f"
+	 elif test -f "$srcdir/$f"; then
+	   # Source tree
+	   echo "$srcdir/$f"
+	 else
+	   # /dev/null tree
+	   { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 fi;;
+      esac
+    done` || { (exit 1); exit 1; }
+  # Remove the trailing spaces.
+  sed 's/[	 ]*$//' $ac_file_inputs >$tmp/in
+
+_ACEOF
+
+# Transform confdefs.h into two sed scripts, `conftest.defines' and
+# `conftest.undefs', that substitutes the proper values into
+# config.h.in to produce config.h.  The first handles `#define'
+# templates, and the second `#undef' templates.
+# And first: Protect against being on the right side of a sed subst in
+# config.status.  Protect against being in an unquoted here document
+# in config.status.
+rm -f conftest.defines conftest.undefs
+# Using a here document instead of a string reduces the quoting nightmare.
+# Putting comments in sed scripts is not portable.
+#
+# `end' is used to avoid that the second main sed command (meant for
+# 0-ary CPP macros) applies to n-ary macro definitions.
+# See the Autoconf documentation for `clear'.
+cat >confdef2sed.sed <<\_ACEOF
+s/[\\&,]/\\&/g
+s,[\\$`],\\&,g
+t clear
+: clear
+s,^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 (][^	 (]*\)\(([^)]*)\)[	 ]*\(.*\)$,${ac_dA}\1${ac_dB}\1\2${ac_dC}\3${ac_dD},gp
+t end
+s,^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 ][^	 ]*\)[	 ]*\(.*\)$,${ac_dA}\1${ac_dB}\1${ac_dC}\2${ac_dD},gp
+: end
+_ACEOF
+# If some macros were called several times there might be several times
+# the same #defines, which is useless.  Nevertheless, we may not want to
+# sort them, since we want the *last* AC-DEFINE to be honored.
+uniq confdefs.h | sed -n -f confdef2sed.sed >conftest.defines
+sed 's/ac_d/ac_u/g' conftest.defines >conftest.undefs
+rm -f confdef2sed.sed
 
 # This sed command replaces #undef with comments.  This is necessary, for
 # example, in the case of _POSIX_SOURCE, which is predefined and required
 # on some systems where configure will not decide to define it.
-cat >> conftest.vals <<\EOF
-s%^[ 	]*#[ 	]*undef[ 	][ 	]*[a-zA-Z_][a-zA-Z_0-9]*%/* & */%
-EOF
-
-# Break up conftest.vals because some shells have a limit on
-# the size of here documents, and old seds have small limits too.
-
+cat >>conftest.undefs <<\_ACEOF
+s,^[	 ]*#[	 ]*undef[	 ][	 ]*[a-zA-Z_][a-zA-Z_0-9]*,/* & */,
+_ACEOF
+
+# Break up conftest.defines because some shells have a limit on the size
+# of here documents, and old seds have small limits too (100 cmds).
+echo '  # Handle all the #define templates only if necessary.' >>$CONFIG_STATUS
+echo '  if grep "^[	 ]*#[	 ]*define" $tmp/in >/dev/null; then' >>$CONFIG_STATUS
+echo '  # If there are no defines, we may have an empty if/fi' >>$CONFIG_STATUS
+echo '  :' >>$CONFIG_STATUS
 rm -f conftest.tail
-while :
+while grep . conftest.defines >/dev/null
 do
-  ac_lines=`grep -c . conftest.vals`
-  # grep -c gives empty output for an empty file on some AIX systems.
-  if test -z "$ac_lines" || test "$ac_lines" -eq 0; then break; fi
-  # Write a limited-size here document to conftest.frag.
-  echo '  cat > conftest.frag <<CEOF' >> $CONFIG_STATUS
-  sed ${ac_max_here_lines}q conftest.vals >> $CONFIG_STATUS
+  # Write a limited-size here document to $tmp/defines.sed.
+  echo '  cat >$tmp/defines.sed <<CEOF' >>$CONFIG_STATUS
+  # Speed up: don't consider the non `#define' lines.
+  echo '/^[	 ]*#[	 ]*define/!b' >>$CONFIG_STATUS
+  # Work around the forget-to-reset-the-flag bug.
+  echo 't clr' >>$CONFIG_STATUS
+  echo ': clr' >>$CONFIG_STATUS
+  sed ${ac_max_here_lines}q conftest.defines >>$CONFIG_STATUS
   echo 'CEOF
-  sed -f conftest.frag conftest.in > conftest.out
-  rm -f conftest.in
-  mv conftest.out conftest.in
-' >> $CONFIG_STATUS
-  sed 1,${ac_max_here_lines}d conftest.vals > conftest.tail
-  rm -f conftest.vals
-  mv conftest.tail conftest.vals
-done
-rm -f conftest.vals
-
-cat >> $CONFIG_STATUS <<\EOF
-  rm -f conftest.frag conftest.h
-  echo "/* $ac_file.  Generated automatically by configure.  */" > conftest.h
-  cat conftest.in >> conftest.h
-  rm -f conftest.in
-  if cmp -s $ac_file conftest.h 2>/dev/null; then
-    echo "$ac_file is unchanged"
-    rm -f conftest.h
-  else
-    # Remove last slash and all that follows it.  Not all systems have dirname.
-      ac_dir=`echo $ac_file|sed 's%/[^/][^/]*$%%'`
-      if test "$ac_dir" != "$ac_file" && test "$ac_dir" != .; then
-      # The file is in a subdirectory.
-      test ! -d "$ac_dir" && mkdir "$ac_dir"
+  sed -f $tmp/defines.sed $tmp/in >$tmp/out
+  rm -f $tmp/in
+  mv $tmp/out $tmp/in
+' >>$CONFIG_STATUS
+  sed 1,${ac_max_here_lines}d conftest.defines >conftest.tail
+  rm -f conftest.defines
+  mv conftest.tail conftest.defines
+done
+rm -f conftest.defines
+echo '  fi # grep' >>$CONFIG_STATUS
+echo >>$CONFIG_STATUS
+
+# Break up conftest.undefs because some shells have a limit on the size
+# of here documents, and old seds have small limits too (100 cmds).
+echo '  # Handle all the #undef templates' >>$CONFIG_STATUS
+rm -f conftest.tail
+while grep . conftest.undefs >/dev/null
+do
+  # Write a limited-size here document to $tmp/undefs.sed.
+  echo '  cat >$tmp/undefs.sed <<CEOF' >>$CONFIG_STATUS
+  # Speed up: don't consider the non `#undef'
+  echo '/^[	 ]*#[	 ]*undef/!b' >>$CONFIG_STATUS
+  # Work around the forget-to-reset-the-flag bug.
+  echo 't clr' >>$CONFIG_STATUS
+  echo ': clr' >>$CONFIG_STATUS
+  sed ${ac_max_here_lines}q conftest.undefs >>$CONFIG_STATUS
+  echo 'CEOF
+  sed -f $tmp/undefs.sed $tmp/in >$tmp/out
+  rm -f $tmp/in
+  mv $tmp/out $tmp/in
+' >>$CONFIG_STATUS
+  sed 1,${ac_max_here_lines}d conftest.undefs >conftest.tail
+  rm -f conftest.undefs
+  mv conftest.tail conftest.undefs
+done
+rm -f conftest.undefs
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+  # Let's still pretend it is `configure' which instantiates (i.e., don't
+  # use $as_me), people would be surprised to read:
+  #    /* config.h.  Generated by config.status.  */
+  if test x"$ac_file" = x-; then
+    echo "/* Generated by configure.  */" >$tmp/config.h
+  else
+    echo "/* $ac_file.  Generated by configure.  */" >$tmp/config.h
+  fi
+  cat $tmp/in >>$tmp/config.h
+  rm -f $tmp/in
+  if test x"$ac_file" != x-; then
+    if diff $ac_file $tmp/config.h >/dev/null 2>&1; then
+      { echo "$as_me:$LINENO: $ac_file is unchanged" >&5
+echo "$as_me: $ac_file is unchanged" >&6;}
+    else
+      ac_dir=`(dirname "$ac_file") 2>/dev/null ||
+$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_file" : 'X\(//\)[^/]' \| \
+	 X"$ac_file" : 'X\(//\)$' \| \
+	 X"$ac_file" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$ac_file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+      { if $as_mkdir_p; then
+    mkdir -p "$ac_dir"
+  else
+    as_dir="$ac_dir"
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory \"$ac_dir\"" >&5
+echo "$as_me: error: cannot create directory \"$ac_dir\"" >&2;}
+   { (exit 1); exit 1; }; }; }
+
+      rm -f $ac_file
+      mv $tmp/config.h $ac_file
     fi
-    rm -f $ac_file
-    mv conftest.h $ac_file
+  else
+    cat $tmp/config.h
+    rm -f $tmp/config.h
   fi
-fi; done
+# Compute $ac_file's index in $config_headers.
+_am_stamp_count=1
+for _am_header in $config_headers :; do
+  case $_am_header in
+    $ac_file | $ac_file:* )
+      break ;;
+    * )
+      _am_stamp_count=`expr $_am_stamp_count + 1` ;;
+  esac
+done
+echo "timestamp for $ac_file" >`(dirname $ac_file) 2>/dev/null ||
+$as_expr X$ac_file : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X$ac_file : 'X\(//\)[^/]' \| \
+	 X$ac_file : 'X\(//\)$' \| \
+	 X$ac_file : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X$ac_file |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`/stamp-h$_am_stamp_count
+done
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+
+#
+# CONFIG_COMMANDS section.
+#
+for ac_file in : $CONFIG_COMMANDS; do test "x$ac_file" = x: && continue
+  ac_dest=`echo "$ac_file" | sed 's,:.*,,'`
+  ac_source=`echo "$ac_file" | sed 's,[^:]*:,,'`
+  ac_dir=`(dirname "$ac_dest") 2>/dev/null ||
+$as_expr X"$ac_dest" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_dest" : 'X\(//\)[^/]' \| \
+	 X"$ac_dest" : 'X\(//\)$' \| \
+	 X"$ac_dest" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$ac_dest" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+  { if $as_mkdir_p; then
+    mkdir -p "$ac_dir"
+  else
+    as_dir="$ac_dir"
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory \"$ac_dir\"" >&5
+echo "$as_me: error: cannot create directory \"$ac_dir\"" >&2;}
+   { (exit 1); exit 1; }; }; }
+
+  ac_builddir=.
+
+if test "$ac_dir" != .; then
+  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  # A "../" for each directory in $ac_dir_suffix.
+  ac_top_builddir=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,../,g'`
+else
+  ac_dir_suffix= ac_top_builddir=
+fi
+
+case $srcdir in
+  .)  # No --srcdir option.  We are building in place.
+    ac_srcdir=.
+    if test -z "$ac_top_builddir"; then
+       ac_top_srcdir=.
+    else
+       ac_top_srcdir=`echo $ac_top_builddir | sed 's,/$,,'`
+    fi ;;
+  [\\/]* | ?:[\\/]* )  # Absolute path.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir ;;
+  *) # Relative path.
+    ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_builddir$srcdir ;;
+esac
+
+# Do not use `cd foo && pwd` to compute absolute paths, because
+# the directories may not exist.
+case `pwd` in
+.) ac_abs_builddir="$ac_dir";;
+*)
+  case "$ac_dir" in
+  .) ac_abs_builddir=`pwd`;;
+  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
+  *) ac_abs_builddir=`pwd`/"$ac_dir";;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_builddir=${ac_top_builddir}.;;
+*)
+  case ${ac_top_builddir}. in
+  .) ac_abs_top_builddir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
+  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_srcdir=$ac_srcdir;;
+*)
+  case $ac_srcdir in
+  .) ac_abs_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
+  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_srcdir=$ac_top_srcdir;;
+*)
+  case $ac_top_srcdir in
+  .) ac_abs_top_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
+  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
+  esac;;
+esac
+
 
-EOF
-cat >> $CONFIG_STATUS <<EOF
+  { echo "$as_me:$LINENO: executing $ac_dest commands" >&5
+echo "$as_me: executing $ac_dest commands" >&6;}
+  case $ac_dest in
+    depfiles ) test x"$AMDEP_TRUE" != x"" || for mf in $CONFIG_FILES; do
+  # Strip MF so we end up with the name of the file.
+  mf=`echo "$mf" | sed -e 's/:.*$//'`
+  # Check whether this is an Automake generated Makefile or not.
+  # We used to match only the files named `Makefile.in', but
+  # some people rename them; so instead we look at the file content.
+  # Grep'ing the first line is not enough: some people post-process
+  # each Makefile.in and add a new line on top of each file to say so.
+  # So let's grep whole file.
+  if grep '^#.*generated by automake' $mf > /dev/null 2>&1; then
+    dirpart=`(dirname "$mf") 2>/dev/null ||
+$as_expr X"$mf" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$mf" : 'X\(//\)[^/]' \| \
+	 X"$mf" : 'X\(//\)$' \| \
+	 X"$mf" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$mf" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+  else
+    continue
+  fi
+  grep '^DEP_FILES *= *[^ #]' < "$mf" > /dev/null || continue
+  # Extract the definition of DEP_FILES from the Makefile without
+  # running `make'.
+  DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
+  test -z "$DEPDIR" && continue
+  # When using ansi2knr, U may be empty or an underscore; expand it
+  U=`sed -n 's/^U = //p' < "$mf"`
+  test -d "$dirpart/$DEPDIR" || mkdir "$dirpart/$DEPDIR"
+  # We invoke sed twice because it is the simplest approach to
+  # changing $(DEPDIR) to its actual value in the expansion.
+  for file in `sed -n '
+    /^DEP_FILES = .*\\\\$/ {
+      s/^DEP_FILES = //
+      :loop
+	s/\\\\$//
+	p
+	n
+	/\\\\$/ b loop
+      p
+    }
+    /^DEP_FILES = / s/^DEP_FILES = //p' < "$mf" | \
+       sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+    # Make sure the directory exists.
+    test -f "$dirpart/$file" && continue
+    fdir=`(dirname "$file") 2>/dev/null ||
+$as_expr X"$file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$file" : 'X\(//\)[^/]' \| \
+	 X"$file" : 'X\(//\)$' \| \
+	 X"$file" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    { if $as_mkdir_p; then
+    mkdir -p $dirpart/$fdir
+  else
+    as_dir=$dirpart/$fdir
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory $dirpart/$fdir" >&5
+echo "$as_me: error: cannot create directory $dirpart/$fdir" >&2;}
+   { (exit 1); exit 1; }; }; }
 
+    # echo "creating $dirpart/$file"
+    echo '# dummy' > "$dirpart/$file"
+  done
+done
+ ;;
+  esac
+done
+_ACEOF
 
-EOF
-cat >> $CONFIG_STATUS <<\EOF
-test -z "$CONFIG_HEADERS" || echo timestamp > include/blob/stamp-h
+cat >>$CONFIG_STATUS <<\_ACEOF
 
-exit 0
-EOF
+{ (exit 0); exit 0; }
+_ACEOF
 chmod +x $CONFIG_STATUS
-rm -fr confdefs* $ac_clean_files
-test "$no_create" = yes || ${CONFIG_SHELL-/bin/sh} $CONFIG_STATUS || exit 1
+ac_clean_files=$ac_clean_files_save
+
+
+# configure is writing to config.log, and then calls config.status.
+# config.status does its own redirection, appending to config.log.
+# Unfortunately, on DOS this fails, as config.log is still kept open
+# by configure, so config.status won't be able to write to it; its
+# output is simply discarded.  So we exec the FD to /dev/null,
+# effectively closing config.log, so it can be properly (re)opened and
+# appended to by config.status.  When coming back to configure, we
+# need to make the FD available again.
+if test "$no_create" != yes; then
+  ac_cs_success=:
+  ac_config_status_args=
+  test "$silent" = yes &&
+    ac_config_status_args="$ac_config_status_args --quiet"
+  exec 5>/dev/null
+  $SHELL $CONFIG_STATUS $ac_config_status_args || ac_cs_success=false
+  exec 5>>config.log
+  # Use ||, not &&, to avoid exiting from the if with $? = 1, which
+  # would make configure fail if this is the last instruction.
+  $ac_cs_success || { (exit 1); exit 1; }
+fi
 
 
 
@@ -2299,15 +6017,27 @@
 echo "Configuration"
 echo "------------------------------------------------------------------------"
 echo "Target board                ${board_name}"
+echo "Target CPU                  ${use_cpu}"
 echo "C compiler                  ${CC}"
-echo "C flags                     ${CFLAGS}"
-echo "Linker flags                ${LDFLAGS}"
+echo "C flags                     ${AM_CFLAGS}"
+echo "Linker flags                ${AM_LDFLAGS}"
 echo "Objcopy tool                ${OBJCOPY}"
 echo "Objcopy flags               ${OCFLAGS}"
 echo "Clock scaling support       ${clock_scaling_flag}"
 echo "Memory test support         ${chkmem_flag}"
-echo "Debugging commands support  ${debug_flag}"
 echo "LCD support                 ${lcd_flag}"
 echo "MD5 support                 ${md5_flag}"
+echo "Xmodem support              ${xmodem_flag}"
+echo "UU Codec support            ${uucodec_flag}"
+echo "JFFS2 support               ${jffs2_flag}"
+echo "cramfs support              ${cramfs_flag}"
+echo "zImage support              ${zimage_flag}"
+echo "PCMCIA support              ${pcmcia_flag}"
+echo "CF support                  ${cf_flag}"
+echo "IDE support                 ${ide_flag}"
+echo "Generic IO support          ${gio_flag}"
+echo "Network support             ${network_flag}"
+echo "Blob commands:              ${BLOB_COMMANDS}"
 echo "Run-time debug information  ${blob_debug_flag}"
+echo "Serial over USB support     ${usbserial_flag}"
 echo ""
Index: build_tree/bootLoader/configure.in
diff -u build_tree/bootLoader/configure.in:1.1.1.1 build_tree/bootLoader/configure.in:1.1.1.3
--- build_tree/bootLoader/configure.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/configure.in	Fri Nov  9 10:37:08 2007
@@ -1,9 +1,9 @@
 dnl Process this file with autoconf to produce a configure script. -*- m4 -*-
 dnl
-dnl $Id: configure.in,v 1.34 2002/01/07 14:58:16 erikm Exp $
+dnl $Id: configure.in,v 1.74 2003/09/04 18:10:39 russd Exp $
 dnl
 
-AC_REVISION([$Id: configure.in,v 1.34 2002/01/07 14:58:16 erikm Exp $])
+AC_REVISION([$Id: configure.in,v 1.74 2003/09/04 18:10:39 russd Exp $])
 
 
 
@@ -19,7 +19,7 @@
 PACKAGE=blob
 BLOB_MAJOR_VERSION=2
 BLOB_MINOR_VERSION=0
-BLOB_MICRO_VERSION=5-pre2
+BLOB_MICRO_VERSION=5-pre3
 BLOB_VERSION=$BLOB_MAJOR_VERSION.$BLOB_MINOR_VERSION.$BLOB_MICRO_VERSION
 VERSION=$BLOB_VERSION
 
@@ -46,6 +46,7 @@
 AC_CHECK_PROGS(OBJCOPY, arm-linux-objcopy objcopy, echo)
 AC_CHECK_PROGS(RANLIB, arm-linux-ranlib ranlib, echo)
 AC_CHECK_PROGS(AR, arm-linux-ar ar, echo)
+AC_CHECK_PROGS(LD, arm-linux-ld ld, echo)
 
 
 
@@ -59,7 +60,7 @@
 AC_PROG_RANLIB
 AC_PROG_INSTALL
 AC_PROG_LN_S
-
+AM_PROG_AS
 
 
 dnl Checks for libraries.
@@ -74,178 +75,448 @@
 dnl Check board we want to build for
 AC_ARG_WITH(board, [  --with-board=NAME       Name of the target board
                           Valid names are:
-                            assabet     Intel Assabet
-                            neponset    Intel Assabet with Neponset board
-                            badge4      HPL Badge 4
-                            brutus      Intel Brutus
-                            creditlart  CreditLART
-                            h3600       Compaq Ipaq H36x0
-                            idr         Vercel UD-1
-                            jornada720  HP Jornada 720 with Flash board
-                            lart        LART
-                            nesa        NESA
-                            pleb        PLEB
-                            shannon     TuxScreen (Shannon)
-			    system3     Prueftechnik Digital Board
+                            accelent_sa  Accelent IDP
+                            assabet      Intel Assabet
+                            badge4       HPL Badge 4
+                            brutus       Intel Brutus
+                            cep          Iskratel CEP
+                            creditlart   CreditLART
+                            csir_ims     CSIR Incident Management System
+                            dafit        Prueftechnik VibXpert
+                            frodo        2d3D, Inc. SA-1110 Development Board
+                            h3600        Compaq Ipaq H36x0
+                            hackkit      The Hack Kit base board
+                            idr          Vercel UD-1
+                            jornada720   HP Jornada 720 with Flash board
+                            lart         LART
+                            lubbock      Intel HCDDBCTA1 (Lubbock)
+                            mainstone    Intel HCDDBBVA0 (Mainstone)
+                            miniprint    FGAG Miniprint
+                            neponset     Intel Assabet with Neponset board
+                            nesa         NESA
+                            pleb         PLEB
+                            pxa_idp      Accelent PXA-based IDP
+                            ramses       M&N "MN-CI" Logistics Terminal
+                            shannon      TuxScreen (Shannon)
+                            smdk2500     Samsung s3c2500a Evaluation Board
+                            system3      Prueftechnik Digital Board
+                            trizeps      Keith & Koep Trizeps Board
                           Default board is lart],
 	board_name="$withval",
 	board_name="lart")
 
+
+BLOB_TARGET="$board_name"
+
 AC_MSG_CHECKING(target board)
 case "$board_name" in
+    accelent_sa)
+	board_name="Accelent IDP"
+	AC_DEFINE([ACCELENT_SA],1,[Accelent IDP])
+	BLOB_PLATFORM_OBJS="accelent_sa.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="accelent_sa.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
     assabet)
 	board_name="Intel Assabet"
-	AC_DEFINE(ASSABET)
-	BLOB_PLATFORM_OBJ="assabet.o"
+	AC_DEFINE(ASSABET,1,[Intel Assabet])
+	BLOB_PLATFORM_OBJS="assabet.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	AC_MSG_WARN([Please check assabet memory config in arch/assabet.h])
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="assabet.o"
+	DIAG_PLATFORM_OBJS="assabet.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     neponset)
 	board_name="Intel Assabet with Neponset Expansion Board"
-	AC_DEFINE(ASSABET)
-	AC_DEFINE(NEPONSET)
-	BLOB_PLATFORM_OBJ="assabet.o"
+	AC_DEFINE(ASSABET,1,[Intel Assabet])
+	AC_DEFINE(NEPONSET,1,[Neponset Expansion Board])
+	BLOB_PLATFORM_OBJS="assabet.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	AC_MSG_WARN([Please check assabet memory config in arch/assabet.h])
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="assabet.o"
+	DIAG_PLATFORM_OBJS="assabet.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    badge4)
+	board_name="Hewlett-Packard Laboratories Badge-4"
+	AC_DEFINE(BADGE4,1,[Hewlett-Packard Laboratories Badge-4])
+	BLOB_PLATFORM_OBJS="badge4.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel16.o"
+	DIAG_PLATFORM_OBJS="badge4.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     brutus)
 	board_name="Intel Brutus"
-	AC_DEFINE(BRUTUS)
-	BLOB_PLATFORM_OBJ="brutus.o"
+	AC_DEFINE(BRUTUS,1,[Intel Brutus])
+	BLOB_PLATFORM_OBJS="brutus.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	AC_MSG_WARN([Please check Brutus flash])
 	BLOB_FLASH_OBJS="nullflash.o"
-	DIAG_PLATFORM_OBJ="brutus.o"
+	DIAG_PLATFORM_OBJS="brutus.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    cep)
+        board_name="Iskratel CEP"
+        AC_DEFINE(CEP,1,[Iskratel CEP])
+        BLOB_PLATFORM_OBJS="cep.o"
+        BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+        BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+        AC_MSG_WARN([Please check configuration in arch/cep.h])
+        BLOB_FLASH_OBJS="intel32.o"
+        DIAG_PLATFORM_OBJS="cep.o"
+        use_cpu="sa1110"
+        use_lcd="no"
+        ;;
     creditlart)
 	board_name="Delft University of Technology CreditLART"
-	AC_DEFINE(CLART)
-	BLOB_PLATFORM_OBJ="clart.o"
+	AC_DEFINE(CLART,1,[Delft University of Technology CreditLART])
+	BLOB_PLATFORM_OBJS="clart.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	AC_MSG_WARN([Please check creditlart memory config in arch/clart.h])
 	BLOB_FLASH_OBJS="intel16.o"
-	DIAG_PLATFORM_OBJ="clart.o"
+	DIAG_PLATFORM_OBJS="clart.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    dafit)
+	board_name="Prueftechnik VibXpert"
+	AC_DEFINE(PT_DAFIT,1,[Prueftechnik VibXpert])
+	BLOB_PLATFORM_OBJS="dafit.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc9196.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="dafit.o"
+	use_cpu="sa1110"
+	use_lcd="yes"
+	;;
+    frodo)
+	board_name="2d3D, Inc. SA-1110 Development Board"
+	AC_DEFINE(FRODO,1,[2d3D, Inc. SA-1110 Development Board])
+	BLOB_PLATFORM_OBJS="frodo.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="frodo.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     h3600)
 	board_name="Compaq Ipaq H3600 series"
-	AC_DEFINE(H3600)
-	BLOB_PLATFORM_OBJ="h3600.o"
+	AC_DEFINE(H3600,1,[Compaq Ipaq H3600 series])
+	BLOB_PLATFORM_OBJS="h3600.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	AC_MSG_WARN([Warning: untested platform!])
 	AC_MSG_WARN([Please check h3600 memory config in arch/h3600.h])
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="h3600.o"
+	DIAG_PLATFORM_OBJS="h3600.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    hackkit)
+	board_name="The Hack Kit base cpu board"
+	AC_DEFINE(HKIT,1,[The Hack Kit base cpu board])
+	BLOB_PLATFORM_OBJS="hackkit.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="hackkit.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     idr)
 	board_name="Vercel UD-1 (IDR)"
-	AC_DEFINE(IDR)
-	BLOB_PLATFORM_OBJ="idr.o"
+	AC_DEFINE(IDR,1,[Vercel UD-1 (IDR)])
+	BLOB_PLATFORM_OBJS="idr.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="intel16.o"
-	DIAG_PLATFORM_OBJ="idr.o"
+	DIAG_PLATFORM_OBJS="idr.o"
+	use_cpu="sa1110"
+	use_lcd="no"
+	;;
+    jornada720)
+	board_name="Hewlett-Packard Jornada 720 with flash daughter board"
+	AC_DEFINE(JORNADA720,1,[Hewlett-Packard Jornada 720 with flash daughter board])
+	BLOB_PLATFORM_OBJS="jornada720.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+	AC_MSG_WARN([Warning: untested platform!])
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="jornada720.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
     lart)
 	board_name="Delft University of Technology LART"
-	AC_DEFINE(LART)
-	BLOB_PLATFORM_OBJ="lart.o"
+	AC_DEFINE(LART,1,[Delft University of Technology LART])
+	BLOB_PLATFORM_OBJS="lart.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="lart.o"
+	DIAG_PLATFORM_OBJS="lart.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    lubbock)
+    	board_name="Intel HCDDBCTA1 (Lubbock)"
+	AC_DEFINE(LUBBOCK,1,[Intel HCDDBCTA1 (Lubbock)])
+	BLOB_PLATFORM_OBJS="lubbock.o"
+	BLOB_LED_DRIVER_OBJS="led-mmap.o"
+	BLOB_LED_STARTCODE="ledasm-mmap.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc91x.o"
+	DIAG_PLATFORM_OBJS="lubbock.o"
+	use_cpu="pxa250"
+	use_lcd="no"
+	;;	
+    mainstone)
+    	board_name="Intel HCDDBBVA0 (Mainstone)"
+	AC_DEFINE(MAINSTONE,1,[Intel HCDDBBVA0 (Mainstone)])
+	BLOB_PLATFORM_OBJS="mainstone.o"
+	BLOB_LED_DRIVER_OBJS="led-mmap.o"
+	BLOB_LED_STARTCODE="ledasm-mmap.o"
+	BLOB_FLASH_OBJS="intel16.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc91x.o"
+        BLOB_SPI_OBJS="pxa-bb-spi.o"
+		BLOB_LCD_OBJS="pxa-lcd.o"
+	DIAG_PLATFORM_OBJS="mainstone.o"
+	use_cpu="pxa250"
+	use_lcd="yes"
+	;;	
+    miniprint)
+        board_name="FGAG miniprint"
+        AC_DEFINE(MINIPRINT,1,[FGAG miniprint])
+        BLOB_PLATFORM_OBJS="miniprint.o"
+        BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+        BLOB_LED_STARTCODE="ledasm-sa11x0.o"
+        BLOB_FLASH_OBJS="intel32.o"   
+        DIAG_PLATFORM_OBJS="miniprint.o"
+        use_cpu="sa1110"
+        use_lcd="yes"
+        ;;
     nesa)
 	board_name="NESA"
-	AC_DEFINE(NESA)
-	BLOB_PLATFORM_OBJ="nesa.o"
+	AC_DEFINE(NESA,1,[NESA])
+	BLOB_PLATFORM_OBJS="nesa.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="amd32.o"
-	DIAG_PLATFORM_OBJ="nesa.o"
+	DIAG_PLATFORM_OBJS="nesa.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
     pleb)
 	board_name="University of New South Wales PLEB"
-	AC_DEFINE(PLEB)
-	BLOB_PLATFORM_OBJ="pleb.o"
+	AC_DEFINE(PLEB,1,[University of New South Wales PLEB])
+	BLOB_PLATFORM_OBJS="pleb.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	AC_MSG_WARN([Please check PLEB flash])
 	BLOB_FLASH_OBJS="nullflash.o"
-	DIAG_PLATFORM_OBJ="pleb.o"
+	DIAG_PLATFORM_OBJS="pleb.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    pxa_idp)
+	board_name="Accelent PXA250 IDP"
+	AC_DEFINE(PXA_IDP,1,[Accelent PXA250 IDP])
+	BLOB_PLATFORM_OBJS="pxa_idp.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="pxa_idp.o"
+	use_cpu="pxa250"
+	use_lcd="no"
+	;;
+    ramses)
+	board_name="M&N MN-CI Logistic Terminal (ramses)"
+	AC_DEFINE(RAMSES,1,[M&N MN-CI Logistic Terminal (ramses)])
+	BLOB_PLATFORM_OBJS="ramses.o"
+	BLOB_FLASH_OBJS="intel32.o"
+	DIAG_PLATFORM_OBJS="ramses.o"
+	use_cpu="pxa250"
+	use_lcd="no"
+	;;
     shannon)
 	board_name="TuxScreen (Shannon)"
-	AC_DEFINE(SHANNON)
-	BLOB_PLATFORM_OBJ="shannon.o"
+	AC_DEFINE(SHANNON,1,[TuxScreen (Shannon)])
+	BLOB_PLATFORM_OBJS="shannon.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="amd32.o"
-	DIAG_PLATFORM_OBJ="shannon.o"
+	DIAG_PLATFORM_OBJS="shannon.o"
 	use_cpu="sa1100"
 	use_lcd="no"
 	;;
+    smdk2500)
+	board_name="SMDK2500 Evaluation Board"
+	AC_DEFINE(SMDK2500,1,[SMDK2500 Evaluation Board])
+	BLOB_PLATFORM_OBJS="smdk2500.o"
+	BLOB_LED_DRIVER_OBJS="led-s3c2500.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-s3c2500.o"
+	BLOB_LED_STARTCODE="ledasm-s3c2500.o"
+	BLOB_FLASH_OBJS="amd16.o"
+	DIAG_PLATFORM_OBJS="smdk2500.o"
+	use_cpu="s3c2500"
+	use_lcd="no"
+	;;
     system3)
-	board_name="Prueftechnik Digital Board"
-	AC_DEFINE(PT_SYSTEM3)
-	BLOB_PLATFORM_OBJ="system3.o"
+	board_name="Prueftechnik Digital Board REV 0802"
+	AC_DEFINE(PT_SYSTEM3,1,[Prueftechnik Digital Board REV 0802])
+	BLOB_PLATFORM_OBJS="system3.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_NETWORK_DRIVER_OBJS="ether-smc9196.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="system3.o"
+	DIAG_PLATFORM_OBJS="system3.o"
 	use_cpu="sa1110"
 	use_lcd="yes"
 	;;
-    jornada720)
-	board_name="Hewlett-Packard Jornada 720 with flash daughter board"
-	AC_DEFINE(JORNADA720)
-	BLOB_PLATFORM_OBJ="jornada720.o"
+    trizeps)
+	board_name="Keith & Koep Trizeps Board"
+	AC_DEFINE(TRIZEPS,1,[Keith & Koep Trizeps Board])
+	BLOB_PLATFORM_OBJS="trizeps.o"
+	BLOB_LED_DRIVER_OBJS="led-sa11x0.o"
+	BLOB_LED_STARTCODE="ledasm-sa11x0.o"
 	AC_MSG_WARN([Warning: untested platform!])
-	BLOB_FLASH_OBJS="intel32.o"
-	DIAG_PLATFORM_OBJ="jornada720.o"
+	AC_MSG_WARN([Please check trizeps memory config in arch/trizeps.h])
+	BLOB_FLASH_OBJS="intel16.o"
+	DIAG_PLATFORM_OBJS="trizeps.o"
 	use_cpu="sa1110"
 	use_lcd="no"
 	;;
-    badge4)
-	board_name="Hewlett-Packard Laboratories Badge-4"
-	AC_DEFINE(BADGE4)
-	BLOB_PLATFORM_OBJ="badge4.o"
+    csir_ims)
+	board_name="CSIR Incident Management System"
+	AC_DEFINE(CSIR_IMS,1,[CSIR Incident Management System])
+	BLOB_PLATFORM_OBJS="csir_ims.o"
 	BLOB_FLASH_OBJS="intel16.o"
-	DIAG_PLATFORM_OBJ="badge4.o"
-	use_cpu="sa1110"
+	DIAG_PLATFORM_OBJS="csir_ims.o"
+	use_cpu="pxa250"
 	use_lcd="no"
 	;;
     *)
 	AC_MSG_RESULT(unknown)
-	AC_MSG_ERROR([Unknown board name, bailing out])
+	AC_MSG_ERROR([Unknown board name \"$board_name\", bailing out])
 	;;
 esac
 
-dnl define board name in configuration
+AC_SUBST(BLOB_FLASH_OBJS)
+AC_SUBST(BLOB_PLATFORM_OBJS)
+AC_SUBST(DIAG_PLATFORM_OBJS)
+
+
+
+
+
+dnl define board name and CPU in configuration
 AC_MSG_RESULT("${board_name}")
-AC_DEFINE_UNQUOTED(BOARD_NAME, "${board_name}")
+AC_DEFINE_UNQUOTED(BOARD_NAME, "${board_name}","Board name")
+AC_DEFINE_UNQUOTED(CPU, "${use_cpu}", "CPU type")
 
 
-if test "x$use_cpu" = "xsa1100" ; then
+dnl Select correct startup code and other platform dependent object files
+case "$use_cpu" in
+    s3c2500)
+	dnl s3c2500 CPU: SDRAM memory setup code
+	AC_DEFINE(S3C2500,1,[Samsung s3c2500a])
+	BLOB_STARTCODE_OBJS="start-s3c2500.o"
+	BLOB_MEMSETUP_OBJS="memsetup-s3c2500.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-s3c2500.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-s3c2500.o"
+	BLOB_TIMER_DRIVER_OBJS="time-s3c2500.o"
+	;;
+    sa1100)
 	dnl SA1100 CPU: EDORAM memory setup code
-	MEMSETUP="memsetup-sa1100.o"
-elif test "x$use_cpu" = "xsa1110" ; then
+	AC_DEFINE(SA1100,1,[Intel StrongARM SA1100])
+	BLOB_STARTCODE_OBJS="start-sa11x0.o"
+	BLOB_MEMSETUP_OBJS="memsetup-sa1100.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-sa11x0.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-sa11x0.o"
+	BLOB_TIMER_DRIVER_OBJS="time-intelarm.o"
+	;;
+    sa1110)
 	dnl SA1110 CPU: SDRAM memory setup code
-	MEMSETUP="memsetup-sa1110.o"
+	AC_DEFINE(SA1110,1,[Intel StrongARM SA1110])
+	BLOB_STARTCODE_OBJS="start-sa11x0.o"
+	BLOB_MEMSETUP_OBJS="memsetup-sa1110.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-sa11x0.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-sa11x0.o"
+	BLOB_TIMER_DRIVER_OBJS="time-intelarm.o"
+	;;
+    pxa250)
+	dnl PXA250 CPU: SDRAM memory setup code
+	AC_DEFINE(PXA250,1,[Intel XScale PXA250])
+	BLOB_STARTCODE_OBJS="start-pxa.o gpio-pxa.o"
+	BLOB_MEMSETUP_OBJS="memsetup-pxa.o"
+	BLOB_REBOOT_DRIVER_OBJS="reboot-pxa.o"
+	BLOB_SERIAL_DRIVER_OBJS="serial-pxa.o"
+	BLOB_TIMER_DRIVER_OBJS="time-intelarm.o"
+	;;
+    *)
+	AC_MSG_ERROR([Unknown CPU name \"$use_cpu\", bailing out]);
+	;;
+esac
+
+AC_ARG_ENABLE(xlli,
+[  --enable-xlli  Use XLLI as start code ],
+[use_xlli_flag=$enable_xlli],
+[use_xlli_flag=no])
+
+if test "x$use_xlli_flag" = "xyes" ; then
+	BLOB_STARTCODE_OBJS="xlli/$BLOB_TARGET/libxlli.a"
+	BLOB_MEMSETUP_OBJS=""
 else
-	AC_MSG_WARN([No CPU defined!]);
-	use_cpu="(none)"
-	MEMSETUP=""
+	BLOB_TARGET=""
 fi
 
-AC_SUBST(MEMSETUP)
-AC_DEFINE_UNQUOTED(CPU, "${use_cpu}")
-
-
+AC_ARG_ENABLE(usbdnet,
+[  --enable-usbdnet  Use USBDNET as ethernet driver],
+[usbdnet_flag=$enable_usbdnet],
+[usbdnet_flag=no])
+
+if test "x$usbdnet_flag" = "xyes" ; then
+	case "$BLOB_TARGET" in
+	     lubbock)
+		BLOB_NETWORK_DRIVER_OBJS="ether-pxausb.o pxa_usb_ctl.o pxa_usb_ep0.o pxa_usb_ep1.o pxa_usb_ep2.o"
+		;;
+	     mainstone)
+		BLOB_NETWORK_DRIVER_OBJS="ether-bvdusb.o bvd_usb_ctl.o bvd_usb_ep0.o bvd_usb_ep1.o bvd_usb_ep2.o"
+		;;
+	    *)
+		AC_MSG_ERROR([No USBDNET support for Target Board \"$BLOB_TARGET\", bailing out]);
+		;;
+	esac
+
+	AC_DEFINE(CONFIG_USBDNET_SUPPORT,no,"USBDNET support")
+fi
+
+dnl Define in configuration
+AC_SUBST(BLOB_STARTCODE_OBJS)
+AC_SUBST(BLOB_MEMSETUP_OBJS)
+AC_SUBST(BLOB_REBOOT_DRIVER_OBJS)
+AC_SUBST(BLOB_SERIAL_DRIVER_OBJS)
+AC_SUBST(BLOB_TIMER_DRIVER_OBJS)
+AC_SUBST(BLOB_LED_STARTCODE)
+AC_SUBST(BLOB_LED_DRIVER_OBJS)
+AC_SUBST(BLOB_NETWORK_DRIVER_OBJS)
+AC_SUBST(BLOB_TARGET)
+AC_SUBST(BLOB_SPI_OBJS)
+AC_SUBST(BLOB_LCD_OBJS)
 
 
 dnl Find out where the Linux headers are
@@ -269,9 +540,38 @@
 	exit -1
 fi
 AC_MSG_RESULT([yes])
-CFLAGS=`echo $CFLAGS -I${linux_prefix}/include`
+LINUX_INCLUDE=${linux_prefix}/include
+AC_SUBST(LINUX_INCLUDE)
+CFLAGS=`echo $AM_CFLAGS -I$LINUX_INCLUDE`
+
+
 
 
+dnl Check for blob commands
+AC_ARG_WITH(commands,[  --with-commands=<list>  compile blob with commands in <list>
+                          commands may be separated with commas;
+                          'all' compiles all commands;
+                          Valid commands are:
+                           bogomips, call, chgbit, dummy, dump, md5chk, memcpy, poke, peek],
+	blob_commands="$withval",
+	blob_commands="")
+
+default_commands="reset, reboot"
+all_commands="bogomips, call, chgbit, dummy, dump, md5chk, memcpy, poke, peek"
+
+if test "$blob_commands" = "all" ; then
+	blob_commands="$all_commands"
+fi
+
+
+dnl set the Kernel XIP address
+AC_ARG_WITH(kernel-xip,[  --with-kernel-xip=Kernel XIP address ],
+	kernel_xip=$withval,
+	kernel_xip="no")
+
+if test "$kernel_xip" != "no" ; then
+AC_DEFINE_UNQUOTED(KERNEL_XIP_BASE, ${kernel_xip},"Kernel XIP")
+fi
 
 dnl Check for individual features
 AC_ARG_ENABLE(clock-scaling,
@@ -284,11 +584,6 @@
 [chkmem_flag=$enable_memtest],
 [chkmem_flag=no])
 
-AC_ARG_ENABLE(debug,
-[  --enable-debug          Enable support for misc debugging functions ],
-[debug_flag=$enable_debug],
-[debug_flag=no])
-
 AC_ARG_ENABLE(lcd,
 [  --enable-lcd            Enable lcd support ],
 [lcd_flag=$enable_lcd],
@@ -299,6 +594,48 @@
 [md5_flag=$enable_md5],
 [md5_flag=no])
 
+AC_ARG_ENABLE(xmodem,
+[  --enable-xmodem         Enable Xmodem support ],
+[xmodem_flag=$enable_xmodem],
+[xmodem_flag=no])
+
+AC_ARG_ENABLE(usbserial,
+[  --enable-usbserial      Enable serial over USB support ],
+[usbserial_flag=$enable_usbserial],
+[usbserial_flag=no])
+
+AC_ARG_ENABLE(uucodec,
+[  --enable-uucodec        Enable UU Codec support ],
+[uucodec_flag=$enable_uucodec],
+[uucodec_flag=no])
+
+AC_ARG_ENABLE(jffs2,
+[  --enable-jffs2          Enable support for loading kernel from jffs2],
+[jffs2_flag=$enable_jffs2],
+[jffs2_flag=no])
+
+AC_ARG_ENABLE(cramfs,
+[  --enable-cramfs         Enable support for loading kernel from cramfs],
+[cramfs_flag=$enable_cramfs],
+[cramfs_flag=no])
+
+AC_ARG_ENABLE(zimage,
+[  --enable-zimage         Enable support for loading zImage directly from flash],
+[zimage_flag=$enable_zimage],
+[zimage_flag=no])
+
+AC_ARG_ENABLE(network,
+[  --enable-network         Enable networking (bootp/tftp)],
+[network_flag=$enable_network],
+[network_flag=no])
+
+
+AC_ARG_ENABLE(gio,
+[  --enable-gio         Enable generic IO (sysupd command)],
+[gio_flag=$enable_gio],
+[gio_flag=no])
+
+
 
 dnl Check if the user wants *all* features
 AC_ARG_ENABLE(all-features,
@@ -309,48 +646,52 @@
 if test "x$all_features_flag" = "xyes" ; then
 	clock_scaling_flag=yes
 	chkmem_flag=yes
-	debug_flag=yes
 	lcd_flag=yes
 	md5_flag=yes
+	xmodem_flag=yes
+	usbserial_flag=yes
+	uucodec_flag=yes
+	jffs2_flag=yes
+	cramfs_flag=yes
+	zimage_flag=yes
+	network_flag=yes
+	network_flag=yes
 fi
 
 
 
+
 dnl Check wether or not clock scaling code is wanted
 if test "x$clock_scaling_flag" = "xyes" ; then
 	if test "x$use_cpu" = "xsa1100"; then
-		CLOCK="clock.o"
+		BLOB_CLOCK_OBJS="clock.o"
 	else
 		AC_MSG_WARN([No clock scaling support for SA1110 CPUs, disabling])
 		clock_scaling_flag=no
-		CLOCK=""
+		BLOB_CLOCK_OBJS=""
 	fi
 fi
 
-AC_SUBST(CLOCK)
+AC_SUBST(BLOB_CLOCK_OBJS)
 
 
 
 
 dnl Check wether or not memtest code is wanted
 if test "x$chkmem_flag" = "xyes" ; then
-	CHKMEM="chkmem.o"
+	BLOB_CHKMEM_OBJS="chkmem.o"
 fi
 
-AC_SUBST(CHKMEM)
+AC_SUBST(BLOB_CHKMEM_OBJS)
+
 
-dnl Check wether or not debug code is wanted
-if test "x$debug_flag" = "xyes" ; then
-	DEBUG="debug.o"
-fi
 
-AC_SUBST(DEBUG)
 
 dnl Check wether or not lcd support code is wanted
 if test "x$lcd_flag" = "xyes" ; then
 	if test "x$use_lcd" = "xyes" ; then
-		LCD="lcd.o"
-		AC_DEFINE(CONFIG_LCD_SUPPORT)
+		DIAG_LCD_OBJS="lcd.o"
+		AC_DEFINE(CONFIG_LCD_SUPPORT,no,"lcd support")
 	else
 		AC_MSG_WARN([No LCD support for ${board_name}, disabling])
 		LCD=""
@@ -358,21 +699,122 @@
 	fi
 fi
 
-AC_SUBST(LCD)
+AC_SUBST(DIAG_LCD_OBJS)
+
+
+
 
 dnl Check wether or not MD5 support is wanted
 if test "x$md5_flag" = "xyes" ; then
-        AC_DEFINE(CONFIG_MD5_SUPPORT)
+        AC_DEFINE(CONFIG_MD5_SUPPORT,no,"MD5 support")
 fi
 
 
-dnl Check wether or not additional platform source code
-dnl for is needed
-AC_SUBST(BLOB_FLASH_OBJS)
-AC_SUBST(BLOB_PLATFORM_OBJ)
-AC_SUBST(DIAG_PLATFORM_OBJ)
 
 
+dnl Check wether or not Xmodem support is wanted
+if test "x$xmodem_flag" = "xyes" ; then
+        AC_DEFINE(CONFIG_XMODEM_SUPPORT,no,"Xmodem support")
+	BLOB_XMODEM_OBJS="xmodem.o"
+	blob_commands="$blob_commands, xdownload";
+fi
+
+AC_SUBST(BLOB_XMODEM_OBJS)
+
+dnl Check wether or not usbserial support is wanted
+if test "x$usbserial_flag" = "xyes" ; then
+        AC_DEFINE(CONFIG_USBSERIAL_SUPPORT,no,"Serial Over USB support")
+	BLOB_USBSERIAL_OBJS="serial-bvdusb.o bvd_usb_ctl.o bvd_usb_ep0.o bvd_usb_ep1.o bvd_usb_ep2.o"
+	blob_commands="$blob_commands, udownload";
+fi
+
+AC_SUBST(BLOB_USBSERIAL_OBJS)
+
+
+dnl Check wether or not UU Codec support is wanted
+if test "x$uucodec_flag" = "xyes"; then
+        AC_DEFINE(CONFIG_UUCODEC_SUPPORT,no,"UU Codec support")
+	BLOB_UUCODEC_OBJS="uucodec.o"
+	blob_commands="$blob_commands, download";
+fi
+
+AC_SUBST(BLOB_UUCODEC_OBJS)
+
+
+
+
+dnl Check wether or not JFFS2 support is wanted
+if test "x$jffs2_flag" = "xyes" ; then
+	BLOB_JFFS2_OBJS="compr_rtime.o compr_rubin.o jffs2.o"
+	AC_DEFINE(CONFIG_JFFS2_SUPPORT,no,"JFFS2 support")
+fi
+
+AC_SUBST(BLOB_JFFS2_OBJS)
+
+
+
+
+dnl Check wether or not cramfs support is wanted
+if test "x$cramfs_flag" = "xyes" ; then
+	BLOB_CRAMFS_OBJS="cramfs.o"
+	AC_DEFINE(CONFIG_CRAMFS_SUPPORT,no,"CRAMFS support")
+fi
+
+AC_SUBST(BLOB_CRAMFS_OBJS)
+
+
+dnl Check wether or not zImage support is wanted
+if test "x$zimage_flag" = "xyes" ; then
+	BLOB_ZIMAGE_OBJS="zImage.o"
+	AC_DEFINE(CONFIG_ZIMAGE_SUPPORT,no,"zImage support")
+fi
+
+AC_SUBST(BLOB_ZIMAGE_OBJS)
+
+dnl Check wether or not network support is wanted
+if test "x$network_flag" = "xyes" ; then
+	BLOB_NETWORK_OBJS="bootp.o arp.o tftp.o ip_bits.o"
+	AC_DEFINE(CONFIG_NETWORK_SUPPORT,no,"Network support")
+	blob_commands="$blob_commands, arp, autoip, setip, tdownload, tftp";
+
+fi
+AC_SUBST(BLOB_NETWORK_OBJS)
+
+
+dnl Check wether or not gio support is wanted
+if test "x$gio_flag" = "xyes" ; then
+	BLOB_GIO_OBJS="generic_io.o gio_flash.o gio_part_blob.o gio_ram.o tar.o"
+	AC_DEFINE(CONFIG_GIO_SUPPORT,no,"GIO support")
+dnl gio needs cf, pcmcia and ide
+	pcmcia_flag="yes";
+	ide_flag="yes";
+	cf_flag="yes";
+
+	blob_commands="$blob_commands, sysupd";
+fi
+AC_SUBST(BLOB_GIO_OBJS)
+
+dnl Check wether or not pcmcia support is wanted
+if test "x$pcmcia_flag" = "xyes" ; then
+	BLOB_PCMCIA_OBJS="pcmcia.o"
+	AC_DEFINE(CONFIG_PCMCIA_SUPPORT,no,"PCMCIA support")
+
+fi
+AC_SUBST(BLOB_PCMCIA_OBJS)
+
+dnl Check wether or not ide support is wanted
+if test "x$ide_flag" = "xyes" ; then
+	AC_DEFINE(CONFIG_IDE_SUPPORT,no,"IDE support")
+	BLOB_IDE_OBJS="ide.o"
+fi
+AC_SUBST(BLOB_IDE_OBJS)
+
+dnl Check wether or not cf support is wanted
+if test "x$cf_flag" = "xyes" ; then
+	AC_DEFINE(CONFIG_CF_SUPPORT,no,"CF support")
+	BLOB_CF_OBJS="cf.o"
+fi
+AC_SUBST(BLOB_CF_OBJS)
 
 dnl Check for extra debug info
 AC_ARG_ENABLE(blob-debug,
@@ -381,10 +823,15 @@
 [blob_debug_flag=no])
 
 if test "x$blob_debug_flag" = "xyes" ; then
-  AC_DEFINE(BLOB_DEBUG)
+  AC_DEFINE(BLOB_DEBUG,no,"Debug code")
 fi
 
 
+dnl commands subst here so that extra flags can add commands
+ALL_COMMANDS=`echo $default_commands $all_commands | sed 's/,//g'`
+BLOB_COMMANDS=`echo $default_commands $blob_commands | sed 's/,//g'`
+AC_SUBST(ALL_COMMANDS)
+AC_SUBST(BLOB_COMMANDS)
 
 
 dnl Checks for typedefs, structures, and compiler characteristics.
@@ -396,46 +843,74 @@
 
 
 
+dnl Initialize flags without --enable/--disable code:
+pcmcia_flag=${pcmcia_flag-no}
+cf_flag=${cf_flag-no}
+ide_flag=${ide_flag-no}
 
 dnl Add C flags to display more warnings
 AC_MSG_CHECKING(for C flags to get more warnings)
-ac_save_CFLAGS="$CFLAGS"
+ac_save_CFLAGS="$AM_CFLAGS"
 AC_LANG_SAVE
 if test "x$ac_cv_prog_gcc" = "xyes" ; then
   dnl gcc is the easiest C compiler
   warning_CFLAGS="-Wall"
 fi
 AC_LANG_RESTORE
-CFLAGS="$ac_save_CFLAGS"
+AM_CFLAGS="$ac_save_CFLAGS"
 if test "$warning_CFLAGS" = "none" ; then
   AC_MSG_RESULT(none)
 else
-  CFLAGS="$CFLAGS $warning_CFLAGS"
+  AM_CFLAGS="$CFLAGS $warning_CFLAGS"
   AC_MSG_RESULT($warning_CFLAGS)
 fi  
 
-
-dnl Remove the "-g" flag from CFLAGS and LDFLAGS
-CFLAGS=`echo $CFLAGS | sed 's/\ *-g\ */\ /'`
-LDFLAGS=`echo $LDFLAGS | sed 's/\ *-g\ */\ /'`
+dnl Remove the "-g" flag from CFLAGS and AM_LDFLAGS
+AM_CFLAGS=`echo $AM_CFLAGS | sed 's/\ *-g\ */\ /'`
+AM_LDFLAGS=`echo $AM_LDFLAGS | sed 's/\ *-g\ */\ /'`
 
 dnl Change the "-O2" flag in "-Os"
-CFLAGS=`echo $CFLAGS | sed 's/-O2/-Os/'`
+AM_CFLAGS=`echo $AM_CFLAGS | sed 's/-O2/-Os/'`
+
+
+dnl Figure out CPU specific CFLAGS to help optimisation
+case "$use_cpu" in
+    s3c2500)
+	cpu_cflags="-march=armv4"
+	;;
+    sa11?0)
+	cpu_cflags="-march=armv4 -mtune=strongarm1100"
+	;;
+    pxa2?0)
+	dnl was: cpu_cflags="-march=armv4 -Wa,-mxscale -mtune=strongarm"
+	cpu_cflags="-march=armv4"
+	;;
+    *)
+	cpu_cflags=""
+	;;
+esac
+
 
-dnl Add some StrongARM specific flags
-CFLAGS=`echo $CFLAGS -march=armv4 -mtune=strongarm1100 -fomit-frame-pointer -fno-builtin -mapcs-32 -nostdinc`
-LDFLAGS=`echo $LDFLAGS -static -nostdlib`
+dnl define compiler and linker flags
+AM_CFLAGS=`echo $AM_CFLAGS $cpu_cflags -mapcs-32 -fomit-frame-pointer -fno-builtin`
+AM_LDFLAGS=`echo $AM_LDFLAGS -static -nostdlib`
 OCFLAGS="-O binary -R .note -R .comment -S"
 AC_SUBST(OCFLAGS)
 
 
+dnl Generate output files
 AC_OUTPUT(Makefile
 doc/Makefile
 include/Makefile
 include/blob/Makefile
 include/blob/arch/Makefile
+include/blob/proc/Makefile
+include/net/Makefile
 src/Makefile
 src/blob/Makefile
+src/blob/xlli/Makefile
+src/blob/xlli/mainstone/Makefile
+src/commands/Makefile
 src/diag/Makefile
 src/lib/Makefile
 tools/Makefile
@@ -444,19 +919,32 @@
 utils/mkparamblock/Makefile)
 
 
+dnl Tell the user about the configuration
 echo ""
 echo "Configuration"
 echo "------------------------------------------------------------------------"
 echo "Target board                ${board_name}"
+echo "Target CPU                  ${use_cpu}"
 echo "C compiler                  ${CC}"
-echo "C flags                     ${CFLAGS}"
-echo "Linker flags                ${LDFLAGS}"
+echo "C flags                     ${AM_CFLAGS}"
+echo "Linker flags                ${AM_LDFLAGS}"
 echo "Objcopy tool                ${OBJCOPY}"
 echo "Objcopy flags               ${OCFLAGS}"
 echo "Clock scaling support       ${clock_scaling_flag}"
 echo "Memory test support         ${chkmem_flag}"
-echo "Debugging commands support  ${debug_flag}"
 echo "LCD support                 ${lcd_flag}"
 echo "MD5 support                 ${md5_flag}"
+echo "Xmodem support              ${xmodem_flag}"
+echo "UU Codec support            ${uucodec_flag}"
+echo "JFFS2 support               ${jffs2_flag}"
+echo "cramfs support              ${cramfs_flag}"
+echo "zImage support              ${zimage_flag}"
+echo "PCMCIA support              ${pcmcia_flag}"
+echo "CF support                  ${cf_flag}"
+echo "IDE support                 ${ide_flag}"
+echo "Generic IO support          ${gio_flag}"
+echo "Network support             ${network_flag}"
+echo "Blob commands:              ${BLOB_COMMANDS}"
 echo "Run-time debug information  ${blob_debug_flag}"
+echo "Serial over USB support     ${usbserial_flag}"
 echo ""
Index: build_tree/bootLoader/setup
diff -u /dev/null build_tree/bootLoader/setup:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/setup	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,2 @@
+./configure --host=arm-linux --with-board=mainstone --with-linux-prefix=/usr/src/linux-2.6.5-1.358 --enable-xlli --enable-memtest=set --enable-lcd=set --enable-jffs2=set --enable-jffs2=set --enable-blob-debug=set
+
Index: build_tree/bootLoader/z2config.sh
diff -u /dev/null build_tree/bootLoader/z2config.sh:1.3
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/z2config.sh	Fri Nov 16 15:36:46 2007
@@ -0,0 +1 @@
+./configure --with-linux-prefix=$TOP_DIR/linux --host=armv5l-linux --with-board=mainstone --enable-xmodem --enable-xlli host_alias=armv5l-linux --enable-lcd --with-commands="poke, peek"
Index: build_tree/bootLoader/doc/.cvsignore
diff -u /dev/null build_tree/bootLoader/doc/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/doc/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile.in
+Makefile
Index: build_tree/bootLoader/doc/Makefile.am
diff -u build_tree/bootLoader/doc/Makefile.am:1.1.1.1 build_tree/bootLoader/doc/Makefile.am:1.1.1.2
--- build_tree/bootLoader/doc/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/doc/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 # Process this file with automake to produce Makefile.in -*- makefile -*-
 #
-# $Id: Makefile.am,v 1.3 2002/01/07 20:15:10 erikm Exp $
+# $Id: Makefile.am,v 1.4 2002/02/18 08:56:26 erikm Exp $
 # 
 
 CLEANFILES	= *~
@@ -8,4 +8,5 @@
 EXTRA_DIST	= \
 	commandlist.txt \
 	diag.txt \
+	motto.txt \
 	porting.txt
Index: build_tree/bootLoader/doc/Makefile.in
diff -u build_tree/bootLoader/doc/Makefile.in:1.1.1.1 build_tree/bootLoader/doc/Makefile.in:1.2
--- build_tree/bootLoader/doc/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/doc/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,182 +12,318 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # Process this file with automake to produce Makefile.in -*- makefile -*-
 #
-# $Id: Makefile.am,v 1.3 2002/01/07 20:15:10 erikm Exp $
+# $Id: Makefile.am,v 1.4 2002/02/18 08:56:26 erikm Exp $
 # 
-
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = doc
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
 CLEANFILES = *~
+EXTRA_DIST = \
+	commandlist.txt \
+	diag.txt \
+	motto.txt \
+	porting.txt
 
-EXTRA_DIST =  	commandlist.txt 	diag.txt 	porting.txt
-
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-DIST_COMMON =  Makefile.am Makefile.in
+all: all-am
 
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps doc/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  doc/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  doc/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
 tags: TAGS
 TAGS:
 
+ctags: CTAGS
+CTAGS:
 
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = doc
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
 check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am:
+all-am: Makefile
+installdirs:
+install: install-am
 install-exec: install-exec-am
-
-install-data-am:
 install-data: install-data-am
+uninstall: uninstall-am
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am:
-uninstall: uninstall-am
-all-am: Makefile
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-
 
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
 
-mostlyclean: mostlyclean-am
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-generic mostlyclean-am
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic
 
-clean: clean-am
+dvi: dvi-am
 
-distclean-am:  distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-am
+html: html-am
 
-maintainer-clean-am:  maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
 
-.PHONY: tags distdir info-am info dvi-am dvi check check-am \
-installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+uninstall-am: uninstall-info-am
 
+.PHONY: all all-am check check-am clean clean-generic distclean \
+	distclean-generic distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-generic pdf pdf-am ps ps-am uninstall uninstall-am \
+	uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/doc/diag.txt
diff -u build_tree/bootLoader/doc/diag.txt:1.1.1.1 build_tree/bootLoader/doc/diag.txt:1.1.1.2
--- build_tree/bootLoader/doc/diag.txt:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/doc/diag.txt	Fri Nov  9 09:44:05 2007
@@ -2,9 +2,9 @@
 quickly hacked up by Stefan Eletzhofer
 <stefan.eletzhofer@eletztick.de>
 
-Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
 
-$Id: diag.txt,v 1.2 2002/01/07 19:58:14 seletz Exp $
+$Id: diag.txt,v 1.3 2002/02/11 16:51:22 seletz Exp $
 
 Disclaimer
 ----------
Index: build_tree/bootLoader/doc/motto.txt
diff -u /dev/null build_tree/bootLoader/doc/motto.txt:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/doc/motto.txt	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,11 @@
+The most important design rule behind blob is the KISS principle, but
+that's a bit dull. It was much more nicely worded by de Saint-Exupery;
+think about it when you're extending blob. -- Erik
+
+  La perfection est atteinte non quand il ne reste rien  ajouter,
+  mais quand il ne reste rien  enlever.
+
+  (You know you've achieved perfection in design, not when you have
+   nothing more to add, but when you have nothing more to take away.)
+
+      -- Antoine de Saint-Exupery
Index: build_tree/bootLoader/doc/porting.txt
diff -u build_tree/bootLoader/doc/porting.txt:1.1.1.1 build_tree/bootLoader/doc/porting.txt:1.1.1.2
--- build_tree/bootLoader/doc/porting.txt:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/doc/porting.txt	Fri Nov  9 09:44:05 2007
@@ -14,26 +14,18 @@
 
 
 
-Add machine define to acconfig.h:
-
-/* Define for Ipaq H3600 */
-#undef H3600
-
-
-
-
 Add machine to include/blob/arch.h:
 
-#elif defined H3600
-# include <blob/arch/h3600.h>
+    #elif defined H3600
+    # include <blob/arch/h3600.h>
 
 
 
 
 Add machine dependent architecture file:
 
-cd include/blob/arch/
-cp assabet.h h3600.h
+    cd include/blob/arch/
+    cp assabet.h h3600.h
 
 Edit h3600.h
 
@@ -61,21 +53,47 @@
 
 Add machine dependent source file:
 
-cd src/blob
-cp assabet.c h3600.c
+    cd src/blob
+    cp assabet.c h3600.c
+
+Edit h3600.c
+
+
+
+
+Add machine dependent dependent source file to Makefile.am
+
+    h3600.c
+
+
+
+
+Add machine dependent diagnostics file:
+
+    cd src/diag
+    cp assabet.c h3600.c
 
 Edit h3600.c
 
 
 
 
-Edit memsetup-sa1110.S and add correct memory setup
+Add machine dependent dependent diagnostics file to Makefile.am
+
+    h3600.c
+
+
+
+
+Edit memsetup-sa1110.S and add correct memory setup. This is only be
+necessary for Intel StrongARM based boards. For Intel PXA based boards, the
+defined in h3600.h should be sufficient.
 
 
 
 
 Add architecture number to include/blob/linux.h:
 
-#elif defined H3600
-# define ARCH_NUMBER (22)
+    #elif defined H3600
+    # define ARCH_NUMBER (22)
 
Index: build_tree/bootLoader/include/.cvsignore
diff -u /dev/null build_tree/bootLoader/include/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile.in
+Makefile
Index: build_tree/bootLoader/include/Makefile.am
diff -u build_tree/bootLoader/include/Makefile.am:1.1.1.1 build_tree/bootLoader/include/Makefile.am:1.1.1.2
--- build_tree/bootLoader/include/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,7 @@
 # -*- makefile -*-
 ###########################################################################
 ## Filename:      Makefile.am
-## Version:       $Id: Makefile.am,v 1.9 2001/10/07 15:17:49 erikm Exp $
+## Version:       $Id: Makefile.am,v 1.10 2003/03/18 17:38:14 seletz Exp $
 ## Copyright:     Copyright (C) 1999, Erik Mouw
 ## Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 ## Description:   Makefile
@@ -12,7 +12,8 @@
 
 
 SUBDIRS		= \
-		blob
+		blob \
+		net
 
 
 CLEANFILES	= *~
Index: build_tree/bootLoader/include/Makefile.in
diff -u build_tree/bootLoader/include/Makefile.in:1.1.1.1 build_tree/bootLoader/include/Makefile.in:1.2
--- build_tree/bootLoader/include/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,101 +12,207 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 ###########################################################################
 ###########################################################################
-
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = include
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-SUBDIRS =  		blob
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+SUBDIRS = \
+		blob \
+		net
 
 CLEANFILES = *~
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-DIST_COMMON =  Makefile.am Makefile.in
+all: all-recursive
 
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps include/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  include/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  include/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
 # into them and run `make' without going through this Makefile.
@@ -112,13 +220,8 @@
 # (1) if the variable is set in `config.status', edit `config.status'
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
-
-@SET_MAKE@
-
-all-recursive install-data-recursive install-exec-recursive \
-installdirs-recursive install-recursive uninstall-recursive  \
-check-recursive installcheck-recursive info-recursive dvi-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -138,13 +241,18 @@
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
-	rev=''; list='$(SUBDIRS)'; for subdir in $$list; do \
-	  rev="$$subdir $$rev"; \
-	  test "$$subdir" = "." && dot_seen=yes; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
 	done; \
-	test "$$dot_seen" = "no" && rev=". $$rev"; \
+	rev="$$rev ."; \
 	target=`echo $@ | sed s/-recursive//`; \
 	for subdir in $$rev; do \
 	  echo "Making $$target in $$subdir"; \
@@ -160,135 +268,197 @@
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
 
-tags: TAGS
-
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
+	mkid -fID $$unique
+tags: TAGS
 
-TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
-   if test "$$subdir" = .; then :; else \
-	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
-   fi; \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = include
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d $(distdir)/$$subdir \
-	    || mkdir $(distdir)/$$subdir \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
 	    || exit 1; \
-	    chmod 777 $(distdir)/$$subdir; \
-	    (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$(top_distdir) distdir=../$(distdir)/$$subdir distdir) \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
 	      || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-recursive
-dvi-am:
-dvi: dvi-recursive
 check-am: all-am
 check: check-recursive
-installcheck-am:
-installcheck: installcheck-recursive
-install-exec-am:
+all-am: Makefile
+installdirs: installdirs-recursive
+installdirs-am:
+install: install-recursive
 install-exec: install-exec-recursive
-
-install-data-am:
 install-data: install-data-recursive
+uninstall: uninstall-recursive
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-recursive
-uninstall-am:
-uninstall: uninstall-recursive
-all-am: Makefile
-all-redirect: all-recursive
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs: installdirs-recursive
-installdirs-am:
-
 
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-recursive
 
-mostlyclean: mostlyclean-recursive
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-tags clean-generic mostlyclean-am
+distclean: distclean-recursive
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
 
-clean: clean-recursive
+dvi: dvi-recursive
+
+dvi-am:
 
-distclean-am:  distclean-tags distclean-generic clean-am
+html: html-recursive
 
-distclean: distclean-recursive
+info: info-recursive
 
-maintainer-clean-am:  maintainer-clean-tags maintainer-clean-generic \
-		distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-recursive
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-info-am
 
-.PHONY: install-data-recursive uninstall-data-recursive \
-install-exec-recursive uninstall-exec-recursive installdirs-recursive \
-uninstalldirs-recursive all-recursive check-recursive \
-installcheck-recursive info-recursive dvi-recursive \
-mostlyclean-recursive distclean-recursive clean-recursive \
-maintainer-clean-recursive tags tags-recursive mostlyclean-tags \
-distclean-tags clean-tags maintainer-clean-tags distdir info-am info \
-dvi-am dvi check check-am installcheck-am installcheck install-exec-am \
-install-exec install-data-am install-data install-am install \
-uninstall-am uninstall all-redirect all-am all installdirs-am \
-installdirs mostlyclean-generic distclean-generic clean-generic \
-maintainer-clean-generic clean mostlyclean distclean maintainer-clean
+uninstall-info: uninstall-info-recursive
 
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
+	clean clean-generic clean-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-recursive distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-generic \
+	mostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/include/blob/.cvsignore
diff -u /dev/null build_tree/bootLoader/include/blob/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,7 @@
+Makefile.in
+Makefile
+config.h.in
+config.h
+stamp-h.in
+stamp-h
+stamp-h1
Index: build_tree/bootLoader/include/blob/Makefile.am
diff -u build_tree/bootLoader/include/blob/Makefile.am:1.1.1.1 build_tree/bootLoader/include/blob/Makefile.am:1.1.1.2
--- build_tree/bootLoader/include/blob/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,7 @@
 # -*- makefile -*-
 ###########################################################################
 ## Filename:      Makefile.am
-## Version:       $Id: Makefile.am,v 1.13 2002/01/06 18:59:40 erikm Exp $
+## Version:       $Id: Makefile.am,v 1.21 2003/09/04 17:46:59 russd Exp $
 ## Copyright:     Copyright (C) 1999, Erik Mouw
 ## Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 ## Description:   Makefile
@@ -11,33 +11,46 @@
 ###########################################################################
 
 SUBDIRS		= \
-	arch
+	arch \
+	proc
 
 
 noinst_HEADERS	= \
 	arch.h \
+	cf.h \
 	command.h \
 	command_hist.h \
+	compr_rubin.h \
+	crc32.h \
+	debug.h \
+	download.h \
 	errno.h \
 	error.h \
 	flash.h \
+	generic_io.h \
+	gio_drivers.h \
+	i2c-gpio.h \
+	i2c.h \
 	icache.h \
+	ide.h \
 	init.h \
+	jffs2.h \
 	lcd.h \
 	led.h \
 	linux.h \
+	load_kernel.h \
 	main.h \
 	md5.h \
 	md5support.h \
 	memory.h \
 	memsetup.h \
+	mini_inflate.h \
 	param_block.h \
 	partition.h \
+	pcmcia.h \
 	reboot.h \
-	sa1100.h \
-	sa1111.h \
 	serial.h \
-	terminal.h \
+	tar.h \
 	time.h \
 	types.h \
 	util.h \
Index: build_tree/bootLoader/include/blob/Makefile.in
diff -u build_tree/bootLoader/include/blob/Makefile.in:1.1.1.1 build_tree/bootLoader/include/blob/Makefile.in:1.2
--- build_tree/bootLoader/include/blob/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,134 +12,270 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 ###########################################################################
 ###########################################################################
 
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ../..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = include/blob
+DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
+	$(srcdir)/Makefile.in $(srcdir)/config.h.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+HEADERS = $(noinst_HEADERS)
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-SUBDIRS =  	arch
-
-
-noinst_HEADERS =  	arch.h 	command.h 	command_hist.h 	errno.h 	error.h 	flash.h 	icache.h 	init.h 	lcd.h 	led.h 	linux.h 	main.h 	md5.h 	md5support.h 	memory.h 	memsetup.h 	param_block.h 	partition.h 	reboot.h 	sa1100.h 	sa1111.h 	serial.h 	terminal.h 	time.h 	types.h 	util.h 	uucodec.h 	xmodem.h
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+SUBDIRS = \
+	arch \
+	proc
+
+noinst_HEADERS = \
+	arch.h \
+	cf.h \
+	command.h \
+	command_hist.h \
+	compr_rubin.h \
+	crc32.h \
+	debug.h \
+	download.h \
+	errno.h \
+	error.h \
+	flash.h \
+	generic_io.h \
+	gio_drivers.h \
+	i2c-gpio.h \
+	i2c.h \
+	icache.h \
+	ide.h \
+	init.h \
+	jffs2.h \
+	lcd.h \
+	led.h \
+	linux.h \
+	load_kernel.h \
+	main.h \
+	md5.h \
+	md5support.h \
+	memory.h \
+	memsetup.h \
+	mini_inflate.h \
+	param_block.h \
+	partition.h \
+	pcmcia.h \
+	reboot.h \
+	serial.h \
+	tar.h \
+	time.h \
+	types.h \
+	util.h \
+	uucodec.h \
+	xmodem.h
 
 CLEANFILES = ${srcdir}/*~
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = config.h
-CONFIG_CLEAN_FILES = 
-HEADERS =  $(noinst_HEADERS)
-
-DIST_COMMON =  ./stamp-h.in Makefile.am Makefile.in config.h.in
-
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
+all: config.h
+	$(MAKE) $(AM_MAKEFLAGS) all-recursive
 
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps include/blob/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  include/blob/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  include/blob/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
-config.h: stamp-h
-	@if test ! -f $@; then \
-		rm -f stamp-h; \
-		$(MAKE) stamp-h; \
-	else :; fi
-stamp-h: $(srcdir)/config.h.in $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES= CONFIG_HEADERS=include/blob/config.h \
-	     $(SHELL) ./config.status
-	@echo timestamp > stamp-h 2> /dev/null
-$(srcdir)/config.h.in: @MAINTAINER_MODE_TRUE@$(srcdir)/stamp-h.in
+config.h: stamp-h1
 	@if test ! -f $@; then \
-		rm -f $(srcdir)/stamp-h.in; \
-		$(MAKE) $(srcdir)/stamp-h.in; \
+	  rm -f stamp-h1; \
+	  $(MAKE) stamp-h1; \
 	else :; fi
-$(srcdir)/stamp-h.in: $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOHEADER)
-	@echo timestamp > $(srcdir)/stamp-h.in 2> /dev/null
-
-mostlyclean-hdr:
 
-clean-hdr:
+stamp-h1: $(srcdir)/config.h.in $(top_builddir)/config.status
+	@rm -f stamp-h1
+	cd $(top_builddir) && $(SHELL) ./config.status include/blob/config.h
+$(srcdir)/config.h.in: @MAINTAINER_MODE_TRUE@ $(am__configure_deps) 
+	cd $(top_srcdir) && $(AUTOHEADER)
+	rm -f stamp-h1
+	touch $@
 
 distclean-hdr:
-	-rm -f config.h
-
-maintainer-clean-hdr:
+	-rm -f config.h stamp-h1
+uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
 # into them and run `make' without going through this Makefile.
@@ -145,13 +283,8 @@
 # (1) if the variable is set in `config.status', edit `config.status'
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
-
-@SET_MAKE@
-
-all-recursive install-data-recursive install-exec-recursive \
-installdirs-recursive install-recursive uninstall-recursive  \
-check-recursive installcheck-recursive info-recursive dvi-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -171,13 +304,18 @@
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
-	rev=''; list='$(SUBDIRS)'; for subdir in $$list; do \
-	  rev="$$subdir $$rev"; \
-	  test "$$subdir" = "." && dot_seen=yes; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
 	done; \
-	test "$$dot_seen" = "no" && rev=". $$rev"; \
+	rev="$$rev ."; \
 	target=`echo $@ | sed s/-recursive//`; \
 	for subdir in $$rev; do \
 	  echo "Making $$target in $$subdir"; \
@@ -193,138 +331,197 @@
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
 
-tags: TAGS
-
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
+	mkid -fID $$unique
+tags: TAGS
 
-TAGS: tags-recursive $(HEADERS) $(SOURCES) config.h.in $(TAGS_DEPENDENCIES) $(LISP)
+TAGS: tags-recursive $(HEADERS) $(SOURCES) config.h.in $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
-   if test "$$subdir" = .; then :; else \
-	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
-   fi; \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS) config.h.in $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)config.h.in$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags config.h.in $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES) config.h.in $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS) config.h.in $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = include/blob
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d $(distdir)/$$subdir \
-	    || mkdir $(distdir)/$$subdir \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
 	    || exit 1; \
-	    chmod 777 $(distdir)/$$subdir; \
-	    (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$(top_distdir) distdir=../$(distdir)/$$subdir distdir) \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
 	      || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-recursive
-dvi-am:
-dvi: dvi-recursive
 check-am: all-am
 check: check-recursive
-installcheck-am:
-installcheck: installcheck-recursive
-all-recursive-am: config.h
-	$(MAKE) $(AM_MAKEFLAGS) all-recursive
-
-install-exec-am:
+all-am: Makefile $(HEADERS) config.h
+installdirs: installdirs-recursive
+installdirs-am:
+install: install-recursive
 install-exec: install-exec-recursive
-
-install-data-am:
 install-data: install-data-recursive
+uninstall: uninstall-recursive
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-recursive
-uninstall-am:
-uninstall: uninstall-recursive
-all-am: Makefile $(HEADERS) config.h
-all-redirect: all-recursive-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs: installdirs-recursive
-installdirs-am:
-
 
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-hdr mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-recursive
 
-mostlyclean: mostlyclean-recursive
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-hdr clean-tags clean-generic mostlyclean-am
+distclean: distclean-recursive
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-hdr distclean-tags
 
-clean: clean-recursive
+dvi: dvi-recursive
 
-distclean-am:  distclean-hdr distclean-tags distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-recursive
+html: html-recursive
 
-maintainer-clean-am:  maintainer-clean-hdr maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-recursive
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-recursive
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-info-am
 
-.PHONY: mostlyclean-hdr distclean-hdr clean-hdr maintainer-clean-hdr \
-install-data-recursive uninstall-data-recursive install-exec-recursive \
-uninstall-exec-recursive installdirs-recursive uninstalldirs-recursive \
-all-recursive check-recursive installcheck-recursive info-recursive \
-dvi-recursive mostlyclean-recursive distclean-recursive clean-recursive \
-maintainer-clean-recursive tags tags-recursive mostlyclean-tags \
-distclean-tags clean-tags maintainer-clean-tags distdir info-am info \
-dvi-am dvi check check-am installcheck-am installcheck all-recursive-am \
-install-exec-am install-exec install-data-am install-data install-am \
-install uninstall-am uninstall all-redirect all-am all installdirs-am \
-installdirs mostlyclean-generic distclean-generic clean-generic \
-maintainer-clean-generic clean mostlyclean distclean maintainer-clean
+uninstall-info: uninstall-info-recursive
 
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
+	clean clean-generic clean-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-hdr distclean-recursive \
+	distclean-tags distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-generic \
+	mostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/include/blob/arch.h
diff -u build_tree/bootLoader/include/blob/arch.h:1.1.1.1 build_tree/bootLoader/include/blob/arch.h:1.1.1.3
--- build_tree/bootLoader/include/blob/arch.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch.h	Fri Nov  9 10:37:08 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: arch.h,v 1.4 2001/12/27 18:27:37 erikm Exp $
+ * $Id: arch.h,v 1.18 2003/09/04 18:10:40 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,30 +21,39 @@
  *
  */
 
-#ident "$Id: arch.h,v 1.4 2001/12/27 18:27:37 erikm Exp $"
+#ident "$Id: arch.h,v 1.18 2003/09/04 18:10:40 russd Exp $"
 
 #ifndef BLOB_ARCH_H
 #define BLOB_ARCH_H
 
-
-
-
-/* memory start and end */
-#define MEMORY_START		(0xc0000000)
-#define MEMORY_END		(0xe0000000)
-
-
-
+/* processor specific include files */
+#if defined PXA250
+#include <blob/proc/pxa.h>
+#elif defined(SA1100) || defined(SA1110)
+#include <blob/proc/sa1100.h>
+#elif defined S3C2500
+#include <blob/proc/s3c2500.h>
+#else
+# error "Please add an CPU specific include file"
+#endif
 
 /* architecture specific include files */
-#if defined ASSABET
+#if defined ACCELENT_SA
+# include <blob/arch/accelent_sa.h>
+#elif defined ASSABET
 # include <blob/arch/assabet.h>
 #elif defined BADGE4
 # include <blob/arch/badge4.h>
 #elif defined BRUTUS
 # include <blob/arch/brutus.h>
+#elif defined CEP
+# include <blob/arch/cep.h>
 #elif defined CLART
 # include <blob/arch/clart.h>
+#elif defined FRODO
+# include <blob/arch/frodo.h>
+#elif defined HKIT
+# include <blob/arch/hackkit.h>
 #elif defined H3600
 # include <blob/arch/h3600.h>
 #elif defined IDR
@@ -53,19 +62,35 @@
 # include <blob/arch/jornada720.h>
 #elif defined LART
 # include <blob/arch/lart.h>
+#elif defined LUBBOCK
+#include <blob/arch/lubbock.h>
+#elif defined MAINSTONE
+#include <blob/arch/mainstone.h>
+#include <blob/arch/pxa-regs.h>
+#elif defined MINIPRINT
+# include <blob/arch/miniprint.h>
 #elif defined NESA
 # include <blob/arch/nesa.h>
 #elif defined PLEB
 # include <blob/arch/pleb.h>
+#elif defined RAMSES
+# include <blob/arch/ramses.h>
 #elif defined SHANNON
 # include <blob/arch/shannon.h>
+#elif defined SMDK2500
+# include <blob/arch/smdk2500.h>
 #elif defined PT_SYSTEM3
 # include <blob/arch/system3.h>
+#elif defined PT_DAFIT
+# include <blob/arch/dafit.h>
+#elif defined TRIZEPS
+# include <blob/arch/trizeps.h>
+#elif defined PXA_IDP
+# include <blob/arch/pxa_idp.h>
+#elif defined CSIR_IMS
+# include <blob/arch/csir_ims.h>
 #else
 # error "Please add an architecture specific include file"
 #endif
 
-
-
-
 #endif
Index: build_tree/bootLoader/include/blob/bitfield.h
diff -u /dev/null build_tree/bootLoader/include/blob/bitfield.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/bitfield.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,113 @@
+/*
+ *	FILE    	bitfield.h
+ *
+ *	Version 	1.1
+ *	Author  	Copyright (c) Marc A. Viredaz, 1998
+ *	        	DEC Western Research Laboratory, Palo Alto, CA
+ *	Date    	April 1998 (April 1997)
+ *	System  	Advanced RISC Machine (ARM)
+ *	Language	C or ARM Assembly
+ *	Purpose 	Definition of macros to operate on bit fields.
+ */
+
+
+
+#ifndef __BITFIELD_H
+#define __BITFIELD_H
+
+#ifndef __ASSEMBLY__
+#define UData(Data)	((unsigned long) (Data))
+#else
+#define UData(Data)	(Data)
+#endif
+
+
+/*
+ * MACRO: Fld
+ *
+ * Purpose
+ *    The macro "Fld" encodes a bit field, given its size and its shift value
+ *    with respect to bit 0.
+ *
+ * Note
+ *    A more intuitive way to encode bit fields would have been to use their
+ *    mask. However, extracting size and shift value information from a bit
+ *    field's mask is cumbersome and might break the assembler (255-character
+ *    line-size limit).
+ *
+ * Input
+ *    Size      	Size of the bit field, in number of bits.
+ *    Shft      	Shift value of the bit field with respect to bit 0.
+ *
+ * Output
+ *    Fld       	Encoded bit field.
+ */
+
+#define Fld(Size, Shft)	(((Size) << 16) + (Shft))
+
+
+/*
+ * MACROS: FSize, FShft, FMsk, FAlnMsk, F1stBit
+ *
+ * Purpose
+ *    The macros "FSize", "FShft", "FMsk", "FAlnMsk", and "F1stBit" return
+ *    the size, shift value, mask, aligned mask, and first bit of a
+ *    bit field.
+ *
+ * Input
+ *    Field     	Encoded bit field (using the macro "Fld").
+ *
+ * Output
+ *    FSize     	Size of the bit field, in number of bits.
+ *    FShft     	Shift value of the bit field with respect to bit 0.
+ *    FMsk      	Mask for the bit field.
+ *    FAlnMsk   	Mask for the bit field, aligned on bit 0.
+ *    F1stBit   	First bit of the bit field.
+ */
+
+#define FSize(Field)	((Field) >> 16)
+#define FShft(Field)	((Field) & 0x0000FFFF)
+#define FMsk(Field)	(((UData (1) << FSize (Field)) - 1) << FShft (Field))
+#define FAlnMsk(Field)	((UData (1) << FSize (Field)) - 1)
+#define F1stBit(Field)	(UData (1) << FShft (Field))
+
+
+/*
+ * MACRO: FInsrt
+ *
+ * Purpose
+ *    The macro "FInsrt" inserts a value into a bit field by shifting the
+ *    former appropriately.
+ *
+ * Input
+ *    Value     	Bit-field value.
+ *    Field     	Encoded bit field (using the macro "Fld").
+ *
+ * Output
+ *    FInsrt    	Bit-field value positioned appropriately.
+ */
+
+#define FInsrt(Value, Field) \
+                	(UData (Value) << FShft (Field))
+
+
+/*
+ * MACRO: FExtr
+ *
+ * Purpose
+ *    The macro "FExtr" extracts the value of a bit field by masking and
+ *    shifting it appropriately.
+ *
+ * Input
+ *    Data      	Data containing the bit-field to be extracted.
+ *    Field     	Encoded bit field (using the macro "Fld").
+ *
+ * Output
+ *    FExtr     	Bit-field value.
+ */
+
+#define FExtr(Data, Field) \
+                	((UData (Data) >> FShft (Field)) & FAlnMsk (Field))
+
+
+#endif /* __BITFIELD_H */
Index: build_tree/bootLoader/include/blob/cf.h
diff -u /dev/null build_tree/bootLoader/include/blob/cf.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/cf.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,44 @@
+/*
+ * cf.h
+ *
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef BLOB_CF_H
+#define BLOB_CF_H 1
+
+/*****************************************************************
+ * CF Flash register definitions
+ */
+/* config register - offset 0 */
+#define CF_REG_CFG		(0x00)
+#define CF_CFG_SRST		(0x80)
+#define CF_CFG_LVLREQ	(0x40)
+#define CF_CFG_MMAP		(0x00)
+#define CF_CFG_IOMAP	(0x01)
+#define CF_CFG_IO_IDE0	(0x02)
+#define CF_CFG_IO_IDE1	(0x03)
+
+/* config status register - offset 2 */
+#define CF_REG_CFGSTAT	(0x02)
+
+/* init CF card in PCMCIA slot <slot> */
+int cf_init( int slot );
+
+/* io driver init */
+int cf_io_init( io_driver_t *io );
+
+#endif
Index: build_tree/bootLoader/include/blob/command.h
diff -u build_tree/bootLoader/include/blob/command.h:1.1.1.1 build_tree/bootLoader/include/blob/command.h:1.1.1.2
--- build_tree/bootLoader/include/blob/command.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/command.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      command.h
- * Version:       $Id: command.h,v 1.2 2001/10/07 15:27:35 erikm Exp $
+ * Version:       $Id: command.h,v 1.3 2003/02/12 21:56:01 erikm Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   Header file for command.c
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: command.h,v 1.2 2001/10/07 15:27:35 erikm Exp $"
+#ident "$Id: command.h,v 1.3 2003/02/12 21:56:01 erikm Exp $"
 
 #ifndef BLOB_COMMAND_H
 #define BLOB_COMMAND_H
@@ -66,7 +66,7 @@
 
 int parse_command(char *cmdline);
 
-#define MAX_COMMANDLINE_LENGTH (128)
+#define MAX_COMMANDLINE_LENGTH (256)
 #define MAX_ARGS (MAX_COMMANDLINE_LENGTH / 4)
 
 void DisplayPrompt(char *prompt);
Index: build_tree/bootLoader/include/blob/command_hist.h
diff -u build_tree/bootLoader/include/blob/command_hist.h:1.1.1.1 build_tree/bootLoader/include/blob/command_hist.h:1.1.1.2
--- build_tree/bootLoader/include/blob/command_hist.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/command_hist.h	Fri Nov  9 09:44:05 2007
@@ -5,7 +5,7 @@
  *	
  *	Header file for command_hist.h
  *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -24,7 +24,7 @@
  *
  */
 
-#ident "$Id: command_hist.h,v 1.1 2001/10/07 23:32:05 erikm Exp $"
+#ident "$Id: command_hist.h,v 1.2 2002/02/11 16:54:22 seletz Exp $"
 
 #ifndef BLOB_COMMAND_HIST_H
 #define BLOB_COMMAND_HIST_H
Index: build_tree/bootLoader/include/blob/compr_rubin.h
diff -u /dev/null build_tree/bootLoader/include/blob/compr_rubin.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/compr_rubin.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,19 @@
+/* Rubin encoder/decoder header       */
+/* work started at   : aug   3, 1994  */
+/* last modification : aug  15, 1994  */
+/* $Id: compr_rubin.h,v 1.2 2002/02/16 00:43:59 erikm Exp $ */
+
+#ident "$Id: compr_rubin.h,v 1.2 2002/02/16 00:43:59 erikm Exp $"
+
+#ifndef BLOB_COMPR_RUBIN_H
+#define BLOB_COMPR_RUBIN_H
+
+#define RUBIN_REG_SIZE   16
+#define UPPER_BIT_RUBIN    (((long) 1)<<(RUBIN_REG_SIZE-1))
+#define LOWER_BITS_RUBIN   ((((long) 1)<<(RUBIN_REG_SIZE-1))-1)
+
+
+void dynrubin_decompress(unsigned char *data_in, unsigned char *cpage_out, 
+		unsigned long sourcelen, unsigned long dstlen);
+
+#endif
Index: build_tree/bootLoader/include/blob/config.h
diff -u /dev/null build_tree/bootLoader/include/blob/config.h:1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/config.h	Mon Nov 12 16:25:56 2007
@@ -0,0 +1,173 @@
+/* include/blob/config.h.  Generated by configure.  */
+/* include/blob/config.h.in.  Generated from configure.in by autoheader.  */
+
+/* Accelent IDP */
+/* #undef ACCELENT_SA */
+
+/* Intel Assabet */
+/* #undef ASSABET */
+
+/* Hewlett-Packard Laboratories Badge-4 */
+/* #undef BADGE4 */
+
+/* "Debug code" */
+/* #undef BLOB_DEBUG */
+
+/* "Board name" */
+#define BOARD_NAME "Intel HCDDBBVA0 (Mainstone)"
+
+/* Intel Brutus */
+/* #undef BRUTUS */
+
+/* Iskratel CEP */
+/* #undef CEP */
+
+/* Delft University of Technology CreditLART */
+/* #undef CLART */
+
+/* "CF support" */
+/* #undef CONFIG_CF_SUPPORT */
+
+/* "CRAMFS support" */
+/* #undef CONFIG_CRAMFS_SUPPORT */
+
+/* "GIO support" */
+/* #undef CONFIG_GIO_SUPPORT */
+
+/* "IDE support" */
+/* #undef CONFIG_IDE_SUPPORT */
+
+/* "JFFS2 support" */
+/* #undef CONFIG_JFFS2_SUPPORT */
+
+/* "lcd support" */
+#define CONFIG_LCD_SUPPORT no
+
+/* "MD5 support" */
+/* #undef CONFIG_MD5_SUPPORT */
+
+/* "Network support" */
+/* #undef CONFIG_NETWORK_SUPPORT */
+
+/* "PCMCIA support" */
+/* #undef CONFIG_PCMCIA_SUPPORT */
+
+/* "USBDNET support" */
+/* #undef CONFIG_USBDNET_SUPPORT */
+
+/* "Serial Over USB support" */
+/* #undef CONFIG_USBSERIAL_SUPPORT */
+
+/* "UU Codec support" */
+/* #undef CONFIG_UUCODEC_SUPPORT */
+
+/* "Xmodem support" */
+#define CONFIG_XMODEM_SUPPORT no
+
+/* "zImage support" */
+/* #undef CONFIG_ZIMAGE_SUPPORT */
+
+/* "CPU type" */
+#define CPU "pxa250"
+
+/* CSIR Incident Management System */
+/* #undef CSIR_IMS */
+
+/* 2d3D, Inc. SA-1110 Development Board */
+/* #undef FRODO */
+
+/* Compaq Ipaq H3600 series */
+/* #undef H3600 */
+
+/* The Hack Kit base cpu board */
+/* #undef HKIT */
+
+/* Vercel UD-1 (IDR) */
+/* #undef IDR */
+
+/* Hewlett-Packard Jornada 720 with flash daughter board */
+/* #undef JORNADA720 */
+
+/* "Kernel XIP" */
+/* #undef KERNEL_XIP_BASE */
+
+/* Delft University of Technology LART */
+/* #undef LART */
+
+/* Intel HCDDBCTA1 (Lubbock) */
+/* #undef LUBBOCK */
+
+/* Intel HCDDBBVA0 (Mainstone) */
+#define MAINSTONE 1
+
+/* FGAG miniprint */
+/* #undef MINIPRINT */
+
+/* Neponset Expansion Board */
+/* #undef NEPONSET */
+
+/* NESA */
+/* #undef NESA */
+
+/* Name of package */
+#define PACKAGE "blob"
+
+/* Define to the address where bug reports for this package should be sent. */
+#define PACKAGE_BUGREPORT ""
+
+/* Define to the full name of this package. */
+#define PACKAGE_NAME ""
+
+/* Define to the full name and version of this package. */
+#define PACKAGE_STRING ""
+
+/* Define to the one symbol short name of this package. */
+#define PACKAGE_TARNAME ""
+
+/* Define to the version of this package. */
+#define PACKAGE_VERSION ""
+
+/* University of New South Wales PLEB */
+/* #undef PLEB */
+
+/* Prueftechnik VibXpert */
+/* #undef PT_DAFIT */
+
+/* Prueftechnik Digital Board REV 0802 */
+/* #undef PT_SYSTEM3 */
+
+/* Intel XScale PXA250 */
+#define PXA250 1
+
+/* Accelent PXA250 IDP */
+/* #undef PXA_IDP */
+
+/* M&N MN-CI Logistic Terminal (ramses) */
+/* #undef RAMSES */
+
+/* Samsung s3c2500a */
+/* #undef S3C2500 */
+
+/* Intel StrongARM SA1100 */
+/* #undef SA1100 */
+
+/* Intel StrongARM SA1110 */
+/* #undef SA1110 */
+
+/* TuxScreen (Shannon) */
+/* #undef SHANNON */
+
+/* SMDK2500 Evaluation Board */
+/* #undef SMDK2500 */
+
+/* Keith & Koep Trizeps Board */
+/* #undef TRIZEPS */
+
+/* Version number of package */
+#define VERSION "2.0.5-pre3"
+
+/* Define to `__inline__' or `__inline' if that's what the C compiler
+   calls it, or to nothing if 'inline' is not supported under any name.  */
+#ifndef __cplusplus
+/* #undef inline */
+#endif
Index: build_tree/bootLoader/include/blob/config.h.in
diff -u build_tree/bootLoader/include/blob/config.h.in:1.1.1.1 build_tree/bootLoader/include/blob/config.h.in:1.2
--- build_tree/bootLoader/include/blob/config.h.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/config.h.in	Mon Nov 12 16:25:56 2007
@@ -1,111 +1,172 @@
-/* include/blob/config.h.in.  Generated automatically from configure.in by autoheader 2.13.  */
-/*-------------------------------------------------------------------------
- * Filename:      acconfig.h
- * Version:       $Id: acconfig.h,v 1.12 2002/01/07 14:58:16 erikm Exp $
- * Copyright:     Copyright (C) 1999, Erik Mouw
- * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- * Description:   Definitions for GNU autoconf/automake/libtool
- * Created at:    Wed Jul 28 22:35:51 1999
- * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- * Modified at:   Sun Oct  3 18:47:48 1999
- *-----------------------------------------------------------------------*/
-/*
- * acconfig.h: Definitions for GNU autoconf/automake/libtool
- *
- * Copyright (C) 1999  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-/* 
- *
- * WARNING:
- *   Don't try to edit config.h.in or config.h, because your changes
- *   will be overwritten once you run automake, autoconf or
- *   configure. Edit acconfig.h instead.
- *
- */
+/* include/blob/config.h.in.  Generated from configure.in by autoheader.  */
 
-#ident "$Id: acconfig.h,v 1.12 2002/01/07 14:58:16 erikm Exp $"
+/* Accelent IDP */
+#undef ACCELENT_SA
 
-#ifndef BLOB_CONFIG_H
-#define BLOB_CONFIG_H
+/* Intel Assabet */
+#undef ASSABET
 
+/* Hewlett-Packard Laboratories Badge-4 */
+#undef BADGE4
 
-/* Define as __inline if that's what the C compiler calls it.  */
-#undef inline
+/* "Debug code" */
+#undef BLOB_DEBUG
 
-/* Define the board name over here */
+/* "Board name" */
 #undef BOARD_NAME
 
-/* Define to enable run-time debug information */
-#undef BLOB_DEBUG
+/* Intel Brutus */
+#undef BRUTUS
 
-/* Define for Assabet boards */
-#undef ASSABET
+/* Iskratel CEP */
+#undef CEP
 
-/* Define if Neponset board attached to Assabet */
-#undef NEPONSET
+/* Delft University of Technology CreditLART */
+#undef CLART
 
-/* Define for Badge 4 */
-#undef BADGE4
+/* "CF support" */
+#undef CONFIG_CF_SUPPORT
 
-/* Define for Brutus boards */
-#undef BRUTUS
+/* "CRAMFS support" */
+#undef CONFIG_CRAMFS_SUPPORT
 
-/* Define for CreditLART boards */
-#undef CLART
+/* "GIO support" */
+#undef CONFIG_GIO_SUPPORT
+
+/* "IDE support" */
+#undef CONFIG_IDE_SUPPORT
+
+/* "JFFS2 support" */
+#undef CONFIG_JFFS2_SUPPORT
+
+/* "lcd support" */
+#undef CONFIG_LCD_SUPPORT
+
+/* "MD5 support" */
+#undef CONFIG_MD5_SUPPORT
+
+/* "Network support" */
+#undef CONFIG_NETWORK_SUPPORT
+
+/* "PCMCIA support" */
+#undef CONFIG_PCMCIA_SUPPORT
+
+/* "USBDNET support" */
+#undef CONFIG_USBDNET_SUPPORT
+
+/* "Serial Over USB support" */
+#undef CONFIG_USBSERIAL_SUPPORT
+
+/* "UU Codec support" */
+#undef CONFIG_UUCODEC_SUPPORT
+
+/* "Xmodem support" */
+#undef CONFIG_XMODEM_SUPPORT
+
+/* "zImage support" */
+#undef CONFIG_ZIMAGE_SUPPORT
+
+/* "CPU type" */
+#undef CPU
+
+/* CSIR Incident Management System */
+#undef CSIR_IMS
+
+/* 2d3D, Inc. SA-1110 Development Board */
+#undef FRODO
 
-/* Define for Ipaq H3600 */
+/* Compaq Ipaq H3600 series */
 #undef H3600
 
-/* Define for Vercel UD-1 (IDR) */
+/* The Hack Kit base cpu board */
+#undef HKIT
+
+/* Vercel UD-1 (IDR) */
 #undef IDR
 
-/* Define for Jornada 720 */
+/* Hewlett-Packard Jornada 720 with flash daughter board */
 #undef JORNADA720
 
-/* Define for LART boards */
+/* "Kernel XIP" */
+#undef KERNEL_XIP_BASE
+
+/* Delft University of Technology LART */
 #undef LART
 
-/* Define for NESA boards */
+/* Intel HCDDBCTA1 (Lubbock) */
+#undef LUBBOCK
+
+/* Intel HCDDBBVA0 (Mainstone) */
+#undef MAINSTONE
+
+/* FGAG miniprint */
+#undef MINIPRINT
+
+/* Neponset Expansion Board */
+#undef NEPONSET
+
+/* NESA */
 #undef NESA
 
-/* Define for PLEB boards */
+/* Name of package */
+#undef PACKAGE
+
+/* Define to the address where bug reports for this package should be sent. */
+#undef PACKAGE_BUGREPORT
+
+/* Define to the full name of this package. */
+#undef PACKAGE_NAME
+
+/* Define to the full name and version of this package. */
+#undef PACKAGE_STRING
+
+/* Define to the one symbol short name of this package. */
+#undef PACKAGE_TARNAME
+
+/* Define to the version of this package. */
+#undef PACKAGE_VERSION
+
+/* University of New South Wales PLEB */
 #undef PLEB
 
-/* Define for PT System 3 boards */
+/* Prueftechnik VibXpert */
+#undef PT_DAFIT
+
+/* Prueftechnik Digital Board REV 0802 */
 #undef PT_SYSTEM3
 
-/* Define for Shannon (TuxScreen) */
-#undef SHANNON
+/* Intel XScale PXA250 */
+#undef PXA250
 
-/* Define if LCD support is wanted */
-#undef CONFIG_LCD_SUPPORT
+/* Accelent PXA250 IDP */
+#undef PXA_IDP
 
-/* Define if MD5 support is wanted */
-#undef CONFIG_MD5_SUPPORT
+/* M&N MN-CI Logistic Terminal (ramses) */
+#undef RAMSES
 
-/* Define the CPU type */
-#undef CPU
+/* Samsung s3c2500a */
+#undef S3C2500
 
-/* Name of package */
-#undef PACKAGE
+/* Intel StrongARM SA1100 */
+#undef SA1100
+
+/* Intel StrongARM SA1110 */
+#undef SA1110
+
+/* TuxScreen (Shannon) */
+#undef SHANNON
+
+/* SMDK2500 Evaluation Board */
+#undef SMDK2500
+
+/* Keith & Koep Trizeps Board */
+#undef TRIZEPS
 
 /* Version number of package */
 #undef VERSION
 
-
+/* Define to `__inline__' or `__inline' if that's what the C compiler
+   calls it, or to nothing if 'inline' is not supported under any name.  */
+#ifndef __cplusplus
+#undef inline
 #endif
Index: build_tree/bootLoader/include/blob/crc32.h
diff -u /dev/null build_tree/bootLoader/include/blob/crc32.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/crc32.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,38 @@
+/*
+ * crc32.h: calculate CRC32
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl> and
+ *                     Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
+ *   based on linux/drivers/net/am79c961a.c
+ * Copyright (C) 1995-2001 Russell King <rmk@arm.linux.org.uk>
+ *
+ * $Id: crc32.h,v 1.3 2002/01/21 13:13:33 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: crc32.h,v 1.3 2002/01/21 13:13:33 erikm Exp $"
+
+#ifndef BLOB_CRC32_H
+#define BLOB_CRC32_H
+
+
+#include <blob/types.h>
+
+
+u32 crc32(u32 val, const void *data, int len);
+
+
+#endif
Index: build_tree/bootLoader/include/blob/debug.h
diff -u /dev/null build_tree/bootLoader/include/blob/debug.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/debug.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,51 @@
+/*
+ * debug.h: some debug macros
+ *
+ * Copyright (C) 2002  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: debug.h,v 1.3 2002/02/12 23:55:24 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: debug.h,v 1.3 2002/02/12 23:55:24 erikm Exp $"
+
+#ifndef BLOB_DEBUG_H
+#define BLOB_DEBUG_H
+
+
+#ifdef BLOB_DEBUG
+
+
+#include <blob/util.h>	/* for printf() */
+#include <blob/error.h>	/* for eprintf() */
+
+#define dprintf(fmt, args...) \
+	printf("%s(): " fmt, __FUNCTION__ , ## args)
+
+#define deprintf(fmt, args...) \
+	printerrprefix(); \
+	printf("%s(): " fmt, __FUNCTION__ , ## args)
+
+#else
+
+# define dprintf(fmt, args...)
+# define deprintf(fmt, args...)
+
+#endif
+
+
+#endif
Index: build_tree/bootLoader/include/blob/download.h
diff -u /dev/null build_tree/bootLoader/include/blob/download.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/download.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,36 @@
+/* download.h: download helpers
+ * 
+ * Copyright (C) 2003 Russ Dill <Russ.Dill@asu.edu>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: download.h,v 1.1 2003/09/04 17:46:59 russd Exp $
+ */
+
+#ifndef BLOB_DOWNLOAD_H
+#define BLOB_DOWNLOAD_H 1
+
+#include <main.h>
+
+extern blob_status_t blob_status;
+
+void PrintSerialSpeed(serial_baud_t speed);
+int set_download_parameters(char *name, u32 *startAddress, 
+				int *bufLen, int **numRead, u32 **digest);
+void do_md5sum(u32 *addr, size_t len, u32 *digest);
+int SetDownloadSpeed(int argc, char *argv[]);
+int do_reload(char *what);
+
+#endif
Index: build_tree/bootLoader/include/blob/error.h
diff -u build_tree/bootLoader/include/blob/error.h:1.1.1.1 build_tree/bootLoader/include/blob/error.h:1.1.1.2
--- build_tree/bootLoader/include/blob/error.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/error.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: error.h,v 1.1 2001/10/07 15:17:49 erikm Exp $
+ * $Id: error.h,v 1.2 2002/02/12 23:55:24 erikm Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,15 +21,20 @@
  *
  */
 
-#ident "$Id: error.h,v 1.1 2001/10/07 15:17:49 erikm Exp $"
+#ident "$Id: error.h,v 1.2 2002/02/12 23:55:24 erikm Exp $"
 
 #ifndef BLOB_ERROR_H
 #define BLOB_ERROR_H
 
+#include <blob/util.h>	/* for printf() */
 
 char *strerror(int errnum);
 void printerrprefix(void);
 void printerror(int errnum, char *s);
 
+#define eprintf(fmt, args...) \
+	printerrprefix(); \
+	printf(fmt , ## args)
+
 
 #endif
Index: build_tree/bootLoader/include/blob/flash.h
diff -u build_tree/bootLoader/include/blob/flash.h:1.1.1.1 build_tree/bootLoader/include/blob/flash.h:1.1.1.2
--- build_tree/bootLoader/include/blob/flash.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/flash.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      flash.h
- * Version:       $Id: flash.h,v 1.9 2001/12/31 00:28:53 erikm Exp $
+ * Version:       $Id: flash.h,v 1.14 2003/09/03 01:44:27 russd Exp $
  * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
  * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
  * Description:   Flash I/O functions for the blob loader
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: flash.h,v 1.9 2001/12/31 00:28:53 erikm Exp $"
+#ident "$Id: flash.h,v 1.14 2003/09/03 01:44:27 russd Exp $"
 
 #ifndef BLOB_FLASH_H
 #define BLOB_FLASH_H
@@ -42,7 +42,6 @@
 	int lockable;
 } flash_descriptor_t;
 
-
 typedef int (*flash_erase_func_t)(u32 *);
 typedef int (*flash_write_func_t)(u32 *, const u32 *);
 typedef int (*flash_lock_block_func_t)(u32 *);
@@ -50,7 +49,7 @@
 typedef int (*flash_query_block_lock_func_t)(u32 *);
 typedef int (*flash_enable_vpp_func_t)(void);
 typedef int (*flash_disable_vpp_func_t)(void);
-
+typedef int (*flash_query_descriptors_func_t)(u32 *, flash_descriptor_t **out);
 
 typedef struct {
 	/* the following functions should be implemented by all flash
@@ -67,10 +66,13 @@
 	 * functions unimplemented, blob will safely work around it */
 	flash_enable_vpp_func_t enable_vpp;
 	flash_disable_vpp_func_t disable_vpp;
-} flash_driver_t;
 
+	/* optional: determine the descriptors automagically */
+	flash_query_descriptors_func_t query_descriptors;
+} flash_driver_t;
 
 /* implemented flash drivers */
+extern flash_driver_t amd16_flash_driver;
 extern flash_driver_t amd32_flash_driver;
 extern flash_driver_t intel16_flash_driver;
 extern flash_driver_t intel32_flash_driver;
@@ -78,9 +80,14 @@
 
 
 /* should be filled out by the architecture dependent files */
-extern flash_descriptor_t *flash_descriptors;
 extern flash_driver_t *flash_driver;
 
+/* should be filled out by the architecture dependent files; can
+ * be set to QUERY_FLASH_FOR_DESCRIPTORS() if driver supports that */
+#define QUERY_FLASH_FOR_DESCRIPTORS(flash_addr) \
+  { { .size = (u32) flash_addr, .num = -1 } }
+extern const flash_descriptor_t *flash_descriptors;
+
 
 /* flash data mangle functions */
 u32 data_from_flash(u32 what);
@@ -94,5 +101,17 @@
 int flash_unlock_region(u32 *start, u32 nwords);
 int flash_query_region(u32 *start, u32 nwords);
 
+int flash_get_first_block_address(u32 *addr);
+int flash_get_next_block_address(u32* addr, u32 current);
+int flash_get_block_size(u32 address);
+u32 flash_get_size( void );
+
+/* CFI offsets ... useful to many flavors of flash */
+#define CFI_MANUF_CODE		0x00
+#define CFI_DEVICE_CODE		0x01
+#define CFI_DEVICE_SIZE_LG2	0x27
+#define CFI_ERASE_REGION_COUNT	0x2c
+#define CFI_ERASE_REGION_XBLKS(n) 	(0x2d + 4 * (n))
+#define CFI_ERASE_REGION_XSIZE(n) 	(0x2f + 4 * (n))
 
 #endif
Index: build_tree/bootLoader/include/blob/generic_io.h
diff -u /dev/null build_tree/bootLoader/include/blob/generic_io.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/generic_io.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,236 @@
+/* generic_io.h - generic io interface
+ * 
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: generic_io.h,v 1.2 2002/05/10 15:35:37 seletz Exp $
+ */
+
+#ifndef BLOB_GENERIC_IO_H
+#define BLOB_GENERIC_IO_H 1
+
+/*
+BLOB io abstraction module
+~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+Why do I think that this is necessary?
+---------------------------------------
+
+Please consider the following scenario:
+
+A ARM-Linux powered device gets developed, produced and delivered to many
+customers. As usual, system updates are necessary at some point in the future.
+System updates should be fool-proof and easy to perform, w/o JTAG cables,
+computers and so on. One possible solution:
+A CF card contains a filesystem on a partition. There are
+several files on this partition/filesystem:
+	- blob
+	- zImage
+	- initrd.gz
+	- cramfs.img
+
+This (special) CF card contains thus all necessary files for a complete
+system update (or recovery). The end-user of our new arm-powered linux
+device now only has to plug in the CF card, reset the device and blob does
+the rest:
+	1) detect a system update CF card (i.e. searches for a special file
+	   or a special magic number)
+	2) perhaps verifies somehow the contents (md5 sums etc.)
+	3) reflashes all images stored on the CF card to the internal
+	   flash
+	4) marks the CF card as "already used" somehow (by writing some
+	   file, deleting the images, etc. )
+	5) reboots the system
+
+So, all in all what I want is:
+	- have the internal flash memory partitionized. Each partition has a
+	  "sane" name, i.e. "blob", "kernel", "initrd" and so on.
+	- I want to be able to reflash each partition using blob
+	- I want to have several FS options to access my CF card, i.e.
+	  FAT fs (easy to use for customers), CRAMFS (code already there),
+	  raw TAR file access (uncompressed, code here. useful for updates
+	  per tftp and xmodem downloads).
+	- I want to have access to CF cards, network devices (tftp)
+	- I want to have the code modules nicely separated
+
+How do I want o archieve this?
+------------------------------
+
+For the above scenario to become reality one needs to:
+	- supply several FS access modules (some people want to have
+	  a FAT filesystem on the update device, some like cramfs, and some
+	  raw TAR archives containing the update images).
+	- provide several different "update devices" i.e. CF cards, memory
+	  (i.e. downloaded files), network interfaces (tftp).
+	- provide access to the internal flash memory
+
+The code below tries to supply a abstraction layer such that for example
+the filesystem code does not need to know how to access the update device,
+the partition code does not need how to access the CF card or the internal
+flash memory. 
+
+With this library it should be possible to implement the update scenario
+in a clean way.
+
+[CF Card]--ide cf access-->[Partition code]--partition access--+
+                                                               |
+  +------------------------------------------------------------+
+  |
+  +->[FS code]--file access-->[Partition code]-->[flash code]
+
+[] are io "drivers". They know how to read/write on their abstraction
+   levels, i.e. the partition "io driver" knows how to read partition
+   data
+
+The io drivers are chained, from highest abstraction (file access) down
+to the lowest abstraction (raw flash read/write, CF IDE reads).
+
+ */
+
+#define IO_NAME_LEN		32
+#define IO_MAX_DRIVER	16
+
+struct _io_def;
+
+/* io_init_func - initialize private data
+ * 
+ * This function configures the io driver
+ *
+ * driver:			the driver struct
+ * init_data:		data the driver needs to init
+ * 
+ */
+typedef int (*io_configure_func)( struct _io_def *driver, void *init_data );
+
+/* read_func - generic io function type
+ *
+ * This function reads data "out" of the driver
+ *
+ * dest: 			where to write the data to
+ * src:				where to read from
+ * amount:			how much to read
+ * driver:			the driver struct
+ *
+ */
+typedef int (*io_read_func)( unsigned char *dest, unsigned char *src, size_t amount, struct _io_def *driver );
+
+/* write_func - generic io function type
+ *
+ * This function writes data "into" the driver
+ *
+ * dest: 			where to write the data to
+ * src:				where to read from
+ * amount:			how much to read
+ * driver:			the driver struct
+ *
+ */
+typedef int (*io_write_func)( unsigned char *dest, unsigned char *src, size_t amount, struct _io_def *driver );
+
+typedef struct _io_def {
+	/* driver subfunctions, see below */
+	io_configure_func conf;
+	io_read_func read;
+	io_write_func write;
+	/* driver's private data */
+	void *private_data;
+	/* io size in bytes */
+	size_t	io_size;
+	/* child io driver, if any */
+	struct _io_def *child_io;
+	/* driver's name */
+	char name[IO_NAME_LEN];
+} io_driver_t;
+
+void io_dbg_set( int lvl );
+
+/* io_init - initialize generic io module
+ */
+void io_init( void );
+
+/* io_register - register a new io.
+ *
+ * io:			the io to register 
+ * name:			the io's name
+ */
+int io_register( io_driver_t *io, char *name );
+
+/* io_configure - configures io driver
+ *
+ * io_name:		the io "driver" name
+ * conf_data:	the configuration data
+ */
+int io_configure( char *io_name, void *conf_data );
+
+/* io_get_byname - get a io by its name
+ *
+ * name:			the searched io's name 
+ */
+io_driver_t *io_get_byname( char *name );
+
+/* io_chain_driver - chain io drivers
+ *
+ * parent:			parent driver
+ * new_child:		new child driver
+ */
+int io_chain_driver( char *parent, char *new_child );
+
+/* io_read - read data using io rd
+ * 
+ * dest:		destination address
+ * src:			source address
+ * amount:		amount to read
+ */
+int io_read( unsigned char *dest, unsigned char *src,
+		size_t amount, io_driver_t *rd );
+
+/* io_write - write data using io wr
+ * 
+ * dest:		destination address
+ * src:			source address
+ * amount:		amount to read
+ */
+int io_write( unsigned char *dest, unsigned char *src,
+		size_t amount, io_driver_t *wr );
+
+/* io_copy - copy data
+ *
+ * Copy data from io driver "src" to io driver "dest". Copy
+ * "amount" bytes of data. If amount is 0, then copy all
+ * available data from "src".
+ *
+ * dest:		destination io driver name
+ * src:			source io driver name
+ * amount:		amount to copy
+ */
+int io_copy( char *dest, char *src, size_t amount );
+
+/* FIXME: static inline functions instead of macros */
+#define io_get_name( io ) ((io)->name)
+#define io_get_size( io ) ((io)->io_size)
+#define io_get_child( io) ((io)->child_io)
+
+/**********************************************************************
+ * RAM io driver
+ */
+typedef struct ram_io {
+	u32	start;
+	u32 len;
+	u32 pos;
+} ram_io_t;
+
+int ram_io_init( io_driver_t *io, ram_io_t *ram );
+
+#endif
Index: build_tree/bootLoader/include/blob/gio_drivers.h
diff -u /dev/null build_tree/bootLoader/include/blob/gio_drivers.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/gio_drivers.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,29 @@
+/* gio_drivers.h - generic io drivers
+ * 
+ * Copyright (C) 2003, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: gio_drivers.h,v 1.1 2003/04/03 14:50:54 seletz Exp $
+ */
+
+#ifndef BLOB_GIO_DRV_H
+#define BLOB_GIO_DRV_H 1
+
+extern void init_flash_io(void);
+extern void init_part_io(void);
+extern void init_ram_io(void);
+
+#endif
Index: build_tree/bootLoader/include/blob/i2c-gpio.h
diff -u /dev/null build_tree/bootLoader/include/blob/i2c-gpio.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/i2c-gpio.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,18 @@
+#ifndef _I2C_GPIO_H_
+#define _I2C_GPIO_H_
+
+#include <blob/types.h>
+
+struct i2c_bus_gpio_private {
+	unsigned sda_gpio;
+	unsigned scl_gpio;
+	unsigned delay;
+};
+
+extern int init_bus_gpio(struct i2c_bus *);
+extern int set_sda_gpio(struct i2c_bus *, unsigned);
+extern int get_sda_gpio(struct i2c_bus *);
+extern int set_scl_gpio(struct i2c_bus *, unsigned);
+extern int get_scl_gpio(struct i2c_bus *);
+
+#endif
Index: build_tree/bootLoader/include/blob/i2c.h
diff -u /dev/null build_tree/bootLoader/include/blob/i2c.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/i2c.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,37 @@
+#ifndef _I2C_H_
+#define _I2C_H_
+
+#include <blob/types.h>
+
+struct i2c_bus {
+	int (*init_bus)(struct i2c_bus *);
+	int (*set_scl)(struct i2c_bus *, unsigned sense);
+	int (*set_sda)(struct i2c_bus *, unsigned sense);
+	int (*get_scl)(struct i2c_bus *);
+	int (*get_sda)(struct i2c_bus *);
+
+	void *private;
+};
+
+////////////////////////////////////////////////////////////////////////
+
+/* high-level operators */
+extern int i2c_init(struct i2c_bus *);
+extern int i2c_read_device_byte(struct i2c_bus *, u8);
+extern int i2c_read_device_byte_at(struct i2c_bus *bus, u8, u8);
+extern int i2c_read_device_bytes(struct i2c_bus *, u8, u8, u8 *, unsigned long);
+extern int i2c_write_device_byte_at(struct i2c_bus *, u8, u8, u8);
+extern int i2c_write_device_bytes_at(struct i2c_bus *, u8, u8, const u8 *, unsigned long);
+extern int i2c_probe(struct i2c_bus *bus, u8);
+extern int i2c_scan(struct i2c_bus *bus, u8 map[256]);
+
+/* low-level operators */
+extern int i2c_start(struct i2c_bus *);
+extern int i2c_stop(struct i2c_bus *);
+extern int i2c_send_ack(struct i2c_bus *);
+extern int i2c_get_ack(struct i2c_bus *);
+extern int i2c_get_ack_quietly(struct i2c_bus *);
+extern int i2c_write_byte(struct i2c_bus *, u8);
+extern int i2c_read_byte(struct i2c_bus *);
+
+#endif
Index: build_tree/bootLoader/include/blob/ide.h
diff -u /dev/null build_tree/bootLoader/include/blob/ide.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/ide.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,200 @@
+/*
+ * ide.h
+ *
+ * Copyright (C) 2001, Brad Parker (brad@heeltoe.com)
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef BLOB_IDE_H
+#define BLOB_IDE_H 1
+
+#define IDE_BLOCK_SIZE (512)
+
+/* HDC Status Register Bit Masks (1F7h) */
+#define BUSY        0x80  /* busy.. can't talk now! */
+#define READY       0x40  /* Drive Ready  */
+#define WRITE_FAULT 0x20  /* Bad news */
+#define SEEKOK      0x10  /* Seek Complete */
+#define DATA_REQ    0x08  /* Sector buffer needs servicing */
+#define CORRECTED   0x04  /* ECC corrected data was read */
+#define REV_INDEX   0x02  /* Set once each disk revolution */
+#define ERROR       0x01  /* data address mark not found */
+
+/* HDC Error Register Bit Masks (1F1h) */
+#define BAD_SECTOR  0x80  /* bad block */
+#define BAD_ECC     0x40  /* bad data ecc */
+#define BAD_IDMARK  0x10  /* id not found */
+#define BAD_CMD     0x04  /* aborted command */
+#define BAD_SEEK    0x02  /* trk 0 not found on recalibrate, or bad seek */
+#define BAD_ADDRESS 0x01  /* data address mark not found */
+
+
+/* HDC internal command bytes (HDC_Cmd[7]) */
+#define HDC_RECAL      0x10   /* 0001 0000 */
+//#define HDC_READ       0x20   /* 0010 0000 */
+#define HDC_READ       0x21   /* 0010 0000 */
+#define HDC_READ_LONG  0x22   /* 0010 0010 */
+#define HDC_WRITE      0x30   /* 0011 0000 */
+#define HDC_WRITE_LONG 0x32   /* 0011 0010 */
+#define HDC_VERIFY     0x40   /* 0100 0000 */
+#define HDC_FORMAT     0x50   /* 0101 0000 */
+#define HDC_SEEK       0x70   /* 0111 0000 */
+#define HDC_DIAG       0x90   /* 1001 0000 */
+#define HDC_SET_PARAMS 0x91   /* 1001 0001 */
+#define HDC_IDENTIFY   0xEC   /* ask drive to identify itself	*/
+#define HDC_SETFEATURE 0xEF   /* set ide feature, opcodes below */
+
+/* SET FEATURE OPCODES */
+#define IDE_FEAT_8BITON		0x01	/* 8 bit io */
+#define IDE_FEAT_8BITOFF	0x81	/* set io transfer mode, parameter see below */
+#define IDE_FEAT_WCEN		0x02	/* write cache enable */
+#define IDE_FEAT_IOMODE		0x03	/* set io transfer mode, parameter see below */
+
+/* IO transfermode Feature param */
+#define IDE_IOM_PIO			0x00			/* default PIO */
+#define IDE_IOM_PIO_noIORDY	0x01			/* PIO w/o IORDY */
+#define IDE_IOM_PIO_FC( x )	(0x4|(x&0x3))	/* PIO with flow control */
+#define IDE_IOM_DMA( x )	(0x10|(x&0x3))	/* multiple DMA, mode x */
+#define IDE_IOM_UDMA( x )	(0x20|(x&0x3))	/* UDMA, mode x */
+
+#define HD_PORT 0x1f0
+#define HD_REG_PORT 0x3f6
+
+/* structure returned by HDIO_GET_IDENTITY, as per ANSI ATA2 rev.2f spec */
+typedef struct hd_driveid {
+	unsigned short	config;		/* lots of obsolete bit flags */
+	unsigned short	cyls;		/* "physical" cyls */
+	unsigned short	reserved2;	/* reserved (word 2) */
+	unsigned short	heads;		/* "physical" heads */
+	unsigned short	track_bytes;	/* unformatted bytes per track */
+	unsigned short	sector_bytes;	/* unformatted bytes per sector */
+	unsigned short	sectors;	/* "physical" sectors per track */
+	unsigned short	vendor0;	/* vendor unique */
+	unsigned short	vendor1;	/* vendor unique */
+	unsigned short	vendor2;	/* vendor unique */
+	unsigned char	serial_no[20];	/* 0 = not_specified */
+	unsigned short	buf_type;
+	unsigned short	buf_size;	/* 512 byte increments; 0 = not_specified */
+	unsigned short	ecc_bytes;	/* for r/w long cmds; 0 = not_specified */
+	unsigned char	fw_rev[8];	/* 0 = not_specified */
+	unsigned char	model[40];	/* 0 = not_specified */
+	unsigned char	max_multsect;	/* 0=not_implemented */
+	unsigned char	vendor3;	/* vendor unique */
+	unsigned short	dword_io;	/* 0=not_implemented; 1=implemented */
+	unsigned char	vendor4;	/* vendor unique */
+	unsigned char	capability;	/* bits 0:DMA 1:LBA 2:IORDYsw 3:IORDYsup*/
+	unsigned short	reserved50;	/* reserved (word 50) */
+	unsigned char	vendor5;	/* vendor unique */
+	unsigned char	tPIO;		/* 0=slow, 1=medium, 2=fast */
+	unsigned char	vendor6;	/* vendor unique */
+	unsigned char	tDMA;		/* 0=slow, 1=medium, 2=fast */
+	unsigned short	field_valid;	/* bits 0:cur_ok 1:eide_ok */
+	unsigned short	cur_cyls;	/* logical cylinders */
+	unsigned short	cur_heads;	/* logical heads */
+	unsigned short	cur_sectors;	/* logical sectors per track */
+	unsigned short	cur_capacity0;	/* logical total sectors on drive */
+	unsigned short	cur_capacity1;	/*  (2 words, misaligned int)     */
+	unsigned char	multsect;	/* current multiple sector count */
+	unsigned char	multsect_valid;	/* when (bit0==1) multsect is ok */
+	unsigned int	lba_capacity;	/* total number of sectors */
+	unsigned short	dma_1word;	/* single-word dma info */
+	unsigned short	dma_mword;	/* multiple-word dma info */
+	unsigned short  eide_pio_modes; /* bits 0:mode3 1:mode4 */
+	unsigned short  eide_dma_min;	/* min mword dma cycle time (ns) */
+	unsigned short  eide_dma_time;	/* recommended mword dma cycle time (ns) */
+	unsigned short  eide_pio;       /* min cycle time (ns), no IORDY  */
+	unsigned short  eide_pio_iordy; /* min cycle time (ns), with IORDY */
+	unsigned short	words69_70[2];	/* reserved words 69-70 */
+	/* HDIO_GET_IDENTITY currently returns only words 0 through 70 */
+	unsigned short	words71_74[4];	/* reserved words 71-74 */
+	unsigned short  queue_depth;	/*  */
+	unsigned short  words76_79[4];	/* reserved words 76-79 */
+	unsigned short  major_rev_num;	/*  */
+	unsigned short  minor_rev_num;	/*  */
+	unsigned short  command_set_1;	/* bits 0:Smart 1:Security 2:Removable 3:PM */
+	unsigned short  command_set_2;	/* bits 14:Smart Enabled 13:0 zero */
+	unsigned short  cfsse;		/* command set-feature supported extensions */
+	unsigned short  cfs_enable_1;	/* command set-feature enabled */
+	unsigned short  cfs_enable_2;	/* command set-feature enabled */
+	unsigned short  csf_default;	/* command set-feature default */
+	unsigned short  dma_ultra;	/*  */
+	unsigned short	word89;		/* reserved (word 89) */
+	unsigned short	word90;		/* reserved (word 90) */
+	unsigned short	CurAPMvalues;	/* current APM values */
+	unsigned short	word92;		/* reserved (word 92) */
+	unsigned short	hw_config;	/* hardware config */
+	unsigned short  words94_125[32];/* reserved words 94-125 */
+	unsigned short	last_lun;	/* reserved (word 126) */
+	unsigned short	word127;	/* reserved (word 127) */
+	unsigned short	dlf;		/* device lock function
+								 * 15:9	reserved
+								 * 8	security level 1:max 0:high
+								 * 7:6	reserved
+								 * 5	enhanced erase
+								 * 4	expire
+								 * 3	frozen
+								 * 2	locked
+								 * 1	en/disabled
+								 * 0	capability
+								 */
+	unsigned short  csfo;		/* current set features options
+								 * 15:4	reserved
+								 * 3	auto reassign
+								 * 2	reverting
+								 * 1	read-look-ahead
+								 * 0	write cache
+								 */
+	unsigned short	words130_155[26];/* reserved vendor words 130-155 */
+	unsigned short	word156;
+	unsigned short	words157_159[3];/* reserved vendor words 157-159 */
+	unsigned short	words160_255[95];/* reserved words 160-255 */
+} hd_driveid_t;
+
+typedef struct {
+	volatile u8 *ide_port;
+	volatile u8 *ide_reg;
+
+	unsigned int disk_sectors_per_track;
+	unsigned int disk_heads;
+
+	hd_driveid_t driveid;
+
+	u8 last_status;
+} ide_drive_t;
+
+void ide_dbg_set( int level );
+
+int ide_init( ide_drive_t *drive, u32 base_addr );
+
+int ide_status_dump( ide_drive_t *drive );
+
+int ide_reset( ide_drive_t *drive );
+
+int ide_identify_drive( ide_drive_t *drive );
+
+int ide_setfeature( ide_drive_t *drive, unsigned char opcode, unsigned char param );
+
+int hd_read( ide_drive_t *drive, int head, int sector, int cyl, char *buffer);
+
+/* read, mapping abs [0..max] sector # into head, sector, cylinder */
+int hd_read_mapped( ide_drive_t *drive, int sector_num, char *buffer);
+
+/* read in lba mode */
+int hd_read_lba( ide_drive_t *drive, u32 lba, char *buffer);
+
+int hd_map_sector( ide_drive_t *drive, int sector, int *head, int *sec, int *cyl );
+
+#endif
Index: build_tree/bootLoader/include/blob/jffs2.h
diff -u /dev/null build_tree/bootLoader/include/blob/jffs2.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/jffs2.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,186 @@
+/*
+ * JFFS2 -- Journalling Flash File System, Version 2.
+ *
+ * Copyright (C) 2001 Red Hat, Inc.
+ *
+ * Created by David Woodhouse <dwmw2@cambridge.redhat.com>
+ *
+ * The original JFFS, from which the design for JFFS2 was derived,
+ * was designed and implemented by Axis Communications AB.
+ *
+ * The contents of this file are subject to the Red Hat eCos Public
+ * License Version 1.1 (the "Licence"); you may not use this file
+ * except in compliance with the Licence.  You may obtain a copy of
+ * the Licence at http://www.redhat.com/
+ *
+ * Software distributed under the Licence is distributed on an "AS IS"
+ * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.
+ * See the Licence for the specific language governing rights and
+ * limitations under the Licence.
+ *
+ * The Original Code is JFFS2 - Journalling Flash File System, version 2
+ *
+ * Alternatively, the contents of this file may be used under the
+ * terms of the GNU General Public License version 2 (the "GPL"), in
+ * which case the provisions of the GPL are applicable instead of the
+ * above.  If you wish to allow the use of your version of this file
+ * only under the terms of the GPL and not to allow others to use your
+ * version of this file under the RHEPL, indicate your decision by
+ * deleting the provisions above and replace them with the notice and
+ * other provisions required by the GPL.  If you do not delete the
+ * provisions above, a recipient may use your version of this file
+ * under either the RHEPL or the GPL.
+ *
+ * $Id: jffs2.h,v 1.1 2002/02/14 09:59:34 timriker Exp $
+ *
+ */
+
+#ifndef __LINUX_JFFS2_H__
+#define __LINUX_JFFS2_H__
+
+#include "blob/types.h"
+#define JFFS2_SUPER_MAGIC 0x72b6
+
+/* Values we may expect to find in the 'magic' field */
+#define JFFS2_OLD_MAGIC_BITMASK 0x1984
+#define JFFS2_MAGIC_BITMASK 0x1985
+#define KSAMTIB_CIGAM_2SFFJ 0x5981 /* For detecting wrong-endian fs */
+#define JFFS2_EMPTY_BITMASK 0xffff
+#define JFFS2_DIRTY_BITMASK 0x0000
+
+/* We only allow a single char for length, and 0xFF is empty flash so
+   we don't want it confused with a real length. Hence max 254.
+*/
+#define JFFS2_MAX_NAME_LEN 254
+
+/* How small can we sensibly write nodes? */
+#define JFFS2_MIN_DATA_LEN 128
+
+#define JFFS2_COMPR_NONE	0x00
+#define JFFS2_COMPR_ZERO	0x01
+#define JFFS2_COMPR_RTIME	0x02
+#define JFFS2_COMPR_RUBINMIPS	0x03
+#define JFFS2_COMPR_COPY	0x04
+#define JFFS2_COMPR_DYNRUBIN	0x05
+#define JFFS2_COMPR_ZLIB	0x06
+/* Compatibility flags. */
+#define JFFS2_COMPAT_MASK 0xc000      /* What do to if an unknown nodetype is found */
+#define JFFS2_NODE_ACCURATE 0x2000
+/* INCOMPAT: Fail to mount the filesystem */
+#define JFFS2_FEATURE_INCOMPAT 0xc000
+/* ROCOMPAT: Mount read-only */
+#define JFFS2_FEATURE_ROCOMPAT 0x8000
+/* RWCOMPAT_COPY: Mount read/write, and copy the node when it's GC'd */
+#define JFFS2_FEATURE_RWCOMPAT_COPY 0x4000
+/* RWCOMPAT_DELETE: Mount read/write, and delete the node when it's GC'd */
+#define JFFS2_FEATURE_RWCOMPAT_DELETE 0x0000
+
+#define JFFS2_NODETYPE_DIRENT (JFFS2_FEATURE_INCOMPAT | JFFS2_NODE_ACCURATE | 1)
+#define JFFS2_NODETYPE_INODE (JFFS2_FEATURE_INCOMPAT | JFFS2_NODE_ACCURATE | 2)
+#define JFFS2_NODETYPE_CLEANMARKER (JFFS2_FEATURE_RWCOMPAT_DELETE | JFFS2_NODE_ACCURATE | 3)
+
+// Maybe later...
+//#define JFFS2_NODETYPE_CHECKPOINT (JFFS2_FEATURE_RWCOMPAT_DELETE | JFFS2_NODE_ACCURATE | 3)
+//#define JFFS2_NODETYPE_OPTIONS (JFFS2_FEATURE_RWCOMPAT_COPY | JFFS2_NODE_ACCURATE | 4)
+
+/* Same as the non_ECC versions, but with extra space for real 
+ * ECC instead of just the checksum. For use on NAND flash 
+ */
+//#define JFFS2_NODETYPE_DIRENT_ECC (JFFS2_FEATURE_INCOMPAT | JFFS2_NODE_ACCURATE | 5)
+//#define JFFS2_NODETYPE_INODE_ECC (JFFS2_FEATURE_INCOMPAT | JFFS2_NODE_ACCURATE | 6)
+
+#define JFFS2_INO_FLAG_PREREAD	  1	/* Do read_inode() for this one at 
+					   mount time, don't wait for it to 
+					   happen later */
+#define JFFS2_INO_FLAG_USERCOMPR  2	/* User has requested a specific 
+					   compression type */
+
+
+struct jffs2_unknown_node
+{
+	/* All start like this */
+	u16 magic;
+	u16 nodetype;
+	u32 totlen; /* So we can skip over nodes we don't grok */
+	u32 hdr_crc;
+} __attribute__((packed));
+
+struct jffs2_raw_dirent
+{
+	u16 magic;
+	u16 nodetype;	/* == JFFS_NODETYPE_DIRENT */
+	u32 totlen;
+	u32 hdr_crc;
+	u32 pino;
+	u32 version;
+	u32 ino; /* == zero for unlink */
+	u32 mctime;
+	u8 nsize;
+	u8 type;
+	u8 unused[2];
+	u32 node_crc;
+	u32 name_crc;
+	u8 name[0];
+} __attribute__((packed));
+
+/* The JFFS2 raw inode structure: Used for storage on physical media.  */
+/* The uid, gid, atime, mtime and ctime members could be longer, but 
+   are left like this for space efficiency. If and when people decide
+   they really need them extended, it's simple enough to add support for
+   a new type of raw node.
+*/
+struct jffs2_raw_inode
+{
+	u16 magic;      /* A constant magic number.  */
+	u16 nodetype;   /* == JFFS_NODETYPE_INODE */
+	u32 totlen;     /* Total length of this node (inc data, etc.) */
+	u32 hdr_crc;
+	u32 ino;        /* Inode number.  */
+	u32 version;    /* Version number.  */
+	u32 mode;       /* The file's type or mode.  */
+	u16 uid;        /* The file's owner.  */
+	u16 gid;        /* The file's group.  */
+	u32 isize;      /* Total resultant size of this inode (used for truncations)  */
+	u32 atime;      /* Last access time.  */
+	u32 mtime;      /* Last modification time.  */
+	u32 ctime;      /* Change time.  */
+	u32 offset;     /* Where to begin to write.  */
+	u32 csize;      /* (Compressed) data size */
+	u32 dsize;	  /* Size of the node's data. (after decompression) */
+	u8 compr;       /* Compression algorithm used */
+	u8 usercompr;	  /* Compression algorithm requested by the user */
+	u16 flags;	  /* See JFFS2_INO_FLAG_* */
+	u32 data_crc;   /* CRC for the (compressed) data.  */
+	u32 node_crc;   /* CRC for the raw inode (excluding data)  */
+//	u8 data[dsize];
+} __attribute__((packed));
+
+union jffs2_node_union {
+	struct jffs2_raw_inode i;
+	struct jffs2_raw_dirent d;
+	struct jffs2_unknown_node u;
+} __attribute__((packed));
+
+enum
+  {
+    DT_UNKNOWN = 0,
+# define DT_UNKNOWN     DT_UNKNOWN
+    DT_FIFO = 1,
+# define DT_FIFO        DT_FIFO
+    DT_CHR = 2,
+# define DT_CHR         DT_CHR
+    DT_DIR = 4,
+# define DT_DIR         DT_DIR
+    DT_BLK = 6,
+# define DT_BLK         DT_BLK
+    DT_REG = 8,
+# define DT_REG         DT_REG
+    DT_LNK = 10,
+# define DT_LNK         DT_LNK
+    DT_SOCK = 12,
+# define DT_SOCK        DT_SOCK
+    DT_WHT = 14
+# define DT_WHT         DT_WHT
+  };
+
+#endif /* __LINUX_JFFS2_H__ */
Index: build_tree/bootLoader/include/blob/lcd.h
diff -u build_tree/bootLoader/include/blob/lcd.h:1.1.1.1 build_tree/bootLoader/include/blob/lcd.h:1.1.1.3
--- build_tree/bootLoader/include/blob/lcd.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/lcd.h	Fri Nov  9 10:37:08 2007
@@ -5,7 +5,8 @@
  *
  * Generic lcd framework
  *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Copyright (C) 2001,2002 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
+ * Copyright (C) 2002 Urs Kaufmann <u_kaufmann@bluewin.ch>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -26,7 +27,6 @@
 #define BLOB_LCD_H
 
 #if defined(CONFIG_LCD_SUPPORT)
-
 #ifdef PT_SYSTEM3
 #	define	LCD_LCCR0	0x000AA03C
 #	define	LCD_LCCR1	0x01000270
@@ -44,6 +44,67 @@
 #	define	LCD_VIDEORAM_END	(LCD_VIDEORAM_START + LCD_VIDEORAM_SIZE)
 #	define	LCD_VIDEORAM_DMA_ADR	(LCD_PALETTE_DMA_ADR + LCD_PALETTE_SIZE + (LCD_VIDEORAM_SIZE>>1))
 
+#elif MINIPRINT
+#       define  LCD_LCCR0       0x00000038
+/* LEN = 0   not enabled
+   CMS = 0   Color Mode
+   SDS = 0   Single Panel
+   LDM = 1   Done IRQ Disable
+   BAM = 1   Base Addr update IRQ disable
+   ERM = 1   Disable Error IRQ
+   PAS = 0   Passive Mode
+   BLE = 0   Little Endian
+   DPD = 0   for monochrome only
+   VSC = 0   Vert Slant
+   PDD = 0   No DMA Delay */
+#       define  LCD_LCCR1       0x01010530
+/* PPL = 304  (320-16=304)
+   HSW = 1    H-Sync
+   ELW = 1    EndOfLine Sync
+   BLW = 1    BeginOfLine Sync */
+#       define  LCD_LCCR2       0x000000EF
+/* LPP = 239   Lines
+   VSW = 0    Xtra Clock
+   EFW = 0    Xtra Clock
+   BFW = 0    Xtra Clock */
+#       define  LCD_LCCR3       0x0000FF1E
+/* PCD = 0x1E 75Hz Refresh
+   ACB = 0
+   API = 0
+   VSP = 0
+   HSP = 0
+   PCP = 0
+   OEP = 0  */
+#       define  LCD_BPP                 16
+#       define  LCD_COLS                320
+#       define  LCD_ROWS                240
+#       define  LCD_VIDEORAM_SIZE       ((LCD_BPP*LCD_ROWS*LCD_COLS)>>3)
+#       define  LCD_PALETTE_ENTRIES     256
+#       define  LCD_PALETTE_SIZE        (LCD_PALETTE_ENTRIES * 2)
+#       define  LCD_RAM_BASE            0xc0900000
+#       define  LCD_PALETTE_DMA_ADR     (LCD_RAM_BASE + 0x0)
+#       define  LCD_VIDEORAM_START      (LCD_RAM_BASE + LCD_PALETTE_SIZE)
+#       define  LCD_VIDEORAM_END        (LCD_VIDEORAM_START + LCD_VIDEORAM_SIZE)
+#       define  LCD_VIDEORAM_DMA_ADR    (LCD_PALETTE_DMA_ADR + LCD_PALETTE_SIZE + (LCD_VIDEORAM_SIZE>>1))
+# define  LCD_REVERSE
+#elif MAINSTONE
+
+#	define	LCD_LCCR0	0x000AA03C
+#	define	LCD_LCCR1	0x01000270
+#	define	LCD_LCCR2	0x000004EF
+#	define	LCD_LCCR3	0x0000FF16
+#	define	LCD_BPP			8
+#	define	LCD_COLS		640
+#	define	LCD_ROWS		480
+#	define	LCD_VIDEORAM_SIZE	((LCD_BPP*LCD_ROWS*LCD_COLS)>>3)
+#	define	LCD_PALETTE_ENTRIES	256
+#	define	LCD_PALETTE_SIZE	(LCD_PALETTE_ENTRIES * 2)
+#	define	LCD_RAM_BASE		0xd0000000
+#	define	LCD_PALETTE_DMA_ADR	(LCD_RAM_BASE + 0x0)
+#	define	LCD_VIDEORAM_START	(LCD_RAM_BASE + LCD_PALETTE_SIZE)
+#	define	LCD_VIDEORAM_END	(LCD_VIDEORAM_START + LCD_VIDEORAM_SIZE)
+#	define	LCD_VIDEORAM_DMA_ADR	(LCD_PALETTE_DMA_ADR + LCD_PALETTE_SIZE + (LCD_VIDEORAM_SIZE>>1))
+
 #else
 #	error "Cowardly refusing to break your LCD, please supply correct LCD parameters."
 #endif
@@ -62,6 +123,9 @@
 int lcd_backlight_on( void );
 int lcd_backlight_off( void );
 
+int lcd_fill(int color);
+int lcd_set_pixel(unsigned int x, unsigned int y, unsigned int color);
+
 int lcd_palette_setup( void );
 
 int lcd_contrast( int );
Index: build_tree/bootLoader/include/blob/led.h
diff -u build_tree/bootLoader/include/blob/led.h:1.1.1.1 build_tree/bootLoader/include/blob/led.h:1.1.1.2
--- build_tree/bootLoader/include/blob/led.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/led.h	Fri Nov  9 09:44:05 2007
@@ -19,7 +19,7 @@
  *
  */
 
-#ident "$Id: led.h,v 1.3 2001/10/15 21:27:05 erikm Exp $"
+#ident "$Id: led.h,v 1.6 2003/09/04 18:03:09 russd Exp $"
 
 #ifndef BLOB_LED_H
 #define BLOB_LED_H
@@ -28,13 +28,35 @@
 
 
 void led_init(void);
-void led_on(void);
-void led_off(void);
+int led_on(void);
+int led_off(void);
 void led_toggle(void);
 void led_lock(void);
 void led_unlock(void);
 
+typedef void (*led_on_func_t)(void);
+typedef void (*led_off_func_t)(void);
+typedef void (*led_toggle_func_t)(void);
+typedef void (*led_lock_func_t)(void);
+typedef void (*led_unlock_func_t)(void);
+
+typedef struct {
+    led_on_func_t led_on;
+    led_off_func_t led_off;
+    led_toggle_func_t led_toggle;
+    led_lock_func_t led_lock;
+    led_unlock_func_t led_unlock;
+} led_driver_t;
+
+/* implemented LED drivers */
+extern led_driver_t s3c2500_gpio_led_driver;
+extern led_driver_t sa11x0_gpio_led_driver;
+extern led_driver_t mmap_led_driver;
 
+/* FIXME: This still needs to be implemented */
+/* extern led_driver_t pxa_gpio_led_driver; */
 
+/* defined in arch specific file */
+extern led_driver_t *led_driver;
 
 #endif
Index: build_tree/bootLoader/include/blob/linux.h
diff -u build_tree/bootLoader/include/blob/linux.h:1.1.1.1 build_tree/bootLoader/include/blob/linux.h:1.1.1.2
--- build_tree/bootLoader/include/blob/linux.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/linux.h	Fri Nov  9 09:44:05 2007
@@ -19,7 +19,7 @@
  *
  */
 
-#ident "$Id: linux.h,v 1.4 2001/12/27 18:27:37 erikm Exp $"
+#ident "$Id: linux.h,v 1.16 2003/09/04 18:10:41 russd Exp $"
 
 #ifndef BLOB_LINUX_H
 #define BLOB_LINUX_H
@@ -32,14 +32,24 @@
  * -- Erik
  */
 
-#if defined ASSABET
+#if defined ACCELENT_SA
+# define ARCH_NUMBER (22)
+#elif defined PXA_IDP
+# define ARCH_NUMBER (110)
+#elif defined ASSABET
 # define ARCH_NUMBER (25)
+#elif defined FRODO
+# define ARCH_NUMBER (158)
 #elif defined BADGE4
-# define ARCH_NUMBER (138)
+# define ARCH_NUMBER (148)
 #elif defined BRUTUS
 # define ARCH_NUMBER (16)
+#elif defined CEP
+# define ARCH_NUMBER (151)
 #elif defined CLART
 # define ARCH_NUMBER (68)
+#elif defined HKIT 
+# define ARCH_NUMBER (254)
 #elif defined H3600
 # define ARCH_NUMBER (22)
 #elif defined IDR
@@ -48,20 +58,31 @@
 # define ARCH_NUMBER (48)
 #elif defined LART
 # define ARCH_NUMBER (27)
+#elif defined LUBBOCK
+# define ARCH_NUMBER (89)
+#elif defined MINIPRINT
+# define ARCH_NUMBER (173)
 #elif defined NESA
 # define ARCH_NUMBER (75)
 #elif defined PLEB
 # define ARCH_NUMBER (20)
+#elif defined RAMSES
+# define ARCH_NUMBER (235)
 #elif defined SHANNON
 # define ARCH_NUMBER (97)
-#elif defined PT_SYSTEM3
+#elif defined SMDK2500
+# define ARCH_NUMBER (91)
+#elif defined PT_SYSTEM3 || defined PT_DAFIT
 # define ARCH_NUMBER (112)
+#elif defined TRIZEPS
+# define ARCH_NUMBER (74)
+#elif defined CSIR_IMS
+# define ARCH_NUMBER (358)
+#elif defined MAINSTONE
+# define ARCH_NUMBER (406)
 #else
 #warning "FIXME: Calling the kernel with a generic SA1100 architecture code. YMMV!"
 #define ARCH_NUMBER (18)
 #endif
 
-
-
-
 #endif
Index: build_tree/bootLoader/include/blob/load_kernel.h
diff -u /dev/null build_tree/bootLoader/include/blob/load_kernel.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/load_kernel.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,78 @@
+/*-------------------------------------------------------------------------
+ * Filename:      load_kernel.h
+ * Version:       $Id: load_kernel.h,v 1.8 2003/01/28 03:42:31 choover Exp $
+ * Copyright:     Copyright (C) 2001, Russ Dill
+ * Author:        Russ Dill <Russ.Dill@asu.edu>
+ * Description:   header for load kernel modules
+ *-----------------------------------------------------------------------*/
+/*
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: load_kernel.h,v 1.8 2003/01/28 03:42:31 choover Exp $"
+
+#ifndef BLOB_LOAD_KERNEL_H
+#define BLOB_LOAD_KERNEL_H
+
+#include <blob/main.h>
+#include <blob/types.h>
+
+/* this struct is very similar to mtd_info */
+struct part_info {
+	u32 size;	 // Total size of the Partition
+
+	/* "Major" erase size for the device. Nave users may take this
+	 * to be the only erase size available, or may use the more detailed
+	 * information below if they desire
+	 */
+	u32 erasesize;
+	
+	/* Where in memory does this partition start? */
+	char *offset;
+};
+
+struct kernel_loader {
+	
+	/* Return true if there is a kernel contained at src */
+	int (* check_magic)(struct part_info *part);
+	
+	/* load the kernel from filename in partition part to dst,
+	 * return the number of bytes copied if successful, zero if not
+	 * some methods will ignore filename */
+	u32 (* load_kernel)(u32 *dst, struct part_info *part, char *filename);
+
+	/* A brief description of the module (ie, "cramfs") */
+	char *name;
+};
+
+extern struct kernel_loader *known_loaders[];
+
+#ifndef USER_SPACE_TEST
+/* this is a large area of ram for the loaders to use as a scratchpad */
+extern const void *fodder_ram_base;
+#define UDEBUG(str, args...) 
+#else
+extern const void *fodder_ram_base;
+#define UDEBUG(str, args...) printf(str, ## args)
+#endif
+
+/* the modules call this every 0x40000 bytes to update a progress bar */
+inline void ldr_update_progress(void);
+
+int load_kernel(blob_status_t *blob_status);
+
+#endif
Index: build_tree/bootLoader/include/blob/main.h
diff -u build_tree/bootLoader/include/blob/main.h:1.1.1.1 build_tree/bootLoader/include/blob/main.h:1.1.1.2
--- build_tree/bootLoader/include/blob/main.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/main.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      main.h
- * Version:       $Id: main.h,v 1.6 2002/01/06 18:59:40 erikm Exp $
+ * Version:       $Id: main.h,v 1.7 2002/04/27 08:11:58 timriker Exp $
  * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
  * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
  * Description:   Header file for main.c
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: main.h,v 1.6 2002/01/06 18:59:40 erikm Exp $"
+#ident "$Id: main.h,v 1.7 2002/04/27 08:11:58 timriker Exp $"
 
 #ifndef BLOB_MAIN_H
 #define BLOB_MAIN_H
@@ -66,7 +66,7 @@
 	serial_baud_t terminalSpeed;
 	
 	int load_ramdisk;
-	int boot_delay;
+	int boot_delay; /* -1 == no-autoboot */
 	
 	char cmdline[COMMAND_LINE_SIZE];
 	
Index: build_tree/bootLoader/include/blob/memsetup.h
diff -u build_tree/bootLoader/include/blob/memsetup.h:1.1.1.1 build_tree/bootLoader/include/blob/memsetup.h:1.1.1.2
--- build_tree/bootLoader/include/blob/memsetup.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/memsetup.h	Fri Nov  9 09:44:05 2007
@@ -1,10 +1,10 @@
 /*
  * memsetup.h: include file for memory setup
  *
- * $Id: memsetup.h,v 1.4 2001/12/27 18:27:37 erikm Exp $
+ * $Id: memsetup.h,v 1.11 2002/10/02 11:20:27 seletz Exp $
  *
  * Copyright (C) 2001 Stefan Eletzhofer
- *						<stefan.eletzhofer@www.eletztrick.net>
+ *						<stefan.eletzhofer@www.eletztrick.de>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -27,7 +27,7 @@
  *     Developer's Manual", April 1999
  */
 
-#ident "$Id: memsetup.h,v 1.4 2001/12/27 18:27:37 erikm Exp $"
+#ident "$Id: memsetup.h,v 1.11 2002/10/02 11:20:27 seletz Exp $"
 
 #ifndef BLOB_MEMSETUP_H
 #define BLOB_MEMSETUP_H
@@ -36,19 +36,20 @@
  *  Memory Config Register Indices
  *  based on 0xA0000000
  */
-#define	MDCNFG	0x0
-#define MDCAS00	0x04
-#define MDCAS01	0x08
-#define MDCAS02	0x0c
-#define MCS0	0x10
-#define MCS1	0x14
-#define	MECR	0x18
-#define MDREFR	0x1C
-#define MDCAS20	0x20
-#define MDCAS21	0x24
-#define MDCAS22	0x28
-#define MCS2	0x2C
-#define	SMCNFG	0x30
+#define MEM_CONF_BASE	0xa0000000
+#define	_MDCNFG	0x0
+#define _MDCAS00	0x04
+#define _MDCAS01	0x08
+#define _MDCAS02	0x0c
+#define _MCS0	0x10
+#define _MCS1	0x14
+#define	_MECR	0x18
+#define _MDREFR	0x1C
+#define _MDCAS20	0x20
+#define _MDCAS21	0x24
+#define _MDCAS22	0x28
+#define _MCS2	0x2C
+#define	_SMCNFG	0x30
 
 /**********************************************************************
  *  MDCNFG masks
@@ -56,13 +57,25 @@
 
 #define MDCNFG_BANK0_ENABLE (1 << 0)
 #define MDCNFG_BANK1_ENABLE (1 << 1)
+#define MDCNFG_DTIM0_EDO  	(0 << 2)
 #define MDCNFG_DTIM0_SDRAM  (1 << 2)
 #define MDCNFG_DWID0_32B    (0 << 3)
 #define MDCNFG_DWID0_16B    (1 << 3)
 #define MDCNFG_DRAC0(n_)    (((n_) & 7) << 4)
+#define MDCNFG_CDB20(n_)	(((n_) & 1) << 7)
 #define MDCNFG_TRP0(n_)     (((n_) & 0xF) << 8)
 #define MDCNFG_TDL0(n_)     (((n_) & 3) << 12)
 #define MDCNFG_TWR0(n_)     (((n_) & 3) << 14)
+#define MDCNFG_BANK2_ENABLE (1 << 16)
+#define MDCNFG_BANK3_ENABLE (1 << 17)
+#define MDCNFG_DTIM2_SDRAM  (1 << 18)
+#define MDCNFG_DWID2_32B    (0 << 19)
+#define MDCNFG_DWID2_16B    (1 << 19)
+#define MDCNFG_DRAC2(n_)    (((n_) & 7) << 20)
+#define MDCNFG_CDB22(n_)	(((n_) & 1) << 23)
+#define MDCNFG_TRP2(n_)     (((n_) & 0xF) << 24)
+#define MDCNFG_TDL2(n_)     (((n_) & 3) << 28)
+#define MDCNFG_TWR2(n_)     (((n_) & 3) << 30)
 
 /**********************************************************************
  *  MDREFR masks
@@ -77,8 +90,8 @@
 #define MDREFR_K1DB2		(1 << 22)
 #define MDREFR_K2RUN		(1 << 25)
 #define MDREFR_K2DB2		(1 << 26)
-#define MDREFR_EAPD		(1 << 28)
-#define MDREFR_KAPD		(1 << 29)
+#define MDREFR_EAPD			(1 << 28)
+#define MDREFR_KAPD			(1 << 29)
 #define MDREFR_SLFRSH		(1 << 31)
 
 /**********************************************************************
@@ -101,4 +114,39 @@
 #define MSC_RDN(n_)             (((n_)&0x1f)<<8)
 #define MSC_RRR(n_)             (((n_)&0x7)<<13)
 
+/**********************************************************************
+ *  PCMCIA memory config register
+ */
+/* PCMCIA */
+#define MECR_BSIO0(n_)			(((n_)&0x1f)<<0)
+#define MECR_BSA0(n_)			(((n_)&0x1f)<<5)
+#define MECR_BSM0(n_)			(((n_)&0x1f)<<10)
+#define MECR_FAST0				(1<<15)
+/* CF */
+#define MECR_BSIO1(n_)			(((n_)&0x1f)<<16)
+#define MECR_BSA1(n_)			(((n_)&0x1f)<<21)
+#define MECR_BSM1(n_)			(((n_)&0x1f)<<26)
+#define MECR_FAST1				(1<<31)
+
+/**********************************************************************
+ *  Power Manager (PM) registers
+ */
+#define PM_BASE		0x90020000  /* PM base */
+#define _PMCR		0x00  /* PM Control Reg. */
+#define _PSSR		0x04  /* PM Sleep Status Reg. */
+#define _PSPR		0x08  /* PM Scratch-Pad Reg. */
+#define _PWER		0x0C  /* PM Wake-up Enable Reg. */
+#define _PCFR		0x10  /* PM general ConFiguration Reg. */
+#define _PPCR		0x14  /* PM PLL Configuration Reg. */
+#define _PGSR		0x18  /* PM GPIO Sleep state Reg. */
+#define _POSR		0x1C  /* PM Oscillator Status Reg. */
+
+#define PMCR_SF 	0x00000001	/* Sleep Force (set only)          */
+
+#define PSSR_SS 	0x00000001	/* Software Sleep                  */
+#define PSSR_BFS	0x00000002	/* Battery Fault Status            */
+#define PSSR_VFS	0x00000004	/* Vdd Fault Status (VDD_FAULT)    */
+#define PSSR_DH 	0x00000008	/* DRAM control Hold               */
+#define PSSR_PH 	0x00000010	/* Peripheral control Hold         */
+
 #endif
Index: build_tree/bootLoader/include/blob/mini_inflate.h
diff -u /dev/null build_tree/bootLoader/include/blob/mini_inflate.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/mini_inflate.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,35 @@
+/*-------------------------------------------------------------------------
+ * Filename:      mini_inflate.h
+ * Version:       $Id: mini_inflate.h,v 1.2 2002/02/16 00:43:59 erikm Exp $
+ * Copyright:     Copyright (C) 2001, Russ Dill
+ * Author:        Russ Dill <Russ.Dill@asu.edu>
+ * Description:   Mini deflate implementation
+ *-----------------------------------------------------------------------*/
+/*
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: mini_inflate.h,v 1.2 2002/02/16 00:43:59 erikm Exp $"
+
+#ifndef BLOB_MINI_INFLATE_H
+#define BLOB_MINI_INFLATE_H
+ 
+
+long decompress_block(unsigned char *dest, unsigned char *source);
+
+
+#endif
Index: build_tree/bootLoader/include/blob/param_block.h
diff -u build_tree/bootLoader/include/blob/param_block.h:1.1.1.1 build_tree/bootLoader/include/blob/param_block.h:1.1.1.2
--- build_tree/bootLoader/include/blob/param_block.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/param_block.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      param_block.h
- * Version:       $Id: param_block.h,v 1.2 2001/10/07 15:27:35 erikm Exp $
+ * Version:       $Id: param_block.h,v 1.4 2002/02/22 07:30:05 russd Exp $
  * Copyright:     Copyright (C) 2001, Russ Dill
  * Author:        Russ Dill <Russ.Dill@asu.edu>
  * Description:   Paramater block tags for blob
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: param_block.h,v 1.2 2001/10/07 15:27:35 erikm Exp $"
+#ident "$Id: param_block.h,v 1.4 2002/02/22 07:30:05 russd Exp $"
 
 
 #ifndef BLOB_PARAM_BLOCK_H
@@ -37,7 +37,8 @@
 
 #include <blob/types.h>
 
-#define PTAG_MAGIC	0x32d27000 /* base 26 blob */
+#define PTAG_VER	0x1
+#define PTAG_MAGIC	(0x32d27000 + (PTAG_VER << 3)) /* base 26 blob + version */
 
 /* The list ends with an PTAG_NONE node. */
 #define PTAG_NONE	0x00000000
@@ -46,14 +47,8 @@
 	u32 size;
 	u32 ptag;
 	
-	/* the tag is proccessed if current_conf & conf_mask == conf */
-	u32 conf_mask;
+	/* which config this tag belongs to */
 	u32 conf;
-	
-	/* if the tag fails, then current_conf |= fail_set_mask, and 
-	 * current_config &= ~fail_clear_mask */ 
-	u32 fail_set_mask;
-	u32 fail_clear_mask;
 };
         
 /* The list must start with an PTAG_CORE node */
@@ -78,7 +73,7 @@
 #define PTAG_BOOTDELAY	(PTAG_MAGIC | 3)
     
 struct ptag_bootdelay {
-	u32 	delay;		/* boot delay in seconds, 0 for none */
+	u32 	delay;		/* boot delay in seconds, 0 to drop directly to blob */
 };
 
 
@@ -115,15 +110,6 @@
 };
 
 
-/* check a GPIO */
-#define PTAG_GPIO	(PTAG_MAGIC | 8)
-
-struct ptag_gpio {
-	u32 	mask;
-	u32	level;
-};
-
-
 struct ptag {
 	struct ptag_header hdr;
 	union {
@@ -134,7 +120,6 @@
 		struct ptag_baud 	baud;
 		struct ptag_splash	splash;
 		struct ptag_hwaddr	hwaddr;
-		struct ptag_gpio	gpio;
 	} u;
 };
 
Index: build_tree/bootLoader/include/blob/partition.h
diff -u build_tree/bootLoader/include/blob/partition.h:1.1.1.1 build_tree/bootLoader/include/blob/partition.h:1.1.1.2
--- build_tree/bootLoader/include/blob/partition.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/partition.h	Fri Nov  9 09:44:05 2007
@@ -1,9 +1,9 @@
 /*
  * partition.h: flash paritioning
  *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001 2002  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: partition.h,v 1.2 2001/12/26 23:38:36 erikm Exp $
+ * $Id: partition.h,v 1.7 2003/01/28 03:43:06 choover Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: partition.h,v 1.2 2001/12/26 23:38:36 erikm Exp $"
+#ident "$Id: partition.h,v 1.7 2003/01/28 03:43:06 choover Exp $"
 
 #ifndef BLOB_PARTITION_H
 #define BLOB_PARTITION_H
@@ -29,31 +29,97 @@
 
 #include <blob/types.h>
 
-#define PART_PARTITION_NAMELEN	(32)
+/* A partition table can contain three types of entries:
+ * - The last entry
+ * - A valid entry
+ * - An invalid entry
+ *
+ * A last entry can be changed into a valid entry by changing the
+ * second last bit (with mask 0x00000002) from 1 to 0, or into an
+ * invalid entry by changing the last two bits (with mask 0x00000003)
+ * from 1 to 0. By doing it like this we can avoid erasing a flash
+ * block.
+ *
+ * Flash chips wear from erase operations (that's why flash lifetime
+ * is specified in erase cycles), so we try to limit the number of
+ * erase operations. Luckily the flash helps us a little bit with
+ * this, because it only allows you to change a '1' bit into a '0'
+ * during a write operation. This means that 0xffff can be changed
+ * into 0x1010, and 0x1010 into 0x0000, but 0x0000 can't be changed
+ * into anything else anymore because there are no '1' bits left.
+ *
+ * The magic values have been carefully choosen to allow changing a
+ * partition entry without having to erase the flash. For a "last"
+ * entry, it is best to keep all other fields except the magic
+ * unitialised: chances are high that the other fields are still at
+ * 0xffffffff so we can reuse them when we change the partition type.
+ */
+
+#define BLOB_PART_LAST_MAGIC	(0x42504533) /* BPE3, Blob Partition Entry 3 */
+#define BLOB_PART_VALID_MAGIC	(0x42504531) /* BPE1, Blob Partition Entry 1 */
+#define BLOB_PART_INVALID_MAGIC	(0x42504530) /* BPE0, Blob Partition Entry 0 */
+#define BLOB_PART_NAMELEN	(32)
+
+#define BLOB_PART_OFS_APPEND	((u32) -1)   /* append to previous  */
+#define BLOB_PART_SIZ_FULL	((u32) -1)   /* use remaining flash */
 
 typedef struct {
-	u32 offset;		/* offset wrt start of flash */
-	u32 size;		/* partition size */
+	/* generic (i.e.: blob independent) data */
+	u32 magic;		/* magic value */
+	u32 next;		/* offset (in bytes) to next partition entry */
+	u32 offset;		/* offset (in bytes) wrt start of flash */
+	u32 size;		/* partition size (in bytes) */
+	char name[BLOB_PART_NAMELEN];
+
+	/* blob specific items, can be changed for other bootloaders */
+	u32 flags;		/* blob specific flags */
 	u32 mem_base;		/* load address in RAM */
 	u32 entry_point;	/* entry point in RAM */
-	u32 flags;
-	char name[PART_PARTITION_NAMELEN];
-} partition_t;
+} blob_partition_t;
+
+#define BLOB_PART_FLAG_PTABLE	(1<<0) /* contains a partition table */
+#define BLOB_PART_FLAG_LOAD	(1<<1) /* load partition into RAM */
+#define BLOB_PART_FLAG_EXEC	(1<<2) /* partition/target is executable */
+#define BLOB_PART_FLAG_JFFS2	(1<<3) /* contains a JFFS2 */
+#define BLOB_PART_FLAG_CRAMFS	(1<<4) /* contains a cramfs */
 
-#define PART_VALID	(1<<0)
-#define PART_LOAD	(1<<1)
-#define PART_EXPAND	(1<<2)
 
+/* A partition table is marked with a special entry that marks the
+ * start of the table.
+ *
+ * There are two kinds of blob partition tables: the first one is the
+ * regular partition table that can be changed by the bootloader. The
+ * second one is a default partition table that can be put into the
+ * bootloader binary so it can avoid to waste a flash block for the
+ * partition table. The partition table parser first tries to find a
+ * regular partition table and will fall back on the default table if
+ * it can't find one.
+ *
+ * A partition table entry point has to specify the total size of the
+ * flash (in the size member), and the offset has to specify the
+ * absolute base address.
+ */
 
-#define PART_MAGIC (0x50727420)		/* "Prt " */
-#define PART_MAX_PARTITIONS (16)	/* 16 partitions ought to be enough */
+#define BLOB_FLASH_PART_TABLE_MAGIC	(0x42465054) /* BFPT, Blob Flash
+						      * Partition Table */
+#define BLOB_DEFAULT_PART_TABLE_MAGIC	(0x42445054) /* BDPT, Blob Default
+						      * Partition Table */
+#define BLOB_COPY_PART_TABLE_MAGIC	(0x42435054) /* BCPT, Blob Copy
+						      * Partition Table */
 
-typedef struct {
-	int magic;
-	int numpartitions;
-	partition_t partition[PART_MAX_PARTITIONS];
-} partition_table_t;
 
 
 
+/* flash functions */
+
+extern const blob_partition_t *default_partition_table;
+extern blob_partition_t *flash_partition_table;
+
+const blob_partition_t *pt_first(void);
+const blob_partition_t *pt_next(const blob_partition_t *p);
+const blob_partition_t *pt_find_by_name(const char *s);
+const blob_partition_t *pt_find_by_address(u32 addr);
+
+void *pt_flash_start(const blob_partition_t *p);
+
 #endif
Index: build_tree/bootLoader/include/blob/pcmcia.h
diff -u /dev/null build_tree/bootLoader/include/blob/pcmcia.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/pcmcia.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,145 @@
+/*
+ * pcmcia.h
+ *
+ * Copyright (C) 2001, Brad Parker (brad@heeltoe.com)
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef BLOB_PCMCIA_H
+#define BLOB_PCMCIA_H 1
+
+/* defines for PCMCIA configuration information */
+#define PCMCIA_MAX_TUPEL_SZ		512
+#define PCMCIA_MAX_FEATURES		4
+
+#define PCMCIA_MAX_IDENT_CHARS	64
+#define PCMCIA_MAX_IDENT_FIELDS	4
+#define PCMCIA_MAX_FEATURES		4
+
+#define CISTPL_VERS_1           0x15
+#define CISTPL_FUNCID           0x21
+#define CISTPL_FUNCE            0x22
+#define CISTPL_CONFIG           0x1a
+
+/*
+ * CIS Function ID codes
+ */
+#define CISTPL_FUNCID_MULTI     0x00
+#define CISTPL_FUNCID_MEMORY    0x01
+#define CISTPL_FUNCID_SERIAL    0x02
+#define CISTPL_FUNCID_PARALLEL  0x03
+#define CISTPL_FUNCID_FIXED     0x04
+#define CISTPL_FUNCID_VIDEO     0x05
+#define CISTPL_FUNCID_NETWORK   0x06
+#define CISTPL_FUNCID_AIMS      0x07
+#define CISTPL_FUNCID_SCSI      0x08
+
+/*
+ * Fixed Disk FUNCE codes
+ */
+#define CISTPL_IDE_INTERFACE    0x01
+
+#define CISTPL_FUNCE_IDE_IFACE  0x01
+#define CISTPL_FUNCE_IDE_MASTER 0x02
+#define CISTPL_FUNCE_IDE_SLAVE  0x03
+
+/* First feature byte */
+#define CISTPL_IDE_SILICON      0x04
+#define CISTPL_IDE_UNIQUE       0x08
+#define CISTPL_IDE_DUAL         0x10
+
+/* Second feature byte */
+#define CISTPL_IDE_HAS_SLEEP    0x01
+#define CISTPL_IDE_HAS_STANDBY  0x02
+#define CISTPL_IDE_HAS_IDLE     0x04
+#define CISTPL_IDE_LOW_POWER    0x08
+#define CISTPL_IDE_REG_INHIBIT  0x10
+#define CISTPL_IDE_HAS_INDEX    0x20
+#define CISTPL_IDE_IOIS16       0x40
+
+/**********************************************************************
+ * Arch dependent defines (should be pretty much the same everywhere,
+ * tough)
+ */
+#define PCMCIA_MAX_SLOTS		2
+
+#if defined(BADGE4) || defined(IDR) || defined(PT_SYSTEM3) || defined(SHANNON) || \
+    defined(PT_DAFIT)
+#	define PCMCIA_S0_BASE		0x20000000
+#	define PCMCIA_S0_IO_BASE	0x20000000
+#	define PCMCIA_S0_ATTR_BASE	0x28000000
+#	define PCMCIA_S0_MEM_BASE	0x2C000000
+#	define PCMCIA_S1_BASE		0x30000000
+#	define PCMCIA_S1_IO_BASE	0x30000000
+#	define PCMCIA_S1_ATTR_BASE	0x38000000
+#	define PCMCIA_S1_MEM_BASE	0x3C000000
+#else
+#	error "Please add PCMCIA HW defines for your board here"
+#endif
+
+/* some slot stati */
+#define PCMCIA_SS_DETECT		(1<<0)
+#define PCMCIA_SS_ENABLED		(1<<1)
+#define PCMCIA_SS_POWER			(1<<2)
+#define PCMCIA_SS_IDENT			(1<<3)
+
+/**********************************************************************
+ * the following symbols can be overwritten by arch dependent code
+ * (weak symbols)
+ */
+/* do whatever is needed to get pcmcia initialized */
+int pcmcia_init();
+
+/* set pcmcia slot voltage levels */
+int pcmcia_voltage_set( int slot, int vcc, int vpp );
+
+/* detect slot */
+int pcmcia_slot_detect( int slot );
+
+/* enable slot */
+int pcmcia_slot_enable( int slot );
+
+/* disable slot */
+int pcmcia_slot_disable( int slot );
+
+/* reset pcmcia slot */
+int pcmcia_slot_reset(int slot);
+
+/* dump slot stati */
+int pcmcia_dump_stati( void );
+
+/**********************************************************************
+ * following symbols cannot be overwritten
+ */
+/* set debug verbosity */
+void pcmcia_dbg_set( int level );
+
+/* identify pcmcia card */
+int pcmcia_identify( volatile unsigned char *p );
+
+/* parse cis tuples of card in slot <slot> */
+int pcmcia_cis_parse( int slot );
+
+/* get base adress and attribute space address of slot <slot> */
+int pcmcia_slot_address_get( int slot, u32 *base, u32 *attr );
+
+/* get config register */
+int pcmcia_slot_cfg_reg_get( int slot, u16 *cfg_base );
+
+/* read/write attribute space */
+int pcmcia_slot_attr_read( int slot, u16 offset, u8 *value );
+int pcmcia_slot_attr_write( int slot, u16 offset, u8 value );
+#endif
Index: build_tree/bootLoader/include/blob/pxa-lcd.h
diff -u /dev/null build_tree/bootLoader/include/blob/pxa-lcd.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/pxa-lcd.h	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,69 @@
+/**********************************************************************
+ * pxa-lcd.h
+ *
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef BLOB_PXA_LCD_H
+#define BLOB_PXA_LCD_H
+
+#if defined(CONFIG_LCD_SUPPORT)
+#ifdef MAINSTONE
+
+#	define	LCD_LCCR0	0x000AA03C
+#	define	LCD_LCCR1	0x01000270
+#	define	LCD_LCCR2	0x000004EF
+#	define	LCD_LCCR3	0x0000FF16
+#	define	LCD_BPP			8
+#	define	LCD_COLS		640
+#	define	LCD_ROWS		480
+#	define	LCD_VIDEORAM_SIZE	((LCD_BPP*LCD_ROWS*LCD_COLS)>>3)
+#	define	LCD_PALETTE_ENTRIES	256
+#	define	LCD_PALETTE_SIZE	(LCD_PALETTE_ENTRIES * 2)
+#	define	LCD_RAM_BASE		0xd0000000
+#	define	LCD_PALETTE_DMA_ADR	(LCD_RAM_BASE + 0x0)
+#	define	LCD_VIDEORAM_START	(LCD_RAM_BASE + LCD_PALETTE_SIZE)
+#	define	LCD_VIDEORAM_END	(LCD_VIDEORAM_START + LCD_VIDEORAM_SIZE)
+#	define	LCD_VIDEORAM_DMA_ADR	(LCD_PALETTE_DMA_ADR + LCD_PALETTE_SIZE + (LCD_VIDEORAM_SIZE>>1))
+
+#else
+#	error "Cowardly refusing to break your LCD, please supply correct LCD parameters."
+#endif
+
+#endif
+
+int lcd_init(void);
+
+int lcd_power_up( void );
+int lcd_power_down( void );
+
+int lcd_gpio_setup( void );
+
+int lcd_controller_setup( void );
+int lcd_controller_enable( void );
+int lcd_controller_disable( void );
+
+int lcd_backlight_on( void );
+int lcd_backlight_off( void );
+
+int lcd_fill(int color);
+int lcd_set_pixel(unsigned int x, unsigned int y, unsigned int color);
+
+int lcd_palette_setup( void );
+
+int lcd_contrast( int );
+int lcd_brightness( int );
+
+#endif//BLOB_PXA_LCD_H
Index: build_tree/bootLoader/include/blob/reboot.h
diff -u build_tree/bootLoader/include/blob/reboot.h:1.1.1.1 build_tree/bootLoader/include/blob/reboot.h:1.1.1.2
--- build_tree/bootLoader/include/blob/reboot.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/reboot.h	Fri Nov  9 09:44:05 2007
@@ -1,9 +1,9 @@
 /*
- * reboot.h: header file for lib/reboot.h
+ * reboot.h: Reboot function for blob
  *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: reboot.h,v 1.1 2001/10/07 22:36:11 erikm Exp $
+ * $Id: reboot.h,v 1.4 2003/09/04 18:03:09 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,18 +21,33 @@
  *
  */
 
-#ident "$Id: reboot.h,v 1.1 2001/10/07 22:36:11 erikm Exp $"
+#ident "$Id: reboot.h,v 1.4 2003/09/04 18:03:09 russd Exp $"
 
 #ifndef BLOB_REBOOT_H
 #define BLOB_REBOOT_H
 
 
+#include <blob/types.h>
 
 
-extern char reboothelp[];
-int reboot(int argc, char *argv[]);
+typedef void (*reboot_func_t)(void);
 
 
+typedef struct {
+	reboot_func_t reboot;
+} reboot_driver_t;
 
 
+/* implemented reboot drivers */
+extern reboot_driver_t s3c2500_reboot_driver;
+extern reboot_driver_t sa11x0_reboot_driver;
+extern reboot_driver_t pxa_reboot_driver;
+
+/* should be filled out by the architecture dependent files */
+extern reboot_driver_t *reboot_driver;
+
+
+/* exported functions */
+void reboot_system(void);
+
 #endif
Index: build_tree/bootLoader/include/blob/sa1100.h
diff -u build_tree/bootLoader/include/blob/sa1100.h:1.1.1.1 build_tree/bootLoader/include/blob/sa1100.h:removed
--- build_tree/bootLoader/include/blob/sa1100.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/sa1100.h	Tue Jan  8 14:21:46 2008
@@ -1,34 +0,0 @@
-/*
- * sa1100.h: wrapper file to include asm/arch-sa1100/SA-1100.h
- *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-#ident "$Id: sa1100.h,v 1.2 2001/11/07 12:25:03 seletz Exp $"
-
-#ifndef BLOB_SA1100_H
-#define BLOB_SA1100_H
-
-#define io_p2v(x) (x)
-#define __REG(x)      (*((volatile u32 *)io_p2v(x)))
-
-/* Tell SA-1100.h to shut up; we're including it anyway. Nyah nyah ;-) */
-#define __ASM_ARCH_HARDWARE_H
-#include <asm-arm/arch-sa1100/SA-1100.h>
-
-#endif
Index: build_tree/bootLoader/include/blob/sa1111.h
diff -u build_tree/bootLoader/include/blob/sa1111.h:1.1.1.1 build_tree/bootLoader/include/blob/sa1111.h:removed
--- build_tree/bootLoader/include/blob/sa1111.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/sa1111.h	Tue Jan  8 14:21:46 2008
@@ -1,45 +0,0 @@
-/*
- * sa1111.h: wrapper file to include asm/arch-sa1100/SA-1111.h
- *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
- *
- * $Id: sa1111.h,v 1.4 2002/01/07 17:54:14 seletz Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-#ident "$Id: sa1111.h,v 1.4 2002/01/07 17:54:14 seletz Exp $"
-
-#ifndef BLOB_SA1111_H
-#define BLOB_SA1111_H
-
-#include <blob/arch.h>
-
-#ifndef SA1111_BASE
-# error "Define SA1111_BASE address in architecture specific include file"
-#endif
-
-#define SA1111_p2v(x) (x)
-#define SA1101_p2v(PhAdd)  (PhAdd)
-#define io_p2v(x) (x)
-#define __REG(x)      (*((volatile u32 *)io_p2v(x)))
-#define __REGP(x)      (*((volatile u32 *)io_p2v(x)))
-
-/* Tell SA-1111.h to shut up; we're including it anyway. Nyah nyah ;-) */
-#define __ASM_ARCH_HARDWARE_H
-#include <asm-arm/arch-sa1100/SA-1111.h>
-
-#endif
Index: build_tree/bootLoader/include/blob/serial.h
diff -u build_tree/bootLoader/include/blob/serial.h:1.1.1.1 build_tree/bootLoader/include/blob/serial.h:1.1.1.2
--- build_tree/bootLoader/include/blob/serial.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/serial.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      serial.h
- * Version:       $Id: serial.h,v 1.5 2002/01/05 20:14:34 erikm Exp $
+ * Version:       $Id: serial.h,v 1.9 2003/09/04 17:42:56 russd Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   Header file for serial.c
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: serial.h,v 1.5 2002/01/05 20:14:34 erikm Exp $"
+#ident "$Id: serial.h,v 1.9 2003/09/04 17:42:56 russd Exp $"
 
 #ifndef BLOB_SERIAL_H
 #define BLOB_SERIAL_H
@@ -47,7 +47,8 @@
 	baud_38400,
 	baud_57600,
 	baud_115200,
-	baud_230400
+	baud_230400,
+	baud_COUNT
 } serial_baud_t;
 	
 
@@ -73,12 +74,15 @@
 
 
 /* implemented serial drivers */
+extern serial_driver_t s3c2500_serial_driver;
 extern serial_driver_t sa11x0_serial_driver;
-
+extern serial_driver_t pxa_serial_driver;
 
 /* should be filled out by the architecture dependent files */
 extern serial_driver_t *serial_driver;
 
+/* Table of baudrates */
+extern const int baud_rates[];
 
 /* exported functions */
 int serial_init(serial_baud_t baudrate);
@@ -94,6 +98,7 @@
 void SerialOutputHex(const u32 h);
 void SerialOutputDec(const u32 d);
 void SerialOutputBlock(const char *buf, int bufsize);
+void SerialOutputChar (const char c);
 
 int  SerialInputString(char *s, const int len, const int timeout);
 int  SerialInputBlock(char *buf, int bufsize, const int timeout);
Index: build_tree/bootLoader/include/blob/serial_usb.h
diff -u /dev/null build_tree/bootLoader/include/blob/serial_usb.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/serial_usb.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,53 @@
+/*
+ * serial_usb.h: USB Serial utilities for blob 
+ *
+ * Copyright (c) 2004, Intel Corporation (alek.du@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: serial_usb.h,v 1.3 2004/09/17 01:15:30 bvd Exp $"
+
+#ifndef BLOB_USB_SERIAL_H
+#define BLOB_USB_SERIAL_H
+
+
+#include <blob/types.h>
+
+typedef int (*usb_serial_init_func_t)(void);
+typedef int (*usb_serial_read_func_t)(char*,int);
+typedef int (*usb_serial_write_func_t)(const char*,int);
+typedef int (*usb_serial_poll_func_t)(void);
+
+typedef struct {
+	usb_serial_init_func_t init;
+	usb_serial_read_func_t read;
+	usb_serial_write_func_t write;
+} usb_serial_driver_t;
+
+
+/* implemented serial drivers */
+extern usb_serial_driver_t bvd_usb_serial_driver;
+
+/* should be filled out by the architecture dependent files */
+extern usb_serial_driver_t *usb_serial_driver;
+
+/* exported functions */
+int usb_serial_init(void);
+int usb_serial_read(char *,int);
+int usb_serial_write(const char*,int);
+
+#endif
Index: build_tree/bootLoader/include/blob/spd.h
diff -u /dev/null build_tree/bootLoader/include/blob/spd.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/spd.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,85 @@
+/*
+ * spd.h: defines for PC SDRAM serial presence detect
+ *
+ * Copyright (C) 2001  Hewlett-Packard Company
+ * Written by Christopher Hoover <ch@hpl.hp.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+/*
+ * PC SDRAM Serial Presence Detect (SPD) Specification, Revision 1.2B
+ *
+ * http://developer.intel.com/technology/memory/pc133sdram/spec/Spdsd12b.pdf
+ */
+
+#ifndef _SPD_H_
+#define _SPD_H_
+
+#define SPD_I2C_ADDR(a) (0x50 | (a))
+
+#define SPD_SPD_MANUF_BYTES		0
+#define SPD_SPD_TOTAL_BYTES		1
+#define SPD_MEMORY_TYPE			2
+#  define SPD_MEMORY_TYPE_EDO 2
+#  define SPD_MEMORY_TYPE_SDRAM 4
+#define	SPD_ROW_BITS			3
+#define SPD_COL_BITS			4
+#define SPD_MODULE_ROWS			5
+#define SPD_DATA_WIDTH			6
+#define SPD_DATA_WIDTH_L		6
+#define SPD_DATA_WIDTH_H		7
+#define SPD_VOLTAGE_INTERFACE		8
+#define SPD_CYCLE_TIME			9
+#define SPD_ACCESS_TIME			10
+#define SPD_MODULE_TYPE			11
+#define SPD_REFRESH_RATE_TYPE		12
+#define SPD_PRIMARY_SDRAM_WIDTH		13
+#define SPD_MIN_CLOCK_B2B_RAND_COL	15
+#define SPD_BURST_LENGTHS		16
+#define SPD_NUMBER_OF_BANKS_SDRAM	17
+#define SPD_CAS_LATENCY			18
+#define SPD_CS_LATENCY			19
+#define SPD_WE_LATENCY			20
+#define SPD_MODULE_ATTRIBS		21
+#define SPD_DEVICE_ATTRIBS		22
+#define SPD_CYCLE_TIME_CL_X_1		23
+#define SPD_ACCESS_TIME_CL_X_1		24
+#define SPD_CYCLE_TIME_CL_X_2		25
+#define SPD_ACCESS_TIME_CL_X_2		26
+#define SPD_TRP				27
+#define SPD_TRRD			28
+#define SPD_TRCD			29
+#define SPD_TRAS			30
+#define SPD_ROW_DENSITY			31
+#define SPD_CMD_ADDR_SETUP_TIME		32
+#define SPD_CMD_ADDR_HOLD_TIME		33
+#define SPD_DATA_SETUP_TIME		34
+#define SPD_DATA_HOLD_TIME		35
+#define SPD_DATA_REVISION		62
+#define SPD_CHECKSUM			63
+#define SPD_MANUF_JDEC_ID		64
+#define SPD_MANUF_LOCATION		72
+#define SPD_MANUF_PART_NUMBER		73
+#define SPD_REVISION_CODE		91
+#define SPD_MANUF_DATE			93
+#define SPD_SERIAL_NUMBER		95
+#define SPD_MANUF_SPECIFIC_DATA		99
+#define SPD_INTEL_SPEC_FREQ		126
+#define SPD_INTEL_SPEC_CAS_LATENCY	127
+
+#endif
+
Index: build_tree/bootLoader/include/blob/stamp-h.in
diff -u build_tree/bootLoader/include/blob/stamp-h.in:1.1.1.1 build_tree/bootLoader/include/blob/stamp-h.in:removed
--- build_tree/bootLoader/include/blob/stamp-h.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/stamp-h.in	Tue Jan  8 14:21:46 2008
@@ -1 +0,0 @@
-timestamp
Index: build_tree/bootLoader/include/blob/strata.h
diff -u /dev/null build_tree/bootLoader/include/blob/strata.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/strata.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,43 @@
+#ifndef __STRATA_H
+#define __STRATA_H
+
+#define MAX_REGIONS	2
+
+/* Intel Strata Flash(R) Flash Memory */
+typedef enum flash_type {
+	STRATA_UNKNOWN, 
+	STRATA_J3, 
+	STRATA_K3, 
+	STRATA_K18,
+	STRATA_L3,
+	STRATA_L18
+}flash_type;
+
+struct flash_region
+{
+	u32 offset;
+	u32 block_num;
+	u32 block_size;
+};
+
+struct flash_chip
+{
+	u32 base;
+	u32 buswidth;
+
+	u32 id;
+	u32 cache_size;
+	enum flash_type type;
+
+	int region_num;
+	struct flash_region regions[MAX_REGIONS];
+
+	u32 rcr;
+};
+
+/* function interface */
+extern int flash_erase(struct flash_chip *chip, u32 dest, u32 len);
+extern int flash_write(struct flash_chip *chip, u32 dest, u8 *mem, u32 len);
+extern int flash_probe(struct flash_chip *chip);
+
+#endif
Index: build_tree/bootLoader/include/blob/tar.h
diff -u /dev/null build_tree/bootLoader/include/blob/tar.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/tar.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,262 @@
+/*
+ * tar.h
+ *
+   Copyright (C) 1988, 92, 93, 94, 96, 97 Free Software Foundation, Inc.
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+#ifndef BLOB_TAR_H
+#define BLOB_TAR_H 1
+
+/*---------------------------------------------.
+| `tar' Header Block, from POSIX 1003.1-1990.  |
+`---------------------------------------------*/
+
+/* POSIX header.  */
+
+typedef struct posix_header
+{				/* byte offset */
+  char name[100];		/*   0 */
+  char mode[8];			/* 100 */
+  char uid[8];			/* 108 */
+  char gid[8];			/* 116 */
+  char size[12];		/* 124 */
+  char mtime[12];		/* 136 */
+  char chksum[8];		/* 148 */
+  char typeflag;		/* 156 */
+  char linkname[100];		/* 157 */
+  char magic[6];		/* 257 */
+  char version[2];		/* 263 */
+  char uname[32];		/* 265 */
+  char gname[32];		/* 297 */
+  char devmajor[8];		/* 329 */
+  char devminor[8];		/* 337 */
+  char prefix[155];		/* 345 */
+				/* 500 */
+} tar_hdr_posix_t __attribute__ (( packed ));
+
+#define TMAGIC   "ustar"	/* ustar and a null */
+#define TMAGLEN  6
+#define TVERSION "00"		/* 00 and no null */
+#define TVERSLEN 2
+
+/* Values used in typeflag field.  */
+#define REGTYPE	 '0'		/* regular file */
+#define AREGTYPE '\0'		/* regular file */
+#define LNKTYPE  '1'		/* link */
+#define SYMTYPE  '2'		/* reserved */
+#define CHRTYPE  '3'		/* character special */
+#define BLKTYPE  '4'		/* block special */
+#define DIRTYPE  '5'		/* directory */
+#define FIFOTYPE '6'		/* FIFO special */
+#define CONTTYPE '7'		/* reserved */
+
+/* Bits used in the mode field, values in octal.  */
+#define TSUID    04000		/* set UID on execution */
+#define TSGID    02000		/* set GID on execution */
+#define TSVTX    01000		/* reserved */
+				/* file permissions */
+#define TUREAD   00400		/* read by owner */
+#define TUWRITE  00200		/* write by owner */
+#define TUEXEC   00100		/* execute/search by owner */
+#define TGREAD   00040		/* read by group */
+#define TGWRITE  00020		/* write by group */
+#define TGEXEC   00010		/* execute/search by group */
+#define TOREAD   00004		/* read by other */
+#define TOWRITE  00002		/* write by other */
+#define TOEXEC   00001		/* execute/search by other */
+
+/*-------------------------------------.
+| `tar' Header Block, GNU extensions.  |
+`-------------------------------------*/
+
+/* In GNU tar, SYMTYPE is for to symbolic links, and CONTTYPE is for
+   contiguous files, so maybe disobeying the `reserved' comment in POSIX
+   header description.  I suspect these were meant to be used this way, and
+   should not have really been `reserved' in the published standards.  */
+
+/* *BEWARE* *BEWARE* *BEWARE* that the following information is still
+   boiling, and may change.  Even if the OLDGNU format description should be
+   accurate, the so-called GNU format is not yet fully decided.  It is
+   surely meant to use only extensions allowed by POSIX, but the sketch
+   below repeats some ugliness from the OLDGNU format, which should rather
+   go away.  Sparse files should be saved in such a way that they do *not*
+   require two passes at archive creation time.  Huge files get some POSIX
+   fields to overflow, alternate solutions have to be sought for this.  */
+
+/* Descriptor for a single file hole.  */
+
+struct sparse
+{				/* byte offset */
+  char offset[12];		/*   0 */
+  char numbytes[12];		/*  12 */
+				/*  24 */
+};
+
+/* Sparse files are not supported in POSIX ustar format.  For sparse files
+   with a POSIX header, a GNU extra header is provided which holds overall
+   sparse information and a few sparse descriptors.  When an old GNU header
+   replaces both the POSIX header and the GNU extra header, it holds some
+   sparse descriptors too.  Whether POSIX or not, if more sparse descriptors
+   are still needed, they are put into as many successive sparse headers as
+   necessary.  The following constants tell how many sparse descriptors fit
+   in each kind of header able to hold them.  */
+
+#define SPARSES_IN_EXTRA_HEADER  16
+#define SPARSES_IN_OLDGNU_HEADER 4
+#define SPARSES_IN_SPARSE_HEADER 21
+
+/* The GNU extra header contains some information GNU tar needs, but not
+   foreseen in POSIX header format.  It is only used after a POSIX header
+   (and never with old GNU headers), and immediately follows this POSIX
+   header, when typeflag is a letter rather than a digit, so signaling a GNU
+   extension.  */
+
+typedef struct extra_header
+{				/* byte offset */
+  char atime[12];		/*   0 */
+  char ctime[12];		/*  12 */
+  char offset[12];		/*  24 */
+  char realsize[12];		/*  36 */
+  char longnames[4];		/*  48 */
+  char unused_pad1[68];		/*  52 */
+  struct sparse sp[SPARSES_IN_EXTRA_HEADER];
+				/* 120 */
+  char isextended;		/* 504 */
+				/* 505 */
+} tar_hdr_extra_t;
+
+/* Extension header for sparse files, used immediately after the GNU extra
+   header, and used only if all sparse information cannot fit into that
+   extra header.  There might even be many such extension headers, one after
+   the other, until all sparse information has been recorded.  */
+
+typedef struct sparse_header
+{				/* byte offset */
+  struct sparse sp[SPARSES_IN_SPARSE_HEADER];
+				/*   0 */
+  char isextended;		/* 504 */
+				/* 505 */
+} tar_hdr_sparse_t;
+
+/* The old GNU format header conflicts with POSIX format in such a way that
+   POSIX archives may fool old GNU tar's, and POSIX tar's might well be
+   fooled by old GNU tar archives.  An old GNU format header uses the space
+   used by the prefix field in a POSIX header, and cumulates information
+   normally found in a GNU extra header.  With an old GNU tar header, we
+   never see any POSIX header nor GNU extra header.  Supplementary sparse
+   headers are allowed, however.  */
+
+typedef struct oldgnu_header
+{				/* byte offset */
+  char unused_pad1[345];	/*   0 */
+  char atime[12];		/* 345 */
+  char ctime[12];		/* 357 */
+  char offset[12];		/* 369 */
+  char longnames[4];		/* 381 */
+  char unused_pad2;		/* 385 */
+  struct sparse sp[SPARSES_IN_OLDGNU_HEADER];
+				/* 386 */
+  char isextended;		/* 482 */
+  char realsize[12];		/* 483 */
+				/* 495 */
+} tar_hdr_oldgnu_t;
+
+/* OLDGNU_MAGIC uses both magic and version fields, which are contiguous.
+   Found in an archive, it indicates an old GNU header format, which will be
+   hopefully become obsolescent.  With OLDGNU_MAGIC, uname and gname are
+   valid, though the header is not truly POSIX conforming.  */
+#define OLDGNU_MAGIC "ustar  "	/* 7 chars and a null */
+
+/* The standards committee allows only capital A through capital Z for
+   user-defined expansion.  */
+
+/* This is a dir entry that contains the names of files that were in the
+   dir at the time the dump was made.  */
+#define GNUTYPE_DUMPDIR	'D'
+
+/* Identifies the *next* file on the tape as having a long linkname.  */
+#define GNUTYPE_LONGLINK 'K'
+
+/* Identifies the *next* file on the tape as having a long name.  */
+#define GNUTYPE_LONGNAME 'L'
+
+/* This is the continuation of a file that began on another volume.  */
+#define GNUTYPE_MULTIVOL 'M'
+
+/* For storing filenames that do not fit into the main header.  */
+#define GNUTYPE_NAMES 'N'
+
+/* This is for sparse files.  */
+#define GNUTYPE_SPARSE 'S'
+
+/* This file is a tape/volume header.  Ignore it on extraction.  */
+#define GNUTYPE_VOLHDR 'V'
+
+/*--------------------------------------.
+| tar Header Block, overall structure.  |
+`--------------------------------------*/
+
+/* tar files are made in basic blocks of this size.  */
+#define TAR_BLOCKSIZE 512
+
+enum archive_format
+{
+  DEFAULT_FORMAT,		/* format to be decided later */
+  V7_FORMAT,			/* old V7 tar format */
+  OLDGNU_FORMAT,		/* GNU format as per before tar 1.12 */
+  POSIX_FORMAT,			/* restricted, pure POSIX format */
+  GNU_FORMAT			/* POSIX format with GNU extensions */
+};
+
+typedef union block
+{
+  char buffer[TAR_BLOCKSIZE];
+  tar_hdr_posix_t header;
+  tar_hdr_extra_t extra_header;
+  tar_hdr_oldgnu_t oldgnu_header;
+  tar_hdr_sparse_t sparse_header;
+} tar_block_t;
+
+/* End of Format description.  */
+
+typedef struct {
+	/* io driver to get data from */
+	io_driver_t		*io_driver;
+	/* current block */
+	int				block;
+
+	/* block buffer */
+	unsigned char	buffer[512];
+
+	/* file infos */
+	int				f_start_block;
+	char			filename[255];
+	unsigned long	f_size;
+	int				f_blocks;
+} tar_arch_t;
+
+void tar_dbg_set( int lvl );
+int tar_init( tar_arch_t *arch, io_driver_t *io );
+int tar_tell( tar_arch_t *arch );
+int tar_xtract( tar_arch_t *arch, char *filename, char *dest );
+
+/**********************************************************************
+ * io driver for tar archives
+ */
+int tar_io_init( io_driver_t *io, tar_arch_t *arch );
+
+#endif
Index: build_tree/bootLoader/include/blob/terminal.h
diff -u build_tree/bootLoader/include/blob/terminal.h:1.1.1.1 build_tree/bootLoader/include/blob/terminal.h:removed
--- build_tree/bootLoader/include/blob/terminal.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/terminal.h	Tue Jan  8 14:21:46 2008
@@ -1,38 +0,0 @@
-/*
- * terminal.h: header file for terminal.c
- *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * $Id: terminal.h,v 1.2 2001/10/07 22:36:11 erikm Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-#ident "$Id: terminal.h,v 1.2 2001/10/07 22:36:11 erikm Exp $"
-
-#ifndef BLOB_TERMINAL_H
-#define BLOB_TERMINAL_H
-
-
-
-
-extern char resethelp[];
-int reset_terminal(int argc, char *argv[]);
-
-
-
-
-#endif
Index: build_tree/bootLoader/include/blob/time.h
diff -u build_tree/bootLoader/include/blob/time.h:1.1.1.1 build_tree/bootLoader/include/blob/time.h:1.1.1.2
--- build_tree/bootLoader/include/blob/time.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/time.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      time.h
- * Version:       $Id: time.h,v 1.2 2001/10/07 20:16:57 erikm Exp $
+ * Version:       $Id: time.h,v 1.4 2003/09/04 18:03:09 russd Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   Timer functions
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: time.h,v 1.2 2001/10/07 20:16:57 erikm Exp $"
+#ident "$Id: time.h,v 1.4 2003/09/04 18:03:09 russd Exp $"
 
 #ifndef BLOB_TIME_H
 #define BLOB_TIME_H
@@ -44,17 +44,39 @@
 
 #define TICKS_PER_SECOND 3686400
 
+typedef void (*timer_init_func_t)(void);
+typedef u32 (*timer_read_func_t)(void);
+typedef int (*timer_overflow_func_t)(void);
+typedef void (*timer_overflow_clear_func_t)(void);
+ 
+ 
+typedef struct {
+	timer_init_func_t init;
+	timer_read_func_t read;
+	timer_overflow_func_t overflow;
+	timer_overflow_clear_func_t overflow_clear;
+	int tps;
+} timer_driver_t;
+ 
+ 
+/* implemented timer drivers */
+extern timer_driver_t s3c2500_timer_driver;
+extern timer_driver_t null_timer_driver;
+extern timer_driver_t intelarm_timer_driver;
+ 
+/* should be filled out by the architecture dependent files */
+extern timer_driver_t *timer_driver;
 
 
-
-void TimerInit(void);
+void timer_init(void);
 
 /* returns the time in 1/TICKS_PER_SECOND seconds */
-u32  TimerGetTime(void);
+u32  timer_read(void);
 
-int TimerDetectOverflow(void);
+int timer_overflow(void);
 
-void TimerClearOverflow(void);
+void timer_overflow_clear(void);
+int timer_tps(void);
 
 /* suspend execution for interval of milliseconds */
 void msleep(unsigned int msec);
Index: build_tree/bootLoader/include/blob/types.h
diff -u build_tree/bootLoader/include/blob/types.h:1.1.1.1 build_tree/bootLoader/include/blob/types.h:1.1.1.2
--- build_tree/bootLoader/include/blob/types.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/types.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      types.h
- * Version:       $Id: types.h,v 1.3 2002/01/06 18:57:32 erikm Exp $
+ * Version:       $Id: types.h,v 1.5 2002/05/25 17:09:57 erikm Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   Define some handy types for the blob
@@ -29,23 +29,34 @@
  *
  */
 
-#ident "$Id: types.h,v 1.3 2002/01/06 18:57:32 erikm Exp $"
+#ident "$Id: types.h,v 1.5 2002/05/25 17:09:57 erikm Exp $"
 
 #ifndef BLOB_TYPES_H
 #define BLOB_TYPES_H
 
-typedef signed long	s32;
+typedef signed int	s32;
 typedef signed short	s16;
 typedef signed char	s8;
 
-typedef unsigned long	u32;
+typedef unsigned int	u32;
 typedef unsigned short	u16;
 typedef	unsigned char	u8;
 
 #ifndef USE_BLOB_TOGETHER_WITH_LIBC
+
+/*
+ * The following typedefs are also protected by individual ifdefs for
+ * historical reasons:
+ */
+#ifndef _SIZE_T
+#define _SIZE_T
 typedef u32 size_t;
 #endif
 
+#else
+#include <stdlib.h>
+#endif
+
 /* number of nibbles in a word */
 #define NIBBLES_PER_WORD (8)
 
Index: build_tree/bootLoader/include/blob/util.h
diff -u build_tree/bootLoader/include/blob/util.h:1.1.1.1 build_tree/bootLoader/include/blob/util.h:1.1.1.2
--- build_tree/bootLoader/include/blob/util.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/util.h	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      util.h
- * Version:       $Id: util.h,v 1.7 2002/01/06 17:04:36 erikm Exp $
+ * Version:       $Id: util.h,v 1.13 2003/03/17 14:59:08 seletz Exp $
  * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
  * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
  * Description:   Simple utility functions for blob
@@ -12,6 +12,7 @@
  * util.h: Simple utility functions for blob
  *
  * Copyright (C) 1999  Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl)
+ * Copyright (C) 2001 2002  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -29,7 +30,7 @@
  *
  */
 
-#ident "$Id: util.h,v 1.7 2002/01/06 17:04:36 erikm Exp $"
+#ident "$Id: util.h,v 1.13 2003/03/17 14:59:08 seletz Exp $"
 
 
 #ifndef BLOB_UTIL_H
@@ -38,11 +39,13 @@
 #include <blob/types.h>
 
 void MyMemCpy(u32 *dest, const u32 *src, int numWords);
-void MyMemCpyChar(char *dest, const char *src, int numBytes);
-void MyMemSet(u32 *dest, const u32 wordToWrite, int numWords);
 
 void *memcpy(void *dest, const void *src, size_t n);
 
+void *memset(void *dest, int c, size_t n);
+
+int memcmp(const void * cs,const void * ct,size_t count);
+
 int strncmp(const char *s1, const char *s2, size_t maxlen);
 
 int strlen(const char *s);
@@ -55,6 +58,9 @@
 /* convert a string to an u32 value */
 int strtou32(const char *str, u32 *value);
 
+/* printf and friends */
+int snprintf(char * buf, size_t size, const char *fmt, ...);
+int printf(const char *fmt, ...);
 
 /* Optimization barrier */
 /* The "volatile" is due to gcc bugs */
Index: build_tree/bootLoader/include/blob/arch/.cvsignore
diff -u /dev/null build_tree/bootLoader/include/blob/arch/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile
+Makefile.in
Index: build_tree/bootLoader/include/blob/arch/Makefile.am
diff -u build_tree/bootLoader/include/blob/arch/Makefile.am:1.1.1.1 build_tree/bootLoader/include/blob/arch/Makefile.am:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,7 @@
 # -*- makefile -*-
 ###########################################################################
 ## Filename:      Makefile.am
-## Version:       $Id: Makefile.am,v 1.5 2001/12/27 18:27:37 erikm Exp $
+## Version:       $Id: Makefile.am,v 1.15 2003/09/04 18:10:41 russd Exp $
 ## Copyright:     Copyright (C) 1999, Erik Mouw
 ## Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 ## Description:   Makefile
@@ -11,18 +11,29 @@
 ###########################################################################
 
 noinst_HEADERS	= \
+	accelent_sa.h \
 	assabet.h \
 	badge4.h \
 	brutus.h \
+	cep.h \
 	clart.h \
+	frodo.h	\
+	hackkit.h \
 	h3600.h \
 	idr.h \
 	jornada720.h \
 	lart.h \
+	lubbock.h \
+	miniprint.h \
 	nesa.h \
 	pleb.h \
+	ramses.h \
 	shannon.h \
-	system3.h
+	smdk2500.h \
+	system3.h \
+	trizeps.h \
+	pxa_idp.h \
+	csir_ims.h
 
 
 CLEANFILES	= ${srcdir}/*~
Index: build_tree/bootLoader/include/blob/arch/Makefile.in
diff -u build_tree/bootLoader/include/blob/arch/Makefile.in:1.1.1.1 build_tree/bootLoader/include/blob/arch/Makefile.in:1.2
--- build_tree/bootLoader/include/blob/arch/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,211 +12,381 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 ###########################################################################
 ###########################################################################
 
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ../../..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = include/blob/arch
+DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
+	$(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+HEADERS = $(noinst_HEADERS)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-noinst_HEADERS =  	assabet.h 	badge4.h 	brutus.h 	clart.h 	h3600.h 	idr.h 	jornada720.h 	lart.h 	nesa.h 	pleb.h 	shannon.h 	system3.h
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+noinst_HEADERS = \
+	accelent_sa.h \
+	assabet.h \
+	badge4.h \
+	brutus.h \
+	cep.h \
+	clart.h \
+	frodo.h	\
+	hackkit.h \
+	h3600.h \
+	idr.h \
+	jornada720.h \
+	lart.h \
+	lubbock.h \
+	miniprint.h \
+	nesa.h \
+	pleb.h \
+	ramses.h \
+	shannon.h \
+	smdk2500.h \
+	system3.h \
+	trizeps.h \
+	pxa_idp.h \
+	csir_ims.h
 
 CLEANFILES = ${srcdir}/*~
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../../../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-HEADERS =  $(noinst_HEADERS)
-
-DIST_COMMON =  Makefile.am Makefile.in
-
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
+all: all-am
 
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps include/blob/arch/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  include/blob/arch/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  include/blob/arch/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
 tags: TAGS
 
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
-
-TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = include/blob/arch
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
 check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am:
+all-am: Makefile $(HEADERS)
+installdirs:
+install: install-am
 install-exec: install-exec-am
-
-install-data-am:
 install-data: install-data-am
+uninstall: uninstall-am
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am:
-uninstall: uninstall-am
-all-am: Makefile $(HEADERS)
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-
 
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
 
-mostlyclean: mostlyclean-am
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-tags clean-generic mostlyclean-am
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
 
-clean: clean-am
+dvi: dvi-am
 
-distclean-am:  distclean-tags distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-am
+html: html-am
 
-maintainer-clean-am:  maintainer-clean-tags maintainer-clean-generic \
-		distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
 
-.PHONY: tags mostlyclean-tags distclean-tags clean-tags \
-maintainer-clean-tags distdir info-am info dvi-am dvi check check-am \
-installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+uninstall-am: uninstall-info-am
 
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	ctags distclean distclean-generic distclean-tags distdir dvi \
+	dvi-am html html-am info info-am install install-am \
+	install-data install-data-am install-exec install-exec-am \
+	install-info install-info-am install-man install-strip \
+	installcheck installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-generic pdf \
+	pdf-am ps ps-am tags uninstall uninstall-am uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/include/blob/arch/Z2.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/Z2.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/Z2.h	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,139 @@
+/*
+ * mainstone.h: Mainstone specific defines
+ *
+ * Copyright (C) 2002 Intel Corporation (yu.tang@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_ARCH_MAINSTONE_H
+#define BLOB_ARCH_MAINSTONE_H
+
+/* Use FFUART */
+#define USE_SERIAL1	1
+#define TERMINAL_SPEED	baud_115200
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xa0300400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xa0200000)
+#define KERNEL_RAM_BASE		(0xa0008000)
+#define PARAM_RAM_BASE		(0xa0210000)
+#define RAMDISK_RAM_BASE	(0xa0500000)
+
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(0) /* no parameters */
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(2 * 1024 * 1024)
+#define LOAD_RAMDISK		0 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xa0000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+
+/* GPIO settings */
+#undef GPSR0_VALUE
+#undef GPSR1_VALUE
+#undef GPSR2_VALUE
+#undef GPSR3_VALUE
+#undef GPDR0_VALUE
+#undef GPDR1_VALUE
+#undef GPDR2_VALUE
+#undef GPDR3_VALUE
+#undef GPCR0_VALUE
+#undef GPCR1_VALUE
+#undef GPCR2_VALUE
+#undef GPCR3_VALUE
+#undef GAFR0_L_VALUE
+#undef GAFR0_U_VALUE
+#undef GAFR1_L_VALUE
+#undef GAFR1_U_VALUE
+#undef GAFR2_L_VALUE
+#undef GAFR2_U_VALUE
+#undef GAFR3_L_VALUE
+#undef GAFR3_U_VALUE
+
+#define GPSR0_VALUE	0x00708800
+#define GPSR1_VALUE	0x03cf0002
+#define GPSR2_VALUE	0x0021FC00
+#define GPSR3_VALUE	0x00000000
+
+#define GPCR0_VALUE	0x00001000
+#define GPCR1_VALUE	0x00000000
+#define GPCR2_VALUE	0x00000000
+#define GPCR3_VALUE	0x00000000
+
+#define GPDR0_VALUE	0xC27B9C04
+#define GPDR1_VALUE	0x00EFAA83
+#define GPDR2_VALUE	0x0E23FC00
+#define GPDR3_VALUE	0x001E1F81
+
+#define GAFR0_L_VALUE	0x94F00000
+#define GAFR0_U_VALUE	0x015A859A
+#define GAFR1_L_VALUE	0x999A955A
+#define GAFR1_U_VALUE	0x0005A4AA
+#define GAFR2_L_VALUE	0x6AA00000
+#define GAFR2_U_VALUE	0x55A8041A
+#define GAFR3_L_VALUE	0x56AA955A
+#define GAFR3_U_VALUE	0x00000001
+
+/* Memory configuration */
+#define MDREFR_VALUE	0x00000018
+#define MDCNFG_VALUE	0x00000AC9
+#define MDMRS_VALUE	0x00000000
+
+/*
+ * #define MSC0_VALUE	0x39F2A7A3
+ */
+#define MSC1_VALUE	0x0000A691
+#define MSC2_VALUE	0x0000B884
+
+/* TFTP download RAM base */
+#define TFTP_RAM_START	0xa1000000
+
+/* FPGA */
+#define MST_FPGA_BASE	0x08000000
+#define MST_LEDDAT1	__REG(MST_FPGA_BASE + 0x10)
+#define MST_LEDCTL	__REG(MST_FPGA_BASE + 0x40)
+#define MST_GPSWR	__REG(MST_FPGA_BASE + 0x60)
+#define MST_MSCWR1	__REG(MST_FPGA_BASE + 0x80)
+#define MST_MSCWR2	__REG(MST_FPGA_BASE + 0x84)
+
+/* USB client Soft-connect bit */
+#define MST_USBC_SC     (0x1<<4)
+
+/* LED */
+#define LED_ADDR	(MST_FPGA_BASE + 0x40)
+#define LED_ON		(0x00FE)
+#define LED_OFF		(0x00FF)
+
+/* SMC91c111 */
+#define SMC_BASE	(0x10000300)
+
+#endif 
Index: build_tree/bootLoader/include/blob/arch/accelent_sa.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/accelent_sa.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/accelent_sa.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,134 @@
+/*
+ * accelent_sa.h: Accelent IDP specific defines
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2002  Holger Schurig <h.schurig@mn-logistik.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: accelent_sa.h,v 1.4 2002/02/27 18:41:47 timriker Exp $"
+
+#ifndef BLOB_ARCH_ACCELENT_SA_H
+#define BLOB_ARCH_ACCELENT_SA_H
+
+#undef  CPU_SPEED_133
+
+/* boot CPU speed */
+#ifdef CPU_SPEED_133
+#       define CPU_SPEED                (0x05)
+#else
+#       define CPU_SPEED                (0x0a)
+#endif
+
+/* serial port */
+#define USE_SERIAL1
+#define TERMINAL_SPEED baud_115200
+
+/* GPIO for the LED */
+#define LED_GPIO		(0x00000002) /* GPIO 1 */
+
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xc0200400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xc0100000)
+#define KERNEL_RAM_BASE		(0xC0008000)
+#define PARAM_RAM_BASE		(0xc0110000)
+#define RAMDISK_RAM_BASE	(0xC0400000)
+
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xc0000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+
+#ifdef BLOB_NEED_MEMCONFIG
+#ifdef CPU_SPEED_133
+
+// found in the original Boot-Flash at 0x170fc (133 MHz)
+#define MDCNFG_VALUE	0x1b541b54
+#define MDCAS00_VALUE	0x55555557
+#define MDCAS01_VALUE	0x55555555
+#define MDCAS02_VALUE	0x55555555
+#define MDCAS20_VALUE	0x55555557
+#define MDCAS21_VALUE	0x55555555
+#define MDCAS22_VALUE	0x55555555
+#define MSC1_VALUE	0x27392738
+#define MSC2_VALUE	0x27382739
+#define MECR_VALUE	0x14a514a5
+#define SMCNFG_VALUE	0x00000000
+#define PPCR_VALUE	CPU_SPEED
+
+#else
+
+// found in the original Boot-Flash at 0x17164 (206 MHz)
+#define MDCNFG_VALUE	0xf354f354
+#define MDCAS00_VALUE	0xaaaaaaaf
+#define MDCAS01_VALUE	0xaaaaaaaa
+#define MDCAS02_VALUE	0xaaaaaaaa
+#define MDCAS20_VALUE	0xaaaaaaaf
+#define MDCAS21_VALUE	0xaaaaaaaa
+#define MDCAS22_VALUE	0xaaaaaaaa
+#define MSC1_VALUE	0x6c616c60
+#define MSC2_VALUE	0x6c606c61
+#define MECR_VALUE	0x21082108
+#define SMCNFG_VALUE	0x00000000
+#define PPCR_VALUE	CPU_SPEED
+
+#endif
+
+// MSC0 (nCS0, nCS1) is for Flash
+// MSC1 (nCS2, nCS3) is for ?, SA1111
+// MSC2 (nCS4, nCS5) is for ExtBus, LCD
+#define MSC0_VALUE	0x6c616c60
+#endif
+
+
+// the control-registers in the FPGA
+#define CONTROL_REG     __REG(0x42000000)
+
+
+/* Debugging macros used in accelent code */
+#define ACCELENT_DEBUG 1
+
+#ifdef ACCELENT_DEBUG
+#	define _DBGU32( x )	SerialOutputString( #x"=0x" ); \
+				SerialOutputHex( (u32)x ); \
+				serial_write( '\n' );
+#else
+#	define _DBGU32( x )
+#endif
+
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/assabet.h
diff -u build_tree/bootLoader/include/blob/arch/assabet.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/assabet.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/assabet.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/assabet.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: assabet.h,v 1.5 2001/11/04 23:04:37 erikm Exp $
+ * $Id: assabet.h,v 1.9 2002/03/14 11:41:37 seletz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: assabet.h,v 1.5 2001/11/04 23:04:37 erikm Exp $"
+#ident "$Id: assabet.h,v 1.9 2002/03/14 11:41:37 seletz Exp $"
 
 #ifndef BLOB_ARCH_ASSABET_H
 #define BLOB_ARCH_ASSABET_H
@@ -33,8 +33,17 @@
 #define CPU_SPEED		(0x0b)
 
 
-/* serial port */
-#define USE_SERIAL1
+/* serial port
+ * When neponset is attached use UART 3 (J20) to match
+ * the linux kernel
+ */
+#if !defined(NEPONSET)
+#	define USE_SERIAL1
+#else
+#	define USE_SERIAL3
+#endif
+
+#define TERMINAL_SPEED baud_9600
 
 
 /* GPIO for the LED */
@@ -59,6 +68,7 @@
 #define PARAM_FLASH_LEN		(256 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
 #define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
 #define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
 
Index: build_tree/bootLoader/include/blob/arch/badge4.h
diff -u build_tree/bootLoader/include/blob/arch/badge4.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/badge4.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/badge4.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/badge4.h	Fri Nov  9 09:44:05 2007
@@ -1,10 +1,10 @@
 /*
- * badge4.h: Badge4 specific defines
+ * badge4.h: BadgePAD 4 specific defines
  *
- * Copyright (C) 2001  Hewlett-Packard Company
+ * Copyright (C) 2001-2002  Hewlett-Packard Company
  * Written by Christopher Hoover <ch@hpl.hp.com>
  *
- * $Id: badge4.h,v 1.1 2001/12/27 18:27:37 erikm Exp $
+ * $Id: badge4.h,v 1.15 2003/01/28 03:44:41 choover Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -22,63 +22,119 @@
  *
  */
 
-#ident "$Id: badge4.h,v 1.1 2001/12/27 18:27:37 erikm Exp $"
+#ident "$Id: badge4.h,v 1.15 2003/01/28 03:44:41 choover Exp $"
 
 #ifndef BLOB_ARCH_BADGE4_H
 #define BLOB_ARCH_BADGE4_H
 
+#define BADGE4_SA1111_BASE		(0x48000000)
 
+/* GPIOs on the BadgePAD 4 */
+#define BADGE4_GPIO_INT_1111		GPIO_GPIO0   /* SA-1111 IRQ */
 
+#define BADGE4_GPIO_INT_VID		GPIO_GPIO1   /* Video expansion */
+#define BADGE4_GPIO_LGP2		GPIO_GPIO2   /* GPIO_LDD8 */
+#define BADGE4_GPIO_LGP3		GPIO_GPIO3   /* GPIO_LDD9 */
+#define BADGE4_GPIO_LGP4		GPIO_GPIO4   /* GPIO_LDD10 */
+#define BADGE4_GPIO_LGP5		GPIO_GPIO5   /* GPIO_LDD11 */
+#define BADGE4_GPIO_LGP6		GPIO_GPIO6   /* GPIO_LDD12 */
+#define BADGE4_GPIO_LGP7		GPIO_GPIO7   /* GPIO_LDD13 */
+#define BADGE4_GPIO_LGP8		GPIO_GPIO8   /* GPIO_LDD14 */
+#define BADGE4_GPIO_LGP9		GPIO_GPIO9   /* GPIO_LDD15 */
+#define BADGE4_GPIO_GPA_VID		GPIO_GPIO10  /* Video expansion */
+#define BADGE4_GPIO_GPB_VID		GPIO_GPIO11  /* Video expansion */
+#define BADGE4_GPIO_GPC_VID		GPIO_GPIO12  /* Video expansion */
 
-/* boot CPU speed */
-#define CPU_SPEED		(0x0a)
+#define BADGE4_GPIO_UART_HS1		GPIO_GPIO13
+#define BADGE4_GPIO_UART_HS2		GPIO_GPIO14
+
+#define BADGE4_GPIO_MUXSEL0		GPIO_GPIO15
+#define BADGE4_GPIO_TESTPT_J7		GPIO_GPIO16
+
+#define BADGE4_GPIO_SDSDA		GPIO_GPIO17  /* SDRAM SPD Data */
+#define BADGE4_GPIO_SDSCL		GPIO_GPIO18  /* SDRAM SPD Clock */
+#define BADGE4_GPIO_SDTYP0		GPIO_GPIO19  /* SDRAM Type Control */
+#define BADGE4_GPIO_SDTYP1		GPIO_GPIO20  /* SDRAM Type Control */
+
+#define BADGE4_GPIO_BGNT_1111		GPIO_GPIO21  /* GPIO_MBGNT */
+#define BADGE4_GPIO_BREQ_1111		GPIO_GPIO22  /* GPIO_TREQA */
+
+#define BADGE4_GPIO_TESTPT_J6		GPIO_GPIO23
+
+#define BADGE4_GPIO_PCMEN5V		GPIO_GPIO24  /* 5V power */
 
+#define BADGE4_GPIO_SA1111_NRST		GPIO_GPIO25  /* SA-1111 nRESET */
+
+#define BADGE4_GPIO_TESTPT_J5		GPIO_GPIO26
+
+#define BADGE4_GPIO_CLK_1111		GPIO_GPIO27  /* GPIO_32_768kHz */
+
+/* Interrupts on the BadgePAD 4 */
+#define BADGE4_IRQ_GPIO_SA1111		IRQ_GPIO0    /* SA-1111 interrupt */
+
+/* boot CPU speed */
+#define CPU_SPEED		CPU_CORE_SPEED_206mhz
 
 /* serial port */
 #define USE_SERIAL3
-
+#define TERMINAL_SPEED baud_115200
 
 /* GPIO for the LED */
-#define LED_GPIO		(0x00000000) /* No LED */
-
+#define LED_GPIO		(1<<9)  /* GPIO_GPIO9/BADGE4_GPIO_LGP9 */
 
+#define SA1111_BASE		BADGE4_SA1111_BASE
 
 /* the base address were BLOB is loaded by the first stage loader */
-#define BLOB_ABS_BASE_ADDR	(0xc0200400)
-
+#define BLOB_ABS_BASE_ADDR	(0x08000400)  /* sram */
 
 /* where do various parts live in RAM */
 #define BLOB_RAM_BASE		(0xc0100000)
-#define KERNEL_RAM_BASE		(0xC0008000)
+#define KERNEL_RAM_BASE		(0xc0008000)
 #define PARAM_RAM_BASE		(0xc0110000)
-#define RAMDISK_RAM_BASE	(0xC0400000)
+#define RAMDISK_RAM_BASE	(0xc0600000)
 
 /* and where do they live in flash */
-#define BLOB_FLASH_BASE		(0x00000000)
-#define BLOB_FLASH_LEN		(0x0000A000)
-#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
-#define PARAM_FLASH_LEN		(0x00006000)
-#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
-#define KERNEL_FLASH_LEN	(1 * 1024 * 1024)
-#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
-#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024 - KERNEL_FLASH_LEN - PARAM_FLASH_LEN - BLOB_FLASH_LEN)
+#ifdef CONFIG_ZIMAGE_SUPPORT
 
-#define PARAM_START PARAM_FLASH_BASE
+#  define BLOB_FLASH_BASE	(0x00000000)
+#  define BLOB_FLASH_LEN	(0x00002000 * 6)
+#  define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#  define PARAM_FLASH_LEN	(0x00002000 * 2)
+#  define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#  define KERNEL_FLASH_LEN	(0x00010000 * 16)
+#  define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#  define RAMDISK_FLASH_LEN	(0x00010000 * (127 - 16)) /* limit for d/l only */
+
+#else
+
+#  define BLOB_FLASH_BASE	(0x00000000)
+#  define BLOB_FLASH_LEN	(0x00002000 * 6)
+#  define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#  define PARAM_FLASH_LEN	(0x00002000 * 2)
+#  define RAMDISK_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#  define RAMDISK_FLASH_LEN	(0x00010000 * (127 - 16)) /* limit for d/l only */
 
-/* the position of the kernel boot parameters */
-#define BOOT_PARAMS		(0xc0000100)
+#  define KERNEL_FLASH_LEN	(2 * 1024 * 1024) /* limit for d/l only */
+
+#endif
 
+#define PARAM_START		PARAM_FLASH_BASE
+#define PARAM_LEN		PARAM_FLASH_LEN
 
-/* the size (in kbytes) to which the compressed ramdisk expands */
-#define RAMDISK_SIZE		(8 * 1024)
+#define LOAD_RAMDISK		0
+#define RAMDISK_SIZE		(4 * 1024)
 
 
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xc0000100)
+
 /* Memory configuration */
 
 #define BADGE4_MDCNFG \
-  (MDCNFG_BANK0_ENABLE|MDCNFG_DTIM0_SDRAM|MDCNFG_DWID0_32B|MDCNFG_DRAC0(3)|MDCNFG_TRP0(4)|MDCNFG_TDL0(3)|MDCNFG_TWR0(3)) /* was 0x0000f435 */
+  (MDCNFG_BANK0_ENABLE|MDCNFG_DTIM0_SDRAM|MDCNFG_DWID0_32B|\
+   MDCNFG_DRAC0(3)|MDCNFG_TRP0(4)|MDCNFG_TDL0(3)|MDCNFG_TWR0(3))
 
-/* On CS0: Intel TE28F320C3BA100 Advanced+ Boot Block Flash (4MB) */
+/* On CS0: Intel TE28F320C3 or TE28F640C3 Flash */
 #define BADGE4_CS0 \
    (MSC_RT_ROMFLASH|MSC_RBW16|MSC_RDF(31)|MSC_RDN(31)|MSC_RRR(7))
 
@@ -98,27 +154,24 @@
 
 /* On CS5: SA-1111 */
 #define BADGE4_CS5 \
-   (MSC_RT_VARLAT_345|MSC_RBW16|MSC_RDF(31)|MSC_RDN(31)|MSC_RRR(7))
+   (MSC_RT_SRAM_012|MSC_RBW32|MSC_RDF(31)|MSC_RDN(31)|MSC_RRR(7))
 
-#define BADGE4_MSC0 (BADGE4_CS0 | (BADGE4_CS1<<16)) /* was: 0xfff9fffc */
-#define BADGE4_MSC1 (BADGE4_CS2 | (BADGE4_CS3<<16)) /* was: 0x0000fff9 */
-#define BADGE4_MSC2 (BADGE4_CS4 | (BADGE4_CS5<<16)) /* was: 0xfff90000 */
-
-
-#ifdef BLOB_NEED_MEMCONFIG
-#	define MDCNFG_VALUE	BADGE4_MDCNFG		/* 0x0  MDCNFG */
-#	define MDCAS00_VALUE	0xAAAAAAA7		/* 0x04 MDCAS00 */
-#	define MDCAS01_VALUE	0xAAAAAAAA		/* 0x08 MDCAS01 */
-#	define MDCAS02_VALUE	0xAAAAAAAA		/* 0x0c MDCAS02 */
-#	define MSC0_VALUE	BADGE4_MSC0		/* 0x10 MSC0 */
-#	define MSC1_VALUE	BADGE4_MSC1		/* 0x14 MSC1 */
-#	define MECR_VALUE	0x994a994a		/* 0x18 MECR */
-#	define MDREFR_VALUE	DO_NOT_USE_THIS_VALUE__GETS_AUTOMAGICALLY_COMPUTED
-#	define MDCAS20_VALUE	0xAAAAAA7F		/* 0x20 MDCAS20 */
-#	define MDCAS21_VALUE	0xAAAAAAAA		/* 0x24 MDCAS21 */
-#	define MDCAS22_VALUE	0xAAAAAAAA		/* 0x28 MDCAS22 */
-#	define MSC2_VALUE	BADGE4_MSC2		/* 0x2C MSC2 */
-#	define SMCNFG_VALUE	0x00000000		/* 0x30 SMCNFG */
-#endif
+#define BADGE4_MSC0 (BADGE4_CS0 | (BADGE4_CS1<<16))
+#define BADGE4_MSC1 (BADGE4_CS2 | (BADGE4_CS3<<16))
+#define BADGE4_MSC2 (BADGE4_CS4 | (BADGE4_CS5<<16))
+
+#define MDCNFG_VALUE	BADGE4_MDCNFG		/* 0x0  MDCNFG */
+#define MDCAS00_VALUE	0xAAAAAAA7		/* 0x04 MDCAS00 */
+#define MDCAS01_VALUE	0xAAAAAAAA		/* 0x08 MDCAS01 */
+#define MDCAS02_VALUE	0xAAAAAAAA		/* 0x0c MDCAS02 */
+#define MSC0_VALUE	BADGE4_MSC0		/* 0x10 MSC0 */
+#define MSC1_VALUE	BADGE4_MSC1		/* 0x14 MSC1 */
+#define MECR_VALUE	0x994a994a		/* 0x18 MECR */
+#define MDREFR_VALUE	DO_NOT_USE_THIS_VALUE__GETS_AUTOMAGICALLY_COMPUTED
+#define MDCAS20_VALUE	0xAAAAAA7F		/* 0x20 MDCAS20 */
+#define MDCAS21_VALUE	0xAAAAAAAA		/* 0x24 MDCAS21 */
+#define MDCAS22_VALUE	0xAAAAAAAA		/* 0x28 MDCAS22 */
+#define MSC2_VALUE	BADGE4_MSC2		/* 0x2C MSC2 */
+#define SMCNFG_VALUE	0x00000000		/* 0x30 SMCNFG */
 
 #endif
Index: build_tree/bootLoader/include/blob/arch/brutus.h
diff -u build_tree/bootLoader/include/blob/arch/brutus.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/brutus.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/brutus.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/brutus.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: brutus.h,v 1.3 2001/11/04 23:04:37 erikm Exp $
+ * $Id: brutus.h,v 1.6 2002/02/27 18:41:48 timriker Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: brutus.h,v 1.3 2001/11/04 23:04:37 erikm Exp $"
+#ident "$Id: brutus.h,v 1.6 2002/02/27 18:41:48 timriker Exp $"
 
 #ifndef BLOB_ARCH_BRUTUS_H
 #define BLOB_ARCH_BRUTUS_H
@@ -36,6 +36,7 @@
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_9600
 
 
 /* GPIO for the LED */
@@ -60,6 +61,7 @@
 #define PARAM_FLASH_LEN		(64 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
 #define KERNEL_FLASH_LEN	((1024 - 128) * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
 #define RAMDISK_FLASH_LEN	(4 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN - KERNEL_FLASH_LEN)
 
Index: build_tree/bootLoader/include/blob/arch/cep.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/cep.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/cep.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,99 @@
+/*
+ * cep.h: Cep specific defines
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: cep.h,v 1.1 2002/10/14 13:17:30 seletz Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: cep.h,v 1.1 2002/10/14 13:17:30 seletz Exp $"
+
+#ifndef BLOB_ARCH_CEP_H
+#define BLOB_ARCH_CEP_H
+
+
+
+
+/* boot CPU speed */
+#define CPU_SPEED		(0x0b)
+
+
+/* use serial port 1 */
+#define USE_SERIAL1
+
+
+#define TERMINAL_SPEED baud_9600
+
+
+/* GPIO for the LED */
+#define LED_GPIO		(0x00020000) /* GPIO 17 */
+
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xc0200400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xc0100000)
+#define KERNEL_RAM_BASE		(0xC0008000)
+#define PARAM_RAM_BASE		(0xc0110000)
+#define RAMDISK_RAM_BASE	(0xC0400000)
+
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xc0000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+
+/* Memory configuration */
+#ifdef BLOB_NEED_MEMCONFIG
+#warning "use defines from memsetup.h for better readability"
+#	define MDCNFG_VALUE	0x72547254		/* 0x0  MDCNFG */
+#	define MDCAS00_VALUE	0xAAAAAA7F		/* 0x04 MDCAS00 */
+#	define MDCAS01_VALUE	0xAAAAAAAA		/* 0x08 MDCAS01 */
+#	define MDCAS02_VALUE	0xAAAAAAAA		/* 0x0c MDCAS02 */
+#	define MSC0_VALUE	0x4b384370		/* 0x10 MCS0 */
+#	define MSC1_VALUE	0x22212419		/* 0x14 MCS1 */
+#	define MECR_VALUE	0x994a994a		/* 0x18 MECR */
+#	define MDREFR_VALUE	DO_NOT_USE_THIS_VALUE__GETS_AUTOMAGICALLY_COMPUTED
+#	define MDCAS20_VALUE	0xAAAAAA7F		/* 0x20 MDCAS20 */
+#	define MDCAS21_VALUE	0xAAAAAAAA		/* 0x24 MDCAS21 */
+#	define MDCAS22_VALUE	0xAAAAAAAA		/* 0x28 MDCAS22 */
+#	define MSC2_VALUE	0x42196669		/* 0x2C MCS2 */
+#	define SMCNFG_VALUE	0xafccafcc		/* 0x30 SMCNFG */
+#endif
+
+
+
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/clart.h
diff -u build_tree/bootLoader/include/blob/arch/clart.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/clart.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/clart.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/clart.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: clart.h,v 1.4 2001/11/04 23:04:37 erikm Exp $
+ * $Id: clart.h,v 1.7 2002/02/27 18:41:48 timriker Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: clart.h,v 1.4 2001/11/04 23:04:37 erikm Exp $"
+#ident "$Id: clart.h,v 1.7 2002/02/27 18:41:48 timriker Exp $"
 
 #ifndef BLOB_ARCH_CLART_H
 #define BLOB_ARCH_CLART_H
@@ -35,6 +35,7 @@
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_9600
 
 
 /* GPIO for the LED */
@@ -59,6 +60,7 @@
 #define PARAM_FLASH_LEN		(128 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
 #define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
 #define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
 
Index: build_tree/bootLoader/include/blob/arch/csir_ims.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/csir_ims.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/csir_ims.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,164 @@
+/*
+ * csir_ims.h: CSIR Incident Management System
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2002  Holger Schurig <h.schurig@mn-logistik.de>
+ * Copyright (C) 2002  Jeff Sutherland <jeffs@accelent.com>
+ * Copyright (C) 2003  Abraham vd Merwe <abz@4dllc.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifndef BLOB_ARCH_CSIR_IMS_H
+#define BLOB_ARCH_CSIR_IMS_H
+
+#define USE_SERIAL1
+#define TERMINAL_SPEED baud_115200
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xa0200400)
+
+/* where do various parts live in RAM */
+#define BOOT_PARAMS			(0xa0000100)
+#define BLOB_RAM_BASE		(0xa0100000)
+#define PARAM_RAM_BASE		(0xa0200000)
+#define KERNEL_RAM_BASE		(0xa0800000)
+#define RAMDISK_RAM_BASE	(0xa1000000)
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(128 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(128 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+/* this needs to be defined if you want parameter block support */
+#define PARAM_START PARAM_FLASH_BASE
+#define PARAM_LEN PARAM_FLASH_LEN
+
+/* load ramdisk into ram */
+#define LOAD_RAMDISK		1
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(4 * 1024)
+
+#if 0
+#define MSC0_VALUE      0x
+#define MSC1_VALUE      0x
+#define MSC2_VALUE      0x
+#define MECR_VALUE      0x
+#define MCMEM0_VALUE    0x
+#define MCMEM1_VALUE    0x
+#define MCATT0_VALUE    0x
+#define MCATT1_VALUE    0x
+#define MCIO0_VALUE     0x
+#define MCIO1_VALUE     0x
+#endif
+
+#define MDREFR_VALUE    0x01018013
+#define MDCNFG_VALUE    0x000019c9
+#define MDMRS_VALUE     0x00020002
+
+/* GPIO configuration */
+#define GPIO0_VALUE		GPIO_OUT_LO
+#define GPIO1_VALUE		GPIO_OUT_LO
+#define GPIO2_VALUE		GPIO_OUT_LO
+#define GPIO3_VALUE		GPIO_INPUT						/* eth_wakeup			*/
+#define GPIO4_VALUE		GPIO_INPUT						/* bank_switch_int		*/
+#define GPIO5_VALUE		GPIO_INPUT						/* eth_link_status		*/
+#define GPIO6_VALUE		GPIO_OUT_LO
+#define GPIO7_VALUE		GPIO_OUT_LO						/* cpld_clk				*/
+#define GPIO8_VALUE		GPIO_OUT_LO
+#define GPIO9_VALUE		GPIO_INPUT						/* eth_int				*/
+#define GPIO10_VALUE	GPIO_OUT_HI						/* eth_reset			*/
+#define GPIO11_VALUE	GPIO_OUT_LO
+#define GPIO12_VALUE	GPIO_OUT_LO						/* watchdog_strobe		*/
+#define GPIO13_VALUE	GPIO_INPUT						/* cpld_hw_reset		*/
+#define GPIO14_VALUE	GPIO_INPUT						/* cpld_??				*/
+#define GPIO15_VALUE	(GPIO_OUT_HI | GPIO_ALT_FN2)	/* nCS1 [img_buffer]	*/
+#define GPIO16_VALUE	GPIO_OUT_LO
+#define GPIO17_VALUE	GPIO_INPUT						/* cpld_??				*/
+#define GPIO18_VALUE	GPIO_INPUT						/* vlio_ready_signal	*/
+#define GPIO19_VALUE	GPIO_OUT_LO
+#define GPIO20_VALUE	GPIO_OUT_LO
+#define GPIO21_VALUE	GPIO_OUT_LO
+#define GPIO22_VALUE	GPIO_OUT_LO
+#define GPIO23_VALUE	GPIO_OUT_LO
+#define GPIO24_VALUE	GPIO_OUT_LO
+#define GPIO25_VALUE	GPIO_OUT_HI						/* LED [debug]			*/
+#define GPIO26_VALUE	GPIO_OUT_LO
+#define GPIO27_VALUE	GPIO_OUT_LO
+#define GPIO28_VALUE	GPIO_OUT_LO
+#define GPIO29_VALUE	GPIO_OUT_LO
+#define GPIO30_VALUE	GPIO_OUT_LO
+#define GPIO31_VALUE	GPIO_OUT_LO
+#define GPIO32_VALUE	GPIO_OUT_LO
+#define GPIO33_VALUE	GPIO_OUT_HI						/* nCS5 [unused]		*/
+#define GPIO34_VALUE	(GPIO_INPUT | GPIO_ALT_FN1)		/* FFRXD				*/
+#define GPIO35_VALUE	GPIO_OUT_LO
+#define GPIO36_VALUE	GPIO_OUT_LO
+#define GPIO37_VALUE	GPIO_OUT_LO
+#define GPIO38_VALUE	GPIO_OUT_LO
+#define GPIO39_VALUE	(GPIO_OUT_LO | GPIO_ALT_FN2)	/* FFTXD				*/
+#define GPIO40_VALUE	GPIO_OUT_LO
+#define GPIO41_VALUE	GPIO_OUT_LO
+#define GPIO42_VALUE	GPIO_OUT_LO
+#define GPIO43_VALUE	GPIO_OUT_LO
+#define GPIO44_VALUE	GPIO_OUT_LO
+#define GPIO45_VALUE	GPIO_OUT_LO
+#define GPIO46_VALUE	GPIO_OUT_LO
+#define GPIO47_VALUE	GPIO_OUT_LO
+#define GPIO48_VALUE	GPIO_OUT_LO
+#define GPIO49_VALUE	GPIO_OUT_HI						/* cpld_pcmcia_pwe		*/
+#define GPIO50_VALUE	GPIO_OUT_LO
+#define GPIO51_VALUE	GPIO_OUT_LO
+#define GPIO52_VALUE	GPIO_OUT_LO
+#define GPIO53_VALUE	GPIO_OUT_LO
+#define GPIO54_VALUE	GPIO_OUT_LO
+#define GPIO55_VALUE	GPIO_OUT_LO
+#define GPIO56_VALUE	GPIO_INPUT
+#define GPIO57_VALUE	GPIO_INPUT
+#define GPIO58_VALUE	GPIO_OUT_LO
+#define GPIO59_VALUE	GPIO_OUT_LO
+#define GPIO60_VALUE	GPIO_OUT_LO
+#define GPIO61_VALUE	GPIO_OUT_LO
+#define GPIO62_VALUE	GPIO_OUT_LO
+#define GPIO63_VALUE	GPIO_OUT_LO
+#define GPIO64_VALUE	GPIO_OUT_LO
+#define GPIO65_VALUE	GPIO_OUT_LO
+#define GPIO66_VALUE	GPIO_OUT_LO
+#define GPIO67_VALUE	GPIO_OUT_LO
+#define GPIO68_VALUE	GPIO_OUT_LO
+#define GPIO69_VALUE	GPIO_OUT_LO
+#define GPIO70_VALUE	GPIO_OUT_LO
+#define GPIO71_VALUE	GPIO_OUT_LO
+#define GPIO72_VALUE	GPIO_OUT_LO
+#define GPIO73_VALUE	GPIO_OUT_LO
+#define GPIO74_VALUE	GPIO_OUT_LO
+#define GPIO75_VALUE	GPIO_OUT_LO
+#define GPIO76_VALUE	GPIO_OUT_LO
+#define GPIO77_VALUE	GPIO_OUT_LO
+#define GPIO78_VALUE	(GPIO_OUT_HI | GPIO_ALT_FN2)	/* nCS2 [img_buffer]	*/
+#define GPIO79_VALUE	(GPIO_OUT_HI | GPIO_ALT_FN2)	/* nCS3 [eth]			*/
+#define GPIO80_VALUE	GPIO_OUT_HI						/* nCS4 [unused]		*/
+#define GPIO81_VALUE	GPIO_OUT_LO
+#define GPIO82_VALUE	GPIO_OUT_LO
+#define GPIO83_VALUE	GPIO_OUT_LO
+#define GPIO84_VALUE	GPIO_OUT_LO
+
+#endif	/* #ifndef BLOB_ARCH_CSIR_IMS_H */
Index: build_tree/bootLoader/include/blob/arch/dafit.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/dafit.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/dafit.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,127 @@
+/*
+ * system3.h: PT VibXpert defines
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * $Id: dafit.h,v 1.1 2003/04/03 15:03:00 seletz Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: dafit.h,v 1.1 2003/04/03 15:03:00 seletz Exp $"
+
+#ifndef BLOB_ARCH_DAFIT_H
+#define BLOB_ARCH_DAFIT_H
+
+#define CPU_SPEED		(CPU_CORE_SPEED_206mhz)
+
+/* serial port */
+#define USE_SERIAL1
+#define TERMINAL_SPEED baud_115200
+
+/* GPIO for the LED */
+//#define LED_GPIO		(0x00800000) /* GPIO 10 */
+#define LED_GPIO		(0x00000000) /* NO LED */
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xc0200400)
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xc0100000)
+#define KERNEL_RAM_BASE		(0xC0008000)
+#define PARAM_RAM_BASE		(0xc0110000)
+#define RAMDISK_RAM_BASE	(0xC0400000)
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(0x00040000)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define CONFIG_FLASH_BASE	(0x00040000)
+#define CONFIG_FLASH_LEN	(256 * 1024)
+#define KERNEL_FLASH_BASE	(0x00080000)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(0x00180000)
+#define RAMDISK_FLASH_LEN	(1536 * 1024)
+#define ROOTFS_FLASH_BASE	(0x00300000)
+#define ROOTFS_FLASH_LEN	(0x00600000) /* 6M */
+#define DATAFS_FLASH_BASE	(0x00900000)
+#define DATAFS_FLASH_LEN	(0x00700000) /* 7M */
+
+/* system3 RAM pool for up/downloading */
+#define RAM_START			(0xc1000000)
+#define RAM_SIZE			(16*1024*1024)
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xc0000100)
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+/* let SDRAM run at FULL memclk speed */
+#define MDREFR_MEMCLK_FULLSPEED_0
+#define MDREFR_MEMCLK_FULLSPEED_1
+#define MDREFR_MEMCLK_FULLSPEED_2
+
+/* Memory configuration */
+#ifdef BLOB_NEED_MEMCONFIG
+#define MSC0_VALUE_66_150	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(10) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC0_VALUE_66_120	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 8) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC0_VALUE_66_100	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 7) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC1_VALUE_66		MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1) | ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
+#define MSC2_VALUE_66		MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(13)  | MSC_RDN(6) | MSC_RRR(3)
+#define MECR_VALUE_66		MECR_BSIO0(0x1f) | MECR_BSA0(0x1f) | MECR_BSM0(0x1f) | MECR_BSIO1(0x1f) | MECR_BSA1(0x1f) | MECR_BSM1(0x1f)
+
+#define MSC0_VALUE_100_150	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(16) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC0_VALUE_100_120	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(13) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC0_VALUE_100_100	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(11) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC1_VALUE_100		MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1)| ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
+#define MSC2_VALUE_100		MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(13)  | MSC_RDN(6) | MSC_RRR(3)
+#define MECR_VALUE_100		MECR_BSIO0(0x1f) | MECR_BSA0(0x1f) | MECR_BSM0(0x1f) | MECR_BSIO1(0x1f) | MECR_BSA1(0x1f) | MECR_BSM1(0x1f)
+
+#define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(6) | MDCNFG_CDB20(0) | MDCNFG_TRP0(2) | MDCNFG_TDL0(3) | MDCNFG_TWR0(1) | \
+ 					MDCNFG_DTIM2_SDRAM | MDCNFG_DWID2_32B | MDCNFG_DRAC2(6) | MDCNFG_CDB22(0) | MDCNFG_TRP2(2) | MDCNFG_TDL2(3) | MDCNFG_TWR2(1)
+#define MDCAS00_VALUE	0xAAAAAA9F
+#define MDCAS01_VALUE	0xAAAAAAAA
+#define MDCAS02_VALUE	0xAAAAAAAA
+#define MDCAS20_VALUE	0xAAAAAA9F
+#define MDCAS21_VALUE	0xAAAAAAAA
+#define MDCAS22_VALUE	0xAAAAAAAA
+#define MSC0_VALUE	MSC0_VALUE_100_150
+#define MSC1_VALUE	MSC1_VALUE_100
+#define MSC2_VALUE	MSC2_VALUE_100
+#define MECR_VALUE	MECR_VALUE_100
+#define SMCNFG_VALUE	0
+#endif /* BLOB_NEED_MEMCONFIG */
+
+#define DAFIT_SYSID	(0x10000000)
+#define DAFIT_CTRL_0	(0x10000090)
+#define DAFIT_CTRL_1	(0x100000A0)
+#define DAFIT_CTRL_2	(0x100000B0)
+#define DAFIT_CTRL_IRR	(0x10000024)
+
+/* System ID register */
+#define PT_SYSID	(*((volatile u8 *)DAFIT_SYSID))
+#define PT_ID_BOARDID	(( PT_SYSID & 0xE0 ) >> 5 )
+#define PT_ID_REVISION	( PT_SYSID & 0x1F )
+
+#define PT_BOARD_ALPHA	( 0 )
+#define PT_BOARD_SYS3	( 1 )
+#define PT_BOARD_DAFIT	( 2 )
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/frodo.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/frodo.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/frodo.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,101 @@
+/*
+ * frodo.h: 2d3D, Inc. SA-1110 Development Board
+ *
+ * Copyright (C) 2001  Abraham van der Merwe <abraham@2d3d.co.za>
+ *
+ * $Id: frodo.h,v 1.11 2002/10/25 17:24:14 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: frodo.h,v 1.11 2002/10/25 17:24:14 erikm Exp $"
+
+#ifndef BLOB_ARCH_FRODO_H
+#define BLOB_ARCH_FRODO_H
+
+/* boot CPU speed */
+#define CPU_SPEED		(CPU_CORE_SPEED_206mhz)
+
+/*
+ * Serial port 1 is used for the Serial port w/ flow control.
+ */
+
+/* serial port */
+#define USE_SERIAL2
+#define TERMINAL_SPEED baud_9600
+
+/* GPIO for the LED */
+#define LED_GPIO			(0x00000000) /* no led (for now) */
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xc0200400)
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xc0100000)
+#define KERNEL_RAM_BASE		(0xc0008000)
+#define PARAM_RAM_BASE		(0xc0110000)
+#define RAMDISK_RAM_BASE	(0xc0400000)
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		0x00000000
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS			(0xc0000100)
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+/* Memory configuration */
+#ifdef BLOB_NEED_MEMCONFIG
+
+#define SMCNFG_VALUE	0x00000000
+#define MDCNFG_VALUE	0x0000a265
+
+#ifdef MDREFR_DONT_BELIEVE_IN_MAGIC
+#define MDREFR_VALUE	0x00700061
+#endif	/* #ifdef MDREFR_DONT_BELIEVE_IN_MAGIC */
+
+#define MDCAS00_VALUE	0x5555557f
+#define MDCAS01_VALUE	0x55555555
+#define MDCAS02_VALUE	0x55555555
+#define MSC0_VALUE		0x00004f70	/* nCS[1:0] 32-bit, flash */
+#define MSC1_VALUE		0x4f710000	/* nCS[3:2] 32-bit, daughter card */
+#define MSC2_VALUE		0x0000ef75	/* nCS[5:4] 16-bit, CPLDs, etc. */
+
+/*
+ * These are currently unused:
+ *
+ *      MECR_VALUE
+ *      MDCAS20_VALUE
+ *      MDCAS21_VALUE
+ *      MDCAS22_VALUE
+ */
+#define MECR_VALUE		0x994a994a
+#define MDCAS20_VALUE	0xaaaaaa7f
+#define MDCAS21_VALUE	0xaaaaaaaa
+#define MDCAS22_VALUE	0xaaaaaaaa
+
+#endif	/* #ifdef BLOB_NEED_MEMCONFIG */
+
+#endif	/* #ifndef BLOB_ARCH_FRODO_H */
Index: build_tree/bootLoader/include/blob/arch/h3600.h
diff -u build_tree/bootLoader/include/blob/arch/h3600.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/h3600.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/h3600.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/h3600.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: h3600.h,v 1.4 2001/11/04 23:04:37 erikm Exp $
+ * $Id: h3600.h,v 1.7 2002/02/27 18:41:48 timriker Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: h3600.h,v 1.4 2001/11/04 23:04:37 erikm Exp $"
+#ident "$Id: h3600.h,v 1.7 2002/02/27 18:41:48 timriker Exp $"
 
 #ifndef BLOB_ARCH_H3600_H
 #define BLOB_ARCH_H3600_H
@@ -35,6 +35,7 @@
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_115200
 
 
 /* GPIO for the LED */
@@ -59,6 +60,7 @@
 #define PARAM_FLASH_LEN		(256 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
 #define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
 #define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
 
Index: build_tree/bootLoader/include/blob/arch/hackkit.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/hackkit.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/hackkit.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,179 @@
+/*
+ * hackkit.h: hw defs for the hack kit.
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2002  Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * $Id: hackkit.h,v 1.1 2002/11/26 18:52:52 seletz Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: hackkit.h,v 1.1 2002/11/26 18:52:52 seletz Exp $"
+
+#ifndef BLOB_ARCH_HKIT_H
+#define BLOB_ARCH_HKIT_H
+
+#define	CPU_SPEED_133
+//#undef	CPU_SPEED_133
+
+/* boot CPU speed */
+#ifdef CPU_SPEED_133
+#	define CPU_SPEED		(CPU_CORE_SPEED_132mhz)
+#else
+#	define CPU_SPEED		(CPU_CORE_SPEED_206mhz)
+#endif
+
+/* serial port */
+#define USE_SERIAL1
+#define TERMINAL_SPEED baud_115200
+
+#define HKIT_LED_RED	(0x00400000) /* GPIO 22 */
+#define HKIT_LED_GRN	(0x00800000) /* GPIO 23 */
+
+/* GPIO for the LED */
+#define LED_GPIO		HKIT_LED_GRN
+
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xc0200400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xc0100000)
+#define KERNEL_RAM_BASE		(0xC0008000)
+#define PARAM_RAM_BASE		(0xc0110000)
+#define RAMDISK_RAM_BASE	(0xC0400000)
+
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(0x00040000)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define CONFIG_FLASH_BASE	(0x00040000)
+#define CONFIG_FLASH_LEN	(256 * 1024)
+#define KERNEL_FLASH_BASE	(0x00080000)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(0x00180000)
+#define RAMDISK_FLASH_LEN	(1536 * 1024)
+#define ROOTFS_FLASH_BASE	(0x00300000)
+#define ROOTFS_FLASH_LEN	(0x00600000) /* 6M */
+#define DATAFS_FLASH_BASE	(0x00900000)
+#define DATAFS_FLASH_LEN	(0x00700000) /* 7M */
+
+#define RAM_START			(0xc1000000)
+#define RAM_SIZE			(16*1024*1024)
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xc0000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+/* let SDRAM run at FULL memclk speed */
+#undef MDREFR_MEMCLK_FULLSPEED_0
+#undef MDREFR_MEMCLK_FULLSPEED_1
+#undef MDREFR_MEMCLK_FULLSPEED_2
+#if 0
+#define MDREFR_MEMCLK_FULLSPEED_0
+#define MDREFR_MEMCLK_FULLSPEED_1
+#define MDREFR_MEMCLK_FULLSPEED_2
+#endif
+
+/* Memory configuration */
+#ifdef BLOB_NEED_MEMCONFIG
+#define MSC0_VALUE_66_150	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(10) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC0_VALUE_66_120	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 8) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC0_VALUE_66_100	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 7) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC1_VALUE_66		MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1) | ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
+#define MSC2_VALUE_66		MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(13)  | MSC_RDN(6) | MSC_RRR(3)
+#define MECR_VALUE_66		MECR_BSIO0(0x1f) | MECR_BSA0(0x1f) | MECR_BSM0(0x1f) | MECR_BSIO1(0x1f) | MECR_BSA1(0x1f) | MECR_BSM1(0x1f)
+
+#define MSC0_VALUE_100_150	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(16) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC0_VALUE_100_120	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(13) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC0_VALUE_100_100	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(11) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC1_VALUE_100		MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1)| ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
+#define MSC2_VALUE_100		MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(13)  | MSC_RDN(6) | MSC_RRR(3)
+#define MECR_VALUE_100		MECR_BSIO0(0x1f) | MECR_BSA0(0x1f) | MECR_BSM0(0x1f) | MECR_BSIO1(0x1f) | MECR_BSA1(0x1f) | MECR_BSM1(0x1f)
+
+/* The Hack Kit core cpu board uses:
+ *	- SDRAM: 2x Samsung K4S561632C 256Mbit (4Mx16Bitx4banks)
+ *	- Flash:
+ *		32 bit version: 2x INTEL StrataFlash 28F128J3A
+ */
+
+#ifndef CPU_SPEED_133
+//	206 Mhz
+#define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(6) | MDCNFG_CDB20(0) |\
+				MDCNFG_TRP0(2) | MDCNFG_TDL0(3) | MDCNFG_TWR0(2)
+#if 0
+#define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(6) | MDCNFG_CDB20(0) | MDCNFG_TRP0(2) | MDCNFG_TDL0(3) | MDCNFG_TWR0(1) | \
+	MDCNFG_DTIM2_SDRAM | MDCNFG_DWID2_32B | MDCNFG_DRAC2(6) | MDCNFG_CDB22(0) | MDCNFG_TRP2(2) | MDCNFG_TDL2(3) | MDCNFG_TWR2(1)
+#endif
+#	define MDCAS00_VALUE	0xAAAAAA9F
+#	define MDCAS01_VALUE	0xAAAAAAAA
+#	define MDCAS02_VALUE	0xAAAAAAAA
+#	define MDCAS20_VALUE	0xAAAAAA9F
+#	define MDCAS21_VALUE	0xAAAAAAAA
+#	define MDCAS22_VALUE	0xAAAAAAAA
+#	define MSC0_VALUE	MSC0_VALUE_100_150
+#	define MSC1_VALUE	MSC1_VALUE_100
+#	define MSC2_VALUE	MSC2_VALUE_100
+#	define MECR_VALUE	MECR_VALUE_100
+#	define SMCNFG_VALUE	0
+#else
+/*
+133 Mhz
+ From the intel calculator:
+MDCNFG = 0000000000000000 10 11 0001 0 110 1 1 11 = 0x0000B16F 
+ => DRAC=6 TRP=1 TDL=3 TRW=2
+SMCNFG = 00000000000000000000000000000000 = 0x00000000 
+MDREFR = 0000000001110000 000000000100 0001 = 0x00700041 
+ => TRASR=1 DRI=4
+MDCAS00 = 01010101010101010101010101010111 = 0x55555557 
+MDCAS01 = 01010101010101010101010101010101 = 0x55555555 
+MDCAS02 = 01010101010101010101010101010101 = 0x55555555 
+
+MDCNFG = 0000000000000000 10 10 0001 0 110 1 1 11 = 0x0000A16F 
+DTIM0=1 DWID0=1 DRAC=6 CDB20=1 TRP=1 TDL=2 TRW=2
+SMCNFG = 00000000000000000000000000000000 = 0x00000000 
+MDREFR = 0000000001110000000000000100 0001 = 0x00700041 
+MDCAS00 = 01010101010101010101010101010111 = 0x55555557 
+MDCAS01 = 01010101010101010101010101010101 = 0x55555555 
+MDCAS02 = 01010101010101010101010101010101 = 0x55555555 
+
+*/
+
+#	define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(6) | MDCNFG_CDB20(0) |\
+				MDCNFG_TRP0(1) | MDCNFG_TDL0(2) | MDCNFG_TWR0(2)
+#	define MDCAS00_VALUE	0x55555557
+#	define MDCAS01_VALUE	0x55555555
+#	define MDCAS02_VALUE	0x55555555
+#	define MDCAS20_VALUE	0xAAAAAA9F
+#	define MDCAS21_VALUE	0xAAAAAAAA
+#	define MDCAS22_VALUE	0xAAAAAAAA
+#	define MSC0_VALUE	MSC0_VALUE_66_150
+#	define MSC1_VALUE	0
+#	define MSC2_VALUE	0
+#	define MECR_VALUE	0
+#	define SMCNFG_VALUE	0
+#endif
+#endif
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/idr.h
diff -u build_tree/bootLoader/include/blob/arch/idr.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/idr.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/idr.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/idr.h	Fri Nov  9 09:44:05 2007
@@ -19,19 +19,25 @@
  *
  */
 
-#ident "$Id: idr.h,v 1.2 2001/12/16 07:38:50 timriker Exp $"
+#ident "$Id: idr.h,v 1.13 2002/07/18 08:58:45 timriker Exp $"
 
 #ifndef BLOB_ARCH_IDR_H
 #define BLOB_ARCH_IDR_H
 
 /* boot CPU speed */
-#define CPU_SPEED		(0x05)
+//#define CPU_SPEED		(CPU_CORE_SPEED_206mhz)
+#define CPU_SPEED		(CPU_CORE_SPEED_191mhz)
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_115200
 
 /* GPIO for the LED */
-#define LED_GPIO		(0x00000000) /* safe mode: no GPIO, no LED */
+#define LED_GPIO		(0x00000002) /* AC power LED */
+
+/* need gpio on sa1111 to do flash_enable */
+#define	SA1111_BASE		(0x40000000)
+#define	SA1111_VBASE		(0x40000000)
 
 /* the base address were BLOB is loaded by the first stage loader */
 #define BLOB_ABS_BASE_ADDR	(0xc0200400)
@@ -44,13 +50,21 @@
 
 /* and where do they live in flash */
 #define BLOB_FLASH_BASE		(0x00000000)
-#define BLOB_FLASH_LEN		(256 * 1024)
+#define BLOB_FLASH_LEN		(128 * 1024)
 #define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
-#define PARAM_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_LEN		(0 * 1024) /* not used yet */
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
-#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define KERNEL_FLASH_LEN	((1024 - 128) * 1024)
+#define LOAD_RAMDISK		0 /* leave ramdisk in flash */
+
+#if defined(CONFIG_CRAMFS_SUPPORT) || defined(CONFIG_JFFS2_SUPPORT)
+/* kernel will be read directly from the ramdisk, so locations are the same */
+#define RAMDISK_FLASH_BASE	KERNEL_FLASH_BASE
+#define RAMDISK_FLASH_LEN	(16 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN)
+#else
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
-#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+#define RAMDISK_FLASH_LEN	(16 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN - KERNEL_FLASH_LEN)
+#endif
 
 /* the position of the kernel boot parameters */
 #define BOOT_PARAMS		(0xc0000100)
@@ -58,22 +72,27 @@
 /* the size (in kbytes) to which the compressed ramdisk expands */
 #define RAMDISK_SIZE		(8 * 1024)
 
+/* RAS0 ram */
+/* CS0 flash */
+/* CS3 Xilinx */
+/* CS4 sa1111 */
+/* CS5 lucent modem */
 /* Memory configuration */
 #ifdef BLOB_NEED_MEMCONFIG
 #warning "use defines from memsetup.h for better readability"
-#	define MDCNFG_VALUE	0x72347235		/* 0x0  MDCNFG */
-#	define MDCAS00_VALUE	0x55555557		/* 0x04 MDCAS00 */
+#	define MDCNFG_VALUE	0xb257b257		/* 0x0 MDCNFG 14 rows */
+#	define MDCAS00_VALUE	0x5555557F		/* 0x04 MDCAS00 */
 #	define MDCAS01_VALUE	0x55555555		/* 0x08 MDCAS01 */
 #	define MDCAS02_VALUE	0x55555555		/* 0x0c MDCAS02 */
-#	define MSC0_VALUE	0x00004B94		/* 0x10 MCS0 */
-#	define MSC1_VALUE	0x22212419		/* 0x14 MCS1 */
+#	define MSC0_VALUE	0x00004f74		/* 0x10 MCS0 */
+#	define MSC1_VALUE	0x4f714f71		/* 0x14 MCS1 */
 #	define MECR_VALUE	0x00000000		/* 0x18 MECR */
 #	define MDREFR_VALUE	DO_NOT_USE_THIS_VALUE__GETS_AUTOMAGICALLY_COMPUTED
-#	define MDCAS20_VALUE	0x55555557		/* 0x20 MDCAS20 */
+#	define MDCAS20_VALUE	0x5555557F		/* 0x20 MDCAS20 */
 #	define MDCAS21_VALUE	0x55555555		/* 0x24 MDCAS21 */
 #	define MDCAS22_VALUE	0x55555555		/* 0x28 MDCAS22 */
-#	define MSC2_VALUE	0x44396669		/* 0x2C MCS2 */
-#	define SMCNFG_VALUE	0xA040A040		/* 0x30 SMCNFG */
+#	define MSC2_VALUE	0x66694f71		/* 0x2C MCS2 */
+#	define SMCNFG_VALUE	0x00000000		/* 0x30 SMCNFG */
 #endif
 
 #endif
Index: build_tree/bootLoader/include/blob/arch/jornada720.h
diff -u build_tree/bootLoader/include/blob/arch/jornada720.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/jornada720.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/jornada720.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/jornada720.h	Fri Nov  9 09:44:05 2007
@@ -4,7 +4,7 @@
  * Copyright (C) 2001  Hewlett-Packard Company
  * Written by Christopher Hoover <ch@hpl.hp.com>
  *
- * $Id: jornada720.h,v 1.1 2001/12/27 18:27:37 erikm Exp $
+ * $Id: jornada720.h,v 1.6 2002/05/13 19:55:13 choover Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -22,7 +22,7 @@
  *
  */
 
-#ident "$Id: jornada720.h,v 1.1 2001/12/27 18:27:37 erikm Exp $"
+#ident "$Id: jornada720.h,v 1.6 2002/05/13 19:55:13 choover Exp $"
 
 #ifndef BLOB_ARCH_JORNADA720_H
 #define BLOB_ARCH_JORNADA720_H
@@ -31,11 +31,12 @@
 
 
 /* boot CPU speed */
-#define CPU_SPEED		(0x09)
+#define CPU_SPEED		CPU_CORE_SPEED_206mhz
 
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_115200
 
 
 /* GPIO for the LED */
@@ -51,19 +52,21 @@
 #define BLOB_RAM_BASE		(0xc0100000)
 #define KERNEL_RAM_BASE		(0xC0008000)
 #define PARAM_RAM_BASE		(0xc0110000)
-#define RAMDISK_RAM_BASE	(0xC0400000)
+#define RAMDISK_RAM_BASE	(0xC0600000)
 
 /* and where do they live in flash */
 #define BLOB_FLASH_BASE		(0x00000000)
-#define BLOB_FLASH_LEN		(128 * 1024)
+#define BLOB_FLASH_LEN		(1 * 256 * 1024)
 #define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
-#define PARAM_FLASH_LEN		(128 * 1024)
+#define PARAM_FLASH_LEN		(1 * 256 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
-#define KERNEL_FLASH_LEN	(1 * 1024 * 1024)
+#define KERNEL_FLASH_LEN	(4 * 256 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
-#define RAMDISK_FLASH_LEN	(2 * 1024 * 1024)
+#define RAMDISK_FLASH_LEN	(8 * 256 * 1024)
 
-#define PARAM_START PARAM_RAM_BASE
+#define PARAM_START PARAM_FLASH_BASE
+#define PARAM_LEN PARAM_FLASH_LEN
 
 /* the position of the kernel boot parameters */
 #define BOOT_PARAMS		(0xc0000100)
@@ -118,7 +121,8 @@
 #  define MSC0_VALUE	JORNADA720_MSC0		/* 0x10 MSC0 */
 #  define MSC1_VALUE	JORNADA720_MSC1		/* 0x14 MSC1 */
 #  define MECR_VALUE	0x98c698c6		/* 0x18 MECR */
-#  define MDREFR_VALUE	DO_NOT_USE_THIS_VALUE__GETS_AUTOMAGICALLY_COMPUTED
+#  define MDREFR_DONT_BELIEVE_IN_MAGIC
+#  define MDREFR_VALUE	0x307402a1		/* 0x1C MDREFR */
 #  define MDCAS20_VALUE	0xd1284142		/* 0x20 MDCAS20 */
 #  define MDCAS21_VALUE	0x72249529		/* 0x24 MDCAS21 */
 #  define MDCAS22_VALUE	0x78414351		/* 0x28 MDCAS22 */
Index: build_tree/bootLoader/include/blob/arch/lart.h
diff -u build_tree/bootLoader/include/blob/arch/lart.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/lart.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/lart.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/lart.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: lart.h,v 1.3 2001/11/04 23:04:37 erikm Exp $
+ * $Id: lart.h,v 1.6 2002/02/27 18:41:48 timriker Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: lart.h,v 1.3 2001/11/04 23:04:37 erikm Exp $"
+#ident "$Id: lart.h,v 1.6 2002/02/27 18:41:48 timriker Exp $"
 
 #ifndef BLOB_ARCH_LART_H
 #define BLOB_ARCH_LART_H
@@ -35,6 +35,7 @@
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_9600
 
 
 /* GPIO for the LED */
@@ -59,6 +60,7 @@
 #define PARAM_FLASH_LEN		(64 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
 #define KERNEL_FLASH_LEN	((1024 - 128) * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
 #define RAMDISK_FLASH_LEN	(4 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN - KERNEL_FLASH_LEN)
 
Index: build_tree/bootLoader/include/blob/arch/lubbock.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/lubbock.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/lubbock.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,126 @@
+/*
+ * lubbock.h: Lubbock specific defines
+ *
+ * Copyright (C) 2002 Intel Corporation
+ * Written by Rusty Geldmacher (russell.r.geldmacher@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_ARCH_LUBBOCK_H
+#define BLOB_ARCH_LUBBOCK_H
+
+/* boot CPU speed */
+#define CPU_SPEED		(0x0b)
+
+/* Use FFUART */
+#define USE_SERIAL1	1
+#define TERMINAL_SPEED	baud_115200
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xa0200400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xa0100000)
+#define KERNEL_RAM_BASE		(0xa0008000)
+#define PARAM_RAM_BASE		(0xa0110000)
+#define RAMDISK_RAM_BASE	(0xa0400000)
+
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xa0000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+
+/* GPIO settings */
+#undef GPSR0_VALUE
+#undef GPSR1_VALUE
+#undef GPSR2_VALUE
+#undef GPDR0_VALUE
+#undef GPDR1_VALUE
+#undef GPDR2_VALUE
+#undef GPCR0_VALUE
+#undef GPCR1_VALUE
+#undef GPCR2_VALUE
+#undef GAFR0_L_VALUE
+#undef GAFR0_U_VALUE
+#undef GAFR1_L_VALUE
+#undef GAFR1_U_VALUE
+#undef GAFR2_L_VALUE
+#undef GAFR2_U_VALUE
+
+#define GPSR0_VALUE	0x00008000
+#define GPSR1_VALUE	0x00FC0382
+#define GPSR2_VALUE	0x0001FFFF
+
+#define GPDR0_VALUE	0x0060A800
+#define GPDR1_VALUE	0x00FF0382
+#define GPDR2_VALUE	0x0001C000
+
+#define GPCR0_VALUE	0x00000000
+#define GPCR1_VALUE	0x00000000
+#define GPCR2_VALUE	0x00000000
+
+#define GAFR0_L_VALUE	0x98400000
+#define GAFR0_U_VALUE	0x00002950
+#define GAFR1_L_VALUE	0x000A9558
+#define GAFR1_U_VALUE	0x0005AAAA
+#define GAFR2_L_VALUE	0xA0000000
+#define GAFR2_U_VALUE	0x00000002
+
+/* Memory configuration */
+#define MDCNFG_VALUE	0x00001AC9
+#define MDREFR_VALUE	0x00018018 
+#define MDMRS_VALUE	0x00000000
+
+#define MSC0_VAL	0x23D223D2
+#define MSC1_VAL	0x3FF1A441
+#define MSC2_VAL	0x7FF17FF1
+
+/* TFTP download RAM base */
+#define TFTP_RAM_START	0xa1000000
+
+/* FPGA */
+#define LUB_FPGA_BASE	0x08000000
+#define LUB_LEDHEX	__REG(LUB_FPGA_BASE + 0x10)
+#define LUB_LEDCTL	__REG(LUB_FPGA_BASE + 0x40)
+#define LUB_USERSW	__REG(LUB_FPGA_BASE + 0x60)
+
+/* LED */
+#define LED_ADDR	(LUB_FPGA_BASE + 0x40)
+#define LED_ON		(0x00FE)
+#define LED_OFF		(0x00FF)
+
+/* SMC91c96 */
+#define SMC_BASE	(0x0c000000)
+
+#endif 
Index: build_tree/bootLoader/include/blob/arch/mainstone.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/mainstone.h:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/mainstone.h	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,165 @@
+/* Z2 */
+/*
+ * mainstone.h: Mainstone specific defines
+ *
+ * Copyright (C) 2002 Intel Corporation (yu.tang@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_ARCH_MAINSTONE_H
+#define BLOB_ARCH_MAINSTONE_H
+
+/* Use SSUART */
+#define USE_SERIAL3	1
+#define TERMINAL_SPEED	baud_115200
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xa0300400)
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xa0200000)
+#define KERNEL_RAM_BASE		(0xa0008000)
+#define PARAM_RAM_BASE		(0xa0210000)
+#define RAMDISK_RAM_BASE	(0xa0500000)
+
+
+/* and where do they live in flash */
+// 
+// Phil 02-02-06
+// Increased ramdisk from 1MB to 4MB
+// JWK Fixed for Z2
+
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(64 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(0) /* no parameters */
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(0x230000)
+#define LOAD_RAMDISK		0 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(0x5C0000)
+
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xa0000100)
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(10 * 1024)
+
+
+/* GPIO settings */
+
+//
+// Phil 02-02-06
+// Updated to reflect Orderite GPIO map
+//
+#undef GPSR0_VALUE
+#undef GPSR1_VALUE
+#undef GPSR2_VALUE
+#undef GPSR3_VALUE
+#undef GPDR0_VALUE
+#undef GPDR1_VALUE
+#undef GPDR2_VALUE
+#undef GPDR3_VALUE
+#undef GPCR0_VALUE
+#undef GPCR1_VALUE
+#undef GPCR2_VALUE
+#undef GPCR3_VALUE
+#undef GAFR0_L_VALUE
+#undef GAFR0_U_VALUE
+#undef GAFR1_L_VALUE
+#undef GAFR1_U_VALUE
+#undef GAFR2_L_VALUE
+#undef GAFR2_U_VALUE
+#undef GAFR3_L_VALUE
+#undef GAFR3_U_VALUE
+
+#define GPSR0_VALUE	0x06088000
+#define GPSR1_VALUE	0x006F0000
+#define GPSR2_VALUE	0x00000000
+#define GPSR3_VALUE	0x00000388
+
+#define GPCR0_VALUE	0x00000000
+#define GPCR1_VALUE	0x00000380
+#define GPCR2_VALUE	0x00000000
+#define GPCR3_VALUE	0x00000000
+
+#define GPDR0_VALUE	0xDBFBDE40
+#define GPDR1_VALUE	0xFCFF8AB3
+#define GPDR2_VALUE	0x6DE3FFFF
+#define GPDR3_VALUE	0x001F1FAE
+
+#define GAFR0_L_VALUE	0x84000141
+#define GAFR0_U_VALUE	0X591A8012
+#define GAFR1_L_VALUE	0X61988002
+#define GAFR1_U_VALUE	0XAAA580AA
+#define GAFR2_L_VALUE	0x0AA0000A
+#define GAFR2_U_VALUE	0X01004400
+#define GAFR3_L_VALUE	0X54013300
+#define GAFR3_U_VALUE	0X00001405
+
+/* Memory configuration */
+#define MDREFR_VALUE	0x00000018
+// Was 1E
+#define MDCNFG_VALUE	0x00000AA9
+// Was AC9 then AA9
+/*
+1010 1010 1001
+7		1=4 internal SDRAM banks
+6:5		01 = 12 rows
+4:3		01 = 9 columns
+2		0 = bus width = 32
+1		0 = Enable for partition 1
+0		1 = Enable for partition 0
+*/
+
+#define MDMRS_VALUE	0x00000000
+
+/* #define MSC0_MS_VALUE   (0x23F838F8)
+#define MSC0_VALUE	0x7FF07FFA
+*/
+
+#define MSC0_VALUE	0x7FF07FFA
+#define MSC1_VALUE	0x0000A691
+#define MSC2_VALUE	0x0000B884
+
+/* TFTP download RAM base */
+#define TFTP_RAM_START	0xa1000000
+
+/* FPGA */
+/*
+#define MST_FPGA_BASE	0x08000000
+#define MST_LEDDAT1	__REG(MST_FPGA_BASE + 0x10)
+#define MST_LEDCTL	__REG(MST_FPGA_BASE + 0x40)
+#define MST_GPSWR	__REG(MST_FPGA_BASE + 0x60)
+#define MST_MSCWR1	__REG(MST_FPGA_BASE + 0x80)
+#define MST_MSCWR2	__REG(MST_FPGA_BASE + 0x84)
+*/
+
+/* USB client Soft-connect bit */
+#define MST_USBC_SC     (0x1<<4)
+
+/* LED */
+/* #define LED_ADDR	(MST_FPGA_BASE + 0x40)
+#define LED_ON		(0x00FE)
+#define LED_OFF		(0x00FF)
+*/
+
+/* SMC91c111 */
+#define SMC_BASE	(0xa10000300)
+
+#endif 
Index: build_tree/bootLoader/include/blob/arch/miniprint.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/miniprint.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/miniprint.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,84 @@
+/*
+ * miniprint.h: miniprint specific defines
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2002  Urs Kaufmann <u_kaufmann@bluewin.ch>
+ * Copyright (C) 2002  Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: miniprint.h,v 1.1 2002/05/27 13:05:03 seletz Exp $"
+
+#ifndef BLOB_ARCH_MINIPRINT_H
+#define BLOB_ARCH_MINIPRINT_H
+
+/* boot CPU speed */
+#define CPU_SPEED		CPU_CORE_SPEED_206mhz	
+
+/* serial port */
+#define USE_SERIAL3
+
+#define TERMINAL_SPEED baud_9600
+
+/* GPIO for the LED */
+#define LED_GPIO		(0x00000000) /* No LEDs */
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xc0200400)
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xc0100000)
+#define KERNEL_RAM_BASE		(0xC0008000)
+#define PARAM_RAM_BASE		(0xc0110000)
+#define RAMDISK_RAM_BASE	(0xC0400000)
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE         (0x00000000)
+#define BLOB_FLASH_LEN          (256 * 1024)
+#define PARAM_FLASH_BASE        (BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN         (256 * 1024)
+#define KERNEL_FLASH_BASE       (PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN        (1024 * 1024)
+#define LOAD_RAMDISK            1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE      (KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN       (4 * 1024 * 1024)
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xc0000100)
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+/* Memory configuration */
+#ifdef BLOB_NEED_MEMCONFIG
+#warning "use defines from memsetup.h for better readability"
+#	define MDCNFG_VALUE  	0x0000b255		/* 0x0  MDCNFG */
+#	define MDCAS00_VALUE	0xAAAAAA9F		/* 0x04 MDCAS00 */
+#	define MDCAS01_VALUE	0xAAAAAAAA		/* 0x08 MDCAS01 */
+#	define MDCAS02_VALUE	0xAAAAAAAA		/* 0x0c MDCAS02 */
+#	define MSC0_VALUE	0x63726372		/* 0x10 MCS0 */
+#	define MSC1_VALUE	0x2225fff9		/* 0x14 MCS1 */
+#	define MECR_VALUE	0x21082108		/* 0x18 MECR  8-state Acces IO/Attr/Mem FAST = off (both Slots)*/
+#	define MDREFR_VALUE	DO_NOT_USE_THIS_VALUE__GETS_AUTOMAGICALLY_COMPUTED
+#	define MDCAS20_VALUE	0xAAAAAA9F		/* 0x20 MDCAS20 */
+#	define MDCAS21_VALUE	0xAAAAAAAA		/* 0x24 MDCAS21 */
+#	define MDCAS22_VALUE	0xAAAAAAAA		/* 0x28 MDCAS22 */
+#	define MSC2_VALUE	0xfff8fff8		/* 0x2C MCS2 */
+#	define SMCNFG_VALUE	0x00000000		/* 0x30 SMCNFG No SROM*/
+#endif
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/nesa.h
diff -u build_tree/bootLoader/include/blob/arch/nesa.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/nesa.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/nesa.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/nesa.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: nesa.h,v 1.3 2001/11/04 23:04:37 erikm Exp $
+ * $Id: nesa.h,v 1.8 2002/02/27 18:41:48 timriker Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: nesa.h,v 1.3 2001/11/04 23:04:37 erikm Exp $"
+#ident "$Id: nesa.h,v 1.8 2002/02/27 18:41:48 timriker Exp $"
 
 #ifndef BLOB_ARCH_NESA_H
 #define BLOB_ARCH_NESA_H
@@ -36,6 +36,7 @@
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_9600
 
 
 /* GPIO for the LED */
@@ -54,16 +55,20 @@
 
 
 /* and where do they live in flash */
-#warning "Please check NESA default flash layout!"
 #define BLOB_FLASH_BASE		(0x00000000)
-#define BLOB_FLASH_LEN		(64 * 1024)
-#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
-#define PARAM_FLASH_LEN		(64 * 1024)
+#define BLOB_FLASH_LEN		(2 * 16 * 1024)
+#define CONFIG_FLASH_LEN	(2 * 2 * 8 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN + CONFIG_FLASH_LEN)
+#define PARAM_FLASH_LEN		(2 * 32 * 1024)
+#define NESA_ERASE_BLOCK	(2 * 64 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
-#define KERNEL_FLASH_LEN	((1024 - 128) * 1024)
+#define KERNEL_FLASH_LEN	(NESA_ERASE_BLOCK * 3)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
-#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN - KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(NESA_ERASE_BLOCK * (32 - 4))
 
+#define PARAM_START PARAM_FLASH_BASE
+#define PARAM_LEN PARAM_FLASH_LEN
 
 /* the position of the kernel boot parameters */
 #define BOOT_PARAMS		(0xc0000100)
Index: build_tree/bootLoader/include/blob/arch/pleb.h
diff -u build_tree/bootLoader/include/blob/arch/pleb.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/pleb.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/pleb.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/pleb.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: pleb.h,v 1.3 2001/11/04 23:04:37 erikm Exp $
+ * $Id: pleb.h,v 1.6 2002/02/27 18:41:48 timriker Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: pleb.h,v 1.3 2001/11/04 23:04:37 erikm Exp $"
+#ident "$Id: pleb.h,v 1.6 2002/02/27 18:41:48 timriker Exp $"
 
 #ifndef BLOB_ARCH_PLEB_H
 #define BLOB_ARCH_PLEB_H
@@ -36,6 +36,7 @@
 
 /* serial port */
 #define USE_SERIAL3
+#define TERMINAL_SPEED baud_9600
 
 
 /* GPIO for the LED */
@@ -61,6 +62,7 @@
 #define PARAM_FLASH_LEN		(64 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
 #define KERNEL_FLASH_LEN	((1024 - 128) * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
 #define RAMDISK_FLASH_LEN	(4 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN - KERNEL_FLASH_LEN)
 
Index: build_tree/bootLoader/include/blob/arch/pxa-regs.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/pxa-regs.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/pxa-regs.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,1388 @@
+/*
+ *  linux/include/asm-arm/arch-pxa/pxa-regs.h
+ *  
+ *  Author:	Nicolas Pitre
+ *  Created:	Jun 15, 2001
+ *  Copyright:	MontaVista Software Inc.
+ *  
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+#ifndef _PXA_REGS_H_
+#define _PXA_REGS_H_
+
+#include <blob/bitfield.h>
+
+
+// FIXME hack so that SA-1111.h will work [cb]
+
+#ifndef __ASSEMBLY__
+typedef unsigned short  Word16 ;
+typedef unsigned int    Word32 ;
+typedef Word32          Word ;
+typedef Word            Quad [4] ;
+typedef void            *Address ;
+typedef void            (*ExcpHndlr) (void) ;
+#endif
+
+/*
+ * PXA Chip selects
+ */
+
+#define PXA_CS0_PHYS	0x00000000
+#define PXA_CS1_PHYS	0x04000000
+#define PXA_CS2_PHYS	0x08000000
+#define PXA_CS3_PHYS	0x0C000000
+#define PXA_CS4_PHYS	0x10000000
+#define PXA_CS5_PHYS	0x14000000
+
+/*
+ * PXA SDRAM banks
+ */
+
+#define PXA_SDRAM_BANK0	0xa0000000
+#define PXA_SDRAM_BANK1	0xa4000000
+#define PXA_SDRAM_BANK2	0xa8000000
+#define PXA_SDRAM_BANK3	0xac000000
+
+/*
+ * Personal Computer Memory Card International Association (PCMCIA) sockets
+ */
+
+#define PCMCIAPrtSp	0x04000000	/* PCMCIA Partition Space [byte]   */
+#define PCMCIASp	(4*PCMCIAPrtSp)	/* PCMCIA Space [byte]             */
+#define PCMCIAIOSp	PCMCIAPrtSp	/* PCMCIA I/O Space [byte]         */
+#define PCMCIAAttrSp	PCMCIAPrtSp	/* PCMCIA Attribute Space [byte]   */
+#define PCMCIAMemSp	PCMCIAPrtSp	/* PCMCIA Memory Space [byte]      */
+
+#define PCMCIA0Sp	PCMCIASp	/* PCMCIA 0 Space [byte]           */
+#define PCMCIA0IOSp	PCMCIAIOSp	/* PCMCIA 0 I/O Space [byte]       */
+#define PCMCIA0AttrSp	PCMCIAAttrSp	/* PCMCIA 0 Attribute Space [byte] */
+#define PCMCIA0MemSp	PCMCIAMemSp	/* PCMCIA 0 Memory Space [byte]    */
+
+#define PCMCIA1Sp	PCMCIASp	/* PCMCIA 1 Space [byte]           */
+#define PCMCIA1IOSp	PCMCIAIOSp	/* PCMCIA 1 I/O Space [byte]       */
+#define PCMCIA1AttrSp	PCMCIAAttrSp	/* PCMCIA 1 Attribute Space [byte] */
+#define PCMCIA1MemSp	PCMCIAMemSp	/* PCMCIA 1 Memory Space [byte]    */
+
+#define _PCMCIA(Nb)	        	/* PCMCIA [0..1]                   */ \
+                	(0x20000000 + (Nb)*PCMCIASp)
+#define _PCMCIAIO(Nb)	_PCMCIA (Nb)	/* PCMCIA I/O [0..1]               */
+#define _PCMCIAAttr(Nb)	        	/* PCMCIA Attribute [0..1]         */ \
+                	(_PCMCIA (Nb) + 2*PCMCIAPrtSp)
+#define _PCMCIAMem(Nb)	        	/* PCMCIA Memory [0..1]            */ \
+                	(_PCMCIA (Nb) + 3*PCMCIAPrtSp)
+
+#define _PCMCIA0	_PCMCIA (0)	/* PCMCIA 0                        */
+#define _PCMCIA0IO	_PCMCIAIO (0)	/* PCMCIA 0 I/O                    */
+#define _PCMCIA0Attr	_PCMCIAAttr (0)	/* PCMCIA 0 Attribute              */
+#define _PCMCIA0Mem	_PCMCIAMem (0)	/* PCMCIA 0 Memory                 */
+
+#define _PCMCIA1	_PCMCIA (1)	/* PCMCIA 1                        */
+#define _PCMCIA1IO	_PCMCIAIO (1)	/* PCMCIA 1 I/O                    */
+#define _PCMCIA1Attr	_PCMCIAAttr (1)	/* PCMCIA 1 Attribute              */
+#define _PCMCIA1Mem	_PCMCIAMem (1)	/* PCMCIA 1 Memory                 */
+
+
+
+/*
+ * DMA Controller
+ */
+
+#define DCSR0		__REG(0x40000000)  /* DMA Control / Status Register for Channel 0 */
+#define DCSR1		__REG(0x40000004)  /* DMA Control / Status Register for Channel 1 */
+#define DCSR2		__REG(0x40000008)  /* DMA Control / Status Register for Channel 2 */
+#define DCSR3		__REG(0x4000000c)  /* DMA Control / Status Register for Channel 3 */
+#define DCSR4		__REG(0x40000010)  /* DMA Control / Status Register for Channel 4 */
+#define DCSR5		__REG(0x40000014)  /* DMA Control / Status Register for Channel 5 */
+#define DCSR6		__REG(0x40000018)  /* DMA Control / Status Register for Channel 6 */
+#define DCSR7		__REG(0x4000001c)  /* DMA Control / Status Register for Channel 7 */
+#define DCSR8		__REG(0x40000020)  /* DMA Control / Status Register for Channel 8 */
+#define DCSR9		__REG(0x40000024)  /* DMA Control / Status Register for Channel 9 */
+#define DCSR10		__REG(0x40000028)  /* DMA Control / Status Register for Channel 10 */
+#define DCSR11		__REG(0x4000002c)  /* DMA Control / Status Register for Channel 11 */
+#define DCSR12		__REG(0x40000030)  /* DMA Control / Status Register for Channel 12 */
+#define DCSR13		__REG(0x40000034)  /* DMA Control / Status Register for Channel 13 */
+#define DCSR14		__REG(0x40000038)  /* DMA Control / Status Register for Channel 14 */
+#define DCSR15		__REG(0x4000003c)  /* DMA Control / Status Register for Channel 15 */
+
+#define DCSR(x)		__REG2(0x40000000, (x) << 2)
+
+#define DCSR_RUN	(1 << 31)	/* Run Bit (read / write) */
+#define DCSR_NODESC	(1 << 30)	/* No-Descriptor Fetch (read / write) */
+#define DCSR_STOPIRQEN	(1 << 29)	/* Stop Interrupt Enable (read / write) */
+#define DCSR_REQPEND	(1 << 8)	/* Request Pending (read-only) */
+#define DCSR_STOPSTATE	(1 << 3)	/* Stop State (read-only) */
+#define DCSR_ENDINTR	(1 << 2)	/* End Interrupt (read / write) */
+#define DCSR_STARTINTR	(1 << 1)	/* Start Interrupt (read / write) */
+#define DCSR_BUSERR	(1 << 0)	/* Bus Error Interrupt (read / write) */
+
+#define DINT		__REG(0x400000f0)  /* DMA Interrupt Register */
+
+#define DRCMR0		__REG(0x40000100)  /* Request to Channel Map Register for DREQ 0 */
+#define DRCMR1		__REG(0x40000104)  /* Request to Channel Map Register for DREQ 1 */
+#define DRCMR2		__REG(0x40000108)  /* Request to Channel Map Register for I2S receive Request */
+#define DRCMR3		__REG(0x4000010c)  /* Request to Channel Map Register for I2S transmit Request */
+#define DRCMR4		__REG(0x40000110)  /* Request to Channel Map Register for BTUART receive Request */
+#define DRCMR5		__REG(0x40000114)  /* Request to Channel Map Register for BTUART transmit Request. */
+#define DRCMR6		__REG(0x40000118)  /* Request to Channel Map Register for FFUART receive Request */
+#define DRCMR7		__REG(0x4000011c)  /* Request to Channel Map Register for FFUART transmit Request */
+#define DRCMR8		__REG(0x40000120)  /* Request to Channel Map Register for AC97 microphone Request */
+#define DRCMR9		__REG(0x40000124)  /* Request to Channel Map Register for AC97 modem receive Request */
+#define DRCMR10		__REG(0x40000128)  /* Request to Channel Map Register for AC97 modem transmit Request */
+#define DRCMR11		__REG(0x4000012c)  /* Request to Channel Map Register for AC97 audio receive Request */
+#define DRCMR12		__REG(0x40000130)  /* Request to Channel Map Register for AC97 audio transmit Request */
+#define DRCMR13		__REG(0x40000134)  /* Request to Channel Map Register for SSP receive Request */
+#define DRCMR14		__REG(0x40000138)  /* Request to Channel Map Register for SSP transmit Request */
+#define DRCMR15		__REG(0x4000013c)  /* Reserved */
+#define DRCMR16		__REG(0x40000140)  /* Reserved */
+#define DRCMR17		__REG(0x40000144)  /* Request to Channel Map Register for ICP receive Request */
+#define DRCMR18		__REG(0x40000148)  /* Request to Channel Map Register for ICP transmit Request */
+#define DRCMR19		__REG(0x4000014c)  /* Request to Channel Map Register for STUART receive Request */
+#define DRCMR20		__REG(0x40000150)  /* Request to Channel Map Register for STUART transmit Request */
+#define DRCMR21		__REG(0x40000154)  /* Request to Channel Map Register for MMC receive Request */
+#define DRCMR22		__REG(0x40000158)  /* Request to Channel Map Register for MMC transmit Request */
+#define DRCMR23		__REG(0x4000015c)  /* Reserved */
+#define DRCMR24		__REG(0x40000160)  /* Reserved */
+#define DRCMR25		__REG(0x40000164)  /* Request to Channel Map Register for USB endpoint 1 Request */
+#define DRCMR26		__REG(0x40000168)  /* Request to Channel Map Register for USB endpoint 2 Request */
+#define DRCMR27		__REG(0x4000016C)  /* Request to Channel Map Register for USB endpoint 3 Request */
+#define DRCMR28		__REG(0x40000170)  /* Request to Channel Map Register for USB endpoint 4 Request */
+#define DRCMR29		__REG(0x40000174)  /* Reserved */
+#define DRCMR30		__REG(0x40000178)  /* Request to Channel Map Register for USB endpoint 6 Request */
+#define DRCMR31		__REG(0x4000017C)  /* Request to Channel Map Register for USB endpoint 7 Request */
+#define DRCMR32		__REG(0x40000180)  /* Request to Channel Map Register for USB endpoint 8 Request */
+#define DRCMR33		__REG(0x40000184)  /* Request to Channel Map Register for USB endpoint 9 Request */
+#define DRCMR34		__REG(0x40000188)  /* Reserved */
+#define DRCMR35		__REG(0x4000018C)  /* Request to Channel Map Register for USB endpoint 11 Request */
+#define DRCMR36		__REG(0x40000190)  /* Request to Channel Map Register for USB endpoint 12 Request */
+#define DRCMR37		__REG(0x40000194)  /* Request to Channel Map Register for USB endpoint 13 Request */
+#define DRCMR38		__REG(0x40000198)  /* Request to Channel Map Register for USB endpoint 14 Request */
+#define DRCMR39		__REG(0x4000019C)  /* Reserved */
+
+#define DRCMRRXSADR	DRCMR2
+#define DRCMRTXSADR	DRCMR3
+#define DRCMRRXBTRBR	DRCMR4
+#define DRCMRTXBTTHR	DRCMR5
+#define DRCMRRXFFRBR	DRCMR6
+#define DRCMRTXFFTHR	DRCMR7
+#define DRCMRRXMCDR	DRCMR8
+#define DRCMRRXMODR	DRCMR9
+#define DRCMRTXMODR	DRCMR10
+#define DRCMRRXPCDR	DRCMR11
+#define DRCMRTXPCDR	DRCMR12
+#define DRCMRRXSSDR	DRCMR13
+#define DRCMRTXSSDR	DRCMR14
+#define DRCMRRXICDR	DRCMR17
+#define DRCMRTXICDR	DRCMR18
+#define DRCMRRXSTRBR	DRCMR19
+#define DRCMRTXSTTHR	DRCMR20
+#define DRCMRRXMMC	DRCMR21
+#define DRCMRTXMMC	DRCMR22
+
+#define DRCMR_MAPVLD	(1 << 7)	/* Map Valid (read / write) */
+#define DRCMR_CHLNUM	0x0f		/* mask for Channel Number (read / write) */
+
+#define DDADR0		__REG(0x40000200)  /* DMA Descriptor Address Register Channel 0 */
+#define DSADR0		__REG(0x40000204)  /* DMA Source Address Register Channel 0 */
+#define DTADR0		__REG(0x40000208)  /* DMA Target Address Register Channel 0 */
+#define DCMD0		__REG(0x4000020c)  /* DMA Command Address Register Channel 0 */
+#define DDADR1		__REG(0x40000210)  /* DMA Descriptor Address Register Channel 1 */
+#define DSADR1		__REG(0x40000214)  /* DMA Source Address Register Channel 1 */
+#define DTADR1		__REG(0x40000218)  /* DMA Target Address Register Channel 1 */
+#define DCMD1		__REG(0x4000021c)  /* DMA Command Address Register Channel 1 */
+#define DDADR2		__REG(0x40000220)  /* DMA Descriptor Address Register Channel 2 */
+#define DSADR2		__REG(0x40000224)  /* DMA Source Address Register Channel 2 */
+#define DTADR2		__REG(0x40000228)  /* DMA Target Address Register Channel 2 */
+#define DCMD2		__REG(0x4000022c)  /* DMA Command Address Register Channel 2 */
+#define DDADR3		__REG(0x40000230)  /* DMA Descriptor Address Register Channel 3 */
+#define DSADR3		__REG(0x40000234)  /* DMA Source Address Register Channel 3 */
+#define DTADR3		__REG(0x40000238)  /* DMA Target Address Register Channel 3 */
+#define DCMD3		__REG(0x4000023c)  /* DMA Command Address Register Channel 3 */
+#define DDADR4		__REG(0x40000240)  /* DMA Descriptor Address Register Channel 4 */
+#define DSADR4		__REG(0x40000244)  /* DMA Source Address Register Channel 4 */
+#define DTADR4		__REG(0x40000248)  /* DMA Target Address Register Channel 4 */
+#define DCMD4		__REG(0x4000024c)  /* DMA Command Address Register Channel 4 */
+#define DDADR5		__REG(0x40000250)  /* DMA Descriptor Address Register Channel 5 */
+#define DSADR5		__REG(0x40000254)  /* DMA Source Address Register Channel 5 */
+#define DTADR5		__REG(0x40000258)  /* DMA Target Address Register Channel 5 */
+#define DCMD5		__REG(0x4000025c)  /* DMA Command Address Register Channel 5 */
+#define DDADR6		__REG(0x40000260)  /* DMA Descriptor Address Register Channel 6 */
+#define DSADR6		__REG(0x40000264)  /* DMA Source Address Register Channel 6 */
+#define DTADR6		__REG(0x40000268)  /* DMA Target Address Register Channel 6 */
+#define DCMD6		__REG(0x4000026c)  /* DMA Command Address Register Channel 6 */
+#define DDADR7		__REG(0x40000270)  /* DMA Descriptor Address Register Channel 7 */
+#define DSADR7		__REG(0x40000274)  /* DMA Source Address Register Channel 7 */
+#define DTADR7		__REG(0x40000278)  /* DMA Target Address Register Channel 7 */
+#define DCMD7		__REG(0x4000027c)  /* DMA Command Address Register Channel 7 */
+#define DDADR8		__REG(0x40000280)  /* DMA Descriptor Address Register Channel 8 */
+#define DSADR8		__REG(0x40000284)  /* DMA Source Address Register Channel 8 */
+#define DTADR8		__REG(0x40000288)  /* DMA Target Address Register Channel 8 */
+#define DCMD8		__REG(0x4000028c)  /* DMA Command Address Register Channel 8 */
+#define DDADR9		__REG(0x40000290)  /* DMA Descriptor Address Register Channel 9 */
+#define DSADR9		__REG(0x40000294)  /* DMA Source Address Register Channel 9 */
+#define DTADR9		__REG(0x40000298)  /* DMA Target Address Register Channel 9 */
+#define DCMD9		__REG(0x4000029c)  /* DMA Command Address Register Channel 9 */
+#define DDADR10		__REG(0x400002a0)  /* DMA Descriptor Address Register Channel 10 */
+#define DSADR10		__REG(0x400002a4)  /* DMA Source Address Register Channel 10 */
+#define DTADR10		__REG(0x400002a8)  /* DMA Target Address Register Channel 10 */
+#define DCMD10		__REG(0x400002ac)  /* DMA Command Address Register Channel 10 */
+#define DDADR11		__REG(0x400002b0)  /* DMA Descriptor Address Register Channel 11 */
+#define DSADR11		__REG(0x400002b4)  /* DMA Source Address Register Channel 11 */
+#define DTADR11		__REG(0x400002b8)  /* DMA Target Address Register Channel 11 */
+#define DCMD11		__REG(0x400002bc)  /* DMA Command Address Register Channel 11 */
+#define DDADR12		__REG(0x400002c0)  /* DMA Descriptor Address Register Channel 12 */
+#define DSADR12		__REG(0x400002c4)  /* DMA Source Address Register Channel 12 */
+#define DTADR12		__REG(0x400002c8)  /* DMA Target Address Register Channel 12 */
+#define DCMD12		__REG(0x400002cc)  /* DMA Command Address Register Channel 12 */
+#define DDADR13		__REG(0x400002d0)  /* DMA Descriptor Address Register Channel 13 */
+#define DSADR13		__REG(0x400002d4)  /* DMA Source Address Register Channel 13 */
+#define DTADR13		__REG(0x400002d8)  /* DMA Target Address Register Channel 13 */
+#define DCMD13		__REG(0x400002dc)  /* DMA Command Address Register Channel 13 */
+#define DDADR14		__REG(0x400002e0)  /* DMA Descriptor Address Register Channel 14 */
+#define DSADR14		__REG(0x400002e4)  /* DMA Source Address Register Channel 14 */
+#define DTADR14		__REG(0x400002e8)  /* DMA Target Address Register Channel 14 */
+#define DCMD14		__REG(0x400002ec)  /* DMA Command Address Register Channel 14 */
+#define DDADR15		__REG(0x400002f0)  /* DMA Descriptor Address Register Channel 15 */
+#define DSADR15		__REG(0x400002f4)  /* DMA Source Address Register Channel 15 */
+#define DTADR15		__REG(0x400002f8)  /* DMA Target Address Register Channel 15 */
+#define DCMD15		__REG(0x400002fc)  /* DMA Command Address Register Channel 15 */
+
+#define DDADR(x)	__REG2(0x40000200, (x) << 4)
+#define DSADR(x)	__REG2(0x40000204, (x) << 4)
+#define DTADR(x)	__REG2(0x40000208, (x) << 4)
+#define DCMD(x)		__REG2(0x4000020c, (x) << 4)
+
+#define DDADR_DESCADDR	0xfffffff0	/* Address of next descriptor (mask) */
+#define DDADR_STOP	(1 << 0)	/* Stop (read / write) */
+
+#define DCMD_INCSRCADDR	(1 << 31)	/* Source Address Increment Setting. */
+#define DCMD_INCTRGADDR	(1 << 30)	/* Target Address Increment Setting. */
+#define DCMD_FLOWSRC	(1 << 29)	/* Flow Control by the source. */
+#define DCMD_FLOWTRG	(1 << 28)	/* Flow Control by the target. */
+#define DCMD_STARTIRQEN	(1 << 22)	/* Start Interrupt Enable */
+#define DCMD_ENDIRQEN	(1 << 21)	/* End Interrupt Enable */
+#define DCMD_ENDIAN	(1 << 18)	/* Device Endian-ness. */
+#define DCMD_BURST8	(1 << 16)	/* 8 byte burst */
+#define DCMD_BURST16	(2 << 16)	/* 16 byte burst */
+#define DCMD_BURST32	(3 << 16)	/* 32 byte burst */
+#define DCMD_WIDTH1	(1 << 14)	/* 1 byte width */
+#define DCMD_WIDTH2	(2 << 14)	/* 2 byte width (HalfWord) */
+#define DCMD_WIDTH4	(3 << 14)	/* 4 byte width (Word) */
+#define DCMD_LENGTH	0x01fff		/* length mask (max = 8K - 1) */
+
+/* default combinations */
+#define DCMD_RXPCDR	(DCMD_INCTRGADDR|DCMD_FLOWSRC|DCMD_BURST32|DCMD_WIDTH4)
+#define DCMD_RXMCDR	(DCMD_INCTRGADDR|DCMD_FLOWSRC|DCMD_BURST32|DCMD_WIDTH4)
+#define DCMD_TXPCDR	(DCMD_INCSRCADDR|DCMD_FLOWTRG|DCMD_BURST32|DCMD_WIDTH4)
+
+
+/*
+ * UARTs
+ */
+
+/* Full Function UART (FFUART) */
+#define FFUART		FFRBR
+#define FFRBR		__REG(0x40100000)  /* Receive Buffer Register (read only) */
+#define FFTHR		__REG(0x40100000)  /* Transmit Holding Register (write only) */
+#define FFIER		__REG(0x40100004)  /* Interrupt Enable Register (read/write) */
+#define FFIIR		__REG(0x40100008)  /* Interrupt ID Register (read only) */
+#define FFFCR		__REG(0x40100008)  /* FIFO Control Register (write only) */
+#define FFLCR		__REG(0x4010000C)  /* Line Control Register (read/write) */
+#define FFMCR		__REG(0x40100010)  /* Modem Control Register (read/write) */
+#define FFLSR		__REG(0x40100014)  /* Line Status Register (read only) */
+#define FFMSR		__REG(0x40100018)  /* Modem Status Register (read only) */
+#define FFSPR		__REG(0x4010001C)  /* Scratch Pad Register (read/write) */
+#define FFISR		__REG(0x40100020)  /* Infrared Selection Register (read/write) */
+#define FFDLL		__REG(0x40100000)  /* Divisor Latch Low Register (DLAB = 1) (read/write) */
+#define FFDLH		__REG(0x40100004)  /* Divisor Latch High Register (DLAB = 1) (read/write) */
+
+/* Bluetooth UART (BTUART) */
+#define BTUART		BTRBR
+#define BTRBR		__REG(0x40200000)  /* Receive Buffer Register (read only) */
+#define BTTHR		__REG(0x40200000)  /* Transmit Holding Register (write only) */
+#define BTIER		__REG(0x40200004)  /* Interrupt Enable Register (read/write) */
+#define BTIIR		__REG(0x40200008)  /* Interrupt ID Register (read only) */
+#define BTFCR		__REG(0x40200008)  /* FIFO Control Register (write only) */
+#define BTLCR		__REG(0x4020000C)  /* Line Control Register (read/write) */
+#define BTMCR		__REG(0x40200010)  /* Modem Control Register (read/write) */
+#define BTLSR		__REG(0x40200014)  /* Line Status Register (read only) */
+#define BTMSR		__REG(0x40200018)  /* Modem Status Register (read only) */
+#define BTSPR		__REG(0x4020001C)  /* Scratch Pad Register (read/write) */
+#define BTISR		__REG(0x40200020)  /* Infrared Selection Register (read/write) */
+#define BTDLL		__REG(0x40200000)  /* Divisor Latch Low Register (DLAB = 1) (read/write) */
+#define BTDLH		__REG(0x40200004)  /* Divisor Latch High Register (DLAB = 1) (read/write) */
+
+/* Standard UART (STUART) */
+#define STUART		STRBR
+#define STRBR		__REG(0x40700000)  /* Receive Buffer Register (read only) */
+#define STTHR		__REG(0x40700000)  /* Transmit Holding Register (write only) */
+#define STIER		__REG(0x40700004)  /* Interrupt Enable Register (read/write) */
+#define STIIR		__REG(0x40700008)  /* Interrupt ID Register (read only) */
+#define STFCR		__REG(0x40700008)  /* FIFO Control Register (write only) */
+#define STLCR		__REG(0x4070000C)  /* Line Control Register (read/write) */
+#define STMCR		__REG(0x40700010)  /* Modem Control Register (read/write) */
+#define STLSR		__REG(0x40700014)  /* Line Status Register (read only) */
+#define STMSR		__REG(0x40700018)  /* Reserved */
+#define STSPR		__REG(0x4070001C)  /* Scratch Pad Register (read/write) */
+#define STISR		__REG(0x40700020)  /* Infrared Selection Register (read/write) */
+#define STDLL		__REG(0x40700000)  /* Divisor Latch Low Register (DLAB = 1) (read/write) */
+#define STDLH		__REG(0x40700004)  /* Divisor Latch High Register (DLAB = 1) (read/write) */
+
+#define IER_DMAE	(1 << 7)	/* DMA Requests Enable */
+#define IER_UUE		(1 << 6)	/* UART Unit Enable */
+#define IER_NRZE	(1 << 5)	/* NRZ coding Enable */
+#define IER_RTIOE	(1 << 4)	/* Receiver Time Out Interrupt Enable */
+#define IER_MIE		(1 << 3)	/* Modem Interrupt Enable */
+#define IER_RLSE	(1 << 2)	/* Receiver Line Status Interrupt Enable */
+#define IER_TIE		(1 << 1)	/* Transmit Data request Interrupt Enable */
+#define IER_RAVIE	(1 << 0)	/* Receiver Data Available Interrupt Enable */
+
+#define IIR_FIFOES1	(1 << 7)	/* FIFO Mode Enable Status */
+#define IIR_FIFOES0	(1 << 6)	/* FIFO Mode Enable Status */
+#define IIR_TOD		(1 << 3)	/* Time Out Detected */
+#define IIR_IID2	(1 << 2)	/* Interrupt Source Encoded */
+#define IIR_IID1	(1 << 1)	/* Interrupt Source Encoded */
+#define IIR_IP		(1 << 0)	/* Interrupt Pending (active low) */
+
+#define FCR_ITL2	(1 << 7)	/* Interrupt Trigger Level */
+#define FCR_ITL1	(1 << 6)	/* Interrupt Trigger Level */
+#define FCR_RESETTF	(1 << 2)	/* Reset Transmitter FIFO */
+#define FCR_RESETRF	(1 << 1)	/* Reset Receiver FIFO */
+#define FCR_TRFIFOE	(1 << 0)	/* Transmit and Receive FIFO Enable */
+#define FCR_ITL_1	(0)
+#define FCR_ITL_8	(FCR_ITL1)
+#define FCR_ITL_16	(FCR_ITL2)
+#define FCR_ITL_32	(FCR_ITL2|FCR_ITL1)
+
+#define LCR_DLAB	(1 << 7)	/* Divisor Latch Access Bit */
+#define LCR_SB		(1 << 6)	/* Set Break */
+#define LCR_STKYP	(1 << 5)	/* Sticky Parity */
+#define LCR_EPS		(1 << 4)	/* Even Parity Select */
+#define LCR_PEN		(1 << 3)	/* Parity Enable */
+#define LCR_STB		(1 << 2)	/* Stop Bit */
+#define LCR_WLS1	(1 << 1)	/* Word Length Select */
+#define LCR_WLS0	(1 << 0)	/* Word Length Select */
+
+#define LSR_FIFOE	(1 << 7)	/* FIFO Error Status */
+#define LSR_TEMT	(1 << 6)	/* Transmitter Empty */
+#define LSR_TDRQ	(1 << 5)	/* Transmit Data Request */
+#define LSR_BI		(1 << 4)	/* Break Interrupt */
+#define LSR_FE		(1 << 3)	/* Framing Error */
+#define LSR_PE		(1 << 2)	/* Parity Error */
+#define LSR_OE		(1 << 1)	/* Overrun Error */
+#define LSR_DR		(1 << 0)	/* Data Ready */
+
+#define MCR_LOOP	(1 << 4)	*/ 
+#define MCR_OUT2	(1 << 3)	/* force MSR_DCD in loopback mode */
+#define MCR_OUT1	(1 << 2)	/* force MSR_RI in loopback mode */
+#define MCR_RTS		(1 << 1)	/* Request to Send */
+#define MCR_DTR		(1 << 0)	/* Data Terminal Ready */
+
+#define MSR_DCD		(1 << 7)	/* Data Carrier Detect */
+#define MSR_RI		(1 << 6)	/* Ring Indicator */
+#define MSR_DSR		(1 << 5)	/* Data Set Ready */
+#define MSR_CTS		(1 << 4)	/* Clear To Send */
+#define MSR_DDCD	(1 << 3)	/* Delta Data Carrier Detect */
+#define MSR_TERI	(1 << 2)	/* Trailing Edge Ring Indicator */
+#define MSR_DDSR	(1 << 1)	/* Delta Data Set Ready */
+#define MSR_DCTS	(1 << 0)	/* Delta Clear To Send */
+
+/*
+ * IrSR (Infrared Selection Register)
+ */
+#define STISR_RXPL      (1 << 4)        /* Receive Data Polarity */
+#define STISR_TXPL      (1 << 3)        /* Transmit Data Polarity */
+#define STISR_XMODE     (1 << 2)        /* Transmit Pulse Width Select */
+#define STISR_RCVEIR    (1 << 1)        /* Receiver SIR Enable */
+#define STISR_XMITIR    (1 << 0)        /* Transmitter SIR Enable */
+
+
+/*
+ * I2C registers
+ */
+
+#define IBMR		__REG(0x40301680)  /* I2C Bus Monitor Register - IBMR */
+#define IDBR		__REG(0x40301688)  /* I2C Data Buffer Register - IDBR */
+#define ICR		__REG(0x40301690)  /* I2C Control Register - ICR */
+#define ISR		__REG(0x40301698)  /* I2C Status Register - ISR */
+#define ISAR		__REG(0x403016A0)  /* I2C Slave Address Register - ISAR */
+
+#define ICR_START	(1 << 0)	   /* start bit */
+#define ICR_STOP	(1 << 1)	   /* stop bit */
+#define ICR_ACKNAK	(1 << 2)	   /* send ACK(0) or NAK(1) */
+#define ICR_TB		(1 << 3)	   /* transfer byte bit */
+#define ICR_MA		(1 << 4)	   /* master abort */
+#define ICR_SCLE	(1 << 5)	   /* master clock enable */
+#define ICR_IUE		(1 << 6)	   /* unit enable */
+#define ICR_GCD		(1 << 7)	   /* general call disable */
+#define ICR_ITEIE	(1 << 8)	   /* enable tx interrupts */
+#define ICR_IRFIE	(1 << 9)	   /* enable rx interrupts */
+#define ICR_BEIE	(1 << 10)	   /* enable bus error ints */
+#define ICR_SSDIE	(1 << 11)	   /* slave STOP detected int enable */
+#define ICR_ALDIE	(1 << 12)	   /* enable arbitration interrupt */
+#define ICR_SADIE	(1 << 13)	   /* slave address detected int enable */
+#define ICR_UR		(1 << 14)	   /* unit reset */
+
+#define ISR_RWM		(1 << 0)	   /* read/write mode */
+#define ISR_ACKNAK	(1 << 1)	   /* ack/nak status */
+#define ISR_UB		(1 << 2)	   /* unit busy */
+#define ISR_IBB		(1 << 3)	   /* bus busy */	
+#define ISR_SSD		(1 << 4)	   /* slave stop detected */
+#define ISR_ALD		(1 << 5)	   /* arbitration loss detected */
+#define ISR_ITE		(1 << 6)	   /* tx buffer empty */
+#define ISR_IRF		(1 << 7)	   /* rx buffer full */
+#define ISR_GCAD	(1 << 8)	   /* general call address detected */
+#define ISR_SAD		(1 << 9)	   /* slave address detected */
+#define ISR_BED		(1 << 10)	   /* bus error no ACK/NAK */
+
+
+/*
+ * Serial Audio Controller
+ */
+
+/* FIXME: This clash with SA1111 defines */
+#ifndef CONFIG_SA1111
+#define SACR0		__REG(0x40400000)  /* Global Control Register */
+#define SACR1		__REG(0x40400004)  /* Serial Audio I 2 S/MSB-Justified Control Register */
+#define SASR0		__REG(0x4040000C)  /* Serial Audio I 2 S/MSB-Justified Interface and FIFO Status Register */
+#define SAIMR		__REG(0x40400014)  /* Serial Audio Interrupt Mask Register */
+#define SAICR		__REG(0x40400018)  /* Serial Audio Interrupt Clear Register */
+#define SADIV		__REG(0x40400060)  /* Audio Clock Divider Register. */
+#define SADR		__REG(0x40400080)  /* Serial Audio Data Register (TX and RX FIFO access Register). */
+#endif
+
+
+/*
+ * AC97 Controller registers
+ */
+
+#define POCR		__REG(0x40500000)  /* PCM Out Control Register */
+#define POCR_FEIE	(1 << 3)	/* FIFO Error Interrupt Enable */
+
+#define PICR		__REG(0x40500004)  /* PCM In Control Register */
+#define PICR_FEIE	(1 << 3)	/* FIFO Error Interrupt Enable */
+
+#define MCCR		__REG(0x40500008)  /* Mic In Control Register */
+#define MCCR_FEIE	(1 << 3)	/* FIFO Error Interrupt Enable */
+
+#define GCR		__REG(0x4050000C)  /* Global Control Register */
+#define GCR_CDONE_IE	(1 << 19)	/* Command Done Interrupt Enable */
+#define GCR_SDONE_IE	(1 << 18)	/* Status Done Interrupt Enable */
+#define GCR_SECRDY_IEN	(1 << 9)	/* Secondary Ready Interrupt Enable */
+#define GCR_PRIRDY_IEN	(1 << 8)	/* Primary Ready Interrupt Enable */
+#define GCR_SECRES_IEN	(1 << 5)	/* Secondary Resume Interrupt Enable */
+#define GCR_PRIRES_IEN	(1 << 4)	/* Primary Resume Interrupt Enable */
+#define GCR_ACLINK_OFF	(1 << 3)	/* AC-link Shut Off */
+#define GCR_WARM_RST	(1 << 2)	/* AC97 Warm Reset */
+#define GCR_COLD_RST	(1 << 1)	/* AC'97 Cold Reset (0 = active) */
+#define GCR_GIE		(1 << 0)	/* Codec GPI Interrupt Enable */
+
+#define POSR		__REG(0x40500010)  /* PCM Out Status Register */
+#define POSR_FIFOE	(1 << 4)	/* FIFO error */
+
+#define PISR		__REG(0x40500014)  /* PCM In Status Register */
+#define PISR_FIFOE	(1 << 4)	/* FIFO error */
+
+#define MCSR		__REG(0x40500018)  /* Mic In Status Register */
+#define MCSR_FIFOE	(1 << 4)	/* FIFO error */
+
+#define GSR		__REG(0x4050001C)  /* Global Status Register */
+#define GSR_CDONE	(1 << 19)	/* Command Done */
+#define GSR_SDONE	(1 << 18)	/* Status Done */
+#define GSR_RDCS	(1 << 15)	/* Read Completion Status */
+#define GSR_BIT3SLT12	(1 << 14)	/* Bit 3 of slot 12 */
+#define GSR_BIT2SLT12	(1 << 13)	/* Bit 2 of slot 12 */
+#define GSR_BIT1SLT12	(1 << 12)	/* Bit 1 of slot 12 */
+#define GSR_SECRES	(1 << 11)	/* Secondary Resume Interrupt */
+#define GSR_PRIRES	(1 << 10)	/* Primary Resume Interrupt */
+#define GSR_SCR		(1 << 9)	/* Secondary Codec Ready */
+#define GSR_PCR		(1 << 8)	/*  Primary Codec Ready */
+#define GSR_MINT	(1 << 7)	/* Mic In Interrupt */
+#define GSR_POINT	(1 << 6)	/* PCM Out Interrupt */
+#define GSR_PIINT	(1 << 5)	/* PCM In Interrupt */
+#define GSR_MOINT	(1 << 2)	/* Modem Out Interrupt */
+#define GSR_MIINT	(1 << 1)	/* Modem In Interrupt */
+#define GSR_GSCI	(1 << 0)	/* Codec GPI Status Change Interrupt */
+
+#define CAR		__REG(0x40500020)  /* CODEC Access Register */
+#define CAR_CAIP	(1 << 0)	/* Codec Access In Progress */
+
+#define PCDR		__REG(0x40500040)  /* PCM FIFO Data Register */
+#define MCDR		__REG(0x40500060)  /* Mic-in FIFO Data Register */
+
+#define MOCR		__REG(0x40500100)  /* Modem Out Control Register */
+#define MOCR_FEIE	(1 << 3)	/* FIFO Error */
+
+#define MICR		__REG(0x40500108)  /* Modem In Control Register */
+#define MICR_FEIE	(1 << 3)	/* FIFO Error */
+
+#define MOSR		__REG(0x40500110)  /* Modem Out Status Register */
+#define MOSR_FIFOE	(1 << 4)	/* FIFO error */
+
+#define MISR		__REG(0x40500118)  /* Modem In Status Register */
+#define MISR_FIFOE	(1 << 4)	/* FIFO error */
+
+#define MODR		__REG(0x40500140)  /* Modem FIFO Data Register */
+
+#define PAC_REG_BASE	__REG(0x40500200)  /* Primary Audio Codec */
+#define SAC_REG_BASE	__REG(0x40500300)  /* Secondary Audio Codec */
+#define PMC_REG_BASE	__REG(0x40500400)  /* Primary Modem Codec */
+#define SMC_REG_BASE	__REG(0x40500500)  /* Secondary Modem Codec */
+
+
+/*
+ * USB Device Controller
+ */
+#define UDC_RES1	__REG(0x40600004)  /* UDC Undocumented - Reserved1 */
+#define UDC_RES2	__REG(0x40600008)  /* UDC Undocumented - Reserved2 */
+#define UDC_RES3	__REG(0x4060000C)  /* UDC Undocumented - Reserved3 */
+
+#define UDCCR		__REG(0x40600000)  /* UDC Control Register */
+#define UDCCR_UDE	(1 << 0)	/* UDC enable */
+#define UDCCR_UDA	(1 << 1)	/* UDC active */
+#define UDCCR_RSM	(1 << 2)	/* Device resume */
+#define UDCCR_RESIR	(1 << 3)	/* Resume interrupt request */
+#define UDCCR_SUSIR	(1 << 4)	/* Suspend interrupt request */
+#define UDCCR_SRM	(1 << 5)	/* Suspend/resume interrupt mask */
+#define UDCCR_RSTIR	(1 << 6)	/* Reset interrupt request */
+#define UDCCR_REM	(1 << 7)	/* Reset interrupt mask */
+
+#define UDCCS0		__REG(0x40600010)  /* UDC Endpoint 0 Control/Status Register */
+#define UDCCS0_OPR	(1 << 0)	/* OUT packet ready */
+#define UDCCS0_IPR	(1 << 1)	/* IN packet ready */
+#define UDCCS0_FTF	(1 << 2)	/* Flush Tx FIFO */
+#define UDCCS0_DRWF	(1 << 3)	/* Device remote wakeup feature */
+#define UDCCS0_SST	(1 << 4)	/* Sent stall */
+#define UDCCS0_FST	(1 << 5)	/* Force stall */
+#define UDCCS0_RNE	(1 << 6)	/* Receive FIFO no empty */
+#define UDCCS0_SA	(1 << 7)	/* Setup active */
+
+/* Bulk IN - Endpoint 1,6,11 */
+#define UDCCS1		__REG(0x40600014)  /* UDC Endpoint 1 (IN) Control/Status Register */
+#define UDCCS6		__REG(0x40600028)  /* UDC Endpoint 6 (IN) Control/Status Register */
+#define UDCCS11		__REG(0x4060003C)  /* UDC Endpoint 11 (IN) Control/Status Register */
+
+#define UDCCS_BI_TFS	(1 << 0)	/* Transmit FIFO service */
+#define UDCCS_BI_TPC	(1 << 1)	/* Transmit packet complete */
+#define UDCCS_BI_FTF	(1 << 2)	/* Flush Tx FIFO */
+#define UDCCS_BI_TUR	(1 << 3)	/* Transmit FIFO underrun */
+#define UDCCS_BI_SST	(1 << 4)	/* Sent stall */
+#define UDCCS_BI_FST	(1 << 5)	/* Force stall */
+#define UDCCS_BI_TSP	(1 << 7)	/* Transmit short packet */
+
+/* Bulk OUT - Endpoint 2,7,12 */
+#define UDCCS2		__REG(0x40600018)  /* UDC Endpoint 2 (OUT) Control/Status Register */
+#define UDCCS7		__REG(0x4060002C)  /* UDC Endpoint 7 (OUT) Control/Status Register */
+#define UDCCS12		__REG(0x40600040)  /* UDC Endpoint 12 (OUT) Control/Status Register */
+
+#define UDCCS_BO_RFS	(1 << 0)	/* Receive FIFO service */
+#define UDCCS_BO_RPC	(1 << 1)	/* Receive packet complete */
+#define UDCCS_BO_DME	(1 << 3)	/* DMA enable */
+#define UDCCS_BO_SST	(1 << 4)	/* Sent stall */
+#define UDCCS_BO_FST	(1 << 5)	/* Force stall */
+#define UDCCS_BO_RNE	(1 << 6)	/* Receive FIFO not empty */
+#define UDCCS_BO_RSP	(1 << 7)	/* Receive short packet */
+
+/* Isochronous IN - Endpoint 3,8,13 */
+#define UDCCS3		__REG(0x4060001C)  /* UDC Endpoint 3 (IN) Control/Status Register */
+#define UDCCS8		__REG(0x40600030)  /* UDC Endpoint 8 (IN) Control/Status Register */
+#define UDCCS13		__REG(0x40600044)  /* UDC Endpoint 13 (IN) Control/Status Register */
+
+#define UDCCS_II_TFS	(1 << 0)	/* Transmit FIFO service */
+#define UDCCS_II_TPC	(1 << 1)	/* Transmit packet complete */
+#define UDCCS_II_FTF	(1 << 2)	/* Flush Tx FIFO */
+#define UDCCS_II_TUR	(1 << 3)	/* Transmit FIFO underrun */
+#define UDCCS_II_TSP	(1 << 7)	/* Transmit short packet */
+
+/* Isochronous OUT - Endpoint 4,9,14 */
+#define UDCCS4		__REG(0x40600020)  /* UDC Endpoint 4 (OUT) Control/Status Register */
+#define UDCCS9		__REG(0x40600034)  /* UDC Endpoint 9 (OUT) Control/Status Register */
+#define UDCCS14		__REG(0x40600048)  /* UDC Endpoint 14 (OUT) Control/Status Register */
+
+#define UDCCS_IO_RFS	(1 << 0)	/* Receive FIFO service */
+#define UDCCS_IO_RPC	(1 << 1)	/* Receive packet complete */
+#define UDCCS_IO_ROF	(1 << 3)	/* Receive overflow */
+#define UDCCS_IO_DME	(1 << 3)	/* DMA enable */
+#define UDCCS_IO_RNE	(1 << 6)	/* Receive FIFO not empty */
+#define UDCCS_IO_RSP	(1 << 7)	/* Receive short packet */
+
+/* Interrupt IN - Endpoint 5,10,15 */
+#define UDCCS5		__REG(0x40600024)  /* UDC Endpoint 5 (Interrupt) Control/Status Register */
+#define UDCCS10		__REG(0x40600038)  /* UDC Endpoint 10 (Interrupt) Control/Status Register */
+#define UDCCS15		__REG(0x4060004C)  /* UDC Endpoint 15 (Interrupt) Control/Status Register */
+
+#define UDCCS_INT_TFS	(1 << 0)	/* Transmit FIFO service */
+#define UDCCS_INT_TPC	(1 << 1)	/* Transmit packet complete */
+#define UDCCS_INT_FTF	(1 << 2)	/* Flush Tx FIFO */
+#define UDCCS_INT_TUR	(1 << 3)	/* Transmit FIFO underrun */
+#define UDCCS_INT_SST	(1 << 4)	/* Sent stall */
+#define UDCCS_INT_FST	(1 << 5)	/* Force stall */
+#define UDCCS_INT_TSP	(1 << 7)	/* Transmit short packet */
+
+#define UFNRH		__REG(0x40600060)  /* UDC Frame Number Register High */
+#define UFNRL		__REG(0x40600064)  /* UDC Frame Number Register Low */
+#define UBCR2		__REG(0x40600068)  /* UDC Byte Count Reg 2 */
+#define UBCR4		__REG(0x4060006c)  /* UDC Byte Count Reg 4 */
+#define UBCR7		__REG(0x40600070)  /* UDC Byte Count Reg 7 */
+#define UBCR9		__REG(0x40600074)  /* UDC Byte Count Reg 9 */
+#define UBCR12		__REG(0x40600078)  /* UDC Byte Count Reg 12 */
+#define UBCR14		__REG(0x4060007c)  /* UDC Byte Count Reg 14 */
+#define UDDR0		__REG(0x40600080)  /* UDC Endpoint 0 Data Register */
+#define UDDR1		__REG(0x40600100)  /* UDC Endpoint 1 Data Register */
+#define UDDR2		__REG(0x40600180)  /* UDC Endpoint 2 Data Register */
+#define UDDR3		__REG(0x40600200)  /* UDC Endpoint 3 Data Register */
+#define UDDR4		__REG(0x40600400)  /* UDC Endpoint 4 Data Register */
+#define UDDR5		__REG(0x406000A0)  /* UDC Endpoint 5 Data Register */
+#define UDDR6		__REG(0x40600600)  /* UDC Endpoint 6 Data Register */
+#define UDDR7		__REG(0x40600680)  /* UDC Endpoint 7 Data Register */
+#define UDDR8		__REG(0x40600700)  /* UDC Endpoint 8 Data Register */
+#define UDDR9		__REG(0x40600900)  /* UDC Endpoint 9 Data Register */
+#define UDDR10		__REG(0x406000C0)  /* UDC Endpoint 10 Data Register */
+#define UDDR11		__REG(0x40600B00)  /* UDC Endpoint 11 Data Register */
+#define UDDR12		__REG(0x40600B80)  /* UDC Endpoint 12 Data Register */
+#define UDDR13		__REG(0x40600C00)  /* UDC Endpoint 13 Data Register */
+#define UDDR14		__REG(0x40600E00)  /* UDC Endpoint 14 Data Register */
+#define UDDR15		__REG(0x406000E0)  /* UDC Endpoint 15 Data Register */
+
+#define UICR0		__REG(0x40600050)  /* UDC Interrupt Control Register 0 */
+
+#define UICR0_IM0	(1 << 0)	/* Interrupt mask ep 0 */
+#define UICR0_IM1	(1 << 1)	/* Interrupt mask ep 1 */
+#define UICR0_IM2	(1 << 2)	/* Interrupt mask ep 2 */
+#define UICR0_IM3	(1 << 3)	/* Interrupt mask ep 3 */
+#define UICR0_IM4	(1 << 4)	/* Interrupt mask ep 4 */
+#define UICR0_IM5	(1 << 5)	/* Interrupt mask ep 5 */
+#define UICR0_IM6	(1 << 6)	/* Interrupt mask ep 6 */
+#define UICR0_IM7	(1 << 7)	/* Interrupt mask ep 7 */
+
+#define UICR1		__REG(0x40600054)  /* UDC Interrupt Control Register 1 */
+
+#define UICR1_IM8	(1 << 0)	/* Interrupt mask ep 8 */
+#define UICR1_IM9	(1 << 1)	/* Interrupt mask ep 9 */
+#define UICR1_IM10	(1 << 2)	/* Interrupt mask ep 10 */
+#define UICR1_IM11	(1 << 3)	/* Interrupt mask ep 11 */
+#define UICR1_IM12	(1 << 4)	/* Interrupt mask ep 12 */
+#define UICR1_IM13	(1 << 5)	/* Interrupt mask ep 13 */
+#define UICR1_IM14	(1 << 6)	/* Interrupt mask ep 14 */
+#define UICR1_IM15	(1 << 7)	/* Interrupt mask ep 15 */
+
+#define USIR0		__REG(0x40600058)  /* UDC Status Interrupt Register 0 */
+
+#define USIR0_IR0	(1 << 0)	/* Interrup request ep 0 */
+#define USIR0_IR1	(1 << 1)	/* Interrup request ep 1 */
+#define USIR0_IR2	(1 << 2)	/* Interrup request ep 2 */
+#define USIR0_IR3	(1 << 3)	/* Interrup request ep 3 */
+#define USIR0_IR4	(1 << 4)	/* Interrup request ep 4 */
+#define USIR0_IR5	(1 << 5)	/* Interrup request ep 5 */
+#define USIR0_IR6	(1 << 6)	/* Interrup request ep 6 */
+#define USIR0_IR7	(1 << 7)	/* Interrup request ep 7 */
+
+#define USIR1		__REG(0x4060005C)  /* UDC Status Interrupt Register 1 */
+
+#define USIR1_IR8	(1 << 0)	/* Interrup request ep 8 */
+#define USIR1_IR9	(1 << 1)	/* Interrup request ep 9 */
+#define USIR1_IR10	(1 << 2)	/* Interrup request ep 10 */
+#define USIR1_IR11	(1 << 3)	/* Interrup request ep 11 */
+#define USIR1_IR12	(1 << 4)	/* Interrup request ep 12 */
+#define USIR1_IR13	(1 << 5)	/* Interrup request ep 13 */
+#define USIR1_IR14	(1 << 6)	/* Interrup request ep 14 */
+#define USIR1_IR15	(1 << 7)	/* Interrup request ep 15 */
+
+
+/*
+ * Fast Infrared Communication Port
+ */
+
+#define ICCR0		__REG(0x40800000)  /* ICP Control Register 0 */
+#define ICCR1		__REG(0x40800004)  /* ICP Control Register 1 */
+#define ICCR2		__REG(0x40800008)  /* ICP Control Register 2 */
+#define ICDR		__REG(0x4080000c)  /* ICP Data Register */
+#define ICSR0		__REG(0x40800014)  /* ICP Status Register 0 */
+#define ICSR1		__REG(0x40800018)  /* ICP Status Register 1 */
+
+#define ICCR0_AME       (1 << 7)           /* Adress match enable */
+#define ICCR0_TIE       (1 << 6)           /* Transmit FIFO interrupt enable */ 
+#define ICCR0_RIE       (1 << 5)           /* Recieve FIFO interrupt enable */
+#define ICCR0_RXE       (1 << 4)           /* Receive enable */
+#define ICCR0_TXE       (1 << 3)           /* Transmit enable */
+#define ICCR0_TUS       (1 << 2)           /* Transmit FIFO underrun select */
+#define ICCR0_LBM       (1 << 1)           /* Loopback mode */
+#define ICCR0_ITR       (1 << 0)           /* IrDA transmission */
+
+#define ICSR0_FRE       (1 << 5)           /* Framing error */
+#define ICSR0_RFS       (1 << 4)           /* Receive FIFO service request */
+#define ICSR0_TFS       (1 << 3)           /* Transnit FIFO service request */
+#define ICSR0_RAB       (1 << 2)           /* Receiver abort */
+#define ICSR0_TUR       (1 << 1)           /* Trunsmit FIFO underun */
+#define ICSR0_EIF       (1 << 0)           /* End/Error in FIFO */
+
+#define ICSR1_ROR       (1 << 6)           /* Receiver FIFO underrun  */
+#define ICSR1_CRE       (1 << 5)           /* CRC error */
+#define ICSR1_EOF       (1 << 4)           /* End of frame */
+#define ICSR1_TNF       (1 << 3)           /* Transmit FIFO not full */
+#define ICSR1_RNE       (1 << 2)           /* Receive FIFO not empty */
+#define ICSR1_TBY       (1 << 1)           /* Tramsmiter busy flag */
+#define ICSR1_RSY       (1 << 0)           /* Recevier synchronized flag */
+
+
+/*
+ * Real Time Clock
+ */
+
+#define RCNR		__REG(0x40900000)  /* RTC Count Register */
+#define RTAR		__REG(0x40900004)  /* RTC Alarm Register */
+#define RTSR		__REG(0x40900008)  /* RTC Status Register */
+#define RTTR		__REG(0x4090000C)  /* RTC Timer Trim Register */
+
+#define RTSR_HZE	(1 << 3)	/* HZ interrupt enable */
+#define RTSR_ALE	(1 << 2)	/* RTC alarm interrupt enable */
+#define RTSR_HZ		(1 << 1)	/* HZ rising-edge detected */
+#define RTSR_AL		(1 << 0)	/* RTC alarm detected */
+
+
+/*
+ * OS Timer & Match Registers
+ */
+
+#define OSMR0		__REG(0x40A00000)  /* */
+#define OSMR1		__REG(0x40A00004)  /* */
+#define OSMR2		__REG(0x40A00008)  /* */
+#define OSMR3		__REG(0x40A0000C)  /* */
+#define OSCR		__REG(0x40A00010)  /* OS Timer Counter Register */
+#define OSSR		__REG(0x40A00014)  /* OS Timer Status Register */
+#define OWER		__REG(0x40A00018)  /* OS Timer Watchdog Enable Register */
+#define OIER		__REG(0x40A0001C)  /* OS Timer Interrupt Enable Register */
+
+#define OSSR_M3		(1 << 3)	/* Match status channel 3 */
+#define OSSR_M2		(1 << 2)	/* Match status channel 2 */
+#define OSSR_M1		(1 << 1)	/* Match status channel 1 */
+#define OSSR_M0		(1 << 0)	/* Match status channel 0 */
+
+#define OWER_WME	(1 << 0)	/* Watchdog Match Enable */
+
+#define OIER_E3		(1 << 3)	/* Interrupt enable channel 3 */
+#define OIER_E2		(1 << 2)	/* Interrupt enable channel 2 */
+#define OIER_E1		(1 << 1)	/* Interrupt enable channel 1 */
+#define OIER_E0		(1 << 0)	/* Interrupt enable channel 0 */
+
+
+/*
+ * Pulse Width Modulator
+ */
+
+#define PWM_CTRL0	__REG(0x40B00000)  /* PWM 0 Control Register */
+#define PWM_PWDUTY0	__REG(0x40B00004)  /* PWM 0 Duty Cycle Register */
+#define PWM_PERVAL0	__REG(0x40B00008)  /* PWM 0 Period Control Register */
+
+#define PWM_CTRL1	__REG(0x40C00000)  /* PWM 1Control Register */
+#define PWM_PWDUTY1	__REG(0x40C00004)  /* PWM 1 Duty Cycle Register */
+#define PWM_PERVAL1	__REG(0x40C00008)  /* PWM 1 Period Control Register */
+
+
+/*
+ * Interrupt Controller
+ */
+
+#define ICIP		__REG(0x40D00000)  /* Interrupt Controller IRQ Pending Register */
+#define ICMR		__REG(0x40D00004)  /* Interrupt Controller Mask Register */
+#define ICLR		__REG(0x40D00008)  /* Interrupt Controller Level Register */
+#define ICFP		__REG(0x40D0000C)  /* Interrupt Controller FIQ Pending Register */
+#define ICPR		__REG(0x40D00010)  /* Interrupt Controller Pending Register */
+#define ICCR		__REG(0x40D00014)  /* Interrupt Controller Control Register */
+
+
+/*
+ * General Purpose I/O
+ */
+
+#define GPLR0		__REG(0x40E00000)  /* GPIO Pin-Level Register GPIO<31:0> */
+#define GPLR1		__REG(0x40E00004)  /* GPIO Pin-Level Register GPIO<63:32> */
+#define GPLR2		__REG(0x40E00008)  /* GPIO Pin-Level Register GPIO<80:64> */
+
+#define GPDR0		__REG(0x40E0000C)  /* GPIO Pin Direction Register GPIO<31:0> */
+#define GPDR1		__REG(0x40E00010)  /* GPIO Pin Direction Register GPIO<63:32> */
+#define GPDR2		__REG(0x40E00014)  /* GPIO Pin Direction Register GPIO<80:64> */
+
+#define GPSR0		__REG(0x40E00018)  /* GPIO Pin Output Set Register GPIO<31:0> */
+#define GPSR1		__REG(0x40E0001C)  /* GPIO Pin Output Set Register GPIO<63:32> */
+#define GPSR2		__REG(0x40E00020)  /* GPIO Pin Output Set Register GPIO<80:64> */
+
+#define GPCR0		__REG(0x40E00024)  /* GPIO Pin Output Clear Register GPIO<31:0> */
+#define GPCR1		__REG(0x40E00028)  /* GPIO Pin Output Clear Register GPIO <63:32> */
+#define GPCR2		__REG(0x40E0002C)  /* GPIO Pin Output Clear Register GPIO <80:64> */
+
+#define GRER0		__REG(0x40E00030)  /* GPIO Rising-Edge Detect Register GPIO<31:0> */
+#define GRER1		__REG(0x40E00034)  /* GPIO Rising-Edge Detect Register GPIO<63:32> */
+#define GRER2		__REG(0x40E00038)  /* GPIO Rising-Edge Detect Register GPIO<80:64> */
+
+#define GFER0		__REG(0x40E0003C)  /* GPIO Falling-Edge Detect Register GPIO<31:0> */
+#define GFER1		__REG(0x40E00040)  /* GPIO Falling-Edge Detect Register GPIO<63:32> */
+#define GFER2		__REG(0x40E00044)  /* GPIO Falling-Edge Detect Register GPIO<80:64> */
+
+#define GEDR0		__REG(0x40E00048)  /* GPIO Edge Detect Status Register GPIO<31:0> */
+#define GEDR1		__REG(0x40E0004C)  /* GPIO Edge Detect Status Register GPIO<63:32> */
+#define GEDR2		__REG(0x40E00050)  /* GPIO Edge Detect Status Register GPIO<80:64> */
+
+#define GAFR0_L		__REG(0x40E00054)  /* GPIO Alternate Function Select Register GPIO<15:0> */
+#define GAFR0_U		__REG(0x40E00058)  /* GPIO Alternate Function Select Register GPIO<31:16> */
+#define GAFR1_L		__REG(0x40E0005C)  /* GPIO Alternate Function Select Register GPIO<47:32> */
+#define GAFR1_U		__REG(0x40E00060)  /* GPIO Alternate Function Select Register GPIO<63:48> */
+#define GAFR2_L		__REG(0x40E00064)  /* GPIO Alternate Function Select Register GPIO<79:64> */
+#define GAFR2_U		__REG(0x40E00068)  /* GPIO Alternate Function Select Register GPIO 80 */
+
+#define GAFR3_L		__REG(0x40E0006C)  /* GPIO Alternate Function Select Register GPIO<96-111>*/
+#define GAFR3_U		__REG(0x40E00070)  /* GPIO Alternate Function Select Register GPIO<112-127>*/
+#define GPLR3		__REG(0x40E00100)  /* GPIO Pin-Level Register GPIO<127:96> */
+#define GPDR3		__REG(0x40E0010C)  /* GPIO Pin Direction Register GPIO<127:96> */
+#define GPSR3		__REG(0x40E00118)  /* GPIO Pin Output Set Register GPIO<127:96> */
+#define GPCR3		__REG(0x40E00124)  /* GPIO Pin Output Clear Register GPIO<127:96> */
+#define GRER3		__REG(0x40E00130)  /* GPIO Rising-Edge Detect Register GPIO<127:96> */
+#define GEDR3		__REG(0x40E00148)  /* GPIO Edge Detect Status Register GPIO<127:96> */
+
+/* More handy macros.  The argument is a literal GPIO number. */
+
+#define GPIO_bit(x)	(1 << ((x) & 0x1f))
+#define GPLR(x)		__REG2(0x40E00000, ((x) & 0x60) >> 3)
+#define GPDR(x)		__REG2(0x40E0000C, ((x) & 0x60) >> 3)
+#define GPSR(x)		__REG2(0x40E00018, ((x) & 0x60) >> 3)
+#define GPCR(x)		__REG2(0x40E00024, ((x) & 0x60) >> 3)
+#define GRER(x)		__REG2(0x40E00030, ((x) & 0x60) >> 3)
+#define GFER(x)		__REG2(0x40E0003C, ((x) & 0x60) >> 3)
+#define GEDR(x)		__REG2(0x40E00048, ((x) & 0x60) >> 3)
+#define GAFR(x)		__REG2(0x40E00054, ((x) & 0x70) >> 2)
+
+/* GPIO alternate function assignments */
+
+#define GPIO1_RST		1	/* reset */
+#define GPIO6_MMCCLK		6	/* MMC Clock */
+#define GPIO8_48MHz		7	/* 48 MHz clock output */
+#define GPIO8_MMCCS0		8	/* MMC Chip Select 0 */
+#define GPIO9_MMCCS1		9	/* MMC Chip Select 1 */
+#define GPIO10_RTCCLK		10	/* real time clock (1 Hz) */
+#define GPIO11_3_6MHz		11	/* 3.6 MHz oscillator out */
+#define GPIO12_32KHz		12	/* 32 kHz out */
+#define GPIO13_MBGNT		13	/* memory controller grant */
+#define GPIO14_MBREQ		14	/* alternate bus master request */
+#define GPIO15_nCS_1		15	/* chip select 1 */
+#define GPIO16_PWM0		16	/* PWM0 output */
+#define GPIO17_PWM1		17	/* PWM1 output */
+#define GPIO18_RDY		18	/* Ext. Bus Ready */
+#define GPIO19_DREQ1		19	/* External DMA Request */
+#define GPIO20_DREQ0		20	/* External DMA Request */
+#define GPIO23_SCLK		23	/* SSP clock */
+#define GPIO24_SFRM		24	/* SSP Frame */
+#define GPIO25_STXD		25	/* SSP transmit */
+#define GPIO26_SRXD		26	/* SSP receive */
+#define GPIO27_SEXTCLK		27	/* SSP ext_clk */
+#define GPIO28_BITCLK		28	/* AC97/I2S bit_clk */
+#define GPIO29_SDATA_IN		29	/* AC97 Sdata_in0 / I2S Sdata_in */
+#define GPIO30_SDATA_OUT	30	/* AC97/I2S Sdata_out */
+#define GPIO31_SYNC		31	/* AC97/I2S sync */
+#define GPIO32_SDATA_IN1	32	/* AC97 Sdata_in1 */
+#define GPIO33_nCS_5		33	/* chip select 5 */
+#define GPIO34_FFRXD		34	/* FFUART receive */
+#define GPIO34_MMCCS0		34	/* MMC Chip Select 0 */
+#define GPIO35_FFCTS		35	/* FFUART Clear to send */
+#define GPIO36_FFDCD		36	/* FFUART Data carrier detect */
+#define GPIO37_FFDSR		37	/* FFUART data set ready */
+#define GPIO38_FFRI		38	/* FFUART Ring Indicator */
+#define GPIO39_MMCCS1		39	/* MMC Chip Select 1 */
+#define GPIO39_FFTXD		39	/* FFUART transmit data */
+#define GPIO40_FFDTR		40	/* FFUART data terminal Ready */
+#define GPIO41_FFRTS		41	/* FFUART request to send */
+#define GPIO42_BTRXD		42	/* BTUART receive data */
+#define GPIO43_BTTXD		43	/* BTUART transmit data */
+#define GPIO44_BTCTS		44	/* BTUART clear to send */
+#define GPIO45_BTRTS		45	/* BTUART request to send */
+#define GPIO46_ICPRXD		46	/* ICP receive data */
+#define GPIO46_STRXD		46	/* STD_UART receive data */
+#define GPIO47_ICPTXD		47	/* ICP transmit data */
+#define GPIO47_STTXD		47	/* STD_UART transmit data */
+#define GPIO48_nPOE		48	/* Output Enable for Card Space */
+#define GPIO49_nPWE		49	/* Write Enable for Card Space */
+#define GPIO50_nPIOR		50	/* I/O Read for Card Space */
+#define GPIO51_nPIOW		51	/* I/O Write for Card Space */
+#define GPIO52_nPCE_1		52	/* Card Enable for Card Space */
+#define GPIO53_nPCE_2		53	/* Card Enable for Card Space */
+#define GPIO53_MMCCLK		53	/* MMC Clock */
+#define GPIO54_MMCCLK		54	/* MMC Clock */
+#define GPIO54_pSKTSEL		54	/* Socket Select for Card Space */
+#define GPIO55_nPREG		55	/* Card Address bit 26 */
+#define GPIO56_nPWAIT		56	/* Wait signal for Card Space */
+#define GPIO57_nIOIS16		57	/* Bus Width select for I/O Card Space */
+#define GPIO58_LDD_0		58	/* LCD data pin 0 */
+#define GPIO59_LDD_1		59	/* LCD data pin 1 */
+#define GPIO60_LDD_2		60	/* LCD data pin 2 */
+#define GPIO61_LDD_3		61	/* LCD data pin 3 */
+#define GPIO62_LDD_4		62	/* LCD data pin 4 */
+#define GPIO63_LDD_5		63	/* LCD data pin 5 */
+#define GPIO64_LDD_6		64	/* LCD data pin 6 */
+#define GPIO65_LDD_7		65	/* LCD data pin 7 */
+#define GPIO66_LDD_8		66	/* LCD data pin 8 */
+#define GPIO66_MBREQ		66	/* alternate bus master req */
+#define GPIO67_LDD_9		67	/* LCD data pin 9 */
+#define GPIO67_MMCCS0		67	/* MMC Chip Select 0 */
+#define GPIO68_LDD_10		68	/* LCD data pin 10 */
+#define GPIO68_MMCCS1		68	/* MMC Chip Select 1 */
+#define GPIO69_LDD_11		69	/* LCD data pin 11 */
+#define GPIO69_MMCCLK		69	/* MMC_CLK */
+#define GPIO70_LDD_12		70	/* LCD data pin 12 */
+#define GPIO70_RTCCLK		70	/* Real Time clock (1 Hz) */
+#define GPIO71_LDD_13		71	/* LCD data pin 13 */
+#define GPIO71_3_6MHz		71	/* 3.6 MHz Oscillator clock */
+#define GPIO72_LDD_14		72	/* LCD data pin 14 */
+#define GPIO72_32kHz		72	/* 32 kHz clock */
+#define GPIO73_LDD_15		73	/* LCD data pin 15 */
+#define GPIO73_MBGNT		73	/* Memory controller grant */
+#define GPIO74_LCD_FCLK		74	/* LCD Frame clock */
+#define GPIO75_LCD_LCLK		75	/* LCD line clock */
+#define GPIO76_LCD_PCLK		76	/* LCD Pixel clock */
+#define GPIO77_LCD_ACBIAS	77	/* LCD AC Bias */
+#define GPIO78_nCS_2		78	/* chip select 2 */
+#define GPIO79_nCS_3		79	/* chip select 3 */
+#define GPIO80_nCS_4		80	/* chip select 4 */
+
+/* GPIO alternate function mode & direction */
+
+#define GPIO_IN			0x000
+#define GPIO_OUT		0x080
+#define GPIO_ALT_FN_1_IN	0x100
+#define GPIO_ALT_FN_1_OUT	0x180
+#define GPIO_ALT_FN_2_IN	0x200
+#define GPIO_ALT_FN_2_OUT	0x280
+#define GPIO_ALT_FN_3_IN	0x300
+#define GPIO_ALT_FN_3_OUT	0x380
+#define GPIO_MD_MASK_NR		0x07f
+#define GPIO_MD_MASK_DIR	0x080
+#define GPIO_MD_MASK_FN		0x300
+
+#define GPIO1_RTS_MD		( 1 | GPIO_ALT_FN_1_IN)
+#define GPIO6_MMCCLK_MD		( 6 | GPIO_ALT_FN_1_OUT)
+#define GPIO8_48MHz_MD		( 8 | GPIO_ALT_FN_1_OUT)
+#define GPIO8_MMCCS0_MD		( 8 | GPIO_ALT_FN_1_OUT)
+#define GPIO9_MMCCS1_MD		( 9 | GPIO_ALT_FN_1_OUT)
+#define GPIO10_RTCCLK_MD	(10 | GPIO_ALT_FN_1_OUT)
+#define GPIO11_3_6MHz_MD	(11 | GPIO_ALT_FN_1_OUT)
+#define GPIO12_32KHz_MD		(12 | GPIO_ALT_FN_1_OUT)
+#define GPIO13_MBGNT_MD		(13 | GPIO_ALT_FN_2_OUT)
+#define GPIO14_MBREQ_MD		(14 | GPIO_ALT_FN_1_IN)
+#define GPIO15_nCS_1_MD		(15 | GPIO_ALT_FN_2_OUT)
+#define GPIO16_PWM0_MD		(16 | GPIO_ALT_FN_2_OUT)
+#define GPIO17_PWM1_MD		(17 | GPIO_ALT_FN_2_OUT)
+#define GPIO18_RDY_MD		(18 | GPIO_ALT_FN_1_IN)
+#define GPIO19_DREQ1_MD		(19 | GPIO_ALT_FN_1_IN)
+#define GPIO20_DREQ0_MD		(20 | GPIO_ALT_FN_1_IN)
+#define GPIO23_SCLK_md		(23 | GPIO_ALT_FN_2_OUT)
+#define GPIO24_SFRM_MD		(24 | GPIO_ALT_FN_2_OUT)
+#define GPIO25_STXD_MD		(25 | GPIO_ALT_FN_2_OUT)
+#define GPIO26_SRXD_MD		(26 | GPIO_ALT_FN_1_IN)
+#define GPIO27_SEXTCLK_MD	(27 | GPIO_ALT_FN_1_IN)
+#define GPIO28_BITCLK_AC97_MD	(28 | GPIO_ALT_FN_1_IN)
+#define GPIO28_BITCLK_I2S_MD	(28 | GPIO_ALT_FN_2_IN)
+#define GPIO29_SDATA_IN_AC97_MD	(29 | GPIO_ALT_FN_1_IN)
+#define GPIO29_SDATA_IN_I2S_MD	(29 | GPIO_ALT_FN_2_IN)
+#define GPIO30_SDATA_OUT_AC97_MD	(30 | GPIO_ALT_FN_2_OUT)
+#define GPIO30_SDATA_OUT_I2S_MD	(30 | GPIO_ALT_FN_1_OUT)
+#define GPIO31_SYNC_AC97_MD	(31 | GPIO_ALT_FN_2_OUT)
+#define GPIO31_SYNC_I2S_MD	(31 | GPIO_ALT_FN_1_OUT)
+#define GPIO32_SDATA_IN1_AC97_MD	(32 | GPIO_ALT_FN_1_IN)
+#define GPIO33_nCS_5_MD		(33 | GPIO_ALT_FN_2_OUT)
+#define GPIO34_FFRXD_MD		(34 | GPIO_ALT_FN_1_IN)
+#define GPIO34_MMCCS0_MD	(34 | GPIO_ALT_FN_2_OUT)
+#define GPIO35_FFCTS_MD		(35 | GPIO_ALT_FN_1_IN)
+#define GPIO36_FFDCD_MD		(36 | GPIO_ALT_FN_1_IN)
+#define GPIO37_FFDSR_MD		(37 | GPIO_ALT_FN_1_IN)
+#define GPIO38_FFRI_MD		(38 | GPIO_ALT_FN_1_IN)
+#define GPIO39_MMCCS1_MD	(39 | GPIO_ALT_FN_1_OUT)
+#define GPIO39_FFTXD_MD		(39 | GPIO_ALT_FN_2_OUT)
+#define GPIO40_FFDTR_MD		(40 | GPIO_ALT_FN_2_OUT)
+#define GPIO41_FFRTS_MD		(41 | GPIO_ALT_FN_2_OUT)
+#define GPIO42_BTRXD_MD		(42 | GPIO_ALT_FN_1_IN)
+#define GPIO43_BTTXD_MD		(43 | GPIO_ALT_FN_2_OUT)
+#define GPIO44_BTCTS_MD		(44 | GPIO_ALT_FN_1_IN)
+#define GPIO45_BTRTS_MD		(45 | GPIO_ALT_FN_2_OUT)
+#define GPIO46_ICPRXD_MD	(46 | GPIO_ALT_FN_1_IN)
+#define GPIO46_STRXD_MD		(46 | GPIO_ALT_FN_2_IN)
+#define GPIO47_ICPTXD_MD	(47 | GPIO_ALT_FN_2_OUT)
+#define GPIO47_STTXD_MD		(47 | GPIO_ALT_FN_1_OUT)
+#define GPIO48_nPOE_MD		(48 | GPIO_ALT_FN_2_OUT)
+#define GPIO49_nPWE_MD		(49 | GPIO_ALT_FN_2_OUT)
+#define GPIO50_nPIOR_MD		(50 | GPIO_ALT_FN_2_OUT)
+#define GPIO51_nPIOW_MD		(51 | GPIO_ALT_FN_2_OUT)
+#define GPIO52_nPCE_1_MD	(52 | GPIO_ALT_FN_2_OUT)
+#define GPIO53_nPCE_2_MD	(53 | GPIO_ALT_FN_2_OUT)
+#define GPIO53_MMCCLK_MD	(53 | GPIO_ALT_FN_1_OUT)
+#define GPIO54_MMCCLK_MD	(54 | GPIO_ALT_FN_1_OUT)
+#define GPIO54_pSKTSEL_MD	(54 | GPIO_ALT_FN_2_OUT)
+#define GPIO55_nPREG_MD		(55 | GPIO_ALT_FN_2_OUT)
+#define GPIO56_nPWAIT_MD	(56 | GPIO_ALT_FN_1_IN)
+#define GPIO57_nIOIS16_MD	(57 | GPIO_ALT_FN_1_IN)
+#define GPIO58_LDD_0_MD		(58 | GPIO_ALT_FN_2_OUT)
+#define GPIO59_LDD_1_MD		(59 | GPIO_ALT_FN_2_OUT)
+#define GPIO60_LDD_2_MD		(60 | GPIO_ALT_FN_2_OUT)
+#define GPIO61_LDD_3_MD		(61 | GPIO_ALT_FN_2_OUT)
+#define GPIO62_LDD_4_MD		(62 | GPIO_ALT_FN_2_OUT)
+#define GPIO63_LDD_5_MD		(63 | GPIO_ALT_FN_2_OUT)
+#define GPIO64_LDD_6_MD		(64 | GPIO_ALT_FN_2_OUT)
+#define GPIO65_LDD_7_MD		(65 | GPIO_ALT_FN_2_OUT)
+#define GPIO66_LDD_8_MD		(66 | GPIO_ALT_FN_2_OUT)
+#define GPIO66_MBREQ_MD		(66 | GPIO_ALT_FN_1_IN)
+#define GPIO67_LDD_9_MD		(67 | GPIO_ALT_FN_2_OUT)
+#define GPIO67_MMCCS0_MD	(67 | GPIO_ALT_FN_1_OUT)
+#define GPIO68_LDD_10_MD	(68 | GPIO_ALT_FN_2_OUT)
+#define GPIO68_MMCCS1_MD	(68 | GPIO_ALT_FN_1_OUT)
+#define GPIO69_LDD_11_MD	(69 | GPIO_ALT_FN_2_OUT)
+#define GPIO69_MMCCLK_MD	(69 | GPIO_ALT_FN_1_OUT)
+#define GPIO70_LDD_12_MD	(70 | GPIO_ALT_FN_2_OUT)
+#define GPIO70_RTCCLK_MD	(70 | GPIO_ALT_FN_1_OUT)
+#define GPIO71_LDD_13_MD	(71 | GPIO_ALT_FN_2_OUT)
+#define GPIO71_3_6MHz_MD	(71 | GPIO_ALT_FN_1_OUT)
+#define GPIO72_LDD_14_MD	(72 | GPIO_ALT_FN_2_OUT)
+#define GPIO72_32kHz_MD		(72 | GPIO_ALT_FN_1_OUT)
+#define GPIO73_LDD_15_MD	(73 | GPIO_ALT_FN_2_OUT)
+#define GPIO73_MBGNT_MD		(73 | GPIO_ALT_FN_1_OUT)
+#define GPIO74_LCD_FCLK_MD	(74 | GPIO_ALT_FN_2_OUT)
+#define GPIO75_LCD_LCLK_MD	(75 | GPIO_ALT_FN_2_OUT)
+#define GPIO76_LCD_PCLK_MD	(76 | GPIO_ALT_FN_2_OUT)
+#define GPIO77_LCD_ACBIAS_MD	(77 | GPIO_ALT_FN_2_OUT)
+#define GPIO78_nCS_2_MD		(78 | GPIO_ALT_FN_2_OUT)
+#define GPIO79_nCS_3_MD		(79 | GPIO_ALT_FN_2_OUT)
+#define GPIO80_nCS_4_MD		(80 | GPIO_ALT_FN_2_OUT)
+
+
+/*
+ * Power Manager
+ */
+
+#define PMCR		__REG(0x40F00000)  /* Power Manager Control Register */
+#define PSSR		__REG(0x40F00004)  /* Power Manager Sleep Status Register */
+#define PSPR		__REG(0x40F00008)  /* Power Manager Scratch Pad Register */
+#define PWER		__REG(0x40F0000C)  /* Power Manager Wake-up Enable Register */
+#define PRER		__REG(0x40F00010)  /* Power Manager GPIO Rising-Edge Detect Enable Register */
+#define PFER		__REG(0x40F00014)  /* Power Manager GPIO Falling-Edge Detect Enable Register */
+#define PEDR		__REG(0x40F00018)  /* Power Manager GPIO Edge Detect Status Register */
+#define PCFR		__REG(0x40F0001C)  /* Power Manager General Configuration Register */
+#define PGSR0		__REG(0x40F00020)  /* Power Manager GPIO Sleep State Register for GP[31-0] */
+#define PGSR1		__REG(0x40F00024)  /* Power Manager GPIO Sleep State Register for GP[63-32] */
+#define PGSR2		__REG(0x40F00028)  /* Power Manager GPIO Sleep State Register for GP[84-64] */
+#define RCSR		__REG(0x40F00030)  /* Reset Controller Status Register */
+
+#define PSSR_RDH	(1 << 5)	/* Read Disable Hold */
+#define PSSR_PH		(1 << 4)	/* Peripheral Control Hold */
+#define PSSR_VFS	(1 << 2)	/* VDD Fault Status */
+#define PSSR_BFS	(1 << 1)	/* Battery Fault Status */
+#define PSSR_SSS	(1 << 0)	/* Software Sleep Status */
+
+#define PCFR_DS		(1 << 3)	/* Deep Sleep Mode */
+#define PCFR_FS		(1 << 2)	/* Float Static Chip Selects */
+#define PCFR_FP		(1 << 1)	/* Float PCMCIA controls */
+#define PCFR_OPDE	(1 << 0)	/* 3.6864 MHz oscillator power-down enable */
+
+#define RCSR_GPR	(1 << 3)	/* GPIO Reset */
+#define RCSR_SMR	(1 << 2)	/* Sleep Mode */
+#define RCSR_WDR	(1 << 1)	/* Watchdog Reset */
+#define RCSR_HWR	(1 << 0)	/* Hardware Reset */
+
+
+/*
+ * SSP Serial Port Registers
+ */
+
+#define SSCR0		__REG(0x41000000)  /* SSP Control Register 0 */
+#define SSCR1		__REG(0x41000004)  /* SSP Control Register 1 */
+#define SSSR		__REG(0x41000008)  /* SSP Status Register */
+#define SSITR		__REG(0x4100000C)  /* SSP Interrupt Test Register */
+#define SSDR		__REG(0x41000010)  /* (Write / Read) SSP Data Write Register/SSP Data Read Register */
+
+
+/*
+ * MultiMediaCard (MMC) controller
+ */
+
+#define MMC_STRPCL	__REG(0x41100000)  /* Control to start and stop MMC clock */
+#define MMC_STAT	__REG(0x41100004)  /* MMC Status Register (read only) */
+#define MMC_CLKRT	__REG(0x41100008)  /* MMC clock rate */
+#define MMC_SPI		__REG(0x4110000c)  /* SPI mode control bits */
+#define MMC_CMDAT	__REG(0x41100010)  /* Command/response/data sequence control */
+#define MMC_RESTO	__REG(0x41100014)  /* Expected response time out */
+#define MMC_RDTO	__REG(0x41100018)  /* Expected data read time out */
+#define MMC_BLKLEN	__REG(0x4110001c)  /* Block length of data transaction */
+#define MMC_NOB		__REG(0x41100020)  /* Number of blocks, for block mode */
+#define MMC_PRTBUF	__REG(0x41100024)  /* Partial MMC_TXFIFO FIFO written */
+#define MMC_I_MASK	__REG(0x41100028)  /* Interrupt Mask */
+#define MMC_I_REG	__REG(0x4110002c)  /* Interrupt Register (read only) */
+#define MMC_CMD		__REG(0x41100030)  /* Index of current command */
+#define MMC_ARGH	__REG(0x41100034)  /* MSW part of the current command argument */
+#define MMC_ARGL	__REG(0x41100038)  /* LSW part of the current command argument */
+#define MMC_RES		__REG(0x4110003c)  /* Response FIFO (read only) */
+#define MMC_RXFIFO	__REG(0x41100040)  /* Receive FIFO (read only) */
+#define MMC_TXFIFO	__REG(0x41100044)  /* Transmit FIFO (write only) */
+
+
+/*
+ * Core Clock
+ */
+
+#define CCCR		__REG(0x41300000)  /* Core Clock Configuration Register */
+#define CKEN		__REG(0x41300004)  /* Clock Enable Register */
+#define OSCC		__REG(0x41300008)  /* Oscillator Configuration Register */
+#define CCSR		__REG(0x4130000C)  /* Core Clock Status Register */
+
+#define CCCR_A		(1 << 25)	/* A bit */
+
+#define CCCR_N_MASK	0x0380		/* Run Mode Frequency to Turbo Mode Frequency Multiplier */
+#define CCCR_M_MASK	0x0060		/* Memory Frequency to Run Mode Frequency Multiplier */
+#define CCCR_L_MASK	0x001f		/* Crystal Frequency to Memory Frequency Multiplier */
+
+#define CLKCFG_T    	(1 << 0)      	/* Turbo mode */
+#define CLKCFG_F     	(1 << 1)	/* Frequnce change */
+#define CLKCFG_B     	(1 << 3)	/* Fast-bus mode */
+
+#define CKEN16_LCD	(1 << 16)	/* LCD Unit Clock Enable */
+#define CKEN14_I2C	(1 << 14)	/* I2C Unit Clock Enable */
+#define CKEN13_FICP	(1 << 13)	/* FICP Unit Clock Enable */
+#define CKEN12_MMC	(1 << 12)	/* MMC Unit Clock Enable */
+#define CKEN11_USB	(1 << 11)	/* USB Unit Clock Enable */
+#define CKEN8_I2S	(1 << 8)	/* I2S Unit Clock Enable */
+#define CKEN7_BTUART	(1 << 7)	/* BTUART Unit Clock Enable */
+#define CKEN6_FFUART	(1 << 6)	/* FFUART Unit Clock Enable */
+#define CKEN5_STUART	(1 << 5)	/* STUART Unit Clock Enable */
+#define CKEN3_SSP	(1 << 3)	/* SSP Unit Clock Enable */
+#define CKEN2_AC97	(1 << 2)	/* AC97 Unit Clock Enable */
+#define CKEN1_PWM1	(1 << 1)	/* PWM1 Clock Enable */
+#define CKEN0_PWM0	(1 << 0)	/* PWM0 Clock Enable */
+
+#define OSCC_OON	(1 << 1)	/* 32.768kHz OON (write-once only bit) */
+#define OSCC_OOK	(1 << 0)	/* 32.768kHz OOK (read-only bit) */
+
+
+/*
+ * LCD
+ */
+
+#define LCCR0		__REG(0x44000000)  /* LCD Controller Control Register 0 */
+#define LCCR1		__REG(0x44000004)  /* LCD Controller Control Register 1 */
+#define LCCR2		__REG(0x44000008)  /* LCD Controller Control Register 2 */
+#define LCCR3		__REG(0x4400000C)  /* LCD Controller Control Register 3 */
+#define DFBR0		__REG(0x44000020)  /* DMA Channel 0 Frame Branch Register */
+#define DFBR1		__REG(0x44000024)  /* DMA Channel 1 Frame Branch Register */
+#define LCSR		__REG(0x44000038)  /* LCD Controller Status Register */
+#define LIIDR		__REG(0x4400003C)  /* LCD Controller Interrupt ID Register */
+#define TMEDRGBR	__REG(0x44000040)  /* TMED RGB Seed Register */
+#define TMEDCR		__REG(0x44000044)  /* TMED Control Register */
+
+#define FDADR0		__REG(0x44000200)  /* DMA Channel 0 Frame Descriptor Address Register */
+#define FSADR0		__REG(0x44000204)  /* DMA Channel 0 Frame Source Address Register */
+#define FIDR0		__REG(0x44000208)  /* DMA Channel 0 Frame ID Register */
+#define LDCMD0		__REG(0x4400020C)  /* DMA Channel 0 Command Register */
+#define FDADR1		__REG(0x44000210)  /* DMA Channel 1 Frame Descriptor Address Register */
+#define FSADR1		__REG(0x44000214)  /* DMA Channel 1 Frame Source Address Register */
+#define FIDR1		__REG(0x44000218)  /* DMA Channel 1 Frame ID Register */
+#define LDCMD1		__REG(0x4400021C)  /* DMA Channel 1 Command Register */
+
+#define LCCR0_ENB	(1 << 0)	/* LCD Controller enable */
+#define LCCR0_CMS	(1 << 1)	/* Color = 0, Monochrome = 1 */
+#define LCCR0_SDS	(1 << 2)	/* Single Panel = 0, Dual Panel = 1 */
+#define LCCR0_LDM	(1 << 3)	/* LCD Disable Done Mask */
+#define LCCR0_SFM	(1 << 4)	/* Start of frame mask */
+#define LCCR0_IUM	(1 << 5)	/* Input FIFO underrun mask */
+#define LCCR0_EFM	(1 << 6)	/* End of Frame mask */
+#define LCCR0_PAS	(1 << 7)	/* Passive = 0, Active = 1 */
+#define LCCR0_BLE	(1 << 8)	/* Little Endian = 0, Big Endian = 1 */
+#define LCCR0_DPD	(1 << 9)	/* Double Pixel mode, 4 pixel value = 0, 8 pixle values = 1 */
+#define LCCR0_DIS	(1 << 10)	/* LCD Disable */
+#define LCCR0_QDM	(1 << 11)	/* LCD Quick Disable mask */
+#define LCCR0_PDD	(0xff << 12)	/* Palette DMA request delay */
+#define LCCR0_PDD_S	12
+#define LCCR0_BM	(1 << 20) 	/* Branch mask */
+#define LCCR0_OUM	(1 << 21)	/* Output FIFO underrun mask */
+
+#define LCCR1_PPL       Fld (10, 0)      /* Pixels Per Line - 1 */
+#define LCCR1_DisWdth(Pixel)            /* Display Width [1..800 pix.]  */ \
+                        (((Pixel) - 1) << FShft (LCCR1_PPL))
+
+#define LCCR1_HSW       Fld (6, 10)     /* Horizontal Synchronization     */
+#define LCCR1_HorSnchWdth(Tpix)         /* Horizontal Synchronization     */ \
+                                        /* pulse Width [1..64 Tpix]       */ \
+                        (((Tpix) - 1) << FShft (LCCR1_HSW))
+
+#define LCCR1_ELW       Fld (8, 16)     /* End-of-Line pixel clock Wait    */
+                                        /* count - 1 [Tpix]                */
+#define LCCR1_EndLnDel(Tpix)            /*  End-of-Line Delay              */ \
+                                        /*  [1..256 Tpix]                  */ \
+                        (((Tpix) - 1) << FShft (LCCR1_ELW))
+
+#define LCCR1_BLW       Fld (8, 24)     /* Beginning-of-Line pixel clock   */
+                                        /* Wait count - 1 [Tpix]           */
+#define LCCR1_BegLnDel(Tpix)            /*  Beginning-of-Line Delay        */ \
+                                        /*  [1..256 Tpix]                  */ \
+                        (((Tpix) - 1) << FShft (LCCR1_BLW))
+
+
+#define LCCR2_LPP       Fld (10, 0)     /* Line Per Panel - 1              */
+#define LCCR2_DisHght(Line)             /*  Display Height [1..1024 lines] */ \
+                        (((Line) - 1) << FShft (LCCR2_LPP))
+
+#define LCCR2_VSW       Fld (6, 10)     /* Vertical Synchronization pulse  */
+                                        /* Width - 1 [Tln] (L_FCLK)        */
+#define LCCR2_VrtSnchWdth(Tln)          /*  Vertical Synchronization pulse */ \
+                                        /*  Width [1..64 Tln]              */ \
+                        (((Tln) - 1) << FShft (LCCR2_VSW))
+
+#define LCCR2_EFW       Fld (8, 16)     /* End-of-Frame line clock Wait    */
+                                        /* count [Tln]                     */
+#define LCCR2_EndFrmDel(Tln)            /*  End-of-Frame Delay             */ \
+                                        /*  [0..255 Tln]                   */ \
+                        ((Tln) << FShft (LCCR2_EFW))
+
+#define LCCR2_BFW       Fld (8, 24)     /* Beginning-of-Frame line clock   */
+                                        /* Wait count [Tln]                */
+#define LCCR2_BegFrmDel(Tln)            /*  Beginning-of-Frame Delay       */ \
+                                        /*  [0..255 Tln]                   */ \
+                        ((Tln) << FShft (LCCR2_BFW))
+
+#if 0
+#define LCCR3_PCD	(0xff)		/* Pixel clock divisor */
+#define LCCR3_ACB	(0xff << 8)	/* AC Bias pin frequency */
+#define LCCR3_ACB_S	8
+#endif
+
+#define LCCR3_API	(0xf << 16)	/* AC Bias pin trasitions per interrupt */
+#define LCCR3_API_S	16
+#define LCCR3_VSP	(1 << 20)	/* vertical sync polarity */
+#define LCCR3_HSP	(1 << 21)	/* horizontal sync polarity */
+#define LCCR3_PCP	(1 << 22)	/* pixel clock polarity */
+#define LCCR3_OEP	(1 << 23)	/* output enable polarity */
+#if 0
+#define LCCR3_BPP	(7 << 24)	/* bits per pixel */
+#define LCCR3_BPP_S	24
+#endif
+#define LCCR3_DPC	(1 << 27)	/* double pixel clock mode */
+
+
+#define LCCR3_PCD       Fld (8, 0)      /* Pixel Clock Divisor */
+#define LCCR3_PixClkDiv(Div)            /* Pixel Clock Divisor */ \
+                        (((Div) << FShft (LCCR3_PCD)))
+
+
+#define LCCR3_BPP       Fld (3, 24)     /* Bit Per Pixel */
+#define LCCR3_Bpp(Bpp)                  /* Bit Per Pixel */ \
+                        (((Bpp) << FShft (LCCR3_BPP)))
+
+#define LCCR3_ACB       Fld (8, 8)      /* AC Bias */
+#define LCCR3_Acb(Acb)                  /* BAC Bias */ \
+                        (((Acb) << FShft (LCCR3_ACB)))
+
+#define LCCR3_HorSnchH  (LCCR3_HSP*0)   /*  Horizontal Synchronization     */
+                                        /*  pulse active High              */
+#define LCCR3_HorSnchL  (LCCR3_HSP*1)   /*  Horizontal Synchronization     */
+
+#define LCCR3_VrtSnchH  (LCCR3_VSP*0)   /*  Vertical Synchronization pulse */
+                                        /*  active High                    */
+#define LCCR3_VrtSnchL  (LCCR3_VSP*1)   /*  Vertical Synchronization pulse */
+                                        /*  active Low                     */
+
+#define LCSR_LDD	(1 << 0)	/* LCD Disable Done */
+#define LCSR_SOF	(1 << 1)	/* Start of frame */
+#define LCSR_BER	(1 << 2)	/* Bus error */
+#define LCSR_ABC	(1 << 3)	/* AC Bias count */
+#define LCSR_IUL	(1 << 4)	/* input FIFO underrun Lower panel */
+#define LCSR_IUU	(1 << 5)	/* input FIFO underrun Upper panel */
+#define LCSR_OU		(1 << 6)	/* output FIFO underrun */
+#define LCSR_QD		(1 << 7)	/* quick disable */
+#define LCSR_EOF	(1 << 8)	/* end of frame */
+#define LCSR_BS		(1 << 9)	/* branch status */
+#define LCSR_SINT	(1 << 10)	/* subsequent interrupt */
+
+#define LDCMD_PAL	(1 << 26)	/* instructs DMA to load palette buffer */
+
+#define LCSR_LDD	(1 << 0)	/* LCD Disable Done */
+#define LCSR_SOF	(1 << 1)	/* Start of frame */
+#define LCSR_BER	(1 << 2)	/* Bus error */
+#define LCSR_ABC	(1 << 3)	/* AC Bias count */
+#define LCSR_IUL	(1 << 4)	/* input FIFO underrun Lower panel */
+#define LCSR_IUU	(1 << 5)	/* input FIFO underrun Upper panel */
+#define LCSR_OU		(1 << 6)	/* output FIFO underrun */
+#define LCSR_QD		(1 << 7)	/* quick disable */
+#define LCSR_EOF	(1 << 8)	/* end of frame */
+#define LCSR_BS		(1 << 9)	/* branch status */
+#define LCSR_SINT	(1 << 10)	/* subsequent interrupt */
+
+#define LDCMD_PAL	(1 << 26)	/* instructs DMA to load palette buffer */
+
+/*
+ * Memory controller
+ */
+
+#define MDCNFG		__REG(0x48000000)  /* SDRAM Configuration Register 0 */
+#define MDREFR		__REG(0x48000004)  /* SDRAM Refresh Control Register */
+#define MSC0		__REG(0x48000008)  /* Static Memory Control Register 0 */
+#define MSC1		__REG(0x4800000C)  /* Static Memory Control Register 1 */
+#define MSC2		__REG(0x48000010)  /* Static Memory Control Register 2 */
+#define MECR		__REG(0x48000014)  /* Expansion Memory (PCMCIA/Compact Flash) Bus Configuration */
+#define SXLCR		__REG(0x48000018)  /* LCR value to be written to SDRAM-Timing Synchronous Flash */
+#define SXCNFG		__REG(0x4800001C)  /* Synchronous Static Memory Control Register */
+#define SXMRS		__REG(0x48000024)  /* MRS value to be written to Synchronous Flash or SMROM */
+#define MCMEM0		__REG(0x48000028)  /* Card interface Common Memory Space Socket 0 Timing */
+#define MCMEM1		__REG(0x4800002C)  /* Card interface Common Memory Space Socket 1 Timing */
+#define MCATT0		__REG(0x48000030)  /* Card interface Attribute Space Socket 0 Timing Configuration */
+#define MCATT1		__REG(0x48000034)  /* Card interface Attribute Space Socket 1 Timing Configuration */
+#define MCIO0		__REG(0x48000038)  /* Card interface I/O Space Socket 0 Timing Configuration */
+#define MCIO1		__REG(0x4800003C)  /* Card interface I/O Space Socket 1 Timing Configuration */
+#define MDMRS		__REG(0x48000040)  /* MRS value to be written to SDRAM */
+#define BOOT_DEF	__REG(0x48000044)  /* Read-Only Boot-Time Register. Contains BOOT_SEL and PKG_SEL */
+
+#define MDCNFG_DE0		(1 << 0)	/* SDRAM enable for partition 0 */
+#define MDCNFG_DE1		(1 << 1)	/* SDRAM enable for partition 1 */
+#define MDCNFG_DWID0	(1 << 2)	/* SDRAM data bus width for partition 0/1 */
+#define MDCNFG_DCAC0(x)	(((x) & 3) << 3)	/* SDRAM column address bits for partition 0/1 */
+#define MDCNFG_DRAC0(x)	(((x) & 3) << 5)	/* SDRAM row address bits for partition 0/1 */
+#define MDCNFG_DNB0		(1 << 7)	/* SDRAM banks in lower partition pair */
+#define MDCNFG_DTC0(x)	(((x) & 3) << 8)	/* Timing category for SDRAM pair 0/1 */
+#define MDCNFG_DADDR0	(1 << 10)	/* Reserved */
+#define MDCNFG_DLATCH0	(1 << 11)	/* Return data from SDRAM latching scheme for pair 0/1 */
+#define MDCNFG_DSA1111_0	(1 << 12)	/* Use SA1111 addressing muxing mode for pair 0/1 */
+#define MDCNFG_DE2		(1 << 16)	/* SDRAM enable for partition 2 */
+#define MDCNFG_DE3		(1 << 17)	/* SDRAM enable for partition 3 */
+#define MDCNFG_DWID2	(1 << 18)	/* SDRAM data bus width for partition 2/3 */
+#define MDCNFG_DCAC2(x)	(((x) & 3) << 19)	/* SDRAM column address bits for partition 2/3 */
+#define MDCNFG_DRAC2(x)	(((x) & 3) << 21)	/* SDRAM row address bits for partition 2/3 */
+#define MDCNFG_DNB2		(1 << 23)	/* SDRAM banks in upper partition pair */
+#define MDCNFG_DTC2(x)	(((x) & 3) << 24)	/* Timing category for SDRAM pair 2/3 */
+#define MDCNFG_DADDR2	(1 << 26)	/* Reserved */
+#define MDCNFG_DLATCH2	(1 << 27)	/* Return data from SDRAM latching scheme for pair 2/3 */
+#define MDCNFG_DSA1111_2	(1 << 29)	/* Use SA1111 addressing muxing mode for pair 2/3 */
+
+#define MDREFR_K0DB4	(1 << 29)	/* SDCLK0 Divide by 4 Control/Status */
+#define MDREFR_K2FREE	(1 << 25)	/* SDRAM Free-Running Control */
+#define MDREFR_K1FREE	(1 << 24)	/* SDRAM Free-Running Control */
+#define MDREFR_K0FREE	(1 << 23)	/* SDRAM Free-Running Control */
+#define MDREFR_SLFRSH	(1 << 22)	/* SDRAM Self-Refresh Control/Status */
+#define MDREFR_APD		(1 << 20)	/* SDRAM/SSRAM Auto-Power-Down Enable */
+#define MDREFR_K2DB2	(1 << 19)	/* SDCLK2 Divide by 2 Control/Status */
+#define MDREFR_K2RUN	(1 << 18)	/* SDCLK2 Run Control/Status */
+#define MDREFR_K1DB2	(1 << 17)	/* SDCLK1 Divide by 2 Control/Status */
+#define MDREFR_K1RUN	(1 << 16)	/* SDCLK1 Run Control/Status */
+#define MDREFR_E1PIN	(1 << 15)	/* SDCKE1 Level Control/Status */
+#define MDREFR_K0DB2	(1 << 14)	/* SDCLK0 Divide by 2 Control/Status */
+#define MDREFR_K0RUN	(1 << 13)	/* SDCLK0 Run Control/Status */
+#define MDREFR_E0PIN	(1 << 12)	/* SDCKE0 Level Control/Status */
+
+#define MSC_RT			Fld(2,0)	/* ROM type */
+#define MSC_NonBrst		(0 << FShft (MSC_RT))
+#define MSC_SRAM		(1 << FShft (MSC_RT))
+#define MSC_Brst4		(2 << FShft (MSC_RT))
+#define MSC_Brst8		(3 << FShft (MSC_RT))
+#define MSC_VarLat		(4 << FShft (MSC_RT))
+#define MSC_RBW			(1 << 3)	/* ROM bus width */
+#define MSC_32BitStMem	(MSC_RBW*0)
+#define MSC_16BitStMem	(MSC_RBW*1)
+#define MSC_RDF(x)		(((x) & 15) << 4)	/* ROM delay first access */
+#define MSC_RDN(x)		(((x) & 15) << 8)	/* ROM delay next access */
+#define MSC_RRR(x)		(((x) & 7) << 12)	/* ROM/SRAM recovery time */
+#define MSC_RBUFF		(1 << 15)	/* Return Data Buffer vs. Streaming behavior */
+#define MSC_RDBuf		(MSC_RBUFF*0)
+#define MSC_Stream		(MSC_RBUFF*1)
+#endif
Index: build_tree/bootLoader/include/blob/arch/pxa_idp.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/pxa_idp.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/pxa_idp.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,165 @@
+/*
+ * pxa_idp.h: Accelent PXA-IDP specific defines
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2002  Holger Schurig <h.schurig@mn-logistik.de>
+ * Copyright (c) 2002  Jeff Sutherland <jeffs@accelent.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_ARCH_PXA_IDP_H
+#define BLOB_ARCH_PXA_IDP_H
+
+/* speed definitions are more complex on Xscale- need core, internal bus,
+ * and memory numbers.  Not all combinations are valid.
+ */
+
+#undef  CPU_SPEED_400
+
+/* boot CPU speed */
+#ifdef CPU_SPEED_100
+#       define CPU_SPEED                (0x05)
+#else
+#       define CPU_SPEED                (0x0a)
+#endif
+
+/* serial port */
+#define USE_SERIAL1
+#define TERMINAL_SPEED baud_115200
+
+/* GPIO for the LED */
+#define LED_GPIO		(0x00000002) /* GPIO 1 */
+
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xa0200400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xa0100000)
+#define KERNEL_RAM_BASE		(0xa0008000)
+#define PARAM_RAM_BASE		(0xa0110000)
+#define RAMDISK_RAM_BASE	(0xa0400000)
+
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xa0000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+/* #ifdef BLOB_NEED_MEMCONFIG */
+
+#if 1
+
+/* this is full tilt boogie (400MHz cpu, 100Mhz mem, 100MHz clk)
+
+#define MDCNFG_VALUE	0x0A000AC9
+#define MDREFR_VALUE	0x0085C017
+#define MSC0_VALUE	0x29DCA4D2
+#define MSC1_VALUE	0x439C493C
+#define MSC2_VALUE	0x7FD449D1
+#define MECR_VALUE	0x00000003
+
+*/
+
+/* I took these from the Lubbock setup, they should probably be changed
+ * for actual IDP values, but these are there for now :-)
+ */
+
+#define PERIF_BASE_PHYSICAL 0x40000000
+#define MEMC_BASE_PHYSICAL  0x48000000
+#define SDRAM_BASE_PHYSICAL 0xA0000000
+
+#define OST_OFFSET          0x00A00000
+#define OSCR_OFFSET         0x10
+
+#define OST_BASE_PHYSICAL   (PERIF_BASE_PHYSICAL + OST_OFFSET)
+#define OSCR_BASE_PHYSICAL  (OST_BASE_PHYSICAL + OSCR_OFFSET)
+
+#define MSC0_VAL            0x23F223F2
+#define MSC1_VAL            0x3FF1A441
+#define MSC2_VAL            0x7FF17FF1
+#define MECR_VAL            0x00000000
+#define MCMEM0_VAL          0x00010504
+#define MCMEM1_VAL          0x00010504
+#define MCATT0_VAL          0x00010504
+#define MCATT1_VAL          0x00010504
+#define MCIO0_VAL           0x00004715
+#define MCIO1_VAL           0x00004715
+#define MDREFR_VAL          0x00018018
+#define MDCNFG_VAL          0x00001AC9
+#define MDMRS_VAL           0x00000000
+
+/*
+#ifndef __ASSEMBLY__
+
+memregs->sxlcr =    0x00000000
+memregs->sxcnfg =   0x00000000
+memregs->flycnfg =  0x01FE01FE
+memregs->sxmrs =    0x00000000
+memregs->mcmem0 =   0x00014405
+memregs->mcmem1 =   0x00014405
+memregs->mcatt0 =   0x00014405
+memregs->mcatt1 =   0x00014405
+memregs->mcio0 =    0x00014405
+memregs->mcio1 =    0x00014405
+memregs->mdmrs =    0x00320032
+memregs->boot_def = 0x00000008
+
+#endif
+*/
+
+#else
+
+// Do a low speed version at some point...
+
+#endif
+
+/* #endif */
+
+
+// the control-registers in the FPGA
+#define CONTROL_REG     __REG(0x42000000)
+
+
+/* Debugging macros used in accelent code */
+#define ACCELENT_DEBUG 1
+
+#ifdef ACCELENT_DEBUG
+#	define _DBGU32( x )	SerialOutputString( #x"=0x" ); \
+				SerialOutputHex( (u32)x ); \
+				serial_write( '\n' );
+#else
+#	define _DBGU32( x )
+#endif
+
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/ramses.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/ramses.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/ramses.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,128 @@
+/*
+ * ramses.h: M&N Ramses MN-CI
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (c) 2002  Jeff Sutherland <jeffs@accelent.com>
+ * Copyright (C) 2003  Holger Schurig <h.schurig@mn-logistik.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_ARCH_RAMSES_H
+#define BLOB_ARCH_RAMSES_H
+
+/* speed definitions are more complex on Xscale- need core, internal bus,
+ * and memory numbers.  Not all combinations are valid.
+ */
+
+#undef  CPU_SPEED_400
+
+/* boot CPU speed */
+#ifdef CPU_SPEED_100
+#       define CPU_SPEED                (0x05)
+#else
+#       define CPU_SPEED                (0x0a)
+#endif
+
+#define USE_SERIAL1
+#define TERMINAL_SPEED baud_115200
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xa0200400)
+
+/* where do various parts live in RAM */
+#define BOOT_PARAMS		(0xa0000100)
+#define BLOB_RAM_BASE		(0xa0100000)
+#define PARAM_RAM_BASE		(0xa0200000)
+#define KERNEL_RAM_BASE		(0xa0800000)
+//#define RAMDISK_RAM_BASE	(0xa1000000)
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(256 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(256 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024)
+//#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+//#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+
+/* this needs to be defined if you want parameter block support */
+#define PARAM_START PARAM_FLASH_BASE
+#define PARAM_LEN PARAM_FLASH_LEN
+
+/* load ramdisk into ram */
+#define LOAD_RAMDISK		0
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+//#define RAMDISK_SIZE		(4 * 1024)
+
+
+/* #ifdef BLOB_NEED_MEMCONFIG */
+
+/* this is full tilt boogie (400MHz cpu, 100Mhz mem, 100MHz clk)
+
+#define MDCNFG_VALUE	0x0A000AC9
+#define MDREFR_VALUE	0x0085C017
+#define MSC0_VALUE	0x29DCA4D2
+#define MSC1_VALUE	0x439C493C
+#define MSC2_VALUE	0x7FD449D1
+#define MECR_VALUE	0x00000003
+
+*/
+
+/* I took these from the Lubbock setup, they should probably be changed
+ * for actual IDP values, but these are there for now :-)
+ */
+
+#define PERIF_BASE_PHYSICAL 0x40000000
+#define MEMC_BASE_PHYSICAL  0x48000000
+#define SDRAM_BASE_PHYSICAL 0xA0000000
+
+#define OST_OFFSET          0x00A00000
+#define OSCR_OFFSET         0x10
+
+#define OST_BASE_PHYSICAL   (PERIF_BASE_PHYSICAL + OST_OFFSET)
+#define OSCR_BASE_PHYSICAL  (OST_BASE_PHYSICAL + OSCR_OFFSET)
+
+#define MSC0_VAL            0x23F223F2
+#define MSC1_VAL            0x3FF1A441
+#define MSC2_VAL            0x7FF17FF1
+#define MECR_VAL            0x00000000
+#define MCMEM0_VAL          0x00010504
+#define MCMEM1_VAL          0x00010504
+#define MCATT0_VAL          0x00010504
+#define MCATT1_VAL          0x00010504
+#define MCIO0_VAL           0x00004715
+#define MCIO1_VAL           0x00004715
+#define MDREFR_VAL          0x00018018
+#define MDCNFG_VAL          0x00001AC9
+#define MDMRS_VAL           0x00000000
+
+
+/* Debugging macros used in accelent code */
+#define RAMSES_DEBUG 1
+
+#ifdef RAMSES_DEBUG
+#	define _DBGU32( x )	SerialOutputString( #x"=0x" ); \
+				SerialOutputHex( (u32)x ); \
+				serial_write( '\n' );
+#else
+#	define _DBGU32( x )
+#endif
+
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/s3c2500-regs.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/s3c2500-regs.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/s3c2500-regs.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,329 @@
+/*
+ *  blob/include/arch/s3c2500-regs.h
+ *  
+ *  Copyright (C) 2003  Russ Dill <Russ.Dill@asu.edu>
+ *
+ * Original Copyright: 
+ *  Author:	Nicolas Pitre
+ *  Created:	Jun 15, 2001
+ *  Copyright:	MontaVista Software Inc.
+ *  
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+#ifndef _S3C2500_REGS_H_
+#define _S3C2500_REGS_H_
+
+#include <blob/proc/s3c2500.h>
+
+/* Get the M value for a speed in MHz a P, and an S */
+#define Fin 	10
+/* The +(Fin - 1) thing is so it rounds up */
+#define PLL_CALC_M(Fout, s, p) \
+	(((p + 2) * (1 << s) * Fout + (Fin - 1)) / Fin - 8)
+
+/* get the whole kit-n-kaboodle */
+#define PLL_VALUE(Fout, s, p) \
+	(PLL_S(s) | PLL_P(p) | PLL_M(PLL_CALC_M(Fout, s, p)))
+
+
+/* get the MHz as a number */
+#define GET_PLL_S(x)	((x >> 16) & 0x3) 
+#define GET_PLL_P(x)	((x >> 8) & 0x3f)
+#define GET_PLL_M(x)	((x >> 0) & 0xff)
+
+#define _GET_MHz(s, p, m) \
+	((Fin * (m + 8)) / ((p + 2) * (1 << s))) 
+
+#define GET_MHz(x) \
+	_GET_MHz(GET_PLL_S(x), GET_PLL_P(x), GET_PLL_M(x))
+
+/* PLL defines for a 10MHz input */
+#define SPEED_33MHz	PLL_VALUE(33, 1, 3)
+#define SPEED_48MHz	PLL_VALUE(48, 3, 3)
+#define SPEED_50HMz	PLL_VALUE(50, 1, 3)
+#define SPEED_66MHz	PLL_VALUE(66, 1, 2)
+#define SPEED_96MHz	PLL_VALUE(96, 3, 2)
+#define SPEED_100MHz	PLL_VALUE(100, 1, 2)
+#define SPEED_125MHz	PLL_VALUE(125, 1, 1)
+#define SPEED_133MHz	PLL_VALUE(133, 1, 1)
+#define SPEED_150MHz	PLL_VALUE(150, 1, 1)
+#define SPEED_166MHz	PLL_VALUE(166, 3, 1)
+#define SPEED_200MHz	PLL_VALUE(200, 1, 1)
+#define SPEED_233MHz	PLL_VALUE(233, 1, 1)
+#define SPEED_266MHz	PLL_VALUE(266, 1, 0)
+#define SPEED_300MHz	PLL_VALUE(300, 1, 0)
+
+
+/*
+ * S3C2500 Chip selects
+ */
+
+#define S3C2500_CS0_PHYS	0x00000000
+#define S3C2500_CS1_PHYS	0x01000000
+#define S3C2500_CS2_PHYS	0x02000000
+#define S3C2500_CS3_PHYS	0x03000000
+#define S3C2500_CS4_PHYS	0x04000000
+#define S3C2500_CS5_PHYS	0x05000000
+#define S3C2500_CS6_PHYS	0x06000000
+#define S3C2500_CS7_PHYS	0x07000000
+
+/*
+ * S3C2500 SDRAM banks
+ */
+
+#define S3C2500_SDRAM_BANK0	0x40000000
+#define S3C2500_SDRAM_BANK1	0x80000000
+
+#define ASIC_BASE		0xF0000000
+
+/*
+ * System config
+ */
+
+#define SYSCFG_BASEB	0x00000000
+#define SYSCFG_BASE	(ASIC_BASE + SYSCFGB)
+
+#define SYSCFG		__REG2(SYSCFG_BASE,0x00) /* System configuration */
+#define CPLLREN		(1 << 31)
+#define SPLLREN		(1 << 30)
+#define UPLLREN		(1 << 29)
+#define PPLLREN		(1 << 28)
+#define CPLLCE		(1 << 27)
+#define SPLLCE		(1 << 26)
+#define UPLLCE		(1 << 25)
+#define PPLLCE		(1 << 24)
+#define BIG_ENDIAN	(1 << 16)
+#define REMAP		(1 << 8)
+#define HCLK0_DIS	(1 << 4)
+#define ARB		(1 << 0)
+
+#define PDCODE		__REG2(SYSCFG_BASE,0x04) /* Product code */
+#define CLKCON		__REG2(SYSCFG_BASE,0x08) /* System clock control */
+#define PCLKDIS		__REG2(SYSCFG_BASE,0x0c) /* Peripheral clock disable */
+#define CLKST		__REG2(SYSCFG_BASE,0x10) /* Clock status */
+#define HPRIF		__REG2(SYSCFG_BASE,0x14) /* AHB fixed priority */
+#define HPRIR		__REG2(SYSCFG_BASE,0x18) /* AHB round-robin */
+
+#define CPLL		__REG2(SYSCFG_BASE,0x1c) /* Core PLL config */
+#define SPLL		__REG2(SYSCFG_BASE,0x20) /* Bus PLL config */
+#define UPLL		__REG2(SYSCFG_BASE,0x24) /* USB PLL config */
+#define PPLL		__REG2(SYSCFG_BASE,0x28) /* PHY PLL config */
+#define	PLL_S(x)	(x << 16)
+#define PLL_P(x)	(x << 8)
+#define PLL_M(x)	(x << 0)
+
+/*
+ * Memory Controller
+ */
+
+/* I/O Banks */
+
+#define BCONB		0x00010000
+#define BCON		(ASIC_BASE + BCONB)
+
+#define B0CON		__REG2(BCON,0x00)
+#define B1CON		__REG2(BCON,0x04)
+#define B2CON		__REG2(BCON,0x08)
+#define B3CON		__REG2(BCON,0x0c)
+#define B4CON		__REG2(BCON,0x10)
+#define B5CON		__REG2(BCON,0x14)
+#define B6CON		__REG2(BCON,0x18)
+#define B7CON		__REG2(BCON,0x1c)
+#define TCOH(x)		(x << 0)
+#define TCOS(x)		(x << 4)
+#define TACS(x)		(x << 8)
+#define TPA(x)		(x << 12) /* tACC of accesses where nOE and nRCS
+				   * is held low, and just the address 
+				   * is changed (page read) */
+#define TACC(x)		(x << 16)
+#define IS		(1 << 23)
+#define BS(x)		(x << 24)
+#define PMC(x)		(x << 28)
+#define PMC4		PMC(1)
+#define PMC8		PMC(2)
+#define PMC16		PMC(3)
+#define DW(x)		(x << 30)
+#define DW8		DW(1)
+#define DW16		DW(2)
+#define DW32		DW(3)
+
+#define MUXBCON		__REG2(BCON,0x20)
+#define WAITCON		__REG2(BCON,0x24)
+
+/* SDRAM controller */
+
+#define SDRAMB		0x00020000
+#define SDRAM		(ASIC_BASE + SDRAMB)
+
+#define CFGREG		__REG2(SDRAM,0x00)
+#define XW		(1 << 0)
+#define XW16		(XW)
+#define XW32		(0)
+#define NO_AP		(1 << 1)
+#define AP		(0)
+#define CL(x)		(x << 2)
+#define D1(x)		(x << 4)
+#define D1_16M		D1(0)
+#define D1_64M		D1(1)
+#define D1_128M		D1(2)
+#define D1_256M		D1(3)
+#define D0(x)		(x << 6)
+#define D0_16M		D0(0)
+#define D0_64M		D0(1)
+#define D0_128M		D0(2)
+#define D0_256M		D0(3)
+#define RP(x)		((x - 1) << 8)
+#define RCD(x)		((x - 1) << 10)
+#define RC(x)		((x - 1) << 12)
+#define RAS(x)		((x - 1) << 16)
+
+#define CMDREG		__REG2(SDRAM,0x04)
+#define INIT(x)		(x << 0)
+#define PALL		INIT(1)
+#define MRS		INIT(2)
+#define WBUF		(1 << 2)
+#define BUSY		(1 << 3)
+
+#define REFREG		__REG2(SDRAM,0x08)
+#define WBTOREG		__REG2(SDRAM,0x0c)
+
+/*
+ * UARTs
+ */
+
+/* Console UART (CUART) */
+
+#define CUARTB		0x00060000
+#define CUART		(ASIC_BASE + CUARTB)
+#define CUCON		__REG2(CUART,0x00) /* Control register (rw) */
+#define CUSTAT		__REG2(CUART,0x04) /* Status register (rw) */
+#define CUINT		__REG2(CUART,0x08) /* Interrupt enable register (rw) */
+#define CUTXBUF		__REG2(CUART,0x0C) /* Transmit buffer (wronly) */
+#define CURXBUF		__REG2(CUART,0x10) /* receive buffer (rdonly) */
+#define CUBRD		__REG2(CUART,0x14) /* Badu rate divisor register (rw) */
+#define CUCHAR1		__REG2(CUART,0x18) /* UART control char register 1 (rw) */
+#define CUCHAR2		__REG2(CUART,0x1C) /* UART control char register 2 (rw) */
+
+#define CUCON_TMODE	(1 << 0)	/* Transmitter enable */
+#define CUCON_RMODE	(1 << 2)	/* Receiver enable */
+#define CUCON_SBR	(1 << 4)	/* Send break */
+#define CUCON_SCSEL	(1 << 5)	/* Enable external clock */
+#define CUCON_LOOPB	(1 << 7)	/* loopback */
+#define CUCON_PODD	(4 << 8)	/* odd parity */
+#define CUCON_PEVEN	(5 << 8)	/* even parity */
+#define CUCON_STB	(1 << 11)	/* two stop bits */
+#define CUCON_5BITS	(0 << 12)	/* 5 bits */
+#define CUCON_6BITS	(1 << 12)	/* 6 bits */
+#define CUCON_7BITS	(2 << 12)	/* 7 bits */
+#define CUCON_8BITS	(3 << 12)	/* 8 bits */
+#define CUCON_IR	(1 << 14)	/* IR mode */
+#define CUCON_SFEN	(1 << 29)	/* Software flow control */
+#define CUCON_ECHO	(1 << 30)	/* Echo mode enable */
+
+#define CUSTAT_RDV	(1 << 0)	/* Receive data valid */
+#define CUSTAT_BSD	(1 << 1)	/* Break signal detected */
+#define CUSTAT_FER	(1 << 2)	/* Framing error */
+#define CUSTAT_PER	(1 << 3)	/* Parity Error */
+#define CUSTAT_OER	(1 << 4)	/* Overrun error */
+#define CUSTAT_CCD	(1 << 5)	/* Control character detected */
+#define CUSTAT_RXIDLE	(1 << 11)	/* Receiver in idle */
+#define CUSTAT_TI	(1 << 17)	/* Transmitter idle */
+#define CUSTAT_THE	(1 << 18)	/* Transmit holding register empty */
+
+
+/*
+ * General Purpose I/O
+ */
+#define IOPB		0x00030000
+#define IOP		(ASIC_BASE + IOPB)
+
+#define IOPMODE1	__REG2(IOP, 0x00)
+#define IOPMODE2	__REG2(IOP, 0x04)
+#define IOPCON1		__REG2(IOP, 0x08)
+#define IOPCON2		__REG2(IOP, 0x0C)
+#define IOPGDMA		__REG2(IOP, 0x10)
+#define IOPEXTINT	__REG2(IOP, 0x14)
+#define IOPEXTINTPND	__REG2(IOP, 0x18)
+#define IOPDATA1	__REG2(IOP, 0x1C)
+#define IOPDATA2	__REG2(IOP, 0x20)
+#define IOPDRV1		__REG2(IOP, 0x24)
+#define IOPDRV2		__REG2(IOP, 0x28)
+
+/*
+ * Interrupt controller
+ */
+
+#define INTCFGB		0x00140000
+#define INTCFG		(ASIC_BASE + INTCFGB)
+
+#define INTMOD		__REG2(INTCFG,0x00)
+#define EXTMOD		__REG2(INTCFG,0x04)
+#define INTMASK		__REG2(INTCFG,0x08)
+#define INTMASK_ALL	(0xffffffff)
+#define EXTMASK		__REG2(INTCFG,0x0c)
+#define EXTMASK_ALL	(0x0000007f)
+#define IPRIORHI	__REG2(INTCFG,0x10)
+#define IPRIORLO	__REG2(INTCFG,0x14)
+#define INTOFFSET_FIQ	__REG2(INTCFG,0x18)
+#define INTOFFSET_IRQ	__REG2(INTCFG,0x1c)
+#define INTPRIOR0	__REG2(INTCFG,0x20)
+#define INTPRIOR1	__REG2(INTCFG,0x24)
+#define INTPRIOR2	__REG2(INTCFG,0x28)
+#define INTPRIOR3	__REG2(INTCFG,0x2c)
+#define INTPRIOR4	__REG2(INTCFG,0x30)
+#define INTPRIOR5	__REG2(INTCFG,0x34)
+#define INTPRIOR6	__REG2(INTCFG,0x38)
+#define INTPRIOR7	__REG2(INTCFG,0x3c)
+#define INTPRIOR8	__REG2(INTCFG,0x40)
+#define INTPRIOR9	__REG2(INTCFG,0x44)
+#define INTTSTHI	__REG2(INTCFG,0x48)
+#define INTTSTLO	__REG2(INTCFG,0x4c)
+
+
+
+/*
+ * Timers
+ */
+
+#define TIMER_BASEB	0x00040000
+#define TIMER_BASE	(ASIC_BASE + TIMER_BASEB)
+
+#define TMOD		__REG2(TIMER_BASE, 0x00)
+#define TDATA0		__REG2(TIMER_BASE, 0x10)
+#define TDATA1		__REG2(TIMER_BASE, 0x18)
+#define TDATA2		__REG2(TIMER_BASE, 0x20)
+#define TDATA3		__REG2(TIMER_BASE, 0x28)
+#define TDATA4		__REG2(TIMER_BASE, 0x30)
+#define TDATA5		__REG2(TIMER_BASE, 0x38)
+#define TCNT0		__REG2(TIMER_BASE, 0x14)
+#define TCNT1		__REG2(TIMER_BASE, 0x1C)
+#define TCNT2		__REG2(TIMER_BASE, 0x24)
+#define TCNT3		__REG2(TIMER_BASE, 0x2C)
+#define TCNT4		__REG2(TIMER_BASE, 0x34)
+#define TCNT5		__REG2(TIMER_BASE, 0x3C)
+#define TIC		__REG2(TIMER_BASE, 0x04)
+#define WDT		__REG2(TIMER_BASE, 0x08)
+
+#define TIMER_TE0	(1 << 0)
+#define TIMER_TMD0	(1 << 1)
+#define TIMER_CLR0	(1 << 2)
+#define TIMER_TE1	(1 << 3)
+#define TIMER_TMD1	(1 << 4)
+#define TIMER_CLR1	(1 << 5)
+#define TIMER_TE2	(1 << 6)
+#define TIMER_TMD2	(1 << 7)
+#define TIMER_CLR2	(1 << 8)
+#define TIMER_TE3	(1 << 9)
+#define TIMER_TMD3	(1 << 10)
+#define TIMER_CLR3	(1 << 11)
+#define TIMER_TE4	(1 << 12)
+#define TIMER_TMD4	(1 << 13)
+#define TIMER_CLR4	(1 << 14)
+#define TIMER_TE5	(1 << 15)
+#define TIMER_TMD5	(1 << 16)
+#define TIMER_CLR5	(1 << 17)
+
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/shannon.h
diff -u build_tree/bootLoader/include/blob/arch/shannon.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/shannon.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/shannon.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/shannon.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: shannon.h,v 1.5 2001/12/08 07:04:30 timriker Exp $
+ * $Id: shannon.h,v 1.13 2002/04/30 23:30:13 timriker Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,27 +21,50 @@
  *
  */
 
-#ident "$Id: shannon.h,v 1.5 2001/12/08 07:04:30 timriker Exp $"
+#ident "$Id: shannon.h,v 1.13 2002/04/30 23:30:13 timriker Exp $"
 
 #ifndef BLOB_ARCH_SHANNON_H
 #define BLOB_ARCH_SHANNON_H
 
-
-
-
-
 /* boot CPU speed */
-#define CPU_SPEED		(0x09)
-
+#define CPU_SPEED		CPU_CORE_SPEED_191mhz
 
 /* serial port */
 #define USE_SERIAL3
-
+#define TERMINAL_SPEED baud_115200
 
 /* GPIO for the LED */
-#define LED_GPIO		(0x00000000) /* safe mode: no GPIO, no LED */
-
+#define LED_GPIO		(0x00040000) /* GPIO 18, codec (ucb1300) reset */
 
+/* to connect this up, you'll need an LED and a resistor (100ohm - 1k will probably do)
+ *
+ *             o o o  =\ =o o o o            o o    ___________ \
+ *           33| |  \   \ |//|               | |  1////-33 \ \ \ |/--\o
+ *           --+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-- |||| --+-+-+-+-+-+-+
+ *           | : : : : : : : : : : : : : : : : : | |||| | : : : : : : :
+ *           --+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-- |||| --+-+-+-+-+-+-+
+ * <-- front 34o o o o o|o o   J601  o|||||||| o  2|||| 34o J600o|o|o|o       back -->
+ *             |       /   /\       /\o|o|o|o|     ||||   |      | | |
+ *                         ||       ||
+ *                         ||       ||
+ *                       GPIO18     GND
+ *
+ * This is supposed to be ascii art of the daughter board rotated 90 degrees clockwise.
+ * An LED and resistor should be connected between the two vias indicated by GPIO18 and
+ * GND. These vias are on either side of the J601 silk label. The circuit should be connected
+ * as shown below (other interpretations sholud work as well).
+ *
+ *
+ *                        |\ |
+ *    GPIO18 o---/\/\/\---| >|---------o GND 
+ *                        |/ |
+ *
+ *                 R1      D1
+ *
+ *
+ * A little excessive description maybe, but I don't want anyone blowing up their tux :)
+ *
+ */
 /* Shannon memory layout is a bit precious because we want to be able
  * to load blob at the correct location for both 8 and 32MB
  * SODIMMs. We assume that the following amount of memory is at least
@@ -57,34 +80,36 @@
 /* the base address were blob-rest is loaded by the first stage loader */
 #define BLOB_ABS_BASE_ADDR	(0xc8000400)
 
-
 /* where do various parts live in RAM */
 #define BLOB_RAM_BASE		(0xc0120000)
 #define KERNEL_RAM_BASE		(0xc0008000)
 #define PARAM_RAM_BASE		(0xc8040000)
 #define RAMDISK_RAM_BASE	(0xd0000000)
 
-#define PARAM_START PARAM_RAM_BASE
-
 /* and where do they live in flash */
 #define BLOB_FLASH_BASE		(0x00000000)
 #define BLOB_FLASH_LEN		(64 * 1024)
 #define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
 #define PARAM_FLASH_LEN		(64 * 1024)
 #define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
-#define KERNEL_FLASH_LEN	((1024 - 128) * 1024)
+#define KERNEL_FLASH_LEN	((1024 - 128) * 1024) /* RAM_LEN if load_kernel */
+#define LOAD_RAMDISK		0 /* leave ramdisk in flash */
+
+#if defined(CONFIG_CRAMFS_SUPPORT) || defined(CONFIG_JFFS2_SUPPORT)
+#define RAMDISK_FLASH_BASE	KERNEL_FLASH_BASE
+#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN)
+#else
 #define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
 #define RAMDISK_FLASH_LEN	(4 * 1024 * 1024 - BLOB_FLASH_LEN - PARAM_FLASH_LEN - KERNEL_FLASH_LEN)
+#endif
 
+#define PARAM_START PARAM_FLASH_BASE
+#define PARAM_LEN PARAM_FLASH_LEN
 
 /* the position of the kernel boot parameters */
 #define BOOT_PARAMS		(0xc0000100)
 
-
 /* the size (in kbytes) to which the compressed ramdisk expands */
 #define RAMDISK_SIZE		(8 * 1024)
 
-
-
-
 #endif
Index: build_tree/bootLoader/include/blob/arch/smdk2500.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/smdk2500.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/smdk2500.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,77 @@
+/*
+ * smdk2500.h: SMDK2500 specific defines
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Russ Dill <Russ.Dill@asu.edu>
+ *
+ * $Id: smdk2500.h,v 1.1 2003/09/04 18:10:42 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: smdk2500.h,v 1.1 2003/09/04 18:10:42 russd Exp $"
+
+#ifndef BLOB_ARCH_SMDK2500_H
+#define BLOB_ARCH_SMDK2500_H
+
+
+#define TERMINAL_SPEED baud_115200
+
+#define CPU_SPEED SPEED_166MHz
+#define BUS_SPEED SPEED_133MHz
+
+
+/* GPIO for the LED */
+#define LED_GPIO		0x00000001 /* GPIO 0 */
+
+
+/* the base address were blob-rest is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0x40200400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0x40100000)
+#define PARAM_RAM_BASE		(0x40110000)
+#define KERNEL_RAM_BASE		(0x40008000)
+#define RAMDISK_RAM_BASE	(0x40400000)
+#define RAM_START		(0x41000000)
+
+/* and where do they live in flash */
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(64 * 1024)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(64 * 1024)
+#define SMDK2500_ERASE_BLOCK	(64 * 1024)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(SMDK2500_ERASE_BLOCK * (32 - 2))
+#define LOAD_RAMDISK		0 /* load ramdisk into ram */
+#define RAMDISK_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(SMDK2500_ERASE_BLOCK * (32 - 2))
+
+#define PARAM_START PARAM_FLASH_BASE
+#define PARAM_LEN PARAM_FLASH_LEN
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0x40000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(8 * 1024)
+
+
+
+
+#endif
Index: build_tree/bootLoader/include/blob/arch/system3.h
diff -u build_tree/bootLoader/include/blob/arch/system3.h:1.1.1.1 build_tree/bootLoader/include/blob/arch/system3.h:1.1.1.2
--- build_tree/bootLoader/include/blob/arch/system3.h:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/include/blob/arch/system3.h	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: system3.h,v 1.9 2002/01/07 16:31:25 seletz Exp $
+ * $Id: system3.h,v 1.20 2003/08/21 12:43:44 seletz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,25 +21,32 @@
  *
  */
 
-#ident "$Id: system3.h,v 1.9 2002/01/07 16:31:25 seletz Exp $"
+#ident "$Id: system3.h,v 1.20 2003/08/21 12:43:44 seletz Exp $"
 
 #ifndef BLOB_ARCH_SYSTEM3_H
 #define BLOB_ARCH_SYSTEM3_H
 
+//#define	CPU_SPEED_133
 #undef	CPU_SPEED_133
 
+/* SYSTEM3 with 64 MB SDRAM, all on bank0 */
+//#undef CONFIG_SYSTEM3_REV0802
+#define CONFIG_SYSTEM3_REV0802
+
 /* boot CPU speed */
 #ifdef CPU_SPEED_133
-#	define CPU_SPEED		(0x05)
+#	define CPU_SPEED		(CPU_CORE_SPEED_132mhz)
 #else
-#	define CPU_SPEED		(0x0a)
+#	define CPU_SPEED		(CPU_CORE_SPEED_206mhz)
 #endif
 
 /* serial port */
 #define USE_SERIAL1
+#define TERMINAL_SPEED baud_115200
 
 /* GPIO for the LED */
-#define LED_GPIO		(0x00000400) /* GPIO 10 */
+//#define LED_GPIO		(0x00800000) /* GPIO 10 */
+#define LED_GPIO		(0x00000000) /* NO LED */
 
 
 /* the base address were BLOB is loaded by the first stage loader */
@@ -52,16 +59,36 @@
 #define PARAM_RAM_BASE		(0xc0110000)
 #define RAMDISK_RAM_BASE	(0xC0400000)
 
+/* hmm, do i need these ? */
+#define PARAM_FLASH_BASE	(0x00040000)
+#define PARAM_FLASH_LEN		(256 * 1024)
+
 
 /* and where do they live in flash */
 #define BLOB_FLASH_BASE		(0x00000000)
-#define BLOB_FLASH_LEN		(256 * 1024)
-#define PARAM_FLASH_BASE	(0x00040000)
-#define PARAM_FLASH_LEN		(256 * 1024)
-#define KERNEL_FLASH_BASE	(0x00080000)
-#define KERNEL_FLASH_LEN	(1024 * 1024)
-#define RAMDISK_FLASH_BASE	(0x00180000)
-#define RAMDISK_FLASH_LEN	(4 * 1024 * 1024)
+#define BLOB_FLASH_LEN		(0x00040000)
+#define CONFIG_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define CONFIG_FLASH_LEN	(0x00040000)
+#define KERNEL_FLASH_BASE	(CONFIG_FLASH_BASE + CONFIG_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(0x00100000)
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(0x00180000)
+#define ROOTFS_FLASH_BASE	(RAMDISK_FLASH_BASE + RAMDISK_FLASH_LEN)
+#define ROOTFS_FLASH_LEN	(0x00700000)
+#define DATAFS_FLASH_BASE	(ROOTFS_FLASH_BASE + ROOTFS_FLASH_LEN)
+#define DATAFS_FLASH_LEN	(0x015c0000)
+#define XDATAFS_FLASH_BASE	(DATAFS_FLASH_BASE + DATAFS_FLASH_LEN)
+#define XDATAFS_FLASH_LEN	(0x00040000)
+#define LOAD_RAMDISK		1 /* load ramdisk into ram */
+
+/* system3 RAM pool for up/downloading */
+#if !defined(CONFIG_SYSTEM3_REV0802)
+#define RAM_START			(0xd0000000)
+#define RAM_SIZE			(16*1024*1024)
+#else
+#define RAM_START			(0xc1000000)
+#define RAM_SIZE			(0x03000000)
+#endif
 
 
 /* the position of the kernel boot parameters */
@@ -71,25 +98,36 @@
 /* the size (in kbytes) to which the compressed ramdisk expands */
 #define RAMDISK_SIZE		(8 * 1024)
 
+/* let SDRAM run at FULL memclk speed */
+#define MDREFR_MEMCLK_FULLSPEED_0
+#define MDREFR_MEMCLK_FULLSPEED_1
+#define MDREFR_MEMCLK_FULLSPEED_2
 
 /* Memory configuration */
 #ifdef BLOB_NEED_MEMCONFIG
-#define MSC0_VALUE_66_150     MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(10) | MSC_RDN(2) | MSC_RRR(1)
-#define MSC0_VALUE_66_120     MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 8) | MSC_RDN(2) | MSC_RRR(1)
-#define MSC0_VALUE_66_100     MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 7) | MSC_RDN(2) | MSC_RRR(1)
-#define MSC1_VALUE_66         MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1) | ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
-#define MSC2_VALUE_66         MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(7)  | MSC_RDN(2) | MSC_RRR(1)
-#define MECR_VALUE_66         0xFFFFFFFF
-#define MSC0_VALUE_100_150    MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(16) | MSC_RDN(3) | MSC_RRR(2)
-#define MSC0_VALUE_100_120    MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(13) | MSC_RDN(3) | MSC_RRR(2)
-#define MSC0_VALUE_100_100    MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(11) | MSC_RDN(3) | MSC_RRR(2)
-#define MSC1_VALUE_100        MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1)| ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
-#define MSC2_VALUE_100        MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(9)  | MSC_RDN(2) | MSC_RRR(1)
-#define MECR_VALUE_100        0xFFFFFFFF
+#define MSC0_VALUE_66_150	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(10) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC0_VALUE_66_120	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 8) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC0_VALUE_66_100	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF( 7) | MSC_RDN(2) | MSC_RRR(1)
+#define MSC1_VALUE_66		MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1) | ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
+#define MSC2_VALUE_66		MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(13)  | MSC_RDN(6) | MSC_RRR(3)
+#define MECR_VALUE_66		MECR_BSIO0(0x1f) | MECR_BSA0(0x1f) | MECR_BSM0(0x1f) | MECR_BSIO1(0x1f) | MECR_BSA1(0x1f) | MECR_BSM1(0x1f)
+
+#define MSC0_VALUE_100_150	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(16) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC0_VALUE_100_120	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(13) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC0_VALUE_100_100	MSC_RT_ROMFLASH | MSC_RBW32 | MSC_RDF(11) | MSC_RDN(3) | MSC_RRR(2)
+#define MSC1_VALUE_100		MSC_RT_ROMFLASH | MSC_RBW16 | MSC_RDF(5)  | MSC_RDN(1) | MSC_RRR(1)| ((MSC_RT_VARLAT_345 | MSC_RBW16 | MSC_RDF(30)  | MSC_RDN(30) | MSC_RRR(7))<<16)
+#define MSC2_VALUE_100		MSC_RT_VARLAT_345 | MSC_RBW32 | MSC_RDF(13)  | MSC_RDN(6) | MSC_RRR(3)
+#define MECR_VALUE_100		MECR_BSIO0(0x1f) | MECR_BSA0(0x1f) | MECR_BSM0(0x1f) | MECR_BSIO1(0x1f) | MECR_BSA1(0x1f) | MECR_BSM1(0x1f)
 
 #ifndef CPU_SPEED_133
 //	206 Mhz
-#	define MDCNFG_VALUE	0x72547254
+#if defined(CONFIG_SYSTEM3_REV0802)
+#	define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(6) | MDCNFG_CDB20(0) | MDCNFG_TRP0(2) | MDCNFG_TDL0(3) | MDCNFG_TWR0(1) | \
+						MDCNFG_DTIM2_SDRAM | MDCNFG_DWID2_32B | MDCNFG_DRAC2(6) | MDCNFG_CDB22(0) | MDCNFG_TRP2(2) | MDCNFG_TDL2(3) | MDCNFG_TWR2(1)
+#else
+#	define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(5) | MDCNFG_CDB20(0) | MDCNFG_TRP0(2) | MDCNFG_TDL0(3) | MDCNFG_TWR0(1) | \
+						MDCNFG_DTIM2_SDRAM | MDCNFG_DWID2_32B | MDCNFG_DRAC2(5) | MDCNFG_CDB22(0) | MDCNFG_TRP2(2) | MDCNFG_TDL2(3) | MDCNFG_TWR2(1)
+#endif
 #	define MDCAS00_VALUE	0xAAAAAA9F
 #	define MDCAS01_VALUE	0xAAAAAAAA
 #	define MDCAS02_VALUE	0xAAAAAAAA
@@ -103,7 +141,13 @@
 #	define SMCNFG_VALUE	0
 #else
 //	133 Mhz
-#	define MDCNFG_VALUE	0x72547254
+#if defined(CONFIG_SYSTEM3_REV0802)
+#	define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(6) | MDCNFG_CDB20(0) | MDCNFG_TRP0(2) | MDCNFG_TDL0(3) | MDCNFG_TWR0(1) | \
+						MDCNFG_DTIM2_SDRAM | MDCNFG_DWID2_32B | MDCNFG_DRAC2(6) | MDCNFG_CDB22(0) | MDCNFG_TRP2(2) | MDCNFG_TDL2(3) | MDCNFG_TWR2(1)
+#else
+#	define MDCNFG_VALUE	MDCNFG_DTIM0_SDRAM | MDCNFG_DWID0_32B | MDCNFG_DRAC0(5) | MDCNFG_CDB20(0) | MDCNFG_TRP0(2) | MDCNFG_TDL0(3) | MDCNFG_TWR0(1) | \
+						MDCNFG_DTIM2_SDRAM | MDCNFG_DWID2_32B | MDCNFG_DRAC2(5) | MDCNFG_CDB22(0) | MDCNFG_TRP2(2) | MDCNFG_TDL2(3) | MDCNFG_TWR2(1)
+#endif
 #	define MDCAS00_VALUE	0xAAAAAA9F
 #	define MDCAS01_VALUE	0xAAAAAAAA
 #	define MDCAS02_VALUE	0xAAAAAAAA
@@ -130,6 +174,20 @@
 #endif
 
 #define	SA1111_BASE		(0x40000000)
-#define	SA1111_VBASE	(0x40000000)
+
+#define SYSTEM3_SYSID		(0x10000000)
+#define SYSTEM3_CTRL_0		(0x10000090)
+#define SYSTEM3_CTRL_1		(0x100000A0)
+#define SYSTEM3_CTRL_2		(0x100000B0)
+#define SYSTEM3_CTRL_IRR	(0x10000024)
+
+/* System ID register */
+#define PT_SYSID	(*((volatile u8 *)SYSTEM3_SYSID))
+#define PT_ID_BOARDID	(( PT_SYSID & 0xE0 ) >> 5 )
+#define PT_ID_REVISION	( PT_SYSID & 0x1F )
+
+#define PT_BOARD_ALPHA	( 0 )
+#define PT_BOARD_SYS3	( 1 )
+#define PT_BOARD_DAFIT	( 2 )
 
 #endif
Index: build_tree/bootLoader/include/blob/arch/trizeps.h
diff -u /dev/null build_tree/bootLoader/include/blob/arch/trizeps.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/arch/trizeps.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,95 @@
+/*
+ * trizeps.h: Keith & Koep Trizeps board specific defines
+ *
+ * Copyright (C) 2002	Wolfgang Mller (wolfgang.mueller@dsa-ac.de)
+ *
+ * $Id: trizeps.h,v 1.1 2002/04/23 13:29:56 seletz Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: trizeps.h,v 1.1 2002/04/23 13:29:56 seletz Exp $"
+
+#ifndef BLOB_ARCH_TRIZEPS_H
+#define BLOB_ARCH_TRIZEPS_H
+
+/* boot CPU speed */
+#define CPU_SPEED		CPU_CORE_SPEED_191mhz
+
+/* serial port, depends on motherboard where trizeps is plugged in */
+#define USE_SERIAL3
+#define TERMINAL_SPEED baud_38400
+
+/* GPIO for the LED */
+#define LED_GPIO			(0)
+
+/* the base address were BLOB is loaded by the first stage loader */
+#define BLOB_ABS_BASE_ADDR	(0xC0200400)
+
+
+/* where do various parts live in RAM */
+#define BLOB_RAM_BASE		(0xC0100000)
+#define PARAM_RAM_BASE		(0xC0110000)
+#define KERNEL_RAM_BASE		(0xC0008000)
+#define RAMDISK_RAM_BASE	(0xC0400000)
+
+
+/* their size (in bytes) and where do they live in flash*/
+#define BLOB_FLASH_BASE		(0x00000000)
+#define BLOB_FLASH_LEN		(1024 * 512)
+#define PARAM_FLASH_BASE	(BLOB_FLASH_BASE + BLOB_FLASH_LEN)
+#define PARAM_FLASH_LEN		(1024 * 512)
+#define KERNEL_FLASH_BASE	(PARAM_FLASH_BASE + PARAM_FLASH_LEN)
+#define KERNEL_FLASH_LEN	(1024 * 1024 * 1)
+#define RAMDISK_FLASH_BASE	(KERNEL_FLASH_BASE + KERNEL_FLASH_LEN)
+#define RAMDISK_FLASH_LEN	(1024 * 1024 * 16 - BLOB_FLASH_LEN \
+						  - PARAM_FLASH_LEN \
+						  - KERNEL_FLASH_LEN)
+#define LOAD_RAMDISK		0 /* leave ramdisk in flash */
+// #define LOAD_RAMDISK		1 /* load ramdisk into ram */
+
+
+/* the position of the kernel boot parameters */
+#define BOOT_PARAMS		(0xC0000100)
+
+
+/* the size (in kbytes) to which the compressed ramdisk expands */
+#define RAMDISK_SIZE		(1024 * 8)
+
+
+/* Memory configuration */
+#ifdef BLOB_NEED_MEMCONFIG	/* Values extracted from original K & K boot */
+#warning "use defines from memsetup.h for better readability"
+#	define MDCNFG_VALUE	0x7354B455		/* 0x00 MDCNFG */
+#	define MDCAS00_VALUE	0xAAAAAA9F		/* 0x04 MDCAS00 */
+#	define MDCAS01_VALUE	0xAAAAAAAA		/* 0x08 MDCAS01 */
+#	define MDCAS02_VALUE	0xAAAAAAAA		/* 0x0C MDCAS02 */
+#	define MSC0_VALUE	0x4C804C84		/* 0x10 MCS0 */
+#	define MSC1_VALUE	0x497572D4		/* 0x14 MCS1 */
+#	define MECR_VALUE	0x08640464		/* 0x18 MECR */
+#	define MDREFR_VALUE	DO_NOT_USE_THIS_VALUE__GETS_AUTOMAGICALLY_COMPUTED
+#	define MDCAS20_VALUE	0xAAAAAA7F		/* 0x20 MDCAS20 */
+#	define MDCAS21_VALUE	0xAAAAAAAA		/* 0x24 MDCAS21 */
+#	define MDCAS22_VALUE	0xAAAAAAAA		/* 0x28 MDCAS22 */
+#	define MSC2_VALUE	0x211154E0		/* 0x2C MCS2 */
+#	define SMCNFG_VALUE	0xA040A040		/* 0x30 SMCNFG */
+#endif
+
+#define TRIZEPS_DEBUG 1
+
+#endif /* BLOB_ARCH_TRIZEPS_H */
+
+/* eof */
Index: build_tree/bootLoader/include/blob/proc/.cvsignore
diff -u /dev/null build_tree/bootLoader/include/blob/proc/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/proc/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile
+Makefile.in
Index: build_tree/bootLoader/include/blob/proc/Makefile.am
diff -u /dev/null build_tree/bootLoader/include/blob/proc/Makefile.am:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/proc/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,19 @@
+# -*- makefile -*-
+###########################################################################
+## Filename:      Makefile.am
+## Version:       $Id: Makefile.am,v 1.2 2003/09/04 18:03:09 russd Exp $
+## Copyright:     Copyright (C) 1999, Erik Mouw
+## Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+## Description:   Makefile
+## Created at:    Tue Aug 17 17:25:56 1999
+## Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+## Modified at:   Tue Sep 28 23:36:51 1999
+###########################################################################
+
+noinst_HEADERS	= \
+	pxa.h \
+	s3c2500.h \
+	sa1100.h \
+	sa1111.h
+
+CLEANFILES	= ${srcdir}/*~
Index: build_tree/bootLoader/include/blob/proc/Makefile.in
diff -u /dev/null build_tree/bootLoader/include/blob/proc/Makefile.in:1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/proc/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -0,0 +1,374 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+# -*- makefile -*-
+###########################################################################
+###########################################################################
+
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+VPATH = @srcdir@
+pkgdatadir = $(datadir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+top_builddir = ../../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = @INSTALL@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = @host@
+subdir = include/blob/proc
+DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
+	$(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+HEADERS = $(noinst_HEADERS)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
+AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
+BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
+CC = @CC@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
+LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
+MAKEINFO = @MAKEINFO@
+OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
+OCFLAGS = @OCFLAGS@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+noinst_HEADERS = \
+	pxa.h \
+	s3c2500.h \
+	sa1100.h \
+	sa1111.h
+
+CLEANFILES = ${srcdir}/*~
+all: all-am
+
+.SUFFIXES:
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  include/blob/proc/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  include/blob/proc/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(HEADERS)
+installdirs:
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic mostlyclean-am
+
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	ctags distclean distclean-generic distclean-tags distdir dvi \
+	dvi-am html html-am info info-am install install-am \
+	install-data install-data-am install-exec install-exec-am \
+	install-info install-info-am install-man install-strip \
+	installcheck installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-generic pdf \
+	pdf-am ps ps-am tags uninstall uninstall-am uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/include/blob/proc/pxa.h
diff -u /dev/null build_tree/bootLoader/include/blob/proc/pxa.h:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/proc/pxa.h	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,265 @@
+
+/*
+ * proc/pxa.h - processor specific defines
+ * 
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Abraham van der Merwe <abz@4dllc.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_PXA_PROC_H
+#define BLOB_PXA_PROC_H
+
+#define io_p2v(x) (x)
+#define io_v2p(x) (x)
+
+#ifndef __ASSEMBLY__
+
+#define __REG(x)	(*((volatile u32 *)io_p2v(x)))
+
+#define __REG2(x,y)	\
+	( __builtin_constant_p(y) ? (__REG((x) + (y))) \
+				  : (*(volatile u32 *)((u32)&__REG(x) + (y))) )
+
+# define __PREG(x)	(io_v2p((u32)&(x)))
+
+#else
+
+# define __REG(x)	io_p2v(x)
+# define __PREG(x)	io_v2p(x)
+
+#endif
+
+
+#define __ASM_ARCH_HARDWARE_H
+// TODO
+// Some Patches by Adrian van der Merwe didn't make it yet into Russels/Nico's
+// Linux patches, so for now we use our local pxa-regs.h file
+//#include <asm-arm/arch-pxa/pxa-regs.h>
+#include <blob/arch/pxa-regs.h>
+
+/* memory start and end */
+#define MEMORY_START		(0xa0000000)
+#define MEMORY_END			(0xa4000000)
+
+#define GPIO_OUT_LO_BIT 4
+#define GPIO_OUT_HI_BIT 5
+
+#define GPIO_INPUT		0
+#define GPIO_OUT_LO		(1 << GPIO_OUT_LO_BIT)
+#define GPIO_OUT_HI		(1 << GPIO_OUT_HI_BIT)
+
+#define GPIO_ALT_FN1	0x01
+#define GPIO_ALT_FN2	0x02
+#define GPIO_ALT_FN3	0x03
+#define GPIO_ALT_FN_MASK (GPIO_ALT_FN1 | GPIO_ALT_FN2 | GPIO_ALT_FN3)
+
+#define _SB(x) (((x) & GPIO_OUT_HI) >> GPIO_OUT_HI_BIT)
+#define _SM(x) (_SB(GPIO##x##_VALUE) * GPIO_bit (x))
+
+#define GPSR0_VALUE (								\
+		_SM(0) | _SM(1) | _SM(2) | _SM(3) |			\
+		_SM(4) | _SM(5) | _SM(6) | _SM(7) |			\
+		_SM(8) | _SM(9) | _SM(10) | _SM(11) |		\
+		_SM(12) | _SM(13) | _SM(14) | _SM(15) |		\
+		_SM(16) | _SM(17) | _SM(18) | _SM(19) |		\
+		_SM(20) | _SM(21) | _SM(22) | _SM(23) |		\
+		_SM(24) | _SM(25) | _SM(26) | _SM(27) |		\
+		_SM(28) | _SM(29) | _SM(30) | _SM(31)		\
+	)
+
+#define GPSR1_VALUE (								\
+		_SM(32) | _SM(33) | _SM(34) | _SM(35) |		\
+		_SM(36) | _SM(37) | _SM(38) | _SM(39) |		\
+		_SM(40) | _SM(41) | _SM(42) | _SM(43) |		\
+		_SM(44) | _SM(45) | _SM(46) | _SM(47) |		\
+		_SM(48) | _SM(49) | _SM(50) | _SM(51) |		\
+		_SM(52) | _SM(53) | _SM(54) | _SM(55) |		\
+		_SM(56) | _SM(57) | _SM(58) | _SM(59) |		\
+		_SM(60) | _SM(61) | _SM(62) | _SM(63)		\
+	)
+
+#define GPSR2_VALUE (								\
+		_SM(64) | _SM(65) | _SM(66) | _SM(67) |		\
+		_SM(68) | _SM(69) | _SM(70) | _SM(71) |		\
+		_SM(72) | _SM(73) | _SM(74) | _SM(75) |		\
+		_SM(76) | _SM(77) | _SM(78) | _SM(79) |		\
+		_SM(80) | _SM(81) | _SM(82) | _SM(83) |		\
+		_SM(84)										\
+	)
+
+#define _CB(x) (((x) & GPIO_OUT_LO) >> GPIO_OUT_LO_BIT)
+#define _CM(x) (_CB(GPIO##x##_VALUE) * GPIO_bit (x))
+
+#define GPCR0_VALUE (								\
+		_CM(0) | _CM(1) | _CM(2) | _CM(3) |			\
+		_CM(4) | _CM(5) | _CM(6) | _CM(7) |			\
+		_CM(8) | _CM(9) | _CM(10) | _CM(11) |		\
+		_CM(12) | _CM(13) | _CM(14) | _CM(15) |		\
+		_CM(16) | _CM(17) | _CM(18) | _CM(19) |		\
+		_CM(20) | _CM(21) | _CM(22) | _CM(23) |		\
+		_CM(24) | _CM(25) | _CM(26) | _CM(27) |		\
+		_CM(28) | _CM(29) | _CM(30) | _CM(31)		\
+	)
+
+#define GPCR1_VALUE (								\
+		_CM(32) | _CM(33) | _CM(34) | _CM(35) |		\
+		_CM(36) | _CM(37) | _CM(38) | _CM(39) |		\
+		_CM(40) | _CM(41) | _CM(42) | _CM(43) |		\
+		_CM(44) | _CM(45) | _CM(46) | _CM(47) |		\
+		_CM(48) | _CM(49) | _CM(50) | _CM(51) |		\
+		_CM(52) | _CM(53) | _CM(54) | _CM(55) |		\
+		_CM(56) | _CM(57) | _CM(58) | _CM(59) |		\
+		_CM(60) | _CM(61) | _CM(62) | _CM(63)		\
+	)
+
+#define GPCR2_VALUE (								\
+		_CM(64) | _CM(65) | _CM(66) | _CM(67) |		\
+		_CM(68) | _CM(69) | _CM(70) | _CM(71) |		\
+		_CM(72) | _CM(73) | _CM(74) | _CM(75) |		\
+		_CM(76) | _CM(77) | _CM(78) | _CM(79) |		\
+		_CM(80) | _CM(81) | _CM(82) | _CM(83) |		\
+		_CM(84)										\
+	)
+
+#define _DB(x) (_SB(x) | _CB(x))
+#define _DM(x) (_DB(GPIO##x##_VALUE) * GPIO_bit (x))
+
+#define GPDR0_VALUE (								\
+		_DM(0) | _DM(1) | _DM(2) | _DM(3) |			\
+		_DM(4) | _DM(5) | _DM(6) | _DM(7) |			\
+		_DM(8) | _DM(9) | _DM(10) | _DM(11) |		\
+		_DM(12) | _DM(13) | _DM(14) | _DM(15) |		\
+		_DM(16) | _DM(17) | _DM(18) | _DM(19) |		\
+		_DM(20) | _DM(21) | _DM(22) | _DM(23) |		\
+		_DM(24) | _DM(25) | _DM(26) | _DM(27) |		\
+		_DM(28) | _DM(29) | _DM(30) | _DM(31)		\
+	)
+
+#define GPDR1_VALUE (								\
+		_DM(32) | _DM(33) | _DM(34) | _DM(35) |		\
+		_DM(36) | _DM(37) | _DM(38) | _DM(39) |		\
+		_DM(40) | _DM(41) | _DM(42) | _DM(43) |		\
+		_DM(44) | _DM(45) | _DM(46) | _DM(47) |		\
+		_DM(48) | _DM(49) | _DM(50) | _DM(51) |		\
+		_DM(52) | _DM(53) | _DM(54) | _DM(55) |		\
+		_DM(56) | _DM(57) | _DM(58) | _DM(59) |		\
+		_DM(60) | _DM(61) | _DM(62) | _DM(63)		\
+	)
+
+#define GPDR2_VALUE (								\
+		_DM(64) | _DM(65) | _DM(66) | _DM(67) |		\
+		_DM(68) | _DM(69) | _DM(70) | _DM(71) |		\
+		_DM(72) | _DM(73) | _DM(74) | _DM(75) |		\
+		_DM(76) | _DM(77) | _DM(78) | _DM(79) |		\
+		_DM(80) | _DM(81) | _DM(82) | _DM(83) |		\
+		_DM(84)										\
+	)
+
+#define _FB(x) ((x) & GPIO_ALT_FN_MASK)
+#define _FM(x) (_FB(GPIO##x##_VALUE) << (((x) & 0x0f) << 1))
+
+#define GAFR0_L_VALUE (								\
+		_FM(0) | _FM(1) | _FM(2) | _FM(3) |			\
+		_FM(4) | _FM(5) | _FM(6) | _FM(7) |			\
+		_FM(8) | _FM(9) | _FM(10) | _FM(11) |		\
+		_FM(12) | _FM(13) | _FM(14) | _FM(15)		\
+	)
+
+#define GAFR0_U_VALUE (								\
+		_FM(16) | _FM(17) | _FM(18) | _FM(19) |		\
+		_FM(20) | _FM(21) | _FM(22) | _FM(23) |		\
+		_FM(24) | _FM(25) | _FM(26) | _FM(27) |		\
+		_FM(28) | _FM(29) | _FM(30) | _FM(31)		\
+	)
+
+#define GAFR1_L_VALUE (								\
+		_FM(32) | _FM(33) | _FM(34) | _FM(35) |		\
+		_FM(36) | _FM(37) | _FM(38) | _FM(39) |		\
+		_FM(40) | _FM(41) | _FM(42) | _FM(43) |		\
+		_FM(44) | _FM(45) | _FM(46) | _FM(47)		\
+	)
+
+#define GAFR1_U_VALUE (								\
+		_FM(48) | _FM(49) | _FM(50) | _FM(51) |		\
+		_FM(52) | _FM(53) | _FM(54) | _FM(55) |		\
+		_FM(56) | _FM(57) | _FM(58) | _FM(59) |		\
+		_FM(60) | _FM(61) | _FM(62) | _FM(63)		\
+	)
+
+#define GAFR2_L_VALUE (								\
+		_FM(64) | _FM(65) | _FM(66) | _FM(67) |		\
+		_FM(68) | _FM(69) | _FM(70) | _FM(71) |		\
+		_FM(72) | _FM(73) | _FM(74) | _FM(75) |		\
+		_FM(76) | _FM(77) | _FM(78) | _FM(79)		\
+	)
+
+#define GAFR2_U_VALUE (								\
+		_FM(80) | _FM(81) | _FM(82) | _FM(83) |		\
+		_FM(84)										\
+	)
+
+#ifndef __ASSEMBLY__
+
+/* generic read/write */
+
+#define readb(a)	(*(volatile u8*)(a))
+#define readw(a)	(*(volatile u16*)(a))
+#define readl(a)	(*(volatile u32*)(a))
+
+#define writeb(v,a)	(*(volatile u8*)(a)=(v))
+#define writew(v,a)	(*(volatile u16*)(a)=(v))
+#define	writel(v,a)	(*(volatile u32*)(a)=(v))
+
+#define insb(a,p,l)	({ 			\
+	int __i;				\
+	for (__i=0; __i<(l); __i++) 		\
+		((u8*)(p))[__i]= readb((a)); 	\
+})
+
+#define insw(a,p,l)	({ 			\
+	int __i;				\
+	for (__i=0; __i<(l); __i++) 		\
+		((u16*)(p))[__i] = readw((a)); 	\
+})
+
+#define insl(a,p,l)	({ 			\
+	int __i;				\
+	for (__i=0; __i<(l); __i++) 		\
+		((u32*)(p))[__i] = readl((a)); 	\
+})
+
+#define outsb(a,p,l)	({ 			\
+	int __i;				\
+	for (__i=0; __i<(l); __i++)	 	\
+		writeb(((u8*)(p))[__i],(a)); 	\
+})
+
+#define outsw(a,p,l)	({ 			\
+	int __i;				\
+	for (__i=0; __i<(l); __i++) 		\
+		writew(((u16*)(p))[__i],(a)); 	\
+})
+
+#define outsl(a,p,l)	({	 		\
+	int __i;				\
+	for (__i=0; __i<(l); __i++)	 	\
+		writel(((u32*)(p))[__i],(a));	\
+})
+#endif
+
+#endif
Index: build_tree/bootLoader/include/blob/proc/s3c2500.h
diff -u /dev/null build_tree/bootLoader/include/blob/proc/s3c2500.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/proc/s3c2500.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,58 @@
+
+/*
+ * proc/s3c2500.h - processor specific defines
+ * 
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Abraham van der Merwe <abz@4dllc.com>
+ * Copyright (C) 2003  Russ Dill <Russ.Dill@asu.edu>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_S3C2500_PROC_H
+#define BLOB_S3C2500_PROC_H
+
+#define io_p2v(x) (x)
+#define io_v2p(x) (x)
+
+#ifndef __ASSEMBLY__
+
+# define __REG(x)	(*((volatile u32 *)io_p2v(x)))
+
+# define __REG2(x,y)	\
+	( __builtin_constant_p(y) ? (__REG((x) + (y))) \
+				  : (*(volatile u32 *)((u32)&__REG(x) + (y))) )
+
+# define __PREG(x)	(io_v2p((u32)&(x)))
+
+#else
+
+# define __REG(x)	(x)
+# define __PREG(x)	(x)
+/* for [r0, REG] accesses */
+# define __REG2(x,y)	(y)
+
+#endif
+
+
+#include <blob/arch/s3c2500-regs.h>
+
+/* memory start and end */
+#define MEMORY_START		(0x40000000)
+#define MEMORY_END		(0x48000000)
+/* bank2 is at 0x80000000 to 0x88000000 */
+
+#endif
Index: build_tree/bootLoader/include/blob/proc/sa1100.h
diff -u /dev/null build_tree/bootLoader/include/blob/proc/sa1100.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/proc/sa1100.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,86 @@
+/*
+ * proc/sa11x0.h - processor specific defines
+ * 
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifndef BLOB_SA11X0_PROC_H
+#define BLOB_SA11X0_PROC_H
+
+/* memory start and end */
+#define MEMORY_START		(0xc0000000)
+#define MEMORY_END		(0xe0000000)
+
+/*
+ * CPU frequency table.
+ * 
+ * See Section 8.2 (Core Clock Configuration Register) SA-1110 Developers
+ * Manual for more information.
+ *
+ * f_cpu = 16*f_osc + n*4*f_osc
+ *       = 4*(n+4)*f_osc
+ *
+ * We have 3.6864-MHz oscillator.
+ *
+ *	CCF[4:0]	3.6864-MHz Crystal Oscillator	3.5795-MHz Crystal Oscillator
+ *	-------------------------------------------------------------------------
+ *	00			59.0							57.3
+ * 	01			73.7							71.6
+ * 	02			88.5							85.9
+ * 	03			103.2							100.2
+ * 	04			118.0							114.5
+ * 	05			132.7							128.9
+ * 	06			147.5							143.2
+ * 	07			162.2							157.5
+ * 	08			176.9							171.8
+ * 	09			191.7							186.1
+ * 	0a			206.4							200.5
+ * 	0b			221.2							214.8
+ *
+ * these are undocumented.
+ *
+ *  0c			235.9							??
+ *  0d			250.7							??
+ *  0e			265.4							??
+ *  0f			280.2							??
+ */
+#define CPU_CORE_SPEED_59mhz	0x00
+#define CPU_CORE_SPEED_73mhz	0x01
+#define CPU_CORE_SPEED_88mhz	0x02
+#define CPU_CORE_SPEED_103mhz	0x03
+#define CPU_CORE_SPEED_118mhz	0x04
+#define CPU_CORE_SPEED_132mhz	0x05
+#define CPU_CORE_SPEED_147mhz	0x06
+#define CPU_CORE_SPEED_162mhz	0x07
+#define CPU_CORE_SPEED_176mhz	0x08
+#define CPU_CORE_SPEED_191mhz	0x09
+#define CPU_CORE_SPEED_206mhz	0x0a
+#define CPU_CORE_SPEED_221mhz	0x0b
+#define CPU_CORE_SPEED_235mhz	0x0c
+#define CPU_CORE_SPEED_250mhz	0x0d
+#define CPU_CORE_SPEED_265mhz	0x0e
+#define CPU_CORE_SPEED_280mhz	0x0f
+
+#define io_p2v(x) (x)
+#define __REG(x)      (*((volatile u32 *)io_p2v(x)))
+
+/* Tell SA-1100.h to shut up; we're including it anyway. Nyah nyah ;-) */
+#define __ASM_ARCH_HARDWARE_H
+#include <asm-arm/arch-sa1100/SA-1100.h>
+
+#endif
Index: build_tree/bootLoader/include/blob/proc/sa1111.h
diff -u /dev/null build_tree/bootLoader/include/blob/proc/sa1111.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/blob/proc/sa1111.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,559 @@
+/*
+ * sa1111.h: Defines and macros for accessing the SA1111. Created from
+ * the kernel source.
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
+ *
+ * $Id: sa1111.h,v 1.1 2003/08/06 23:00:52 abz Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: sa1111.h,v 1.1 2003/08/06 23:00:52 abz Exp $"
+
+#ifndef BLOB_SA1111_H
+#define BLOB_SA1111_H
+
+#include <blob/arch.h>
+
+#include <blob/bitfield.h>
+
+#define SA1111_VBASE	0x40000000
+
+/*
+ * 26 bits of the SA-1110 address bus are available to the SA-1111.
+ * Use these when feeding target addresses to the DMA engines.
+ */
+#define MEM_REG(adr)	(*((u32 *)(adr)))
+
+#define SA1111_ADDR_WIDTH	(26)
+#define SA1111_ADDR_MASK	((1<<SA1111_ADDR_WIDTH)-1)
+#define SA1111_DMA_ADDR(x)	((x)&SA1111_ADDR_MASK)
+
+/*
+ * Don't ask the (SAC) DMA engines to move less than this amount.
+ */
+
+#define SA1111_SAC_DMA_MIN_XFER	(0x800)
+
+/*
+ * SA1111 register definitions.
+ */
+#define SA1111_REG(x)	MEM_REG(SA1111_VBASE + (x))
+
+/* System Bus Interface (SBI)
+ *
+ * Registers
+ *    SKCR	Control Register
+ *    SMCR	Shared Memory Controller Register
+ *    SKID	ID Register
+ */
+#define SA1111_SKCR	0x0000
+#define SA1111_SMCR	0x0004
+#define SA1111_SKID	0x0008
+
+#define SBI_SKCR	SA1111_REG(SA1111_SKCR)
+#define SBI_SMCR	SA1111_REG(SA1111_SMCR)
+#define SBI_SKID	SA1111_REG(SA1111_SKID)
+
+#define SKCR_PLL_BYPASS	(1<<0)
+#define SKCR_RCLKEN	(1<<1)
+#define SKCR_SLEEP	(1<<2)
+#define SKCR_DOZE	(1<<3)
+#define SKCR_VCO_OFF	(1<<4)
+#define SKCR_SCANTSTEN	(1<<5)
+#define SKCR_CLKTSTEN	(1<<6)
+#define SKCR_RDYEN	(1<<7)
+#define SKCR_SELAC	(1<<8)
+#define SKCR_OPPC	(1<<9)
+#define SKCR_PLLTSTEN	(1<<10)
+#define SKCR_USBIOTSTEN	(1<<11)
+/*
+ * Don't believe the specs!  Take them, throw them outside.  Leave them
+ * there for a week.  Spit on them.  Walk on them.  Stamp on them.
+ * Pour gasoline over them and finally burn them.  Now think about coding.
+ *  - The October 1999 errata (278260-007) says its bit 13, 1 to enable.
+ *  - The Feb 2001 errata (278260-010) says that the previous errata
+ *    (278260-009) is wrong, and its bit actually 12, fixed in spec
+ *    278242-003.
+ *  - The SA1111 manual (278242) says bit 12, but 0 to enable.
+ *  - Reality is bit 13, 1 to enable.
+ *      -- rmk
+ */
+#define SKCR_OE_EN	(1<<13)
+
+#define SMCR_DTIM	(1<<0)
+#define SMCR_MBGE	(1<<1)
+#define SMCR_DRAC_0	(1<<2)
+#define SMCR_DRAC_1	(1<<3)
+#define SMCR_DRAC_2	(1<<4)
+#define SMCR_DRAC	Fld(3, 2)
+#define SMCR_CLAT	(1<<5)
+
+#define SKID_SIREV_MASK	(0x000000f0)
+#define SKID_MTREV_MASK (0x0000000f)
+#define SKID_ID_MASK	(0xffffff00)
+#define SKID_SA1111_ID	(0x690cc200)
+
+/*
+ * System Controller
+ *
+ * Registers
+ *    SKPCR	Power Control Register
+ *    SKCDR	Clock Divider Register
+ *    SKAUD	Audio Clock Divider Register
+ *    SKPMC	PS/2 Mouse Clock Divider Register
+ *    SKPTC	PS/2 Track Pad Clock Divider Register
+ *    SKPEN0	PWM0 Enable Register
+ *    SKPWM0	PWM0 Clock Register
+ *    SKPEN1	PWM1 Enable Register
+ *    SKPWM1	PWM1 Clock Register
+ */
+
+#define SKPCR		SA1111_REG(0x0200)
+#define SKCDR		SA1111_REG(0x0204)
+#define SKAUD		SA1111_REG(0x0208)
+#define SKPMC		SA1111_REG(0x020c)
+#define SKPTC		SA1111_REG(0x0210)
+#define SKPEN0		SA1111_REG(0x0214)
+#define SKPWM0		SA1111_REG(0x0218)
+#define SKPEN1		SA1111_REG(0x021c)
+#define SKPWM1		SA1111_REG(0x0220)
+
+#define SKPCR_UCLKEN	(1<<0)
+#define SKPCR_ACCLKEN	(1<<1)
+#define SKPCR_I2SCLKEN	(1<<2)
+#define SKPCR_L3CLKEN	(1<<3)
+#define SKPCR_SCLKEN	(1<<4)
+#define SKPCR_PMCLKEN	(1<<5)
+#define SKPCR_PTCLKEN	(1<<6)
+#define SKPCR_DCLKEN	(1<<7)
+#define SKPCR_PWMCLKEN	(1<<8)
+
+/*
+ * USB Host controller
+ */
+
+#define USB_OHCI_OP_BASE	SA1111_REG(0x0400)
+#define USB_STATUS		SA1111_REG(0x0518)
+#define USB_RESET		SA1111_REG(0x051c)
+#define USB_INTERRUPTEST	SA1111_REG(0x0520)
+
+#define USB_RESET_FORCEIFRESET	(1 << 0)
+#define USB_RESET_FORCEHCRESET	(1 << 1)
+#define USB_RESET_CLKGENRESET	(1 << 2)
+#define USB_RESET_SIMSCALEDOWN	(1 << 3)
+#define USB_RESET_USBINTTEST	(1 << 4)
+#define USB_RESET_SLEEPSTBYEN	(1 << 5)
+#define USB_RESET_PWRSENSELOW	(1 << 6)
+#define USB_RESET_PWRCTRLLOW	(1 << 7)
+
+/*
+ * Serial Audio Controller
+ *
+ * Registers
+ *    SACR0             Serial Audio Common Control Register
+ *    SACR1             Serial Audio Alternate Mode (I2C/MSB) Control Register
+ *    SACR2             Serial Audio AC-link Control Register
+ *    SASR0             Serial Audio I2S/MSB Interface & FIFO Status Register
+ *    SASR1             Serial Audio AC-link Interface & FIFO Status Register
+ *    SASCR             Serial Audio Status Clear Register
+ *    L3_CAR            L3 Control Bus Address Register
+ *    L3_CDR            L3 Control Bus Data Register
+ *    ACCAR             AC-link Command Address Register
+ *    ACCDR             AC-link Command Data Register
+ *    ACSAR             AC-link Status Address Register
+ *    ACSDR             AC-link Status Data Register
+ *    SADTCS            Serial Audio DMA Transmit Control/Status Register
+ *    SADTSA            Serial Audio DMA Transmit Buffer Start Address A
+ *    SADTCA            Serial Audio DMA Transmit Buffer Count Register A
+ *    SADTSB            Serial Audio DMA Transmit Buffer Start Address B
+ *    SADTCB            Serial Audio DMA Transmit Buffer Count Register B
+ *    SADRCS            Serial Audio DMA Receive Control/Status Register
+ *    SADRSA            Serial Audio DMA Receive Buffer Start Address A
+ *    SADRCA            Serial Audio DMA Receive Buffer Count Register A
+ *    SADRSB            Serial Audio DMA Receive Buffer Start Address B
+ *    SADRCB            Serial Audio DMA Receive Buffer Count Register B
+ *    SAITR             Serial Audio Interrupt Test Register
+ *    SADR              Serial Audio Data Register (16 x 32-bit)
+ */
+
+#define SACR0		SA1111_REG(0x0600)
+#define SACR1		SA1111_REG(0x0604)
+#define SACR2		SA1111_REG(0x0608)
+#define SASR0		SA1111_REG(0x060c)
+#define SASR1		SA1111_REG(0x0610)
+#define SASCR		SA1111_REG(0x0618)
+#define L3_CAR		SA1111_REG(0x061c)
+#define L3_CDR		SA1111_REG(0x0620)
+#define ACCAR		SA1111_REG(0x0624)
+#define ACCDR		SA1111_REG(0x0628)
+#define ACSAR		SA1111_REG(0x062c)
+#define ACSDR		SA1111_REG(0x0630)
+#define SADTCS		SA1111_REG(0x0634)
+#define SADTSA		SA1111_REG(0x0638)
+#define SADTCA		SA1111_REG(0x063c)
+#define SADTSB		SA1111_REG(0x0640)
+#define SADTCB		SA1111_REG(0x0644)
+#define SADRCS		SA1111_REG(0x0648)
+#define SADRSA		SA1111_REG(0x064c)
+#define SADRCA		SA1111_REG(0x0650)
+#define SADRSB		SA1111_REG(0x0654)
+#define SADRCB		SA1111_REG(0x0658)
+#define SAITR		SA1111_REG(0x065c)
+#define SADR		SA1111_REG(0x0680)
+
+#define SACR0_ENB	(1<<0)
+#define SACR0_BCKD	(1<<2)
+#define SACR0_RST	(1<<3)
+
+#define SACR1_AMSL	(1<<0)
+#define SACR1_L3EN	(1<<1)
+#define SACR1_L3MB	(1<<2)
+#define SACR1_DREC	(1<<3)
+#define SACR1_DRPL	(1<<4)
+#define SACR1_ENLBF	(1<<5)
+
+#define SACR2_TS3V	(1<<0)
+#define SACR2_TS4V	(1<<1)
+#define SACR2_WKUP	(1<<2)
+#define SACR2_DREC	(1<<3)
+#define SACR2_DRPL	(1<<4)
+#define SACR2_ENLBF	(1<<5)
+#define SACR2_RESET	(1<<6)
+
+#define SASR0_TNF	(1<<0)
+#define SASR0_RNE	(1<<1)
+#define SASR0_BSY	(1<<2)
+#define SASR0_TFS	(1<<3)
+#define SASR0_RFS	(1<<4)
+#define SASR0_TUR	(1<<5)
+#define SASR0_ROR	(1<<6)
+#define SASR0_L3WD	(1<<16)
+#define SASR0_L3RD	(1<<17)
+
+#define SASR1_TNF	(1<<0)
+#define SASR1_RNE	(1<<1)
+#define SASR1_BSY	(1<<2)
+#define SASR1_TFS	(1<<3)
+#define SASR1_RFS	(1<<4)
+#define SASR1_TUR	(1<<5)
+#define SASR1_ROR	(1<<6)
+#define SASR1_CADT	(1<<16)
+#define SASR1_SADR	(1<<17)
+#define SASR1_RSTO	(1<<18)
+#define SASR1_CLPM	(1<<19)
+#define SASR1_CRDY	(1<<20)
+#define SASR1_RS3V	(1<<21)
+#define SASR1_RS4V	(1<<22)
+
+#define SASCR_TUR	(1<<5)
+#define SASCR_ROR	(1<<6)
+#define SASCR_DTS	(1<<16)
+#define SASCR_RDD	(1<<17)
+#define SASCR_STO	(1<<18)
+
+#define SADTCS_TDEN	(1<<0)
+#define SADTCS_TDIE	(1<<1)
+#define SADTCS_TDBDA	(1<<3)
+#define SADTCS_TDSTA	(1<<4)
+#define SADTCS_TDBDB	(1<<5)
+#define SADTCS_TDSTB	(1<<6)
+#define SADTCS_TBIU	(1<<7)
+
+#define SADRCS_RDEN	(1<<0)
+#define SADRCS_RDIE	(1<<1)
+#define SADRCS_RDBDA	(1<<3)
+#define SADRCS_RDSTA	(1<<4)
+#define SADRCS_RDBDB	(1<<5)
+#define SADRCS_RDSTB	(1<<6)
+#define SADRCS_RBIU	(1<<7)
+
+#define SAD_CS_DEN	(1<<0)
+#define SAD_CS_DIE	(1<<1)	/* Not functional on metal 1 */
+#define SAD_CS_DBDA	(1<<3)	/* Not functional on metal 1 */
+#define SAD_CS_DSTA	(1<<4)
+#define SAD_CS_DBDB	(1<<5)	/* Not functional on metal 1 */
+#define SAD_CS_DSTB	(1<<6)
+#define SAD_CS_BIU	(1<<7)	/* Not functional on metal 1 */
+
+#define SAITR_TFS	(1<<0)
+#define SAITR_RFS	(1<<1)
+#define SAITR_TUR	(1<<2)
+#define SAITR_ROR	(1<<3)
+#define SAITR_CADT	(1<<4)
+#define SAITR_SADR	(1<<5)
+#define SAITR_RSTO	(1<<6)
+#define SAITR_TDBDA	(1<<8)
+#define SAITR_TDBDB	(1<<9)
+#define SAITR_RDBDA	(1<<10)
+#define SAITR_RDBDB	(1<<11)
+
+/*
+ * General-Purpose I/O Interface
+ *
+ * Registers
+ *    PA_DDR		GPIO Block A Data Direction
+ *    PA_DRR/PA_DWR	GPIO Block A Data Value Register (read/write)
+ *    PA_SDR		GPIO Block A Sleep Direction
+ *    PA_SSR		GPIO Block A Sleep State
+ *    PB_DDR		GPIO Block B Data Direction
+ *    PB_DRR/PB_DWR	GPIO Block B Data Value Register (read/write)
+ *    PB_SDR		GPIO Block B Sleep Direction
+ *    PB_SSR		GPIO Block B Sleep State
+ *    PC_DDR		GPIO Block C Data Direction
+ *    PC_DRR/PC_DWR	GPIO Block C Data Value Register (read/write)
+ *    PC_SDR		GPIO Block C Sleep Direction
+ *    PC_SSR		GPIO Block C Sleep State
+ */
+
+#define PA_DDR		SA1111_REG(0x1000)
+#define PA_DRR		SA1111_REG(0x1004)
+#define PA_DWR		SA1111_REG(0x1004)
+#define PA_SDR		SA1111_REG(0x1008)
+#define PA_SSR		SA1111_REG(0x100c)
+#define PB_DDR		SA1111_REG(0x1010)
+#define PB_DRR		SA1111_REG(0x1014)
+#define PB_DWR		SA1111_REG(0x1014)
+#define PB_SDR		SA1111_REG(0x1018)
+#define PB_SSR		SA1111_REG(0x101c)
+#define PC_DDR		SA1111_REG(0x1020)
+#define PC_DRR		SA1111_REG(0x1024)
+#define PC_DWR		SA1111_REG(0x1024)
+#define PC_SDR		SA1111_REG(0x1028)
+#define PC_SSR		SA1111_REG(0x102c)
+
+/*
+ * Interrupt Controller
+ *
+ * Registers
+ *    INTTEST0		Test register 0
+ *    INTTEST1		Test register 1
+ *    INTEN0		Interrupt Enable register 0
+ *    INTEN1		Interrupt Enable register 1
+ *    INTPOL0		Interrupt Polarity selection 0
+ *    INTPOL1		Interrupt Polarity selection 1
+ *    INTTSTSEL		Interrupt source selection
+ *    INTSTATCLR0	Interrupt Status/Clear 0
+ *    INTSTATCLR1	Interrupt Status/Clear 1
+ *    INTSET0		Interrupt source set 0
+ *    INTSET1		Interrupt source set 1
+ *    WAKE_EN0		Wake-up source enable 0
+ *    WAKE_EN1		Wake-up source enable 1
+ *    WAKE_POL0		Wake-up polarity selection 0
+ *    WAKE_POL1		Wake-up polarity selection 1
+ */
+
+#define SA1111_INTTEST0		0x1600
+#define SA1111_INTTEST1		0x1604
+#define SA1111_INTEN0		0x1608
+#define SA1111_INTEN1		0x160c
+#define SA1111_INTPOL0		0x1610
+#define SA1111_INTPOL1		0x1614
+#define SA1111_INTTSTSEL	0x1618
+#define SA1111_INTSTATCLR0	0x161c
+#define SA1111_INTSTATCLR1	0x1620
+#define SA1111_INTSET0		0x1624
+#define SA1111_INTSET1		0x1628
+#define SA1111_WAKE_EN0		0x162c
+#define SA1111_WAKE_EN1		0x1630
+#define SA1111_WAKE_POL0	0x1634
+#define SA1111_WAKE_POL1	0x1638
+
+#define INTTEST0	SA1111_REG(SA1111_INTTEST0)
+#define INTTEST1	SA1111_REG(SA1111_INTTEST1)
+#define INTEN0		SA1111_REG(SA1111_INTEN0)
+#define INTEN1		SA1111_REG(SA1111_INTEN1)
+#define INTPOL0		SA1111_REG(SA1111_INTPOL0)
+#define INTPOL1		SA1111_REG(SA1111_INTPOL1)
+#define INTTSTSEL	SA1111_REG(SA1111_INTTSTSEL)
+#define INTSTATCLR0	SA1111_REG(SA1111_INTSTATCLR0)
+#define INTSTATCLR1	SA1111_REG(SA1111_INTSTATCLR1)
+#define INTSET0		SA1111_REG(SA1111_INTSET0)
+#define INTSET1		SA1111_REG(SA1111_INTSET1)
+#define WAKE_EN0	SA1111_REG(SA1111_WAKE_EN0)
+#define WAKE_EN1	SA1111_REG(SA1111_WAKE_EN1)
+#define WAKE_POL0	SA1111_REG(SA1111_WAKE_POL0)
+#define WAKE_POL1	SA1111_REG(SA1111_WAKE_POL1)
+
+/*
+ * PS/2 Trackpad and Mouse Interfaces
+ *
+ * Registers   (prefix kbd applies to trackpad interface, mse to mouse)
+ *    KBDCR     Control Register
+ *    KBDSTAT       Status Register
+ *    KBDDATA       Transmit/Receive Data register
+ *    KBDCLKDIV     Clock Division Register
+ *    KBDPRECNT     Clock Precount Register
+ *    KBDTEST1      Test register 1
+ *    KBDTEST2      Test register 2
+ *    KBDTEST3      Test register 3
+ *    KBDTEST4      Test register 4
+ *    MSECR
+ *    MSESTAT
+ *    MSEDATA
+ *    MSECLKDIV
+ *    MSEPRECNT
+ *    MSETEST1
+ *    MSETEST2
+ *    MSETEST3
+ *    MSETEST4
+ *
+ */
+
+#define KBDCR		SA1111_REG(0x0a00)
+#define KBDSTAT		SA1111_REG(0x0a04)
+#define KBDDATA		SA1111_REG(0x0a08)
+#define KBDCLKDIV	SA1111_REG(0x0a0c)
+#define KBDPRECNT	SA1111_REG(0x0a10)
+#define MSECR		SA1111_REG(0x0c00)
+#define MSESTAT		SA1111_REG(0x0c04)
+#define MSEDATA		SA1111_REG(0x0c08)
+#define MSECLKDIV	SA1111_REG(0x0c0c)
+#define MSEPRECNT	SA1111_REG(0x0c10)
+
+#define KBDCR_ENA        0x08
+#define KBDCR_FKD        0x02
+#define KBDCR_FKC        0x01
+
+#define KBDSTAT_TXE      0x80
+#define KBDSTAT_TXB      0x40
+#define KBDSTAT_RXF      0x20
+#define KBDSTAT_RXB      0x10
+#define KBDSTAT_ENA      0x08
+#define KBDSTAT_RXP      0x04
+#define KBDSTAT_KBD      0x02
+#define KBDSTAT_KBC      0x01
+
+#define KBDCLKDIV_DivVal     Fld(4,0)
+
+#define MSECR_ENA        0x08
+#define MSECR_FKD        0x02
+#define MSECR_FKC        0x01
+
+#define MSESTAT_TXE      0x80
+#define MSESTAT_TXB      0x40
+#define MSESTAT_RXF      0x20
+#define MSESTAT_RXB      0x10
+#define MSESTAT_ENA      0x08
+#define MSESTAT_RXP      0x04
+#define MSESTAT_MSD      0x02
+#define MSESTAT_MSC      0x01
+
+#define MSECLKDIV_DivVal     Fld(4,0)
+
+#define KBDTEST1_CD      0x80
+#define KBDTEST1_RC1         0x40
+#define KBDTEST1_MC      0x20
+#define KBDTEST1_C       Fld(2,3)
+#define KBDTEST1_T2      0x40
+#define KBDTEST1_T1      0x20
+#define KBDTEST1_T0      0x10
+#define KBDTEST2_TICBnRES    0x08
+#define KBDTEST2_RKC         0x04
+#define KBDTEST2_RKD         0x02
+#define KBDTEST2_SEL         0x01
+#define KBDTEST3_ms_16       0x80
+#define KBDTEST3_us_64       0x40
+#define KBDTEST3_us_16       0x20
+#define KBDTEST3_DIV8        0x10
+#define KBDTEST3_DIn         0x08
+#define KBDTEST3_CIn         0x04
+#define KBDTEST3_KD      0x02
+#define KBDTEST3_KC      0x01
+#define KBDTEST4_BC12        0x80
+#define KBDTEST4_BC11        0x40
+#define KBDTEST4_TRES        0x20
+#define KBDTEST4_CLKOE       0x10
+#define KBDTEST4_CRES        0x08
+#define KBDTEST4_RXB         0x04
+#define KBDTEST4_TXB         0x02
+#define KBDTEST4_SRX         0x01
+
+#define MSETEST1_CD      0x80
+#define MSETEST1_RC1         0x40
+#define MSETEST1_MC      0x20
+#define MSETEST1_C       Fld(2,3)
+#define MSETEST1_T2      0x40
+#define MSETEST1_T1      0x20
+#define MSETEST1_T0      0x10
+#define MSETEST2_TICBnRES    0x08
+#define MSETEST2_RKC         0x04
+#define MSETEST2_RKD         0x02
+#define MSETEST2_SEL         0x01
+#define MSETEST3_ms_16       0x80
+#define MSETEST3_us_64       0x40
+#define MSETEST3_us_16       0x20
+#define MSETEST3_DIV8        0x10
+#define MSETEST3_DIn         0x08
+#define MSETEST3_CIn         0x04
+#define MSETEST3_KD      0x02
+#define MSETEST3_KC      0x01
+#define MSETEST4_BC12        0x80
+#define MSETEST4_BC11        0x40
+#define MSETEST4_TRES        0x20
+#define MSETEST4_CLKOE       0x10
+#define MSETEST4_CRES        0x08
+#define MSETEST4_RXB         0x04
+#define MSETEST4_TXB         0x02
+#define MSETEST4_SRX         0x01
+
+/*
+ * PCMCIA Interface
+ *
+ * Registers
+ *    PCSR	Status Register
+ *    PCCR	Control Register
+ *    PCSSR	Sleep State Register
+ */
+
+
+
+
+
+#define PCCR		SA1111_REG(0x1800)
+#define PCSSR		SA1111_REG(0x1804)
+#define PCSR		SA1111_REG(0x1808)
+
+#define PCSR_S0_READY	(1<<0)
+#define PCSR_S1_READY	(1<<1)
+#define PCSR_S0_DETECT	(1<<2)
+#define PCSR_S1_DETECT	(1<<3)
+#define PCSR_S0_VS1	(1<<4)
+#define PCSR_S0_VS2	(1<<5)
+#define PCSR_S1_VS1	(1<<6)
+#define PCSR_S1_VS2	(1<<7)
+#define PCSR_S0_WP	(1<<8)
+#define PCSR_S1_WP	(1<<9)
+#define PCSR_S0_BVD1	(1<<10)
+#define PCSR_S0_BVD2	(1<<11)
+#define PCSR_S1_BVD1	(1<<12)
+#define PCSR_S1_BVD2	(1<<13)
+
+#define PCCR_S0_RST	(1<<0)
+#define PCCR_S1_RST	(1<<1)
+#define PCCR_S0_FLT	(1<<2)
+#define PCCR_S1_FLT	(1<<3)
+#define PCCR_S0_PWAITEN	(1<<4)
+#define PCCR_S1_PWAITEN	(1<<5)
+#define PCCR_S0_PSE	(1<<6)
+#define PCCR_S1_PSE	(1<<7)
+
+#define PCSSR_S0_SLEEP	(1<<0)
+#define PCSSR_S1_SLEEP	(1<<1)
+
+#endif
+
Index: build_tree/bootLoader/include/net/.cvsignore
diff -u /dev/null build_tree/bootLoader/include/net/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile
+Makefile.in
Index: build_tree/bootLoader/include/net/Makefile.am
diff -u /dev/null build_tree/bootLoader/include/net/Makefile.am:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,17 @@
+# -*- makefile -*-
+###########################################################################
+## Filename:      Makefile.am
+## Version:       $Id: Makefile.am,v 1.1 2003/03/18 17:38:14 seletz Exp $
+## Copyright:     Copyright (C) 2003, Stefan Eletzhofer
+## Author:        Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+###########################################################################
+
+noinst_HEADERS	= \
+	arp.h \
+	ether.h \
+	ip_bits.h \
+	net.h \
+	smc9196.h \
+	tftp.h
+
+CLEANFILES	= ${srcdir}/*~
Index: build_tree/bootLoader/include/net/Makefile.in
diff -u /dev/null build_tree/bootLoader/include/net/Makefile.in:1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -0,0 +1,376 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+# -*- makefile -*-
+###########################################################################
+###########################################################################
+
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+VPATH = @srcdir@
+pkgdatadir = $(datadir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+top_builddir = ../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = @INSTALL@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = @host@
+subdir = include/net
+DIST_COMMON = $(noinst_HEADERS) $(srcdir)/Makefile.am \
+	$(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+HEADERS = $(noinst_HEADERS)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
+AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
+BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
+CC = @CC@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
+LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
+MAKEINFO = @MAKEINFO@
+OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
+OCFLAGS = @OCFLAGS@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+noinst_HEADERS = \
+	arp.h \
+	ether.h \
+	ip_bits.h \
+	net.h \
+	smc9196.h \
+	tftp.h
+
+CLEANFILES = ${srcdir}/*~
+all: all-am
+
+.SUFFIXES:
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  include/net/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  include/net/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(HEADERS)
+installdirs:
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic mostlyclean-am
+
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	ctags distclean distclean-generic distclean-tags distdir dvi \
+	dvi-am html html-am info info-am install install-am \
+	install-data install-data-am install-exec install-exec-am \
+	install-info install-info-am install-man install-strip \
+	installcheck installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-generic pdf \
+	pdf-am ps ps-am tags uninstall uninstall-am uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/include/net/arp.h
diff -u /dev/null build_tree/bootLoader/include/net/arp.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/arp.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,36 @@
+/*
+ *  arp.h
+ *
+ *  Copyright 1996-2001 Russell King
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+struct arp_ethernet {
+	unsigned char hw[6];
+	unsigned char ip[4];
+} __attribute__ ((packed));
+
+struct arp_packet {
+	unsigned short hw_type;
+	unsigned short proto_type;
+	unsigned char hw_len;
+	unsigned char proto_len;
+	unsigned short opcode;
+	struct arp_ethernet sender;
+	struct arp_ethernet target;
+} __attribute__ ((packed));
+
+/**********************************************************************
+ * do_arp - send ARP request to server
+ * @thwaddr: the target HW address we received
+ * @tipaddr: the server IP address we want the HAW address for
+ *
+ * Sends and ARP REQUEST packet to the network and tries to get the
+ * ethernet HW address <thwaddr> for the IP address <tipaddr>.
+ */
+int do_arp(unsigned char *thwaddr, unsigned char *tipaddr);
+
+int do_arp_reply(unsigned char *rx_pkt, unsigned int size);
Index: build_tree/bootLoader/include/net/ether.h
diff -u /dev/null build_tree/bootLoader/include/net/ether.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/ether.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,91 @@
+/*-------------------------------------------------------------------------
+ * Filename:      ether.h
+ * Version:       $Id: ether.h,v 1.5 2003/09/04 18:34:26 russd Exp $
+ * Copyright:     Copyright (C) 1999, Erik Mouw
+ * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Description:   Header file for ether.c
+ * Created at:    Tue Aug 24 20:25:00 1999
+ * Modified by:   Russ Dill <Russ.Dill@asu.edu>
+ * Modified at:   Wed, Aug 27 2003
+ *-----------------------------------------------------------------------*/
+/*
+ * ether.h: Ethernet driver header for blob
+ *
+ * Copyright (C) 1999 2002  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Russ Dill (Russ.Dill@asu.edu)
+ * Copyright 1996-2001 Russell King
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: ether.h,v 1.5 2003/09/04 18:34:26 russd Exp $"
+
+#ifndef _BLOB_ETHER_H
+#define _BLOB_ETHER_H 1
+
+#include <blob/types.h>
+
+struct ether_hdr {
+	unsigned char dest[6];
+	unsigned char src[6];
+	unsigned short proto;
+} __attribute__ ((packed));
+
+typedef int (*ether_init_func_t)(u32 base);
+typedef int (*ether_rcv_func_t)(u8 *buf, int size);
+typedef int (*ether_snd_func_t)(u8 *buf, int size);
+typedef int (*ether_set_addr_func_t)(u8 hw_addr[6]);
+typedef int (*ether_get_addr_func_t)(u8 hw_addr[6]);
+
+
+typedef struct {
+	ether_init_func_t init;
+
+	ether_rcv_func_t rcv;
+	ether_snd_func_t snd;
+
+	ether_set_addr_func_t set_addr;
+	ether_get_addr_func_t get_addr;
+
+	u32 base;
+	char *name;
+
+} ether_driver_t;
+
+#define HTON( s )	( ((s&0xff00)>>8 ) | ((s&0xff)<<8) )
+
+/* implemented etheret drivers */
+extern ether_driver_t s3c2500_ether_driver;
+extern ether_driver_t smc9196_ether_driver;
+extern ether_driver_t smc91x_ether_driver;
+extern ether_driver_t pxausb_ether_driver;
+extern ether_driver_t bvdusb_ether_driver;
+
+/* should be filled out by the architecture dependent files */
+extern ether_driver_t *ether_driver;
+
+/* exported functions */
+void ether_init(void);
+int ether_rcv(u8 *buf, int size);
+int ether_snd(u8 *buf, int size);
+int ether_set_addr(u8 hw_addr[6]);
+int ether_get_addr(u8 hw_addr[6]);
+char *ether_get_name(void);
+
+/* exported variables */
+extern u8 hwaddress[6];
+
+#endif
Index: build_tree/bootLoader/include/net/ip_bits.h
diff -u /dev/null build_tree/bootLoader/include/net/ip_bits.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/ip_bits.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,31 @@
+/*
+ *  ip_bits.h
+ *
+ *  Copyright 1996-2001 Russell King
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+#ifndef _BLOB_IPBITS_H
+#define _BLOB_IPBITS_H 1
+
+#define SIZE_ETHER	14
+#define SIZE_IP		20
+#define SIZE_UDP	8
+#define SIZE_BOOTP	300
+
+#define OFF_ETHER	(0)
+#define OFF_IP		(OFF_ETHER + SIZE_ETHER)
+#define OFF_UDP		(OFF_IP + SIZE_IP)
+#define OFF_BOOTP	(OFF_UDP + SIZE_UDP)
+#define OFF_TFTP	(OFF_UDP + SIZE_UDP)
+
+#define MIN_UDPPKTSIZE	(OFF_UDP + SIZE_UDP)
+
+extern unsigned int checksum (unsigned char *ptr, int len, unsigned int cksum);
+extern void printip (char *msg, unsigned char *ip);
+extern int ipbits_tx (unsigned char *ptr, unsigned int size);
+extern int ipbits_rcv (unsigned char *ptr, unsigned int size, unsigned int *dsz, int sport, int dport);
+
+#endif
Index: build_tree/bootLoader/include/net/net.h
diff -u /dev/null build_tree/bootLoader/include/net/net.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/net.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,28 @@
+/*
+ *  net.h
+ *
+ *  Copyright 2003 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+#ifndef _BLOB_NET_H
+#define _BLOB_NET_H 1
+
+/* compatibility macros :) */
+#define memeq( x, y, s ) (memcmp((x), (y), (s)) == 0)
+#define memzero( x, s ) memset((x), 0, (s))
+#define printascii( s )	SerialOutputString( s )
+#define printch( c ) SerialOutputChar( c )
+
+/* defined in lowlevel ethernet drivers */
+extern unsigned char hwaddress[6];
+
+/* defined in lib/bootp.c */
+extern u8 clientipaddress[4];
+extern u8 serveripaddress[4];
+extern unsigned char tftpfilename[128];
+
+#endif
Index: build_tree/bootLoader/include/net/s3c2500.h
diff -u /dev/null build_tree/bootLoader/include/net/s3c2500.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/s3c2500.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,79 @@
+/*
+ *  s3c2500.h
+ *
+ *  Copyright (c) 2003  Russ Dill <Russ.Dill@asu.edu>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+#ifndef _NET_S3C2500_H
+#define _NET_S3C2500_H
+
+
+
+struct buffer_t {
+	u8	*ptr;
+	u32	desc;
+};
+
+
+#define BDMA_owner	(1 << 31)
+#define DescSkipBD	(1 << 30)
+#define DescSOF		(1 << 29)
+#define DescEOF		(1 << 28)
+#define BRxDone		(1 << 23)
+
+#define BDMATXCON	0x00000
+#define BTxMSL		4
+#define BTxEn		(1 << 10)
+#define BTxRS		(1 << 11)
+
+#define BDMARXCON	0x00004
+#define BRxNBD		0
+#define BRxMSL		4
+#define BRxEn		(1 << 10)
+#define BRxRS		(1 << 11)
+
+#define BDMATXDPTR	0x00008
+#define BDMARXDPTR	0x0000c
+#define BTXBDCNT	0x00010
+#define BRXBDCNT	0x00014
+#define BMTXINTEN	0x00018
+#define BMRXINTEN	0x0001c
+
+#define BMTXSTAT	0x00020
+#define TxComp		(1 << 6)
+
+#define BMRXSTAT	0x00024
+#define BDMARXLEN	0x00028
+#define CFTXSTAT	0x00030
+
+#define MACCON		0x10000
+#define MReset		(1 << 2)
+#define MACFD		(1 << 3)
+
+#define CAMCON		0x10004
+#define MStation	(1 << 0)
+#define MBroad		(1 << 2)
+#define MCompEn		(1 << 4)
+
+#define MACTXCON	0x10008
+#define MTxEn		(1 << 0)
+
+#define MACTXSTAT	0x1000c
+
+#define MACRXCON	0x10010
+#define MRxEn		(1 << 0)
+
+#define MACRXSTAT	0x10014
+#define STADATA		0x10018
+#define STACON		0x1001c
+#define CAMEN		0x10028
+#define MISSCNT		0x1003c
+#define PZCNT		0x10040
+#define RMPZCNT		0x10044
+#define CAM		0x10080
+
+#endif
Index: build_tree/bootLoader/include/net/smc9196.h
diff -u /dev/null build_tree/bootLoader/include/net/smc9196.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/smc9196.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,192 @@
+/*------------------------------------------------------------------------
+ . smc9194.h
+ . Copyright (C) 1996 by Erik Stahlman 
+ .
+ . This software may be used and distributed according to the terms
+ . of the GNU General Public License, incorporated herein by reference.
+ .
+ . This file contains register information and access macros for 
+ . the SMC91xxx chipset.   
+ . 
+ . Information contained in this file was obtained from the SMC91C94 
+ . manual from SMC.  To get a copy, if you really want one, you can find 
+ . information under www.smc.com in the components division.
+ . ( this thanks to advice from Donald Becker ).
+ . 
+ . Authors
+ . 	Erik Stahlman				( erik@vt.edu )
+ .
+ . History
+ . 01/06/96		 Erik Stahlman   moved definitions here from main .c file
+ . 01/19/96		 Erik Stahlman	  polished this up some, and added better
+ .										  error handling
+ .
+ ---------------------------------------------------------------------------*/
+#ifndef _SMC9194_H_
+#define _SMC9194_H_
+
+/*---------------------------------------------------------------
+ .  
+ . A description of the SMC registers is probably in order here,
+ . although for details, the SMC datasheet is invaluable.  
+ . 
+ . Basically, the chip has 4 banks of registers ( 0 to 3 ), which
+ . are accessed by writing a number into the BANK_SELECT register
+ . ( I also use a SMC_SELECT_BANK macro for this ).
+ . 
+ . The banks are configured so that for most purposes, bank 2 is all
+ . that is needed for simple run time tasks.  
+ -----------------------------------------------------------------------*/
+
+/*
+ . Bank Select Register: 
+ .
+ .		yyyy yyyy 0000 00xx  
+ .		xx 		= bank number
+ .		yyyy yyyy	= 0x33, for identification purposes.
+*/
+#define	BANK_SELECT		14
+
+/* BANK 0  */
+
+#define	TCR 		0    	/* transmit control register */
+#define TCR_ENABLE	0x0001	/* if this is 1, we can transmit */ 
+#define	TCR_PAD_ENABLE	0x0080	/* pads short packets to 64 bytes */
+#define	TCR_MON_CNS	0x0400	/* monitors the carrier status */
+#define TCR_FDUPLX    	0x0800  /* receive packets sent out */
+#define TCR_STP_SQET	0x1000	/* stop transmitting if Signal quality error */
+#define TCR_FDSE	0x8000	/* full duplex, switched ethernet */
+
+#define	TCR_CLEAR	0	/* do NOTHING */
+/* the normal settings for the TCR register : */ 
+/* QUESTION: do I want to enable padding of short packets ? */
+#define	TCR_NORMAL  	TCR_ENABLE 
+
+
+#define EPH_STATUS	2
+#define ES_LINK_OK	0x4000	/* is the link integrity ok ? */
+
+#define	RCR		4
+#define RCR_SOFTRESET	0x8000 	/* resets the chip */	
+#define	RCR_STRIP_CRC	0x200	/* strips CRC */
+#define RCR_ENABLE	0x100	/* IFF this is set, we can receive packets */
+#define RCR_ALMUL	0x4 	/* receive all multicast packets */
+#define	RCR_PROMISC	0x2	/* enable promiscuous mode */
+
+/* the normal settings for the RCR register : */
+#define	RCR_NORMAL	(RCR_STRIP_CRC | RCR_ENABLE)
+//#define	RCR_NORMAL	(RCR_PROMISC | RCR_ENABLE)
+//#define	RCR_NORMAL	(RCR_ENABLE)
+#define RCR_CLEAR	0x0		/* set it to a base state */
+
+#define	COUNTER		6
+#define	MIR		8
+#define	MCR		10
+/* 12 is reserved */
+
+/* BANK 1 */
+#define CONFIG			0
+#define CFG_AUI_SELECT	 	0x100
+#define	BASE			2
+#define	ADDR0			4
+#define	ADDR1			6
+#define	ADDR2			8
+#define	GENERAL			10
+#define	CONTROL			12
+#define	CTL_POWERDOWN		0x2000
+#define	CTL_LE_ENABLE		0x80
+#define	CTL_CR_ENABLE		0x40
+#define	CTL_TE_ENABLE		0x0020
+#define CTL_AUTO_RELEASE	0x0800
+#define CTL_EPROM_SELECT	0x0004
+#define CTL_EPROM_RELOAD	0x0002
+#define CTL_EPROM_STORE		0x0001
+#define	CTL_EPROM_ACCESS	(CTL_EPROM_RELOAD | CTL_EPROM_STORE) /* high if Eprom is being read */
+
+/* BANK 2 */
+#define MMU_CMD		0
+#define MC_BUSY		1	/* only readable bit in the register */
+#define MC_NOP		0
+#define	MC_ALLOC	0x20  	/* or with number of 256 byte packets */
+#define	MC_RESET	0x40	
+#define	MC_REMOVE	0x60  	/* remove the current rx packet */
+#define MC_RELEASE  	0x80  	/* remove and release the current rx packet */
+#define MC_FREEPKT  	0xA0  	/* Release packet in PNR register */
+#define MC_ENQUEUE	0xC0 	/* Enqueue the packet for transmit */
+ 	
+#define	PNR_ARR		2
+#define FIFO_PORTS	4
+
+#define FP_RXEMPTY  0x8000
+#define FP_TXEMPTY  0x80
+
+#define	POINTER		6
+#define PTR_READ	0x2000
+#define	PTR_RCV		0x8000
+#define	PTR_AUTOINC 	0x4000
+
+#define	DATA_1		8
+#define	DATA_2		10
+#define	INTERRUPT	12
+
+#define INT_MASK	13
+#define IM_RCV_INT	0x1
+#define	IM_TX_INT	0x2
+#define	IM_TX_EMPTY_INT	0x4	
+#define	IM_ALLOC_INT	0x8
+#define	IM_RX_OVRN_INT	0x10
+#define	IM_EPH_INT	0x20
+#define	IM_ERCV_INT	0x40 /* not on SMC9192 */		
+
+/* BANK 3 */
+#define	MULTICAST1	0
+#define	MULTICAST2	2
+#define	MULTICAST3	4
+#define	MULTICAST4	6
+#define	MGMT		8
+#define	REVISION	10 /* ( hi: chip id   low: rev # ) */
+
+
+/* this is NOT on SMC9192 */
+#define	ERCV		12
+
+#define CHIP_9190	3
+#define CHIP_9194	4
+#define CHIP_9195	5
+#define CHIP_91100	7
+
+/* 
+ . Transmit status bits 
+*/
+#define TS_SUCCESS 0x0001
+#define TS_LOSTCAR 0x0400
+#define TS_LATCOL  0x0200
+#define TS_16COL   0x0010
+
+/*
+ . Receive status bits
+*/
+#define RS_ALGNERR	0x8000
+#define RS_BADCRC	0x2000
+#define RS_ODDFRAME	0x1000
+#define RS_TOOLONG	0x0800
+#define RS_TOOSHORT	0x0400
+#define RS_MULTICAST	0x0001
+#define RS_ERRORS	(RS_ALGNERR | RS_BADCRC | RS_TOOLONG | RS_TOOSHORT) 
+
+/*
+ * SMC91C96 ethernet config and status registers.
+ * These are in the "attribute" space.
+ */
+#define ECOR		0x8000
+#define ECOR_RESET	0x80
+#define ECOR_LEVEL_IRQ	0x40
+#define ECOR_WR_ATTRIB	0x04
+#define ECOR_ENABLE	0x01
+
+#define ECSR		0x8002
+#define ECSR_IOIS8	0x20
+#define ECSR_PWRDWN	0x04
+#define ECSR_INT	0x02
+
+#endif
Index: build_tree/bootLoader/include/net/smc91x.h
diff -u /dev/null build_tree/bootLoader/include/net/smc91x.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/smc91x.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,707 @@
+/*------------------------------------------------------------------------
+ . smc91x.h - macros for SMSC's 91C9x/91C1xx single-chip Ethernet device.
+ .
+ . Copyright (C) 1996 by Erik Stahlman
+ . Copyright (C) 2001 Standard Microsystems Corporation
+ .	Developed by Simple Network Magic Corporation
+ . Copyright (C) 2003 Monta Vista Software, Inc.
+ .	Unified SMC91x driver by Nicolas Pitre
+ .
+ . This program is free software; you can redistribute it and/or modify
+ . it under the terms of the GNU General Public License as published by
+ . the Free Software Foundation; either version 2 of the License, or
+ . (at your option) any later version.
+ .
+ . This program is distributed in the hope that it will be useful,
+ . but WITHOUT ANY WARRANTY; without even the implied warranty of
+ . MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ . GNU General Public License for more details.
+ .
+ . You should have received a copy of the GNU General Public License
+ . along with this program; if not, write to the Free Software
+ . Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ .
+ . Information contained in this file was obtained from the LAN91C111
+ . manual from SMC.  To get a copy, if you really want one, you can find
+ . information under www.smsc.com.
+ .
+ . Authors
+ .	Erik Stahlman		<erik@vt.edu>
+ .	Daris A Nevil		<dnevil@snmc.com>
+ .	Nicolas Pitre 		<nico@cam.org>
+ .
+ ---------------------------------------------------------------------------*/
+#ifndef _SMC91X_H_
+#define _SMC91X_H_
+
+/*
+ * Define your architecture specific configuration parameters here.
+ */
+
+#if defined(LUBBOCK)
+
+/* We can only do 16-bit reads and writes in the static memory space. */
+#define SMC_CAN_USE_8BIT	0
+#define SMC_CAN_USE_16BIT	1
+#define SMC_CAN_USE_32BIT	0
+#define SMC_NOWAIT		1
+
+/* The first two address lines aren't connected... */
+#define SMC_IO_SHIFT		2
+
+#define SMC_inw(a, r)		readw((a) + (r))
+#define SMC_outw(v, a, r)	writew(v, (a) + (r))
+#define SMC_insw(a, r, p, l)	insw((a) + (r), p, l)
+#define SMC_outsw(a, r, p, l)	outsw((a) + (r), p, l)
+
+#elif	defined(MAINSTONE) || defined(PXA_IDP)
+	
+#define SMC_CAN_USE_8BIT	1
+#define SMC_CAN_USE_16BIT	1
+#define SMC_CAN_USE_32BIT	1
+#define SMC_IO_SHIFT		0
+#define SMC_NOWAIT		1
+
+#define SMC_inb(a, r)		readb((a) + (r))
+#define SMC_inw(a, r)		readw((a) + (r))
+#define SMC_inl(a, r)		readl((a) + (r))
+#define SMC_outb(v, a, r)	writeb(v, (a) + (r))
+#define SMC_outl(v, a, r)	writel(v, (a) + (r))
+#define SMC_insl(a, r, p, l)	insl((a) + (r), p, l)
+#define SMC_outsl(a, r, p, l)	outsl((a) + (r), p, l)
+
+/* We actually can't write halfwords properly if not word aligned */
+static inline void
+SMC_outw(u16 val, unsigned long ioaddr, int reg)
+{
+	if (reg & 2) {
+		unsigned int v = val << 16;
+		v |= readl(ioaddr + (reg & ~2)) & 0xffff;
+		writel(v, ioaddr + (reg & ~2));
+	} else {
+		writew(val, ioaddr + reg);
+	}
+}
+
+#endif
+
+/* Because of bank switching, the LAN91xxx uses only 16 I/O ports */
+#ifndef SMC_IO_SHIFT
+#define SMC_IO_SHIFT	0
+#endif
+#define SMC_IO_EXTENT	(16 << SMC_IO_SHIFT)
+
+
+/*
+ . Bank Select Register:
+ .
+ .		yyyy yyyy 0000 00xx
+ .		xx 		= bank number
+ .		yyyy yyyy	= 0x33, for identification purposes.
+*/
+#define BANK_SELECT		(14 << SMC_IO_SHIFT)
+
+
+// Transmit Control Register
+/* BANK 0  */
+#define TCR_REG 	SMC_REG(0x0000, 0)
+#define TCR_ENABLE	0x0001	// When 1 we can transmit
+#define TCR_LOOP	0x0002	// Controls output pin LBK
+#define TCR_FORCOL	0x0004	// When 1 will force a collision
+#define TCR_PAD_EN	0x0080	// When 1 will pad tx frames < 64 bytes w/0
+#define TCR_NOCRC	0x0100	// When 1 will not append CRC to tx frames
+#define TCR_MON_CSN	0x0400	// When 1 tx monitors carrier
+#define TCR_FDUPLX    	0x0800  // When 1 enables full duplex operation
+#define TCR_STP_SQET	0x1000	// When 1 stops tx if Signal Quality Error
+#define TCR_EPH_LOOP	0x2000	// When 1 enables EPH block loopback
+#define TCR_SWFDUP	0x8000	// When 1 enables Switched Full Duplex mode
+
+#define TCR_CLEAR	0	/* do NOTHING */
+/* the default settings for the TCR register : */
+#define TCR_DEFAULT	(TCR_ENABLE | TCR_PAD_EN)
+
+
+// EPH Status Register
+/* BANK 0  */
+#define EPH_STATUS_REG	SMC_REG(0x0002, 0)
+#define ES_TX_SUC	0x0001	// Last TX was successful
+#define ES_SNGL_COL	0x0002	// Single collision detected for last tx
+#define ES_MUL_COL	0x0004	// Multiple collisions detected for last tx
+#define ES_LTX_MULT	0x0008	// Last tx was a multicast
+#define ES_16COL	0x0010	// 16 Collisions Reached
+#define ES_SQET		0x0020	// Signal Quality Error Test
+#define ES_LTXBRD	0x0040	// Last tx was a broadcast
+#define ES_TXDEFR	0x0080	// Transmit Deferred
+#define ES_LATCOL	0x0200	// Late collision detected on last tx
+#define ES_LOSTCARR	0x0400	// Lost Carrier Sense
+#define ES_EXC_DEF	0x0800	// Excessive Deferral
+#define ES_CTR_ROL	0x1000	// Counter Roll Over indication
+#define ES_LINK_OK	0x4000	// Driven by inverted value of nLNK pin
+#define ES_TXUNRN	0x8000	// Tx Underrun
+
+
+// Receive Control Register
+/* BANK 0  */
+#define RCR_REG		SMC_REG(0x0004, 0)
+#define RCR_RX_ABORT	0x0001	// Set if a rx frame was aborted
+#define RCR_PRMS	0x0002	// Enable promiscuous mode
+#define RCR_ALMUL	0x0004	// When set accepts all multicast frames
+#define RCR_RXEN	0x0100	// IFF this is set, we can receive packets
+#define RCR_STRIP_CRC	0x0200	// When set strips CRC from rx packets
+#define RCR_ABORT_ENB	0x0200	// When set will abort rx on collision
+#define RCR_FILT_CAR	0x0400	// When set filters leading 12 bit s of carrier
+#define RCR_SOFTRST	0x8000 	// resets the chip
+
+/* the normal settings for the RCR register : */
+#define RCR_DEFAULT	(RCR_STRIP_CRC | RCR_RXEN)
+#define RCR_CLEAR	0x0	// set it to a base state
+
+
+// Counter Register
+/* BANK 0  */
+#define COUNTER_REG	SMC_REG(0x0006, 0)
+
+
+// Memory Information Register
+/* BANK 0  */
+#define MIR_REG		SMC_REG(0x0008, 0)
+
+
+// Receive/Phy Control Register
+/* BANK 0  */
+#define RPC_REG		SMC_REG(0x000A, 0)
+#define RPC_SPEED	0x2000	// When 1 PHY is in 100Mbps mode.
+#define RPC_DPLX	0x1000	// When 1 PHY is in Full-Duplex Mode
+#define RPC_ANEG	0x0800	// When 1 PHY is in Auto-Negotiate Mode
+#define RPC_LSXA_SHFT	5	// Bits to shift LS2A,LS1A,LS0A to lsb
+#define RPC_LSXB_SHFT	2	// Bits to get LS2B,LS1B,LS0B to lsb
+#define RPC_LED_100_10	(0x00)	// LED = 100Mbps OR's with 10Mbps link detect
+#define RPC_LED_RES	(0x01)	// LED = Reserved
+#define RPC_LED_10	(0x02)	// LED = 10Mbps link detect
+#define RPC_LED_FD	(0x03)	// LED = Full Duplex Mode
+#define RPC_LED_TX_RX	(0x04)	// LED = TX or RX packet occurred
+#define RPC_LED_100	(0x05)	// LED = 100Mbps link dectect
+#define RPC_LED_TX	(0x06)	// LED = TX packet occurred
+#define RPC_LED_RX	(0x07)	// LED = RX packet occurred
+#define RPC_DEFAULT (RPC_ANEG | (RPC_LED_100_10 << RPC_LSXA_SHFT) | (RPC_LED_TX << RPC_LSXB_SHFT) | RPC_SPEED | RPC_DPLX)
+
+
+/* Bank 0 0x0C is reserved */
+
+// Bank Select Register
+/* All Banks */
+#define BSR_REG		0x000E
+
+
+// Configuration Reg
+/* BANK 1 */
+#define CONFIG_REG	SMC_REG(0x0000,	1)
+#define CONFIG_EXT_PHY	0x0200	// 1=external MII, 0=internal Phy
+#define CONFIG_GPCNTRL	0x0400	// Inverse value drives pin nCNTRL
+#define CONFIG_NO_WAIT	0x1000	// When 1 no extra wait states on ISA bus
+#define CONFIG_EPH_POWER_EN 0x8000 // When 0 EPH is placed into low power mode.
+
+// Default is powered-up, Internal Phy, Wait States, and pin nCNTRL=low
+#define CONFIG_DEFAULT	(CONFIG_EPH_POWER_EN)
+
+
+// Base Address Register
+/* BANK 1 */
+#define BASE_REG	SMC_REG(0x0002, 1)
+
+
+// Individual Address Registers
+/* BANK 1 */
+#define ADDR0_REG	SMC_REG(0x0004, 1)
+#define ADDR1_REG	SMC_REG(0x0006, 1)
+#define ADDR2_REG	SMC_REG(0x0008, 1)
+
+
+// General Purpose Register
+/* BANK 1 */
+#define GP_REG		SMC_REG(0x000A, 1)
+
+
+// Control Register
+/* BANK 1 */
+#define CTL_REG		SMC_REG(0x000C, 1)
+#define CTL_RCV_BAD	0x4000 // When 1 bad CRC packets are received
+#define CTL_AUTO_RELEASE 0x0800 // When 1 tx pages are released automatically
+#define CTL_LE_ENABLE	0x0080 // When 1 enables Link Error interrupt
+#define CTL_CR_ENABLE	0x0040 // When 1 enables Counter Rollover interrupt
+#define CTL_TE_ENABLE	0x0020 // When 1 enables Transmit Error interrupt
+#define CTL_EEPROM_SELECT 0x0004 // Controls EEPROM reload & store
+#define CTL_RELOAD	0x0002 // When set reads EEPROM into registers
+#define CTL_STORE	0x0001 // When set stores registers into EEPROM
+
+
+// MMU Command Register
+/* BANK 2 */
+#define MMU_CMD_REG	SMC_REG(0x0000, 2)
+#define MC_BUSY		1	// When 1 the last release has not completed
+#define MC_NOP		(0<<5)	// No Op
+#define MC_ALLOC	(1<<5) 	// OR with number of 256 byte packets
+#define MC_RESET	(2<<5)	// Reset MMU to initial state
+#define MC_REMOVE	(3<<5) 	// Remove the current rx packet
+#define MC_RELEASE  	(4<<5) 	// Remove and release the current rx packet
+#define MC_FREEPKT  	(5<<5) 	// Release packet in PNR register
+#define MC_ENQUEUE	(6<<5)	// Enqueue the packet for transmit
+#define MC_RSTTXFIFO	(7<<5)	// Reset the TX FIFOs
+
+
+// Packet Number Register
+/* BANK 2 */
+#define PN_REG		SMC_REG(0x0002, 2)
+
+
+// Allocation Result Register
+/* BANK 2 */
+#define AR_REG		SMC_REG(0x0003, 2)
+#define AR_FAILED	0x80	// Alocation Failed
+
+
+// TX FIFO Ports Register
+/* BANK 2 */
+#define FIFO_REG	SMC_REG(0x0004, 2)
+#define TXFIFO_REG	0x0004
+#define TXFIFO_TEMPTY	0x80	// TX FIFO Empty
+
+// RX FIFO Ports Register
+/* BANK 2 */
+#define RXFIFO_REG	SMC_REG(0x0005, 2)
+#define RXFIFO_REMPTY	0x80	// RX FIFO Empty
+
+
+// Pointer Register
+/* BANK 2 */
+#define PTR_REG		SMC_REG(0x0006, 2)
+#define PTR_RCV		0x8000 // 1=Receive area, 0=Transmit area
+#define PTR_AUTOINC 	0x4000 // Auto increment the pointer on each access
+#define PTR_READ	0x2000 // When 1 the operation is a read
+
+
+// Data Register
+/* BANK 2 */
+#define DATA_REG	SMC_REG(0x0008, 2)
+
+
+// Interrupt Status/Acknowledge Register
+/* BANK 2 */
+#define INT_REG		SMC_REG(0x000C, 2)
+
+
+// Interrupt Mask Register
+/* BANK 2 */
+#define IM_REG		SMC_REG(0x000D, 2)
+#define IM_MDINT	0x80 // PHY MI Register 18 Interrupt
+#define IM_ERCV_INT	0x40 // Early Receive Interrupt
+#define IM_EPH_INT	0x20 // Set by Ethernet Protocol Handler section
+#define IM_RX_OVRN_INT	0x10 // Set by Receiver Overruns
+#define IM_ALLOC_INT	0x08 // Set when allocation request is completed
+#define IM_TX_EMPTY_INT	0x04 // Set if the TX FIFO goes empty
+#define IM_TX_INT	0x02 // Transmit Interrupt
+#define IM_RCV_INT	0x01 // Receive Interrupt
+
+
+// Multicast Table Registers
+/* BANK 3 */
+#define MCAST_REG1	SMC_REG(0x0000, 3)
+#define MCAST_REG2	SMC_REG(0x0002, 3)
+#define MCAST_REG3	SMC_REG(0x0004, 3)
+#define MCAST_REG4	SMC_REG(0x0006, 3)
+
+
+// Management Interface Register (MII)
+/* BANK 3 */
+#define MII_REG		SMC_REG(0x0008, 3)
+#define MII_MSK_CRS100	0x4000 // Disables CRS100 detection during tx half dup
+#define MII_MDOE	0x0008 // MII Output Enable
+#define MII_MCLK	0x0004 // MII Clock, pin MDCLK
+#define MII_MDI		0x0002 // MII Input, pin MDI
+#define MII_MDO		0x0001 // MII Output, pin MDO
+
+
+// Revision Register
+/* BANK 3 */
+/* ( hi: chip id   low: rev # ) */
+#define REV_REG		SMC_REG(0x000A, 3)
+
+
+// Early RCV Register
+/* BANK 3 */
+/* this is NOT on SMC9192 */
+#define ERCV_REG	SMC_REG(0x000C, 3)
+#define ERCV_RCV_DISCRD	0x0080 // When 1 discards a packet being received
+#define ERCV_THRESHOLD	0x001F // ERCV Threshold Mask
+
+
+// External Register
+/* BANK 7 */
+#define EXT_REG		SMC_REG(0x0000, 7)
+
+
+#define CHIP_9192	3
+#define CHIP_9194	4
+#define CHIP_9195	5
+#define CHIP_9196	6
+#define CHIP_91100	7
+#define CHIP_91100FD	8
+#define CHIP_91111FD	9
+
+static const char * chip_ids[ 16 ] =  {
+	NULL, NULL, NULL,
+	/* 3 */ "SMC91C90/91C92",
+	/* 4 */ "SMC91C94",
+	/* 5 */ "SMC91C95",
+	/* 6 */ "SMC91C96",
+	/* 7 */ "SMC91C100",
+	/* 8 */ "SMC91C100FD",
+	/* 9 */ "SMC91C11xFD",
+	NULL, NULL, NULL,
+	NULL, NULL, NULL};
+
+
+/*
+ . Transmit status bits
+*/
+#define TS_SUCCESS 0x0001
+#define TS_LOSTCAR 0x0400
+#define TS_LATCOL  0x0200
+#define TS_16COL   0x0010
+
+/*
+ . Receive status bits
+*/
+#define RS_ALGNERR	0x8000
+#define RS_BRODCAST	0x4000
+#define RS_BADCRC	0x2000
+#define RS_ODDFRAME	0x1000
+#define RS_TOOLONG	0x0800
+#define RS_TOOSHORT	0x0400
+#define RS_MULTICAST	0x0001
+#define RS_ERRORS	(RS_ALGNERR | RS_BADCRC | RS_TOOLONG | RS_TOOSHORT)
+
+
+// PHY Types
+enum {
+	PHY_LAN83C183 = 1,	// LAN91C111 Internal PHY
+	PHY_LAN83C180
+};
+
+
+// PHY Register Addresses (LAN91C111 Internal PHY)
+
+// PHY Control Register
+#define PHY_CNTL_REG		0x00
+#define PHY_CNTL_RST		0x8000	// 1=PHY Reset
+#define PHY_CNTL_LPBK		0x4000	// 1=PHY Loopback
+#define PHY_CNTL_SPEED		0x2000	// 1=100Mbps, 0=10Mpbs
+#define PHY_CNTL_ANEG_EN	0x1000	// 1=Enable Auto negotiation
+#define PHY_CNTL_PDN		0x0800	// 1=PHY Power Down mode
+#define PHY_CNTL_MII_DIS	0x0400	// 1=MII 4 bit interface disabled
+#define PHY_CNTL_ANEG_RST	0x0200	// 1=Reset Auto negotiate
+#define PHY_CNTL_DPLX		0x0100	// 1=Full Duplex, 0=Half Duplex
+#define PHY_CNTL_COLTST		0x0080	// 1= MII Colision Test
+
+// PHY Status Register
+#define PHY_STAT_REG		0x01
+#define PHY_STAT_CAP_T4		0x8000	// 1=100Base-T4 capable
+#define PHY_STAT_CAP_TXF	0x4000	// 1=100Base-X full duplex capable
+#define PHY_STAT_CAP_TXH	0x2000	// 1=100Base-X half duplex capable
+#define PHY_STAT_CAP_TF		0x1000	// 1=10Mbps full duplex capable
+#define PHY_STAT_CAP_TH		0x0800	// 1=10Mbps half duplex capable
+#define PHY_STAT_CAP_SUPR	0x0040	// 1=recv mgmt frames with not preamble
+#define PHY_STAT_ANEG_ACK	0x0020	// 1=ANEG has completed
+#define PHY_STAT_REM_FLT	0x0010	// 1=Remote Fault detected
+#define PHY_STAT_CAP_ANEG	0x0008	// 1=Auto negotiate capable
+#define PHY_STAT_LINK		0x0004	// 1=valid link
+#define PHY_STAT_JAB		0x0002	// 1=10Mbps jabber condition
+#define PHY_STAT_EXREG		0x0001	// 1=extended registers implemented
+
+// PHY Identifier Registers
+#define PHY_ID1_REG		0x02	// PHY Identifier 1
+#define PHY_ID2_REG		0x03	// PHY Identifier 2
+
+// PHY Auto-Negotiation Advertisement Register
+#define PHY_AD_REG		0x04
+#define PHY_AD_NP		0x8000	// 1=PHY requests exchange of Next Page
+#define PHY_AD_ACK		0x4000	// 1=got link code word from remote
+#define PHY_AD_RF		0x2000	// 1=advertise remote fault
+#define PHY_AD_T4		0x0200	// 1=PHY is capable of 100Base-T4
+#define PHY_AD_TX_FDX		0x0100	// 1=PHY is capable of 100Base-TX FDPLX
+#define PHY_AD_TX_HDX		0x0080	// 1=PHY is capable of 100Base-TX HDPLX
+#define PHY_AD_10_FDX		0x0040	// 1=PHY is capable of 10Base-T FDPLX
+#define PHY_AD_10_HDX		0x0020	// 1=PHY is capable of 10Base-T HDPLX
+#define PHY_AD_CSMA		0x0001	// 1=PHY is capable of 802.3 CMSA
+
+// PHY Auto-negotiation Remote End Capability Register
+#define PHY_RMT_REG		0x05
+// Uses same bit definitions as PHY_AD_REG
+
+// PHY Configuration Register 1
+#define PHY_CFG1_REG		0x10
+#define PHY_CFG1_LNKDIS		0x8000	// 1=Rx Link Detect Function disabled
+#define PHY_CFG1_XMTDIS		0x4000	// 1=TP Transmitter Disabled
+#define PHY_CFG1_XMTPDN		0x2000	// 1=TP Transmitter Powered Down
+#define PHY_CFG1_BYPSCR		0x0400	// 1=Bypass scrambler/descrambler
+#define PHY_CFG1_UNSCDS		0x0200	// 1=Unscramble Idle Reception Disable
+#define PHY_CFG1_EQLZR		0x0100	// 1=Rx Equalizer Disabled
+#define PHY_CFG1_CABLE		0x0080	// 1=STP(150ohm), 0=UTP(100ohm)
+#define PHY_CFG1_RLVL0		0x0040	// 1=Rx Squelch level reduced by 4.5db
+#define PHY_CFG1_TLVL_SHIFT	2	// Transmit Output Level Adjust
+#define PHY_CFG1_TLVL_MASK	0x003C
+#define PHY_CFG1_TRF_MASK	0x0003	// Transmitter Rise/Fall time
+
+
+// PHY Configuration Register 2
+#define PHY_CFG2_REG		0x11
+#define PHY_CFG2_APOLDIS	0x0020	// 1=Auto Polarity Correction disabled
+#define PHY_CFG2_JABDIS		0x0010	// 1=Jabber disabled
+#define PHY_CFG2_MREG		0x0008	// 1=Multiple register access (MII mgt)
+#define PHY_CFG2_INTMDIO	0x0004	// 1=Interrupt signaled with MDIO pulseo
+
+// PHY Status Output (and Interrupt status) Register
+#define PHY_INT_REG		0x12	// Status Output (Interrupt Status)
+#define PHY_INT_INT		0x8000	// 1=bits have changed since last read
+#define PHY_INT_LNKFAIL		0x4000	// 1=Link Not detected
+#define PHY_INT_LOSSSYNC	0x2000	// 1=Descrambler has lost sync
+#define PHY_INT_CWRD		0x1000	// 1=Invalid 4B5B code detected on rx
+#define PHY_INT_SSD		0x0800	// 1=No Start Of Stream detected on rx
+#define PHY_INT_ESD		0x0400	// 1=No End Of Stream detected on rx
+#define PHY_INT_RPOL		0x0200	// 1=Reverse Polarity detected
+#define PHY_INT_JAB		0x0100	// 1=Jabber detected
+#define PHY_INT_SPDDET		0x0080	// 1=100Base-TX mode, 0=10Base-T mode
+#define PHY_INT_DPLXDET		0x0040	// 1=Device in Full Duplex
+
+// PHY Interrupt/Status Mask Register
+#define PHY_MASK_REG		0x13	// Interrupt Mask
+// Uses the same bit definitions as PHY_INT_REG
+
+
+/*
+ * SMC91C96 ethernet config and status registers.
+ * These are in the "attribute" space.
+ */
+#define ECOR			0x8000
+#define ECOR_RESET		0x80
+#define ECOR_LEVEL_IRQ		0x40
+#define ECOR_WR_ATTRIB		0x04
+#define ECOR_ENABLE		0x01
+
+#define ECSR			0x8002
+#define ECSR_IOIS8		0x20
+#define ECSR_PWRDWN		0x04
+#define ECSR_INT		0x02
+
+
+/*
+ * Macros to abstract register access according to the data bus
+ * capabilities.  Please try to use those and not the in/out primitives.
+ * Note: the following macros do *not* select the bank -- this must
+ * be done separately as needed in the main code.  The SMC_REG() macro
+ * only uses the bank argument for debugging purposes.
+ */
+
+#if SMC_DEBUG > 0
+#define SMC_REG(reg, bank)						\
+	({								\
+		int __b = SMC_CURRENT_BANK();				\
+		if ((__b & ~0xf0) != (0x3300 | bank)) {			\
+			printk( "%s: bank reg screwed (0x%04x)\n",	\
+				CARDNAME, __b );			\
+			BUG();						\
+		}							\
+		reg<<SMC_IO_SHIFT;					\
+	})
+#else
+#define SMC_REG(reg, bank)	(reg<<SMC_IO_SHIFT)
+#endif
+
+#if SMC_CAN_USE_8BIT
+#define SMC_GET_PN()		SMC_inb( ioaddr, PN_REG )
+#define SMC_SET_PN(x)		SMC_outb( x, ioaddr, PN_REG )
+#define SMC_GET_AR()		SMC_inb( ioaddr, AR_REG )
+#define SMC_GET_TXFIFO()	SMC_inb( ioaddr, TXFIFO_REG )
+#define SMC_GET_RXFIFO()	SMC_inb( ioaddr, RXFIFO_REG )
+#define SMC_GET_INT()		SMC_inb( ioaddr, INT_REG )
+#define SMC_ACK_INT(x)		SMC_outb( x, ioaddr, INT_REG )
+#define SMC_GET_INT_MASK()	SMC_inb( ioaddr, IM_REG )
+#define SMC_SET_INT_MASK(x)	SMC_outb( x, ioaddr, IM_REG )
+#else
+#define SMC_GET_PN()		(SMC_inw( ioaddr, PN_REG ) & 0xFF)
+#define SMC_SET_PN(x)		SMC_outw( x, ioaddr, PN_REG )
+#define SMC_GET_AR()		(SMC_inw( ioaddr, PN_REG ) >> 8)
+#define SMC_GET_TXFIFO()	(SMC_inw( ioaddr, TXFIFO_REG ) & 0xFF)
+#define SMC_GET_RXFIFO()	(SMC_inw( ioaddr, TXFIFO_REG ) >> 8)
+#define SMC_GET_INT()		(SMC_inw( ioaddr, INT_REG ) & 0xFF)
+#define SMC_ACK_INT(x)							\
+	do {								\
+		long __flags;						\
+		int __mask;						\
+		__mask = SMC_inw( ioaddr, INT_REG ) & ~0xff;		\
+		SMC_outw( __mask | (x), ioaddr, INT_REG );		\
+	} while (0)
+#define SMC_GET_INT_MASK()	(SMC_inw( ioaddr, INT_REG ) >> 8)
+#define SMC_SET_INT_MASK(x)	SMC_outw( (x) << 8, ioaddr, INT_REG )
+#endif
+
+#define SMC_CURRENT_BANK()	SMC_inw( ioaddr, BANK_SELECT )
+#define SMC_SELECT_BANK(x)	SMC_outw( x, ioaddr, BANK_SELECT )
+#define SMC_GET_BASE()		SMC_inw( ioaddr, BASE_REG )
+#define SMC_SET_BASE(x)		SMC_outw( x, ioaddr, BASE_REG )
+#define SMC_GET_CONFIG()	SMC_inw( ioaddr, CONFIG_REG )
+#define SMC_SET_CONFIG(x)	SMC_outw( x, ioaddr, CONFIG_REG )
+#define SMC_GET_COUNTER()	SMC_inw( ioaddr, COUNTER_REG )
+#define SMC_GET_CTL()		SMC_inw( ioaddr, CTL_REG )
+#define SMC_SET_CTL(x)		SMC_outw( x, ioaddr, CTL_REG )
+#define SMC_GET_MII()		SMC_inw( ioaddr, MII_REG )
+#define SMC_SET_MII(x)		SMC_outw( x, ioaddr, MII_REG )
+#define SMC_GET_MIR()		SMC_inw( ioaddr, MIR_REG )
+#define SMC_SET_MIR(x)		SMC_outw( x, ioaddr, MIR_REG )
+#define SMC_GET_MMU_CMD()	SMC_inw( ioaddr, MMU_CMD_REG )
+#define SMC_SET_MMU_CMD(x)	SMC_outw( x, ioaddr, MMU_CMD_REG )
+#define SMC_GET_FIFO()		SMC_inw( ioaddr, FIFO_REG )
+#define SMC_GET_PTR()		SMC_inw( ioaddr, PTR_REG )
+#define SMC_SET_PTR(x)		SMC_outw( x, ioaddr, PTR_REG )
+#define SMC_GET_RCR()		SMC_inw( ioaddr, RCR_REG )
+#define SMC_SET_RCR(x)		SMC_outw( x, ioaddr, RCR_REG )
+#define SMC_GET_REV()		SMC_inw( ioaddr, REV_REG )
+#define SMC_GET_RPC()		SMC_inw( ioaddr, RPC_REG )
+#define SMC_SET_RPC(x)		SMC_outw( x, ioaddr, RPC_REG )
+#define SMC_GET_TCR()		SMC_inw( ioaddr, TCR_REG )
+#define SMC_SET_TCR(x)		SMC_outw( x, ioaddr, TCR_REG )
+
+#ifndef SMC_GET_MAC_ADDR
+#define SMC_GET_MAC_ADDR(addr)						\
+	do {								\
+		unsigned int __v;					\
+		__v = SMC_inw( ioaddr, ADDR0_REG );			\
+		addr[0] = __v; addr[1] = __v >> 8;			\
+		__v = SMC_inw( ioaddr, ADDR1_REG );			\
+		addr[2] = __v; addr[3] = __v >> 8;			\
+		__v = SMC_inw( ioaddr, ADDR2_REG );			\
+		addr[4] = __v; addr[5] = __v >> 8;			\
+	} while (0)
+#endif
+
+#define SMC_SET_MAC_ADDR(addr)						\
+	do {								\
+		SMC_outw( addr[0]|(addr[1] << 8), ioaddr, ADDR0_REG );	\
+		SMC_outw( addr[2]|(addr[3] << 8), ioaddr, ADDR1_REG );	\
+		SMC_outw( addr[4]|(addr[5] << 8), ioaddr, ADDR2_REG );	\
+	} while (0)
+
+#define SMC_CLEAR_MCAST()						\
+	do {								\
+		SMC_outw( 0, ioaddr, MCAST_REG1 );			\
+		SMC_outw( 0, ioaddr, MCAST_REG2 );			\
+		SMC_outw( 0, ioaddr, MCAST_REG3 );			\
+		SMC_outw( 0, ioaddr, MCAST_REG4 );			\
+	} while (0)
+#define SMC_SET_MCAST(x)						\
+	do {								\
+		unsigned char *mt = (x);				\
+		SMC_outw( mt[0] | (mt[1] << 8), ioaddr, MCAST_REG1 );	\
+		SMC_outw( mt[2] | (mt[3] << 8), ioaddr, MCAST_REG2 );	\
+		SMC_outw( mt[4] | (mt[5] << 8), ioaddr, MCAST_REG3 );	\
+		SMC_outw( mt[6] | (mt[7] << 8), ioaddr, MCAST_REG4 );	\
+	} while (0)
+
+#if SMC_CAN_USE_32BIT
+/*
+ * Some setups just can't write 8 or 16 bits reliably when not aligned
+ * to a 32 bit boundary.  I tell you that exists!
+ * We do the ones that can have their low parts written to 0 here.
+ */
+#undef SMC_SELECT_BANK
+#define SMC_SELECT_BANK(x)	SMC_outl( (x)<<16, ioaddr, 12<<SMC_IO_SHIFT )
+#undef SMC_SET_RPC
+#define SMC_SET_RPC(x)		SMC_outl( (x)<<16, ioaddr, SMC_REG(8, 0) )
+#undef SMC_SET_PN
+#define SMC_SET_PN(x)		SMC_outl( (x)<<16, ioaddr, SMC_REG(0, 2) )
+#undef SMC_SET_PTR
+#define SMC_SET_PTR(x)		SMC_outl( (x)<<16, ioaddr, SMC_REG(4, 2) )
+#endif
+
+#if SMC_CAN_USE_32BIT
+#define SMC_PUT_PKT_HDR(status, length)					\
+	SMC_outl( (status) | (length) << 16, ioaddr, DATA_REG )
+#define SMC_GET_PKT_HDR(status, length)					\
+	do {								\
+		unsigned int __val = SMC_inl( ioaddr, DATA_REG );	\
+		(status) = __val & 0xffff;				\
+		(length) = __val >> 16;					\
+	} while (0)
+#else
+#define SMC_PUT_PKT_HDR(status, length)					\
+	do {								\
+		SMC_outw( status, ioaddr, DATA_REG );			\
+		SMC_outw( length, ioaddr, DATA_REG );			\
+	} while (0)
+#define SMC_GET_PKT_HDR(status, length)					\
+	do {								\
+		(status) = SMC_inw( ioaddr, DATA_REG );			\
+		(length) = SMC_inw( ioaddr, DATA_REG );			\
+	} while (0)
+#endif
+
+#if SMC_CAN_USE_32BIT
+#define SMC_PUSH_DATA(p, l)						\
+	do {								\
+		char *__ptr = (p);					\
+		int __len = (l);					\
+		if (__len >= 2 && (long)__ptr & 2) {			\
+			__len -= 2;					\
+			SMC_outw( *((u16 *)__ptr)++, ioaddr, DATA_REG );\
+		}							\
+		SMC_outsl( ioaddr, DATA_REG, __ptr, __len >> 2);	\
+		if (__len & 2) {					\
+			__ptr += (__len & ~3);				\
+			SMC_outw( *((u16 *)__ptr), ioaddr, DATA_REG );	\
+		}							\
+	} while (0)
+#define SMC_PULL_DATA(p, l)						\
+	do {								\
+		char *__ptr = (p);					\
+		int __len = (l);					\
+		if ((long)__ptr & 2) {					\
+			/*						\
+			 * We want 32bit alignment here.		\
+			 * Since some buses perform a full 32bit	\
+			 * fetch even for 16bit data we can't use	\
+			 * SMC_inw() here.  Back both source (on chip	\
+			 * and destination) pointers of 2 bytes.	\
+			 */						\
+			(long)__ptr &= ~2;				\
+			__len += 2;					\
+			SMC_SET_PTR( 2|PTR_READ|PTR_RCV|PTR_AUTOINC );	\
+		}							\
+		__len += 2;						\
+		SMC_insl( ioaddr, DATA_REG, __ptr, __len >> 2);		\
+	} while (0)
+#elif SMC_CAN_USE_16BIT
+#define SMC_PUSH_DATA(p, l)	SMC_outsw( ioaddr, DATA_REG, p, (l) >> 1 )
+#define SMC_PULL_DATA(p, l)	SMC_insw ( ioaddr, DATA_REG, p, (l) >> 1 )
+#elif SMC_CAN_USE_8BIT
+#define SMC_PUSH_DATA(p, l)	SMC_outsb( ioaddr, DATA_REG, p, l )
+#define SMC_PULL_DATA(p, l)	SMC_insb ( ioaddr, DATA_REG, p, l )
+#endif
+
+#if ! SMC_CAN_USE_16BIT
+#define SMC_outw(x, ioaddr, reg)					\
+	do {								\
+		unsigned int __val16 = (x);				\
+		SMC_outb( __val16, ioaddr, reg );			\
+		SMC_outb( __val16 >> 8, ioaddr, reg + 1 );		\
+	} while (0)
+#define SMC_inw(ioaddr, reg)						\
+	({								\
+		unsigned int __val16;					\
+		__val16 =  SMC_inb( ioaddr, reg );			\
+		__val16 |= SMC_inb( ioaddr, reg + 1 ) << 8;		\
+		__val16;						\
+	})
+#endif
+
+
+#endif  /* _SMC91X_H_ */
Index: build_tree/bootLoader/include/net/tftp.h
diff -u /dev/null build_tree/bootLoader/include/net/tftp.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/include/net/tftp.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,25 @@
+/*
+ *  tftp.h
+ *
+ *  Copyright 2003 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+
+#ifndef _BLOB_TFTP_H
+#define _BLOB_TFTP_H 1
+
+/**********************************************************************
+ * do_tftp - fetch file via tftp
+ * @file: the file name on the server to fetch
+ * @addr: the address to store the file to
+ * @size: where to store the number of bytes received
+ *
+ * TFTP file transfer function. Needs client and server IP address
+ * to be set.
+ */
+int do_tftp( char *file, unsigned long addr, unsigned long *size );
+
+#endif
Index: build_tree/bootLoader/src/.cvsignore
diff -u /dev/null build_tree/bootLoader/src/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile.in
+Makefile
Index: build_tree/bootLoader/src/Makefile.am
diff -u build_tree/bootLoader/src/Makefile.am:1.1.1.1 build_tree/bootLoader/src/Makefile.am:1.1.1.2
--- build_tree/bootLoader/src/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,7 @@
 # -*- makefile -*-
 ###########################################################################
 ## Filename:      Makefile.am
-## Version:       $Id: Makefile.am,v 1.14 2001/10/07 19:04:24 erikm Exp $
+## Version:       $Id: Makefile.am,v 1.16 2003/08/06 22:55:40 abz Exp $
 ## Copyright:     Copyright (C) 1999, Erik Mouw
 ## Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 ## Description:   Makefile
@@ -11,9 +11,9 @@
 ###########################################################################
 
 SUBDIRS		= \
+	commands \
 	lib \
-	blob \
-	diag
+	blob
 
 
 CLEANFILES	= ${srcdir}/*~
Index: build_tree/bootLoader/src/Makefile.in
diff -u build_tree/bootLoader/src/Makefile.in:1.1.1.1 build_tree/bootLoader/src/Makefile.in:1.2
--- build_tree/bootLoader/src/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,101 +12,208 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 ###########################################################################
 ###########################################################################
-
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = src
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-SUBDIRS =  	lib 	blob 	diag
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+SUBDIRS = \
+	commands \
+	lib \
+	blob
 
 CLEANFILES = ${srcdir}/*~
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-DIST_COMMON =  Makefile.am Makefile.in
+all: all-recursive
 
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps src/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
 # into them and run `make' without going through this Makefile.
@@ -112,13 +221,8 @@
 # (1) if the variable is set in `config.status', edit `config.status'
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
-
-@SET_MAKE@
-
-all-recursive install-data-recursive install-exec-recursive \
-installdirs-recursive install-recursive uninstall-recursive  \
-check-recursive installcheck-recursive info-recursive dvi-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -138,13 +242,18 @@
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
-	rev=''; list='$(SUBDIRS)'; for subdir in $$list; do \
-	  rev="$$subdir $$rev"; \
-	  test "$$subdir" = "." && dot_seen=yes; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
 	done; \
-	test "$$dot_seen" = "no" && rev=". $$rev"; \
+	rev="$$rev ."; \
 	target=`echo $@ | sed s/-recursive//`; \
 	for subdir in $$rev; do \
 	  echo "Making $$target in $$subdir"; \
@@ -160,135 +269,197 @@
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
 
-tags: TAGS
-
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
+	mkid -fID $$unique
+tags: TAGS
 
-TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
-   if test "$$subdir" = .; then :; else \
-	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
-   fi; \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = src
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d $(distdir)/$$subdir \
-	    || mkdir $(distdir)/$$subdir \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
 	    || exit 1; \
-	    chmod 777 $(distdir)/$$subdir; \
-	    (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$(top_distdir) distdir=../$(distdir)/$$subdir distdir) \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
 	      || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-recursive
-dvi-am:
-dvi: dvi-recursive
 check-am: all-am
 check: check-recursive
-installcheck-am:
-installcheck: installcheck-recursive
-install-exec-am:
+all-am: Makefile
+installdirs: installdirs-recursive
+installdirs-am:
+install: install-recursive
 install-exec: install-exec-recursive
-
-install-data-am:
 install-data: install-data-recursive
+uninstall: uninstall-recursive
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-recursive
-uninstall-am:
-uninstall: uninstall-recursive
-all-am: Makefile
-all-redirect: all-recursive
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs: installdirs-recursive
-installdirs-am:
-
 
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-recursive
 
-mostlyclean: mostlyclean-recursive
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-tags clean-generic mostlyclean-am
+distclean: distclean-recursive
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
 
-clean: clean-recursive
+dvi: dvi-recursive
+
+dvi-am:
 
-distclean-am:  distclean-tags distclean-generic clean-am
+html: html-recursive
 
-distclean: distclean-recursive
+info: info-recursive
 
-maintainer-clean-am:  maintainer-clean-tags maintainer-clean-generic \
-		distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-recursive
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-info-am
 
-.PHONY: install-data-recursive uninstall-data-recursive \
-install-exec-recursive uninstall-exec-recursive installdirs-recursive \
-uninstalldirs-recursive all-recursive check-recursive \
-installcheck-recursive info-recursive dvi-recursive \
-mostlyclean-recursive distclean-recursive clean-recursive \
-maintainer-clean-recursive tags tags-recursive mostlyclean-tags \
-distclean-tags clean-tags maintainer-clean-tags distdir info-am info \
-dvi-am dvi check check-am installcheck-am installcheck install-exec-am \
-install-exec install-data-am install-data install-am install \
-uninstall-am uninstall all-redirect all-am all installdirs-am \
-installdirs mostlyclean-generic distclean-generic clean-generic \
-maintainer-clean-generic clean mostlyclean distclean maintainer-clean
+uninstall-info: uninstall-info-recursive
 
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
+	clean clean-generic clean-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-recursive distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-generic \
+	mostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/src/blob/.cvsignore
diff -u /dev/null build_tree/bootLoader/src/blob/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,7 @@
+Makefile.in
+Makefile
+blob*
+commands.c
+rest-ld-script
+*.o
+.deps
Index: build_tree/bootLoader/src/blob/I2C_CS.s
diff -u /dev/null build_tree/bootLoader/src/blob/I2C_CS.s:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/I2C_CS.s	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,541 @@
+;*********************************************************************************
+;
+;        COPYRIGHT (c) 2002 Intel Corporation
+;
+;   The information in this file is furnished for informational use only,
+;   is subject to change without notice, and should not be construed as
+;   a commitment by Intel Corporation. Intel Corporation assumes no
+;   responsibility or liability for any errors or inaccuracies that may appear
+;   in this document or any software that may be provided in association with
+;   this document.
+;
+;*********************************************************************************
+;
+;                                     I2C_CS.s
+;                    MainStone Platform Subroutines for the I2C bus
+;
+; Copyright (c) 2002 - 2003 by Intel Corp. Hudson MA
+;
+; All subroutines in this file are called with the branch with link (bl) instruction. These
+; subroutines provide an easy way to send data out to a selected UART without the need to have
+; system memory working (other than flash), or stack pointer. These routines also work by
+; polling the I2C bus to see if it is ready to accept more data rather than using interrupts.
+;
+; List of subroutines in this file:
+;
+;
+; xlli_I2C_corv   (Subroutine) updates processor core voltage DAC
+;
+;
+        INCLUDE xlli_Bulverde_defs.inc
+        INCLUDE xlli_Mainstone_defs.inc
+        INCLUDE bbu_Bulverde_defs.inc
+
+        GLOBAL  xlli_put_PI2C   ; (SPECIAL - To write to power management chip)
+        GLOBAL  xlli_putI2C
+        GLOBAL  xlli_getI2C
+        GLOBAL  bbu_putPI2C
+        GLOBAL  bbu_getPI2C
+
+        EXTERN  bbu_FONT_5X7
+
+        AREA  |text|,CODE,READONLY
+;
+;*********************************************************************************
+;
+;       *****************
+;       *               * 
+;       * xlli_put_PI2C * Subroutine
+;       *               *
+;       *****************
+;
+
+;
+; This subroutine is used to write data to the Power Manager on the Power I2C bus
+
+;
+; PARAMETER PASSING:
+;
+;       r7 = data to be sent to the core voltage DAC
+;
+; RETURNED PARAMETER:
+;
+;       r8 = non zero means no time out
+;       r8 = zero means I2C bus time out
+;
+; 
+;
+xlli_put_PI2C      FUNCTION
+;
+;       Make sure the clock to the I2C unit is enabled
+;
+        ldr    r3,  =xlli_CLKREGS_PHYSICAL_BASE     ; Base address of clock unit
+        ldr    r2,  [r3, #xlli_CKEN_offset]         ; Get current setting of clock enable register
+        orr    r2,  r2,  #0x8000                    ; Set bit 15 in the clcok enable word
+        str    r2,  [r3, #xlli_CKEN_offset]         ; Write the register back
+;
+;       Init the I2C controller for use
+;
+        ldr    r1,  =xlli_PMRCREGS_PHYSICAL_BASE    ; Load Power Manager controller base address
+        ldr    r3,  [r1, #xlli_PCFR_offset]         ; Get present Config register data
+        orr    r3,  r3,  #0x40                      ; Enable power manager I2C
+        str    r3,  [r1, #xlli_PCFR_offset]         ; Write Config register data back
+
+        mov    r2,  #0                              ; Set host controller slave address
+        str    r2,  [r1, #xlli_PI2SAR_offset]       ; Set slave address register
+        str    r2,  [r1, #xlli_PI2CR_offset]        ; Clear interrupts in ICR
+        mov    r3,  #(bbu_ICR_IUE | bbu_ICR_SCLE)   ; Set IUE and SCLE bits
+        str    r3,  [r1, #xlli_PI2CR_offset]        ; Enable the I2C in ICR
+;
+;       Set the slave's address
+;
+        mov    r2,  #0x40
+        str    r2,  [r1, #xlli_PI2DBR_offset]       ; Load Data Buffer Register (PMIC address = 0x40)
+;
+;       Send 1st byte
+;
+        orr    r3,  r3,  #(bbu_ICR_TB | bbu_ICR_START)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB and START bits (in addition to IUE & SCLE)
+
+1       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B1                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 2nd byte (ADDRESS)
+;
+        mov    r4,  #0                                    ; Address of register in the slave device
+        str    r4,  [r1, #xlli_PI2DBR_offset]             ; Set register address in the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB bit to start transfer
+        mov    r8,  #0x80000                              ; set up time out value
+
+2       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        subs   r8,  r8,  #1                               ; Decrement time out counter
+        moveq  pc,  lr                                    ; Return if no ACK signal
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B2                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 3rd byte (Low byte of data)
+;
+        and    r4,  r7, #0xFF                             ; Extract the lower 8 bits of the data
+        str    r4,  [r1, #xlli_PI2DBR_offset]             ; Set low data byte into the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB bit to start transfer
+
+3       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B3                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 4th byte (High byte of data) and STOP signal
+;
+        and    r4,  r7, #0x300                            ; Extract the upper 2 bits of the data
+        mov    r4,  r4, LSR #8                            ; Shift the data right by 8 bits   
+        str    r4,  [r1, #xlli_PI2DBR_offset]             ; Set high data byte into the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_STOP)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB bit to start transfer
+
+4       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B4                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+
+        mov    pc,  lr                                    ; Return to caller
+
+        ENDFUNC
+
+;//AERONIX
+;
+;*********************************************************************************
+;
+;       ***************
+;       *             * 
+;       * xlli_getI2C * Subroutine
+;       *             *
+;       ***************
+;
+; This subroutine is used to read data from the I2C bus
+
+;
+; PARAMETER PASSING:
+;
+;       r4 = address in target device where data is to be read from
+;       r5 = data read from the register pointed to by r4
+;
+; RETURNED VALUE:
+;
+;       r8 = non zero if no I2C bus time out
+;       r8 = zero if I2C bus time out 
+;
+; REGISTERS USED:
+;
+;       r1, r2, r3, r4, r5, r6, r8 are used and not preserved 
+;
+xlli_getI2C       FUNCTION
+;
+;       Make sure the clock to the I2C unit is enabled
+;
+        ldr    r3,  =xlli_CLKREGS_PHYSICAL_BASE     ; Base address of clock unit
+        ldr    r2,  [r3, #xlli_CKEN_offset]         ; Get current setting of clock enable register
+        orr    r2,  r2,  #0x4000                    ; Set bit 14 in the clock enable word
+        str    r2,  [r3, #xlli_CKEN_offset]         ; Write the register back
+;
+;       Init the I2C controller for use
+;
+        ldr    r1,  =bbu_I2C_PHYSICAL_BASE          ; Load I2C controller base address
+        mov    r2,  #0                              ; Set host controller slave address
+        str    r2,  [r1, #bbu_I2C_ISAR_offset]      ; Set slave address register
+        str    r2,  [r1, #bbu_I2C_ICR_offset]       ; Clear interrupts in ICR
+        mov    r3,  #(bbu_ICR_IUE | bbu_ICR_SCLE)   ; Set IUE and SCLE bits
+        str    r3,  [r1, #bbu_I2C_ICR_offset]       ; Enable the I2C in ICR
+;
+;       Get the slave's address
+;
+        ldr    r6,  =bbu_FFUART_PHYSICAL_BASE       ; Fetch base address of the FFUART
+        ldr    r9,  [r6, #bbu_UASPR_offset]         ; Get contents of the scratch pad register
+        str    r9,  [r1, #bbu_I2C_IDBR_offset]      ; Load Data Buffer Register
+;
+;       Send 1st byte
+;
+        orr    r3,  r3,  #(bbu_ICR_TB | bbu_ICR_START)
+        str    r3,  [r1, #bbu_I2C_ICR_offset]             ; Set TB and START bits (in addition to IUE & SCLE)
+
+1       ldr    r3,  [r1, #bbu_I2C_ISR_offset]             ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B1                                        ; No - still being transmitted
+        str    r3,  [r1, #bbu_I2C_ISR_offset]             ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 2nd byte (ADDRESS)
+;
+        str    r4,  [r1, #bbu_I2C_IDBR_offset]            ; Set register address in the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_STOP)
+        str    r3,  [r1, #bbu_I2C_ICR_offset]             ; Set TB bit to start transfer
+        mov    r8,  #0x80000                              ; Set up time out value
+
+2       ldr    r3,  [r1, #bbu_I2C_ISR_offset]             ; Get status register contents
+        subs   r8,  r8,  #1                               ; Decrement time out value
+        moveq  pc,  lr                                    ; Return if timed out
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B2                                        ; No - still being transmitted
+        str    r3,  [r1, #bbu_I2C_ISR_offset]             ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 3rd byte - Slave read address
+;
+88      orr    r9,  r9,  #1                               ; Turn the address into a slave address
+        str    r9,  [r1, #bbu_I2C_IDBR_offset]            ; Load Data Buffer Register
+
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_START)
+        str    r3,  [r1, #bbu_I2C_ICR_offset]             ; Set TB bit to start transfer
+
+3       ldr    r3,  [r1, #bbu_I2C_ISR_offset]             ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B3                                        ; No - still being transmitted
+        str    r3,  [r1, #bbu_I2C_ISR_offset]             ; Write the ITE & IRF bits to clear them (sticky)
+;
+;       Send STOP signal
+;
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_STOP | bbu_ICR_ACKNAK)
+        str    r3,  [r1, #bbu_I2C_ICR_offset]             ; Set TB bit to start transfer
+;
+;       Set up and then receive data byte
+;
+5       ldr    r3,  [r1, #bbu_I2C_ISR_offset]       ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_IRF               ; Was the byte received yet?
+        beq    %B5                                  ; no - keep looping
+        str    r3,  [r1, #bbu_I2C_ISR_offset]       ; Write the IRF bit to clear it (sticky)
+
+        ldr    r5,  [r1, #bbu_I2C_IDBR_offset]      ; Fetch data byte from the IDBR
+        mov    pc,  lr                              ; Return to caller
+
+		ENDFUNC
+;
+;*********************************************************************************
+;
+;       ***************
+;       *             * 
+;       * xlli_putI2C * Subroutine
+;       *             *
+;       ***************
+;
+; This subroutine is used to write data to the I2C bus
+
+;
+; PARAMETER PASSING:
+;
+;       r4 = address in target device where data is to be sent
+;       r5 = data to be loaded into the register pointed to by r4
+;
+; RETURNED VALUE:
+;
+;       r8 = non zero if no I2C bus time out
+;       r8 = zero if I2C bus time out 
+;
+xlli_putI2C      FUNCTION
+;
+;       Make sure the clock to the I2C unit is enabled
+;
+        ldr    r3,  =xlli_CLKREGS_PHYSICAL_BASE     ; Base address of clock unit
+        ldr    r2,  [r3, #xlli_CKEN_offset]         ; Get current setting of clock enable register
+        orr    r2,  r2,  #0x4000                    ; Set bit 14 in the clcok enable word
+        str    r2,  [r3, #xlli_CKEN_offset]         ; Write the register back
+;
+;       Init the I2C controller for use
+;
+        ldr    r1,  =bbu_I2C_PHYSICAL_BASE          ; Load I2C controller base address
+        mov    r2,  #0                              ; Set host controller slave address
+        str    r2,  [r1, #bbu_I2C_ISAR_offset]      ; Set slave address register
+        str    r2,  [r1, #bbu_I2C_ICR_offset]       ; Clear interrupts in ICR
+        mov    r3,  #(bbu_ICR_IUE | bbu_ICR_SCLE)   ; Set IUE and SCLE bits
+        str    r3,  [r1, #bbu_I2C_ICR_offset]       ; Enable the I2C in ICR
+;
+;       Get the slaves address
+;
+        ldr    r8,  =bbu_FFUART_PHYSICAL_BASE       ; Fetch base address of FFUART
+        ldr    r9,  [r8, #bbu_UASPR_offset]         ; Get contents of the scratch pad register
+        str    r9,  [r1, #bbu_I2C_IDBR_offset]      ; Load Data Buffer Register
+;
+;       Send 1st byte
+;
+        orr    r3,  r3,  #(bbu_ICR_TB | bbu_ICR_START)
+        str    r3,  [r1, #bbu_I2C_ICR_offset]             ; Set TB and START bits (in addition to IUE & SCLE)
+
+1       ldr    r3,  [r1, #bbu_I2C_ISR_offset]             ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B1                                        ; No - still being transmitted
+        str    r3,  [r1, #bbu_I2C_ISR_offset]             ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 2nd byte (ADDRESS)
+;
+        str    r4,  [r1, #bbu_I2C_IDBR_offset]            ; Set register address in the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE)
+        str    r3,  [r1, #bbu_I2C_ICR_offset]             ; Set TB bit to start transfer
+        mov    r8,  #0X80000                              ; Set up time out value
+
+2       ldr    r3,  [r1, #bbu_I2C_ISR_offset]             ; Get status register contents
+        subs   r8,  r8,  #1                               ; Decrement time out value
+        moveq  pc,  lr                                    ; Return if there was a time out
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B2                                        ; No - still being transmitted
+		str    r3,  [r1, #bbu_I2C_ISR_offset]             ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 3rd byte (DATA) and STOP signal
+;
+        str    r5,  [r1, #bbu_I2C_IDBR_offset]            ; Set data byte into the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_STOP)
+        str    r3,  [r1, #bbu_I2C_ICR_offset]             ; Set TB bit to start transfer
+
+3       ldr    r3,  [r1, #bbu_I2C_ISR_offset]             ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B3                                        ; No - still being transmitted
+        str    r3,  [r1, #bbu_I2C_ISR_offset]             ; Write the ITE bit to clear it (sticky)
+
+        mov    pc,  lr                              ; Return to caller
+
+        ENDFUNC
+; -------------------------------------------------------
+;
+;*********************************************************************************
+;
+;       ***************
+;       *             * 
+;       * bbu_getPI2C * Subroutine
+;       *             *
+;       ***************
+;
+; This subroutine is used to read data from the Power I2C bus
+
+;
+; PARAMETER PASSING:
+;
+;       r4 = address in target device where data is to be read from
+;       r5 = data read from the register pointed to by r4
+;
+; RETURNED VALUE:
+;
+;       r8 = non zero if no I2C bus time out
+;       r8 = zero if I2C bus time out 
+;
+; REGISTERS USED:
+;
+;       r1, r2, r3, r4, r5, r6, r8 are used and not preserved 
+;
+bbu_getPI2C     FUNCTION
+;
+;       Make sure the clock to the I2C unit is enabled
+;
+        ldr    r3,  =xlli_CLKREGS_PHYSICAL_BASE     ; Base address of clock unit
+        ldr    r2,  [r3, #xlli_CKEN_offset]         ; Get current setting of clock enable register
+        orr    r2,  r2,  #0x8000                    ; Set bit 15 in the clock enable word
+        str    r2,  [r3, #xlli_CKEN_offset]         ; Write the register back
+;
+;       Init the Power I2C controller for use
+;
+        ldr    r1,  =xlli_PMRCREGS_PHYSICAL_BASE    ; Load Power Manager controller base address
+        ldr    r3,  [r1, #xlli_PCFR_offset]         ; Get present Config register data
+        orr    r3,  r3,  #bbu_PI2C_EN               ; Enable power manager I2C bus
+        str    r3,  [r1, #xlli_PCFR_offset]         ; Write Config register data back
+
+        mov    r2,  #0                              ; Set host controller slave address
+        str    r2,  [r1, #xlli_PI2SAR_offset]       ; Set slave address register
+        str    r2,  [r1, #xlli_PI2CR_offset]        ; Clear interrupts in ICR
+        mov    r3,  #(bbu_ICR_IUE | bbu_ICR_SCLE)   ; Set IUE and SCLE bits
+        str    r3,  [r1, #xlli_PI2CR_offset]        ; Enable the I2C in ICR
+;
+;       Get the slave's address
+;
+        ldr    r6,  =bbu_FFUART_PHYSICAL_BASE       ; Fetch base address of the FFUART
+        ldr    r9,  [r6, #bbu_UASPR_offset]         ; Get contents of the scratch pad register
+        str    r9,  [r1, #xlli_PI2DBR_offset]       ; Load Data Buffer Register
+;
+;       Send 1st byte
+;
+        orr    r3,  r3,  #(bbu_ICR_TB | bbu_ICR_START)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB and START bits (in addition to IUE & SCLE)
+        mov    r8,  #0x80000                              ; Set up time out value
+
+1       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        subs   r8,  r8,  #1                               ; Decrement time out value
+        moveq  pc,  lr                                    ; Return if timed out
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B1                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 2nd byte (ADDRESS)
+;
+        str    r4,  [r1, #xlli_PI2DBR_offset]             ; Set register address in the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_STOP)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB bit to start transfer
+        mov    r8,  #0x80000                              ; Set up time out value
+
+2       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        subs   r8,  r8,  #1                               ; Decrement time out value
+        moveq  pc,  lr                                    ; Return if timed out
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B2                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 3rd byte - Slave read address
+;
+88      orr    r9,  r9,  #1                               ; Turn the address into a slave address
+        str    r9,  [r1, #xlli_PI2DBR_offset]             ; Load Data Buffer Register
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_START)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB bit to start transfer
+
+3       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B3                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE & IRF bits to clear them (sticky)
+;
+;       Send STOP signal
+;
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_STOP | bbu_ICR_ACKNAK)
+        str    r3,  [r1, #xlli_PI2CR_offset]             ; Set TB bit to start transfer
+        mov    r8,  #0x80000                             ; Set up time out value
+;
+;       Set up and then receive data byte (seems to hang in the following loop * 24-Oct-03)
+;
+5       ldr    r3,  [r1, #xlli_PI2SR_offset]        ; Get status register contents
+        subs   r8,  r8,  #1                         ; Decrement time out counter
+        addeq  r8,  r8,  #1                         ; Increment back to 1 if timed out
+        moveq  pc,  lr                              ; and return to caller
+        ands   r3,  r3,  #bbu_ISR_IRF               ; Was the byte received yet?
+        beq    %B5                                  ; no - keep looping
+        str    r3,  [r1, #xlli_PI2SR_offset]        ; Write the IRF bit to clear it (sticky)
+
+        ldr    r5,  [r1, #xlli_PI2DBR_offset]       ; Fetch data byte from the IDBR
+        mov    pc,  lr                              ; Return to caller
+
+        ENDFUNC
+;
+;*********************************************************************************
+;
+;       ***************
+;       *             * 
+;       * bbu_putPI2C * Subroutine
+;       *             *
+;       ***************
+;
+; This subroutine is used to write data to the PI2C bus
+
+;
+; PARAMETER PASSING:
+;
+;       r4 = address in target device where data is to be sent
+;       r5 = data to be loaded into the register pointed to by r4
+;
+; RETURNED VALUE:
+;
+;       r8 = non zero if no I2C bus time out
+;       r8 = zero if I2C bus time out 
+;
+bbu_putPI2C      FUNCTION
+;
+;       Make sure the clock to the I2C unit is enabled
+;
+        ldr    r3,  =xlli_CLKREGS_PHYSICAL_BASE     ; Base address of clock unit
+        ldr    r2,  [r3, #xlli_CKEN_offset]         ; Get current setting of clock enable register
+        orr    r2,  r2,  #0x8000                    ; Set bit 15 in the clock enable word
+        str    r2,  [r3, #xlli_CKEN_offset]         ; Write the register back
+;
+;       Init the Power I2C controller for use
+;
+        ldr    r1,  =xlli_PMRCREGS_PHYSICAL_BASE    ; Load Power Manager controller base address
+        ldr    r3,  [r1, #xlli_PCFR_offset]         ; Get present Config register data
+        orr    r3,  r3,  #0x40                      ; Enable power manager I2C
+        str    r3,  [r1, #xlli_PCFR_offset]         ; Write Config register data back
+
+        mov    r2,  #0                              ; Set host controller slave address
+        str    r2,  [r1, #xlli_PI2SAR_offset]       ; Set slave address register
+        str    r2,  [r1, #xlli_PI2CR_offset]        ; Clear interrupts in ICR
+        mov    r3,  #(bbu_ICR_IUE | bbu_ICR_SCLE)   ; Set IUE and SCLE bits
+        str    r3,  [r1, #xlli_PI2CR_offset]        ; Enable the I2C in ICR
+;
+;       Get the slave's address
+;
+        ldr    r8,  =bbu_FFUART_PHYSICAL_BASE       ; Fetch base address of FFUART
+        ldr    r9,  [r8, #bbu_UASPR_offset]         ; Get contents of the scratch pad register
+        str    r9,  [r1, #xlli_PI2DBR_offset]       ; Load Data Buffer Register
+;
+;       Send 1st byte
+;
+        orr    r3,  r3,  #(bbu_ICR_TB | bbu_ICR_START)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB and START bits (in addition to IUE & SCLE)
+
+1       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B1                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 2nd byte (ADDRESS)
+;
+        str    r4,  [r1, #xlli_PI2DBR_offset]             ; Set register address in the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB bit to start transfer
+        mov    r8,  #0X80000                              ; Set up time out value
+
+2       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        subs   r8,  r8,  #1                               ; Decrement time out value
+        moveq  pc,  lr                                    ; Return if there was a time out
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B2                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+;
+;       Set up and then send 3rd byte (DATA) and STOP signal
+;
+        str    r5,  [r1, #xlli_PI2DBR_offset]             ; Set data byte into the IDBR
+        mov    r3,  #(bbu_ICR_TB | bbu_ICR_IUE | bbu_ICR_SCLE | bbu_ICR_STOP)
+        str    r3,  [r1, #xlli_PI2CR_offset]              ; Set TB bit to start transfer
+
+3       ldr    r3,  [r1, #xlli_PI2SR_offset]              ; Get status register contents
+        ands   r3,  r3,  #bbu_ISR_ITE                     ; Was the byte sent yet?
+        beq    %B3                                        ; No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              ; Write the ITE bit to clear it (sticky)
+
+        mov    pc,  lr                              ; Return to caller
+
+        ENDFUNC
+
+        END
+
Index: build_tree/bootLoader/src/blob/Makefile.am
diff -u build_tree/bootLoader/src/blob/Makefile.am:1.1.1.1 build_tree/bootLoader/src/blob/Makefile.am:1.1.1.2
--- build_tree/bootLoader/src/blob/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -4,7 +4,7 @@
 #
 # Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
 #
-# $Id: Makefile.am,v 1.15 2002/01/07 15:00:14 erikm Exp $
+# $Id: Makefile.am,v 1.46 2003/09/04 18:10:42 russd Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -21,94 +21,36 @@
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 #
 
-
 bin_PROGRAMS	= \
-	blob-start-elf32 \
-	blob-start \
-	blob-start-chain-elf32 \
-	blob-start-chain \
 	blob-rest-elf32 \
 	blob-rest \
-	blob \
-	blob-chain
+	blob-elf32 \
+	blob
 
+SUBDIRS		=  xlli
 
-INCLUDES		+= \
+INCLUDES		= \
 	-I${top_builddir}/include \
-	-I${top_srcdir}/include
+	-I${top_srcdir}/include \
+	-I${LINUX_INCLUDE}
 
 
 # ---- Built sources -------------------------------------------------
 
 BUILT_SOURCES = \
-	rest-ld-script
+	rest-ld-script \
+	commands.c
 
 
 rest-ld-script: rest-ld-script.in
-	$(CC) -x c-header -undef -nostdinc ${INCLUDES} -E $< | sed 's/^#.*//' > $@
-
-
-
-
-# ---- Blob first stage loader ---------------------------------------
-
-# WARNING: start.S *must* be the first file, otherwise the target will
-# be linked in the wrong order!
-blob_start_elf32_SOURCES	= \
-	start.S \
-	ledasm.S \
-	testmem.S
-
-EXTRA_blob_start_elf32_SOURCES	= \
-	memsetup-sa1100.S \
-	memsetup-sa1110.S
-
-blob_start_elf32_DEPENDENCIES	= \
-	@MEMSETUP@ \
-	start-ld-script
-
-blob_start_elf32_LDFLAGS	+= \
-	-Wl,-T,${srcdir}/start-ld-script
-
-blob_start_elf32_LDADD	+= \
-	@MEMSETUP@ \
-	-lgcc
-
-
-blob_start_SOURCES		=
-
-
-blob-start: blob-start-elf32
-	$(OBJCOPY) $(OCFLAGS) $< $@
-
-
-
+	$(CC) -x c-header -undef -nostdinc ${INCLUDES} -D__ASSEMBLY__ -E $< | sed 's/^#.*//' > $@
 
-# ---- Blob first stage chain loader --------------------------------
-
-# WARNING: chain.S *must* be the first file, otherwise the target will
-# be linked in the wrong order!
-blob_start_chain_elf32_SOURCES	= \
-	chain.S \
-	ledasm.S
-
-blob_start_chain_elf32_DEPENDENCIES =\
-	start-ld-script
-
-blob_start_chain_elf32_LDFLAGS	+= \
-	-Wl,-T,${srcdir}/start-ld-script
-
-blob_start_chain_elf32_LDADD	+= \
-	-lgcc
-
-
-blob_start_chain_SOURCES		=
-
-
-blob-start-chain: blob-start-chain-elf32
-	$(OBJCOPY) $(OCFLAGS) $< $@
+commands.c:
+	${top_srcdir}/src/commands/make_commands.sh @BLOB_COMMANDS@ > $@
 
 
+.S.o:
+	$(COMPILE) -D__ASSEMBLY__ -c $<
 
 
 # ---- Blob second stage ---------------------------------------------
@@ -118,11 +60,11 @@
 blob_rest_elf32_SOURCES = \
 	trampoline.S \
 	flashasm.S \
-	stack.S \
 	testmem2.S \
 	bootldrpart.c \
 	commands.c \
 	flash.c \
+	flash-commands.c \
 	initcalls.c \
 	linux.c \
 	main.c \
@@ -130,91 +72,116 @@
 	param_block.c \
 	partition.c \
 	reboot.c \
-	uucodec.c \
-	xmodem.c
+	load_kernel.c \
+	zImage.c
 
 
 # conditionally compiled sources
 EXTRA_blob_rest_elf32_SOURCES = \
 	chkmem.c \
 	clock.c \
-	debug.c \
-	amd32.c \
-	intel16.c \
-	intel32.c \
-	nullflash.c \
-	assabet.c \
-	brutus.c \
-	badge4.c \
-	clart.c \
-	h3600.c \
-	idr.c \
-	jornada720.c \
-	lart.c \
-	nesa.c \
-	pleb.c \
-	shannon.c \
-	system3.c
+	amd16.c amd32.c intel16.c intel32.c nullflash.c \
+	cramfs.c \
+	compr_rtime.c compr_rubin.c jffs2.c \
+	uucodec.c \
+	xmodem.c \
+	accelent_sa.c assabet.c brutus.c badge4.c cep.c clart.c dafit.c frodo.c \
+	hackkit.c h3600.c idr.c jornada720.c lart.c miniprint.c nesa.c pleb.c \
+	ramses.c shannon.c smdk2500.c system3.c trizeps.c pxa_idp.c csir_ims.c
 
 
 blob_rest_elf32_DEPENDENCIES = \
-	@BLOB_PLATFORM_OBJ@ \
+	@BLOB_CHKMEM_OBJS@ \
+	@BLOB_CLOCK_OBJS@ \
+	@BLOB_CRAMFS_OBJS@ \
+	@BLOB_ZIMAGE_OBJS@ \
 	@BLOB_FLASH_OBJS@ \
-	@CHKMEM@ \
-	@DEBUG@ \
-	@CLOCK@ \
+	@BLOB_JFFS2_OBJS@ \
+	@BLOB_PLATFORM_OBJS@ \
+	@BLOB_UUCODEC_OBJS@ \
+	@BLOB_XMODEM_OBJS@ \
+	${top_builddir}/src/commands/libcommands.a \
 	${top_builddir}/src/lib/libblob.a \
 	rest-ld-script
 
 
-blob_rest_elf32_LDFLAGS	+= \
-	-Wl,-T,rest-ld-script
+blob_rest_elf32_LDFLAGS	= \
+	-static -nostdlib \
+	-Wl,-T,rest-ld-script \
+	-Wl,-Map,blob-rest-elf32.map
 
 
-blob_rest_elf32_LDADD	+= \
-	@BLOB_PLATFORM_OBJ@ \
+blob_rest_elf32_LDADD	= \
+	@BLOB_CHKMEM_OBJS@ \
+	@BLOB_CLOCK_OBJS@ \
+	@BLOB_CRAMFS_OBJS@ \
 	@BLOB_FLASH_OBJS@ \
-	@CHKMEM@ \
-	@DEBUG@ \
-	@CLOCK@ \
-	-L${top_builddir}/src/lib -lblob \
+	@BLOB_JFFS2_OBJS@ \
+	@BLOB_PLATFORM_OBJS@ \
+	@BLOB_UUCODEC_OBJS@ \
+	@BLOB_XMODEM_OBJS@ \
+	-L${top_builddir}/src/commands -L${top_builddir}/src/lib \
+	-lcommands -lblob \
 	-lgcc
 
 
 blob_rest_SOURCES	=
 
 
-blob-rest: blob-rest-elf32
+blob-rest$(EXEEXT): blob-rest-elf32
 	$(OBJCOPY) $(OCFLAGS) $< $@
 
 
+# create an object file from the binary so we can link it into the
+# first stage loaders
+blob-rest-piggy.o: blob-rest
+	$(LD) -r -o $@ -b binary $<
 
 
-# ---- Final blob binary ---------------------------------------------
-
-blob_SOURCES	=
-
-
-blob: blob-start blob-rest
-	rm -f $@
-	dd if=blob-start of=$@ bs=1k conv=sync
-	dd if=blob-rest of=$@ bs=1k seek=1
-	chmod +x $@
-
+# ---- Blob first stage loader ---------------------------------------
 
+# WARNING: start.S *must* be the first file, otherwise the target will
+# be linked in the wrong order!
+blob_elf32_SOURCES	= \
+	start.S \
+	testmem.S
 
+EXTRA_blob_elf32_SOURCES	= \
+	ledasm-mmap.S \
+	ledasm-s3c2500.S \
+	ledasm-sa11x0.S \
+	memsetup-s3c2500.S \
+	memsetup-sa1100.S \
+	memsetup-sa1110.S \
+	start-s3c2500.S \
+	start-pxa.S \
+	gpio-pxa.S \
+	start-sa11x0.S
+
+blob_elf32_DEPENDENCIES	= \
+	@BLOB_LED_STARTCODE@ \
+	@BLOB_MEMSETUP_OBJS@ \
+	@BLOB_STARTCODE_OBJS@ \
+	start-ld-script \
+	blob-rest-piggy.o
 
-# ---- Final blob chain loader binary --------------------------------
+blob_elf32_LDFLAGS	= \
+	-static -nostdlib \
+	-Wl,-T,${srcdir}/start-ld-script \
+	-Wl,-Map,blob-start-elf32.map
+
+blob_elf32_LDADD	= \
+	@BLOB_LED_STARTCODE@ \
+	@BLOB_MEMSETUP_OBJS@ \
+	@BLOB_STARTCODE_OBJS@ \
+	-lgcc
 
-blob_chain_SOURCES	=
 
-blob-chain: blob-start-chain blob-rest
-	rm -f $@
-	dd if=blob-start-chain of=$@ bs=1k conv=sync
-	dd if=blob-rest of=$@ bs=1k seek=1
-	chmod +x $@
+blob_SOURCES		=
 
 
+blob$(EXEEXT): blob-elf32
+	$(OBJCOPY) $(OCFLAGS) $< $@
 
 
 # ---- Automake administrativia --------------------------------------
@@ -224,7 +191,9 @@
 	rest-ld-script.in
 
 
-CLEANFILES	= ${srcdir}/*~ rest-ld-script
+CLEANFILES	= \
+	${srcdir}/*~ rest-ld-script \
+	commands.c *.map blob-rest-piggy.o
 
 
 DISTCLEANFILES	= ${builddir}/.deps/*.P
Index: build_tree/bootLoader/src/blob/Makefile.in
diff -u build_tree/bootLoader/src/blob/Makefile.in:1.1.1.1 build_tree/bootLoader/src/blob/Makefile.in:1.2
--- build_tree/bootLoader/src/blob/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,13 +12,15 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 #
 # Makefile.am
 #
 # Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
 #
-# $Id: Makefile.am,v 1.15 2002/01/07 15:00:14 erikm Exp $
+# $Id: Makefile.am,v 1.46 2003/09/04 18:10:42 russd Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -33,484 +37,775 @@
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 #
 
-
-SHELL = @SHELL@
+SOURCES = $(blob_SOURCES) $(blob_elf32_SOURCES) $(EXTRA_blob_elf32_SOURCES) $(blob_rest_SOURCES) $(blob_rest_elf32_SOURCES) $(EXTRA_blob_rest_elf32_SOURCES)
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ../..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+bin_PROGRAMS = blob-rest-elf32$(EXEEXT) blob-rest$(EXEEXT) \
+	blob-elf32$(EXEEXT) blob$(EXEEXT)
+subdir = src/blob
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+am__installdirs = "$(DESTDIR)$(bindir)"
+binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
+PROGRAMS = $(bin_PROGRAMS)
+am_blob_OBJECTS =
+blob_OBJECTS = $(am_blob_OBJECTS)
+blob_LDADD = $(LDADD)
+am_blob_elf32_OBJECTS = start.$(OBJEXT) testmem.$(OBJEXT)
+blob_elf32_OBJECTS = $(am_blob_elf32_OBJECTS)
+am_blob_rest_OBJECTS =
+blob_rest_OBJECTS = $(am_blob_rest_OBJECTS)
+blob_rest_LDADD = $(LDADD)
+am_blob_rest_elf32_OBJECTS = trampoline.$(OBJEXT) flashasm.$(OBJEXT) \
+	testmem2.$(OBJEXT) bootldrpart.$(OBJEXT) commands.$(OBJEXT) \
+	flash.$(OBJEXT) flash-commands.$(OBJEXT) initcalls.$(OBJEXT) \
+	linux.$(OBJEXT) main.$(OBJEXT) memory.$(OBJEXT) \
+	param_block.$(OBJEXT) partition.$(OBJEXT) reboot.$(OBJEXT) \
+	load_kernel.$(OBJEXT) zImage.$(OBJEXT)
+blob_rest_elf32_OBJECTS = $(am_blob_rest_elf32_OBJECTS)
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include/blob
+depcomp = $(SHELL) $(top_srcdir)/tools/depcomp
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/accelent_sa.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/amd16.Po ./$(DEPDIR)/amd32.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/assabet.Po ./$(DEPDIR)/badge4.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/bootldrpart.Po ./$(DEPDIR)/brutus.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/cep.Po ./$(DEPDIR)/chkmem.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/clart.Po ./$(DEPDIR)/clock.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/commands.Po ./$(DEPDIR)/compr_rtime.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/compr_rubin.Po ./$(DEPDIR)/cramfs.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/csir_ims.Po ./$(DEPDIR)/dafit.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/flash-commands.Po ./$(DEPDIR)/flash.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/frodo.Po ./$(DEPDIR)/h3600.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/hackkit.Po ./$(DEPDIR)/idr.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/initcalls.Po ./$(DEPDIR)/intel16.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/intel32.Po ./$(DEPDIR)/jffs2.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/jornada720.Po ./$(DEPDIR)/lart.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/linux.Po ./$(DEPDIR)/load_kernel.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/main.Po ./$(DEPDIR)/memory.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/miniprint.Po ./$(DEPDIR)/nesa.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/nullflash.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/param_block.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/partition.Po ./$(DEPDIR)/pleb.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/pxa_idp.Po ./$(DEPDIR)/ramses.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/reboot.Po ./$(DEPDIR)/shannon.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/smdk2500.Po ./$(DEPDIR)/system3.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/trizeps.Po ./$(DEPDIR)/uucodec.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/xmodem.Po ./$(DEPDIR)/zImage.Po
+CCASCOMPILE = $(CCAS) $(AM_CCASFLAGS) $(CCASFLAGS)
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(blob_SOURCES) $(blob_elf32_SOURCES) \
+	$(EXTRA_blob_elf32_SOURCES) $(blob_rest_SOURCES) \
+	$(blob_rest_elf32_SOURCES) $(EXTRA_blob_rest_elf32_SOURCES)
+DIST_SOURCES = $(blob_SOURCES) $(blob_elf32_SOURCES) \
+	$(EXTRA_blob_elf32_SOURCES) $(blob_rest_SOURCES) \
+	$(blob_rest_elf32_SOURCES) $(EXTRA_blob_rest_elf32_SOURCES)
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-bin_PROGRAMS =  	blob-start-elf32 	blob-start 	blob-start-chain-elf32 	blob-start-chain 	blob-rest-elf32 	blob-rest 	blob 	blob-chain
-
-
-INCLUDES =  	-I${top_builddir}/include 	-I${top_srcdir}/include
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+SUBDIRS = xlli
+INCLUDES = \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include \
+	-I${LINUX_INCLUDE}
 
 
 # ---- Built sources -------------------------------------------------
-
-BUILT_SOURCES =  	rest-ld-script
-
-
-# ---- Blob first stage loader ---------------------------------------
-
-# WARNING: start.S *must* be the first file, otherwise the target will
-# be linked in the wrong order!
-blob_start_elf32_SOURCES =  	start.S 	ledasm.S 	testmem.S
-
-
-EXTRA_blob_start_elf32_SOURCES =  	memsetup-sa1100.S 	memsetup-sa1110.S
-
-
-blob_start_elf32_DEPENDENCIES =  	@MEMSETUP@ 	start-ld-script
-
-
-blob_start_elf32_LDFLAGS =  	-Wl,-T,${srcdir}/start-ld-script
+BUILT_SOURCES = \
+	rest-ld-script \
+	commands.c
 
 
-blob_start_elf32_LDADD =  	@MEMSETUP@ 	-lgcc
-
-
-blob_start_SOURCES = 
-
-# ---- Blob first stage chain loader --------------------------------
-
-# WARNING: chain.S *must* be the first file, otherwise the target will
-# be linked in the wrong order!
-blob_start_chain_elf32_SOURCES =  	chain.S 	ledasm.S
-
-
-blob_start_chain_elf32_DEPENDENCIES =  	start-ld-script
-
-
-blob_start_chain_elf32_LDFLAGS =  	-Wl,-T,${srcdir}/start-ld-script
-
-
-blob_start_chain_elf32_LDADD =  	-lgcc
-
-
-blob_start_chain_SOURCES = 
-
 # ---- Blob second stage ---------------------------------------------
 
 # WARNING: trampoline.S *must* be the first file, otherwise the target
 # will be linked in the wrong order!
-blob_rest_elf32_SOURCES =  	trampoline.S 	flashasm.S 	stack.S 	testmem2.S 	bootldrpart.c 	commands.c 	flash.c 	initcalls.c 	linux.c 	main.c 	memory.c 	param_block.c 	partition.c 	reboot.c 	uucodec.c 	xmodem.c
+blob_rest_elf32_SOURCES = \
+	trampoline.S \
+	flashasm.S \
+	testmem2.S \
+	bootldrpart.c \
+	commands.c \
+	flash.c \
+	flash-commands.c \
+	initcalls.c \
+	linux.c \
+	main.c \
+	memory.c \
+	param_block.c \
+	partition.c \
+	reboot.c \
+	load_kernel.c \
+	zImage.c
 
 
 # conditionally compiled sources
-EXTRA_blob_rest_elf32_SOURCES =  	chkmem.c 	clock.c 	debug.c 	amd32.c 	intel16.c 	intel32.c 	nullflash.c 	assabet.c 	brutus.c 	badge4.c 	clart.c 	h3600.c 	idr.c 	jornada720.c 	lart.c 	nesa.c 	pleb.c 	shannon.c 	system3.c
-
-
-blob_rest_elf32_DEPENDENCIES =  	@BLOB_PLATFORM_OBJ@ 	@BLOB_FLASH_OBJS@ 	@CHKMEM@ 	@DEBUG@ 	@CLOCK@ 	${top_builddir}/src/lib/libblob.a 	rest-ld-script
-
-
-blob_rest_elf32_LDFLAGS =  	-Wl,-T,rest-ld-script
-
-
-blob_rest_elf32_LDADD =  	@BLOB_PLATFORM_OBJ@ 	@BLOB_FLASH_OBJS@ 	@CHKMEM@ 	@DEBUG@ 	@CLOCK@ 	-L${top_builddir}/src/lib -lblob 	-lgcc
-
+EXTRA_blob_rest_elf32_SOURCES = \
+	chkmem.c \
+	clock.c \
+	amd16.c amd32.c intel16.c intel32.c nullflash.c \
+	cramfs.c \
+	compr_rtime.c compr_rubin.c jffs2.c \
+	uucodec.c \
+	xmodem.c \
+	accelent_sa.c assabet.c brutus.c badge4.c cep.c clart.c dafit.c frodo.c \
+	hackkit.c h3600.c idr.c jornada720.c lart.c miniprint.c nesa.c pleb.c \
+	ramses.c shannon.c smdk2500.c system3.c trizeps.c pxa_idp.c csir_ims.c
+
+blob_rest_elf32_DEPENDENCIES = \
+	@BLOB_CHKMEM_OBJS@ \
+	@BLOB_CLOCK_OBJS@ \
+	@BLOB_CRAMFS_OBJS@ \
+	@BLOB_ZIMAGE_OBJS@ \
+	@BLOB_FLASH_OBJS@ \
+	@BLOB_JFFS2_OBJS@ \
+	@BLOB_PLATFORM_OBJS@ \
+	@BLOB_UUCODEC_OBJS@ \
+	@BLOB_XMODEM_OBJS@ \
+	${top_builddir}/src/commands/libcommands.a \
+	${top_builddir}/src/lib/libblob.a \
+	rest-ld-script
+
+blob_rest_elf32_LDFLAGS = \
+	-static -nostdlib \
+	-Wl,-T,rest-ld-script \
+	-Wl,-Map,blob-rest-elf32.map
+
+blob_rest_elf32_LDADD = \
+	@BLOB_CHKMEM_OBJS@ \
+	@BLOB_CLOCK_OBJS@ \
+	@BLOB_CRAMFS_OBJS@ \
+	@BLOB_FLASH_OBJS@ \
+	@BLOB_JFFS2_OBJS@ \
+	@BLOB_PLATFORM_OBJS@ \
+	@BLOB_UUCODEC_OBJS@ \
+	@BLOB_XMODEM_OBJS@ \
+	-L${top_builddir}/src/commands -L${top_builddir}/src/lib \
+	-lcommands -lblob \
+	-lgcc
 
 blob_rest_SOURCES = 
 
-# ---- Final blob binary ---------------------------------------------
-
-blob_SOURCES = 
+# ---- Blob first stage loader ---------------------------------------
 
-# ---- Final blob chain loader binary --------------------------------
+# WARNING: start.S *must* be the first file, otherwise the target will
+# be linked in the wrong order!
+blob_elf32_SOURCES = \
+	start.S \
+	testmem.S
+
+EXTRA_blob_elf32_SOURCES = \
+	ledasm-mmap.S \
+	ledasm-s3c2500.S \
+	ledasm-sa11x0.S \
+	memsetup-s3c2500.S \
+	memsetup-sa1100.S \
+	memsetup-sa1110.S \
+	start-s3c2500.S \
+	start-pxa.S \
+	gpio-pxa.S \
+	start-sa11x0.S
+
+blob_elf32_DEPENDENCIES = \
+	@BLOB_LED_STARTCODE@ \
+	@BLOB_MEMSETUP_OBJS@ \
+	@BLOB_STARTCODE_OBJS@ \
+	start-ld-script \
+	blob-rest-piggy.o
+
+blob_elf32_LDFLAGS = \
+	-static -nostdlib \
+	-Wl,-T,${srcdir}/start-ld-script \
+	-Wl,-Map,blob-start-elf32.map
+
+blob_elf32_LDADD = \
+	@BLOB_LED_STARTCODE@ \
+	@BLOB_MEMSETUP_OBJS@ \
+	@BLOB_STARTCODE_OBJS@ \
+	-lgcc
 
-blob_chain_SOURCES = 
+blob_SOURCES = 
 
 # ---- Automake administrativia --------------------------------------
-
-EXTRA_DIST =  	start-ld-script 	rest-ld-script.in
-
-
-CLEANFILES = ${srcdir}/*~ rest-ld-script
+EXTRA_DIST = \
+	start-ld-script \
+	rest-ld-script.in
+
+CLEANFILES = \
+	${srcdir}/*~ rest-ld-script \
+	commands.c *.map blob-rest-piggy.o
 
 DISTCLEANFILES = ${builddir}/.deps/*.P
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-PROGRAMS =  $(bin_PROGRAMS)
-
+all: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) all-recursive
 
-DEFS = @DEFS@ -I. -I$(srcdir) -I../../include/blob
-CPPFLAGS = @CPPFLAGS@
-LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
-blob_start_elf32_OBJECTS =  start.o ledasm.o testmem.o
-blob_start_OBJECTS = 
-blob_start_LDADD = $(LDADD)
-blob_start_DEPENDENCIES = 
-blob_start_LDFLAGS = 
-blob_start_chain_elf32_OBJECTS =  chain.o ledasm.o
-blob_start_chain_OBJECTS = 
-blob_start_chain_LDADD = $(LDADD)
-blob_start_chain_DEPENDENCIES = 
-blob_start_chain_LDFLAGS = 
-blob_rest_elf32_OBJECTS =  trampoline.o flashasm.o stack.o testmem2.o \
-bootldrpart.o commands.o flash.o initcalls.o linux.o main.o memory.o \
-param_block.o partition.o reboot.o uucodec.o xmodem.o
-blob_rest_OBJECTS = 
-blob_rest_LDADD = $(LDADD)
-blob_rest_DEPENDENCIES = 
-blob_rest_LDFLAGS = 
-blob_OBJECTS = 
-blob_LDADD = $(LDADD)
-blob_DEPENDENCIES = 
-blob_LDFLAGS = 
-blob_chain_OBJECTS = 
-blob_chain_LDADD = $(LDADD)
-blob_chain_DEPENDENCIES = 
-blob_chain_LDFLAGS = 
-CFLAGS = @CFLAGS@
-COMPILE = $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
-CCLD = $(CC)
-LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(LDFLAGS) -o $@
-DIST_COMMON =  Makefile.am Makefile.in
-
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-SOURCES = $(blob_start_elf32_SOURCES) $(EXTRA_blob_start_elf32_SOURCES) $(blob_start_SOURCES) $(blob_start_chain_elf32_SOURCES) $(blob_start_chain_SOURCES) $(blob_rest_elf32_SOURCES) $(EXTRA_blob_rest_elf32_SOURCES) $(blob_rest_SOURCES) $(blob_SOURCES) $(blob_chain_SOURCES)
-OBJECTS = $(blob_start_elf32_OBJECTS) $(blob_start_OBJECTS) $(blob_start_chain_elf32_OBJECTS) $(blob_start_chain_OBJECTS) $(blob_rest_elf32_OBJECTS) $(blob_rest_OBJECTS) $(blob_OBJECTS) $(blob_chain_OBJECTS)
-
-all: all-redirect
 .SUFFIXES:
-.SUFFIXES: .S .c .o .s
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps src/blob/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
-
-mostlyclean-binPROGRAMS:
-
-clean-binPROGRAMS:
-	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
-
-distclean-binPROGRAMS:
-
-maintainer-clean-binPROGRAMS:
-
+.SUFFIXES: .S .c .o .obj
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/blob/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/blob/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	$(mkinstalldirs) $(DESTDIR)$(bindir)
+	test -z "$(bindir)" || $(mkdir_p) "$(DESTDIR)$(bindir)"
 	@list='$(bin_PROGRAMS)'; for p in $$list; do \
-	  if test -f $$p; then \
-	    echo "  $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`"; \
-	     $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`; \
+	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
+	  if test -f $$p \
+	  ; then \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) '$$p' '$(DESTDIR)$(bindir)/$$f'"; \
+	   $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) "$$p" "$(DESTDIR)$(bindir)/$$f" || exit 1; \
 	  else :; fi; \
 	done
 
 uninstall-binPROGRAMS:
 	@$(NORMAL_UNINSTALL)
-	list='$(bin_PROGRAMS)'; for p in $$list; do \
-	  rm -f $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`; \
+	@list='$(bin_PROGRAMS)'; for p in $$list; do \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  echo " rm -f '$(DESTDIR)$(bindir)/$$f'"; \
+	  rm -f "$(DESTDIR)$(bindir)/$$f"; \
 	done
 
-.c.o:
-	$(COMPILE) -c $<
-
-.s.o:
-	$(COMPILE) -c $<
-
-.S.o:
-	$(COMPILE) -c $<
+clean-binPROGRAMS:
+	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
+blob-elf32$(EXEEXT): $(blob_elf32_OBJECTS) $(blob_elf32_DEPENDENCIES) 
+	@rm -f blob-elf32$(EXEEXT)
+	$(LINK) $(blob_elf32_LDFLAGS) $(blob_elf32_OBJECTS) $(blob_elf32_LDADD) $(LIBS)
+blob-rest-elf32$(EXEEXT): $(blob_rest_elf32_OBJECTS) $(blob_rest_elf32_DEPENDENCIES) 
+	@rm -f blob-rest-elf32$(EXEEXT)
+	$(LINK) $(blob_rest_elf32_LDFLAGS) $(blob_rest_elf32_OBJECTS) $(blob_rest_elf32_LDADD) $(LIBS)
 
 mostlyclean-compile:
-	-rm -f *.o core *.core
-
-clean-compile:
+	-rm -f *.$(OBJEXT)
 
 distclean-compile:
 	-rm -f *.tab.c
 
-maintainer-clean-compile:
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/accelent_sa.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/amd16.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/amd32.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/assabet.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/badge4.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/bootldrpart.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/brutus.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cep.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/chkmem.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/clart.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/clock.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/commands.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/compr_rtime.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/compr_rubin.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cramfs.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/csir_ims.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dafit.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/flash-commands.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/flash.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/frodo.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/h3600.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/hackkit.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/idr.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/initcalls.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/intel16.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/intel32.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/jffs2.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/jornada720.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lart.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/linux.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/main.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memory.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/miniprint.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/nesa.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/nullflash.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/param_block.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/partition.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pleb.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pxa_idp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ramses.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reboot.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/shannon.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smdk2500.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/system3.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/trizeps.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/uucodec.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/xmodem.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/zImage.Po@am__quote@
 
-blob-start-elf32: $(blob_start_elf32_OBJECTS) $(blob_start_elf32_DEPENDENCIES)
-	@rm -f blob-start-elf32
-	$(LINK) $(blob_start_elf32_LDFLAGS) $(blob_start_elf32_OBJECTS) $(blob_start_elf32_LDADD) $(LIBS)
-
-blob-start-chain-elf32: $(blob_start_chain_elf32_OBJECTS) $(blob_start_chain_elf32_DEPENDENCIES)
-	@rm -f blob-start-chain-elf32
-	$(LINK) $(blob_start_chain_elf32_LDFLAGS) $(blob_start_chain_elf32_OBJECTS) $(blob_start_chain_elf32_LDADD) $(LIBS)
+.S.obj:
+	$(CCASCOMPILE) -c `$(CYGPATH_W) '$<'`
 
-blob-rest-elf32: $(blob_rest_elf32_OBJECTS) $(blob_rest_elf32_DEPENDENCIES)
-	@rm -f blob-rest-elf32
-	$(LINK) $(blob_rest_elf32_LDFLAGS) $(blob_rest_elf32_OBJECTS) $(blob_rest_elf32_LDADD) $(LIBS)
+.c.o:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c `$(CYGPATH_W) '$<'`
+uninstall-info-am:
+
+# This directory's subdirectories are mostly independent; you can cd
+# into them and run `make' without going through this Makefile.
+# To change the values of `make' variables: instead of editing Makefiles,
+# (1) if the variable is set in `config.status', edit `config.status'
+#     (which will cause the Makefiles to be regenerated when you run `make');
+# (2) otherwise, pass the desired values on the `make' command line.
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
+	dot_seen=no; \
+	target=`echo $@ | sed s/-recursive//`; \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  echo "Making $$target in $$subdir"; \
+	  if test "$$subdir" = "."; then \
+	    dot_seen=yes; \
+	    local_target="$$target-am"; \
+	  else \
+	    local_target="$$target"; \
+	  fi; \
+	  (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
+	   || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
+	done; \
+	if test "$$dot_seen" = "no"; then \
+	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
+	fi; test -z "$$fail"
+
+mostlyclean-recursive clean-recursive distclean-recursive \
+maintainer-clean-recursive:
+	@set fnord $$MAKEFLAGS; amf=$$2; \
+	dot_seen=no; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
+	done; \
+	rev="$$rev ."; \
+	target=`echo $@ | sed s/-recursive//`; \
+	for subdir in $$rev; do \
+	  echo "Making $$target in $$subdir"; \
+	  if test "$$subdir" = "."; then \
+	    local_target="$$target-am"; \
+	  else \
+	    local_target="$$target"; \
+	  fi; \
+	  (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
+	   || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
+	done && test -z "$$fail"
+tags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
+	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
 
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
 tags: TAGS
 
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
+	done; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
-
-TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = src/blob
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  if test "$$subdir" = .; then :; else \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
+	    || exit 1; \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
+	      || exit 1; \
 	  fi; \
 	done
-bootldrpart.o: bootldrpart.c ../../include/blob/config.h \
-	../../include/blob/arch.h ../../include/blob/arch/lart.h \
-	../../include/blob/types.h ../../include/blob/partition.h \
-	../../include/blob/errno.h ../../include/blob/util.h
-commands.o: commands.c ../../include/blob/config.h \
-	../../include/blob/command.h ../../include/blob/types.h \
-	../../include/blob/reboot.h ../../include/blob/terminal.h
-flash.o: flash.c ../../include/blob/config.h ../../include/blob/arch.h \
-	../../include/blob/arch/lart.h ../../include/blob/errno.h \
-	../../include/blob/error.h ../../include/blob/led.h \
-	../../include/blob/util.h ../../include/blob/types.h \
-	../../include/blob/serial.h ../../include/blob/flash.h \
-	../../include/blob/init.h ../../include/blob/command.h
-initcalls.o: initcalls.c ../../include/blob/config.h \
-	../../include/blob/init.h ../../include/blob/types.h \
-	../../include/blob/icache.h ../../include/blob/led.h \
-	../../include/blob/serial.h ../../include/blob/time.h
-intel32.o: intel32.c ../../include/blob/config.h \
-	../../include/blob/errno.h ../../include/blob/flash.h \
-	../../include/blob/types.h ../../include/blob/util.h \
-	../../include/blob/serial.h
-lart.o: lart.c ../../include/blob/config.h ../../include/blob/flash.h \
-	../../include/blob/types.h ../../include/blob/init.h \
-	../../include/blob/serial.h
-linux.o: linux.c ../../include/blob/config.h ../../include/blob/linux.h \
-	../../include/blob/arch.h ../../include/blob/arch/lart.h \
-	../../include/blob/command.h ../../include/blob/types.h \
-	../../include/blob/init.h ../../include/blob/main.h \
-	../../include/blob/serial.h ../../include/blob/memory.h \
-	../../include/blob/util.h
-main.o: main.c ../../include/blob/config.h ../../include/blob/arch.h \
-	../../include/blob/arch/lart.h ../../include/blob/command.h \
-	../../include/blob/types.h ../../include/blob/errno.h \
-	../../include/blob/error.h ../../include/blob/flash.h \
-	../../include/blob/init.h ../../include/blob/led.h \
-	../../include/blob/main.h ../../include/blob/serial.h \
-	../../include/blob/md5.h ../../include/blob/md5support.h \
-	../../include/blob/memory.h ../../include/blob/param_block.h \
-	../../include/blob/sa1100.h ../../include/blob/time.h \
-	../../include/blob/util.h ../../include/blob/uucodec.h \
-	../../include/blob/xmodem.h
-memory.o: memory.c ../../include/blob/config.h ../../include/blob/arch.h \
-	../../include/blob/arch/lart.h ../../include/blob/memory.h \
-	../../include/blob/types.h ../../include/blob/serial.h
-param_block.o: param_block.c ../../include/blob/config.h \
-	../../include/blob/types.h ../../include/blob/param_block.h \
-	../../include/blob/main.h ../../include/blob/serial.h \
-	../../include/blob/util.h ../../include/blob/sa1100.h
-partition.o: partition.c ../../include/blob/config.h \
-	../../include/blob/flash.h ../../include/blob/types.h \
-	../../include/blob/partition.h ../../include/blob/serial.h \
-	../../include/blob/error.h
-reboot.o: reboot.c ../../include/blob/config.h ../../include/blob/arch.h \
-	../../include/blob/arch/lart.h ../../include/blob/command.h \
-	../../include/blob/types.h ../../include/blob/errno.h \
-	../../include/blob/error.h ../../include/blob/init.h \
-	../../include/blob/main.h ../../include/blob/serial.h
-uucodec.o: uucodec.c ../../include/blob/config.h \
-	../../include/blob/errno.h ../../include/blob/serial.h \
-	../../include/blob/types.h ../../include/blob/util.h
-xmodem.o: xmodem.c ../../include/blob/config.h \
-	../../include/blob/errno.h ../../include/blob/serial.h \
-	../../include/blob/types.h ../../include/blob/util.h
-
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
-check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am: install-binPROGRAMS
-install-exec: install-exec-am
-
-install-data-am:
-install-data: install-data-am
+check: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) check-recursive
+all-am: Makefile $(PROGRAMS)
+installdirs: installdirs-recursive
+installdirs-am:
+	for dir in "$(DESTDIR)$(bindir)"; do \
+	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
+	done
+install: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) install-recursive
+install-exec: install-exec-recursive
+install-data: install-data-recursive
+uninstall: uninstall-recursive
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am: uninstall-binPROGRAMS
-uninstall: uninstall-am
-all-am: Makefile $(PROGRAMS)
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-	$(mkinstalldirs)  $(DESTDIR)$(bindir)
-
 
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
 
 maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
 	-test -z "$(BUILT_SOURCES)" || rm -f $(BUILT_SOURCES)
-mostlyclean-am:  mostlyclean-binPROGRAMS mostlyclean-compile \
-		mostlyclean-tags mostlyclean-generic
+clean: clean-recursive
 
-mostlyclean: mostlyclean-am
+clean-am: clean-binPROGRAMS clean-generic mostlyclean-am
 
-clean-am:  clean-binPROGRAMS clean-compile clean-tags clean-generic \
-		mostlyclean-am
+distclean: distclean-recursive
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
 
-clean: clean-am
+dvi: dvi-recursive
 
-distclean-am:  distclean-binPROGRAMS distclean-compile distclean-tags \
-		distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-am
+html: html-recursive
 
-maintainer-clean-am:  maintainer-clean-binPROGRAMS \
-		maintainer-clean-compile maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-recursive
+
+info-am:
+
+install-data-am:
+
+install-exec-am: install-binPROGRAMS
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
 
-maintainer-clean: maintainer-clean-am
+maintainer-clean: maintainer-clean-recursive
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
 
-.PHONY: mostlyclean-binPROGRAMS distclean-binPROGRAMS clean-binPROGRAMS \
-maintainer-clean-binPROGRAMS uninstall-binPROGRAMS install-binPROGRAMS \
-mostlyclean-compile distclean-compile clean-compile \
-maintainer-clean-compile tags mostlyclean-tags distclean-tags \
-clean-tags maintainer-clean-tags distdir info-am info dvi-am dvi check \
-check-am installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-binPROGRAMS uninstall-info-am
+
+uninstall-info: uninstall-info-recursive
+
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
+	clean clean-binPROGRAMS clean-generic clean-recursive ctags \
+	ctags-recursive distclean distclean-compile distclean-generic \
+	distclean-recursive distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-binPROGRAMS \
+	install-data install-data-am install-exec install-exec-am \
+	install-info install-info-am install-man install-strip \
+	installcheck installcheck-am installdirs installdirs-am \
+	maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-compile \
+	mostlyclean-generic mostlyclean-recursive pdf pdf-am ps ps-am \
+	tags tags-recursive uninstall uninstall-am \
+	uninstall-binPROGRAMS uninstall-info-am
 
 
 rest-ld-script: rest-ld-script.in
-	$(CC) -x c-header -undef -nostdinc ${INCLUDES} -E $< | sed 's/^#.*//' > $@
+	$(CC) -x c-header -undef -nostdinc ${INCLUDES} -D__ASSEMBLY__ -E $< | sed 's/^#.*//' > $@
 
-blob-start: blob-start-elf32
-	$(OBJCOPY) $(OCFLAGS) $< $@
+commands.c:
+	${top_srcdir}/src/commands/make_commands.sh @BLOB_COMMANDS@ > $@
 
-blob-start-chain: blob-start-chain-elf32
-	$(OBJCOPY) $(OCFLAGS) $< $@
+.S.o:
+	$(COMPILE) -D__ASSEMBLY__ -c $<
 
-blob-rest: blob-rest-elf32
+blob-rest$(EXEEXT): blob-rest-elf32
 	$(OBJCOPY) $(OCFLAGS) $< $@
 
-blob: blob-start blob-rest
-	rm -f $@
-	dd if=blob-start of=$@ bs=1k conv=sync
-	dd if=blob-rest of=$@ bs=1k seek=1
-	chmod +x $@
-
-blob-chain: blob-start-chain blob-rest
-	rm -f $@
-	dd if=blob-start-chain of=$@ bs=1k conv=sync
-	dd if=blob-rest of=$@ bs=1k seek=1
-	chmod +x $@
+# create an object file from the binary so we can link it into the
+# first stage loaders
+blob-rest-piggy.o: blob-rest
+	$(LD) -r -o $@ -b binary $<
 
+blob$(EXEEXT): blob-elf32
+	$(OBJCOPY) $(OCFLAGS) $< $@
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
Index: build_tree/bootLoader/src/blob/accelent_sa.c
diff -u /dev/null build_tree/bootLoader/src/blob/accelent_sa.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/accelent_sa.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,251 @@
+/*
+ * accelent_sa.c: Accelent IDP specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@eletztrick.de)
+ * Copyright (C) 2002  Holger Schurig <h.schurig@mn-logistik.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: accelent_sa.c,v 1.6 2003/09/04 17:39:00 russd Exp $"
+
+/**********************************************************************
+ * includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/command.h>
+#include <blob/uucodec.h>
+#include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
+
+
+extern blob_status_t blob_status;
+
+
+/* flash descriptor for Accelent IDP flash. */
+/* Accelent IDP uses 2xINTEL e28F640 Chips */
+static const flash_descriptor_t accelent_sa_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 64,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+static int accelent_sa_flash_enable_vpp(void)
+{
+	//TODO
+	//set GPIO17
+
+	return 0;
+}
+
+
+
+
+static int accelent_sa_flash_disable_vpp(void)
+{
+	//TODO
+	//reset GPIO17
+
+	return 0;
+}
+
+
+
+static void init_accelent_sa_flash_driver(void)
+{
+	flash_descriptors = accelent_sa_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+	flash_driver->enable_vpp = accelent_sa_flash_enable_vpp;
+	flash_driver->disable_vpp = accelent_sa_flash_disable_vpp;
+}
+
+__initlist(init_accelent_sa_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+
+static void accelent_sa_init_hardware(void)
+{
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(accelent_sa_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+
+/*********************************************************************
+ * cmd_download_file
+ *
+ * AUTOR:		SELETZ
+ * REVISED:
+ *
+ * Download a file to arbitary memory location
+ *
+ */
+int cmd_download_file( int argc, char *argv[] )
+{
+	int		ret		= 0;
+	u32		dest	= 0L;
+	u32		len	= 0L;
+
+	if ( argc < 3 )				return -EINVAL;
+
+	ret = strtou32( argv[1], &dest );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[2], &len );
+	if ( ret < 0 )				return -EINVAL;
+
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		SerialOutputString("Switching to download speed\n");
+		SerialOutputString("You have 60 seconds to switch your terminal emulator to the same speed and\n");
+		SerialOutputString("start downloading. After that " PACKAGE " will switch back to term speed.\n");
+	
+		serial_init(blob_status.downloadSpeed);
+	} else {
+		SerialOutputString("You have 60 seconds to start downloading.\n");
+	}
+
+	ret = UUDecode((char *)dest, len);
+	if ( ret == len ) {
+		SerialOutputString("Received ");
+		SerialOutputDec(ret);
+		SerialOutputString(" (0x");
+		SerialOutputHex(ret);
+		SerialOutputString(") bytes.\n");
+		ret = 0;
+	} else {
+		SerialOutputString("error during uudecode\n");
+	}
+	
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		SerialOutputString("\n(Please switch your terminal emulator back to terminal speed\n");
+		serial_init(blob_status.terminalSpeed);
+	}
+
+	return ret;
+}
+static char downloadhelp[] = "dlfile destadr filelength\n"
+"download file to memory\n";
+__commandlist( cmd_download_file, "dlfile", downloadhelp );
+
+/*********************************************************************
+ * cmd_flash_write
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash write access
+ *
+ */
+static int cmd_flash_write( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	src	= 0L;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 4 )				return -EINVAL;
+
+	ret = strtou32( argv[1], &src );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[2], &dest );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[3], &len );
+	if ( ret < 0 )				return -EINVAL;
+
+	if ( len & (0x3) ) {
+		len = (len>>2)  + 1;
+	} else {
+		len = len>>2;
+	}
+
+	_DBGU32( src );
+	_DBGU32( dest );
+	_DBGU32( len );
+
+	ret = flash_write_region( (u32 *)dest, (u32*)src, len );
+	return ret;
+}
+static char flashwritehelp[] = "fwrite srcadr destadr size(bytes)\n"
+"flash a memory region\n";
+__commandlist( cmd_flash_write, "fwrite", flashwritehelp );
+
+/*********************************************************************
+ * cmd_flash_erase
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash erasing
+ *
+ */
+static int cmd_flash_erase( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 3 )				return -EINVAL;
+
+	ret = strtou32( argv[1], &dest );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[2], &len );
+	if ( ret < 0 )				return -EINVAL;
+
+	if ( len & (0x3) ) {
+		len = (len>>2)  + 1;
+	} else {
+		len = len>>2;
+	}
+
+	ret = flash_erase_region( (u32 *)dest, len );
+	return ret;
+}
+static char flasherasehelp[] = "ferase adr size(bytes)\n"
+"erase a flash region\n";
+__commandlist( cmd_flash_erase, "ferase", flasherasehelp );
Index: build_tree/bootLoader/src/blob/amd16.c
diff -u /dev/null build_tree/bootLoader/src/blob/amd16.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/amd16.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,198 @@
+/*
+ * amd16.c: AMD 16 bit (1x 16 bit) flash driver
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Russ Dill (Russ.Dill@asu.edu)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/21358.pdf
+ *
+ */
+
+#ident "$Id: amd16.c,v 1.1 2003/09/03 01:44:28 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/flash.h>
+#include <blob/util.h>
+#include <blob/serial.h>
+
+
+/* flash commands for a 16 bit AMD flash chips */
+#define READ_ARRAY		0x00F0
+#define UNLOCK1			0x00AA
+#define UNLOCK2			0x0055
+#define CONFIG_QUERY		0x0090
+#define EXIT_UNLOCK1		0x0090
+#define EXIT_UNLOCK2		0x0000
+#define ERASE_SETUP		0x0080
+#define ERASE_CONFIRM		0x0030
+#define PGM_SETUP		0x00A0
+#define UNLOCK_BYPASS		0x0020
+#define FLASH_ADDR1		(0x00005555 << 1)
+#define FLASH_ADDR2		(0x00002AAA << 1)
+#define ERASE_DONE		(1 << 7)
+#define RDY_MASK		(1 << 7)
+#define TOGGLE_BIT		(1 << 6)
+#define STATUS_PGM_ERR		(1 << 5)
+#define STATUS_ERASE_ERR	(1 << 0)
+
+
+static void flash_read_array_amd16(void)
+{
+	*(u16 *)FLASH_ADDR1 = READ_ARRAY;
+	barrier();
+}
+
+
+static int get_status_amd16(u16 *addr)
+{
+	u16 result, last;
+	int last_chance = 0;
+
+	last = *addr;
+	barrier();
+
+	for (;;) {
+		result = *addr;
+		barrier();
+
+		/* didn't toggle */
+		if (!((result ^ last) & TOGGLE_BIT)) return 0;
+
+		/* toggled on its last chance */
+		if (last_chance) return -1;
+		
+		if (result & STATUS_PGM_ERR) {
+			last_chance = 1;
+			result = *addr; /* dummy read */
+			barrier();
+		}
+
+		last = result;
+	}
+
+	return 0;
+}
+
+
+static int flash_erase_amd16(u32 *addr)
+{
+	/* prepare for erase */
+	*(u16 *)FLASH_ADDR1 = UNLOCK1;
+	barrier();
+	*(u16 *)FLASH_ADDR2 = UNLOCK2;
+	barrier();
+	*(u16 *)FLASH_ADDR1 = ERASE_SETUP;
+	barrier();
+
+	/* erase command */
+	*(u16 *)FLASH_ADDR1 = UNLOCK1;
+	barrier();
+	*(u16 *)FLASH_ADDR2 = UNLOCK2;
+	barrier();
+	*((u16 *) addr) = ERASE_CONFIRM;
+
+	if (get_status_amd16((u16 *) addr) < 0) {
+		/* put flash back into Read Array mode */
+		flash_read_array_amd16();
+		return -EFLASHERASE;
+	}
+
+	return 0;
+}
+
+
+static int flash_write_amd(u16 *dst, const u16 *src)
+{
+	int ret;
+
+	*(u16 *)FLASH_ADDR1 = UNLOCK1;
+	barrier();
+	*(u16 *)FLASH_ADDR2 = UNLOCK2;
+	barrier();
+	*(u16 *)FLASH_ADDR1 = PGM_SETUP;
+	barrier();
+
+	*dst = *src;
+	barrier();
+
+	ret = get_status_amd16(dst);
+	
+	barrier();
+	if (ret < 0 || *dst != *src) {
+		barrier();
+		flash_read_array_amd16();	
+		return -EFLASHPGM;
+	}
+
+	return 0;
+}
+	
+
+static int flash_write_amd16(u32 *dst, const u32 *src)
+{
+	if (flash_write_amd((u16 *)dst, (const u16 *)src) < 0)
+		return -EFLASHPGM;
+	if (flash_write_amd(((u16 *)dst) + 1, ((const u16 *) src) + 1) < 0)
+		return -EFLASHPGM;
+	return 0;
+}
+
+
+static int flash_lock_block_amd16(u32 *blockStart)
+{
+	/* FIXME: this function should be fleshed out -- Erik */
+	return 0;
+}
+
+
+static int flash_unlock_block_amd16(u32 *blockStart)
+{
+	/* FIXME: this function should be fleshed out -- Erik */
+	return 0;
+}
+
+
+static int flash_query_block_lock_amd16(u32 *blockStart)
+{
+	int result;
+	*(u16 *)FLASH_ADDR1 = UNLOCK1;
+	barrier();
+	*(u16 *)FLASH_ADDR2 = UNLOCK2;
+	barrier();
+	*(u16 *)FLASH_ADDR1 = CONFIG_QUERY;
+	barrier();
+
+	result = *(u16 *)(((u16 *)blockStart) + 2);
+	flash_read_array_amd16();
+	return !!result;
+
+}
+
+
+
+/* flash driver structure */
+flash_driver_t amd16_flash_driver = {
+	erase:			flash_erase_amd16,
+	write:			flash_write_amd16,
+	lock_block:		flash_lock_block_amd16,
+	unlock_block:		flash_unlock_block_amd16,
+	query_block_lock:	flash_query_block_lock_amd16
+};
Index: build_tree/bootLoader/src/blob/amd32.c
diff -u build_tree/bootLoader/src/blob/amd32.c:1.1.1.1 build_tree/bootLoader/src/blob/amd32.c:1.1.1.2
--- build_tree/bootLoader/src/blob/amd32.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/amd32.c	Fri Nov  9 09:44:05 2007
@@ -18,9 +18,11 @@
  * along with this program; if not, write to the Free Software
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  *
+ * http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/21358.pdf
+ *
  */
 
-#ident "$Id: amd32.c,v 1.4 2002/01/02 01:23:18 erikm Exp $"
+#ident "$Id: amd32.c,v 1.6 2002/06/19 04:41:49 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -36,6 +38,9 @@
 #define READ_ARRAY		0x00F000F0
 #define UNLOCK1			0x00AA00AA
 #define UNLOCK2			0x00550055
+#define CONFIG_QUERY		0x00900090
+#define EXIT_UNLOCK1		0x00900090
+#define EXIT_UNLOCK2		0x00000000
 #define ERASE_SETUP		0x00800080
 #define ERASE_CONFIRM		0x00300030
 #define PGM_SETUP		0x00A000A0
@@ -43,21 +48,70 @@
 #define FLASH_ADDR1		(0x00000555 << 2)
 #define FLASH_ADDR2		(0x000002AA << 2)
 #define ERASE_DONE		0x00800080
+#define TOGGLE_BIT		0x00400040
 #define RDY_MASK		0x00800080
 #define STATUS_PGM_ERR		0x00200020
 #define STATUS_ERASE_ERR	0x00000001
 
-#define READY 1
-#define ERR   2
+#define READY 		1
+#define LAST_CHANCE 	2
+#define LAST_CHANCE2	3
+#define ERR		4
 
 
+static void flash_read_array_amd32(void)
+{
+	*(u32 *)FLASH_ADDR1 = data_to_flash(READ_ARRAY);
+	barrier();
+}
 
+/* NOT! for amd16.c, this examines one chip of the two chip interleave */
+static int get_status_amd16(u32 result, u32 last, int chip)
+{
+	if (chip == LAST_CHANCE)
+		chip = LAST_CHANCE2;
+	else if (!(result ^ last)) /* didn't toggle */
+		chip = READY;
+	else if (chip == LAST_CHANCE2)
+		chip = ERR;
+	else if (result & STATUS_PGM_ERR)
+		chip = LAST_CHANCE;
+	return chip;
+}
 
-static int flash_erase_amd32(u32 *addr)
+static int get_status_amd32(u32 *addr)
 {
-	u32 result;
+	u32 result, last;
 	int chip1, chip2;
 
+	chip1 = chip2 = 0;
+
+	last = data_from_flash(*addr);
+	barrier();
+
+	do {
+		result = data_from_flash(*addr);
+		barrier();
+
+		if ((chip1 != ERR && chip1 != READY))
+			chip1 = get_status_amd16(result & 0xFFFF, last & 0xFFFF, chip1);
+
+		if ((chip2 != ERR && chip2 != READY))
+			chip2 = get_status_amd16(result >> 16, last >> 16, chip2);
+	
+		last = result;
+
+	} while ((chip1 != ERR && chip1 != READY) || (chip2 != ERR && chip2 != READY));
+
+	if (chip1 == ERR || chip2 == ERR) return -1;
+	
+	return 0;
+
+}
+
+
+static int flash_erase_amd32(u32 *addr)
+{
 	/* prepare for erase */
 	*(u32 *)FLASH_ADDR1 = data_to_flash(UNLOCK1);
 	barrier();
@@ -81,32 +135,18 @@
 
 	/* Russ, why don't you do this like the LART does? Just check
          * the status of chips with a single compare. -- Erik */
-	chip1 = chip2 = 0;
-
-	do {
-		result = data_from_flash(*addr);
-		barrier();
-
-		if (!chip1 && (result & 0xFFFF) & ERASE_DONE)
-			chip1 = READY;
 
-		if (!chip1 && (result & 0xFFFF) & STATUS_PGM_ERR) 
-			chip1 = ERR;
-
-		if (!chip2 && (result >> 16) & ERASE_DONE)
-			chip2 = READY;
-
-		if (!chip2 && (result >> 16) & STATUS_PGM_ERR)
-			chip2 = ERR;
-		
-	} while(!chip1 || !chip2);
-	
-	/* put flash back into Read Array mode */
-	*(u32 *)FLASH_ADDR1 = data_to_flash(READ_ARRAY);
-	barrier();
-	
-	if (chip1 == ERR || chip2 == ERR)
+	/* Maybe this restructuring will amke it more clear, when the flash
+	 * is done erasing, it will return 0xFFFF on read, which contains the
+	 * status pgm err bit. So an error condition occurs if the status pgm
+	 * bit is set, but the erase done bit is not. OK, switch this over
+	 * to detecting bit toggles. --Russ */
+
+	if (get_status_amd32(addr) < 0) {
+		/* put flash back into Read Array mode */
+		flash_read_array_amd32();
 		return -EFLASHERASE;
+	}
 
 	return 0;
 }
@@ -116,66 +156,22 @@
 
 static int flash_write_amd32(u32 *dst, const u32* src)
 {
-	u32 result;
-	int chip1, chip2;
 
 	*(u32 *)FLASH_ADDR1 = data_to_flash(UNLOCK1);
 	barrier();
 	*(u32 *)FLASH_ADDR2 = data_to_flash(UNLOCK2);
 	barrier();
-	*(u32 *)FLASH_ADDR1 = data_to_flash(UNLOCK_BYPASS);
+	*(u32 *)FLASH_ADDR1 = data_to_flash(PGM_SETUP);
 	barrier();
 
-	*dst = data_to_flash(PGM_SETUP);
-	barrier();
 	*dst = *src;
 	barrier();
 	
-	/* This is a pretty similar situation to the erasing status below
-	 * Bit 7 is ~(data bit 7) until the flash is complete. If bit 5
-	 * gets set before this happens, there is an error, but this could
-	 * happen near the clock edge, and bit 5 could be the actual data 
-	 * before bit 7 changes, so we have to read again. -- Russ
-	 */ 
-
-	chip1 = chip2 = 0;
-	do {
-		result = data_from_flash(*dst);
+	if (get_status_amd32(dst) < 0 || *dst != *src) {
 		barrier();
-
-		if (!chip1 && ((result & 0x80) == (*src & 0x80))) 
-			chip1 = READY;
-
-		if (!chip1 && ((result & 0xFFFF) & STATUS_PGM_ERR)) {
-			result = data_from_flash(*dst);
-			barrier();
-
-			if ((result & 0x80) == (*src & 0x80))
-				chip1 = READY;
-			else 
-				chip1 = ERR;
-		}
-
-		if (!chip2 && ((result & (0x80 << 16)) == (*src & (0x80 << 16))))
-			chip2 = READY;
-
-		if (!chip2 && ((result >> 16) & STATUS_PGM_ERR)) {
-			result = data_from_flash(*dst);
-			barrier();
-
-			if ((result & (0x80 << 16)) == (*src & (0x80 << 16)))
-				chip2 = READY;
-			else 
-				chip2 = ERR;
-		}
-
-	} while (!chip1 || !chip2);
-		
-	*(u32 *)FLASH_ADDR1 = data_to_flash(READ_ARRAY);
-	barrier();
-
-	if (chip1 == ERR || chip2 == ERR || *dst != *src)
+		flash_read_array_amd32();	
 		return -EFLASHPGM;
+	}
 
 	return 0;
 }
@@ -185,9 +181,7 @@
 
 static int flash_lock_block_amd32(u32 *blockStart)
 {
-	/* FIXME: if AMD flash can be locked, this function should be
-	 * fleshed out -- Erik
-	 */
+	/* FIXME: this function should be fleshed out -- Erik */
 	return 0;
 }
 
@@ -196,9 +190,7 @@
 
 static int flash_unlock_block_amd32(u32 *blockStart)
 {
-	/* FIXME: if AMD flash can be unlocked, this function should
-	 * be fleshed out -- Erik
-	 */
+	/* FIXME: this function should be fleshed out -- Erik */
 	return 0;
 }
 
@@ -207,10 +199,18 @@
 
 static int flash_query_block_lock_amd32(u32 *blockStart)
 {
-	/* FIXME: if AMD flash can be queried, this function should be
-	 * fleshed out -- Erik
-	 */
-	return 0;
+	int result;
+	*(u32 *)FLASH_ADDR1 = data_to_flash(UNLOCK1);
+	barrier();
+	*(u32 *)FLASH_ADDR2 = data_to_flash(UNLOCK2);
+	barrier();
+	*(u32 *)FLASH_ADDR1 = data_to_flash(CONFIG_QUERY);
+	barrier();
+
+	result = *(u32 *)(blockStart + 2);
+	flash_read_array_amd32();
+	return !!result;
+
 }
 
 
Index: build_tree/bootLoader/src/blob/assabet.c
diff -u build_tree/bootLoader/src/blob/assabet.c:1.1.1.1 build_tree/bootLoader/src/blob/assabet.c:1.1.1.2
--- build_tree/bootLoader/src/blob/assabet.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/assabet.c	Fri Nov  9 09:44:05 2007
@@ -19,7 +19,7 @@
  *
  */
 
-#ident "$Id: assabet.c,v 1.6 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: assabet.c,v 1.10 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -27,14 +27,17 @@
 
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
 
 
 
 
 /* flash descriptor for Assabet flash */
 /* 2x Intel 28F128J3A strataflash (16MB) */
-static flash_descriptor_t assabet_flash_descriptors[] =
+static const flash_descriptor_t assabet_flash_descriptors[] =
 {
 	{
 		size: 2 * 128 * 1024,
@@ -70,8 +73,11 @@
 	/* enable RS232 tranceiver and green LED */
 	*bcr = RS232_ENABLE | GREEN_LED_ENABLE;
 
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 
Index: build_tree/bootLoader/src/blob/badge4.c
diff -u build_tree/bootLoader/src/blob/badge4.c:1.1.1.1 build_tree/bootLoader/src/blob/badge4.c:1.1.1.2
--- build_tree/bootLoader/src/blob/badge4.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/badge4.c	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,7 @@
 /*
  * badge4.c: Badge 4 specific stuff
  *
- * Copyright (C) 2001  Hewlett-Packard Company
+ * Copyright (C) 2001-2002  Hewlett-Packard Company
  * Written by Christopher Hoover <ch@hpl.hp.com>
  *
  * This program is free software; you can redistribute it and/or modify
@@ -20,63 +20,275 @@
  *
  */
 
-#ident "$Id: badge4.c,v 1.3 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: badge4.c,v 1.18 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/arch/badge4.h>
 #include <blob/flash.h>
 #include <blob/init.h>
-#include <blob/sa1100.h>
+#include <blob/arch.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/i2c.h>
+#include <blob/i2c-gpio.h>
+#include <blob/spd.h>
+#include <blob/partition.h>
+#include <blob/led.h>
+#include <blob/time.h>
+
+#define DEBUG
+
+static struct i2c_bus_gpio_private badge4_i2c_bus_gpio_private = {
+	.sda_gpio= BADGE4_GPIO_SDSDA,
+	.scl_gpio= BADGE4_GPIO_SDSCL,
+	.delay= 100
+};
 
-/* flash descriptor for Badge4 flash */
-/* 1 x Intel 28F320C3BA100 Advanced+ Boot Block Flash (32 Mbit) */
-/* http://developer.intel.com/design/flcomp/datashts/29064512.pdf */
-static flash_descriptor_t badge4_flash_descriptors[] =
-{
+static struct i2c_bus badge4_i2c_bus = {
+	.init_bus= init_bus_gpio,
+	.set_sda= set_sda_gpio,
+	.get_sda= get_sda_gpio,
+	.set_scl= set_scl_gpio,
+	.get_scl= get_scl_gpio,
+	.private= &badge4_i2c_bus_gpio_private
+};
+
+/* flash descriptors for BadgePAD 4 flash */
+static const flash_descriptor_t badge4_flash_descriptors[] =
+	QUERY_FLASH_FOR_DESCRIPTORS(0);
+
+
+/* default partition table for BadgePAD 4 */
+static blob_partition_t badge4_default_partition_table[] = {
+	{
+		/* start of table */
+		.magic=		BLOB_DEFAULT_PART_TABLE_MAGIC,
+		.next=		sizeof(blob_partition_t),
+		.offset=	0x00000000,	/* absolute base address */
+		.size=		BLOB_PART_SIZ_FULL
+	},
+	{
+		/* blob itself */
+		.magic=		BLOB_PART_VALID_MAGIC,
+		.next=		sizeof(blob_partition_t),
+		.offset=	BLOB_PART_OFS_APPEND,
+		.size=		BLOB_FLASH_LEN,
+		.name=		"blob",
+		.mem_base=	BLOB_RAM_BASE
+	},
 	{
-		/* Eight 4 KW Parameter Bottom Blocks (64K bytes) */
-		size: 2 * 4 * 1024,
-		num: 8,
-		lockable: 1
+		/* parameter block */
+		.magic=		BLOB_PART_VALID_MAGIC,
+		.next=		sizeof(blob_partition_t),
+		.offset=	BLOB_PART_OFS_APPEND,
+		.size=		PARAM_FLASH_LEN,
+		.name=		"param",
+		.flags=		BLOB_PART_FLAG_PTABLE
 	},
+#ifdef CONFIG_ZIMAGE_SUPPORT
 	{
-		/* Sixty three 32 KW Main Blocks (4032K bytes) */
-		size: 2 * 32 * 1024,
-		num: 63,
-		lockable: 1
+		/* parameter block */
+		.magic=		BLOB_PART_VALID_MAGIC,
+		.next=		sizeof(blob_partition_t),
+		.offset=	BLOB_PART_OFS_APPEND,
+		.size=		KERNEL_FLASH_LEN,
+		.name=		"kernel",
+		.flags=		BLOB_PART_FLAG_EXEC,
+		.mem_base=	KERNEL_RAM_BASE,
+		.entry_point=	KERNEL_RAM_BASE
 	},
+#endif
 	{
-		/* NULL block */
+		/* root */
+		.magic=		BLOB_PART_VALID_MAGIC,
+		.next=		sizeof(blob_partition_t),
+		.offset=	BLOB_PART_OFS_APPEND,
+		.size=		BLOB_PART_SIZ_FULL,
+		.name=		"ramdisk", /* not really */
+		.flags=		BLOB_PART_FLAG_JFFS2
 	},
+	{
+		/* last entry */
+		.magic=		BLOB_PART_LAST_MAGIC
+	}
 };
 
 
+static void badge4_set_partition_table(void)
+{
+	/* set up the default partition table */
+	default_partition_table = badge4_default_partition_table;
 
+	/* we don't know where the flash partition table will live, so
+	 * point to the flash and let the partition table
+	 * parser figure out.
+	 */
+	flash_partition_table = (blob_partition_t*)0x00000000;
+}
+__initlist(badge4_set_partition_table, INIT_LEVEL_OTHER_STUFF + 1);
 
-static void init_flash_driver(void)
+
+static void badge4_select_drivers(void)
 {
-	flash_descriptors = badge4_flash_descriptors;
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+
 	flash_driver = &intel16_flash_driver;
+	flash_descriptors = badge4_flash_descriptors;
 }
+__initlist(badge4_select_drivers, INIT_LEVEL_DRIVER_SELECTION);
 
-__initlist(init_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
 
+static void badge4_banner(void)
+{
+	printf("\n\n\n" BOARD_NAME "\n"
+	       "Blob port by Christopher Hoover <ch@hpl.hp.com>.\n"
+	       "  (revision: $Revision: 1.18 $, built: " __DATE__ ")\n"
+	       "\n");
+}
+__initlist(badge4_banner, INIT_LEVEL_INITIAL_HARDWARE + 1);
 
-static void init_hardware(void)
+
+static void badge4_init_sa1111(void)
 {
-	// GPIO 19 and 20 specify SDRAM "type".
-	// These settings are for 12 row bits, 9 col bits.
-	// ### Incorporate SPD code here.
-	GPDR |= (GPIO_GPIO19 | GPIO_GPIO20);
-	GPSR = GPIO_GPIO19;
-	GPCR = GPIO_GPIO20;
+	/*
+	 * We have to do part of the SA-1111 initialization here.
+	 * Whenever we pull down GPIO_SA1111_NRST (GPIO 25, 1111_RST~
+	 * on the schematic), the SDRAM goes away as that gpio is also
+	 * wired into the CPLD that controls the SO-DIMM SDRAM
+	 * interface.  (Argh.)
+	 *
+	 * The only reason this code runs at all is that we have set
+	 * up blob to run out of SRAM.  Fortunately all BadgePAD 4's
+	 * have SRAM.
+	 */
+
+	/* Asert nRESET. */
+	GPCR = BADGE4_GPIO_SA1111_NRST;
+	GPDR |= BADGE4_GPIO_SA1111_NRST;
+
+	/*
+	 * Set up the 3.6864MHz clock on GPIO 27 for the SA-1111:
+	 * (SA-1110 Developer's Manual, section 9.1.2.1)
+	 */
+	GAFR |= GPIO_32_768kHz;
+	GPDR |= GPIO_32_768kHz;
+	TUCR = TUCR_3_6864MHz;
+
+	/* De-assert nRESET */
+	GPSR = BADGE4_GPIO_SA1111_NRST;
+
+	/*
+	 * The SA-1111 initialization is not yet done, but Linux
+	 * can do the rest.
+	 */
+}
 
-	/* select serial driver */
-	serial_driver = &sa11x0_serial_driver;
+static void badge4_setup_sdram(void)
+{
+	int i, size;
+	int typ0, typ1;
+	int memory_type, row_bits, col_bits, module_rows, row_density;
+	u8 spd[128];
+
+	/* Disable memory bus/grant signals to avoid any suprious
+           memory requests */
+	PGSR &= ~GPIO_MBGNT;
+	GPCR = GPIO_MBGNT;
+	GPDR = (GPDR & ~GPIO_MBREQ) | GPIO_MBGNT;
+	GAFR &= ~(GPIO_MBGNT | GPIO_MBREQ);
+
+	GPDR |= (BADGE4_GPIO_SDTYP1 | BADGE4_GPIO_SDTYP0);
+
+	/* Intialize the I2C bus and driver. */
+	i2c_init(&badge4_i2c_bus);
+
+	/* Probe for the SPD EEPROM */
+	if (i2c_probe(&badge4_i2c_bus, SPD_I2C_ADDR(0)) != 0) {
+		printf("SDRAM: SDRAM SO-DIMM absent.\n");
+		return;
+	}
+
+	/* Read the SPD to determine the SO-DIMM SDRAM parameters. */
+	if (i2c_read_device_bytes(&badge4_i2c_bus, SPD_I2C_ADDR(0), 
+				  0, spd, sizeof(spd)) != 0) {
+		printf("SDRAM: failed to read SPD EEPROM.\n");
+		goto fail;
+	}
+
+	/* quick sanity check */
+	memory_type = spd[SPD_MEMORY_TYPE];
+	if (memory_type != SPD_MEMORY_TYPE_SDRAM) {
+		printf("SDRAM: SDRAM SO-DIMM wrong type (%d)\n", memory_type);
+		goto fail;
+	}
+
+	row_bits = spd[SPD_ROW_BITS];
+	col_bits = spd[SPD_COL_BITS];
+	module_rows = spd[SPD_MODULE_ROWS];
+	row_density = spd[SPD_ROW_DENSITY];
+
+	/* calculate the size: bit 0 is 4M, bit 1 is 8M, etc. */
+	size = 0;
+	for (i = 0; i < 8; i++)
+		if (row_density & (1<<i))
+			size += (4<<i);
+	size *= module_rows;
+
+	printf("SDRAM: %d MiB (rows=%d, row bits=%d, col bits=%d)\n", 
+	       size, module_rows, row_bits, col_bits);
+
+	/*
+	 * Here's what the CPLD expects
+	 *
+	 * typ1 typ0	flavor				typical geometry
+	 * 0	0	SO-DIMM with 64 Mbit parts	xx/8
+	 * 0	1	SO-DIMM with 128 Mbit parts	12/9
+	 * 1	0	SO-DIMM with 256 Mbit parts	13/9
+	 */
+
+	/* ### should we use the other SPD info or is col/row bits enough? */
+	if (col_bits == 8) {
+		typ1 = 0; typ0 = 0;
+	} else if (row_bits == 12 && col_bits == 9) {
+		typ1 = 0; typ0 = 1;
+	} else if (row_bits == 13 && col_bits == 9) {
+		typ1 = 1; typ0 = 0;
+	} else {
+		printf("SDRAM: unexpected geometry\n");
+		goto fail;
+	}
+
+ set:
+	printf("SDRAM: setting CPLD typ1=%d, typ0=%d\n", typ1, typ0);
+	if (typ1)
+		GPSR = BADGE4_GPIO_SDTYP1;
+	else
+		GPCR = BADGE4_GPIO_SDTYP1;
+	if (typ0)
+		GPSR = BADGE4_GPIO_SDTYP0;
+	else
+		GPCR = BADGE4_GPIO_SDTYP0;
+
+	return;
+
+ fail:
+	printf("SDRAM: making unwarranted assumption that SDRAM is 12x9\n");
+	typ1 = 0; typ0 = 1;
+	goto set;
 }
 
+static void badge4_init_hardware2(void)
+{
+	badge4_init_sa1111();
+	badge4_setup_sdram();
+}
+__initlist(badge4_init_hardware2, INIT_LEVEL_INITIAL_HARDWARE + 2);
 
-__initlist(init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/bootldrpart.c
diff -u build_tree/bootLoader/src/blob/bootldrpart.c:1.1.1.1 build_tree/bootLoader/src/blob/bootldrpart.c:1.1.1.2
--- build_tree/bootLoader/src/blob/bootldrpart.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/bootldrpart.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: bootldrpart.c,v 1.2 2001/12/26 23:38:36 erikm Exp $
+ * $Id: bootldrpart.c,v 1.3 2002/02/13 00:17:32 erikm Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -25,7 +25,7 @@
  * sources, file drivers/mtd/bootldr.c.
  */
 
-#ident "$Id: bootldrpart.c,v 1.2 2001/12/26 23:38:36 erikm Exp $"
+#ident "$Id: bootldrpart.c,v 1.3 2002/02/13 00:17:32 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -38,6 +38,9 @@
 #include <blob/util.h>
 
 
+/* FIXME: don't do bootldr partitions for the time being -- Erik */
+#if 0
+
 
 #define BOOTLDR_PARTITION_NAMELEN 32
 enum LFR_FLAGS {
@@ -203,3 +206,4 @@
 
 	return 0;
 }
+#endif
Index: build_tree/bootLoader/src/blob/brutus.c
diff -u build_tree/bootLoader/src/blob/brutus.c:1.1.1.1 build_tree/bootLoader/src/blob/brutus.c:1.1.1.2
--- build_tree/bootLoader/src/blob/brutus.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/brutus.c	Fri Nov  9 09:44:05 2007
@@ -19,7 +19,7 @@
  *
  */
 
-#ident "$Id: brutus.c,v 1.5 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: brutus.c,v 1.9 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -27,14 +27,17 @@
 
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
 
 
 
 
 /* flash descriptor for Brutus flash. */
 /* I have *really* no idea what kind of flash Brutus uses */
-static flash_descriptor_t brutus_flash_descriptors[] =
+static const flash_descriptor_t brutus_flash_descriptors[] =
 {
 #warning "Please verify Brutus flash layout"
 	{
@@ -59,8 +62,11 @@
 
 static void brutus_init_hardware(void)
 {
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(brutus_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/cep.c
diff -u /dev/null build_tree/bootLoader/src/blob/cep.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/cep.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,88 @@
+/*
+ * cep.c: Cep specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: cep.c,v 1.4 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
+
+
+
+
+/* flash descriptor for Cep flash */
+/* 2x Intel 28F128J3A strataflash (16MB) */
+static const flash_descriptor_t cep_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 64,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+
+
+static void init_cep_flash_driver(void)
+{
+	flash_descriptors = cep_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+}
+
+__initlist(init_cep_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+
+#define RS232_ENABLE		0x00001000
+#define GREEN_LED_ENABLE	0x00004000
+
+static void cep_init_hardware(void)
+{
+	u32 *bcr = (u32 *)0x12000000;
+	
+	/* enable RS232 tranceiver */
+	*bcr = RS232_ENABLE;
+
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+
+        /* switch on the LED D3 */
+        *((volatile u8*)(0x40000004))= 0x02;
+	
+}
+
+
+__initlist(cep_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/chain.S
diff -u build_tree/bootLoader/src/blob/chain.S:1.1.1.1 build_tree/bootLoader/src/blob/chain.S:1.1.1.2
--- build_tree/bootLoader/src/blob/chain.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/chain.S	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: chain.S,v 1.2 2001/11/04 23:12:50 erikm Exp $
+ * $Id: chain.S,v 1.4 2003/08/06 22:55:41 abz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -28,7 +28,7 @@
  * This loader is position independent.
  */
 
-.ident "$Id: chain.S,v 1.2 2001/11/04 23:12:50 erikm Exp $"
+.ident "$Id: chain.S,v 1.4 2003/08/06 22:55:41 abz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -58,7 +58,7 @@
 #endif
 
 	/* init LED */
-	bl	ledinit
+	//bl	ledinit
 
 	/* assume that the CPU and the memory are already set up at
 	 * this point. also assume that interrupts are disabled, and if
@@ -72,11 +72,13 @@
 
 relocate:
 	/* get a clue where we are running so we know what to copy */
-	ldr	r0, START
+	ldr	r1, START
 
 	/* relocate the second stage loader */
-	add	r2, r0, #(64 * 1024)	/* blob maximum size is 64kB */
-	add	r0, r0, #0x400		/* skip first 1024 bytes */
+	ldr	r0, piggy_start
+	add	r0, r0, r1
+	ldr	r2, piggy_end
+	add	r2, r2, r1
 	ldr	r1, BLOB_START
 
 	/* r0 = source address
@@ -93,7 +95,7 @@
 	/* turn off the LED. if it stays off it is an indication that
 	 * we didn't make it into the C code 
 	 */
-	bl led_off
+	//bl led_off
 
 
 	/* blob is copied to ram, so jump to it */
@@ -103,3 +105,5 @@
 	
 START:		.word	0x00000000
 BLOB_START:	.word	BLOB_ABS_BASE_ADDR
+piggy_start:	.word	__piggy_start
+piggy_end:	.word	__piggy_end
Index: build_tree/bootLoader/src/blob/chkmem.c
diff -u build_tree/bootLoader/src/blob/chkmem.c:1.1.1.1 build_tree/bootLoader/src/blob/chkmem.c:1.1.1.2
--- build_tree/bootLoader/src/blob/chkmem.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/chkmem.c	Fri Nov  9 09:44:05 2007
@@ -1,8 +1,8 @@
 /*-------------------------------------------------------------------------
  * Filename:      chkmem.c
- * Version:       $Id: chkmem.c,v 1.6 2001/10/29 11:49:48 seletz Exp $
+ * Version:       $Id: chkmem.c,v 1.11 2003/08/18 11:58:10 seletz Exp $
  * Copyright:     Copyright (C) 2001, Stefan Eletzhofer
- * Author:        Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Author:        Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
  * Description:   memory test functions
  * Created at:    Mit Sep 26 19:20:24 CEST 2001
  * Modified by:   
@@ -11,7 +11,7 @@
 /*
  * chkmem.c: Utility to test memory integrity
  *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: chkmem.c,v 1.6 2001/10/29 11:49:48 seletz Exp $"
+#ident "$Id: chkmem.c,v 1.11 2003/08/18 11:58:10 seletz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -57,25 +57,34 @@
 /* more readable IMHO */
 #define MEM( x )        (*((u32 *)x))
 
-#define MAKE32FROM8(X)	(u32) (X | X << 8 | X << 16 | X << 24)
+#define MAKE32FROM8(x)	(u32) ((x) | ((x) << 8) | ((x) << 16) | ((x) << 24))
 
 #define	CHKMEM_ERR		(-1)
 #define CHKMEM_OK		(0)
 
 #if CHKMEM_DEBUG
-#	define SHOWFUNC()		SerialOutputString("chkmem: method: "__FUNCTION__ "\n" ); \
-							SerialOutputString("	p1=0x"); \
-							SerialOutputHex((u32)bp1); \
-							SerialOutputString(" p2=0x"); \
-							SerialOutputHex((u32)bp2); \
-							SerialOutputString(" count=0x"); \
-							SerialOutputHex((u32)count); \
-							SerialOutputString("\n");
+#  define SHOWFUNC() \
+	do { \
+		SerialOutputString("chkmem: method: "); \
+		SerialOutputString(__FUNCTION__); \
+		SerialOutputString("\n	p1=0x"); \
+		SerialOutputHex((u32)bp1); \
+		SerialOutputString(" p2=0x"); \
+		SerialOutputHex((u32)bp2); \
+		SerialOutputString(" count=0x"); \
+		SerialOutputHex((u32)count); \
+		SerialOutputString("\n"); \
+	} while (0)
 #else
-#	define SHOWFUNC()		SerialOutputString("chkmem: method: "__FUNCTION__ "\n" );
+#  define SHOWFUNC() \
+	do { \
+		SerialOutputString("chkmem: method: "); \
+		SerialOutputString(__FUNCTION__); \
+		SerialOutputString("\n" ); \
+	} while (0)
 #endif
 
-#define SKIPBLOBMEM( STARTADR ) while ( STARTADR < (BLOB_RAM_BASE + 0x00100000) ) STARTADR++;
+#define SKIPBLOBMEM(x) if ((x) < BLOB_RAM_BASE + 0x00100000) x = BLOB_RAM_BASE + 0x00100000
 
 #define CHKMEM_MAXERR	64
 #define CHKMEM_PUSHERR( ADR ) { chkmem_errlist[ chkmem_errs % CHKMEM_MAXERR ] = ADR; \
@@ -138,14 +147,13 @@
 int ChkMem( int argc, char *argv[] )
 {
 	memtestfunc_t	method;
-	int				area;
-	u32				start		= 0L;
-	u32				end			= 0L;
-	u32				badaddr		= 0L;
-	u32				repcount	= 0L;
+	u32		start	= 0L;
+	u32		end	= 0L;
+	u32		badaddr	= 0L;
+	u32		repcount= 0L;
 
 	/* check args */
-	if ( argc < 2 ) {
+	if ( argc < 4 ) {
 		SerialOutputString("*** not enough arguments\n");
 		return CHKMEM_ERR;
 	}
@@ -153,11 +161,21 @@
 	/* reset error counter */
 	chkmem_errs = 0;
 
+	if(strtou32(argv[1], &start) < 0) {
+		SerialOutputString("*** not a value (start)\n");
+		return CHKMEM_ERR;
+	}
+
+	if(strtou32(argv[2], &end) < 0) {
+		SerialOutputString("*** not a value (start)\n");
+		return CHKMEM_ERR;
+	}
+
 	/* get verbosity level */
 	showevery = CHKMEM_SHOWEVERY;
-	if ( argc > 2 ) {
-		if(strtou32(argv[2], &showevery) < 0) {
-			SerialOutputString("*** not a value\n");
+	if ( argc > 4 ) {
+		if(strtou32(argv[4], &showevery) < 0) {
+			SerialOutputString("*** not a value (showevry)\n");
 			return CHKMEM_ERR;
 		}
 
@@ -171,20 +189,18 @@
 
 	/* get repeat count */
 	repcount = 1;
-	if ( argc > 3 ) {
-		if ( strtou32(argv[3], &repcount ) < 0 ) {
+	if ( argc > 5 ) {
+		if ( strtou32(argv[5], &repcount ) < 0 ) {
 			SerialOutputString("*** not a value\n");
 			return CHKMEM_ERR;
 		}
 	}
 
-	SerialOutputString(argv[0]);
-	SerialOutputString(": display every 0x");
-	SerialOutputHex(showevery);
-	SerialOutputString(" bytes\n");
+	printf( "%s: display every 0x%08x bytes\n", argv[0], showevery );
+	printf( "%s: start: 0x%08x end: 0x%08x\n", argv[0], start, end );
 
 	/* set memory test method */
-	switch ( *argv[1] ) {
+	switch ( *argv[3] ) {
 		case '0':
 			method = ChkMemMovInv;
 			break;
@@ -201,16 +217,8 @@
 	}
 
 	while ( repcount-- ) {
-		/* test all known memory areas */
-		for (area = 0; area < NUM_MEM_AREAS; area++) {
-			if(memory_map[area].used) {
-				start = memory_map[area].start;
-				end = start + memory_map[area].len;
-
-				if ( method(start, end, 0x5555aaaa, &badaddr) != CHKMEM_OK ) {
-					CHKMEM_PUSHERR( badaddr );
-				}
-			}
+		if ( method(start, end, 0x5555aaaa, &badaddr) != CHKMEM_OK ) {
+			CHKMEM_PUSHERR( badaddr );
 		}
 	}
 
@@ -222,7 +230,10 @@
 
 	return CHKMEM_OK;
 }
-static char chkmemhelp[] = "chkmem [method] {verbosity:1..F} {repeat-count}\nmethod=0: move-inverse test\n"
+static char chkmemhelp[] = "chkmem start end method {verbosity:1..F} {repeat-count}\n"
+"start:    startadr\n"
+"end:      endadr\n"
+"method=0: move-inverse test\n"
 "method=1: address test\n"
 "method=2: hardcore test\n"
 "verbosity: display every 2^n address during test\n";
@@ -287,10 +298,7 @@
 	SerialOutputString("\n*** memory errors:\n");
 
 	for ( i=0; i< chkmem_errs % CHKMEM_MAXERR; i++ ) {
-		SerialOutputHex( i );
-		SerialOutputString(": 0x");
-		SerialOutputHex(chkmem_errlist[i]);
-		SerialOutputString("\n");
+		printf( "%02d: adr 0x%08x\n", i, chkmem_errlist[i] );
 	}
 
 	return CHKMEM_OK;
@@ -332,11 +340,7 @@
 	SKIPBLOBMEM( start );
 
 #if CHKMEM_DEBUG
-	SerialOutputString("ChkMem: start(0x");
-	SerialOutputHex(start);
-	SerialOutputString(") - end(0x");
-	SerialOutputHex(end);
-	SerialOutputString(")\n");
+	printf( "chkmem: 0x%08x -> 0x%08x\n", start, end );
 #endif
 
 #if CHKMEM_DEBUG
@@ -421,11 +425,7 @@
 	SKIPBLOBMEM( start );
 
 #if CHKMEM_DEBUG
-	SerialOutputString("ChkMem: start(0x");
-	SerialOutputHex(start);
-	SerialOutputString(") - end(0x");
-	SerialOutputHex(end);
-	SerialOutputString(")\n");
+	printf( "chkmem: 0x%08x -> 0x%08x\n", start, end );
 #endif
 
 #if CHKMEM_DEBUG
@@ -488,11 +488,7 @@
 	SKIPBLOBMEM( start );
 
 #if CHKMEM_DEBUG
-	SerialOutputString("ChkMem: start(0x");
-	SerialOutputHex(start);
-	SerialOutputString(") - end(0x");
-	SerialOutputHex(end);
-	SerialOutputString(")\n");
+	printf( "chkmem: 0x%08x -> 0x%08x\n", start, end );
 #endif
 
 	count = end - start;
Index: build_tree/bootLoader/src/blob/clart.c
diff -u build_tree/bootLoader/src/blob/clart.c:1.1.1.1 build_tree/bootLoader/src/blob/clart.c:1.1.1.2
--- build_tree/bootLoader/src/blob/clart.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/clart.c	Fri Nov  9 09:44:05 2007
@@ -19,7 +19,7 @@
  *
  */
 
-#ident "$Id: clart.c,v 1.5 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: clart.c,v 1.9 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -27,14 +27,17 @@
 
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
 
 
 
 
 /* flash descriptor for CreditLART flash */
 /* 1x Intel 28F256J3A strataflash (16MB) */
-static flash_descriptor_t clart_flash_descriptors[] =
+static const flash_descriptor_t clart_flash_descriptors[] =
 {
 	{ 
 		size: 128 * 1024,
@@ -62,8 +65,11 @@
 
 static void clart_init_hardware(void)
 {
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(clart_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/clock.c
diff -u build_tree/bootLoader/src/blob/clock.c:1.1.1.1 build_tree/bootLoader/src/blob/clock.c:1.1.1.2
--- build_tree/bootLoader/src/blob/clock.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/clock.c	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      clock.c
- * Version:       $Id: clock.c,v 1.3 2001/10/07 23:01:08 erikm Exp $
+ * Version:       $Id: clock.c,v 1.5 2003/09/03 04:27:54 russd Exp $
  * Copyright:     Copyright (C) 2000, Johan Pouwelse
  * Author:        Johan Pouwelse <pouwelse@twi.tudelft.nl>
  * Description:   Clock switching functions
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: clock.c,v 1.3 2001/10/07 23:01:08 erikm Exp $"
+#ident "$Id: clock.c,v 1.5 2003/09/03 04:27:54 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -39,7 +39,7 @@
 #include <blob/errno.h>
 #include <blob/error.h>
 #include <blob/types.h>
-#include <blob/sa1100.h>
+#include <blob/arch.h>
 #include <blob/serial.h>
 #include <blob/time.h>
 #include <blob/util.h>
@@ -61,7 +61,6 @@
 {
 	int i;
 	u32 regs[5];
-	u32 startTime, currentTime;
 	
 	if(argc < 6)
 		return -ENOPARAMS;
@@ -81,13 +80,8 @@
 	MDCAS2 = regs[SA_MDCAS2];
 	
 	/* sleep for a second */
-	startTime = TimerGetTime();
-	
-	for(;;) {
-		currentTime = TimerGetTime();
-		if((currentTime - startTime) > (u32)TICKS_PER_SECOND)
-			return 0;
-	}
+	msleep(1000);
+
 } /* SetClock */
 
 
Index: build_tree/bootLoader/src/blob/commands.c
diff -u build_tree/bootLoader/src/blob/commands.c:1.1.1.1 build_tree/bootLoader/src/blob/commands.c:1.4
--- build_tree/bootLoader/src/blob/commands.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/commands.c	Wed Nov 14 17:02:19 2007
@@ -1,39 +1,34 @@
 /*
- * commands.c: commands for blob
- *
- * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- *
- * $Id: commands.c,v 1.2 2001/10/07 22:36:11 erikm Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
+ * WARNING:
+ * This file was generated by make_commands.sh. All changes to this file
+ * will be automatically overwritten once you rerun make_commands.sh. Do
+ * not try to check this file into CVS: generated files do not belong in
+ * CVS repositories.
  */
 
-#ident "$Id: commands.c,v 1.2 2001/10/07 22:36:11 erikm Exp $"
-
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
-
 #include <blob/command.h>
-#include <blob/reboot.h>
-#include <blob/terminal.h>
-
-
 
+extern int reset_cmd(int argc, char *argv[]);
+extern char reset_help[];
+__commandlist(reset_cmd, "reset", reset_help);
+
+extern int reboot_cmd(int argc, char *argv[]);
+extern char reboot_help[];
+__commandlist(reboot_cmd, "reboot", reboot_help);
+
+extern int poke_cmd(int argc, char *argv[]);
+extern char poke_help[];
+__commandlist(poke_cmd, "poke", poke_help);
+
+extern int peek_cmd(int argc, char *argv[]);
+extern char peek_help[];
+__commandlist(peek_cmd, "peek", peek_help);
+
+extern int xdownload_cmd(int argc, char *argv[]);
+extern char xdownload_help[];
+__commandlist(xdownload_cmd, "xdownload", xdownload_help);
 
-__commandlist(reset_terminal, "reset", resethelp);
-__commandlist(reboot, "reboot", reboothelp);
Index: build_tree/bootLoader/src/blob/compr_rtime.c
diff -u /dev/null build_tree/bootLoader/src/blob/compr_rtime.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/compr_rtime.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,94 @@
+/*
+ * JFFS2 -- Journalling Flash File System, Version 2.
+ *
+ * Copyright (C) 2001 Red Hat, Inc.
+ *
+ * Created by Arjan van de Ven <arjanv@redhat.com>
+ *
+ * The original JFFS, from which the design for JFFS2 was derived,
+ * was designed and implemented by Axis Communications AB.
+ *
+ * The contents of this file are subject to the Red Hat eCos Public
+ * License Version 1.1 (the "Licence"); you may not use this file
+ * except in compliance with the Licence.  You may obtain a copy of
+ * the Licence at http://www.redhat.com/
+ *
+ * Software distributed under the Licence is distributed on an "AS IS"
+ * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.
+ * See the Licence for the specific language governing rights and
+ * limitations under the Licence.
+ *
+ * The Original Code is JFFS2 - Journalling Flash File System, version 2
+ *
+ * Alternatively, the contents of this file may be used under the
+ * terms of the GNU General Public License version 2 (the "GPL"), in
+ * which case the provisions of the GPL are applicable instead of the
+ * above.  If you wish to allow the use of your version of this file
+ * only under the terms of the GPL and not to allow others to use your
+ * version of this file under the RHEPL, indicate your decision by
+ * deleting the provisions above and replace them with the notice and
+ * other provisions required by the GPL.  If you do not delete the
+ * provisions above, a recipient may use your version of this file
+ * under either the RHEPL or the GPL.
+ *
+ * $Id: compr_rtime.c,v 1.2 2002/02/16 00:43:59 erikm Exp $
+ *
+ *
+ * Very simple lz77-ish encoder.
+ *
+ * Theory of operation: Both encoder and decoder have a list of "last
+ * occurances" for every possible source-value; after sending the
+ * first source-byte, the second byte indicated the "run" length of
+ * matches
+ *
+ * The algorithm is intended to only send "whole bytes", no bit-messing.
+ *
+ */
+
+#ident "$Id: compr_rtime.c,v 1.2 2002/02/16 00:43:59 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/util.h>
+
+static int positions[256];
+
+void rtime_decompress(unsigned char *data_in, unsigned char *cpage_out,
+		      u32 srclen, u32 destlen)
+{
+	int outpos;
+	int pos;
+	int i;
+
+	outpos = pos = 0;
+
+	memset(positions, 0, 256 * sizeof(int));
+
+	while (outpos<destlen) {
+		unsigned char value;
+		int backoffs;
+		int repeat;
+
+		value = data_in[pos++];
+		cpage_out[outpos++] = value; /* first the verbatim copied byte */
+		repeat = data_in[pos++];
+		backoffs = positions[value];
+
+		positions[value]=outpos;
+		if (repeat) {
+			if (backoffs + repeat >= outpos) {
+				while(repeat) {
+					cpage_out[outpos++] = cpage_out[backoffs++];
+					repeat--;
+				}
+			} else {
+				for (i = 0; i < repeat; i++)
+					*(cpage_out + outpos + i) = *(cpage_out + backoffs + i);
+				outpos+=repeat;
+			}
+		}
+	}
+}  
Index: build_tree/bootLoader/src/blob/compr_rubin.c
diff -u /dev/null build_tree/bootLoader/src/blob/compr_rubin.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/compr_rubin.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,126 @@
+/*
+ * JFFS2 -- Journalling Flash File System, Version 2.
+ *
+ * Copyright (C) 2001 Red Hat, Inc.
+ *
+ * Created by Arjan van de Ven <arjanv@redhat.com>
+ *
+ * Heavily modified by Russ Dill <Russ.Dill@asu.edu> in an attempt at
+ * a little more speed.
+ *
+ * The original JFFS, from which the design for JFFS2 was derived,
+ * was designed and implemented by Axis Communications AB.
+ *
+ * The contents of this file are subject to the Red Hat eCos Public
+ * License Version 1.1 (the "Licence"); you may not use this file
+ * except in compliance with the Licence.  You may obtain a copy of
+ * the Licence at http://www.redhat.com/
+ *
+ * Software distributed under the Licence is distributed on an "AS IS"
+ * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.
+ * See the Licence for the specific language governing rights and
+ * limitations under the Licence.
+ *
+ * The Original Code is JFFS2 - Journalling Flash File System, version 2
+ *
+ * Alternatively, the contents of this file may be used under the
+ * terms of the GNU General Public License version 2 (the "GPL"), in
+ * which case the provisions of the GPL are applicable instead of the
+ * above.  If you wish to allow the use of your version of this file
+ * only under the terms of the GPL and not to allow others to use your
+ * version of this file under the RHEPL, indicate your decision by
+ * deleting the provisions above and replace them with the notice and
+ * other provisions required by the GPL.  If you do not delete the
+ * provisions above, a recipient may use your version of this file
+ * under either the RHEPL or the GPL.
+ *
+ * $Id: compr_rubin.c,v 1.2 2002/02/16 00:43:59 erikm Exp $
+ *
+ */
+
+#ident "$Id: compr_rubin.c,v 1.2 2002/02/16 00:43:59 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/compr_rubin.h>
+
+
+static void rubin_do_decompress(unsigned char *bits, unsigned char *in, 
+				unsigned char *page_out, u32 destlen)
+{
+	register char *curr = page_out;
+	char *end = page_out + destlen;
+	register unsigned long temp;
+	register unsigned long result;
+	register unsigned long p;
+	register unsigned long q;
+	register unsigned long rec_q;
+	register unsigned long bit;
+	register long i0;
+	unsigned long i;
+
+	/* init_pushpull */
+	temp = *(u32 *) in;
+	bit = 16;
+
+	/* init_rubin */
+	q = 0;
+	p = (long) (2 * UPPER_BIT_RUBIN);
+
+	/* init_decode */
+	rec_q = (in[0] << 8) | in[1];
+
+	while (curr < end) {
+		/* in byte */
+
+		result = 0;
+		for (i = 0; i < 8; i++) {
+			/* decode */
+
+			while ((q & UPPER_BIT_RUBIN) || ((p + q) <= UPPER_BIT_RUBIN)) {
+				q &= ~UPPER_BIT_RUBIN;
+				q <<= 1;
+				p <<= 1;
+				rec_q &= ~UPPER_BIT_RUBIN;
+				rec_q <<= 1;
+				rec_q |= (temp >> (bit++ ^ 7)) & 1;
+				if (bit > 31) {
+					bit = 0;
+					temp = *(++((u32 *) in));
+				}
+			}
+			i0 =  (bits[i] * p) >> 8;
+
+			if (i0 <= 0) i0 = 1;
+			/* if it fails, it fails, we have our crc 
+			if (i0 >= p) i0 = p - 1; */
+
+			result >>= 1;
+			if (rec_q < q + i0) {
+				/* result |= 0x00; */
+				p = i0;
+			} else {
+				result |= 0x80;
+				p -= i0;
+				q += i0;
+			}
+		}
+		*(curr++) = result;
+	}
+}		   
+
+
+void dynrubin_decompress(unsigned char *data_in, unsigned char *cpage_out, 
+		   unsigned long sourcelen, unsigned long dstlen)
+{
+	unsigned char bits[8];
+	int c;
+
+	for (c=0; c<8; c++) 
+		bits[c] = (256 - data_in[c]);
+
+	rubin_do_decompress(bits, data_in+8, cpage_out, dstlen);
+}
Index: build_tree/bootLoader/src/blob/cramfs.c
diff -u /dev/null build_tree/bootLoader/src/blob/cramfs.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/cramfs.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,151 @@
+/*-------------------------------------------------------------------------
+ * Filename:      cramfs.c
+ * Version:       $Id: cramfs.c,v 1.4 2002/04/27 07:32:40 timriker Exp $
+ * Copyright:     Copyright (C) 2001, Russ Dill
+ * Author:        Russ Dill <Russ.Dill@asu.edu>
+ * Description:   Module to load kernel from a cramfs
+ *-----------------------------------------------------------------------*/
+/*
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+ 
+/* note: this module doesn't currently support symlinks, but because of the
+ * nature of cramfs, this shouldn't be a big deal */
+
+#ident "$Id: cramfs.c,v 1.4 2002/04/27 07:32:40 timriker Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/load_kernel.h>
+#include <blob/mini_inflate.h>
+#include <blob/util.h>
+
+#define CRAMFS_MAGIC		0x28cd3d45	/* some random number */
+
+struct cramfs_inode { /* sizeof == 12*/
+	u32 mode:16, uid:16;
+	/* SIZE for device files is i_rdev */
+	u32 size:24, gid:8;
+	/* NAMELEN is the length of the file name, divided by 4 and
+           rounded up.  (cramfs doesn't support hard links.) */
+	/* OFFSET: For symlinks and non-empty regular files, this
+	   contains the offset (divided by 4) of the file data in
+	   compressed form (starting with an array of block pointers;
+	   see README).  For non-empty directories it is the offset
+	   (divided by 4) of the inode of the first file in that
+	   directory.  For anything else, offset is zero. */
+	u32 namelen:6, offset:26;
+};
+
+/*
+ * Superblock information at the beginning of the FS.
+ */
+struct cramfs_super {		/* sizeof == 62 == 0x40 + 12 */
+	u32 magic;		/* 0x28cd3d45 - random number */
+	u32 size;		/* Not used.  mkcramfs currently
+                                   writes a constant 1<<16 here. */
+	u32 flags;		/* 0 */
+	u32 future;		/* 0 */
+	u8 signature[16];	/* "Compressed ROMFS" */
+	u8 fsid[16];		/* random number */
+	u8 name[16];		/* user-defined name */
+	struct cramfs_inode root;	/* Root inode data */
+};
+
+static int cramfs_check_magic(struct part_info *part)
+{
+	return *((u32 *) part->offset) == CRAMFS_MAGIC;
+}
+
+static long cramfs_uncompress_page(char *dest, char *src, u32 srclen)
+{
+	long size;
+	src++; /* *src == 0x78 method */
+	src++; /* *src == 0x9C flags (!PRESET_DICT) */
+
+	size = decompress_block(dest, src);
+	return size;
+}
+
+
+static long cramfs_load_file(u32 *dest, struct part_info *part, 
+			     struct cramfs_inode *inode)
+{
+
+	long int curr_block;
+	u32 *block_ptrs;
+	long size, total_size = 0;
+	int i;
+
+	ldr_update_progress();
+	block_ptrs = ((u32 *) part->offset) + inode->offset;
+	curr_block = (inode->offset + ((inode->size + 4095) >> 12)) << 2;
+	for (i = 0; i < ((inode->size + 4095) >> 12); i++) {
+		size = cramfs_uncompress_page((char *) dest, 
+					      curr_block + part->offset, 
+					      block_ptrs[i] - curr_block);
+		if (size < 0) return size;
+		((char *) dest) += size;
+		/* Print a '.' every 0x40000 bytes */
+		if (((total_size + size) & ~0x3ffff) - (total_size & ~0x3ffff))
+			ldr_update_progress();
+		total_size += size;
+		curr_block = block_ptrs[i];
+	}
+	return total_size;
+}
+
+static u32 cramfs_load_kernel(u32 *dest, struct part_info *part, char *filename)
+{
+	struct cramfs_super *super;
+	struct cramfs_inode *inode;
+	unsigned long next_inode;
+	char *name;
+	long size;
+
+	size = -1;
+	super = (struct cramfs_super *) part->offset;
+	next_inode = super->root.offset << 2;
+
+	while (next_inode < (super->root.offset << 2) + super->root.size) {
+		inode = (struct cramfs_inode *) (next_inode + part->offset);
+		next_inode += (inode->namelen << 2) + 
+			       sizeof(struct cramfs_inode);
+
+		if (!(inode->mode & 0x8000)) continue; /* Is it a file? */
+
+		/* does it have 5 to 8 characters? */
+		if (!inode->namelen == 2) continue;
+		name = (char *) (inode + 1);
+
+		/* FIXME - should use "filename" */
+		if (!strncmp("linux\0\0", name, 8)) {
+			size = cramfs_load_file(dest, part, inode);
+			break;
+		}
+	}
+	return size <= 0 ? 0 : size;
+}
+
+struct kernel_loader cramfs_load = {
+	check_magic: cramfs_check_magic,
+	load_kernel: cramfs_load_kernel,
+	name:	     "cramfs"
+};
Index: build_tree/bootLoader/src/blob/csir_ims.c
diff -u /dev/null build_tree/bootLoader/src/blob/csir_ims.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/csir_ims.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,163 @@
+
+/*
+ * -*- eval: c_set_style("linux") -*-
+ *
+ * csir_ims.c: CSIR Incident Management System specific stuff
+ *
+ * Copyright (C) 2003 Abraham van der Merwe <abz@4dllc.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/command.h>
+#include <blob/uucodec.h>
+#include <blob/led.h>
+#include <blob/partition.h>
+#include <blob/time.h>
+
+#define GPIO25_LED GPIO_bit(25)
+
+static int led_state;
+static int led_locked;
+
+static void csir_ims_led_on (void)
+{
+	if (!led_locked) {
+		GPSR0 = GPIO25_LED;
+		led_state = 1;
+	}
+}
+
+static void csir_ims_led_off (void)
+{
+	if (!led_locked) {
+		GPCR0 = GPIO25_LED;
+		led_state = 0;
+	}
+}
+
+static void csir_ims_led_toggle (void)
+{
+	if (led_state)
+		csir_ims_led_off ();
+	else
+		csir_ims_led_on ();
+}
+
+static void csir_ims_led_lock (void)
+{
+	led_locked = 1;
+}
+
+static void csir_ims_led_unlock (void)
+{
+	led_locked = 0;
+}
+
+static void csir_ims_init_driver (void)
+{
+	static led_driver_t csir_ims_led_driver = {
+		.led_on		= csir_ims_led_on,
+		.led_off	= csir_ims_led_off,
+		.led_toggle	= csir_ims_led_toggle,
+		.led_lock	= csir_ims_led_lock,
+		.led_unlock	= csir_ims_led_unlock
+	};
+	static const flash_descriptor_t flash[] = {
+		{
+			.size		= 128 * 1024,
+			.num		= 64,
+			.lockable	= 1
+		},
+		{ /* NULL block */ }
+	};
+	static blob_partition_t partitions[] = {
+		{
+			.magic		= BLOB_DEFAULT_PART_TABLE_MAGIC,
+			.next		= sizeof (blob_partition_t),
+			.offset		= 0x00000000,
+			.size		= BLOB_PART_SIZ_FULL
+		}, {
+			.magic		= BLOB_PART_VALID_MAGIC,
+			.next		= sizeof (blob_partition_t),
+			.offset		= BLOB_PART_OFS_APPEND,
+			.size		= BLOB_FLASH_LEN,
+			.name		= "blob",
+			.mem_base	= BLOB_RAM_BASE
+		}, {
+			.magic		= BLOB_PART_VALID_MAGIC,
+			.next		= sizeof (blob_partition_t),
+			.offset		= BLOB_PART_OFS_APPEND,
+			.size		= PARAM_FLASH_LEN,
+			.name		= "param",
+			.flags		= BLOB_PART_FLAG_PTABLE
+		}, {
+			.magic		= BLOB_PART_VALID_MAGIC,
+			.next		= sizeof (blob_partition_t),
+			.offset		= BLOB_PART_OFS_APPEND,
+			.size		= KERNEL_FLASH_LEN,
+			.name		= "kernel",
+			.flags		= BLOB_PART_FLAG_EXEC,
+			.mem_base	= KERNEL_RAM_BASE,
+			.entry_point= KERNEL_RAM_BASE
+		}, {
+			.magic		= BLOB_PART_VALID_MAGIC,
+			.next		= sizeof (blob_partition_t),
+			.offset		= BLOB_PART_OFS_APPEND,
+			.size		= RAMDISK_FLASH_LEN,
+			.name		= "ramdisk",
+			.flags		= BLOB_PART_FLAG_LOAD,
+			.mem_base	= RAMDISK_RAM_BASE
+		}, {
+			.magic		= BLOB_PART_VALID_MAGIC,
+			.next		= sizeof (blob_partition_t),
+			.offset		= BLOB_PART_OFS_APPEND,
+			.size		= BLOB_PART_SIZ_FULL,
+			.name		= "jffs2",
+			.flags		= BLOB_PART_FLAG_JFFS2
+		}, {
+			.magic		= BLOB_PART_LAST_MAGIC
+		}
+	};
+
+	GPDR0 |= GPIO25_LED;
+
+	flash_descriptors = flash;
+
+	reboot_driver = &pxa_reboot_driver;
+	serial_driver = &pxa_serial_driver;
+	flash_driver = &intel16_flash_driver;
+	led_driver = &csir_ims_led_driver;
+	timer_driver = &intelarm_timer_driver;
+
+	default_partition_table = partitions;
+	flash_partition_table = (blob_partition_t *) 0x00000000;
+}
+
+__initlist (csir_ims_init_driver,INIT_LEVEL_DRIVER_SELECTION);
+
Index: build_tree/bootLoader/src/blob/dafit.c
diff -u /dev/null build_tree/bootLoader/src/blob/dafit.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/dafit.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,401 @@
+/*
+ * dafit.c: PT VibXpert specific tweaks
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001,2002,2003  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@eletztrick.de)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: dafit.c,v 1.5 2003/09/04 17:39:00 russd Exp $"
+
+/**********************************************************************
+ * includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/command.h>
+#include <blob/uucodec.h>
+#include <blob/time.h>
+#include <blob/partition.h>
+#include <blob/led.h>
+
+#include <blob/arch.h>
+#include <blob/proc/sa1111.h>
+
+#include <blob/generic_io.h>
+
+#include <blob/pcmcia.h>
+#include <blob/cf.h>
+#include <blob/ide.h>
+#include <blob/tar.h>
+#include <net/ether.h>
+
+/**********************************************************************
+ * defines
+ */
+
+/* more readable IMHO */
+#define MEM( x )        (*((u32 *)(x)))
+#define SET(reg,bit)	((reg) |= (1<<(bit)))
+#define RST(reg,bit)	((reg) &= ~(1<<(bit)))
+
+#define DAFIT_DEBUG 1
+
+#if DAFIT_DEBUG
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... )
+#endif
+
+/**********************************************************************
+ * globals
+ */
+
+extern blob_status_t blob_status;
+
+/**********************************************************************
+ * module globals
+ */
+
+#if DAFIT_DEBUG
+static int dbg = 1;
+#else
+static int sys3_dbg = 0;
+#endif
+
+/* flash descriptor for System3 flash. */
+/* System 3 uses 2xINTEL e28F640 Chips */
+static const flash_descriptor_t dafit_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 64,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+/* default partition table for DAFIT
+
+System3 flash layout
+~~~~~~~~~~~~~~~~~~~~
+
+16Mb Flash
+256k erase size
+
+0x00000000 BLOB		256k
+0x00040000 CONFIG	256k
+0x00080000 KERNEL	1024k
+0x00180000 INITRD	1536k
+0x00300000 ROOT		6M
+0x00900000 DATA		7M
+0x01000000 total	16M
+
+Note:
+	- dafit partitions are named like the files they're flashed
+	  with. This is to keep updating easy: Just loop through all
+	  files that are on our update media and flash them on the partition
+	  named like the file.
+
+ */
+static const blob_partition_t dafit_default_partition_table[] = {
+	{
+		/* start of table */
+		magic:	BLOB_DEFAULT_PART_TABLE_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	0x00000000,	/* absolute base address */
+		size:	16 * 1024 * 1024 /* total size of the flash */
+	},
+	{
+		/* blob itself */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		BLOB_FLASH_BASE,
+		size:		BLOB_FLASH_LEN,
+		name:		"blob",
+		mem_base:	BLOB_RAM_BASE
+	},
+	{
+		/* system config area */
+		magic:	BLOB_PART_VALID_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	CONFIG_FLASH_BASE,
+		size:	CONFIG_FLASH_LEN,
+		name:	"config.tar",
+		flags:	0
+	},
+	{
+		/* kernel */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset: 	KERNEL_FLASH_BASE,
+		size:		KERNEL_FLASH_LEN,
+		name:		"zImage",
+		flags:		BLOB_PART_FLAG_LOAD | BLOB_PART_FLAG_EXEC,
+		mem_base:	KERNEL_RAM_BASE,
+		entry_point:	KERNEL_RAM_BASE
+	},
+	{
+		/* ramdisk */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		RAMDISK_FLASH_BASE,
+		size:		RAMDISK_FLASH_LEN,
+		name:		"initrd.gz",
+		flags:		BLOB_PART_FLAG_LOAD,
+		mem_base:	RAMDISK_RAM_BASE
+	},
+	{
+		/* root (cramfs) */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		ROOTFS_FLASH_BASE,
+		size:		ROOTFS_FLASH_LEN,
+		name:		"cramfs",
+		flags:		BLOB_PART_FLAG_CRAMFS,
+	},
+	{
+		/* data (cramfs) */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		DATAFS_FLASH_BASE,
+		size:		DATAFS_FLASH_LEN,
+		name:		"data.img",
+		flags:		BLOB_PART_FLAG_CRAMFS,
+	},
+	{
+		/* last entry */
+		magic:	BLOB_PART_LAST_MAGIC
+	}
+};
+
+/**********************************************************************
+ * static functions
+ */
+static char module_version[] = "$Id: dafit.c,v 1.5 2003/09/04 17:39:00 russd Exp $";
+
+/*********************************************************************
+ * init_dafit_flash - inits system 3 flash driver
+ */
+static void init_dafit_flash_driver(void)
+{
+	flash_descriptors = dafit_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+}
+__initlist(init_dafit_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+/*********************************************************************
+ * dafit_init_hardware - inits system 3 LL hardware stuff
+ */
+static void dafit_init_hardware(void)
+{
+	/* init on-board CPLD */
+	MEM(DAFIT_CTRL_0) = 0x03;
+	MEM(DAFIT_CTRL_1) = 0x00;
+	MEM(DAFIT_CTRL_2) = 0x00;
+
+	/* initialize GPIO states */
+	GPDR = 0x0ffdbb80;
+	GPSR |=
+		GPIO_GPIO13 |
+		GPIO_GPIO15 |
+		GPIO_GPIO26;
+	GPCR |= 
+		GPIO_GPIO7 |
+		GPIO_GPIO8 |
+		GPIO_GPIO9 |
+		GPIO_GPIO11 |
+		GPIO_GPIO12 |
+		GPIO_GPIO16 |
+		GPIO_GPIO18 |
+		GPIO_GPIO19 |
+		GPIO_GPIO20 |
+		GPIO_GPIO21 |
+		GPIO_GPIO22 |
+		GPIO_GPIO23 |
+		GPIO_GPIO24 |
+		GPIO_GPIO25;
+
+	/* activate SYSCLCK for keyboard controller */
+	RST( MEM(TUCR), 31 );
+	GAFR |= GPIO_32_768kHz;
+	GPDR |= GPIO_32_768kHz;
+
+	/* 3.6864 MHz SYSCLK */
+	TUCR = TUCR_3_6864MHz;
+
+	msleep( 1 );
+
+	MEM(DAFIT_CTRL_1) = 0x04;
+
+	/* tweak blob config */
+	blob_status.boot_delay = 1;
+
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	ether_driver = &smc9196_ether_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+__initlist(dafit_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
+/**********************************************************************
+ * dafit default partition table
+ */
+static void dafit_set_partition_table(void)
+{
+	/* the default partition table */
+	default_partition_table = dafit_default_partition_table;
+	
+	/* we don't know where the flash partition table will live, so
+	 * put the pointer at 0x0000000 and let the partition table
+	 * parser figure out.
+	 */
+	flash_partition_table = (blob_partition_t*)0x00000000;
+}
+
+__initlist(dafit_set_partition_table, INIT_LEVEL_OTHER_STUFF);
+/* FIXME: need to think if this is the correct init level, we might
+ * want to have this before the param list stuff starts running */
+
+
+/*****************************************************************
+ * sysver - print system version
+ */
+static int sysver_cmd( int argc, char *argv[] )
+{
+	printf( "version: '%s'\n", module_version );
+	switch ( PT_ID_BOARDID ) {
+		case PT_BOARD_ALPHA:
+			printf( "ALPHA Board" );
+			break;
+		case PT_BOARD_SYS3:
+			printf( "SYSTEM 3 Board" );
+			break;
+		case PT_BOARD_DAFIT:
+			printf( "DAFIT Board" );
+			break;
+		default:
+			printf( "UNKNOWN Board (ID 0x%X)", PT_ID_BOARDID );
+			break;
+
+	}
+	printf( " revision 0x%02X.\n", PT_ID_REVISION ); 
+	return 0;
+}
+static char sysver_help[] = "print BLOB and dafit version number\n";
+__commandlist(sysver_cmd, "sysver", sysver_help);
+
+/**********************************************************************
+ * setdbg - set debug level
+ */
+int setdbg_cmd( int argc, char *argv[] )
+{
+	extern int cf_dbg_set(int);
+	int ret;
+	u32 lvl;
+
+	if ( argc < 2 ) return -EINVAL;
+
+	ret = strtou32(argv[1], &lvl);
+	if ( ret < 0 ) return -EINVAL;
+
+	dbg = lvl;
+
+#if defined(CONFIG_PCMCIA_SUPPORT)
+	if ( lvl>5 ) {
+		cf_dbg_set( 5 );
+		tar_dbg_set( 5 );
+	} else {
+		cf_dbg_set( 0 );
+		tar_dbg_set( 0 );
+	}
+
+	if ( lvl>10 ) {
+		io_dbg_set( 5 );
+		pcmcia_dbg_set( 5 );
+	} else {
+		io_dbg_set( 0 );
+		pcmcia_dbg_set( 0 );
+	}
+#endif
+
+	printf( "setdbg: debug level set to %d\n", dbg );
+	return 0;
+}
+static char setdbg_help[] = "setdbg level\n";
+__commandlist(setdbg_cmd, "setdbg", setdbg_help);
+
+
+#if defined(CONFIG_PCMCIA_SUPPORT)
+/*****************************************************************
+ * pcmcia_init - initialize PCMCIA
+ */
+int pcmcia_init()
+{
+	printf( "PT VibXpert CF init\n" );
+	return 0;
+}
+#endif
+
+
+
+/*****************************************************************
+ * misc utility funcs
+ */
+
+/*****************************************************************
+ * manually reference flash and download commands until they
+ * are in libblob.
+ */
+#if 0
+extern int cf_test_module( int argc, char *argv[] );
+extern char cf_help[];
+__commandlist(cf_test_module, "cftest", cf_help);
+#endif
+
+#if 1
+extern int fwrite_cmd(int argc, char *argv[]);
+extern char fwrite_help[];
+__commandlist(fwrite_cmd, "fwrite", fwrite_help);
+
+extern int ferase_cmd(int argc, char *argv[]);
+extern char ferase_help[];
+__commandlist(ferase_cmd, "ferase", ferase_help);
+#endif
+
+extern int dlfile_cmd(int argc, char *argv[]);
+extern char dlfile_help[];
+__commandlist(dlfile_cmd, "dlfile", dlfile_help);
+
+
Index: build_tree/bootLoader/src/blob/debug.c
diff -u build_tree/bootLoader/src/blob/debug.c:1.1.1.1 build_tree/bootLoader/src/blob/debug.c:removed
--- build_tree/bootLoader/src/blob/debug.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/debug.c	Tue Jan  8 14:21:46 2008
@@ -1,526 +0,0 @@
-/*
- * debug.c: Debugging command functions
- *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-#ident "$Id: debug.c,v 1.9 2002/01/06 15:44:23 erikm Exp $"
-
-/**********************************************************************
- * Includes
- */
-
-#ifdef HAVE_CONFIG_H
-# include <blob/config.h>
-#endif
-
-#include <blob/errno.h>
-#include <blob/error.h>
-#include <blob/types.h>
-#include <blob/util.h>
-#include <blob/serial.h>
-#include <blob/command.h>
-
-
-/**********************************************************************
- * defines
- */
-
-#define CHKMEM_DEBUG BLOB_DEBUG
-
-/* this will send a cold shiver through erik's spine ... */
-#define	ERR( x )		{ ret = x; goto DONE; }
-
-/* more readable IMHO */
-#define MEM( x )        (*((u32 *)x))
-
-/**********************************************************************
- * prototypes
- */
-
-static void perror( int errno, char *func );
-
-/*********************************************************************
- * CmdMemcpy
- *
- * AUTOR:		SELETZ
- * REVISED:
- *
- * Command wrapper for memcpy utility function.
- *
- */
-static int CmdMemcpy( int argc, char *argv[] )
-{
-	int	ret = 0;
-	u32	src	= 0L;
-	u32	dest	= 0L;
-	u32	len	= 0L;
-
-	if ( argc < 4 )				ERR( -EINVAL );
-
-	ret = strtou32( argv[1], &src );
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	ret = strtou32( argv[2], &dest );
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	ret = strtou32( argv[3], &len );
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	/* check alignment of src and dest */
-	if((src & 0x03) || (dest & 0x03))
-		ERR(-EALIGN);
-
-	/* counted in words */
-	if ( len & 0x00000003 ) {
-		len = ( len >> 2 ) + 1;
-	} else {
-		len = len >> 2;
-	}
-
-	SerialOutputString("\n### Now copying 0x");
-	SerialOutputHex(len);
-	SerialOutputString(" words from 0x");
-	SerialOutputHex((int)src);
-	SerialOutputString(" to 0x");
-	SerialOutputHex((int)dest);
-	serial_write('\n');
-
-	MyMemCpy( (u32 *)dest, (const u32 *)src, len);
-
-	SerialOutputString(" done\n");
-
-	ret = 0;
-DONE:
-	if ( ret != 0 ) {
-		perror( ret, __FUNCTION__ );
-	}
-	return ret;
-}
-
-static char memcpyhelp[] = "memcpy src dst len\n"
-"copy len bytes from src to dst\n";
-__commandlist(CmdMemcpy, "memcpy", memcpyhelp);
-
-
-/*********************************************************************
- * Poke
- *
- * AUTOR:	Stefan Eletzhofer
- * REVISED:
- *
- * Poke values to memory
- *
- */
-static int Poke( int argc, char *argv[] )
-{
-	int		ret				= 0;
-	u32		address;
-	u32		value;
-	char		type = 'w';
-
-	if ( argc < 3 ) 			ERR( -EINVAL );
-
-	ret = strtou32(argv[1], &address);
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	ret = strtou32(argv[2], &value);
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	if ( argc >= 3 ) {
-		type = argv[3][0];
-	}
-
-#if CHKMEM_DEBUG
-	SerialOutputString("adr=0x");
-	SerialOutputHex(address);
-	SerialOutputString(" val=0x");
-	SerialOutputHex(value);
-	SerialOutputString(" type=");
-	serial_write(type);
-	serial_write('\n');
-#endif
-
-	/* check memory alignment */
-	switch(type | 0x20) {
-	case 'b':
-		/* bytes don't have alignment restrictions */
-		break;
-
-	case 'h':
-		/* half word accesses should be aligned on half words */
-		if(address & 0x01)
-			ERR(-EALIGN);
-
-		break;
-
-	case 'w':
-		/* word accesses should be aligned on word boundaries */
-		if(address & 0x03)
-			ERR(-EALIGN);
-		
-		break;
-
-	default:
-		/* hmm, invalid type */
-		ERR( -EINVAL );
-		break;
-	}
-
-	/* write the value to memory */
-	switch( type | 0x20 ) {
-	case 'b':
-		*((u8 *)address) = (u8)(value & 0xff);
-		break;
-
-	case 'h':
-		*((u16 *)address) = (u16)(value & 0xffff);
-		break;
-
-	case 'w':
-		*((u32 *)address) = value;
-		break;
-
-	default:
-		/* this should not happen */
-		ERR( -EINVAL );
-		break;
-	}
-
-
-	ret = 0;
-DONE:
-	if ( ret != 0 ) {
-		perror( ret, __FUNCTION__ );
-	}
-	return ret;
-}
-
-static char pokehelp[] = "poke address value [b|h|w]\n"
-"b = byte, h = half word, w = word (default is w)\n";
-__commandlist(Poke, "poke", pokehelp );
-
-/*********************************************************************
- * Peek
- *
- * AUTHOR:	Stefan Eletzhofer
- * REVISED:
- *
- * Peeks values from memory
- *
- */
-static int Peek( int argc, char *argv[] )
-{
-	int		ret				= 0;
-	u32		address;
-	u32		value;
-	char		type	= 'w';
-
-	if ( argc < 2 ) 			ERR( -EINVAL );
-
-	ret = strtou32(argv[1], &address);
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	if ( argc >= 2 ) {
-		type = argv[2][0];
-	}
-
-#if CHKMEM_DEBUG
-	SerialOutputString("adr=0x");
-	SerialOutputHex(address);
-	SerialOutputString(" type=");
-	serial_write(type);
-	serial_write('\n');
-#endif
-
-	/* check memory alignment */
-	switch(type | 0x20) {
-	case 'b':
-		/* bytes don't have alignment restrictions */
-		break;
-
-	case 'h':
-		/* half word accesses should be aligned on half words */
-		if(address & 0x01)
-			ERR(-EALIGN);
-
-		break;
-
-	case 'w':
-		/* word accesses should be aligned on word boundaries */
-		if(address & 0x03)
-			ERR(-EALIGN);
-		
-		break;
-
-	default:
-		/* hmm, invalid type */
-		ERR( -EINVAL );
-		break;
-	}
-
-	/* read value from memory */
-	switch( type | 0x20 ) {
-	case 'b':
-		value = (*((u8 *)address)) & 0xff;
-		break;
-
-	case 'h':
-		value = (*((u16 *)address))& 0xffff;
-		break;
-
-	case 'w':
-		value = (*((u32 *)address));
-		break;
-
-	default:
-		/* this should not happen */
-		ERR(-EINVAL);
-		break;
-	}
-
-	serial_write(type);
-	serial_write(' ');
-	SerialOutputHex(value);
-	SerialOutputString("\n");
-
-	ret = 0;
-DONE:
-	if ( ret != 0 ) {
-		perror( ret, __FUNCTION__ );
-	}
-	return ret;
-}
-
-static char peekhelp[] = "peek address [b|h|w]\n"
-"b = byte, h = half word, w = word (default is w)\n";
-__commandlist(Peek, "peek", peekhelp );
-
-/*********************************************************************
- * dump
- *
- * AUTHOR: Tim Riker
- * REVISED:
- *
- * dumps memory
- *
- */
-static int dump( int argc, char *argv[] )
-{
-	int		ret = 0;
-	u32		address;
-	u32		endaddress;
-	u32		tmpaddress;
-	u32		value;
-
-	if ( argc < 2 )
-		ERR( -EINVAL );
-
-	ret = strtou32(argv[1], &address);
-	if ( ret < 0 )
-		ERR( -EINVAL );
-
-	if ( argc == 3 ) {
-		ret = strtou32(argv[2], &endaddress);
-		if ( ret < 0 )
-			ERR( -EINVAL );
-	} else
-		endaddress = address + 0x80;
-
-
-	/* check alignment of address and endaddress */
-	if((address & 0x03) || (endaddress & 0x03))
-		ERR(-EALIGN);
-
-	/* print it */
-	for ( ; address < endaddress; address += 0x10) {
-		SerialOutputHex(address);
-		SerialOutputString(": ");
-		for (tmpaddress = address; tmpaddress < address + 0x10; tmpaddress += 4) {
-			value = (*((u32 *)tmpaddress));
-			SerialOutputHex(value);
-			serial_write(' ');
-		}
-		for (tmpaddress = address; tmpaddress < address + 0x10; tmpaddress++) {
-			value = (*((u8 *)tmpaddress)) & 0xff;
-			if ((value >= ' ') && (value <= '~'))
-				serial_write(value);
-			else
-				serial_write('.');
-		}
-		serial_write('\n');
-	}
-
-	ret = 0;
-DONE:
-	if ( ret != 0 ) {
-		perror( ret, __FUNCTION__ );
-	}
-	return ret;
-}
-
-static char dumphelp[] = "dump address [endAddress]\n";
-__commandlist(dump, "dump", dumphelp );
-
-/*********************************************************************
- * BitChange
- *
- * AUTOR:		SELETZ
- * REVISED:
- *
- * Modifies bits of an given memory location
- *
- */
-static int BitChange( int argc, char *argv[] )
-{
-	int		ret		= 0;
-	u32		adr		= 0L;
-	u32		value	= 0L;
-
-	if ( argc < 4 )				ERR( -EINVAL );
-
-	ret = strtou32( argv[1], &adr );
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	ret = strtou32( argv[2], &value );
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	/* check memory alignment */
-	if(adr &= 0x03)
-		ERR(-EALIGN);
-
-	SerialOutputHex( MEM( adr ) );
-
-	switch ( argv[3][0] & (~0x20) ) {
-		case 'A':
-			MEM( adr ) &= value;
-			break;
-		case 'S':
-		case 'O':
-			MEM( adr ) |= value;
-			break;
-		case 'X':
-			MEM( adr ) ^= value;
-			break;
-		case 'C':
-			MEM( adr ) &= ~value;
-			break;
-		default:
-			ERR( -EINVAL );
-			break;
-	}
-
-	SerialOutputString( "->" );
-	SerialOutputHex( MEM( adr ) );
-	SerialOutputString( "\n" );
-
-	ret = 0;
-DONE:
-	if ( ret != 0 ) {
-		perror( ret, __FUNCTION__ );
-	}
-	return ret;
-}
-
-static char bitchghelp[] = "bitchg address value {and|or|xor|set|clear}\n";
-__commandlist(BitChange, "bitchg", bitchghelp );
-
-/*********************************************************************
- * Call
- *
- * AUTHOR:		Christopher Hoover <ch@hpl.hp.com>
- * REVISED:
- *
- * Jumps to an arbitrary address.
- *
- */
-static int Call( int argc, char *argv[] )
-{
-	int		ret		= 0;
-	u32 adr, a = 0, b = 0, c = 0, d = 0;
-	int (*called_fn)(u32, u32, u32, u32);
-
-	if ( argc < 2  || argc > 6 )		ERR( -EINVAL );
-
-	ret = strtou32( argv[1], &adr );
-	if ( ret < 0 )				ERR( -EINVAL );
-
-	if ( argc >= 3 ) {
-		ret = strtou32( argv[2], &a );
-		if ( ret < 0 )			ERR( -EINVAL );
-	}
-	if ( argc >= 4 ) {
-		ret = strtou32( argv[2], &b );
-		if ( ret < 0 )			ERR( -EINVAL );
-	}
-	if ( argc >= 5 ) {
-		ret = strtou32( argv[2], &c );
-		if ( ret < 0 )			ERR( -EINVAL );
-	}
-	if ( argc >= 6) {
-		ret = strtou32( argv[2], &d );
-		if ( ret < 0 )			ERR( -EINVAL );
-	}
-
-	SerialOutputString("Calling function at 0x");
-	SerialOutputHex(adr);
-	SerialOutputString(" ...\n");
-	serial_flush_output();
-
-	called_fn = (int (*)(u32, u32, u32, u32))adr;
-
-	ret = called_fn(a, b, c, d);
-	
-	SerialOutputString("\nReturn value: 0x");
-	SerialOutputHex((u32)ret);
-	serial_write('\n');
-
-	ret = 0;
-
-DONE:
-	if ( ret != 0 ) {
-		perror( ret, __FUNCTION__ );
-	}
-	return ret;
-}
-
-static char callhelp[] = "call address [arg0 [arg1 [arg2 [arg3]]]]\n"
-"Call function at <address> with optional arguments\n";
-
-__commandlist(Call, "call", callhelp);
-
-
-/**********************************************************************
- * static functions
- */
-
-static void perror( int errno, char *func )
-{
-	printerrprefix();
-
-	if ( errno < 0 )
-		errno = -errno;
-
-	if ( func != NULL) {
-		SerialOutputString(func);
-		SerialOutputString(": ");
-	}
-	SerialOutputString(strerror(errno));
-
-	serial_write('\n');
-}
Index: build_tree/bootLoader/src/blob/flash-commands.c
diff -u /dev/null build_tree/bootLoader/src/blob/flash-commands.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/flash-commands.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,242 @@
+/*-------------------------------------------------------------------------
+ * Filename:      flash-commands.c
+ * Version:       $Id: flash-commands.c,v 1.7 2003/03/11 19:36:25 seletz Exp $
+ * Copyright:     Copyright (C) 2002, Hewlett-Packard Company
+ * Author:        Christopher Hoover <ch@hpl.hp.com>
+ * Description:   Flash commands for blob
+ * Created at:    Tue Jan 15 02:27:30 UTC 2002
+ *-----------------------------------------------------------------------*/
+/*
+ * flash-commands.c: Flash commands for blob
+ *
+ * Copyright (C) 2002  Hewlett-Packard Company
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: flash-commands.c,v 1.7 2003/03/11 19:36:25 seletz Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/partition.h>
+#include <blob/main.h>
+
+#include <blob/command.h>
+
+int parse_partition(char *s, u32 **addr, u32 *length)
+{
+	const blob_partition_t *p = pt_find_by_name(s);
+	
+	if (p == 0)
+		return -EINVAL;
+
+	*addr = (u32 *) pt_flash_start(p);
+	*length = p->size;
+
+	return 0;
+}
+
+
+
+static int Flash(int argc, char *argv[])
+{
+	int rv;
+	u32 *src;
+	u32 *dst;
+	u32 numBytes = 0;
+	u32 maxSize = 0;
+	u32 nwords;
+	char *dest_part;
+	block_source_t type = fromFlash;
+	
+	if(argc < 2)
+		return -ENOPARAMS;
+
+	if ( argc>2 ) {
+		dest_part = argv[2];
+	} else {
+		dest_part = argv[1];
+	}
+
+	rv = parse_partition(dest_part, &dst, &maxSize);
+	if (rv < 0) {
+		printerror(rv, dest_part);
+		return 0;
+	}
+
+	if(strncmp(argv[1], "blob", 5) == 0) {
+		src = (u32 *)BLOB_RAM_BASE;
+		numBytes = blob_status.blobSize;
+		type = blob_status.blobType;
+	} else if(strncmp(argv[1], "param", 6) == 0) {
+		src = (u32 *)PARAM_RAM_BASE;
+		numBytes = blob_status.paramSize;
+		type = blob_status.paramType;
+	} else if(strncmp(argv[1], "kernel", 7) == 0) {
+		src = (u32 *)KERNEL_RAM_BASE;
+		numBytes = blob_status.kernelSize;
+		type = blob_status.kernelType;
+	} else if(strncmp(argv[1], "ramdisk", 8) == 0) {
+		src = (u32 *)RAMDISK_RAM_BASE;
+		numBytes = blob_status.ramdiskSize;
+		type = blob_status.ramdiskType;
+	} else {
+		printerror(EINVAL, argv[1]);
+		return 0;
+	}
+
+	if(type == fromFlash) {
+		printerrprefix();
+		printf("%s not downloaded\n", argv[1]);
+		return -EINVAL;
+	}
+
+	if(numBytes > maxSize) {
+		printerrprefix();
+		printf("image too large for flash: 0x%08x > 0x%08x\n",
+		       (unsigned int)numBytes, (unsigned int)maxSize);
+
+		return -ETOOLONG;
+	}
+
+	nwords = (numBytes + sizeof(u32) - 1) / sizeof(u32);
+
+	printf("Saving %s to flash\n", argv[1]);
+
+	flash_write_region(dst, src, nwords);
+
+	return 0;
+}
+
+static char flashhelp[] = "flash {blob|param|kernel|ramdisk} [part]\n"
+"Write <argument> image to flash using partition <part>. If <part> is omitted\n"
+"assume <part>==<argument>\n";
+
+__commandlist(Flash, "flash", flashhelp);
+
+
+
+static int Lock(int argc, char *argv[])
+{
+	int rv;
+	u32 *addr, length;
+
+	if(argc != 2)
+		return -ENOPARAMS;
+	
+	if (!flash_driver->lock_block) {
+		printerror(EINVAL, argv[1]);
+		return 0;
+	}
+
+	rv = parse_partition(argv[1], &addr, &length);
+	if (rv < 0) {
+		printerror(rv, argv[1]);
+		return 0;
+	}
+
+	rv = flash_lock_region(addr, length >> 2);
+	if (rv < 0) {
+		printerror(rv, argv[1]);
+		return 0;
+	}
+
+	return 0;
+}
+
+static char lockhelp[] = "lock partition\n"
+"Lock <partition> region of flash\n";
+
+__commandlist(Lock, "lock", lockhelp);
+
+
+
+
+static int Unlock(int argc, char *argv[])
+{
+	int rv;
+	u32 *addr, length;
+
+	if(argc != 2)
+		return -ENOPARAMS;
+	
+	if (!flash_driver->unlock_block) {
+		printerror(EINVAL, argv[1]);
+		return 0;
+	}
+
+	rv = parse_partition(argv[1], &addr, &length);
+	if (rv < 0) {
+		printerror(rv, argv[1]);
+		return 0;
+	}
+
+	rv = flash_unlock_region(addr, length >> 2);
+	if (rv < 0) {
+		printerror(rv, argv[1]);
+		return 0;
+	}
+
+	return 0;
+}
+
+static char unlockhelp[] = "unlock partition\n"
+"Unlock <partition> region of flash\n";
+
+__commandlist(Unlock, "unlock", unlockhelp);
+
+
+
+static int Erase(int argc, char *argv[])
+{
+	int rv;
+	u32 *addr, length;
+
+	if(argc != 2)
+		return -ENOPARAMS;
+	
+	if (!flash_driver->erase) {
+		printerror(EINVAL, argv[1]);
+		return 0;
+	}
+
+	rv = parse_partition(argv[1], &addr, &length);
+	if (rv < 0) {
+		printerror(rv, argv[1]);
+		return 0;
+	}
+
+	rv = flash_erase_region(addr, length >> 2);
+	if (rv < 0) {
+		printerror(rv, argv[1]);
+		return 0;
+	}
+
+	return 0;
+}
+
+static char erasehelp[] = "erase partition\n"
+"Erase <partition> region of flash\n";
+
+__commandlist(Erase, "erase", erasehelp);
Index: build_tree/bootLoader/src/blob/flash.c
diff -u build_tree/bootLoader/src/blob/flash.c:1.1.1.1 build_tree/bootLoader/src/blob/flash.c:1.1.1.3
--- build_tree/bootLoader/src/blob/flash.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/flash.c	Fri Nov  9 10:37:08 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      flash.c
- * Version:       $Id: flash.c,v 1.11 2002/01/03 16:07:17 erikm Exp $
+ * Version:       $Id: flash.c,v 1.19 2003/01/24 09:26:00 choover Exp $
  * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
  * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
  * Description:   Flash I/O functions for blob
@@ -30,25 +30,25 @@
  *
  */
 
-#ident "$Id: flash.c,v 1.11 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: flash.c,v 1.19 2003/01/24 09:26:00 choover Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
 #include <blob/arch.h>
+#include <blob/debug.h>
 #include <blob/errno.h>
 #include <blob/error.h>
 #include <blob/led.h>
 #include <blob/util.h>
-#include <blob/serial.h>
 #include <blob/flash.h>
 
 #include <blob/init.h>
 #include <blob/command.h>
 
 
-/* this is enough for a 16MB flash with 128kB blocks */
+/* this is enough for a 4MB flash with 32kB blocks */
 #define NUM_FLASH_BLOCKS	(128)
 
 
@@ -62,12 +62,10 @@
 static flash_block_t flash_blocks[NUM_FLASH_BLOCKS];
 static int num_flash_blocks;
 
-flash_descriptor_t *flash_descriptors;
+const flash_descriptor_t *flash_descriptors;
 flash_driver_t *flash_driver;
 
 
-
-
 /* dummy function for enable_vpp and disable_vpp */
 int flash_dummy_ok(void)
 {
@@ -77,26 +75,49 @@
 
 
 
+/* debug function: just print out the flash map and if the blocks are
+ * locked or not
+ */
+static void print_flash_map(void)
+{
+	int i;
+
+		for(i = 0; i < num_flash_blocks; i++) {
+		u32 start = flash_blocks[i].start;
+
+		deprintf("%3i: 0x%08x @ 0x%08x (%i kb), ", 
+		       i, flash_blocks[i].size, start,
+		       flash_blocks[i].size / 1024);
+
+		if(flash_blocks[i].lockable && 
+		   flash_driver->query_block_lock) {
+			if ((flash_driver->query_block_lock)((u32 *) start))
+				deprintf("locked\n");
+			else
+				deprintf("unlocked\n");
+		} else {
+			deprintf("not lockable\n");
+		}
+	}
+}
+
 /* initialise the flash blocks table */
 static void init_flash(void)
 {
+
 	int i = 0;
 	int j;
 	u32 start = 0;
 	
-#ifdef BLOB_DEBUG
 	if(flash_descriptors == NULL) {
-		printerrprefix();
-		SerialOutputString("undefined flash_descriptors\n");
+		printf("undefined flash_descriptors\n");
 		return;
 	}
 
 	if(flash_driver == NULL) {
-		printerrprefix();
-		SerialOutputString("undefined flash_driver\n");
+		printf("undefined flash_driver\n");
 		return;
 	}
-#endif	
 
 	/* fill out missing flash driver functions */
 	if(flash_driver->enable_vpp == NULL)
@@ -105,22 +126,37 @@
 	if(flash_driver->disable_vpp == NULL)
 		flash_driver->disable_vpp = flash_dummy_ok;
 
+	if (flash_descriptors[0].num == -1) {
+		u32 *flashAddr = (u32 *) flash_descriptors[0].size;
+		flash_descriptor_t *d;
+		int rc;
+
+		if (flash_driver->query_descriptors == 0) {
+			printf("driver does not support query_descriptors\n");
+			flash_descriptors = 0;
+			return;
+		}
+
+		rc = flash_driver->query_descriptors(flashAddr, &d);
+		if (rc) {
+			printf("driver failed to query flash for descriptors\n");
+			flash_descriptors = 0;
+			return;
+		}
+
+		flash_descriptors = d;
+	}
+
 	/* initialise flash blocks table */
 	num_flash_blocks = 0;
 
 	while(flash_descriptors[i].size != 0) {
-#ifdef BLOB_DEBUG
-		SerialOutputDec(flash_descriptors[i].num);
-		SerialOutputString("x 0x");
-		SerialOutputHex(flash_descriptors[i].size);
-		SerialOutputString(", ");
 
-		if(!flash_descriptors[i].lockable)
-			SerialOutputString("not ");
-
-		SerialOutputString("lockable\n");
-#endif
+/*		if(!flash_descriptors[i].lockable)
+			printf("not ");
 
+		printf("lockable\n");
+*/
 		for(j = 0; j < flash_descriptors[i].num; j++) {
 			flash_blocks[num_flash_blocks].start = start;
 			flash_blocks[num_flash_blocks].size =
@@ -133,8 +169,7 @@
 			num_flash_blocks++;
 
 			if(num_flash_blocks >= NUM_FLASH_BLOCKS) {
-				printerrprefix();
-				SerialOutputString("not enough flash_blocks\n");
+				eprintf("not enough flash_blocks\n");
 				break;
 			}
 		}
@@ -142,29 +177,15 @@
 		i++;
 	}
 
-#ifdef BLOB_DEBUG
-	SerialOutputString("Flash map:\n");
-	for(i = 0; i < num_flash_blocks; i++) {
-		SerialOutputString("  0x");
-		SerialOutputHex(flash_blocks[i].size);
-		SerialOutputString(" @ 0x");
-		SerialOutputHex(flash_blocks[i].start);
-		SerialOutputString(" (");
-		SerialOutputDec(flash_blocks[i].size / 1024);
-		SerialOutputString(" kB), ");
-
-		if(!flash_blocks[i].lockable)
-			SerialOutputString("not ");
-
-		SerialOutputString("lockable\n");
-	}
-#endif
+	print_flash_map();
 }
 
 
 __initlist(init_flash, INIT_LEVEL_OTHER_STUFF + 1);
 
 
+
+
 int flash_erase_region(u32 *start, u32 nwords)
 {
 	u32 *cur;
@@ -174,32 +195,26 @@
 	cur = start;
 	end = start + nwords;
 
-#if BLOB_DEBUG
-	SerialOutputString(__FUNCTION__ "(): erasing 0x");
-	SerialOutputHex(nwords);
-	SerialOutputString(" (");
-	SerialOutputDec(nwords);
-	SerialOutputString(") words at 0x");
-	SerialOutputHex((u32)start);
-	serial_write('\n');
-#endif
+/* AERONIX */
+
+	printf("erasing 0x%08x (%d) words at 0x%08x\n",
+		nwords, nwords, (unsigned int)start);
 
 	flash_driver->enable_vpp();
 
+	printf("unlocking dirty block at 0x%08x\n", (u32)cur);
+			/* dirty block */
+			rv = flash_driver->unlock_block(cur);
+
 	while(cur < end) {
 		if(*cur != 0xffffffff) {
-			SerialOutputString("erasing dirty block at 0x");
-			SerialOutputHex((u32)cur);
-			serial_write('\n');
 
-			/* dirty block */
+			printf("erasing dirty block at 0x%08x\n", (u32)cur);
 			rv = flash_driver->erase(cur);
 
 			if(rv < 0) {
-				printerrprefix();
-				SerialOutputString("flash erase error at 0x");
-				SerialOutputHex((u32)cur);
-				serial_write('\n');
+				printf("flash erase error at 0x%08x\n",
+					(u32)cur);
 				flash_driver->disable_vpp();
 				return rv;
 			}
@@ -215,6 +230,22 @@
 }
 
 
+/* get the flash size
+ *
+ */
+u32 flash_get_size( void )
+{
+	int block;
+	u32 size = 0L;
+
+	for ( block=0; block<num_flash_blocks; block++ ) {
+		size += flash_blocks[block].size;
+	}
+
+	printf("\n # Blocks found = %d\n",block);
+
+	return size;
+}
 
 
 /* Write a flash region with a minimum number of erase operations.
@@ -239,21 +270,19 @@
 	u32 nscandown = 0;
 	u32 nskip = 0;
 
-#if defined BLOB_DEBUG
-	SerialOutputString(__FUNCTION__ "(): flashing 0x");
-	SerialOutputHex(nwords);
-	SerialOutputString(" (");
-	SerialOutputDec(nwords);
-	SerialOutputString(") words from 0x");
-	SerialOutputHex((u32)src);
-	SerialOutputString(" to 0x");
-	SerialOutputHex((u32)dst);
-	serial_write('\n');
-#endif
+	printf("flashing 0x%08x (%d) words from 0x%08x to 0x%08x\n",
+		nwords, nwords, (u32)src, (u32)dst);
 
 	flash_driver->enable_vpp();
 
 	while(i < nwords) {
+		/* spinner */
+		{
+			char spinner[4] = { '/','-','\\','|' };
+			if ((i & 0x3ff) == 0) {
+				dprintf("%c\r", spinner[(i >> 10) & 0x3]);
+			}
+		}
 		/* nothing to write */
 		if(dst[i] == src[i]) {
 			i++;
@@ -262,6 +291,7 @@
 		}
 
 		/* different, so write to this location */
+		rv = flash_driver->unlock_block(&dst[i]);
 		rv = flash_driver->write(&dst[i], &src[i]);
 		nwrite++;
 		
@@ -270,22 +300,21 @@
 		} else {
 			nerrors++;
 			
-			SerialOutputString("erasing at 0x");
-			SerialOutputHex((u32)&dst[i]);
-			SerialOutputString("...");
+			printf("erasing at 0x%08x...", (u32)&dst[i]);
 
-			/* erase block at current location */
+			/* unlock and erase block at current location */
+			rv = flash_driver->unlock_block(&dst[i]);
 			rv = flash_driver->erase(&dst[i]);
 			nerase++;
 			if(rv < 0) {
 				/* something is obviously wrong */
-				SerialOutputString(" error\n");
+				printf(" error\n");
 				flash_driver->disable_vpp();
 
 				return rv;
 			}
 				
-			SerialOutputString(" scanning down...");
+			printf(" scanning down...");
 
 			/* scan down until we find the first
                            non-erased location and restart writing
@@ -296,34 +325,24 @@
 				nscandown++;
 			}
 
-			SerialOutputString(" resume writing at 0x");
-			SerialOutputHex((u32)&dst[i]);
-			serial_write('\n');
+			printf(" resume writing at 0x%08x\n", (u32)&dst[i]);
 		}
 		
 		/* there is something seriously wrong if this is true */
 		if(nerrors > 2 * nwords) {
-			printerrprefix();
-			SerialOutputString("too many flash errors, probably hardware error\n");
+			eprintf("too many flash errors, probably hardware error\n");
 			flash_driver->disable_vpp();
 
 			return -EFLASHPGM;
 		}
 	}
 
-#ifdef BLOB_DEBUG
-	SerialOutputDec(nwords);
-	SerialOutputString(" words source image\n");
-	SerialOutputDec(nwrite);
-	SerialOutputString(" words written to flash\n");
-	SerialOutputDec(nskip);
-	SerialOutputString(" words skipped\n");
-	SerialOutputDec(nerase);
-	SerialOutputString(" erase operations\n");
-	SerialOutputDec(nscandown);
-	SerialOutputString(" words scanned down\n");
-	serial_write('\n');
-#endif
+
+	dprintf("%d words source image\n", nwords);
+	dprintf("%d words written to flash\n", nwrite);
+	dprintf("%d words skipped\n", nskip);
+	dprintf("%d erase operations\n", nerase);
+	dprintf("%d words scanned down\n", nscandown);
 
 	flash_driver->disable_vpp();
 
@@ -331,8 +350,6 @@
 }
 
 
-
-
 /* given an address, return the flash block index number (or negative
  * error number otherwise
  */
@@ -353,6 +370,14 @@
 }
 
 
+/* given an address, return the size of that flash block */
+int flash_get_block_size(u32 address)
+{
+	int block = find_block(address);
+	if (block == -ERANGE) 
+		return 0;
+	return flash_blocks[block].size;
+}
 
 
 /* convert address range to range of flash blocks. returns 0 on
@@ -363,13 +388,8 @@
 {
 	int sb, eib;
 
-#ifdef FLASH_DEBUG
-	SerialOutputString(__FUNCTION__ ": startAddress = 0x");
-	SerialOutputHex(startAddress);
-	SerialOutputString(", length = 0x");
-	SerialOutputHex(length);
-	SerialOutputString("\n");
-#endif
+	dprintf("startAddress = 0x%08x, length = 0x%08x\n",
+		startAddress, length);
 
 	sb = find_block(startAddress);
 	eib = find_block(startAddress + length - 1);
@@ -380,16 +400,11 @@
 	if(eib < 0)
 		return eib;
 
-#ifdef FLASH_DEBUG
-	SerialOutputString("sb: ");
-	SerialOutputDec(sb);
-	SerialOutputString(", eib: ");
-	SerialOutputDec(eib);
-	SerialOutputString("\n");
-#endif
+	dprintf("sb = %d, eib = %d\n", sb, eib);
 
-	// would be nice to warn if sb isn't at the beginning of
-	// its block or eib isn't at the very end of its block.
+	/* FIXME: would be nice to warn if sb isn't at the beginning
+	 * of its block or eib isn't at the very end of its block.
+	 */
 
 	*startBlock = sb;
 	*endInclBlock = eib;
@@ -407,18 +422,10 @@
 	int i;
 	u32 *addr;
 
-#ifdef BLOB_DEBUG
-	SerialOutputString(__FUNCTION__ "(): ");
-	if(lock == 0)
-		SerialOutputString("un");
-	
-	SerialOutputString("lock at 0x");
-	SerialOutputHex((u32)start);
-	SerialOutputString(", nwords = 0x");
-	SerialOutputHex(nwords);
-	serial_write('\n');
-#endif
-
+	dprintf("%slock at 0x%08x, nwords = 0x%08x\n",
+		lock ? "" : "un",
+		(u32)start, nwords);
+		
 	rv = address_range_to_block_range((u32) start, nwords * sizeof(u32),
 					  &sb, &eib);
 
@@ -428,10 +435,7 @@
 	/* check if it is lockable at all */
 	for(i = sb; i <= eib; i++) {
 		if(!flash_blocks[i].lockable) {
-#ifdef BLOB_DEBUG
-			printerrprefix();
-			SerialOutputString("can't (un)lock unlockable blocks\n");
-#endif
+			deprintf("can't (un)lock unlockable blocks\n");
 			return -EFLASHPGM;
 		}
 	}
@@ -448,12 +452,8 @@
 
 		if(rv < 0) {
 			flash_driver->disable_vpp();
-#ifdef BLOB_DEBUG
-			printerrprefix();
-			SerialOutputString("can't (un)lock block at 0x");
-			SerialOutputHex((u32)addr);
-			serial_write('\n');
-#endif
+			deprintf("can't (un)lock block at 0x%08x",
+				 (u32)addr);
 			return rv;
 		}
 	}
@@ -512,3 +512,44 @@
 
 	return cnt;
 }
+
+
+
+
+int flash_get_first_block_address(u32 *addr)
+{
+	if(num_flash_blocks != 0) {
+		*addr = flash_blocks[0].start;
+		return 0;
+	} else {
+		return -ERANGE;
+	}
+}
+
+
+
+
+int flash_get_next_block_address(u32* addr, u32 current)
+{
+	int i;
+	u32 new_addr;
+
+	/* first find the current flash block */
+	i = find_block(current);
+
+	/* invalid address? */
+	if(i < 0)
+		return i;
+
+	/* calculate new address and check if it is valid */
+	new_addr = flash_blocks[i].start + flash_blocks[i].size;
+	i = find_block(new_addr);
+
+	if(i < 0)
+		return i;
+
+	/* it's valid, return new address */
+	*addr = new_addr;
+
+	return 0;
+}
Index: build_tree/bootLoader/src/blob/frodo.c
diff -u /dev/null build_tree/bootLoader/src/blob/frodo.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/frodo.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,93 @@
+/*
+ * frodo.c: FRODO specific stuff
+ *
+ * Copyright (C) 2001  Abraham van der Merwe <abraham@2d3d.co.za>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: frodo.c,v 1.8 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
+
+
+
+
+/* flash descriptor for FRODO flash */
+/* 2x Intel 28F128J3A strataflash (32MB) */
+static const flash_descriptor_t frodo_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 128,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+
+
+static void init_frodo_flash_driver(void)
+{
+	flash_descriptors = frodo_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+}
+
+__initlist(init_frodo_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+
+#define RS232_ENABLE	0x00001000
+#define IDERESET		0x80
+#define IDELED			0x40
+
+static void frodo_init_hardware(void)
+{
+	u32 *bcr = (u32 *) 0x12000000;
+	u16 *ide = (u16 *) 0x40008000;
+
+	/* enable RS232 tranceiver */
+	*bcr = RS232_ENABLE;
+
+	/* switch off IDE led */
+	*ide &= ~IDELED;
+
+	/* reset the drive */
+	*ide |= IDERESET;
+	*ide &= ~IDERESET;
+
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+
+__initlist(frodo_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/gpio-pxa.S
diff -u /dev/null build_tree/bootLoader/src/blob/gpio-pxa.S:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/gpio-pxa.S	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,89 @@
+
+/*
+ * gpio-pxa.S - gpio setup for PXA architecture
+ *
+ * $Id: gpio-pxa.S,v 1.3 2003/08/07 19:46:54 abz Exp $
+ *
+ * Copyright (C) 2003 Abraham van der Merwe <abz@4dllc.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+.ident "$Id: gpio-pxa.S,v 1.3 2003/08/07 19:46:54 abz Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+
+.text
+
+.macro save, reg, value
+	ldr		r1, =\reg
+	ldr		r0, =\value
+	str		r0, [r1]
+.endm
+
+.globl gpiosetup
+gpiosetup:
+	save	GPSR0, GPSR0_VALUE
+	save	GPSR1, GPSR1_VALUE
+	save	GPSR2, GPSR2_VALUE
+#if defined(GPSR3_VALUE)
+	save	GPSR3, GPSR3_VALUE
+#endif
+
+	save	GPCR0, GPCR0_VALUE
+	save	GPCR1, GPCR1_VALUE
+	save	GPCR2, GPCR2_VALUE
+#if defined(GPCR3_VALUE)
+	save	GPCR3, GPCR3_VALUE
+#endif
+
+#if 0
+	save	GRER0, GRER0_VALUE
+	save	GRER1, GRER1_VALUE
+	save	GRER2, GRER2_VALUE
+
+	save	GFER0, GFER0_VALUE
+	save	GFER1, GFER1_VALUE
+	save	GFER2, GFER2_VALUE
+#endif
+
+	save	GPDR0, GPDR0_VALUE
+	save	GPDR1, GPDR1_VALUE
+	save	GPDR2, GPDR2_VALUE
+#if defined(GPDR3_VALUE)
+	save	GPDR3, GPDR2_VALUE
+#endif
+
+	save	GAFR0_L, GAFR0_L_VALUE
+	save	GAFR0_U, GAFR0_U_VALUE
+	save	GAFR1_L, GAFR1_L_VALUE
+	save	GAFR1_U, GAFR1_U_VALUE
+	save	GAFR2_L, GAFR2_L_VALUE
+	save	GAFR2_U, GAFR2_U_VALUE
+#if defined(GAFR3_L_VALUE) && defined(GAFR3_U_VALUE)
+	save	GAFR3_L, GAFR3_L_VALUE
+	save	GAFR3_U, GAFR3_U_VALUE
+#endif
+
+	ldr		r1, =PSSR
+	mov		r0, #PSSR_RDH
+	str		r0, [r1]
+
+	mov		pc, lr
+
Index: build_tree/bootLoader/src/blob/h3600.c
diff -u build_tree/bootLoader/src/blob/h3600.c:1.1.1.1 build_tree/bootLoader/src/blob/h3600.c:1.1.1.2
--- build_tree/bootLoader/src/blob/h3600.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/h3600.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: h3600.c,v 1.5 2002/01/03 16:07:17 erikm Exp $
+ * $Id: h3600.c,v 1.9 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: h3600.c,v 1.5 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: h3600.c,v 1.9 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,7 +29,10 @@
 
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
 
 
 
@@ -70,7 +73,7 @@
 
 /* flash descriptor for H3600 flash */
 /* 2x Intel 28F640J3A (16MB) */
-static flash_descriptor_t h3600_flash_descriptors[] =
+static const flash_descriptor_t h3600_flash_descriptors[] =
 {
 	{
 		size: 2 * 128 * 1024,
@@ -126,8 +129,11 @@
 	/* enable RS232 tranceiver */
 	h3600_set_egpio(EGPIO_H3600_RS232_ON);
 
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(h3600_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/hackkit.c
diff -u /dev/null build_tree/bootLoader/src/blob/hackkit.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/hackkit.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,126 @@
+/*
+ * hackkit.c: hackkit specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001,2002  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@eletztrick.de)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: hackkit.c,v 1.7 2003/09/04 17:39:00 russd Exp $"
+
+/**********************************************************************
+ * includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/command.h>
+#include <blob/uucodec.h>
+#include <blob/time.h>
+#include <blob/partition.h>
+#include <blob/led.h>
+
+#include <blob/arch.h>
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+/* more readable IMHO */
+#define MEM( x )        (*((u32 *)(x)))
+#define SET(reg,bit) ((reg) |= (1<<(bit)))
+#define RST(reg,bit) ((reg) &= ~(1<<(bit)))
+
+#define HKIT_DEBUG 1
+
+/**********************************************************************
+ * globals
+ */
+
+extern blob_status_t blob_status;
+
+/**********************************************************************
+ * module globals
+ */
+
+#if HKIT_DEBUG
+static int hkit_dbg = 1;
+#else
+static int hkit_dbg = 0;
+#endif
+
+/* flash descriptor for System3 flash. */
+/* hackkit uses 2x INTEL 28F128J3A-150 flashes*/
+static const flash_descriptor_t hackkit_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 128,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+/**********************************************************************
+ * static functions
+ */
+static char module_version[] = "$Id: hackkit.c,v 1.7 2003/09/04 17:39:00 russd Exp $";
+
+/*********************************************************************
+ * init_hackkit_flash - inits system 3 flash driver
+ */
+static void init_hackkit_flash_driver(void)
+{
+	flash_descriptors = hackkit_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+}
+__initlist(init_hackkit_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+/*********************************************************************
+ * hackkit_init_hardware - inits system 3 LL hardware stuff
+ */
+static void hackkit_init_hardware(void)
+{
+	/* tweak blob config */
+	blob_status.boot_delay = -1;
+	//blob_status.terminalSpeed = baud_9600;
+
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+__initlist(hackkit_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/idr.c
diff -u build_tree/bootLoader/src/blob/idr.c:1.1.1.1 build_tree/bootLoader/src/blob/idr.c:1.1.1.2
--- build_tree/bootLoader/src/blob/idr.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/idr.c	Fri Nov  9 09:44:05 2007
@@ -19,19 +19,25 @@
  *
  */
 
-#ident "$Id: idr.c,v 1.4 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: idr.c,v 1.15 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/main.h>
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/arch.h>
+#include <blob/proc/sa1111.h>
+#include <blob/led.h>
+#include <blob/time.h>
 
 /* flash descriptor for IDR flash */
 /* 1x Intel 28F128J3A strataflash (16MB) */
-static flash_descriptor_t idr_flash_descriptors[] =
+static const flash_descriptor_t idr_flash_descriptors[] =
 {
 	{
 		size: 128 * 1024,
@@ -43,6 +49,68 @@
 	},
 };
 
+static void sa1111_init()
+{
+	/* switch on clock for sa1111 */
+	GAFR |= GPIO_32_768kHz;
+	GPDR |= GPIO_32_768kHz;
+	TUCR = TUCR_3_6864MHz;
+
+	/* Now, set up the PLL and RCLK in the SA-1111: */
+	SBI_SKCR = SKCR_PLL_BYPASS | SKCR_RDYEN | SKCR_OE_EN;
+	msleep(100);
+	SBI_SKCR = SKCR_PLL_BYPASS | SKCR_RCLKEN | SKCR_RDYEN | SKCR_OE_EN;
+
+	SerialOutputString( "SA1111 ID: " );
+	SerialOutputHex( SBI_SKID );
+	SerialOutputString( "\n" );
+
+	/*
+	 * SA-1111 Register Access Bus should now be available. Clocks for
+	 * any other SA-1111 functional blocks must be enabled separately
+	 * using the SKPCR.
+	 */
+	SKPCR |= SKPCR_DCLKEN | SKPCR_PWMCLKEN;
+
+	/*
+	 * If the system is going to use the SA-1111 DMA engines, set up
+	 * the memory bus request/grant pins. Also configure the shared
+	 * memory controller on the SA-1111 (SA-1111 Developer's Manual,
+	 * section 3.2.3) and power up the DMA bus clock:
+	 */
+	GAFR |= (GPIO_MBGNT | GPIO_MBREQ);
+	GPDR |= GPIO_MBGNT;
+	GPDR &= ~GPIO_MBREQ;
+	TUCR |= TUCR_MR;
+
+	SBI_SMCR = (SMCR_DTIM | SMCR_MBGE |
+		FInsrt(FExtr(MDCNFG, MDCNFG_SA1110_DRAC0), SMCR_DRAC) |
+		((FExtr(MDCNFG, MDCNFG_SA1110_TDL0)==3) ? SMCR_CLAT : 0));
+
+	/*
+	 * flash_enable on GPIO_A2
+	 * since we are planning jffs2, flash_enable should always be set. but
+	 * there is no accounting for taste. Tim Riker <Tim@Rikers.org>
+	 */
+	PA_DDR &= ~GPIO_GPIO2;
+	PA_DWR |= GPIO_GPIO2;
+
+	/*
+	 * for debug, we turn the backlight on and off here
+	 */
+	PA_DDR &= ~GPIO_GPIO3;
+#if 0
+	/* reboots the machine, if no battery is connected */
+	PA_DWR |= GPIO_GPIO3;
+	msleep(1000);
+	PA_DWR &= ~GPIO_GPIO3;
+#endif
+}
+
+/* we still are not getting ID on serial, perhaps erik knows why */
+__initlist(sa1111_init,		INIT_LEVEL_OTHER_HARDWARE + 1);
+
+
 static void init_idr_flash_driver(void)
 {
 	flash_descriptors = idr_flash_descriptors;
@@ -54,8 +122,14 @@
 
 static void idr_init_hardware(void)
 {
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+
+	/* tweak blob config */
+	blob_status.boot_delay = 1;
 }
 
 __initlist(idr_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/in.c
diff -u /dev/null build_tree/bootLoader/src/blob/in.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/in.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,329 @@
+/*-------------------------------------------------------------------------
+ * Filename:      main.c
+ * Version:       $Id: main.c,v 1.54 2003/09/04 17:46:59 russd Exp $
+ * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
+ * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
+ * Description:   Main file for the trivially simple bootloader for the 
+ *                LART boards
+ * Created at:    Mon Aug 23 20:00:00 1999
+ * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Modified at:   Sat Mar 25 14:31:16 2000
+ *-----------------------------------------------------------------------*/
+/*
+ * main.c: main file for the blob bootloader
+ *
+ * Copyright (C) 1999 2000 2001
+ *   Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl) and
+ *   Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: main.c,v 1.54 2003/09/04 17:46:59 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/debug.h>
+#include <blob/command.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/init.h>
+#include <blob/main.h>
+#include <blob/md5.h>
+#include <blob/md5support.h>
+#include <blob/memory.h>
+#include <blob/param_block.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/util.h>
+#include <blob/load_kernel.h>
+#include <blob/partition.h>
+#include <blob/download.h>
+
+
+static void print_elf_sections(void);
+static void *find_parameters(void);
+
+
+blob_status_t blob_status;
+static char *version_str = PACKAGE " version " VERSION " for " BOARD_NAME "\n";
+
+int main(void)
+{
+	
+	int numRead = 0;
+	char commandline[MAX_COMMANDLINE_LENGTH];
+	u32 conf = 0;
+	void *params;
+
+	/* initialise status */
+	blob_status.paramType = fromFlash;
+	blob_status.kernelType = fromFlash;
+	blob_status.ramdiskType = fromFlash;
+	blob_status.downloadSpeed = baud_115200;
+	blob_status.terminalSpeed = TERMINAL_SPEED;
+	blob_status.load_ramdisk = LOAD_RAMDISK;
+	blob_status.cmdline[0] = '\0';
+	blob_status.boot_delay = 4;
+
+	/* call subsystems (blob_status.* may change) */
+	init_subsystems();
+
+	/* find parameter partition, if it exists */
+	params = find_parameters();
+
+	/* parse the core tag, for critical things like terminal speed */
+	if (params)
+		parse_ptag(params, &conf);
+
+/* call serial_init() because the default 9k6 speed might not
+           be what the user requested */
+
+	serial_init(blob_status.terminalSpeed);
+	serial_write(0x47);
+	serial_write(0x48);
+
+
+	printf("\nConsider yourself BLOBed!\n\n");
+
+	/* Print the required GPL string */
+	printf("\nConsider yourself BLOBed!\n\n");
+	printf("%sCopyright (C) 1999 2000 2001 2002 2003 "
+	       "Jan-Derk Bakker and Erik Mouw\n", version_str);
+	printf(PACKAGE " comes with ABSOLUTELY NO WARRANTY; "
+	       "read the GNU GPL for details.\n");
+	printf("This is free software, and you are welcome "
+	       "to redistribute it\n");
+	printf("under certain conditions; read the GNU GPL for details.\n");
+
+	/* get the amount of memory */
+	/* FIXME : get_memory_map doesn't work always */
+	/* get_memory_map(); */
+
+	print_elf_sections();
+
+#ifdef BLOB_DEBUG
+	{
+		register unsigned int stackptr;
+		asm("mov %0, sp": "=r" (stackptr));
+		printf("Current stack pointer: 0x%08x\n", stackptr);
+	}
+#endif
+
+	/* Load remaining parameters */
+	if (params)
+		parse_ptags(params, &conf);
+
+	/* Load kernel and ramdisk from flash to RAM */
+	do_reload("blob");
+	do_reload("kernel");
+	if(blob_status.load_ramdisk)
+		do_reload("ramdisk");
+
+	if (blob_status.boot_delay > -1) {
+		int i;
+		int retval = 0;
+
+		/* wait boot_delay seconds before starting autoboot */
+		printf("Autoboot (%i seconds) in progress, press any key to stop ",
+		       blob_status.boot_delay);
+
+
+		if (blob_status.boot_delay == 0) {
+			retval = SerialInputBlock(commandline, 1, 0); 
+		} else {
+			for(i = 0; i < blob_status.boot_delay; i++) {
+				serial_write('.');
+
+				retval = SerialInputBlock(commandline, 1, 1); 
+
+				if(retval > 0)
+					break;
+			}
+		}
+
+		/* no key was pressed, so proceed booting the kernel */
+		if(retval == 0) {
+			commandline[0] = '\0';
+			parse_command("boot");
+		}
+
+		printf("\nAutoboot aborted\n");
+		printf("Type \"help\" to get a list of commands\n");
+	}
+
+	/* the command loop. endless, of course */
+	for(;;) {
+		DisplayPrompt(NULL);
+
+		/* wait 10 minutes for a command */
+		numRead = GetCommand(commandline, MAX_COMMANDLINE_LENGTH, 600);
+
+		if(numRead > 0) {
+			int retval;
+
+			if((retval = parse_command(commandline)) < 0 )
+				printerror(retval, NULL);
+		}
+	}
+
+	return 0;
+} /* main */
+
+
+
+static int PrintStatus(int argc, char *argv[])
+{
+	printf(version_str);
+
+	printf("Download speed      : ");
+	PrintSerialSpeed(blob_status.downloadSpeed);
+	printf(" baud\n");
+
+	printf("Terminal speed      : ");
+	PrintSerialSpeed(blob_status.terminalSpeed);
+	printf(" baud\n");
+
+	printf("blob    (0x%08x): ", BLOB_FLASH_BASE);
+	if(blob_status.blobType == fromFlash) {
+		printf("from flash\n");
+	} else {
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       BLOB_RAM_BASE, blob_status.blobSize);
+#ifdef CONFIG_MD5_SUPPORT
+		printf("                      MD5: ");
+		print_md5_digest(blob_status.blob_md5_digest);
+		printf("\n");
+#endif
+	}
+
+#ifdef PARAM_FLASH_BASE
+	printf("param  (0x%08x): ", PARAM_FLASH_BASE);
+	if(blob_status.paramType == fromFlash) {
+		printf("from flash\n");
+	} else {
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       PARAM_RAM_BASE, blob_status.paramSize);
+#ifdef CONFIG_MD5_SUPPORT
+		printf("                      MD5: ");
+		print_md5_digest(blob_status.param_md5_digest);
+		printf("\n");
+#endif
+	}
+#else
+	printf("param               : Not available\n");
+#endif
+
+#ifdef KERNEL_FLASH_BASE
+	printf("kernel  (0x%08x): ", KERNEL_FLASH_BASE);
+	if(blob_status.kernelType == fromFlash) {
+		printf("from flash\n");
+	} else {
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       KERNEL_RAM_BASE, blob_status.kernelSize);
+#ifdef CONFIG_MD5_SUPPORT
+		printf("                      MD5: ");
+		print_md5_digest(blob_status.kernel_md5_digest);
+		printf("\n");
+#endif
+	}
+#endif
+
+#ifdef RAMDISK_FLASH_BASE
+	printf("ramdisk (0x%08x): ", RAMDISK_FLASH_BASE);
+	if(blob_status.ramdiskType == fromFlash) {
+		printf("from flash\n");
+	} else {
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       RAMDISK_RAM_BASE, blob_status.ramdiskSize);
+#ifdef CONFIG_MD5_SUPPORT
+		printf("                      MD5: ");
+		print_md5_digest(blob_status.ramdisk_md5_digest);
+		printf("\n");
+#endif
+	}
+#endif
+	
+	return 0;
+}
+
+static char statushelp[] = "status\n"
+"Display current status\n";
+
+__commandlist(PrintStatus, "status", statushelp);
+
+
+
+
+static int Reload(int argc, char *argv[])
+{
+	if(argc < 2)
+		return -ENOPARAMS;
+
+	return do_reload(argv[1]);
+}
+
+static char reloadhelp[] = "reload {blob|param|kernel|ramdisk}\n"
+"Reload <argument> from flash to RAM\n";
+
+__commandlist(Reload, "reload", reloadhelp);
+
+
+
+static void print_elf_sections(void)
+{
+#ifdef BLOB_DEBUG
+	extern u32 __text_start, __text_end;
+	extern u32 __rodata_start, __rodata_end;
+	extern u32 __data_start, __data_end;
+	extern u32 __got_start, __got_end;
+	extern u32 __commandlist_start, __commandlist_end;
+	extern u32 __initlist_start, __initlist_end;
+	extern u32 __exitlist_start, __exitlist_end;
+	extern u32 __ptagtable_begin, __ptagtable_end;
+	extern u32 __bss_start, __bss_end;
+	extern u32 __stack_start, __stack_end;
+
+	printf("ELF sections layout:\n");
+
+#define PRINT_ELF_SECTION(from, to, name) \
+	printf("  0x%08x - 0x%08x  %s\n", \
+	       (unsigned int)&(from), \
+	       (unsigned int)&(to), \
+	       name);
+
+	PRINT_ELF_SECTION(__text_start, __text_end, ".text");
+	PRINT_ELF_SECTION(__rodata_start, __rodata_end, ".rodata");
+	PRINT_ELF_SECTION(__data_start, __data_end, ".data");
+	PRINT_ELF_SECTION(__got_start, __got_end, ".got");
+	PRINT_ELF_SECTION(__commandlist_start, __commandlist_end, ".commandlist");
+	PRINT_ELF_SECTION(__initlist_start, __initlist_end, ".initlist");
+	PRINT_ELF_SECTION(__exitlist_start, __exitlist_end, ".exitlist");
+	PRINT_ELF_SECTION(__ptagtable_begin, __ptagtable_end, ".ptaglist");
+	PRINT_ELF_SECTION(__bss_start, __bss_end, ".bss");
+	PRINT_ELF_SECTION(__stack_start, __stack_end, ".stack (in .bss)");
+#endif
+}
+
+static void *find_parameters(void) 
+{
+	const blob_partition_t *p = pt_find_by_name("param");
+
+	return p ? pt_flash_start(p) : NULL;
+}
Index: build_tree/bootLoader/src/blob/initcalls.c
diff -u build_tree/bootLoader/src/blob/initcalls.c:1.1.1.1 build_tree/bootLoader/src/blob/initcalls.c:1.1.1.3
--- build_tree/bootLoader/src/blob/initcalls.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/initcalls.c	Fri Nov  9 10:37:08 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: initcalls.c,v 1.3 2002/01/03 16:07:17 erikm Exp $
+ * $Id: initcalls.c,v 1.7 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,38 +21,37 @@
  *
  */
 
-#ident "$Id: initcalls.c,v 1.3 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: initcalls.c,v 1.7 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/arch.h>
 #include <blob/init.h>
 #include <blob/icache.h>
 #include <blob/led.h>
 #include <blob/serial.h>
 #include <blob/time.h>
-
-
-
+#include <blob/gio_drivers.h>
 
 /* default serial initialisation */
 static void serial_default_init(void)
 {
-	serial_init(baud_9600);
+	serial_init(TERMINAL_SPEED);
 }
 
-
-
-
 /* init calls */
 __initlist(serial_default_init,	INIT_LEVEL_INITIAL_HARDWARE);
 __initlist(enable_icache,	INIT_LEVEL_INITIAL_HARDWARE);
-__initlist(led_init,		INIT_LEVEL_INITIAL_HARDWARE);
-__initlist(TimerInit,		INIT_LEVEL_OTHER_HARDWARE);
-
-
+// __initlist(led_init,		INIT_LEVEL_INITIAL_HARDWARE);
+__initlist(timer_init,		INIT_LEVEL_OTHER_HARDWARE);
 
+#if defined( CONFIG_GIO_SUPPORT )
+__initlist(init_flash_io, INIT_LEVEL_OTHER_STUFF + 2);
+__initlist(init_part_io, INIT_LEVEL_OTHER_STUFF + 2);
+__initlist(init_ram_io, INIT_LEVEL_OTHER_STUFF + 2);
+#endif
 
 /* exit calls */
 __exitlist(disable_icache,	INIT_LEVEL_INITIAL_HARDWARE);
Index: build_tree/bootLoader/src/blob/intel16.c
diff -u build_tree/bootLoader/src/blob/intel16.c:1.1.1.1 build_tree/bootLoader/src/blob/intel16.c:1.1.1.3
--- build_tree/bootLoader/src/blob/intel16.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/intel16.c	Fri Nov  9 10:37:08 2007
@@ -1,5 +1,5 @@
-/*
- * intel16.c: Intel 16 bit flash driver
+ /*
+ * intel16: Intel 16 bit flash driver
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  * Copyright (C) 1999  Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl)
@@ -20,7 +20,7 @@
  *
  */
 
-#ident "$Id: intel16.c,v 1.4 2002/01/03 16:07:17 erikm Exp $"
+#ident "$Id: intel16.c,v 1.9 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -30,7 +30,8 @@
 #include <blob/flash.h>
 #include <blob/util.h>
 #include <blob/serial.h>
-
+#include <blob/time.h>
+#include <blob/debug.h>
 
 /* flash commands for a single 16 bit intel flash chip */
 #define READ_ARRAY		0x000000FF
@@ -39,9 +40,15 @@
 #define	PGM_SETUP		0x00000040
 #define	STATUS_READ		0x00000070
 #define	STATUS_CLEAR		0x00000050
-#define STATUS_BUSY		0x00000080
+#define READ_QUERY		0x00000098
+
+#define STATUS_READY		0x00000080
+#define STATUS_ERASE_SUSP	0x00000040
 #define STATUS_ERASE_ERR	0x00000020
 #define STATUS_PGM_ERR		0x00000010
+#define STATUS_VPPLOW_ERR	0x00000008
+#define STATUS_PGM_SUSP		0x00000004
+#define STATUS_LOCKED_ERR	0x00000002
 
 #define CONFIG_SETUP		0x00000060
 #define LOCK_SECTOR		0x00000001
@@ -50,15 +57,86 @@
 #define LOCK_STATUS_LOCKED	0x00000001
 #define LOCK_STATUS_LOCKEDDOWN	0x00000002
 
+#define WRITE_ERROR_MASK \
+  (STATUS_PGM_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
+#define ERASE_ERROR_MASK \
+  (STATUS_ERASE_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
+#define LOCK_ERROR_MASK \
+  (STATUS_PGM_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
+#define CONFIG_ERROR_MASK \
+  (STATUS_ERASE_ERR|STATUS_PGM_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
 
+#define FLASH_TIMEOUT (20)
 
-
-static int do_erase(u16 *addr)
+static int get_status(u16 *addr)
 {
-	u16 result;
+	u32 start, end;
+
+	start = timer_read();
+	end = start + (FLASH_TIMEOUT * timer_tps());
+
+	for (;;) {
+		u16 status;
+
+		status = *addr;
+		barrier();
+
+		if ((status & STATUS_READY) == STATUS_READY)
+			return status;
+
+		if (timer_read() >= end)
+			return -1;
+	}
+}
 
+static void clear_status(u16 *addr)
+{
 	*addr = STATUS_CLEAR;
 	barrier();
+}
+
+static void print_flash_error(const char *what, u16 *addr, int status)
+{
+	serial_write('\n');
+	SerialOutputString(what);
+	SerialOutputString(" failed for address 0x");
+	SerialOutputHex((u32) addr);
+	serial_write('\n');
+
+	SerialOutputString("  status = 0x");
+	SerialOutputHex(status);
+	serial_write('\n');
+
+	if (status < 0) {
+		SerialOutputString("  { timeout fetching status }");
+	} else {
+		SerialOutputString("  { ");
+
+#define PRINT(x) \
+  if (status & x) SerialOutputString(#x " ")
+
+		PRINT(STATUS_READY);
+		PRINT(STATUS_ERASE_SUSP);
+		PRINT(STATUS_ERASE_ERR);
+		PRINT(STATUS_PGM_ERR);
+		PRINT(STATUS_VPPLOW_ERR);
+		PRINT(STATUS_PGM_SUSP);
+		PRINT(STATUS_LOCKED_ERR);
+
+#undef PRINT
+
+		serial_write('}');
+	}
+	
+	SerialOutputString("\n\n");
+}
+
+/* erases a flash block at the given address */
+static int do_erase(u16 *addr)
+{
+	int status;
+
+	clear_status(addr);
 
 	/* prepare for erase */
 	*addr = ERASE_SETUP;
@@ -68,41 +146,27 @@
 	*addr = ERASE_CONFIRM;
 	barrier();
 
-	/* status check */
-	do {
-		*addr = STATUS_READ;
-		barrier();
-		result = *addr;
-		barrier();
-	} while((~result & STATUS_BUSY) != 0);
+	status = get_status(addr);
 
 	/* put flash back into Read Array mode */
 	*addr = READ_ARRAY;
 	barrier();
 
-	if((result & STATUS_ERASE_ERR) != 0) {
-#ifdef BLOB_DEBUG
-		SerialOutputString(__FUNCTION__ " failed, result=0x");
-		SerialOutputHex(result);
-		SerialOutputString(", addr=0x");
-		SerialOutputHex((u32) addr);
-		serial_write('\n');
-#endif
+	if ((status < 0) ||
+	    ((status & ERASE_ERROR_MASK) != 0)) {
+		print_flash_error(__FUNCTION__, addr, status);
 		return -EFLASHERASE;
 	}
 
 	return 0;
 }
 
-
-
-
+/* write a flash block at a given location */
 static int do_write(u16 *dst, const u16* src)
 {
-	u16 result;
+	int status;
 
-	*dst = STATUS_CLEAR;
-	barrier();
+	clear_status(dst);
 
 	/* setup flash for writing */
 	*dst = PGM_SETUP;
@@ -113,39 +177,27 @@
 	barrier();
 
 	/* status check */
-	do {
-		*dst = STATUS_READ;
-		barrier();
-
-		result = *dst;
-		barrier();
-	} while((~result & STATUS_BUSY) != 0);
+	status = get_status(dst);
 
 	/* put flash back into Read Array mode */
 	*dst = READ_ARRAY;
 	barrier();
 
-	if(((result & STATUS_PGM_ERR) != 0) || (*dst != *src)) {
-#ifdef BLOB_DEBUG
-		SerialOutputString(__FUNCTION__ " failed, result=0x");
-		SerialOutputHex(result);
-		SerialOutputString(", dst=0x");
-		SerialOutputHex((u32) dst);
-		SerialOutputString(", *dst=0x");
-		SerialOutputHex(*dst);
-		SerialOutputString(", *src=0x");
-		SerialOutputHex(*src);
-		serial_write('\n');
+	if ((status < 0) || 
+	    ((status & WRITE_ERROR_MASK) != 0) ||
+	    (*dst != *src)) {
+#ifdef FLASH_DEBUG
+		/* this often fails because we need to erase, so
+		   don't be noisy about it */
+		print_flash_error(__FUNCTION__, dst, status);
 #endif
 		return -EFLASHPGM;
 	}
-	
+		
 	return 0;
 }
 
 
-
-
 /* erases a flash block at the given address */
 /* we have to break this up in two erases at 16 bit aligned addresses
  * (if necessary)
@@ -172,8 +224,6 @@
 }
 
 
-
-
 /* write a flash block at a given location */
 /* this has to be broken up into two consectutive 16 bit writes */
 static int flash_write_intel16(u32 *dst, const u32* src)
@@ -196,118 +246,152 @@
 	return 0;
 }
 
-
-
-
 static int flash_lock_block_intel16(u32 *blockStart)
 {
 	u16 *p = (u16 *) blockStart;
-	u16 result;
+	int status;
 
-	*p = STATUS_CLEAR;
-	barrier();
+	clear_status(p);
 
 	*p = CONFIG_SETUP;
 	barrier();
 	*p = LOCK_SECTOR;
 	barrier();
 
-	/* status check */
-	*p = STATUS_READ;
-	barrier();
-
-	result = *p;
-	barrier();
+	status = get_status(p);
 
 	*p = READ_ARRAY;
 	barrier();
 
-	if ((result & STATUS_PGM_ERR) != 0) {
-#ifdef BLOB_DEBUG
-		SerialOutputString(__FUNCTION__ " failed at 0x");
-		SerialOutputHex((u32) blockStart);
-		SerialOutputString(", status=0x");
-		SerialOutputHex((u32) result);
-		serial_write('\n');
-#endif
-		return -EFLASHPGM;
+	if ((status < 0) ||
+	    ((status & LOCK_ERROR_MASK) != 0)) {
+		print_flash_error(__FUNCTION__, p, status);
+		return status;
 	}
 
 	return 0;
 }
 
-
-
-
 static int flash_unlock_block_intel16(u32 *blockStart)
 {
 	u16 *p = (u16 *) blockStart;
-	u16 result;
+	int status;
 
-	*p = STATUS_CLEAR;
-	barrier();
+	clear_status(p);
 
 	*p = CONFIG_SETUP;
 	barrier();
 	*p = UNLOCK_SECTOR;
 	barrier();
 
-	/* status check */
-	*p = STATUS_READ;
-	barrier();
-
-	result = *p;
-	barrier();
+	status = get_status(p);
 
 	*p = READ_ARRAY;
 	barrier();
 
-	if ((result & STATUS_PGM_ERR) != 0) {
-#ifdef BLOB_DEBUG
-		SerialOutputString(__FUNCTION__ " failed at 0x");
-		SerialOutputHex((u32) blockStart);
-		SerialOutputString(", status=0x");
-		SerialOutputHex((u32) result);
-		serial_write('\n');
-#endif
-		return -EFLASHPGM;
+
+	if ((status < 0) ||
+	    ((status & CONFIG_ERROR_MASK) != 0)) {
+		print_flash_error(__FUNCTION__, p, status);
+		return status;
 	}
 
 	return 0;
 }
 
-
-
-
 static int flash_query_block_lock_intel16(u32 *blockStart)
 {
 	u16 *p = (u16 *) blockStart;
 	u16 result;
 
+	clear_status(p);
+
 	*p = READ_CONFIG;
 	barrier();
 	result = *(p + 2);
 	barrier();
 
-	*blockStart = READ_ARRAY;
+	*p = READ_ARRAY;
 	barrier();
 
-#ifdef BLOB_DEBUG
-	SerialOutputString(__FUNCTION__ ": status of block starting at 0x");
+#ifdef FLASH_DEBUG
+	SerialOutputString(__FUNCTION__ ": lock status of block starting at 0x");
 	SerialOutputHex((u32) blockStart);
 	SerialOutputString(": 0x");
 	SerialOutputHex((u32) result);
-	serial_write('\n');
+	SerialOutputString("\n");
 #endif
 
-	return result & (LOCK_STATUS_LOCKED | LOCK_STATUS_LOCKEDDOWN);
+	return ((result & (LOCK_STATUS_LOCKED|LOCK_STATUS_LOCKEDDOWN)) != 0);
+}
+
+
+/* automatic descriptor support */
+
+#define MAX_AUTO_DESCRIPTORS 4
+static flash_descriptor_t auto_descriptors[MAX_AUTO_DESCRIPTORS + 1];
+
+static int flash_query_descriptors_intel16(u32 *flashAddr, 
+					   flash_descriptor_t **out)
+{
+	u16 *addr = (u16 *) flashAddr;
+	int result, nregions, n;
+
+	addr[0x55] = READ_QUERY;
+	barrier();
+	
+	if (addr[0x10] != 'Q' && addr[0x11] != 'R' && addr[0x12] != 'Y') {
+		result = -EINVAL;
+		goto out;
+	}
+
+	dprintf("intel16: manuf_code = %02X\n", addr[CFI_MANUF_CODE]);
+	dprintf("intel16: device code = %02X\n", addr[CFI_DEVICE_CODE]);
+	dprintf("intel16: device size = 2^%d bytes\n", addr[CFI_DEVICE_SIZE_LG2]);
+
+	nregions = addr[CFI_ERASE_REGION_COUNT];
+
+#define READ_U16LE(off)   ((addr[(off)]) | (addr[(off) + 1]<<8))
+
+	for (n = 0; n < nregions && n < MAX_AUTO_DESCRIPTORS; n++) {
+		u32 xcount = READ_U16LE(CFI_ERASE_REGION_XBLKS(n));
+		u32 count = xcount + 1;
+		u32 xsize = READ_U16LE(CFI_ERASE_REGION_XSIZE(n));
+		u32 size = (xsize == 0) ? 128 : xsize * 256;
+		
+		dprintf("intel16: erase region #%d\n", n);
+		dprintf("intel16:   count = %d\n", count);
+		dprintf("intel16:   size  = %d\n", size);
+
+		auto_descriptors[n].size = size;
+		auto_descriptors[n].num = count;
+		auto_descriptors[n].lockable = 1; /* fix me */
+	}
+
+#undef READ_U16LE
+
+	auto_descriptors[n].size = 0;
+	auto_descriptors[n].num = 0;
+
+	*out = auto_descriptors;
+	result = 0;
+
+out:
+	/* put flash back into Read Array mode */
+	barrier();
+
+	*addr = READ_ARRAY;
+	barrier();
+	
+	return result;
 }
 
 /* flash driver structure */
 flash_driver_t intel16_flash_driver = {
-	erase:			flash_erase_intel16,
-	write:			flash_write_intel16,
-	lock_block:		flash_lock_block_intel16,
-	unlock_block:		flash_unlock_block_intel16,
-	query_block_lock:	flash_query_block_lock_intel16
+	.erase =		flash_erase_intel16,
+	.write =		flash_write_intel16,
+	.lock_block = 		flash_lock_block_intel16,
+	.unlock_block = 	flash_unlock_block_intel16,
+	.query_block_lock = 	flash_query_block_lock_intel16,
+	.query_descriptors =	flash_query_descriptors_intel16
 };
Index: build_tree/bootLoader/src/blob/intel32.c
diff -u build_tree/bootLoader/src/blob/intel32.c:1.1.1.1 build_tree/bootLoader/src/blob/intel32.c:1.1.1.2
--- build_tree/bootLoader/src/blob/intel32.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/intel32.c	Fri Nov  9 09:44:05 2007
@@ -20,7 +20,7 @@
  *
  */
 
-#ident "$Id: intel32.c,v 1.4 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: intel32.c,v 1.7 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -30,7 +30,7 @@
 #include <blob/flash.h>
 #include <blob/util.h>
 #include <blob/serial.h>
-
+#include <blob/time.h>
 
 /* flash commands for two 16 bit intel flash chips */
 #define READ_ARRAY		0x00FF00FF
@@ -39,9 +39,14 @@
 #define	PGM_SETUP		0x00400040
 #define	STATUS_READ		0x00700070
 #define	STATUS_CLEAR		0x00500050
-#define STATUS_BUSY		0x00800080
+
+#define STATUS_READY		0x00800080
+#define STATUS_ERASE_SUSP	0x00400040
 #define STATUS_ERASE_ERR	0x00200020
 #define STATUS_PGM_ERR		0x00100010
+#define STATUS_VPPLOW_ERR	0x00080008
+#define STATUS_PGM_SUSP		0x00040004
+#define STATUS_LOCKED_ERR	0x00020002
 
 #define CONFIG_SETUP		0x00600060
 #define LOCK_SECTOR		0x00010001
@@ -50,16 +55,86 @@
 #define LOCK_STATUS_LOCKED	0x00010001
 #define LOCK_STATUS_LOCKEDDOWN	0x00020002
 
+#define WRITE_ERROR_MASK \
+  (STATUS_PGM_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
+#define ERASE_ERROR_MASK \
+  (STATUS_ERASE_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
+#define LOCK_ERROR_MASK \
+  (STATUS_PGM_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
+#define CONFIG_ERROR_MASK \
+  (STATUS_ERASE_ERR|STATUS_PGM_ERR|STATUS_VPPLOW_ERR|STATUS_LOCKED_ERR)
+
+#define FLASH_TIMEOUT (20)
+
+static int get_status(u32 *addr)
+{
+	u32 start, end;
+
+	start = timer_read();
+	end = start + (FLASH_TIMEOUT * timer_tps());
+
+	for (;;) {
+		u32 status;
+
+		status = data_from_flash(*addr);
+		barrier();
+
+		if ((status & STATUS_READY) == STATUS_READY)
+			return status;
 
+		if (timer_read() >= end)
+			return -1;
+	}
+}
 
+static void clear_status(u32 *addr)
+{
+	*addr = data_to_flash(STATUS_CLEAR);
+	barrier();
+}
+
+static void print_flash_error(const char *what, u32 *addr, int status)
+{
+	serial_write('\n');
+	SerialOutputString(what);
+	SerialOutputString(" failed for address 0x");
+	SerialOutputHex((u32) addr);
+	serial_write('\n');
+
+	SerialOutputString("  status = 0x");
+	SerialOutputHex(status);
+	serial_write('\n');
+
+	if (status < 0) {
+		SerialOutputString("  { timeout fetching status }");
+	} else {
+		SerialOutputString("  { ");
+
+#define PRINT(x) \
+  if (status & x) SerialOutputString(#x " ")
+
+		PRINT(STATUS_READY);
+		PRINT(STATUS_ERASE_SUSP);
+		PRINT(STATUS_ERASE_ERR);
+		PRINT(STATUS_PGM_ERR);
+		PRINT(STATUS_VPPLOW_ERR);
+		PRINT(STATUS_PGM_SUSP);
+		PRINT(STATUS_LOCKED_ERR);
+
+#undef PRINT
+
+		serial_write('}');
+	}
+	
+	SerialOutputString("\n\n");
+}
 
 /* erases a flash block at the given address */
 static int flash_erase_intel32(u32 *addr)
 {
-	u32 result;
+	u32 status;
 
-	*addr = data_to_flash(STATUS_CLEAR);
-	barrier();
+	clear_status(addr);
 
 	/* prepare for erase */
 	*addr = data_to_flash(ERASE_SETUP);
@@ -69,41 +144,27 @@
 	*addr = data_to_flash(ERASE_CONFIRM);
 	barrier();
 
-	/* status check */
-	do {
-		*addr = data_to_flash(STATUS_READ);
-		barrier();
-		result = data_from_flash(*addr);
-		barrier();
-	} while((~result & STATUS_BUSY) != 0);
+	status = get_status(addr);
 
 	/* put flash back into Read Array mode */
 	*addr = data_to_flash(READ_ARRAY);
 	barrier();
 
-	if((result & STATUS_ERASE_ERR) != 0) {
-#ifdef BLOB_DEBUG
-		SerialOutputString(__FUNCTION__ " failed, result=0x");
-		SerialOutputHex(result);
-		SerialOutputString(", addr=0x");
-		SerialOutputHex((u32) addr);
-		serial_write('\n');
-#endif
+	if ((status < 0) ||
+	    ((status & ERASE_ERROR_MASK) != 0)) {
+		print_flash_error(__FUNCTION__, addr, status);
 		return -EFLASHERASE;
 	}
 
 	return 0;
 }
 
-
-
 /* write a flash block at a given location */
 static int flash_write_intel32(u32 *dst, const u32* src)
 {
-	u32 result;
+	u32 status;
 
-	*dst = data_to_flash(STATUS_CLEAR);
-	barrier();
+	clear_status(dst);
 
 	/* setup flash for writing */
 	*dst = data_to_flash(PGM_SETUP);
@@ -114,119 +175,82 @@
 	barrier();
 
 	/* status check */
-	do {
-		*dst = data_to_flash(STATUS_READ);
-		barrier();
-
-		result = data_from_flash(*dst);
-		barrier();
-	} while((~result & STATUS_BUSY) != 0);
+	status = get_status(dst);
 
 	/* put flash back into Read Array mode */
 	*dst = data_to_flash(READ_ARRAY);
 	barrier();
 
-	if(((result & STATUS_PGM_ERR) != 0) || (*dst != *src)) {
-#ifdef BLOB_DEBUG
-		SerialOutputString(__FUNCTION__ "failed, result=0x");
-		SerialOutputHex(result);
-		SerialOutputString(", addr=0x");
-		SerialOutputHex((u32) dst);
-		serial_write('\n');
+	if ((status < 0) || 
+	    ((status & WRITE_ERROR_MASK) != 0) ||
+	    (*dst != *src)) {
+#ifdef FLASH_DEBUG
+		/* this often fails because we need to erase, so
+		   don't be noisy about it */
+		print_flash_error(__FUNCTION__, dst, status);
 #endif
 		return -EFLASHPGM;
 	}
-	
+		
 	return 0;
 }
 
-
-
-
 static int flash_lock_block_intel32(u32 *blockStart)
 {
-	u32 result;
+	u32 status;
 
-	*blockStart = data_to_flash(STATUS_CLEAR);
-	barrier();
+	clear_status(blockStart);
 
 	*blockStart = data_to_flash(CONFIG_SETUP);
 	barrier();
 	*blockStart = data_to_flash(LOCK_SECTOR);
 	barrier();
 
-	*blockStart = data_to_flash(READ_ARRAY);
-	barrier();
-
-	/* status check */
-	*blockStart = data_to_flash(STATUS_READ);
-	barrier();
-
-	result = data_from_flash(*blockStart);
-	barrier();
+	status = get_status(blockStart);
 
 	*blockStart = data_to_flash(READ_ARRAY);
 	barrier();
 
-	if ((result & STATUS_PGM_ERR) != 0) {
-#ifdef FLASH_DEBUG
-		SerialOutputString(__FUNCTION__ " failed at 0x");
-		SerialOutputHex((u32) blockStart);
-		SerialOutputString(", status=0x");
-		SerialOutputHex((u32) result);
-		SerialOutputByte('\n');
-#endif
-		return -EFLASHPGM;
+	if ((status < 0) ||
+	    ((status & LOCK_ERROR_MASK) != 0)) {
+		print_flash_error(__FUNCTION__, blockStart, status);
+		return status;
 	}
 
 	return 0;
 }
 
-
-
-
 static int flash_unlock_block_intel32(u32 *blockStart)
 {
-	u32 result;
+	u32 status;
 
-	*blockStart = data_to_flash(STATUS_CLEAR);
-	barrier();
+	clear_status(blockStart);
 
 	*blockStart = data_to_flash(CONFIG_SETUP);
 	barrier();
 	*blockStart = data_to_flash(UNLOCK_SECTOR);
 	barrier();
 
-	*blockStart = data_to_flash(STATUS_READ);
-	barrier();
-
-	result = data_from_flash(*blockStart);
-	barrier();
+	status = get_status(blockStart);
 
 	*blockStart = data_to_flash(READ_ARRAY);
 	barrier();
 
-	if ((result & STATUS_PGM_ERR) != 0) {
-#ifdef FLASH_DEBUG
-		SerialOutputString(__FUNCTION__ " failed at 0x");
-		SerialOutputHex((u32) blockStart);
-		SerialOutputString(", status=0x");
-		SerialOutputHex((u32) result);
-		SerialOutputByte('\n');
-#endif
-		return -EFLASHPGM;
+	if ((status < 0) ||
+	    ((status & CONFIG_ERROR_MASK) != 0)) {
+		print_flash_error(__FUNCTION__, blockStart, status);
+		return status;
 	}
 
 	return 0;
 }
 
-
-
-
 static int flash_query_block_lock_intel32(u32 *blockStart)
 {
 	u32 result;
 
+	clear_status(blockStart);
+
 	*blockStart = data_to_flash(READ_CONFIG);
 	barrier();
 	result = data_from_flash(*(blockStart + 2));
@@ -236,19 +260,18 @@
 	barrier();
 
 #ifdef FLASH_DEBUG
-	SerialOutputString(__FUNCTION__ ": status of block starting at 0x");
+	SerialOutputString(__FUNCTION__ ": lock status of block starting at 0x");
 	SerialOutputHex((u32) blockStart);
 	SerialOutputString(": 0x");
-	SerialOutputHex((u32) result);
-	SerialOutputByte('\n');
+	SerialOutputHex( result);
+	serial_write('\n');
 #endif
 
-	return result & (LOCK_STATUS_LOCKED | LOCK_STATUS_LOCKEDDOWN);
+	return ((result & (LOCK_STATUS_LOCKED|LOCK_STATUS_LOCKEDDOWN)) != 0);
 }
 
 
 
-
 /* flash driver structure */
 flash_driver_t intel32_flash_driver = {
 	erase:			flash_erase_intel32,
Index: build_tree/bootLoader/src/blob/jffs2.c
diff -u /dev/null build_tree/bootLoader/src/blob/jffs2.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/jffs2.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,391 @@
+/*
+-------------------------------------------------------------------------
+ * Filename:      jffs2.c
+ * Version:       $Id: jffs2.c,v 1.6 2003/02/11 00:02:47 erikm Exp $
+ * Copyright:     Copyright (C) 2001, Russ Dill
+ * Author:        Russ Dill <Russ.Dill@asu.edu>
+ * Description:   Module to load kernel from jffs2
+ *-----------------------------------------------------------------------*/
+/*
+ * some portions of this code are taken from jffs2, and as such, the
+ * following copyright notice is included.
+ *
+ * JFFS2 -- Journalling Flash File System, Version 2.
+ *
+ * Copyright (C) 2001 Red Hat, Inc.
+ *
+ * Created by David Woodhouse <dwmw2@cambridge.redhat.com>
+ *
+ * The original JFFS, from which the design for JFFS2 was derived,
+ * was designed and implemented by Axis Communications AB.
+ *
+ * The contents of this file are subject to the Red Hat eCos Public
+ * License Version 1.1 (the "Licence"); you may not use this file
+ * except in compliance with the Licence.  You may obtain a copy of
+ * the Licence at http://www.redhat.com/
+ *
+ * Software distributed under the Licence is distributed on an "AS IS"
+ * basis, WITHOUT WARRANTY OF ANY KIND, either express or implied.
+ * See the Licence for the specific language governing rights and
+ * limitations under the Licence.
+ *
+ * The Original Code is JFFS2 - Journalling Flash File System, version 2
+ *
+ * Alternatively, the contents of this file may be used under the
+ * terms of the GNU General Public License version 2 (the "GPL"), in
+ * which case the provisions of the GPL are applicable instead of the
+ * above.  If you wish to allow the use of your version of this file
+ * only under the terms of the GPL and not to allow others to use your
+ * version of this file under the RHEPL, indicate your decision by
+ * deleting the provisions above and replace them with the notice and
+ * other provisions required by the GPL.  If you do not delete the
+ * provisions above, a recipient may use your version of this file
+ * under either the RHEPL or the GPL.
+ *
+ * $Id: jffs2.c,v 1.6 2003/02/11 00:02:47 erikm Exp $
+ *
+ */
+
+/* Ok, so anyone who knows the jffs2 code will probably want to get a papar
+ * bag to throw up into before reading this code. I looked through the jffs2
+ * code, the caching scheme is very elegant. I tried to keep the version
+ * for a bootloader as small and simple as possible. Instead of worring about
+ * unneccesary data copies, node scans, etc, I just optimized for the known
+ * common case, a kernel, which looks like:
+ * 	(1) most pages are 4096 bytes
+ *	(2) version numbers are somewhat sorted in acsending order
+ *	(3) multiple compressed blocks making up one page is uncommon
+ *
+ * So I create a linked list of decending version numbers (insertions at the
+ * head), and then for each page, walk down the list, until a matching page
+ * with 4096 bytes is found, and then decompress the watching pages in
+ * reverse order.
+ *
+ */
+
+#ident "$Id: jffs2.c,v 1.6 2003/02/11 00:02:47 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/crc32.h>
+#include <blob/compr_rubin.h>
+#include <blob/jffs2.h>
+#include <blob/load_kernel.h>
+#include <blob/main.h>
+#include <blob/mini_inflate.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+
+
+static struct jffs2_raw_dirent *find_inode(struct part_info *part, char *name,
+					   u32 pino);
+extern void rtime_decompress(unsigned char *data_in, unsigned char *cpage_out, 
+			     u32 srclen, u32 destlen);
+
+
+struct data_strip {
+	struct jffs2_raw_inode *inode;
+	long int version;
+	long int page;
+	long int length;
+	struct data_strip *next;
+};
+
+
+static inline void zlib_decompress(unsigned char *data_in,
+				   unsigned char *cpage_out,
+				   u32 srclen, u32 destlen)
+{
+	/* FIXME: we *totally* ignore the srclen and destlen
+	 * parameters over here -- Erik */
+	decompress_block(cpage_out, data_in + 2);
+}
+
+
+static int hdr_crc(struct jffs2_unknown_node *node)
+{
+	if(node->hdr_crc != crc32(0, node, sizeof(struct jffs2_unknown_node) - 4))
+		return 0;
+	else return 1;
+}
+
+static int dirent_crc(struct jffs2_raw_dirent *node)
+{
+	if (node->node_crc != crc32(0, node, sizeof(struct jffs2_raw_dirent) - 8)) {
+		UDEBUG("bad dirent_crc\n");
+		return 0;
+	} else return 1;
+}
+
+static int dirent_name_crc(struct jffs2_raw_dirent *node)
+{
+	if (node->name_crc != crc32(0, &(node->name), node->nsize)) {
+		UDEBUG("bad dirent_name_crc\n");
+		return 0;
+	} else return 1;
+}
+
+static int inode_crc(struct jffs2_raw_inode *node)
+{
+	if (node->node_crc != crc32(0, node, sizeof(struct jffs2_raw_inode) - 8)) {
+		UDEBUG("bad inode_crc\n");
+		return 0;
+	} else return 1;
+}
+
+/* decompress a page from the flash, first contains a linked list of references
+ * all the nodes of this file, sorted is decending order (newest first). Return
+ * the number of total bytes decompressed (not accurate, because some strips
+ * overlap, but at least we know we decompressed something) */
+static long jffs2_uncompress_page(char *dest, struct data_strip *first, u32 page)
+{
+	int i;
+	long uncompressed = 0;
+	char *src = 0;
+
+	/* look for the next reference to this page */
+	for (; first; first = first->next) {
+		/* This might be a page to uncompress, check that its the right
+		 * page, and that the crc matches */
+		if (first->page == page) {
+			src = ((char *) first->inode) +
+			       sizeof(struct jffs2_raw_inode);
+			if (first->inode->data_crc ==
+			    crc32(0, src, first->inode->csize)) break;
+		}
+	}
+	
+	/* reached the end of the list without finding any pages */		
+	if (!first) return 0;
+	
+	/* if we aren't covering what's behind us, uncompress that first.
+	 * Note: if the resulting doesn't quite fill the order, we are in
+	 * trouble */
+	if (first->length != 4096)
+		uncompressed = jffs2_uncompress_page(dest, first->next, page);
+
+	dest += first->inode->offset;
+	switch (first->inode->compr) {
+	case JFFS2_COMPR_NONE:
+		memcpy(dest, src, first->length);
+		break;
+	case JFFS2_COMPR_ZERO:
+		for (i = 0; i < first->length; i++) *(dest++) = 0;
+		break;
+	case JFFS2_COMPR_RTIME:
+		rtime_decompress(src, dest, first->inode->csize, 
+				 first->length);
+		break;
+	case JFFS2_COMPR_DYNRUBIN:
+		dynrubin_decompress(src, dest, first->inode->csize, 
+				    first->length);
+		break;
+	case JFFS2_COMPR_ZLIB:
+		zlib_decompress(src, dest, first->inode->csize, first->length);
+		break;
+	default:
+		/* unknown, attempt to ignore the page */
+		return uncompressed;
+	}
+	return first->length + uncompressed;
+}
+
+static int jffs2_check_magic(struct part_info *part)
+{
+	unsigned long offset;
+	struct jffs2_unknown_node *node;
+
+	/* search the start of each erase block for a magic number */
+	offset = 0;
+	for (offset = 0; offset < part->size; offset += part->erasesize) {
+		node = (struct jffs2_unknown_node *) (part->offset + offset);
+		if (node->magic == JFFS2_MAGIC_BITMASK && hdr_crc(node)) return 1;
+	}
+	return 0;
+}
+
+/* read in the data for inode inode_num */
+static u32 read_inode(struct part_info *part, u32 *dest, u32 inode_num, int type)
+{
+	unsigned long size;
+	struct jffs2_raw_inode *inode;
+	unsigned long offset, inode_version, version, page;
+	struct data_strip *free, *curr, *prev, *first, *new;
+
+	free = (struct data_strip *) fodder_ram_base;
+	first = NULL;
+
+	offset = size = inode_version = 0;
+
+	/* Fill the list of nodes pertaining to this file */
+	while (offset < part->size - sizeof(struct jffs2_raw_inode)) {
+		inode = (struct jffs2_raw_inode *) (part->offset + offset); 
+		if (inode->magic == JFFS2_MAGIC_BITMASK && 
+		    hdr_crc((struct jffs2_unknown_node *)inode)) {
+			if (inode->nodetype == JFFS2_NODETYPE_INODE &&
+			    inode->ino == inode_num && inode_crc(inode)) {
+				/* add it in newest first order to our list */
+				prev = NULL;
+				curr = first;
+				version = inode->version;
+				while (curr && curr->version > version) {
+					prev = curr;
+					curr = curr->next;
+				}
+				new = free++;
+				new->version = version;
+				new->inode = inode;
+				new->page = (inode->offset / 4096);
+				new->length = inode->dsize;
+				if (!prev) {
+					new->next = first;
+					first = new;
+				} else {
+					new->next = prev->next;
+					prev->next = new;
+				} 
+				if (version > inode_version) {
+					inode_version = version;
+					size = type == DT_LNK ? inode->dsize : inode->isize;
+				}
+			}
+			offset += ((inode->totlen + 3) & ~3);
+		} else offset += 4;
+	}
+
+	if (!first) UDEBUG("could not find any nodes!\n");
+
+	for (page = 0; page <= size / 4096; page++) {
+		/* Print a '.' every 0x40000 bytes */
+		if (!(page & 0x3F)) ldr_update_progress();
+		if (!jffs2_uncompress_page((char *) dest, first, page)) {
+			UDEBUG("jffs2_uncompress_page failed on page 0x%lx\n", page);
+			return 0;
+		}
+	}
+
+	return size;
+}
+
+/* follow a symlink */
+static struct jffs2_raw_dirent *do_symlink(struct part_info *part, 
+	struct jffs2_raw_dirent *node)
+{
+	char name[JFFS2_MAX_NAME_LEN + 1];
+	unsigned long size;
+
+	UDEBUG(" finding symlink ");
+
+	/* read in the symlink */
+	if((size = read_inode(part, (u32 *) name, node->ino, DT_LNK))) {
+		name[size] = '\0';
+		UDEBUG(" '%s'\n", name);
+
+		/* if it points to /, start over at inode 1, otherwise, stay
+		 * in the same directory */
+		if (name[0] == '/') return find_inode(part, name + 1, 1);
+		else return find_inode(part, name, node->pino);
+	} else {
+		UDEBUG("could not load symlink!");
+		return NULL;
+	}
+}
+
+/* find a dirent with the name "name", and parent "pino" return NULL on 
+ * error */
+static struct jffs2_raw_dirent *find_inode(struct part_info *part, char *name,
+					   u32 pino)
+{
+	char curr_name[JFFS2_MAX_NAME_LEN + 1];
+	int len, i, up = 0;
+	struct jffs2_raw_dirent *node, *curr;
+	unsigned long version, off;
+
+	i = 0;
+	if (name[i] == '/') {
+		pino = 1;
+		i++;
+	}
+
+	do {
+		/* parse the next dir/file/symlink */
+		len = 0;
+		while (name[i] != '\0' && name[i] != '/') 
+			curr_name[len++] = name[i++];
+
+		curr_name[len] = '\0';
+
+		/* go up an inode if its a '..' */
+		up = (len == 2 && !strncmp("..", curr_name, 2));
+
+		UDEBUG("\nlooking for '%s' ...", curr_name);
+
+		/* start again...at the beginning */
+		version = off = 0;
+
+		node = NULL;
+		while (off < part->size - sizeof(struct jffs2_raw_inode)) {
+			curr = (struct jffs2_raw_dirent *)(part->offset + off);
+			if (curr->magic == JFFS2_MAGIC_BITMASK && 
+			    hdr_crc((struct jffs2_unknown_node*)curr)) {
+				if (curr->nodetype == JFFS2_NODETYPE_DIRENT &&
+				    up && curr->ino == pino && dirent_crc(curr) &&
+				    curr->version > version) {
+				    	version = curr->version;
+				    	node = curr;
+				} else if (curr->nodetype == JFFS2_NODETYPE_DIRENT &&
+				    !up && curr->pino == pino &&
+				    curr->nsize == len && dirent_crc(curr) &&
+				    dirent_name_crc(curr) &&
+				    !strncmp(curr_name, curr->name, len) &&
+				    curr->version > version) {
+				    	UDEBUG("found matching dirent\n");
+				    	version = curr->version;
+				    	node = curr;
+				} 
+				off += (curr->totlen + 3) & ~3;
+			} else off += 4;
+		}
+
+		if (!node) return NULL;
+
+		if (node->type == DT_LNK)
+			if (!(node = do_symlink(part, node))) 
+				return NULL;
+
+		/* if we are going up a dir, we want to look for the parent */
+		if (up) {
+			pino = node->pino;
+			up = 0;
+		}
+		else pino = node->ino;
+
+		UDEBUG(" '%s' found at ino %d\n", curr_name, pino);
+	} while (name[i++] == '/');
+
+	return node;
+}
+
+static u32 jffs2_load_kernel(u32 *dest, struct part_info *part, char *filename)
+{
+	struct jffs2_raw_dirent *node;
+	if (!(node = find_inode(part, filename, 1))) {
+		UDEBUG("could not find \"%s\"\n", filename);
+		return 0;
+	}
+	if (node->type != DT_REG) {
+		UDEBUG("\"%s\" is not a regular file\n", filename);
+		return 0;
+	}
+	return read_inode(part, dest, node->ino, DT_REG);
+}
+
+struct kernel_loader jffs2_load = {
+	check_magic: jffs2_check_magic,
+	load_kernel: jffs2_load_kernel,
+	name:	     "jffs2"
+};
Index: build_tree/bootLoader/src/blob/jornada720.c
diff -u build_tree/bootLoader/src/blob/jornada720.c:1.1.1.1 build_tree/bootLoader/src/blob/jornada720.c:1.1.1.2
--- build_tree/bootLoader/src/blob/jornada720.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/jornada720.c	Fri Nov  9 09:44:05 2007
@@ -20,7 +20,7 @@
  *
  */
 
-#ident "$Id: jornada720.c,v 1.3 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: jornada720.c,v 1.9 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -28,15 +28,17 @@
 
 #include <blob/flash.h>
 #include <blob/init.h>
-#include <blob/sa1100.h>
+#include <blob/arch.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
 #include <blob/time.h>
+#include <blob/led.h>
 
 /* flash descriptor for Jornada720 flash */
 
 /* 2 x Intel 28F128J3A StrataFlash (16 MB) [32MB total] */
 /* http://developer.intel.com/design/flcomp/datashts/29066709.pdf */
-static flash_descriptor_t jornada720_flash_descriptors[] =
+static const flash_descriptor_t jornada720_flash_descriptors[] =
 {
 	{
 		/* One hundred twenty eight 128KB blocks */
@@ -66,24 +68,26 @@
 }
 
 
-static void init_flash_driver(void)
+static void init_driver(void)
 {
 	flash_descriptors = jornada720_flash_descriptors;
 
 	flash_driver = &intel32_flash_driver;
 	flash_driver->enable_vpp = jornada720_enable_vpp;
 	flash_driver->disable_vpp = jornada720_disable_vpp;
+
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
-__initlist(init_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+__initlist(init_driver, INIT_LEVEL_DRIVER_SELECTION);
 
 
-static void init_hardware(void)
+static void init_hardware_plus_one(void)
 {
-	PPSR &= ~(GPIO_GPIO10 | GPIO_GPIO7);
-	PPDR |= (GPIO_GPIO10 | GPIO_GPIO7);
-
-#warning "Please check this code!"
 	/* Careful over here! the timer might not yet be initialised
 	 * at this point, so calling msleep() is unsafe! The best way
 	 * to make sure that it is, is to put the GPIO stuff in a
@@ -91,13 +95,14 @@
 	 * INIT_LEVEL_INITIAL_HARDWARE+1. The serial port stuff can be
 	 * called without problems at INIT_LEVEL_INITIAL_HARDWARE -- Erik
 	 */
+
+	PPSR &= ~(GPIO_GPIO10 | GPIO_GPIO7);
+	PPDR |= GPIO_GPIO10 | GPIO_GPIO7;
+
 	msleep(10 * 1000);
 
 	/* Take the MCU out of reset mode */
 	PPSR |= GPIO_GPIO10;
-
-	/* select serial driver */
-	serial_driver = &sa11x0_serial_driver;
 }
 
-__initlist(init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+__initlist(init_hardware_plus_one, INIT_LEVEL_INITIAL_HARDWARE + 1);
Index: build_tree/bootLoader/src/blob/lart.c
diff -u build_tree/bootLoader/src/blob/lart.c:1.1.1.1 build_tree/bootLoader/src/blob/lart.c:1.1.1.2
--- build_tree/bootLoader/src/blob/lart.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/lart.c	Fri Nov  9 09:44:05 2007
@@ -19,22 +19,27 @@
  *
  */
 
-#ident "$Id: lart.c,v 1.6 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: lart.c,v 1.11 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/arch.h>
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/partition.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
 
 
 
 
 /* flash descriptor for LART flash */
 /* 2x Intel 28F160F3B fast boot block flash (4MB) */
-static flash_descriptor_t lart_flash_descriptors[] =
+static const flash_descriptor_t lart_flash_descriptors[] =
 {
 	{ 
 		size: 2 * 8 * 1024,
@@ -52,27 +57,96 @@
 
 
 
-static void init_lart_flash_driver(void)
+/* default partition table for LART */
+static const blob_partition_t lart_default_partition_table[] = {
+	{
+		/* start of table */
+		magic:	BLOB_DEFAULT_PART_TABLE_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	0x00000000,	/* absolute base address */
+		size:	4 * 1024 * 1024 /* total size of the flash */
+	},
+	{
+		/* blob itself */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		BLOB_FLASH_BASE,
+		size:		BLOB_FLASH_LEN,
+		name:		"blob",
+		mem_base:	BLOB_RAM_BASE
+	},
+	{
+		/* parameter block */
+		magic:	BLOB_PART_VALID_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	PARAM_FLASH_BASE,
+		size:	PARAM_FLASH_LEN,
+		name:	"param",
+		flags:	BLOB_PART_FLAG_PTABLE
+	},
+	{
+		/* kernel */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset: 	KERNEL_FLASH_BASE,
+		size:		KERNEL_FLASH_LEN,
+		name:		"kernel",
+		flags:		BLOB_PART_FLAG_LOAD | BLOB_PART_FLAG_EXEC,
+		mem_base:	KERNEL_RAM_BASE,
+		entry_point:	KERNEL_RAM_BASE
+	},
+	{
+		/* ramdisk */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		RAMDISK_FLASH_BASE,
+		size:		RAMDISK_FLASH_LEN,
+		name:		"ramdisk",
+		flags:		BLOB_PART_FLAG_LOAD,
+		mem_base:	RAMDISK_RAM_BASE
+	},
+	{
+		/* last entry */
+		magic:	BLOB_PART_LAST_MAGIC
+	}
+};
+
+
+
+
+static void lart_set_partition_table(void)
 {
-	/* we could do funky detection over here, because the LART can
-	 * have both internal and external flash with different
-	 * properties. for the time being we just ignore that fact.
-	 *   -- Erik
+	/* the default partition table */
+	default_partition_table = lart_default_partition_table;
+	
+	/* we don't know where the flash partition table will live, so
+	 * put the pointer at 0x0000000 and let the partition table
+	 * parser figure out.
 	 */
-
-	flash_descriptors = lart_flash_descriptors;
-	flash_driver = &intel32_flash_driver;
+	flash_partition_table = (blob_partition_t*)0x00000000;
 }
 
-__initlist(init_lart_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+__initlist(lart_set_partition_table, INIT_LEVEL_OTHER_STUFF);
+/* FIXME: need to think if this is the correct init level, we might
+ * want to have this before the param list stuff starts running */
 
 
 
-
-static void lart_init_hardware(void)
+static void lart_select_drivers(void)
 {
-	/* select serial driver */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+
+	/* we could do funky detection over here, because the LART can
+	 * have both internal and external flash with different
+	 * properties. for the time being we just ignore that fact.
+	 *   -- Erik
+	 */
+
+	flash_descriptors = lart_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
 }
 
-__initlist(lart_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+__initlist(lart_select_drivers, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/ledasm-mmap.S
diff -u /dev/null build_tree/bootLoader/src/blob/ledasm-mmap.S:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/ledasm-mmap.S	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,25 @@
+/*
+ * ledasm-mmap.S: simple LED control code for a memory mapped arch
+ *
+ * Copyright (C) 2003 by SOMA Networks, Inc.
+ *
+ * Derived from:
+ *	 Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: ledasm-mmap.S,v 1.1 2003/02/13 01:10:53 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
Index: build_tree/bootLoader/src/blob/ledasm-s3c2500.S
diff -u /dev/null build_tree/bootLoader/src/blob/ledasm-s3c2500.S:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/ledasm-s3c2500.S	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,138 @@
+/*
+ * ledasm-s3c2500.S: simple LED control code
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Russ Dill (Russ.Dill@asu.edu)
+ *
+ * $Id: ledasm-s3c2500.S,v 1.1 2003/09/04 18:03:09 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+/*
+ * Documentation:
+ */
+
+.ident "$Id: ledasm-s3c2500.S,v 1.1 2003/09/04 18:03:09 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+
+
+.text
+
+
+
+.globl ledinit
+	/* initialise LED GPIO and turn LED on.
+	 * clobbers r0 and r1
+	 */
+ledinit:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr	
+#endif
+
+	mov	r0, #ASIC_BASE
+	orr	r0, r0, #IOPB
+	ldr     r1, [r0, #IOPMODE1]
+	bic	r1, r1, #LED_GPIO
+	str	r1, [r0, #IOPMODE1]	/* LED GPIO is output */
+	ldr	r1, [r0, #IOPDATA1]
+	bic	r1, r1, #LED_GPIO
+	str	r1, [r0, #IOPDATA1]	/* turn LED on */
+	mov	pc, lr
+
+
+
+
+.globl led_on
+	/* turn LED on. clobbers r0 and r1 */
+led_on:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr
+#endif
+
+	mov	r0, #ASIC_BASE
+	orr	r0, r0, #IOPB
+	ldr	r1, [r0, #IOPDATA1]
+	bic	r1, r1, #LED_GPIO
+	str	r1, [r0, #IOPDATA1]	/* turn LED on */
+	mov	pc, lr
+
+
+
+
+.globl led_off
+	/* turn LED off. clobbers r0 - r2 */
+led_off:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr
+#endif
+
+	mov	r0, #ASIC_BASE
+	orr	r0, r0, #IOPB
+	ldr	r1, [r0, #IOPDATA1]
+	orr	r1, r1, #LED_GPIO
+	str	r1, [r0, #IOPDATA1]	/* turn LED off */
+	mov	pc, lr
+
+
+
+	/* busy wait loop. clobbers r0 */
+wait_loop:
+	mov	r0, #0x40000
+wait_loop1:
+	subs	r0, r0, #1
+	bne	wait_loop1
+	mov	pc, lr
+
+
+blinky:
+	/* blink LED. clobbers r0 and r1 */
+	mov	r2, lr
+	bl	led_on
+	bl	wait_loop
+	bl	led_off
+	bl	wait_loop
+	mov	pc, r2
+	
+
+.globl led_blink
+	/* blinks LED r0 times */
+	/* clobbers r0 - r4 */
+led_blink:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr
+#endif
+
+	mov	r4, lr
+	mov	r3, r0
+
+	/* switch LED off if it wasn't already off */
+	bl	led_off
+	bl	wait_loop
+	
+blink0:
+	bl	blinky
+	subs	r3, r3, #1
+	bne	blink0
+	mov	pc, r4
Index: build_tree/bootLoader/src/blob/ledasm-sa11x0.S
diff -u /dev/null build_tree/bootLoader/src/blob/ledasm-sa11x0.S:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/ledasm-sa11x0.S	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,141 @@
+/*
+ * ledasm-sa11x0.S: simple LED control code
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: ledasm-sa11x0.S,v 1.1 2003/02/13 01:10:53 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+/*
+ * Documentation:
+ * [1] Intel Corporation, "Intel StrongARM SA-1100 Microprocessor
+ *     Developer's Manual", April 1999
+ * [2] Intel Corporation, "Intel StrongARM SA-1110 Microprocessor
+ *     Advanced Developer's manual, December 1999
+ */
+
+.ident "$Id: ledasm-sa11x0.S,v 1.1 2003/02/13 01:10:53 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+
+
+
+.text
+
+LED:		.long LED_GPIO
+GPIO_BASE:	.long 0x90040000
+#define	GPDR	0x00000004
+#define GPSR	0x00000008
+#define GPCR	0x0000000c
+
+
+
+
+.globl ledinit
+	/* initialise LED GPIO and turn LED on.
+	 * clobbers r0 and r1
+	 */
+ledinit:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr	
+#endif
+
+	ldr	r0, GPIO_BASE
+	ldr	r1, LED
+	str	r1, [r0, #GPDR]		/* LED GPIO is output */
+	str	r1, [r0, #GPSR]		/* turn LED on */
+	mov	pc, lr
+
+
+
+
+.globl led_on
+	/* turn LED on. clobbers r0 and r1 */
+led_on:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr
+#endif
+
+	ldr	r0, GPIO_BASE
+	ldr	r1, LED
+	str	r1, [r0, #GPSR]
+	mov	pc, lr
+
+
+
+
+.globl led_off
+	/* turn LED off. clobbers r0 - r2 */
+led_off:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr
+#endif
+
+	ldr	r0, GPIO_BASE
+	ldr	r1, LED
+	str	r1, [r0, #GPCR]
+	mov	pc, lr
+
+
+
+	/* busy wait loop. clobbers r0 */
+wait_loop:
+	mov	r0, #0x400000
+wait_loop1:
+	subs	r0, r0, #1
+	bne	wait_loop1
+	mov	pc, lr
+
+
+blinky:
+	/* blink LED. clobbers r0 and r1 */
+	mov	r2, lr
+	bl	led_on
+	bl	wait_loop
+	bl	led_off
+	bl	wait_loop
+	mov	pc, r2
+	
+
+.globl led_blink
+	/* blinks LED r0 times */
+	/* clobbers r0 - r4 */
+led_blink:
+
+#if defined (NO_GPIO_LED_SUPPORT)
+	mov	pc, lr
+#endif
+
+	mov	r4, lr
+	mov	r3, r0
+
+	/* switch LED off if it wasn't already off */
+	bl	led_off
+	bl	wait_loop
+	
+blink0:
+	bl	blinky
+	subs	r3, r3, #1
+	bne	blink0
+	mov	pc, r4
Index: build_tree/bootLoader/src/blob/ledasm.S
diff -u build_tree/bootLoader/src/blob/ledasm.S:1.1.1.1 build_tree/bootLoader/src/blob/ledasm.S:removed
--- build_tree/bootLoader/src/blob/ledasm.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/ledasm.S	Tue Jan  8 14:21:46 2008
@@ -1,119 +0,0 @@
-/*
- * ledasm.S: simple LED control code
- *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-/*
- * Documentation:
- * [1] Intel Corporation, "Intel StrongARM SA-1100 Microprocessor
- *     Developer's Manual", April 1999
- * [2] Intel Corporation, "Intel StrongARM SA-1110 Microprocessor
- *     Advanced Developer's manual, December 1999
- */
-
-.ident "$Id: ledasm.S,v 1.3 2001/10/28 20:29:05 erikm Exp $"
-
-#ifdef HAVE_CONFIG_H
-# include <blob/config.h>
-#endif
-
-#include <blob/arch.h>
-
-
-
-.text
-
-LED:		.long LED_GPIO
-GPIO_BASE:	.long 0x90040000
-#define	GPDR	0x00000004
-#define GPSR	0x00000008
-#define GPCR	0x0000000c
-
-
-
-
-.globl ledinit
-	/* initialise LED GPIO and turn LED on.
-	 * clobbers r0 and r1
-	 */
-ledinit:
-	ldr	r0, GPIO_BASE
-	ldr	r1, LED
-	str	r1, [r0, #GPDR]		/* LED GPIO is output */
-	str	r1, [r0, #GPSR]		/* turn LED on */
-	mov	pc, lr
-
-
-
-
-.globl led_on
-	/* turn LED on. clobbers r0 and r1 */
-led_on:
-	ldr	r0, GPIO_BASE
-	ldr	r1, LED
-	str	r1, [r0, #GPSR]
-	mov	pc, lr
-
-
-
-
-.globl led_off
-	/* turn LED off. clobbers r0 - r2 */
-led_off:
-	ldr	r0, GPIO_BASE
-	ldr	r1, LED
-	str	r1, [r0, #GPCR]
-	mov	pc, lr
-
-
-
-	/* busy wait loop. clobbers r0 */
-wait_loop:
-	mov	r0, #0x400000
-wait_loop1:
-	subs	r0, r0, #1
-	bne	wait_loop1
-	mov	pc, lr
-
-
-blinky:
-	/* blink LED. clobbers r0 and r1 */
-	mov	r2, lr
-	bl	led_on
-	bl	wait_loop
-	bl	led_off
-	bl	wait_loop
-	mov	pc, r2
-	
-
-.globl led_blink
-	/* blinks LED r0 times */
-	/* clobbers r0 - r4 */
-led_blink:
-	mov	r4, lr
-	mov	r3, r0
-
-	/* switch LED off if it wasn't already off */
-	bl	led_off
-	bl	wait_loop
-	
-blink0:
-	bl	blinky
-	subs	r3, r3, #1
-	bne	blink0
-	mov	pc, r4
Index: build_tree/bootLoader/src/blob/linux.c
diff -u build_tree/bootLoader/src/blob/linux.c:1.1.1.1 build_tree/bootLoader/src/blob/linux.c:1.1.1.3
--- build_tree/bootLoader/src/blob/linux.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/linux.c	Fri Nov  9 10:37:08 2007
@@ -1,7 +1,9 @@
 /*
  * linux.c: support functions for booting a kernel
  *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * $Id: linux.c,v 1.18 2003/09/04 17:27:33 russd Exp $
+ *
+ * Copyright (C) 2001 2002  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -19,7 +21,7 @@
  *
  */
 
-#ident "$Id: linux.c,v 1.8 2002/01/06 15:46:17 erikm Exp $"
+#ident "$Id: linux.c,v 1.18 2003/09/04 17:27:33 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -32,7 +34,8 @@
 #include <blob/main.h>
 #include <blob/memory.h>
 #include <blob/util.h>
-#include <blob/serial.h>
+#include <blob/errno.h>
+#include <blob/error.h>
 
 #include <asm-arm/setup.h>
 
@@ -48,28 +51,45 @@
 static struct tag *params;
 
 
+static void (*theKernel)(int zero, int arch, u32 params) = 
+#ifdef KERNEL_XIP_BASE
+	(void (*)(int, int, u32)) KERNEL_XIP_BASE;
+#else
+	(void (*)(int, int, u32)) KERNEL_RAM_BASE;
+#endif
+
+
 static int boot_linux(int argc, char *argv[])
 {
-	void (*theKernel)(int zero, int arch) = (void (*)(int, int))KERNEL_RAM_BASE;
+	// For some reason if the printf below is commented out the
+	// kernel does not boot
+
+	printf("\nStarting kernel ...\n\n");
 
 	setup_start_tag();
 	setup_memory_tags();
 	setup_commandline_tag(argc, argv);
-  	setup_initrd_tag();
-	setup_ramdisk_tag();
+	if (blob_status.load_ramdisk) {
+		setup_initrd_tag();
+		setup_ramdisk_tag();
+	}
 	setup_end_tag();
 
+	printf("\nStarting kernel (really, I mean it)...\n\n");
+
 	/* we assume that the kernel is in place */
-	SerialOutputString("\nStarting kernel ...\n\n");
+
 	serial_flush_output();
 
 	/* disable subsystems that want to be disabled before kernel boot */
 	exit_subsystems();
 
-	/* start kernel */
-	theKernel(0, ARCH_NUMBER);
+	printf("\nNext step is to start the kernel\n");
 
-	SerialOutputString("Hey, the kernel returned! This should not happen.\n");
+/* start kernel */
+	theKernel(0, ARCH_NUMBER, BOOT_PARAMS);
+
+	printf("Hey, the kernel returned! This should not happen.\n");
 
 	return 0;
 }
@@ -80,6 +100,30 @@
 __commandlist(boot_linux, "boot", boothelp);
 
 
+static int cmd_kernel(int argc, char *argv[])
+{
+	unsigned long adr;
+	int ret;
+
+	if ( argc < 2 ) goto out;
+
+	ret = strtou32(argv[1], &adr);
+	if ( ret < 0 ) return -EINVAL;
+
+	theKernel = (void (*)(int, int, u32)) adr;
+
+out:
+	printf("Kernel @ 0x%08X Now\n", (unsigned long)theKernel);
+
+	return 0;
+}
+
+static char kernelhelp[] = "kernel hex_adr\n"
+"Change the Linux kernel base\n";
+
+__commandlist(cmd_kernel, "kernel", kernelhelp);
+
+
 static void setup_start_tag(void)
 {
 	params = (struct tag *)BOOT_PARAMS;
@@ -106,7 +150,6 @@
 
 			params->u.mem.start = memory_map[i].start;
 			params->u.mem.size = memory_map[i].len;
-			
 			params = tag_next(params);
 		}
 #if defined( NEPONSET )
@@ -129,8 +172,8 @@
 	params->u.cmdline.cmdline[0] = '\0';
 
 	/* copy default commandline from parameter block */
-	if(blob_status.cmdline[0] != '\0') 
-		strlcpy(params->u.cmdline.cmdline, blob_status.cmdline, 
+	if(blob_status.cmdline[0] != '\0')
+		strlcpy(params->u.cmdline.cmdline, blob_status.cmdline,
 			COMMAND_LINE_SIZE);
 
 	/* copy commandline */
@@ -142,7 +185,7 @@
 			p += strlen(p);
 			*p++ = ' ';
 		}
-	
+
 		p--;
 		*p = '\0';
 
@@ -155,9 +198,9 @@
 
 	if(strlen(params->u.cmdline.cmdline) > 0) {
 		params->hdr.tag = ATAG_CMDLINE;
-		params->hdr.size = (sizeof(struct tag_header) + 
+		params->hdr.size = (sizeof(struct tag_header) +
 				    strlen(params->u.cmdline.cmdline) + 1 + 4) >> 2;
-		
+
 		params = tag_next(params);
 	}
 }
@@ -166,14 +209,36 @@
 static void setup_initrd_tag(void)
 {
 	/* an ATAG_INITRD node tells the kernel where the compressed
-         * ramdisk can be found. ATAG_RDIMG is a better name, actually.
+	 * ramdisk can be found. ATAG_RDIMG is a better name, actually.
 	 */
 	params->hdr.tag = ATAG_INITRD;
 	params->hdr.size = tag_size(tag_initrd);
-	
+
 	params->u.initrd.start = RAMDISK_RAM_BASE;
 	params->u.initrd.size = RAMDISK_FLASH_LEN;
-	
+
+	params = tag_next(params);
+
+	/* Uhoh, we got it all wrong. ATAG_INITRD takes a *virtual* address
+	 * not a physical address, so it nicely breaks on PXA machines.
+	 * This was fixed in linux-2.4.18-rmk6, which added the
+	 * ATAG_INITRD2 node. This one really takes a physical address.
+	 * Pre 2.4.18-rmk6 SA11x0 kernels will just ignore this node and
+	 * skip over it. Post 2.4.18-rmk6 kernels will parse both the
+	 * INITRD and the INITRD2 node, but the latter will supersede
+	 * the former and everything will be all right. -- Erik
+	 */
+
+#ifndef ATAG_INITRD2 /* Quick fix for headers without it */
+#define ATAG_INITRD2 0x54420005
+#endif
+
+	params->hdr.tag = ATAG_INITRD2;
+	params->hdr.size = tag_size(tag_initrd);
+
+	params->u.initrd.start = RAMDISK_RAM_BASE;
+	params->u.initrd.size = RAMDISK_FLASH_LEN;
+
 	params = tag_next(params);
 }
 
@@ -181,15 +246,15 @@
 static void setup_ramdisk_tag(void)
 {
 	/* an ATAG_RAMDISK node tells the kernel how large the
-         * decompressed ramdisk will become.
+	 * decompressed ramdisk will become.
 	 */
 	params->hdr.tag = ATAG_RAMDISK;
 	params->hdr.size = tag_size(tag_ramdisk);
-	
+
 	params->u.ramdisk.start = 0;
 	params->u.ramdisk.size = RAMDISK_SIZE;
 	params->u.ramdisk.flags = 1;	/* automatically load ramdisk */
-	
+
 	params = tag_next(params);
 }
 
Index: build_tree/bootLoader/src/blob/load_kernel.c
diff -u /dev/null build_tree/bootLoader/src/blob/load_kernel.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/load_kernel.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,131 @@
+/*-------------------------------------------------------------------------
+ * Filename:      load_kernel.c
+ * Version:       $Id: load_kernel.c,v 1.16 2003/08/06 22:55:41 abz Exp $
+ * Copyright:     Copyright (C) 2001, Russ Dill
+ * Author:        Russ Dill <Russ.Dill@asu.edu>
+ * Description:   interface between kernel loaders and boot loader.
+ 		  if everything was done right, this *should be the only
+ 		  file that needs changing for porting to different boot
+ 		  loaders.
+ *-----------------------------------------------------------------------*/
+/*
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: load_kernel.c,v 1.16 2003/08/06 22:55:41 abz Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/command.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/load_kernel.h>
+#include <blob/util.h>
+#include <blob/flash.h>
+#include <blob/partition.h>
+
+#ifdef CONFIG_CRAMFS_SUPPORT
+extern struct kernel_loader cramfs_load;
+#endif
+#ifdef CONFIG_ZIMAGE_SUPPORT
+extern struct kernel_loader zImage_load;
+#endif
+#ifdef CONFIG_JFFS2_SUPPORT
+extern struct kernel_loader jffs2_load;
+#endif
+
+struct kernel_loader *known_loaders[] = {
+#ifdef CONFIG_CRAMFS_SUPPORT
+	&cramfs_load, 
+#endif
+#ifdef CONFIG_ZIMAGE_SUPPORT
+	&zImage_load,
+#endif
+#ifdef CONFIG_JFFS2_SUPPORT
+	&jffs2_load, 
+#endif
+	0
+};
+
+#define FODDER_RAM_BASE (0xC0F00000)
+
+const void *fodder_ram_base = (void *) FODDER_RAM_BASE;
+
+	
+
+/* function calls for blob */
+void ldr_update_progress(void)
+{
+	printf(".");
+}
+
+int load_kernel(blob_status_t *blob_status)
+{
+	u32 size;
+	const struct kernel_loader *loader = 0;
+	const blob_partition_t *p;
+	struct part_info part;
+
+	for (p = pt_first(); p != 0; p = pt_next(p)) {
+#ifdef CONFIG_JFFS2_SUPPORT
+		if (p->flags & BLOB_PART_FLAG_JFFS2)
+			loader = &jffs2_load;
+		else 
+#endif
+#ifdef CONFIG_CRAMFS_SUPPORT
+		if (p->flags & BLOB_PART_FLAG_CRAMFS)
+			loader = &cramfs_load;
+		else 
+#endif
+#ifdef CONFIG_ZIMAGE_SUPPORT
+		if (p->flags & BLOB_PART_FLAG_EXEC)
+			loader = &zImage_load;
+		else
+#endif
+			continue;
+			
+		part.offset = pt_flash_start(p);
+		part.size = p->size;
+		part.erasesize = flash_get_block_size((u32)part.offset);
+
+		if (loader->check_magic(&part))
+			break;
+	}
+
+	if (!p) {
+		eprintf("Unable to find kernel\n");
+		return EINVAL;
+	}
+	
+
+	printf("Loading kernel from partition %s (%s) ...",
+	       p->name, loader->name);
+	if ((size = loader->load_kernel((u32 *) KERNEL_RAM_BASE,
+					&part, "/boot/linux")) == 0) {
+		eprintf("error loading kernel!\n");
+		return(EINVAL);
+	}
+
+	blob_status->kernelSize = size;
+	blob_status->kernelType = fromFlash;
+
+	printf("loaded 0x%08x (%d) bytes\n", size, size);
+	return(ENOERROR);
+}
Index: build_tree/bootLoader/src/blob/lubbock.c
diff -u /dev/null build_tree/bootLoader/src/blob/lubbock.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/lubbock.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,211 @@
+/*
+ * lubbock.c: Lubbock specific stuff
+ *
+ * Copyright (C) 2002 Intel Corporation
+ * by :
+ *   Rusty Geldmacher (russell.r.geldmacher@intel.com)
+ *   Yu Tang (yu.tang@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
+#include <net/ether.h>
+#include <net/smc91x.h>
+
+
+
+
+/* flash descriptor for Assabet flash */
+/* 2x Intel 28F128J3A strataflash (16MB) */
+static const flash_descriptor_t lubbock_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 64,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+
+
+static void init_lubbock_flash_driver(void)
+{
+	flash_descriptors = lubbock_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+}
+
+__initlist(init_lubbock_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+/* PXA250 clock base */
+#define BASE_CLK	3686400
+
+/* PXA250 CCCR bits */
+#define CCCR_N30	(0x300)
+#define CCCR_N20	(0x200)
+#define CCCR_N15	(0x180)
+#define CCCR_N10	(0x100)
+#define CCCR_M4		(0x060)
+#define CCCR_M2		(0x040)
+#define CCCR_M1		(0x020)
+#define CCCR_L45	(0x05)
+#define CCCR_L40	(0x04)
+#define CCCR_L36	(0x03)
+#define CCCR_L32	(0x02)
+#define CCCR_L27	(0x01)
+
+#define CLKCFG_T	(0x1)		/* Turbo mode */
+#define CLKCFG_F	(0x2)		/* Frequnce change */
+
+/* CPU Frequence Table */
+static u32 cpufreqs[] = {
+        (CCCR_L27 | CCCR_M1 | CCCR_N10), /* {100/100/100/100} */ 
+        (CCCR_L27 | CCCR_M1 | CCCR_N20), /* {200/100/100/100} */
+        (CCCR_L27 | CCCR_M1 | CCCR_N30), /* {300/100/100/100} */
+        (CCCR_L32 | CCCR_M1 | CCCR_N10), /* {118/118/118/59} */
+        (CCCR_L32 | CCCR_M1 | CCCR_N20), /* {236/118/118/59} */
+        (CCCR_L32 | CCCR_M1 | CCCR_N30), /* {354/118/118/59} */
+        (CCCR_L36 | CCCR_M1 | CCCR_N10), /* {133/133/133/66} */
+        (CCCR_L36 | CCCR_M1 | CCCR_N20), /* {266/133/133/66} */
+        (CCCR_L36 | CCCR_M1 | CCCR_N30), /* {399/133/133/66} */
+        (CCCR_L40 | CCCR_M1 | CCCR_N10), /* {148/148/148/74} */
+        (CCCR_L40 | CCCR_M1 | CCCR_N20), /* {296/148/148/74} */
+        (CCCR_L45 | CCCR_M1 | CCCR_N10), /* {166/166/166/83} */
+        (CCCR_L45 | CCCR_M1 | CCCR_N20), /* {332/166/166/83} */
+        (CCCR_L27 | CCCR_M2 | CCCR_N10), /* {200/200/100/100} */
+        (CCCR_L27 | CCCR_M2 | CCCR_N15), /* {300/200/100/100} */
+        (CCCR_L27 | CCCR_M2 | CCCR_N20), /* {400/200/100/100} */
+        (CCCR_L32 | CCCR_M2 | CCCR_N10), /* {236/236/118/59} */
+        (CCCR_L36 | CCCR_M2 | CCCR_N10), /* {266/266/133/66} */
+        (CCCR_L40 | CCCR_M2 | CCCR_N10), /* {295/295/148/74} */
+        (CCCR_L45 | CCCR_M2 | CCCR_N10), /* {332/332/166/83} */ 
+	(CCCR_L27 | CCCR_M4 | CCCR_N10)  /* {398/398/100/100} C0/Dalhart permissable */
+};
+
+/* 
+ * adjust cpu frequence according to switches
+ *
+ * S25, S26 used to provide all 400 MHz BIN values for Cotulla (0,0 - 1,3)
+ *
+ * S23: Force the halving of MemClk when deriving SDCLK[1]
+ *      DOT: no override  !DOT(1): halve (if not already forced half)
+ *      For certain MemClks, SDCLK's derivation is forced to be halved
+ *
+ * S24: Run/Turbo.  
+ * 	DOT: Run mode   !DOT(1): Turbo mode
+ */
+static void adjust_cpufreq(void)
+{
+	int sw23, sw24, index;
+	int turbo, half, memclk;
+	volatile u32 cccr, mdrefr, clkcfg, reg;
+	
+	/* sw25,sw26(HEX) */
+	index = LUB_USERSW & 0x00ff;
+
+	sw23 = LUB_USERSW & 0x0200;
+	sw24 = LUB_USERSW & 0x0100;
+
+	turbo = half = 0;
+	if (sw23) turbo = 1;
+	if (sw24) half = 1;
+
+	clkcfg = CLKCFG_F;
+	/* default {200/100/100} */
+	cccr = CCCR_L27 | CCCR_M2 | CCCR_N10;
+
+	if ( index < (sizeof(cpufreqs)/sizeof(u32)) )
+		cccr = cpufreqs[index];
+
+	memclk = BASE_CLK * (cccr & CCCR_L_MASK) / 1000000;
+	/* when memclk > 100, then
+	 * 1. force sdclk[1] = memclk/2
+	 * 2. adjust msc0, msc1.LH
+	 */
+	if ( memclk > 100) {
+		reg = MSC0;
+		reg &= ~0x7F007F00;
+		reg |= 0x46004600;
+		MSC0 = reg;
+		reg = MSC0;
+
+		reg = MSC1;
+		reg &= ~0x00007FF0;
+		reg |= 0x00004880;
+		MSC1 = reg;
+		reg = MSC1;
+
+		half = 1;
+	}
+
+	mdrefr = MDREFR;
+	if (half) 
+		mdrefr |= MDREFR_K1DB2;
+	else
+		mdrefr &= ~MDREFR_K1DB2;
+
+	MDREFR = mdrefr; 
+
+	CCCR = cccr;
+
+	if (turbo) 
+		clkcfg |= CLKCFG_T;
+
+	asm volatile("mcr p14, 0, %0, c6, c0, 0"::"r"(clkcfg));
+
+	/* re-write MDREFR after frequence change */
+	mdrefr = MDREFR;
+	MDREFR = mdrefr;
+}
+
+static void lubbock_init_hardware(void)
+{
+	/* Light HEX Led */
+	LUB_LEDHEX = 0xb10bb10b;
+
+	/* Adjuect cpu freq according to switching setting */
+	adjust_cpufreq();
+
+	/* select drivers */
+	reboot_driver = &pxa_reboot_driver;
+	serial_driver = &pxa_serial_driver;
+	led_driver = &mmap_led_driver;
+	timer_driver = &intelarm_timer_driver;
+#ifdef CONFIG_USBDNET_SUPPORT
+	ether_driver = &bvdusb_ether_driver;
+#else
+	ether_driver = &smc91x_ether_driver;
+#endif
+}
+
+
+__initlist(lubbock_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/main.c
diff -u build_tree/bootLoader/src/blob/main.c:1.1.1.1 build_tree/bootLoader/src/blob/main.c:1.1.1.3
--- build_tree/bootLoader/src/blob/main.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/main.c	Fri Nov  9 10:37:08 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      main.c
- * Version:       $Id: main.c,v 1.23 2002/01/07 14:48:25 seletz Exp $
+ * Version:       $Id: main.c,v 1.54 2003/09/04 17:46:59 russd Exp $
  * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
  * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
  * Description:   Main file for the trivially simple bootloader for the 
@@ -32,116 +32,111 @@
  *
  */
 
-#ident "$Id: main.c,v 1.23 2002/01/07 14:48:25 seletz Exp $"
+#ident "$Id: main.c,v 1.54 2003/09/04 17:46:59 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
 #include <blob/arch.h>
+#include <blob/debug.h>
 #include <blob/command.h>
 #include <blob/errno.h>
 #include <blob/error.h>
-#include <blob/flash.h>
 #include <blob/init.h>
-#include <blob/led.h>
 #include <blob/main.h>
 #include <blob/md5.h>
 #include <blob/md5support.h>
 #include <blob/memory.h>
 #include <blob/param_block.h>
-#include <blob/sa1100.h>
 #include <blob/serial.h>
 #include <blob/time.h>
 #include <blob/util.h>
-#include <blob/uucodec.h>
-#include <blob/xmodem.h>
-
-
+#include <blob/load_kernel.h>
+#include <blob/partition.h>
+#include <blob/download.h>
 
+#if defined(CONFIG_LCD_SUPPORT)
+#include <blob/pxa-lcd.h>
+#endif
 
-static int do_reload(char *what);
-static void PrintSerialSpeed(serial_baud_t speed);
 static void print_elf_sections(void);
-
-
+static void *find_parameters(void);
 
 
 blob_status_t blob_status;
 static char *version_str = PACKAGE " version " VERSION " for " BOARD_NAME "\n";
 
-
-
-
 int main(void)
 {
+	
 	int numRead = 0;
 	char commandline[MAX_COMMANDLINE_LENGTH];
-	int i;
-	int retval = 0;
-#ifdef PARAM_START
-	u32 conf;
-#endif
-
-	/* call subsystems */
-	init_subsystems();
+	u32 conf = 0;
+	void *params;
 
 	/* initialise status */
 	blob_status.paramType = fromFlash;
 	blob_status.kernelType = fromFlash;
 	blob_status.ramdiskType = fromFlash;
 	blob_status.downloadSpeed = baud_115200;
-	blob_status.terminalSpeed = baud_9600;
-	blob_status.load_ramdisk = 1;
+	blob_status.terminalSpeed = TERMINAL_SPEED;
+	blob_status.load_ramdisk = LOAD_RAMDISK;
 	blob_status.cmdline[0] = '\0';
-	blob_status.boot_delay = 10;
+	blob_status.boot_delay = 0;
+
+	/* call subsystems (blob_status.* may change) */
+	init_subsystems();
+
+	/* find parameter partition, if it exists */
+//	params = find_parameters();
 
 	/* call serial_init() because the default 9k6 speed might not
            be what the user requested */
-#if defined(H3600) || defined(SHANNON) || defined(IDR) || defined(BADGE4) || defined(JORNADA720)
-	blob_status.terminalSpeed = baud_115200; /* DEBUG */
-#endif
-#if defined(PT_SYSTEM3)
-	blob_status.terminalSpeed = baud_38400;
-#endif
 	serial_init(blob_status.terminalSpeed);
 
 	/* parse the core tag, for critical things like terminal speed */
-#ifdef PARAM_START
-	parse_ptag((void *) PARAM_START, &conf);
-#endif
+	if (params)
+		parse_ptag(params, &conf);
 
 	/* Print the required GPL string */
-	SerialOutputString("\nConsider yourself LARTed!\n\n");
-	SerialOutputString(version_str);
-	SerialOutputString("Copyright (C) 1999 2000 2001 "
-			   "Jan-Derk Bakker and Erik Mouw\n");
-	SerialOutputString(PACKAGE " comes with ABSOLUTELY NO WARRANTY; "
-			   "read the GNU GPL for details.\n");
-	SerialOutputString("This is free software, and you are welcome "
-			   "to redistribute it\n");
-	SerialOutputString("under certain conditions; "
-			   "read the GNU GPL for details.\n");
+	printf("\nAeronix Zipit2 Version 1.00 7-10-2007\n\n");
+
+	printf("%sCopyright (C) 2007 "
+	       "Jan-Derk Bakker and Erik Mouw\n", version_str);
+	printf(PACKAGE " comes with ABSOLUTELY NO WARRANTY; "
+	       "read the GNU GPL for details.\n");
+	printf("This is free software, and you are welcome "
+	       "to redistribute it\n");
+	printf("under certain conditions; read the GNU GPL for details.\n");
+
+	printf("\nRTC Clock Enabled.\n");
+
+	OSCC |= 0x02;
+
+
 
 	/* get the amount of memory */
+	/* FIXME : get_memory_map doesn't work always 
+	 * AERONIX: FIXED - top of memory was set to 256MB which caused redefined Chip Selects
+	 * to go active */
 	get_memory_map();
-
-	print_elf_sections();
+//	print_elf_sections();
 
 #ifdef BLOB_DEBUG
 	{
-		register u32 stackptr;
-		SerialOutputString("Current stack pointer: 0x");
+		register unsigned int stackptr;
 		asm("mov %0, sp": "=r" (stackptr));
-		SerialOutputHex(stackptr);
-		serial_write('\n');
+		printf("Current stack pointer: 0x%08x\n", stackptr);
 	}
 #endif
 
-	/* Parse all the tags in the paramater block */
-#ifdef PARAM_START
-	parse_ptags((void *) PARAM_START, &conf);
+#if defined(CONFIG_LCD_SUPPORT)
+	lcd_init();
 #endif
+	/* Load remaining parameters */
+	if (params)
+		parse_ptags(params, &conf);
 
 	/* Load kernel and ramdisk from flash to RAM */
 	do_reload("blob");
@@ -149,26 +144,38 @@
 	if(blob_status.load_ramdisk)
 		do_reload("ramdisk");
 
-	/* wait 10 seconds before starting autoboot */
-	SerialOutputString("Autoboot in progress, press any key to stop ");
-	for(i = 0; i < blob_status.boot_delay; i++) {
-		serial_write('.');
-
- 		retval = SerialInputBlock(commandline, 1, 1); 
+	if (blob_status.boot_delay > -1) {
+		int i;
+		int retval = 0;
+
+		/* wait boot_delay seconds before starting autoboot */
+		printf("Autoboot (%i seconds) in progress, press any key to stop ",
+		       blob_status.boot_delay);
+
+
+		if (blob_status.boot_delay == 0) {
+			retval = SerialInputBlock(commandline, 1, 0); 
+		} else {
+			for(i = 0; i < blob_status.boot_delay; i++) {
+				serial_write('.');
+
+				retval = SerialInputBlock(commandline, 1, 1); 
+
+				if(retval > 0)
+					break;
+			}
+		}
 
-		if(retval > 0)
-			break;
-	}
+		/* no key was pressed, so proceed booting the kernel */
+		if(retval == 0) {
+			commandline[0] = '\0';
+			parse_command("boot");
+		}
 
-	/* no key was pressed, so proceed booting the kernel */
-	if(retval == 0) {
-		commandline[0] = '\0';
-		parse_command("boot");
+		printf("\nAutoboot aborted\n");
+		printf("Type \"help\" to get a list of commands\n");
 	}
 
-	SerialOutputString("\nAutoboot aborted\n");
-	SerialOutputString("Type \"help\" to get a list of commands\n");
-
 	/* the command loop. endless, of course */
 	for(;;) {
 		DisplayPrompt(NULL);
@@ -177,6 +184,8 @@
 		numRead = GetCommand(commandline, MAX_COMMANDLINE_LENGTH, 600);
 
 		if(numRead > 0) {
+			int retval;
+
 			if((retval = parse_command(commandline)) < 0 )
 				printerror(retval, NULL);
 		}
@@ -187,451 +196,77 @@
 
 
 
-
-static int set_download_parameters(char *name, u32 *startAddress, 
-				    int *bufLen, int **numRead,
-				   u32 **digest)
-{
-	if(strncmp(name, "blob", 5) == 0) {
-		/* download blob */
-		*startAddress = BLOB_RAM_BASE;
-		*bufLen = BLOB_FLASH_LEN;
-		*numRead = &blob_status.blobSize;
-		*digest = blob_status.blob_md5_digest;
-		blob_status.blobType = fromDownload;
-#ifdef PARAM_START
-	} else if(strncmp(name, "param", 6) == 0) {
-		/* download param */
-		*startAddress = PARAM_RAM_BASE;
-		*bufLen = PARAM_FLASH_LEN;
-		*numRead = &blob_status.paramSize;
-		*digest = blob_status.param_md5_digest;
-		blob_status.paramType = fromDownload;
-#endif
-	} else if(strncmp(name, "kernel", 7) == 0) {
-		/* download kernel */
-		*startAddress = KERNEL_RAM_BASE;
-		*bufLen = KERNEL_FLASH_LEN;
-		*numRead = &blob_status.kernelSize;
-		*digest = blob_status.kernel_md5_digest;
-		blob_status.kernelType = fromDownload;
-	} else if(strncmp(name, "ramdisk", 8) == 0) {
-		/* download ramdisk */
-		*startAddress = RAMDISK_RAM_BASE;
-		*bufLen = RAMDISK_FLASH_LEN;
-		*numRead = &blob_status.ramdiskSize;
-		*digest = blob_status.ramdisk_md5_digest;
-		blob_status.ramdiskType = fromDownload;
-	} else {
-		printerror(-EINVAL, name);
-		return -EINVAL;
-	}
-
-	return 0;
-}
-
-
-
-
-static void do_md5sum(u32 *addr, size_t len, u32 *digest)
-{
-#ifdef CONFIG_MD5_SUPPORT
-	md5_buffer((const char *)addr, len, digest);
-#endif
-}
-
-
-
-
-static int Download(int argc, char *argv[])
-{
-	u32 startAddress;
-	int bufLen;
-	int *numRead;
-	int retval;
-	u32 *digest;
-
-	if(argc < 2)
-		return -ENOPARAMS;
-
-	retval = set_download_parameters(argv[1], &startAddress,
-					 &bufLen, &numRead, &digest);
-
-	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
-		SerialOutputString("Switching to ");
-		PrintSerialSpeed(blob_status.downloadSpeed);
-		SerialOutputString(" baud\n");
-
-		SerialOutputString("You have 60 seconds to switch your terminal emulator to the same speed and\n");
-		SerialOutputString("start downloading. After that " PACKAGE " will switch back to ");
-		PrintSerialSpeed(blob_status.terminalSpeed);
-		SerialOutputString(" baud.\n");
-	
-		serial_init(blob_status.downloadSpeed);
-	} else {
-		SerialOutputString("You have 60 seconds to start downloading.\n");
-	}
-
-	*numRead = UUDecode((char *)startAddress, bufLen);
-	
-	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
-		SerialOutputString("\n(Please switch your terminal emulator back to ");
-		PrintSerialSpeed(blob_status.terminalSpeed);
-		SerialOutputString(" baud)\n");
-	}
-	
-	if(*numRead < 0) {
-		/* something went wrong */
-		retval = *numRead;
-		
-		/* reload the correct memory */
-		do_reload(argv[1]);
-
-		serial_init(blob_status.terminalSpeed);
-		return retval;
-	}
-
-	do_md5sum((u32 *)startAddress, *numRead, digest);
-
-	SerialOutputString("Received ");
-	SerialOutputDec(*numRead);
-	SerialOutputString(" (0x");
-	SerialOutputHex(*numRead);
-	SerialOutputString(") bytes");
-#ifdef BLOB_DEBUG
-	SerialOutputString(" at 0x");
-	SerialOutputHex((u32) startAddress);
-#ifdef CONFIG_MD5_SUPPORT
-	SerialOutputString(", MD5: ");
-	print_md5_digest(digest);
-#endif
-#endif
-	serial_write('\n');
-
-
-	serial_init(blob_status.terminalSpeed);
-
-	return 0;
-}
-
-static char downloadhelp[] = "download {blob|param|kernel|ramdisk}\n"
-"Download <argument> image to RAM using uuencode\n";
-
-__commandlist(Download, "download", downloadhelp);
-
-
-
-
-static int xdownload(int argc, char *argv[])
-{
-	u32 startAddress;
-	int bufLen;
-	int *numRead;
-	int retval;
-	u32 *digest;
-
-	if(argc < 2)
-		return -ENOPARAMS;
-
-	retval = set_download_parameters(argv[1], &startAddress,
-					 &bufLen, &numRead, &digest);
-
-	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
-		SerialOutputString("Switching to ");
-		PrintSerialSpeed(blob_status.downloadSpeed);
-		SerialOutputString(" baud\n");
-
-		SerialOutputString("Switch your terminal emulator to the same speed and\n");
-		SerialOutputString("start sending using the XMODEM protocl (repeated ^X) to quit.\n");
-		SerialOutputString(PACKAGE " will switch back to ");
-		PrintSerialSpeed(blob_status.terminalSpeed);
-		SerialOutputString(" baud after XMODEM succeeds or times out.\n");
-	
-		serial_init(blob_status.downloadSpeed);
-	} else {
-		SerialOutputString("Start sending using the XMODEM protocol (repeated ^X to quit).\n\n");
-	}
-
-	*numRead = XModemReceive((char *) startAddress, bufLen);
-
-	SerialOutputString("\n\n\n");
-	
-	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
-		SerialOutputString("\n(Please switch your terminal emulator back to ");
-		PrintSerialSpeed(blob_status.terminalSpeed);
-		SerialOutputString(" baud)\n");
-	}
-	
-	if(*numRead < 0) {
-		/* something went wrong */
-		retval = *numRead;
-		
-		/* reload the correct memory */
-		do_reload(argv[1]);
-
-		serial_init(blob_status.terminalSpeed);
-		return retval;
-	}
-
-	do_md5sum((u32 *)startAddress, *numRead, digest);
-
-	SerialOutputString("Received ");
-	SerialOutputDec(*numRead);
-	SerialOutputString(" (0x");
-	SerialOutputHex(*numRead);
-	SerialOutputString(") bytes");
-#ifdef BLOB_DEBUG
-	SerialOutputString(" at 0x");
-	SerialOutputHex((u32) startAddress);
-#ifdef CONFIG_MD5_SUPPORT
-	SerialOutputString(", MD5: ");
-	print_md5_digest(digest);
-#endif
-#endif
-	serial_write('\n');
-
-
-	serial_init(blob_status.terminalSpeed);
-
-	return 0;
-}
-
-static char xdownloadhelp[] = "xdownload {blob|param|kernel|ramdisk}\n"
-"Download <argument> image to RAM using xmodem\n";
-
-__commandlist(xdownload, "xdownload", xdownloadhelp);
-
-
-
-
-
-
-
-
-
-static int Flash(int argc, char *argv[])
-{
-	u32 *src;
-	u32 *dst;
-	u32 numBytes = 0;
-	u32 maxSize = 0;
-	u32 nwords;
-	block_source_t type = fromFlash;
-	
-
-	if(argc < 2)
-		return -ENOPARAMS;
-
-	if(strncmp(argv[1], "blob", 5) == 0) {
-		src = (u32 *)BLOB_RAM_BASE;
-		dst = (u32 *)BLOB_FLASH_BASE;
-		maxSize = BLOB_FLASH_LEN;
-		numBytes = blob_status.blobSize;
-		type = blob_status.blobType;
-#ifdef PARAM_START
-	} else if(strncmp(argv[1], "param", 6) == 0) {
-		src = (u32 *)PARAM_RAM_BASE;
-		dst = (u32 *)PARAM_FLASH_BASE;
-		maxSize = PARAM_FLASH_LEN;
-		numBytes = blob_status.paramSize;
-		type = blob_status.paramType;
-#endif
-	} else if(strncmp(argv[1], "kernel", 7) == 0) {
-		src = (u32 *)KERNEL_RAM_BASE;
-		dst = (u32 *)KERNEL_FLASH_BASE;
-		numBytes = blob_status.kernelSize;
-		maxSize = KERNEL_FLASH_LEN;
-		type = blob_status.kernelType;
-	} else if(strncmp(argv[1], "ramdisk", 8) == 0) {
-		src = (u32 *)RAMDISK_RAM_BASE;
-		dst = (u32 *)RAMDISK_FLASH_BASE;
-		numBytes = blob_status.ramdiskSize;
-		maxSize = RAMDISK_FLASH_LEN;
-		type = blob_status.ramdiskType;
-	} else {
-		printerror(EINVAL, argv[1]);
-		return 0;
-	}
-
-	if(type == fromFlash) {
-		printerrprefix();
-		SerialOutputString(argv[1]);
-		SerialOutputString(" not downloaded\n");
-		return -EINVAL;
-	}
-
-	if(numBytes > maxSize) {
-		printerrprefix();
-		SerialOutputString("image too large for flash: 0x");
-		SerialOutputHex(numBytes);
-		SerialOutputString(" > 0x");
-		SerialOutputHex(maxSize);
-		serial_write('\n');
-
-		return -ETOOLONG;
-	}
-
-	nwords = (numBytes + sizeof(u32) - 1) / sizeof(u32);
-
-	SerialOutputString("Saving ");
-	SerialOutputString(argv[1]);
-	SerialOutputString(" to flash\n");
-
-
-	flash_write_region(dst, src, nwords);
-
-	return 0;
-}
-
-static char flashhelp[] = "flash {blob|param|kernel|ramdisk}\n"
-"Write <argument> image to flash\n";
-
-__commandlist(Flash, "flash", flashhelp);
-
-
-
-
-static int SetDownloadSpeed(int argc, char *argv[])
-{
-	if(argc < 2)
-		return -ENOPARAMS;
-
-	if(strncmp(argv[1], "1200", 5) == 0) {
-		blob_status.downloadSpeed = baud_1200;
-	} else if(strncmp(argv[1], "1k2", 4) == 0) {
-		blob_status.downloadSpeed = baud_1200;
-	} else if(strncmp(argv[1], "9600", 5) == 0) {
-		blob_status.downloadSpeed = baud_9600;
-	} else if(strncmp(argv[1], "9k6", 4) == 0) {
-		blob_status.downloadSpeed = baud_9600;
-	} else if(strncmp(argv[1], "19200", 6) == 0) {
-		blob_status.downloadSpeed = baud_19200;
-	} else if(strncmp(argv[1], "19k2", 5) == 0) {
-		blob_status.downloadSpeed = baud_19200;
-	} else if(strncmp(argv[1], "38400", 7) == 0) {
-		blob_status.downloadSpeed = baud_38400;
-	} else if(strncmp(argv[1], "38k4", 5) == 0) {
-		blob_status.downloadSpeed = baud_38400;
-	} else if(strncmp(argv[1], "57600", 6) == 0) {
-		blob_status.downloadSpeed = baud_57600;
-	} else if(strncmp(argv[1], "57k6", 5) == 0) {
-		blob_status.downloadSpeed = baud_57600;
-	} else if(strncmp(argv[1], "115200", 7) == 0) {
-		blob_status.downloadSpeed = baud_115200;
-	} else if(strncmp(argv[1], "115k2", 6) == 0) {
-		blob_status.downloadSpeed = baud_115200;
-	} else if(strncmp(argv[1], "230400", 7) == 0) {
-		blob_status.downloadSpeed = baud_230400;
-	} else if(strncmp(argv[1], "230k4", 6) == 0) {
-		blob_status.downloadSpeed = baud_230400;
-	} else {
-		return -EINVAL;
-	}
-
-	SerialOutputString("Download speed set to ");
-	PrintSerialSpeed(blob_status.downloadSpeed);
-	SerialOutputString(" baud\n");
-
-	return 0;
-}
-
-static char speedhelp[] = "speed [baudrate]\n"
-"Set download speed. Valid baudrates are:\n"
-"1200, 9600, 19200, 38400, 57600, 115200, 230400,\n"
-" 1k2,  9k6,  19k2,  38k4,  57k6,  115k2,  230k4\n";
-
-__commandlist(SetDownloadSpeed, "speed", speedhelp);
-
-
-
-
 static int PrintStatus(int argc, char *argv[])
 {
-	SerialOutputString(version_str);
+	printf(version_str);
 
-	SerialOutputString("Download speed      : ");
+	printf("Download speed      : ");
 	PrintSerialSpeed(blob_status.downloadSpeed);
-	SerialOutputString(" baud\n");
+	printf(" baud\n");
 
-	SerialOutputString("Terminal speed      : ");
+	printf("Terminal speed      : ");
 	PrintSerialSpeed(blob_status.terminalSpeed);
-	SerialOutputString(" baud\n");
+	printf(" baud\n");
 
-	SerialOutputString("blob    (0x");
-	SerialOutputHex(BLOB_FLASH_BASE);
-	SerialOutputString("): ");
+	printf("blob    (0x%08x): ", BLOB_FLASH_BASE);
 	if(blob_status.blobType == fromFlash) {
-		SerialOutputString("from flash\n");
+		printf("from flash\n");
 	} else {
-		SerialOutputString("downloaded at 0x");
-		SerialOutputHex(BLOB_RAM_BASE);
-		SerialOutputString(", ");
-		SerialOutputDec(blob_status.blobSize);
-		SerialOutputString(" bytes\n");
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       BLOB_RAM_BASE, blob_status.blobSize);
 #ifdef CONFIG_MD5_SUPPORT
-		SerialOutputString("                      MD5: ");
+		printf("                      MD5: ");
 		print_md5_digest(blob_status.blob_md5_digest);
-		serial_write('\n');
+		printf("\n");
 #endif
 	}
 
-#ifdef PARAM_START
-	SerialOutputString("param  (0x");
-	SerialOutputHex(PARAM_FLASH_BASE);
-	SerialOutputString("): ");
+#ifdef PARAM_FLASH_BASE
+	printf("param  (0x%08x): ", PARAM_FLASH_BASE);
 	if(blob_status.paramType == fromFlash) {
-		SerialOutputString("from flash\n");
+		printf("from flash\n");
 	} else {
-		SerialOutputString("downloaded at 0x");
-		SerialOutputHex(PARAM_RAM_BASE);
-		SerialOutputString(", ");
-		SerialOutputDec(blob_status.paramSize);
-		SerialOutputString(" bytes\n");
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       PARAM_RAM_BASE, blob_status.paramSize);
 #ifdef CONFIG_MD5_SUPPORT
-		SerialOutputString("                      MD5: ");
+		printf("                      MD5: ");
 		print_md5_digest(blob_status.param_md5_digest);
-		serial_write('\n');
+		printf("\n");
 #endif
 	}
 #else
-	SerialOutputString("param               : Not available\n");
+	printf("param               : Not available\n");
 #endif
 
-	SerialOutputString("kernel  (0x");
-	SerialOutputHex(KERNEL_FLASH_BASE);
-	SerialOutputString("): ");
+#ifdef KERNEL_FLASH_BASE
+	printf("kernel  (0x%08x): ", KERNEL_FLASH_BASE);
 	if(blob_status.kernelType == fromFlash) {
-		SerialOutputString("from flash\n");
+		printf("from flash\n");
 	} else {
-		SerialOutputString("downloaded at 0x");
-		SerialOutputHex(KERNEL_RAM_BASE);
-		SerialOutputString(", ");
-		SerialOutputDec(blob_status.kernelSize);
-		SerialOutputString(" bytes\n");
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       KERNEL_RAM_BASE, blob_status.kernelSize);
 #ifdef CONFIG_MD5_SUPPORT
-		SerialOutputString("                      MD5: ");
+		printf("                      MD5: ");
 		print_md5_digest(blob_status.kernel_md5_digest);
-		serial_write('\n');
+		printf("\n");
 #endif
 	}
+#endif
 
-	SerialOutputString("ramdisk (0x");
-	SerialOutputHex(RAMDISK_FLASH_BASE);
-	SerialOutputString("): ");
+#ifdef RAMDISK_FLASH_BASE
+	printf("ramdisk (0x%08x): ", RAMDISK_FLASH_BASE);
 	if(blob_status.ramdiskType == fromFlash) {
-		SerialOutputString("from flash\n");
+		printf("from flash\n");
 	} else {
-		SerialOutputString("downloaded at 0x");
-		SerialOutputHex(RAMDISK_RAM_BASE);
-		SerialOutputString(", ");
-		SerialOutputDec(blob_status.ramdiskSize);
-		SerialOutputString(" bytes\n");
+		printf("downloaded at 0x%08x, %i bytes\n",
+		       RAMDISK_RAM_BASE, blob_status.ramdiskSize);
 #ifdef CONFIG_MD5_SUPPORT
-		SerialOutputString("                      MD5: ");
+		printf("                      MD5: ");
 		print_md5_digest(blob_status.ramdisk_md5_digest);
-		serial_write('\n');
+		printf("\n");
 #endif
 	}
+#endif
 	
 	return 0;
 }
@@ -644,56 +279,6 @@
 
 
 
-static int do_reload(char *what)
-{
-	u32 *dst = 0;
-	u32 *src = 0;
-	int numWords;
-
-	if(strncmp(what, "blob", 5) == 0) {
-		dst = (u32 *)BLOB_RAM_BASE;
-		src = (u32 *)BLOB_FLASH_BASE;
-		numWords = BLOB_FLASH_LEN / 4;
-		blob_status.blobSize = 0;
-		blob_status.blobType = fromFlash;
-		SerialOutputString("Loading blob from flash ");
-#ifdef PARAM_START
-	} else if(strncmp(what, "param", 6) == 0) {
-		dst = (u32 *)PARAM_RAM_BASE;
-		src = (u32 *)PARAM_FLASH_BASE;
-		numWords = PARAM_FLASH_LEN / 4;
-		blob_status.paramSize = 0;
-		blob_status.paramType = fromFlash;
-		SerialOutputString("Loading paramater block from flash ");
-#endif
-	} else if(strncmp(what, "kernel", 7) == 0) {
-		dst = (u32 *)KERNEL_RAM_BASE;
-		src = (u32 *)KERNEL_FLASH_BASE;
-		numWords = KERNEL_FLASH_LEN / 4;
-		blob_status.kernelSize = 0;
-		blob_status.kernelType = fromFlash;
-		SerialOutputString("Loading kernel from flash ");
-	} else if(strncmp(what, "ramdisk", 8) == 0) {
-		dst = (u32 *)RAMDISK_RAM_BASE;
-		src = (u32 *)RAMDISK_FLASH_BASE;
-		numWords = RAMDISK_FLASH_LEN / 4;
-		blob_status.ramdiskSize = 0;
-		blob_status.ramdiskType = fromFlash;
-		SerialOutputString("Loading ramdisk from flash ");
-	} else {
-		printerror(EINVAL, what);
-		return 0;
-	}
-
-	MyMemCpy(dst, src, numWords);
-	SerialOutputString(" done\n");
-
-	return 0;
-}
-
-
-
-
 static int Reload(int argc, char *argv[])
 {
 	if(argc < 2)
@@ -709,47 +294,6 @@
 
 
 
-
-static void PrintSerialSpeed(serial_baud_t speed)
-{
-	switch(speed) {
-	case baud_1200:
-		SerialOutputDec(1200);
-		break;
-
-	case baud_9600:
-		SerialOutputDec(9600);
-		break;
-
-	case baud_19200:
-		SerialOutputDec(19200);
-		break;
-
-	case baud_38400:
-		SerialOutputDec(38400);
-		break;
-
-	case baud_57600:
-		SerialOutputDec(57600);
-		break;
-
-	case baud_115200:
-		SerialOutputDec(115200);
-		break;
-
-	case baud_230400:
-		SerialOutputDec(230400);
-		break;
-
-	default:
-		SerialOutputString("(unknown)");
-		break;
-	}
-}
-
-
-
-
 static void print_elf_sections(void)
 {
 #ifdef BLOB_DEBUG
@@ -764,15 +308,13 @@
 	extern u32 __bss_start, __bss_end;
 	extern u32 __stack_start, __stack_end;
 
-	SerialOutputString("ELF sections layout:\n");
+	printf("ELF sections layout:\n");
 
 #define PRINT_ELF_SECTION(from, to, name) \
-	SerialOutputString("  0x"); \
-	SerialOutputHex((u32)&(from)); \
-	SerialOutputString(" - 0x"); \
-	SerialOutputHex((u32)&(to)); \
-	SerialOutputString(" " name "\n");
-
+	printf("  0x%08x - 0x%08x  %s\n", \
+	       (unsigned int)&(from), \
+	       (unsigned int)&(to), \
+	       name);
 
 	PRINT_ELF_SECTION(__text_start, __text_end, ".text");
 	PRINT_ELF_SECTION(__rodata_start, __rodata_end, ".rodata");
@@ -786,3 +328,10 @@
 	PRINT_ELF_SECTION(__stack_start, __stack_end, ".stack (in .bss)");
 #endif
 }
+
+static void *find_parameters(void) 
+{
+	const blob_partition_t *p = pt_find_by_name("param");
+
+	return p ? pt_flash_start(p) : NULL;
+}
Index: build_tree/bootLoader/src/blob/mainstone.c
diff -u /dev/null build_tree/bootLoader/src/blob/mainstone.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/mainstone.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,463 @@
+/*
+ * mainstone.c: Mainstone specific stuff
+ *
+ * Copyright (C) 2003 Intel Corporation (yu.tang@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/serial_usb.h>
+#include <blob/led.h>
+#include <blob/time.h>
+#include <blob/partition.h>
+#include <net/ether.h>
+#include <net/net.h>
+#include <blob/command.h>
+
+// Aeronix: Intel 28F320C3 Top Boot, 31 32KW blocks followed by 8 4KW blocks
+// NULL block is required -- don't know why yet.....
+
+// Phil: 2-2-06
+// Added support for Intel JS28F640P30T part
+
+
+/* Phil -- Commented out Z2 flash for now
+
+  static const flash_descriptor_t mainstone_flash_descriptors[] =
+{
+	{
+		size: 1 * 32 * 1024,
+		num: 31,
+        lockable: 1
+	},
+	{ 
+		size: 1 * 4 * 1024,
+		num: 8,
+        lockable: 1
+	},
+	{
+		// NULL block 
+	},
+};
+*/
+
+//
+// P30 structure (ID 0x8817)
+// 
+
+  static const flash_descriptor_t mainstone_flash_descriptors[] =
+{
+	{
+		size: 1 * 64 * 1024,
+		num: 63,
+        lockable: 1
+	},
+	{ 
+		size: 1 * 8 * 1024,
+		num: 8,
+        lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+
+
+/* default partition table for Z2 */
+
+//
+// Phil: 2-2-06 Updated to reflect P30 Flash (4MB total)
+// Also added ramdisk back in
+//
+static const blob_partition_t Mainstone_default_partition_table[] = {
+	{
+		/* start of table */
+		magic:	BLOB_DEFAULT_PART_TABLE_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	0x00000000,	/* absolute base address */
+		size:	4 * 1024 * 1024 /* Phil 02-02-06 total size of the flash */
+	},
+	{
+		/* blob itself */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		BLOB_FLASH_BASE,
+		size:		BLOB_FLASH_LEN,
+		name:		"blob",
+		mem_base:	BLOB_RAM_BASE
+	},
+	{
+		/* parameter block */
+		magic:	BLOB_PART_VALID_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	PARAM_FLASH_BASE,
+		size:	PARAM_FLASH_LEN,
+		name:	"param",
+		flags:	BLOB_PART_FLAG_PTABLE
+	},
+	{
+		/* kernel */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset: 	KERNEL_FLASH_BASE,
+		size:		KERNEL_FLASH_LEN,
+		name:		"kernel",
+		flags:		BLOB_PART_FLAG_LOAD | 
+				BLOB_PART_FLAG_CRAMFS,
+		mem_base:	KERNEL_RAM_BASE,
+		entry_point:	KERNEL_RAM_BASE
+	},
+	{
+		/* ramdisk */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		RAMDISK_FLASH_BASE,
+		size:		RAMDISK_FLASH_LEN,
+		name:		"ramdisk",
+		flags:		BLOB_PART_FLAG_LOAD,
+		mem_base:	RAMDISK_RAM_BASE
+	},
+	{
+		/* last entry */
+		magic:	BLOB_PART_LAST_MAGIC
+	}
+};
+
+
+/* static void init_mainstone_flash_driver(void)
+{
+	flash_descriptors = mainstone_flash_descriptors;
+	flash_driver = &intel16_flash_driver;
+}
+
+__initlist(init_mainstone_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+*/
+
+static void mainstone_init_hardware(void)
+{
+	/* Setup Flash Stuff */
+	flash_descriptors = mainstone_flash_descriptors;
+	flash_driver = &intel16_flash_driver;
+
+	/* the default partition table */
+	default_partition_table = Mainstone_default_partition_table;
+	
+	/* we don't know where the flash partition table will live, so
+	 * put the pointer at 0x0000000 and let the partition table
+	 * parser figure out.
+	 */
+	flash_partition_table = (blob_partition_t*)0x00000000;
+
+/* Required for Network Support
+
+	unsigned char serverip[4]={192,168,1,100};
+	unsigned char clientip[4]={192,168,1,101};
+
+	* set default ip *
+	memcpy(serveripaddress, serverip, sizeof(serverip));
+	memcpy(clientipaddress, clientip, sizeof(clientip));
+/*
+
+	/* select drivers */
+	reboot_driver = &pxa_reboot_driver;
+	serial_driver = &pxa_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+
+__initlist(mainstone_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
+/*********************************************************************
+ * cmd_flash_write
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash write access
+ *
+ */
+static int cmd_flash_write( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	src	= 0L;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 4 ) {
+		ret = -1;
+		goto DONE;
+	}
+
+	ret = strtou32( argv[1], &src );
+	if ( ret < 0 ) {
+		ret = -1;
+		goto DONE;
+	}
+
+	ret = strtou32( argv[2], &dest );
+	if ( ret < 0 )	{
+		ret = -1;
+		goto DONE;
+	}
+
+	ret = strtou32( argv[3], &len );
+	if ( ret < 0 ) {
+		ret = -1;
+		goto DONE;
+	}
+
+	ret = flash_write_region( (u32 *)dest, (u32*)src, len); 
+
+DONE:
+	return ret;
+}
+
+
+static char flashwritehelp[] = "fwrite srcadr destadr size(bytes)\n"
+"flash a memory region\n";
+__commandlist( cmd_flash_write, "fwrite", flashwritehelp );
+
+/*********************************************************************
+ * cmd_flash_erase
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash erasing
+ *
+ */
+static int cmd_flash_erase( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 3 ) {
+		ret = -1;
+		goto DONE;
+	}
+
+	ret = strtou32( argv[1], &dest );
+	if ( ret < 0 ) {
+		ret = -1;
+		goto DONE;
+	}	
+
+	ret = strtou32( argv[2], &len );
+	if ( ret < 0 ){
+		ret = -1;
+		goto DONE;
+	}
+
+	ret = flash_erase_region((u32 *)dest, len);
+
+DONE:
+	return ret;
+}
+
+static char flasherasehelp[] = "ferase adr size(bytes)\n"
+"erase a flash region\n";
+__commandlist( cmd_flash_erase, "ferase", flasherasehelp );
+
+/*********************************************************************
+ * cmd_clock_info
+ *
+ * AUTOR:	yu tang, rusty geldmacher
+ * REVISED:
+ *
+ * prints out clock information. taken from Yu's kernel patch
+ *
+ */
+#define BASE_CLK 13000000
+static int cmd_clock_info(int argc, char *argv[])
+{
+	unsigned long cccr_val, ccsr_val, clkcfg_val;
+	unsigned int L, M, N2;
+	unsigned int r_clk, t_clk, s_clk, m_clk;
+	int k0db, k1db;
+  
+	cccr_val = CCCR;
+	ccsr_val = CCSR;
+	asm( "mrc p14, 0, %0, c6, c0, 0" : "=r" (clkcfg_val) );
+  
+	L  =  ccsr_val & 0x1f;
+	N2 =  (ccsr_val>>7) & 0x7;
+  
+	if (L <= 10) M = 1;
+	else if (L <=20 ) M =2;
+	else M=4;
+  
+	r_clk = (L * BASE_CLK);
+	t_clk = (L * BASE_CLK * N2) / 2;
+  
+	/* Fast-bus Mode ? */
+	if (clkcfg_val & 0x8) 
+		s_clk = r_clk;
+	else
+		s_clk = r_clk/2;
+  
+	/* Alternate setting? */
+	if (cccr_val & 0x2000000)
+		m_clk = s_clk;
+	else
+		m_clk = r_clk / M;
+  
+	if (MDREFR & MDREFR_K0DB4) 
+		k0db = 4;
+	else if (MDREFR & MDREFR_K0DB2) 
+		k0db = 2;
+	else 
+		k0db = 1;
+  
+	if (MDREFR & MDREFR_K1DB2) 
+		k1db = 2;
+	else 
+		k1db = 1;
+  
+	printf("Run Mode clock: %d.%02dMHz (*%d)\n",
+	 	r_clk / 1000000, (r_clk % 1000000) / 10000, L );
+	printf("Turbo Mode clock: %d.%02dMHz (*%d.%d, %sactive)\n",
+		t_clk / 1000000, (t_clk % 1000000) / 10000, N2 / 2, (N2 % 2) * 5,
+		(clkcfg_val & 0x1) ? "" : "in" );
+	printf("Memory clock: %d.%02dMHz (Alt=%d, SDCLK[0]=/%d, SDCLK[1]=/%d)\n",
+		m_clk / 1000000, (m_clk % 1000000) / 10000,(int)(cccr_val>>25)&1,
+		k0db, k1db );
+	printf("System bus clock: %d.%02dMHz \n",
+		s_clk / 1000000, (s_clk % 1000000) / 10000 );
+
+}
+
+static char clockinfohelp[] = "clockinfo\n"
+"print out processor clock information\n";
+__commandlist(cmd_clock_info, "clockinfo", clockinfohelp);
+
+
+/*********************************************************************
+ * cmd_go
+ *
+ * AUTOR:	Yu Tang
+ * REVISED:
+ *
+ * Start execution at indicated address
+ *
+ */
+static int cmd_go(int argc, char *argv[])
+{
+	void (*myfunc)() = NULL;
+	int ret;
+
+	if (argc != 2) return -1;
+
+	ret = strtou32( argv[1], &myfunc);
+	if (ret < 0) return -1;
+
+	printf("\nStarting at 0x%08x...\n\n", (u32)myfunc);
+	myfunc();
+	printf("\nDone.\n");
+
+	return 0;
+}
+
+static char gohelp[] = "go address\n"
+"Start execution at $address\n";
+__commandlist(cmd_go, "go", gohelp);
+
+/*********************************************************************
+ * cmd_coprocessor_access
+ *
+ * AUTOR:	yu tang, rusty geldmacher
+ * REVISED:
+ *
+ * prints out clock information. taken from Yu's kernel patch
+ *
+ */
+static char coprocessor_access_help[] = "coproc {CLKCFG | PWRMODE} [value] \n"
+"get/set coprocessor register info\n";
+
+static int cmd_coprocessor_access(int argc, char *argv[])
+{
+	unsigned long reg_val;
+
+	if(argc == 1)
+	{
+		printf(coprocessor_access_help);
+	}
+	else
+	{
+		int nReg = 0;
+		if(memcmp(argv[1], "CLKCFG", sizeof("CLKCFG")) == 0)
+		{
+			nReg = 1;
+		}
+		else
+		if(memcmp(argv[1], "PWRMODE", sizeof("PWRMODE")) == 0)
+		{
+			nReg = 2;
+		}
+		else
+		{
+			printf(coprocessor_access_help);
+		}
+		
+		if(nReg > 0)
+		{
+			if(argc == 2)
+			{
+				switch(nReg)
+				{
+					case 1:
+						asm( "mrc p14, 0, %0, c6, c0, 0" : "=r" (reg_val) );
+						break;
+
+					case 2:
+						asm( "mrc p14, 0, %0, c7, c0, 0" : "=r" (reg_val) );
+						break;
+				}
+			}
+			else
+			{
+				strtou32( argv[2], &reg_val );
+
+				switch(nReg)
+				{
+					case 1:
+						asm( "mcr p14, 0, %0, c6, c0, 0" :: "r" (reg_val) );
+						break;
+
+					case 2:
+						asm( "mcr p14, 0, %0, c7, c0, 0" :: "r" (reg_val) );
+						break;
+				}
+			}
+
+			printf("%s: 0x%08lX\n", argv[1], reg_val);
+		}
+	}
+}
+
+__commandlist(cmd_coprocessor_access, "coproc", coprocessor_access_help);
+
Index: build_tree/bootLoader/src/blob/memory.c
diff -u build_tree/bootLoader/src/blob/memory.c:1.1.1.1 build_tree/bootLoader/src/blob/memory.c:1.1.1.3
--- build_tree/bootLoader/src/blob/memory.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/memory.c	Fri Nov  9 10:37:08 2007
@@ -19,33 +19,25 @@
  *
  */
 
-#ident "$Id: memory.c,v 1.4 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: memory.c,v 1.5 2002/02/13 00:09:51 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
 #include <blob/arch.h>
+#include <blob/debug.h>
 #include <blob/memory.h>
-#include <blob/serial.h>
+#include <blob/util.h>
 
 /* test in 1MB chunks */
 #define TEST_BLOCK_SIZE (1024 * 1024)
 
-
-
-
 /* from testmem2.S */
 extern int testram(u32 addr);
 
-
-
-
 memory_area_t memory_map[NUM_MEM_AREAS];
 
-
-
-
 void get_memory_map(void)
 {
 	u32 addr;
@@ -65,26 +57,17 @@
 		if(testram(addr) == 0) {
 			/* yes, memory */
 			if(* (u32 *)addr != 0) { /* alias? */
-#ifdef BLOB_DEBUG
-				SerialOutputString("Detected alias at 0x");
-				SerialOutputHex(addr);
-				SerialOutputString(", aliased from 0x");
-				SerialOutputHex(* (u32 *)addr);
-				serial_write('\n');
-#endif
+//				printf("\n detected alias");
 				if(memory_map[i].used)
 					i++;
-
 				continue;
 			}
 
 			/* not an alias, write the current address */
 			* (u32 *)addr = addr;
-#ifdef BLOB_DEBUG			
-			SerialOutputString("Detected memory at 0x");
-			SerialOutputHex(addr);
-			serial_write('\n');
-#endif
+
+//			printf("detected memory at 0x%08x\n", addr);
+
 			/* does this start a new block? */
 			if(memory_map[i].used == 0) {
 				memory_map[i].start = addr;
@@ -99,16 +82,13 @@
 				i++;
 		}
 	}
-	SerialOutputString("Memory map:\n");
+	printf("Memory map:\n");
 	for(i = 0; i < NUM_MEM_AREAS; i++) {
 		if(memory_map[i].used) {
-			SerialOutputString("  0x");
-			SerialOutputHex(memory_map[i].len);
-			SerialOutputString(" @ 0x");
-			SerialOutputHex(memory_map[i].start);
-			SerialOutputString(" (");
-			SerialOutputDec(memory_map[i].len / (1024 * 1024));
-			SerialOutputString(" MB)\n");
+			printf("  0x%08x @ 0x%08x (%d MB)\n",
+			       memory_map[i].len,
+			       memory_map[i].start,
+			       memory_map[i].len / (1024 * 1024));
 		}
 	}
 }
Index: build_tree/bootLoader/src/blob/memsetup-pxa.S
diff -u /dev/null build_tree/bootLoader/src/blob/memsetup-pxa.S:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/memsetup-pxa.S	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,235 @@
+
+/*
+ * memory-pxa.S - memory setup for PXA architecture
+ *
+ * $Id: memsetup-pxa.S,v 1.1 2003/08/07 19:46:54 abz Exp $
+ *
+ * Copyright (C) 2003 Abraham van der Merwe <abz@4dllc.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+.ident "$Id: memsetup-pxa.S,v 1.1 2003/08/07 19:46:54 abz Exp $"
+
+#ifdef HAVE_CONFIG_H
+#include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+
+.text
+
+#define MDCNFG_OFFSET	0x00
+#define MDREFR_OFFSET	0x04
+#define MSC0_OFFSET		0x08
+#define MSC1_OFFSET		0x0c
+#define MSC2_OFFSET		0x10
+#define MECR_OFFSET		0x14
+#define SXLCR_OFFSET	0x18
+#define SXCNFG_OFFSET	0x1c
+#define SXMRS_OFFSET	0x24
+#define MCMEM0_OFFSET	0x28
+#define MCMEM1_OFFSET	0x2c
+#define MCATT0_OFFSET	0x30
+#define MCATT1_OFFSET	0x34
+#define MCIO0_OFFSET	0x38
+#define MCIO1_OFFSET	0x3c
+#define MDMRS_OFFSET	0x40
+
+/*
+ * The sequence below is based on the recommended init steps detailed
+ * in the Intel PXA255 Processor Developer's Manual Section 6.11
+ */
+
+.macro wait
+	ldr		r2, =OSCR
+	mov		r3, #0
+	str		r3, [r2]
+0:
+	ldr		r3, [r2]
+	cmp		r3, #768
+	bls		0b
+.endm
+
+.globl memsetup
+memsetup:
+	/* wait for internal clocks to stabilize */
+	wait
+
+	ldr		r1, =0x48000000
+
+	error
+
+	/* write MSC0, read back to ensure data latches */
+#ifdef MSC0_VALUE
+	ldr		r0, =MSC0_VALUE
+	str		r0, [r1, #MSC0_OFFSET]
+	ldr		r0, [r1, #MSC0_OFFSET]
+#endif	/* #ifdef MSC0_VALUE */
+
+	/* write MSC1, read back to ensure data latches */
+#ifdef MSC1_VALUE
+	ldr		r0, =MSC1_VALUE
+	str		r0, [r1, #MSC1_OFFSET]
+	ldr		r0, [r1, #MSC1_OFFSET]
+#endif	/* #ifdef MSC1_VALUE */
+
+	/* write MSC2, read back to ensure data latches */
+#ifdef MSC2_VALUE
+	ldr		r0, =MSC2_VALUE
+	str		r0, [r1, #MSC2_OFFSET]
+	ldr		r0, [r1, #MSC2_OFFSET]
+#endif	/* #ifdef MSC2_VALUE */
+
+	/* write MECR */
+#ifdef MECR_VALUE
+	ldr		r0, =MECR_VALUE
+	str		r0, [r1, #MECR_OFFSET]
+#endif	/* #ifdef MECR_VALUE */
+
+	/* write MCMEM0 */
+#ifdef MCMEM0_VALUE
+	ldr		r0, =MCMEM0_VALUE
+	str		r0, [r1, #MCMEM0_OFFSET]
+#endif	/* #ifdef MCMEM0_VALUE */
+
+	/* write MCMEM1 */
+#ifdef MCMEM1_VALUE
+	ldr		r0, =MCMEM1_VALUE
+	str		r0, [r1, #MCMEM1_OFFSET]
+#endif	/* #ifdef MCMEM1_VALUE */
+
+	/* write MCATT0 */
+#ifdef MCATT0_VALUE
+	ldr		r0, =MCATT0_VALUE
+	str		r0, [r1, #MCATT0_OFFSET]
+#endif	/* #ifdef MCATT0_VALUE */
+
+	/* write MCATT1 */
+#ifdef MCATT1_VALUE
+	ldr		r0, =MCATT1_VALUE
+	str		r0, [r1, #MCATT1_OFFSET]
+#endif	/* #ifdef MCATT1_VALUE */
+
+	/* write MCIO0 */
+#ifdef MCIO0_VALUE
+	ldr		r0, =MCIO0_VALUE
+	str		r0, [r1, #MCIO0_OFFSET]
+#endif	/* #ifdef MCIO0_VALUE */
+
+	/* write MCIO1 */
+#ifdef MCIO1_VALUE
+	ldr		r0, =MCIO1_VALUE
+	str		r0, [r1, #MCIO1_OFFSET]
+#endif	/* #ifdef MCIO1_VALUE */
+
+	/* get the mdrefr settings (k0run, e0pin, etc.) */
+	ldr		r3,  =MDREFR_VALUE
+
+	/* extract DRI field (we need a valid DRI field) */
+	ldr		r2, =0xfff
+	and		r3, r3, r2
+
+	/* get the reset state of MDREFR */
+	ldr		r4, [r1, #MDREFR_OFFSET]
+
+	/* clear the DRI field */
+	bic		r4, r4, r2
+
+	/* insert the valid DRI field loaded above */
+	orr		r4, r4, r3
+
+	/* write back MDREFR */
+	str		r4, [r1, #MDREFR_OFFSET]
+
+	/*
+	 * I am hard-coding in 50/100/300 clock speeds for now.
+	 * This needs testing since I hacked up a large, ugly version
+	 * of this that was Lubbock-specific. -Rusty
+     */
+
+	/* clear the free-running clock bits (clear K0Free, K1Free, K2Free) */
+	bic		r4, r4, #(0x00800000 | 0x01000000 | 0x02000000)
+
+	/* set K1RUN if bank 0 installed */
+	orr		r4, r4, #0x00010000
+
+	/* set K1DB2 (SDClk[1] = MemClk/2) */
+	orreq	r4, r4, #0x00020000
+
+	/* write back MDREFR */
+	str		r4, [r1, #MDREFR_OFFSET]
+	ldr		r4, [r1, #MDREFR_OFFSET]
+
+	/* deassert SLFRSH */
+	bic		r4, r4, #0x00400000
+
+	/* write back MDREFR */
+	str		r4, [r1, #MDREFR_OFFSET]
+
+	/* assert E1PIN */
+	orr		r4, r4, #0x00008000
+
+	/* write back MDREFR */
+	str		r4, [r1, #MDREFR_OFFSET]
+	ldr		r4, [r1, #MDREFR_OFFSET]
+
+.rept 3
+	nop
+.endr
+
+	/* fetch platform value of MDCNFG */
+	ldr		r2, =MDCNFG_VALUE
+
+	/* disable all sdram banks */
+	bic		r2, r2, #(MDCNFG_DE0 | MDCNFG_DE1)
+	bic		r2, r2, #(MDCNFG_DE2 | MDCNFG_DE3)
+
+	/* write initial value of MDCNFG, w/o enabling sdram banks */
+	str		r2, [r1, #MDCNFG_OFFSET]
+
+	/* wait for internal clocks to stabilize */
+	wait
+
+	/* turn everything off (caches off, MMU off, etc.) */
+	mov		r0, #0x78
+	mcr		p15, 0, r0, c1, c0, 0
+
+	/*
+	 * Access memory *not yet enabled* for CBR refresh cycles (8)
+	 * CBR is generated for all banks
+	 */
+
+	ldr     r2, =PXA_SDRAM_BANK0
+
+.rept 8
+	str		r2, [r2]
+.endr
+
+	/* fetch current MDCNFG value */
+	ldr		r3, [r1, #MDCNFG_OFFSET]
+
+	/* enable sdram bank 0 if installed (must do for any populated bank) */
+	orr		r3, r3, #MDCNFG_DE0
+
+	/* write back mdcnfg, enabling the sdram bank(s) */
+	str		r3, [r1, #MDCNFG_OFFSET]
+
+	/* write MDMRS */
+	ldr		r2, =MDMRS_VALUE
+	str		r2, [r1, #MDMRS_OFFSET]
+
+	mov		pc, lr
+
Index: build_tree/bootLoader/src/blob/memsetup-s3c2500.S
diff -u /dev/null build_tree/bootLoader/src/blob/memsetup-s3c2500.S:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/memsetup-s3c2500.S	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,165 @@
+/*
+ * memsetup-s3c2500.S: memory setup for the s3c2500
+ *
+ * $Id: memsetup-s3c2500.S,v 1.1 2003/09/04 18:03:09 russd Exp $
+ *
+ * Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003 Russ Dill (Russ.Dill@asu.edu)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+/*
+ * Documentation:
+ *
+ */
+
+.ident "$Id: memsetup-s3c2500.S,v 1.1 2003/09/04 18:03:09 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+/***********************************************************************
+ * NOTICE:
+ * PLEASE dont use kernel headers. Why? Because it fscks up everything
+ * as soon as they change. And yes, they change. And we're dependant of
+ * the kernel version the user has installed, and that's bad.
+ *
+ * We want blob to compile right out of the box.
+ *   - stefan
+ */
+#define BLOB_NEED_MEMCONFIG
+#include <blob/arch.h>
+
+.text
+.globl memsetup
+
+MEM_START:	.long	0x40000000
+
+/*
+ * CFGREG : SDRAM Configuration 0 register 
+ * note that ras, rc, rcd, and rp regs are *actual* values, not
+ * the value + 1 
+ */
+cfgreg:		.long	\
+	(RAS(6) | RC(9) | RCD(3) | RP(3) | \
+	 D1_128M | D0_128M | CL(3) | NO_AP | XW32)
+
+ 
+/* CMDREG : SDRAM Configuration 1 register */
+cmdreg:		.long	(0)
+
+/* refresh rate */
+refcyc:		.long	\
+	(GET_MHz(BUS_SPEED) * 15 + ((GET_MHz(BUS_SPEED) * 6) / 10))
+
+/* Flash config, may need to be put into the board file */
+#define FLASH_SPEED 90
+b0con:		.long	\
+	(DW16 | BS(2) | \
+	TACC((FLASH_SPEED * GET_MHz(BUS_SPEED) + 999) / 1000) | \
+	TPA(0xE) | TACS(0) | TCOS(0) | TCOH(0))
+
+
+/* Architecture headers can customized the memory setup behavior with
+ * the following defines:
+ *	 
+ *   ARCH_SPECIFIC_MEMSETUP	
+ *	arch does its own memort setup. must define memsetup somewhere
+ *	which should do whatever it needs to do and do a standard
+ *	assembly linkage return (mov pc, lr).
+ *
+ *   ARCH_SPECIFIC_MEMSETUP_STD
+ *      arch needs std_memsetup procedure.  ignored except when
+ *	ARCH_SPECIFIC_MEMSETUP is defined.
+ */
+	
+
+/* -------------------------------------------------- */	
+/* standard memory configuration */
+
+#if !defined(ARCH_SPECIFIC_MEMSETUP) || defined(ARCH_SPECIFIC_MEMSETUP_STD)
+	
+.globl std_memsetup	
+std_memsetup:
+	/* Set up the SDRAM */
+	mov	r0, #ASIC_BASE
+	orr	r0, r0, #SDRAMB
+
+	/* Step 1: Complete a power-on wait period (typically 100-200 usec)
+	 * to allow clocks to come up to speed */
+	mov	r4, #0x2800	/* DDD: way longer than 200 usec */
+1:	subs	r4, r4, #1
+	bne	1b
+
+	/* Step 2: Program INIT[1:0] of the CFGREG to 01. This issues a 
+	 * PALL command */
+	/* CMDREG, CMDREG, bad documentation, BAD! */
+	mov	r1, #PALL
+	str	r1, [r0, #CMDREG]
+
+	/* Step 3: Write 0xF into the refresh timer register.
+	mov	r1, #0x20
+	str	r1, [r0, #REFREG]
+
+	/* Step 4: Wait 120 clock cycles to get at least 8 refreshes */
+	mov	r4, #0x78
+1:	subs	r4, r4, #1 /* more than 120 cycles */
+	bne	1b
+
+	/* Step 5: Program the normal operational value into the refresh timer */
+	ldr	r1, refcyc
+	str	r1, [r0, #REFREG]
+	
+	/* Step 6: Program the CFGREG to the normal value */
+	ldr	r1, cfgreg
+	str	r1, [r0, #CFGREG]	
+
+	/* Step 7: Program the INIT[1:0] to b10 to issue an MRS command */
+	mov	r1, #MRS
+	str	r1, [r0, #CMDREG]
+
+	/* Step 8: Program the INIT[1:0] to 00 to enter normal mode */
+	mov	r1, #INIT(0)
+	str	r1, [r0, #CMDREG]
+
+	/* Step 9: Program the CMDREG and WBTOREG to normal values */
+	ldr	r1, cmdreg
+	str	r1, [r0, #CMDREG]
+
+	mov	r1, #0
+	str	r1, [r0, #WBTOREG]
+
+	/* Setup the flash bank */
+	mov	r0, #ASIC_BASE
+	orr	r0, r0, #BCONB
+	ldr	r1, b0con
+	str	r1, [r0, #B0CON]
+
+	mov	pc, lr
+#endif
+
+/* -------------------------------------------------- */	
+	
+#if !defined(ARCH_SPECIFIC_MEMSETUP)
+memsetup:
+	b	std_memsetup
+#endif
+	
+	
+/* -------------------------------------------------- */	
+	
+/* Arch specific setup */
Index: build_tree/bootLoader/src/blob/memsetup-sa1100.S
diff -u build_tree/bootLoader/src/blob/memsetup-sa1100.S:1.1.1.1 build_tree/bootLoader/src/blob/memsetup-sa1100.S:1.1.1.2
--- build_tree/bootLoader/src/blob/memsetup-sa1100.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/memsetup-sa1100.S	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,7 @@
 /*
  * memsetup-sa1100.S: memory setup for various SA1100 architectures
  *
- * $Id: memsetup-sa1100.S,v 1.2 2001/11/04 23:16:26 erikm Exp $
+ * $Id: memsetup-sa1100.S,v 1.5 2002/07/25 17:25:59 choover Exp $
  *
  * Copyright (C) 1999 2000 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl) and
  *                     Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl)
@@ -27,7 +27,7 @@
  *     Developer's Manual", April 1999
  */
 
-.ident "$Id: memsetup-sa1100.S,v 1.2 2001/11/04 23:16:26 erikm Exp $"
+.ident "$Id: memsetup-sa1100.S,v 1.5 2002/07/25 17:25:59 choover Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -44,11 +44,11 @@
 
 MEM_BASE:	.long	0xa0000000
 MEM_START:	.long	MEMORY_START
-#define	MDCNFG	0x0
-#define MDCAS0	0x04
-#define MDCAS1	0x08
-#define MDCAS2	0x0c
-#define MCS0	0x10
+#define	_MDCNFG	0x0
+#define _MDCAS0	0x04
+#define _MDCAS1	0x08
+#define _MDCAS2	0x0c
+#define _MCS0	0x10
 
 
 
@@ -89,7 +89,12 @@
 mdcas0:		.long	0xc71c703f
 mdcas1:		.long	0xffc71c71
 mdcas2:		.long	0xffffffff
+/* 10 rows */
 mdcnfg:		.long	0x0334b21f
+/* 11 rows - makes lower memory 8 1M banks */
+/* mdcnfg:		.long	0x0334b22f */
+/* 12 rows - makes lower memory 8 1M banks */
+/* mdcnfg:		.long	0x0334b23f */
 mcs0:		.long	0xfff84458
 #endif
 
@@ -102,25 +107,25 @@
 	ldr	r0, MEM_BASE
 	
 	ldr	r1, mcs0
-	str	r1, [r0, #MCS0]
+	str	r1, [r0, #_MCS0]
 	
 	/* Set up the DRAM */
 	
 	/* MDCAS0 */
 	ldr	r1, mdcas0
-	str	r1, [r0, #MDCAS0]
+	str	r1, [r0, #_MDCAS0]
 
 	/* MDCAS1 */
 	ldr	r1, mdcas1
-	str	r1, [r0, #MDCAS1]
+	str	r1, [r0, #_MDCAS1]
 
 	/* MDCAS2 */
 	ldr	r1, mdcas2
-	str	r1, [r0, #MDCAS2]
+	str	r1, [r0, #_MDCAS2]
 
 	/* MDCNFG */
 	ldr	r1, mdcnfg
-	str	r1, [r0, #MDCNFG]
+	str	r1, [r0, #_MDCNFG]
 
 	/* Issue read requests to disabled bank to start refresh */
 	/* this is required by the Micron memory on a TuxScreen */
Index: build_tree/bootLoader/src/blob/memsetup-sa1110.S
diff -u build_tree/bootLoader/src/blob/memsetup-sa1110.S:1.1.1.1 build_tree/bootLoader/src/blob/memsetup-sa1110.S:1.1.1.2
--- build_tree/bootLoader/src/blob/memsetup-sa1110.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/memsetup-sa1110.S	Fri Nov  9 09:44:05 2007
@@ -1,7 +1,7 @@
 /*
  * memsetup-sa1110.S: memory setup for various SA1110 architectures
  *
- * $Id: memsetup-sa1110.S,v 1.8 2001/12/27 18:27:37 erikm Exp $
+ * $Id: memsetup-sa1110.S,v 1.19 2003/08/20 23:06:11 seletz Exp $
  *
  * Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
@@ -38,21 +38,51 @@
  *
  */
 
-.ident "$Id: memsetup-sa1110.S,v 1.8 2001/12/27 18:27:37 erikm Exp $"
+.ident "$Id: memsetup-sa1110.S,v 1.19 2003/08/20 23:06:11 seletz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+/***********************************************************************
+ * NOTICE:
+ * PLEASE dont use kernel headers. Why? Because it fscks up everything
+ * as soon as they change. And yes, they change. And we're dependant of
+ * the kernel version the user has installed, and that's bad.
+ *
+ * We want blob to compile right out of the box.
+ *   - stefan
+ */
 #define BLOB_NEED_MEMCONFIG
-#include <blob/memsetup.h>
 #include <blob/arch.h>
+#include <blob/memsetup.h>
 
-			
 .text
-MEM_REG_BASE:	.long	0xa0000000
+.globl memsetup
+
+MEM_REG_BASE:	.long	MEM_CONF_BASE
 MEM_START:	.long	MEMORY_START
+PWR_BASE:	.long	PM_BASE
 
+/* Architecture headers can customized the memory setup behavior with
+ * the following defines:
+ *	 
+ *   ARCH_SPECIFIC_MEMSETUP	
+ *	arch does its own memort setup. must define memsetup somewhere
+ *	which should do whatever it needs to do and do a standard
+ *	assembly linkage return (mov pc, lr).
+ *
+ *   ARCH_SPECIFIC_MEMSETUP_STD
+ *      arch needs std_memsetup procedure.  ignored except when
+ *	ARCH_SPECIFIC_MEMSETUP is defined.
+ */
+	
+
+/* -------------------------------------------------- */	
+/* standard memory configuration */
+
+#if !defined(ARCH_SPECIFIC_MEMSETUP) || defined(ARCH_SPECIFIC_MEMSETUP_STD)
+	
 MEMORY_CONFIG:
 	.long	MDCNFG_VALUE		/* 0x0  MDCNFG */
 	.long	MDCAS00_VALUE		/* 0x04 MDCAS00 */
@@ -61,74 +91,119 @@
 	.long	MSC0_VALUE		/* 0x10 MSC0 */
 	.long	MSC1_VALUE		/* 0x14 MSC1 */
 	.long	MECR_VALUE		/* 0x18 MECR */
+#ifdef MDREFR_DONT_BELIEVE_IN_MAGIC
+	.long	MDREFR_VALUE
+#else
 	.long	0xdeadbeef		/* 0x1C MDREFR */
+#endif		
 	.long	MDCAS20_VALUE		/* 0x20 MDCAS20 */
 	.long	MDCAS21_VALUE		/* 0x24 MDCAS21 */
 	.long	MDCAS22_VALUE		/* 0x28 MDCAS22 */
 	.long	MSC2_VALUE		/* 0x2C MSC2 */
 	.long	SMCNFG_VALUE		/* 0x30 SMCNFG */
 
-.globl memsetup
-memsetup:
-	mov r5, lr
-
+.globl std_memsetup	
+std_memsetup:
 	/* Set up the SDRAM */
 	ldr	r0, MEM_REG_BASE
 	adr	r1, MEMORY_CONFIG
 
-	ldr	r2, [r1, #MDCNFG ]
-	str	r2, [r0, #MDCNFG ]
-
-	ldr	r2, [r1, #MDCAS00 ]
-	str	r2, [r0, #MDCAS00 ]
-
-	ldr	r2, [r1, #MDCAS01 ]
-	str	r2, [r0, #MDCAS01 ]
-
-	ldr	r2, [r1, #MDCAS02 ]
-	str	r2, [r0, #MDCAS02 ]
-
-	ldr	r2, [r1, #MDCAS20 ]
-	str	r2, [r0, #MDCAS20 ]
-
-	ldr	r2, [r1, #MDCAS21 ]
-	str	r2, [r0, #MDCAS21 ]
-
-	ldr	r2, [r1, #MDCAS22 ]
-	str	r2, [r0, #MDCAS22 ]
-
+	/* OK folks. These values are _offsets_ from
+	 * MEM_REG_BASE and have _nothing_ to do with
+	 * the kernel include file values, which defines
+	 * them as _absolute_ values.
+	 *
+	 * The following works _only_ because the table above
+	 * uses the same offsets.
+	 */
+	ldr	r2, [r1, #_MDCNFG ]
+	str	r2, [r0, #_MDCNFG ]
+
+	ldr	r2, [r1, #_MDCAS00 ]
+	str	r2, [r0, #_MDCAS00 ]
+
+	ldr	r2, [r1, #_MDCAS01 ]
+	str	r2, [r0, #_MDCAS01 ]
+
+	ldr	r2, [r1, #_MDCAS02 ]
+	str	r2, [r0, #_MDCAS02 ]
+
+	ldr	r2, [r1, #_MDCAS20 ]
+	str	r2, [r0, #_MDCAS20 ]
+
+	ldr	r2, [r1, #_MDCAS21 ]
+	str	r2, [r0, #_MDCAS21 ]
+
+	ldr	r2, [r1, #_MDCAS22 ]
+	str	r2, [r0, #_MDCAS22 ]
+
+	/*
+	 * Refer to sections 9.5.3.7: Reviving DRAMS from Self-Refresh Mode
+	 * and 10.2.1: Hardware or Sleep Reset Procedures
+	 */
+	/* Step 1: Complete a power-on wait period (typically 100-200 usec)
+	 * to allow clocks to come up to speed */
+	mov	r4, #0x2000        /* DDD: way longer than 200 usec */
+spin:	subs	r4, r4, #1
+	bne	spin
+
+	/* Step 2 is for systems with SMROM, so we'll skip it. */
+
+	/* Step 3: clear DH
+	 * NOTE: do NOT clear SSS, the kernel wants it set */
+	ldr	r1, PWR_BASE
+	mov	r2, #PSSR_DH
+	str	r2, [r1, #_PSSR]    /* clear DH by writing 1 to it */
+
+
+#ifdef MDREFR_DONT_BELIEVE_IN_MAGIC
+	ldr	r2, [r1, #_MDREFR ]
+	str	r2, [r0, #_MDREFR ]
+#else
 	/* clear KxDB2 */
-	ldr r2, [ r0, #MDREFR ]
+	ldr r2, [ r0, #_MDREFR ]
 	bic r2, r2, #MDREFR_K0DB2
 	bic r2, r2, #MDREFR_K1DB2
 	bic r2, r2, #MDREFR_K2DB2
-	str r2, [ r0, #MDREFR ]
+	bic r2, r2, #0xff          /* clear TRASR and DRI */
+	bic r2, r2, #0xff00
+	str r2, [ r0, #_MDREFR ]
 
 	/* set TRASR and DRI, KxDB2 */
-	ldr r2, [ r0, #MDREFR ]
+	ldr r2, [ r0, #_MDREFR ]
 	orr r2, r2, #MDREFR_TRASR(7)
 	orr r2, r2, #MDREFR_DRI(12)
+	/* only set DB2 bits when _not_ running
+	 * the SDRAM at full clock speed
+	 */
+#ifndef MDREFR_MEMCLK_FULLSPEED_0
 	orr r2, r2, #MDREFR_K0DB2
+#endif
+#ifndef MDREFR_MEMCLK_FULLSPEED_1
 	orr r2, r2, #MDREFR_K1DB2
+#endif
+#ifndef MDREFR_MEMCLK_FULLSPEED_2
 	orr r2, r2, #MDREFR_K2DB2
-	str r2, [ r0, #MDREFR ]
+#endif
+	str r2, [ r0, #_MDREFR ]
 
 	/* set KxRUN */
-	ldr r2, [ r0, #MDREFR ]
+	ldr r2, [ r0, #_MDREFR ]
 	orr r2, r2, #MDREFR_K0RUN
 	orr r2, r2, #MDREFR_K1RUN
 	orr r2, r2, #MDREFR_K2RUN
-	str r2, [ r0, #MDREFR ]
+	str r2, [ r0, #_MDREFR ]
 
 	/* clear SLFRSH */
-	ldr r2, [ r0, #MDREFR ]
+	ldr r2, [ r0, #_MDREFR ]
 	bic r2, r2, #MDREFR_SLFRSH
-	str r2, [ r0, #MDREFR ]
+	str r2, [ r0, #_MDREFR ]
 
 	/* toggle E1PIN (set -> clear ) */
-	ldr r2, [ r0, #MDREFR ]
+	ldr r2, [ r0, #_MDREFR ]
 	orr r2, r2, #MDREFR_E1PIN
-	str r2, [ r0, #MDREFR ]
+	str r2, [ r0, #_MDREFR ]
+#endif
 
 	/* Issue read requests to disabled bank to start refresh */
 	ldr	r1, MEM_START
@@ -140,32 +215,45 @@
 	adr r1, MEMORY_CONFIG
 	
 	/* ENABLE SDRAM BANKS */
-	ldr	r2, [r0, #MDCNFG ]
+	ldr	r2, [r0, #_MDCNFG ]
 	orr	r2, r2, #0x00000003
 	orr	r2, r2, #0x00030000
-	str	r2, [r0, #MDCNFG]
+	str	r2, [r0, #_MDCNFG]
 
 	/* OPTIONALLY enable Autopowerup/down */
 #if 0
-	ldr r2, [ r0, #MDREFR ]
+	ldr r2, [ r0, #_MDREFR ]
 	orr r2, r2, #MDREFR_EAPD
 	orr r2, r2, #MDREFR_KAPD
-	str r2, [ r0, #MDREFR ]
+	str r2, [ r0, #_MDREFR ]
 #endif
 
-	ldr	r2, [r1, #MCS0 ]
-	str	r2, [r0, #MCS0 ]
+	ldr	r2, [r1, #_MCS0 ]
+	str	r2, [r0, #_MCS0 ]
 
-	ldr	r2, [r1, #MCS1 ]
-	str	r2, [r0, #MCS1 ]
+	ldr	r2, [r1, #_MCS1 ]
+	str	r2, [r0, #_MCS1 ]
 
-	ldr	r2, [r1, #MCS2 ]
-	str	r2, [r0, #MCS2 ]
+	ldr	r2, [r1, #_MCS2 ]
+	str	r2, [r0, #_MCS2 ]
 
-	ldr	r2, [r1, #SMCNFG ]
-	str	r2, [r0, #SMCNFG ]
+	ldr	r2, [r1, #_SMCNFG ]
+	str	r2, [r0, #_SMCNFG ]
 
-	ldr	r2, [r1, #MECR ]
-	str	r2, [r0, #MECR ]
+	ldr	r2, [r1, #_MECR ]
+	str	r2, [r0, #_MECR ]
+	
+	mov	pc, lr
+#endif
+
+/* -------------------------------------------------- */	
+	
+#if !defined(ARCH_SPECIFIC_MEMSETUP)
+memsetup:
+	b	std_memsetup
+#endif
+	
+	
+/* -------------------------------------------------- */	
 	
-	mov	pc, r5
+/* Arch specific setup */
Index: build_tree/bootLoader/src/blob/miniprint.c
diff -u /dev/null build_tree/bootLoader/src/blob/miniprint.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/miniprint.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,64 @@
+/*
+ * miniprint.c: FGAG miniprint  specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Modified 2002 for Miniprint by Urs Kaufmann
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: miniprint.c,v 1.4 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
+
+/* flash descriptor for Miniprint flash */
+/* 2x Intel 28F128J3A strataflash (a 16MB) */
+static flash_descriptor_t miniprint_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 64,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+static void init_miniprint_flash_driver(void)
+{
+	flash_descriptors = miniprint_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+}
+__initlist(init_miniprint_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+static void miniprint_init_hardware(void)
+{
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+__initlist(miniprint_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/nesa.c
diff -u build_tree/bootLoader/src/blob/nesa.c:1.1.1.1 build_tree/bootLoader/src/blob/nesa.c:1.1.1.2
--- build_tree/bootLoader/src/blob/nesa.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/nesa.c	Fri Nov  9 09:44:05 2007
@@ -19,7 +19,7 @@
  *
  */
 
-#ident "$Id: nesa.c,v 1.5 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: nesa.c,v 1.10 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -27,19 +27,29 @@
 
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
 
 
 
 
 /* flash descriptor for NESA flash */
-/* 2x AMD *whatever* flash (4MB) */
-static flash_descriptor_t nesa_flash_descriptors[] =
+/* 2x AMD Am29LV160DB flash (4MB) */
+static const flash_descriptor_t nesa_flash_descriptors[] =
 {
-#warning "Please fix NESA flash descriptor"
-	{ 
+	{
+		size: 2 * 16 * 1024,
+		num: 1,
+	},
+	{
 		size: 2 * 8 * 1024,
-		num: 8,
+		num: 2,
+	},
+	{ 
+		size: 2 * 32 * 1024,
+		num: 1,
 	},
 	{
 		size: 2 * 64 * 1024,
@@ -66,8 +76,11 @@
 
 static void nesa_init_hardware(void)
 {
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(nesa_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/nullflash.c
diff -u build_tree/bootLoader/src/blob/nullflash.c:1.1.1.1 build_tree/bootLoader/src/blob/nullflash.c:1.1.1.2
--- build_tree/bootLoader/src/blob/nullflash.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/nullflash.c	Fri Nov  9 09:44:05 2007
@@ -19,12 +19,13 @@
  *
  */
 
-#ident "$Id: nullflash.c,v 1.4 2001/12/28 01:06:12 erikm Exp $"
+#ident "$Id: nullflash.c,v 1.5 2002/02/13 00:06:11 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/debug.h>
 #include <blob/errno.h>
 #include <blob/error.h>
 #include <blob/flash.h>
@@ -35,10 +36,8 @@
 
 static int flash_erase_null(u32 *addr)
 {
-#ifdef BLOB_DEBUG
-	printerrprefix();
-	SerialOutputString("No flash erase() function\n");
-#endif
+	deprintf("no flash erase() function\n");
+
 	return -EFLASHERASE;
 }
 
@@ -47,10 +46,8 @@
 
 static int flash_write_null(u32 *dst, const u32* src)
 {
-#ifdef BLOB_DEBUG
-	printerrprefix();
-	SerialOutputString("No flash write() function\n");
-#endif
+	deprintf("no flash write() function\n");
+
 	return -EFLASHPGM;
 }
 
@@ -59,10 +56,8 @@
 
 static int flash_lock_block_null(u32 *blockStart)
 {
-#ifdef BLOB_DEBUG
-	printerrprefix();
-	SerialOutputString("No flash lock_block() function\n");
-#endif
+	deprintf("no flash lock_block() function\n");
+
 	return -EFLASHPGM;
 }
 
@@ -70,10 +65,8 @@
 
 static int flash_unlock_block_null(u32 *blockStart)
 {
-#ifdef BLOB_DEBUG
-	printerrprefix();
-	SerialOutputString("No flash unlock_block() function\n");
-#endif
+	deprintf("no flash unlock_block() function\n");
+
 	return -EFLASHPGM;
 }
 
@@ -82,10 +75,8 @@
 
 static int flash_query_block_lock_null(u32 *blockStart)
 {
-#ifdef BLOB_DEBUG
-	printerrprefix();
-	SerialOutputString("No flash query_block_lock() function\n");
-#endif
+	deprintf("no flash query_block_lock() function\n");
+
 	return 0;
 }
 
Index: build_tree/bootLoader/src/blob/param_block.c
diff -u build_tree/bootLoader/src/blob/param_block.c:1.1.1.1 build_tree/bootLoader/src/blob/param_block.c:1.1.1.2
--- build_tree/bootLoader/src/blob/param_block.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/param_block.c	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      param_block.c
- * Version:       $Id: param_block.c,v 1.5 2002/01/03 16:07:18 erikm Exp $
+ * Version:       $Id: param_block.c,v 1.11 2003/09/04 18:34:26 russd Exp $
  * Copyright:     Copyright (C) 2001, Russ Dill
  * Author:        Russ Dill <Russ.Dill@asu.edu>
  * Description:   Paramater block tags for blob
@@ -29,19 +29,23 @@
  *
  */
 
-#ident "$Id: param_block.c,v 1.5 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: param_block.c,v 1.11 2003/09/04 18:34:26 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/arch.h>
 #include <blob/types.h>
 #include <blob/param_block.h>
 #include <blob/main.h>
 #include <blob/util.h>
-#include <blob/sa1100.h>
+#include <net/ether.h>
 
 
+#if (defined(PARAM_START) && !defined(PARAM_LEN))
+#error If PARAM_START is defined, PARAM_LEN must be too.
+#endif
 
 /*
  *  Paramater Tag parsing.
@@ -93,15 +97,23 @@
 
 __ptagtable(PTAG_BAUD, parse_ptag_baud);
 
-static int parse_ptag_gpio(const struct ptag *ptag)
+static int parse_ptag_hwaddr(const struct ptag *ptag)
 {
-	GPDR &= ~ptag->u.gpio.mask;
-	if ((GPSR & ptag->u.gpio.mask) == ptag->u.gpio.level) 
-		return -1;
-	else return 0;
+	/* 
+	 * If you have more than one arp address in your paramater
+	 * table, you can decide which one blob will use here. If
+	 * you give your ethernet driver a name in your board file
+	 * ie ether_driver->name = "eth1", then the name must match
+	 * with the name portion of the ptag. You can also use this
+	 * to cause blob to ignore the ptag altogether.
+	 */
+	if (!ether_get_name() ||
+	    !strncmp(ether_get_name(), ptag->u.hwaddr.name, 10))  
+		ether_set_addr((u8 *) ptag->u.hwaddr.hwaddr);
+	return 0;
 }
 
-__ptagtable(PTAG_GPIO, parse_ptag_gpio);
+__ptagtable(PTAG_HWADDR, parse_ptag_hwaddr);
 
 /*
  * Scan the tag table for this tag, and call its parse function.
@@ -114,14 +126,8 @@
 	struct ptagtable *t;
 
 	for (t = &__ptagtable_begin; t < &__ptagtable_end; t++)
-		if (ptag->hdr.ptag == t->ptag &&
-		   ((*conf & ptag->hdr.conf_mask) == ptag->hdr.conf)) {
-			if (t->parse(ptag) == -1) {
-				*conf |= ptag->hdr.fail_set_mask;
-				*conf &= ~ptag->hdr.fail_clear_mask;
-			}
-			break;
-		}
+		if (ptag->hdr.ptag == t->ptag && *conf == ptag->hdr.conf)
+			t->parse(ptag);
 
 	return t < &__ptagtable_end;
 }
Index: build_tree/bootLoader/src/blob/partition.c
diff -u build_tree/bootLoader/src/blob/partition.c:1.1.1.1 build_tree/bootLoader/src/blob/partition.c:1.1.1.3
--- build_tree/bootLoader/src/blob/partition.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/partition.c	Fri Nov  9 10:37:08 2007
@@ -1,9 +1,9 @@
 /*
  * partition.c: flash partitioning
  *
- * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Copyright (C) 2001 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: partition.c,v 1.2 2002/01/03 16:07:18 erikm Exp $
+ * $Id: partition.c,v 1.10 2003/08/07 19:31:01 abz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,55 +21,454 @@
  *
  */
 
-#ident "$Id: partition.c,v 1.2 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: partition.c,v 1.10 2003/08/07 19:31:01 abz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/command.h>
+#include <blob/errno.h>
+#include <blob/error.h>
 #include <blob/flash.h>
+#include <blob/init.h>
 #include <blob/partition.h>
 #include <blob/serial.h>
-#include <blob/error.h>
+#include <blob/util.h>
+
+#include <blob/debug.h>
+
+#define next_ptable_entry(s) \
+	(blob_partition_t *)((u32)s + s->next)
 
 
+/* pointers to the partition tables */
+const blob_partition_t *default_partition_table;
+blob_partition_t *flash_partition_table;
 
-static partition_table_t flash_partition_table;
+/* copy of the flash partition table in RAM */
+#define MAX_PARTITIONS	(64)
+static blob_partition_t ptable[MAX_PARTITIONS];
 
 
-/* FIXME: this is for the time being */
-extern int read_bootldr_partition_table(partition_table_t *ptable);
 
 
-static int read_partition_table(void)
+static int check_ptable_magic(const blob_partition_t *entry, u32 magic)
 {
-	int rv;
-	int i;
+	if(entry->magic != magic) {
+		deprintf("magic failed at 0x%08x (0x%08x != 0x%08x)\n",
+			(unsigned int)entry, 
+			entry->magic,
+			magic);
+		return -EMAGIC;
+	} else {
+		return 0;
+	}
+}
 	
-	/* so far we only know about bootldr flash partitions */
-	rv = read_bootldr_partition_table(&flash_partition_table);
 
+
+
+/* find the flash partition table */
+static void find_flash_ptable(void)
+{
+	u32 old_a, a;
+	int rv;
+
+	/* assume that the architecture dependent code has set 
+	 * the flash_partition_table pointer to something valid
+	 */
+	if(flash_partition_table->magic == BLOB_FLASH_PART_TABLE_MAGIC) {
+		printf("Immediately found flash partition table at 0x%08x\n",
+		       (unsigned int)flash_partition_table);
+		return;
+	}
+
+	/* apparently not. we now assume that the architecture
+	 * dependent code has put the flash_partition_table pointer at
+	 * the start of the flash, so we start scanning the start of
+	 * all flash blocks until we find a partition table.
+	 */
+//	printf("Searching flash partition table... \n");
+	rv = flash_get_first_block_address(&a);
 	if(rv < 0) {
-		printerror(rv, "can't get partition table\n");
-		return rv;
+		printf("first block not found\n");
+		return;
+	}
+
+	while(((blob_partition_t *)a)->magic != BLOB_FLASH_PART_TABLE_MAGIC) {
+		old_a = a;
+		rv = flash_get_next_block_address(&a, old_a);
+
+		if(rv < 0){
+			dprintf("not found\n");
+			return;
+		}
+
 	}
 
-	SerialOutputString("Flash partition layout:\n");
-	for(i = 0; i < flash_partition_table.numpartitions; i++) {
-		SerialOutputString("  0x");
-		SerialOutputHex(flash_partition_table.partition[i].size);
-		SerialOutputString(" @ 0x");
-		SerialOutputHex(flash_partition_table.partition[i].offset);
-
-		if(flash_partition_table.partition[i].flags & PART_LOAD) {
-			SerialOutputString(", load at 0x");
-			SerialOutputHex(flash_partition_table.partition[i].mem_base);
-			SerialOutputString(", entry point at 0x");
-			SerialOutputHex(flash_partition_table.partition[i].entry_point);
+	dprintf("found at 0x%08x\n",
+	       (unsigned int)a);
+	flash_partition_table = (blob_partition_t *)a;
+}
+
+
+
+
+/* copy partition table from src to dst. dst can only contain max_dst
+ * entries. src must be of type magic. also copy invalidated entries
+ * if copy_invalid != 0 */
+static int copy_ptable(const blob_partition_t *src, blob_partition_t *dst,
+		       u32 magic, int max_dst, int copy_invalid)
+{
+	int i = 1, rv = 0;
+
+	dprintf("copy from 0x%08x to 0x%08x,\n",
+		(u32)src, (u32)dst);
+	dprintf("magic = 0x%08x, max_dst = %d, copy_invalid = %d\n",
+		magic, max_dst, copy_invalid);
+
+	/* sanity check */
+	if(max_dst < 2) {
+		deprintf("max_dst too small (%i < 2)\n", max_dst);
+		return -EINVAL;
+	}
+
+	if(src->magic != magic) {
+		deprintf("src not of requested type (0x%08x != 0x%08x)\n",
+			 src->magic, magic);
+		return -EINVAL;
+	}
+	
+	/* copy start of partition table and go to next entry*/
+	memcpy(dst, src, src->next);
+	src = next_ptable_entry(src);
+	dst = next_ptable_entry(dst);
+	i++;
+
+	for(;;) {
+		/* we're at the last one */
+		if(i == max_dst) {
+			rv = -ERANGE;
+			break;
 		}
+
+		/* check for a valid entry and copy it */
+		rv = check_ptable_magic(src, BLOB_PART_VALID_MAGIC);
+		if(rv == 0)
+			goto do_copy;
+
+		/* check for an invalidated entry */
+		rv = check_ptable_magic(src, BLOB_PART_INVALID_MAGIC);
+		if(rv == 0) {
+			/* only copy when asked */
+			if(copy_invalid)
+				goto do_copy;
+			else
+				continue;
+		}
+
+		/* check for a last partition entry and stop if found */
+		rv = check_ptable_magic(src, BLOB_PART_LAST_MAGIC);
+		if(rv == 0) {
+			rv = 0;
+		} else {
+			/* we should NEVER reach this point */
+			dprintf("unknown entry at 0x%08x (08%08x)\n",
+				(unsigned int)src, src->magic);
+			dprintf("this should not happen, bailing out\n");
+			rv = -EMAGIC;
+		}
+		break;
+
+	do_copy:
+		memcpy(dst, src, src->next);
+		src = next_ptable_entry(src);
+		dst = next_ptable_entry(dst);
+		i++;
+	}
+
+	/* fill out last entry */
+	dst->magic = BLOB_PART_LAST_MAGIC;
+
+	dprintf("%d entries copied, returning %d\n", i, rv);
+
+	return rv;
+}
+
+
+
+
+static void ptable_print(const blob_partition_t *t)
+{
+	printf("Partition table for %d kB flash @ 0x%08x:\n",
+	       t->size / 1024, t->offset);
+	
+	for(;;) {
+		t = next_ptable_entry(t);
 		
-		serial_write('\n');
+		switch(t->magic) {
+		case BLOB_PART_LAST_MAGIC:
+			return;
+
+		case BLOB_PART_VALID_MAGIC:
+			printf("  0x%08x @ 0x%08x (%d kB): '%s'\n",
+			       t->size, t->offset, t->size, t->name);
+
+			if(t->flags & BLOB_PART_FLAG_PTABLE)
+				printf("    contains parameter blocks\n");
+
+			if(t->mem_base)
+				printf("    %sload at 0x%08x\n",
+				       (t->flags & BLOB_PART_FLAG_LOAD) ?
+				         "automatically " : "",
+				       t->mem_base);
+			
+			if(t->entry_point) {
+				printf("    entry point at 0x%08x",
+				       t->entry_point);
+				if(t->flags & BLOB_PART_FLAG_EXEC)
+					printf(", automatically execute\n");
+				else
+					printf("\n");
+			}
+
+			if(t->flags & BLOB_PART_FLAG_JFFS2)
+				printf("    contains JFFS2\n");
+
+			if(t->flags & BLOB_PART_FLAG_CRAMFS)
+				printf("    contains cramfs\n");
+			break;
+
+		case BLOB_PART_INVALID_MAGIC:
+			dprintf("invalidated entry\n");
+			break;
+
+		default:
+			eprintf("ptable magic failed at 0x%08x\n", (u32)t);
+			return;
+		}
+	}
+}
+
+static int fixup_ptable(blob_partition_t *ptable)
+{
+	/* walk through ptable and fix up BLOB_PART_OFS_APPEND and
+	   BLOB_PART_SIZ_FULL entries */
+
+	u32 offset = ptable->offset;
+	u32 size = ptable->size;
+	int no_more_parts_allowed = 0;
+	blob_partition_t *t = ptable;
+	
+	if (ptable->size == BLOB_PART_SIZ_FULL) {
+		ptable->size = size = flash_get_size();
+		dprintf("ptable->size => 0x%08X\n", ptable->size);
 	}
 
+	for(;;) {
+		t = next_ptable_entry(t);
+
+		switch(t->magic) {
+		case BLOB_PART_LAST_MAGIC:
+			return 0;
+
+		case BLOB_PART_INVALID_MAGIC:
+			break;
+
+		case BLOB_PART_VALID_MAGIC:
+			dprintf("part @ 0x%p\n", t);
+
+			if (no_more_parts_allowed) {
+				eprintf("ptable fixup found additional parts"
+					" after BLOB_PART_SIZ_FULL size\n");
+				return -EINVAL;
+			}
+
+			dprintf("  offset = 0x%08X\n", t->offset);
+			if (t->offset == BLOB_PART_OFS_APPEND) {
+				t->offset = offset;
+				dprintf("  offset => 0x%08X\n", t->offset);
+			}
+
+			dprintf("  size   = 0x%08X\n", t->size);
+			if (t->size == BLOB_PART_SIZ_FULL) {
+				t->size = size;
+				no_more_parts_allowed = 1;
+				dprintf("  size => 0x%08X\n", t->size);
+			}
+			offset += t->size;
+			size -= t->size;
+			break;
+
+		default:
+			eprintf("ptable magic failed at 0x%08x\n", (u32)t);
+			return -EINVAL;
+		}
+	}
+}
+
+
+static void ptable_init(void)
+{
+	int rv;
+
+	/* try to copy the default partition table */
+	rv = copy_ptable(default_partition_table, ptable,
+			 BLOB_DEFAULT_PART_TABLE_MAGIC, MAX_PARTITIONS, 0);
+
+	if(rv == 0) {
+		ptable->magic = BLOB_COPY_PART_TABLE_MAGIC;
+	}
+
+	/* try to find the flash partition table and try to copy it.
+	 * flash partition table overrides a default partition table.
+	 */
+	find_flash_ptable();
+	rv = copy_ptable(flash_partition_table, ptable,
+			 BLOB_FLASH_PART_TABLE_MAGIC, MAX_PARTITIONS, 1);
+	
+	if(rv == 0) {
+		ptable->magic = BLOB_COPY_PART_TABLE_MAGIC;
+		printf("found flash partition table at 0x%08x\n",
+			(unsigned int)flash_partition_table);
+	}
+
+	/* FIXME: if there is still no flash partition table found we
+	 * could check for a bootldr partition table over here */
+	
+	if (check_ptable_magic(ptable, BLOB_COPY_PART_TABLE_MAGIC) != 0)  {
+		printf("invalid partition table magic\n");
+		goto invalid_part;
+	}
+
+	if (fixup_ptable(ptable) != 0) {
+		printf("could not fix up partition table\n");
+		goto invalid_part;
+	}
+
+done:
+#ifdef BLOB_DEBUG
+	ptable_print(ptable);
+#endif
+	return;
+
+invalid_part:
+	/* construct a minimal partition table */
+	ptable[0].magic = BLOB_COPY_PART_TABLE_MAGIC;
+	ptable[0].next = sizeof(blob_partition_t);
+	ptable[0].offset = 0;
+	ptable[0].size = 0;
+	ptable[1].magic = BLOB_PART_LAST_MAGIC;
+	
+	goto done;
+}
+
+__initlist(ptable_init, INIT_LEVEL_OTHER_STUFF + 2);
+
+
+
+const blob_partition_t *pt_first(void)
+{
+	return pt_next(ptable);
+}
+
+const blob_partition_t *pt_next(const blob_partition_t *p)
+{
+	for (;;) {
+		p = next_ptable_entry(p);
+
+		switch (p->magic) {
+		case BLOB_PART_LAST_MAGIC:
+			return 0;
+		case BLOB_PART_VALID_MAGIC:
+			return p;
+		case BLOB_PART_INVALID_MAGIC:
+			break;
+		default:
+			return 0;
+		}
+	}
+}
+
+
+const blob_partition_t *pt_find_by_name(const char *s)
+{
+	blob_partition_t *t = ptable;
+
+	/* first entry is always the descriptor so it's safe to skip
+	 * it */
+
+	for(;;) {
+		t = next_ptable_entry(t);
+
+		switch(t->magic) {
+		case BLOB_PART_LAST_MAGIC:
+			/* this is the last one, we didn't find it :( */
+			return NULL;
+
+		case BLOB_PART_VALID_MAGIC:
+			if(strncmp(t->name, s, BLOB_PART_NAMELEN)==0)
+				return t;
+			break;
+
+		case BLOB_PART_INVALID_MAGIC:
+			/* skip */
+			break;
+
+		default:
+			eprintf("ptable magic failed at 0x%08x\n", (u32)t);
+			return NULL;
+		}
+	}
+}
+
+
+
+
+const blob_partition_t *pt_find_by_address(u32 addr)
+{
+	blob_partition_t *t = ptable;
+
+	for(;;) {
+		t = next_ptable_entry(t);
+
+		switch(t->magic) {
+		case BLOB_PART_LAST_MAGIC:
+			return NULL;
+
+		case BLOB_PART_VALID_MAGIC:
+			if((addr >= t->offset) && 
+			   (addr < (t->offset + t->size)))
+				return t;
+			break;
+
+		case BLOB_PART_INVALID_MAGIC:
+			break;
+
+		default:
+			eprintf("ptable magic failed at 0x%08x\n", (u32)t);
+			return NULL;
+		}
+	}
+}
+
+void *pt_flash_start(const blob_partition_t *p)
+{
+	/* absolute location within flash of the given partition */
+	return (void *) (ptable->offset + p->offset);
+}
+
+
+
+static int ptprint(int argc, char *argv[])
+{
+	ptable_print(ptable);
+
 	return 0;
 }
+
+static char ptprint_help[] = "ptprint\n"
+"print flash partition table\n";
+
+__commandlist(ptprint, "ptprint", ptprint_help);
Index: build_tree/bootLoader/src/blob/pleb.c
diff -u build_tree/bootLoader/src/blob/pleb.c:1.1.1.1 build_tree/bootLoader/src/blob/pleb.c:1.1.1.2
--- build_tree/bootLoader/src/blob/pleb.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/pleb.c	Fri Nov  9 09:44:05 2007
@@ -19,7 +19,7 @@
  *
  */
 
-#ident "$Id: pleb.c,v 1.5 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: pleb.c,v 1.9 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -28,7 +28,9 @@
 #include <blob/flash.h>
 #include <blob/init.h>
 #include <blob/led.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -51,7 +53,7 @@
 
 
 /* flash descriptor for PLEB flash. */
-static flash_descriptor_t pleb_flash_descriptors[] =
+static const flash_descriptor_t pleb_flash_descriptors[] =
 {
 #warning "Please add PLEB flash layout"
 	{
@@ -76,8 +78,11 @@
 
 static void pleb_init_hardware(void)
 {
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(pleb_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/pxa_idp.c
diff -u /dev/null build_tree/bootLoader/src/blob/pxa_idp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/pxa_idp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,248 @@
+/*
+ * accelent_sa.c: Accelent IDP specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@www.eletztrick.de)
+ * Copyright (C) 2002  Jeff Sutherland <jeffs@accelent.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+/**********************************************************************
+ * includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/command.h>
+#include <blob/uucodec.h>
+#include <blob/led.h>
+#include <blob/time.h>
+
+
+extern blob_status_t blob_status;
+
+/* flash descriptor for Accelent IDP flash. */
+/* Accelent PXA IDP uses 2xINTEL e28F128 Chips */
+static const flash_descriptor_t accelent_sa_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 128,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+static int accelent_sa_flash_enable_vpp(void)
+{
+	//TODO
+	//set GPIO17
+
+	return 0;
+}
+
+
+
+
+static int accelent_sa_flash_disable_vpp(void)
+{
+	//TODO
+	//reset GPIO17
+
+	return 0;
+}
+
+
+
+static void init_accelent_sa_flash_driver(void)
+{
+	flash_descriptors = accelent_sa_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+	flash_driver->enable_vpp = accelent_sa_flash_enable_vpp;
+	flash_driver->disable_vpp = accelent_sa_flash_disable_vpp;
+}
+
+__initlist(init_accelent_sa_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+
+static void accelent_sa_init_hardware(void)
+{
+	/* select drivers */
+	reboot_driver = &pxa_reboot_driver;
+	serial_driver = &pxa_serial_driver;
+	led_driver = /*&sa11x0_gpio_led_driver*/NULL;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(accelent_sa_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+#if 0
+/*********************************************************************
+ * cmd_download_file
+ *
+ * AUTOR:		SELETZ
+ * REVISED:
+ *
+ * Download a file to arbitary memory location
+ *
+ */
+int cmd_download_file( int argc, char *argv[] )
+{
+	int		ret		= 0;
+	u32		dest	= 0L;
+	u32		len	= 0L;
+
+	if ( argc < 3 )				return -EINVAL;
+
+	ret = strtou32( argv[1], &dest );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[2], &len );
+	if ( ret < 0 )				return -EINVAL;
+
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		SerialOutputString("Switching to download speed\n");
+		SerialOutputString("You have 60 seconds to switch your terminal emulator to the same speed and\n");
+		SerialOutputString("start downloading. After that " PACKAGE " will switch back to term speed.\n");
+	
+		serial_init(blob_status.downloadSpeed);
+	} else {
+		SerialOutputString("You have 60 seconds to start downloading.\n");
+	}
+
+	ret = UUDecode((char *)dest, len);
+	if ( ret == len ) {
+		SerialOutputString("Received ");
+		SerialOutputDec(ret);
+		SerialOutputString(" (0x");
+		SerialOutputHex(ret);
+		SerialOutputString(") bytes.\n");
+		ret = 0;
+	} else {
+		SerialOutputString("error during uudecode\n");
+	}
+	
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		SerialOutputString("\n(Please switch your terminal emulator back to terminal speed\n");
+		serial_init(blob_status.terminalSpeed);
+	}
+
+	return ret;
+}
+static char downloadhelp[] = "dlfile destadr filelength\n"
+"download file to memory\n";
+__commandlist( cmd_download_file, "dlfile", downloadhelp );
+
+/*********************************************************************
+ * cmd_flash_write
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash write access
+ *
+ */
+static int cmd_flash_write( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	src	= 0L;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 4 )				return -EINVAL;
+
+	ret = strtou32( argv[1], &src );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[2], &dest );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[3], &len );
+	if ( ret < 0 )				return -EINVAL;
+
+	if ( len & (0x3) ) {
+		len = (len>>2)  + 1;
+	} else {
+		len = len>>2;
+	}
+
+	_DBGU32( src );
+	_DBGU32( dest );
+	_DBGU32( len );
+
+	ret = flash_write_region( (u32 *)dest, (u32*)src, len );
+	return ret;
+}
+static char flashwritehelp[] = "fwrite srcadr destadr size(bytes)\n"
+"flash a memory region\n";
+__commandlist( cmd_flash_write, "fwrite", flashwritehelp );
+
+/*********************************************************************
+ * cmd_flash_erase
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash erasing
+ *
+ */
+static int cmd_flash_erase( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 3 )				return -EINVAL;
+
+	ret = strtou32( argv[1], &dest );
+	if ( ret < 0 )				return -EINVAL;
+
+	ret = strtou32( argv[2], &len );
+	if ( ret < 0 )				return -EINVAL;
+
+	if ( len & (0x3) ) {
+		len = (len>>2)  + 1;
+	} else {
+		len = len>>2;
+	}
+
+	ret = flash_erase_region( (u32 *)dest, len );
+	return ret;
+}
+static char flasherasehelp[] = "ferase adr size(bytes)\n"
+"erase a flash region\n";
+__commandlist( cmd_flash_erase, "ferase", flasherasehelp );
+#endif
Index: build_tree/bootLoader/src/blob/ramses.c
diff -u /dev/null build_tree/bootLoader/src/blob/ramses.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/ramses.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,105 @@
+/*
+ * ramses: M%N Ramses MN-CI stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@www.eletztrick.de)
+ * Copyright (C) 2002  Jeff Sutherland <jeffs@accelent.com>
+ * Copyright (C) 2003  Holger Schurig <h.schurig@mn-logistik.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+/**********************************************************************
+ * includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/command.h>
+#include <blob/uucodec.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+
+
+extern blob_status_t blob_status;
+
+/* flash descriptor for Ramses MN-CI flash. */
+/* Ramses uses 2xINTEL e28F128 Chips */
+static const flash_descriptor_t ramses_flash_descriptors[] =
+{
+	{
+		size: 2 * 128 * 1024,
+		num: 128,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+static int ramses_flash_enable_vpp(void)
+{
+	//TODO
+
+	return 0;
+}
+
+
+
+
+static int ramses_flash_disable_vpp(void)
+{
+	//TODO
+
+	return 0;
+}
+
+
+
+static void init_ramses_flash_driver(void)
+{
+	flash_descriptors = ramses_flash_descriptors;
+	flash_driver = &intel32_flash_driver;
+	flash_driver->enable_vpp = ramses_flash_enable_vpp;
+	flash_driver->disable_vpp = ramses_flash_disable_vpp;
+}
+
+__initlist(init_ramses_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+
+
+
+static void ramses_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &pxa_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(ramses_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
Index: build_tree/bootLoader/src/blob/reboot.c
diff -u build_tree/bootLoader/src/blob/reboot.c:1.1.1.1 build_tree/bootLoader/src/blob/reboot.c:1.1.1.2
--- build_tree/bootLoader/src/blob/reboot.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/reboot.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: reboot.c,v 1.7 2002/01/06 15:46:17 erikm Exp $
+ * $Id: reboot.c,v 1.8 2002/02/08 12:55:16 erikm Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: reboot.c,v 1.7 2002/01/06 15:46:17 erikm Exp $"
+#ident "$Id: reboot.c,v 1.8 2002/02/08 12:55:16 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -33,7 +33,6 @@
 #include <blob/error.h>
 #include <blob/init.h>
 #include <blob/main.h>
-#include <blob/serial.h>
 
 
 
@@ -45,11 +44,11 @@
 	/* sanity check */
 	if(blob_status.blobType == fromFlash) {
 		printerrprefix();
-		SerialOutputString("blob not downloaded\n");
+		printf("blob not downloaded\n");
 		return -EINVAL;
 	}
 
-	SerialOutputString("Restarting blob from RAM...\n\n");
+	printf("Restarting blob from RAM...\n\n");
 
 	serial_flush_output();
 
Index: build_tree/bootLoader/src/blob/rest-ld-script.in
diff -u build_tree/bootLoader/src/blob/rest-ld-script.in:1.1.1.1 build_tree/bootLoader/src/blob/rest-ld-script.in:1.1.1.2
--- build_tree/bootLoader/src/blob/rest-ld-script.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/rest-ld-script.in	Fri Nov  9 09:44:05 2007
@@ -4,7 +4,7 @@
  *
  * Copyright (C) 1999 2000 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl) and
  *
- * $Id: rest-ld-script.in,v 1.2 2002/01/07 15:00:15 erikm Exp $
+ * $Id: rest-ld-script.in,v 1.3 2002/02/07 22:56:22 erikm Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -92,12 +92,16 @@
 	.bss : {
 		__bss_start = .;
 		/* first the real BSS data */
-		*(.bss) 
+		*(.bss)
+		*(COMMON)
 
 		/* and next the stack */
 		. = ALIGN(4);
 		__stack_start = .;
-		*(.stack)
+
+		/* allocate an 8kB stack */		
+		. = . + 8 * 1024;
+
 		__stack_end = .;
 		__bss_end = .;
 	}
Index: build_tree/bootLoader/src/blob/rest.h
diff -u /dev/null build_tree/bootLoader/src/blob/rest.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:46 2008
+++ build_tree/bootLoader/src/blob/rest.h	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,14592 @@
+
+blob-rest-elf32:     file format elf32-littlearm
+
+Disassembly of section .text:
+
+a0300400 <__text_start>:
+a0300400:	e59f1040 	ldr	r1, [pc, #64]	; a0300448 <bss_start>
+a0300404:	e59f0040 	ldr	r0, [pc, #64]	; a030044c <bss_end>
+a0300408:	e0400001 	sub	r0, r0, r1
+a030040c:	e3a02000 	mov	r2, #0	; 0x0
+
+a0300410 <clear_bss>:
+a0300410:	e8a10004 	stmia	r1!, {r2}
+a0300414:	e2500004 	subs	r0, r0, #4	; 0x4
+a0300418:	1afffffc 	bne	a0300410 <clear_bss>
+a030041c:	e59f002c 	ldr	r0, [pc, #44]	; a0300450 <stack_end>
+a0300420:	e240d004 	sub	sp, r0, #4	; 0x4
+
+a0300424 <go_main>:
+a0300424:	e59f0028 	ldr	r0, [pc, #40]	; a0300454 <stack_end+0x4>
+a0300428:	e3a02046 	mov	r2, #70	; 0x46
+a030042c:	eb000000 	bl	a0300434 <go_char>
+a0300430:	ea0007b1 	b	a03022fc <main>
+
+a0300434 <go_char>:
+a0300434:	e5901014 	ldr	r1, [r0, #20]
+a0300438:	e2111020 	ands	r1, r1, #32	; 0x20
+a030043c:	0afffffc 	beq	a0300434 <go_char>
+a0300440:	e5c02000 	strb	r2, [r0]
+a0300444:	e1a0f00e 	mov	pc, lr
+
+a0300448 <bss_start>:
+a0300448:	a030df80 	eorges	sp, r0, r0, lsl #31
+
+a030044c <bss_end>:
+a030044c:	a0312404 	eorges	r2, r1, r4, lsl #8
+
+a0300450 <stack_end>:
+a0300450:	a0312404 	eorges	r2, r1, r4, lsl #8
+a0300454:	40700000 	rsbmis	r0, r0, r0
+
+a0300458 <data_to_flash>:
+a0300458:	e1a0f00e 	mov	pc, lr
+
+a030045c <data_from_flash>:
+a030045c:	e1a0f00e 	mov	pc, lr
+
+a0300460 <testram>:
+a0300460:	e92d401e 	stmdb	sp!, {r1, r2, r3, r4, lr}
+a0300464:	e8900006 	ldmia	r0, {r1, r2}
+a0300468:	e3a03055 	mov	r3, #85	; 0x55
+a030046c:	e3a040aa 	mov	r4, #170	; 0xaa
+a0300470:	e8800018 	stmia	r0, {r3, r4}
+a0300474:	e8900018 	ldmia	r0, {r3, r4}
+a0300478:	e3330055 	teq	r3, #85	; 0x55
+a030047c:	033400aa 	teqeq	r4, #170	; 0xaa
+a0300480:	1a000005 	bne	a030049c <bad>
+a0300484:	e3a030aa 	mov	r3, #170	; 0xaa
+a0300488:	e3a04055 	mov	r4, #85	; 0x55
+a030048c:	e8800018 	stmia	r0, {r3, r4}
+a0300490:	e8900018 	ldmia	r0, {r3, r4}
+a0300494:	e33300aa 	teq	r3, #170	; 0xaa
+a0300498:	03340055 	teqeq	r4, #85	; 0x55
+
+a030049c <bad>:
+a030049c:	e8800006 	stmia	r0, {r1, r2}
+a03004a0:	03a00000 	moveq	r0, #0	; 0x0
+a03004a4:	13a00001 	movne	r0, #1	; 0x1
+a03004a8:	e8bd801e 	ldmia	sp!, {r1, r2, r3, r4, pc}
+
+a03004ac <flash_dummy_ok>:
+a03004ac:	e1a0c00d 	mov	ip, sp
+a03004b0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03004b4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03004b8:	e3a03000 	mov	r3, #0	; 0x0
+a03004bc:	e1a00003 	mov	r0, r3
+a03004c0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03004c4 <print_flash_map>:
+a03004c4:	e1a0c00d 	mov	ip, sp
+a03004c8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03004cc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03004d0:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03004d4:	e59f00c4 	ldr	r0, [pc, #196]	; a03005a0 <print_flash_map+0xdc>
+a03004d8:	eb002970 	bl	a030aaa0 <printf>
+a03004dc:	e59f30c0 	ldr	r3, [pc, #192]	; a03005a4 <print_flash_map+0xe0>
+a03004e0:	e59f00c0 	ldr	r0, [pc, #192]	; a03005a8 <print_flash_map+0xe4>
+a03004e4:	e5931000 	ldr	r1, [r3]
+a03004e8:	eb00296c 	bl	a030aaa0 <printf>
+a03004ec:	e3a03000 	mov	r3, #0	; 0x0
+a03004f0:	e50b3010 	str	r3, [fp, -#16]
+a03004f4:	e59f30a8 	ldr	r3, [pc, #168]	; a03005a4 <print_flash_map+0xe0>
+a03004f8:	e51b2010 	ldr	r2, [fp, -#16]
+a03004fc:	e5933000 	ldr	r3, [r3]
+a0300500:	e1520003 	cmp	r2, r3
+a0300504:	ba000000 	blt	a030050c <print_flash_map+0x48>
+a0300508:	ea000023 	b	a030059c <print_flash_map+0xd8>
+a030050c:	e59f1098 	ldr	r1, [pc, #152]	; a03005ac <print_flash_map+0xe8>
+a0300510:	e51b2010 	ldr	r2, [fp, -#16]
+a0300514:	e1a03002 	mov	r3, r2
+a0300518:	e1a03083 	mov	r3, r3, lsl #1
+a030051c:	e0833002 	add	r3, r3, r2
+a0300520:	e1a03103 	mov	r3, r3, lsl #2
+a0300524:	e0833001 	add	r3, r3, r1
+a0300528:	e5933000 	ldr	r3, [r3]
+a030052c:	e50b3014 	str	r3, [fp, -#20]
+a0300530:	e59f0074 	ldr	r0, [pc, #116]	; a03005ac <print_flash_map+0xe8>
+a0300534:	e51b2010 	ldr	r2, [fp, -#16]
+a0300538:	e3a01008 	mov	r1, #8	; 0x8
+a030053c:	e1a03002 	mov	r3, r2
+a0300540:	e1a03083 	mov	r3, r3, lsl #1
+a0300544:	e0833002 	add	r3, r3, r2
+a0300548:	e1a03103 	mov	r3, r3, lsl #2
+a030054c:	e0833000 	add	r3, r3, r0
+a0300550:	e0833001 	add	r3, r3, r1
+a0300554:	e5933000 	ldr	r3, [r3]
+a0300558:	e3530000 	cmp	r3, #0	; 0x0
+a030055c:	0a00000a 	beq	a030058c <print_flash_map+0xc8>
+a0300560:	e59f3048 	ldr	r3, [pc, #72]	; a03005b0 <print_flash_map+0xec>
+a0300564:	e5933000 	ldr	r3, [r3]
+a0300568:	e5933010 	ldr	r3, [r3, #16]
+a030056c:	e3530000 	cmp	r3, #0	; 0x0
+a0300570:	0a000005 	beq	a030058c <print_flash_map+0xc8>
+a0300574:	e59f3034 	ldr	r3, [pc, #52]	; a03005b0 <print_flash_map+0xec>
+a0300578:	e5933000 	ldr	r3, [r3]
+a030057c:	e5933010 	ldr	r3, [r3, #16]
+a0300580:	e51b0014 	ldr	r0, [fp, -#20]
+a0300584:	e1a0e00f 	mov	lr, pc
+a0300588:	e1a0f003 	mov	pc, r3
+a030058c:	e51b3010 	ldr	r3, [fp, -#16]
+a0300590:	e2833001 	add	r3, r3, #1	; 0x1
+a0300594:	e50b3010 	str	r3, [fp, -#16]
+a0300598:	eaffffd5 	b	a03004f4 <print_flash_map+0x30>
+a030059c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03005a0:	a030c110 	eorges	ip, r0, r0, lsl r1
+a03005a4:	a030e580 	eorges	lr, r0, r0, lsl #11
+a03005a8:	a030c11c 	eorges	ip, r0, ip, lsl r1
+a03005ac:	a030df80 	eorges	sp, r0, r0, lsl #31
+a03005b0:	a030fd00 	eorges	pc, r0, r0, lsl #26
+
+a03005b4 <init_flash>:
+a03005b4:	e1a0c00d 	mov	ip, sp
+a03005b8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03005bc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03005c0:	e24dd018 	sub	sp, sp, #24	; 0x18
+a03005c4:	e59f0390 	ldr	r0, [pc, #912]	; a030095c <init_flash+0x3a8>
+a03005c8:	eb002934 	bl	a030aaa0 <printf>
+a03005cc:	e3a03000 	mov	r3, #0	; 0x0
+a03005d0:	e50b3010 	str	r3, [fp, -#16]
+a03005d4:	e3a03000 	mov	r3, #0	; 0x0
+a03005d8:	e50b3018 	str	r3, [fp, -#24]
+a03005dc:	e59f337c 	ldr	r3, [pc, #892]	; a0300960 <init_flash+0x3ac>
+a03005e0:	e5933000 	ldr	r3, [r3]
+a03005e4:	e3530000 	cmp	r3, #0	; 0x0
+a03005e8:	1a000002 	bne	a03005f8 <init_flash+0x44>
+a03005ec:	e59f0370 	ldr	r0, [pc, #880]	; a0300964 <init_flash+0x3b0>
+a03005f0:	eb00292a 	bl	a030aaa0 <printf>
+a03005f4:	ea0000d7 	b	a0300958 <init_flash+0x3a4>
+a03005f8:	e59f3368 	ldr	r3, [pc, #872]	; a0300968 <init_flash+0x3b4>
+a03005fc:	e5933000 	ldr	r3, [r3]
+a0300600:	e3530000 	cmp	r3, #0	; 0x0
+a0300604:	1a000002 	bne	a0300614 <init_flash+0x60>
+a0300608:	e59f035c 	ldr	r0, [pc, #860]	; a030096c <init_flash+0x3b8>
+a030060c:	eb002923 	bl	a030aaa0 <printf>
+a0300610:	ea0000d0 	b	a0300958 <init_flash+0x3a4>
+a0300614:	e59f334c 	ldr	r3, [pc, #844]	; a0300968 <init_flash+0x3b4>
+a0300618:	e5933000 	ldr	r3, [r3]
+a030061c:	e5933014 	ldr	r3, [r3, #20]
+a0300620:	e3530000 	cmp	r3, #0	; 0x0
+a0300624:	1a000003 	bne	a0300638 <init_flash+0x84>
+a0300628:	e59f3338 	ldr	r3, [pc, #824]	; a0300968 <init_flash+0x3b4>
+a030062c:	e5932000 	ldr	r2, [r3]
+a0300630:	e59f3338 	ldr	r3, [pc, #824]	; a0300970 <init_flash+0x3bc>
+a0300634:	e5823014 	str	r3, [r2, #20]
+a0300638:	e59f3328 	ldr	r3, [pc, #808]	; a0300968 <init_flash+0x3b4>
+a030063c:	e5933000 	ldr	r3, [r3]
+a0300640:	e5933018 	ldr	r3, [r3, #24]
+a0300644:	e3530000 	cmp	r3, #0	; 0x0
+a0300648:	1a000003 	bne	a030065c <init_flash+0xa8>
+a030064c:	e59f3314 	ldr	r3, [pc, #788]	; a0300968 <init_flash+0x3b4>
+a0300650:	e5932000 	ldr	r2, [r3]
+a0300654:	e59f3314 	ldr	r3, [pc, #788]	; a0300970 <init_flash+0x3bc>
+a0300658:	e5823018 	str	r3, [r2, #24]
+a030065c:	e59f32fc 	ldr	r3, [pc, #764]	; a0300960 <init_flash+0x3ac>
+a0300660:	e5933000 	ldr	r3, [r3]
+a0300664:	e5933004 	ldr	r3, [r3, #4]
+a0300668:	e3730001 	cmn	r3, #1	; 0x1
+a030066c:	1a000024 	bne	a0300704 <init_flash+0x150>
+a0300670:	e59f32e8 	ldr	r3, [pc, #744]	; a0300960 <init_flash+0x3ac>
+a0300674:	e5933000 	ldr	r3, [r3]
+a0300678:	e5933000 	ldr	r3, [r3]
+a030067c:	e50b301c 	str	r3, [fp, -#28]
+a0300680:	e59f32e0 	ldr	r3, [pc, #736]	; a0300968 <init_flash+0x3b4>
+a0300684:	e5933000 	ldr	r3, [r3]
+a0300688:	e593301c 	ldr	r3, [r3, #28]
+a030068c:	e3530000 	cmp	r3, #0	; 0x0
+a0300690:	1a000005 	bne	a03006ac <init_flash+0xf8>
+a0300694:	e59f02d8 	ldr	r0, [pc, #728]	; a0300974 <init_flash+0x3c0>
+a0300698:	eb002900 	bl	a030aaa0 <printf>
+a030069c:	e59f22bc 	ldr	r2, [pc, #700]	; a0300960 <init_flash+0x3ac>
+a03006a0:	e3a03000 	mov	r3, #0	; 0x0
+a03006a4:	e5823000 	str	r3, [r2]
+a03006a8:	ea0000aa 	b	a0300958 <init_flash+0x3a4>
+a03006ac:	e59f32b4 	ldr	r3, [pc, #692]	; a0300968 <init_flash+0x3b4>
+a03006b0:	e5933000 	ldr	r3, [r3]
+a03006b4:	e24b2020 	sub	r2, fp, #32	; 0x20
+a03006b8:	e593301c 	ldr	r3, [r3, #28]
+a03006bc:	e51b001c 	ldr	r0, [fp, -#28]
+a03006c0:	e1a01002 	mov	r1, r2
+a03006c4:	e1a0e00f 	mov	lr, pc
+a03006c8:	e1a0f003 	mov	pc, r3
+a03006cc:	e1a03000 	mov	r3, r0
+a03006d0:	e50b3024 	str	r3, [fp, -#36]
+a03006d4:	e51b3024 	ldr	r3, [fp, -#36]
+a03006d8:	e3530000 	cmp	r3, #0	; 0x0
+a03006dc:	0a000005 	beq	a03006f8 <init_flash+0x144>
+a03006e0:	e59f0290 	ldr	r0, [pc, #656]	; a0300978 <init_flash+0x3c4>
+a03006e4:	eb0028ed 	bl	a030aaa0 <printf>
+a03006e8:	e59f2270 	ldr	r2, [pc, #624]	; a0300960 <init_flash+0x3ac>
+a03006ec:	e3a03000 	mov	r3, #0	; 0x0
+a03006f0:	e5823000 	str	r3, [r2]
+a03006f4:	ea000097 	b	a0300958 <init_flash+0x3a4>
+a03006f8:	e59f2260 	ldr	r2, [pc, #608]	; a0300960 <init_flash+0x3ac>
+a03006fc:	e51b3020 	ldr	r3, [fp, -#32]
+a0300700:	e5823000 	str	r3, [r2]
+a0300704:	e59f2270 	ldr	r2, [pc, #624]	; a030097c <init_flash+0x3c8>
+a0300708:	e3a03000 	mov	r3, #0	; 0x0
+a030070c:	e5823000 	str	r3, [r2]
+a0300710:	e51b2010 	ldr	r2, [fp, -#16]
+a0300714:	e1a03002 	mov	r3, r2
+a0300718:	e1a03083 	mov	r3, r3, lsl #1
+a030071c:	e0833002 	add	r3, r3, r2
+a0300720:	e1a02103 	mov	r2, r3, lsl #2
+a0300724:	e59f3234 	ldr	r3, [pc, #564]	; a0300960 <init_flash+0x3ac>
+a0300728:	e5933000 	ldr	r3, [r3]
+a030072c:	e0823003 	add	r3, r2, r3
+a0300730:	e5933000 	ldr	r3, [r3]
+a0300734:	e3530000 	cmp	r3, #0	; 0x0
+a0300738:	1a000000 	bne	a0300740 <init_flash+0x18c>
+a030073c:	ea000084 	b	a0300954 <init_flash+0x3a0>
+a0300740:	e51b2010 	ldr	r2, [fp, -#16]
+a0300744:	e1a03002 	mov	r3, r2
+a0300748:	e1a03083 	mov	r3, r3, lsl #1
+a030074c:	e0833002 	add	r3, r3, r2
+a0300750:	e1a02103 	mov	r2, r3, lsl #2
+a0300754:	e59f3204 	ldr	r3, [pc, #516]	; a0300960 <init_flash+0x3ac>
+a0300758:	e5933000 	ldr	r3, [r3]
+a030075c:	e0821003 	add	r1, r2, r3
+a0300760:	e51b2010 	ldr	r2, [fp, -#16]
+a0300764:	e1a03002 	mov	r3, r2
+a0300768:	e1a03083 	mov	r3, r3, lsl #1
+a030076c:	e0833002 	add	r3, r3, r2
+a0300770:	e1a02103 	mov	r2, r3, lsl #2
+a0300774:	e59f31e4 	ldr	r3, [pc, #484]	; a0300960 <init_flash+0x3ac>
+a0300778:	e5933000 	ldr	r3, [r3]
+a030077c:	e0823003 	add	r3, r2, r3
+a0300780:	e59f01f8 	ldr	r0, [pc, #504]	; a0300980 <init_flash+0x3cc>
+a0300784:	e5911004 	ldr	r1, [r1, #4]
+a0300788:	e5932000 	ldr	r2, [r3]
+a030078c:	eb0028c3 	bl	a030aaa0 <printf>
+a0300790:	e51b2010 	ldr	r2, [fp, -#16]
+a0300794:	e1a03002 	mov	r3, r2
+a0300798:	e1a03083 	mov	r3, r3, lsl #1
+a030079c:	e0833002 	add	r3, r3, r2
+a03007a0:	e1a02103 	mov	r2, r3, lsl #2
+a03007a4:	e59f31b4 	ldr	r3, [pc, #436]	; a0300960 <init_flash+0x3ac>
+a03007a8:	e5933000 	ldr	r3, [r3]
+a03007ac:	e0823003 	add	r3, r2, r3
+a03007b0:	e5933008 	ldr	r3, [r3, #8]
+a03007b4:	e3530000 	cmp	r3, #0	; 0x0
+a03007b8:	1a000001 	bne	a03007c4 <init_flash+0x210>
+a03007bc:	e59f01c0 	ldr	r0, [pc, #448]	; a0300984 <init_flash+0x3d0>
+a03007c0:	eb0028b6 	bl	a030aaa0 <printf>
+a03007c4:	e59f01bc 	ldr	r0, [pc, #444]	; a0300988 <init_flash+0x3d4>
+a03007c8:	eb0028b4 	bl	a030aaa0 <printf>
+a03007cc:	e3a03000 	mov	r3, #0	; 0x0
+a03007d0:	e50b3014 	str	r3, [fp, -#20]
+a03007d4:	e51b2010 	ldr	r2, [fp, -#16]
+a03007d8:	e1a03002 	mov	r3, r2
+a03007dc:	e1a03083 	mov	r3, r3, lsl #1
+a03007e0:	e0833002 	add	r3, r3, r2
+a03007e4:	e1a02103 	mov	r2, r3, lsl #2
+a03007e8:	e59f3170 	ldr	r3, [pc, #368]	; a0300960 <init_flash+0x3ac>
+a03007ec:	e5933000 	ldr	r3, [r3]
+a03007f0:	e0823003 	add	r3, r2, r3
+a03007f4:	e51b2014 	ldr	r2, [fp, -#20]
+a03007f8:	e5933004 	ldr	r3, [r3, #4]
+a03007fc:	e1520003 	cmp	r2, r3
+a0300800:	3a000000 	bcc	a0300808 <init_flash+0x254>
+a0300804:	ea00004e 	b	a0300944 <init_flash+0x390>
+a0300808:	e59f117c 	ldr	r1, [pc, #380]	; a030098c <init_flash+0x3d8>
+a030080c:	e59f3168 	ldr	r3, [pc, #360]	; a030097c <init_flash+0x3c8>
+a0300810:	e5932000 	ldr	r2, [r3]
+a0300814:	e1a03002 	mov	r3, r2
+a0300818:	e1a03083 	mov	r3, r3, lsl #1
+a030081c:	e0833002 	add	r3, r3, r2
+a0300820:	e1a03103 	mov	r3, r3, lsl #2
+a0300824:	e0832001 	add	r2, r3, r1
+a0300828:	e51b3018 	ldr	r3, [fp, -#24]
+a030082c:	e5823000 	str	r3, [r2]
+a0300830:	e59f0154 	ldr	r0, [pc, #340]	; a030098c <init_flash+0x3d8>
+a0300834:	e59f3140 	ldr	r3, [pc, #320]	; a030097c <init_flash+0x3c8>
+a0300838:	e5932000 	ldr	r2, [r3]
+a030083c:	e3a01004 	mov	r1, #4	; 0x4
+a0300840:	e1a03002 	mov	r3, r2
+a0300844:	e1a03083 	mov	r3, r3, lsl #1
+a0300848:	e0833002 	add	r3, r3, r2
+a030084c:	e1a03103 	mov	r3, r3, lsl #2
+a0300850:	e0833000 	add	r3, r3, r0
+a0300854:	e0831001 	add	r1, r3, r1
+a0300858:	e51b2010 	ldr	r2, [fp, -#16]
+a030085c:	e1a03002 	mov	r3, r2
+a0300860:	e1a03083 	mov	r3, r3, lsl #1
+a0300864:	e0833002 	add	r3, r3, r2
+a0300868:	e1a02103 	mov	r2, r3, lsl #2
+a030086c:	e59f30ec 	ldr	r3, [pc, #236]	; a0300960 <init_flash+0x3ac>
+a0300870:	e5933000 	ldr	r3, [r3]
+a0300874:	e0823003 	add	r3, r2, r3
+a0300878:	e5933000 	ldr	r3, [r3]
+a030087c:	e5813000 	str	r3, [r1]
+a0300880:	e59f0104 	ldr	r0, [pc, #260]	; a030098c <init_flash+0x3d8>
+a0300884:	e59f30f0 	ldr	r3, [pc, #240]	; a030097c <init_flash+0x3c8>
+a0300888:	e5932000 	ldr	r2, [r3]
+a030088c:	e3a01008 	mov	r1, #8	; 0x8
+a0300890:	e1a03002 	mov	r3, r2
+a0300894:	e1a03083 	mov	r3, r3, lsl #1
+a0300898:	e0833002 	add	r3, r3, r2
+a030089c:	e1a03103 	mov	r3, r3, lsl #2
+a03008a0:	e0833000 	add	r3, r3, r0
+a03008a4:	e0831001 	add	r1, r3, r1
+a03008a8:	e51b2010 	ldr	r2, [fp, -#16]
+a03008ac:	e1a03002 	mov	r3, r2
+a03008b0:	e1a03083 	mov	r3, r3, lsl #1
+a03008b4:	e0833002 	add	r3, r3, r2
+a03008b8:	e1a02103 	mov	r2, r3, lsl #2
+a03008bc:	e59f309c 	ldr	r3, [pc, #156]	; a0300960 <init_flash+0x3ac>
+a03008c0:	e5933000 	ldr	r3, [r3]
+a03008c4:	e0823003 	add	r3, r2, r3
+a03008c8:	e5933008 	ldr	r3, [r3, #8]
+a03008cc:	e5813000 	str	r3, [r1]
+a03008d0:	e51b2010 	ldr	r2, [fp, -#16]
+a03008d4:	e1a03002 	mov	r3, r2
+a03008d8:	e1a03083 	mov	r3, r3, lsl #1
+a03008dc:	e0833002 	add	r3, r3, r2
+a03008e0:	e1a02103 	mov	r2, r3, lsl #2
+a03008e4:	e59f3074 	ldr	r3, [pc, #116]	; a0300960 <init_flash+0x3ac>
+a03008e8:	e5933000 	ldr	r3, [r3]
+a03008ec:	e0823003 	add	r3, r2, r3
+a03008f0:	e51b2018 	ldr	r2, [fp, -#24]
+a03008f4:	e5933000 	ldr	r3, [r3]
+a03008f8:	e0823003 	add	r3, r2, r3
+a03008fc:	e50b3018 	str	r3, [fp, -#24]
+a0300900:	e59f2074 	ldr	r2, [pc, #116]	; a030097c <init_flash+0x3c8>
+a0300904:	e59f3070 	ldr	r3, [pc, #112]	; a030097c <init_flash+0x3c8>
+a0300908:	e5933000 	ldr	r3, [r3]
+a030090c:	e2833001 	add	r3, r3, #1	; 0x1
+a0300910:	e5823000 	str	r3, [r2]
+a0300914:	e59f3060 	ldr	r3, [pc, #96]	; a030097c <init_flash+0x3c8>
+a0300918:	e5933000 	ldr	r3, [r3]
+a030091c:	e353007f 	cmp	r3, #127	; 0x7f
+a0300920:	da000003 	ble	a0300934 <init_flash+0x380>
+a0300924:	eb001ab4 	bl	a03073fc <printerrprefix>
+a0300928:	e59f0060 	ldr	r0, [pc, #96]	; a0300990 <init_flash+0x3dc>
+a030092c:	eb00285b 	bl	a030aaa0 <printf>
+a0300930:	ea000003 	b	a0300944 <init_flash+0x390>
+a0300934:	e51b3014 	ldr	r3, [fp, -#20]
+a0300938:	e2833001 	add	r3, r3, #1	; 0x1
+a030093c:	e50b3014 	str	r3, [fp, -#20]
+a0300940:	eaffffa3 	b	a03007d4 <init_flash+0x220>
+a0300944:	e51b3010 	ldr	r3, [fp, -#16]
+a0300948:	e2833001 	add	r3, r3, #1	; 0x1
+a030094c:	e50b3010 	str	r3, [fp, -#16]
+a0300950:	eaffff6e 	b	a0300710 <init_flash+0x15c>
+a0300954:	ebfffeda 	bl	a03004c4 <print_flash_map>
+a0300958:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030095c:	a030c120 	eorges	ip, r0, r0, lsr #2
+a0300960:	a030fce0 	eorges	pc, r0, r0, ror #25
+a0300964:	a030c138 	eorges	ip, r0, r8, lsr r1
+a0300968:	a030fd00 	eorges	pc, r0, r0, lsl #26
+a030096c:	a030c158 	eorges	ip, r0, r8, asr r1
+a0300970:	a03004ac 	eorges	r0, r0, ip, lsr #9
+a0300974:	a030c170 	eorges	ip, r0, r0, ror r1
+a0300978:	a030c19c 	mlages	r0, ip, r1, ip
+a030097c:	a030e580 	eorges	lr, r0, r0, lsl #11
+a0300980:	a030c1cc 	eorges	ip, r0, ip, asr #3
+a0300984:	a030c1dc 	ldrgesb	ip, [r0], -ip
+a0300988:	a030c1e4 	eorges	ip, r0, r4, ror #3
+a030098c:	a030df80 	eorges	sp, r0, r0, lsl #31
+a0300990:	a030c1f0 	ldrgesh	ip, [r0], -r0
+
+a0300994 <flash_erase_region>:
+a0300994:	e1a0c00d 	mov	ip, sp
+a0300998:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030099c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03009a0:	e24dd018 	sub	sp, sp, #24	; 0x18
+a03009a4:	e50b0010 	str	r0, [fp, -#16]
+a03009a8:	e50b1014 	str	r1, [fp, -#20]
+a03009ac:	e51b3010 	ldr	r3, [fp, -#16]
+a03009b0:	e50b3018 	str	r3, [fp, -#24]
+a03009b4:	e51b3014 	ldr	r3, [fp, -#20]
+a03009b8:	e1a02103 	mov	r2, r3, lsl #2
+a03009bc:	e51b3010 	ldr	r3, [fp, -#16]
+a03009c0:	e0833002 	add	r3, r3, r2
+a03009c4:	e50b301c 	str	r3, [fp, -#28]
+a03009c8:	e59f0108 	ldr	r0, [pc, #264]	; a0300ad8 <flash_erase_region+0x144>
+a03009cc:	e51b1014 	ldr	r1, [fp, -#20]
+a03009d0:	e51b2014 	ldr	r2, [fp, -#20]
+a03009d4:	e51b3010 	ldr	r3, [fp, -#16]
+a03009d8:	eb002830 	bl	a030aaa0 <printf>
+a03009dc:	e59f30f8 	ldr	r3, [pc, #248]	; a0300adc <flash_erase_region+0x148>
+a03009e0:	e5933000 	ldr	r3, [r3]
+a03009e4:	e5933014 	ldr	r3, [r3, #20]
+a03009e8:	e1a0e00f 	mov	lr, pc
+a03009ec:	e1a0f003 	mov	pc, r3
+a03009f0:	e59f00e8 	ldr	r0, [pc, #232]	; a0300ae0 <flash_erase_region+0x14c>
+a03009f4:	e51b1018 	ldr	r1, [fp, -#24]
+a03009f8:	eb002828 	bl	a030aaa0 <printf>
+a03009fc:	e59f30d8 	ldr	r3, [pc, #216]	; a0300adc <flash_erase_region+0x148>
+a0300a00:	e5933000 	ldr	r3, [r3]
+a0300a04:	e593300c 	ldr	r3, [r3, #12]
+a0300a08:	e51b0018 	ldr	r0, [fp, -#24]
+a0300a0c:	e1a0e00f 	mov	lr, pc
+a0300a10:	e1a0f003 	mov	pc, r3
+a0300a14:	e1a03000 	mov	r3, r0
+a0300a18:	e50b3020 	str	r3, [fp, -#32]
+a0300a1c:	e51b2018 	ldr	r2, [fp, -#24]
+a0300a20:	e51b301c 	ldr	r3, [fp, -#28]
+a0300a24:	e1520003 	cmp	r2, r3
+a0300a28:	3a000000 	bcc	a0300a30 <flash_erase_region+0x9c>
+a0300a2c:	ea000020 	b	a0300ab4 <flash_erase_region+0x120>
+a0300a30:	e51b3018 	ldr	r3, [fp, -#24]
+a0300a34:	e5933000 	ldr	r3, [r3]
+a0300a38:	e3730001 	cmn	r3, #1	; 0x1
+a0300a3c:	0a000018 	beq	a0300aa4 <flash_erase_region+0x110>
+a0300a40:	e59f009c 	ldr	r0, [pc, #156]	; a0300ae4 <flash_erase_region+0x150>
+a0300a44:	e51b1018 	ldr	r1, [fp, -#24]
+a0300a48:	eb002814 	bl	a030aaa0 <printf>
+a0300a4c:	e59f3088 	ldr	r3, [pc, #136]	; a0300adc <flash_erase_region+0x148>
+a0300a50:	e5933000 	ldr	r3, [r3]
+a0300a54:	e5933000 	ldr	r3, [r3]
+a0300a58:	e51b0018 	ldr	r0, [fp, -#24]
+a0300a5c:	e1a0e00f 	mov	lr, pc
+a0300a60:	e1a0f003 	mov	pc, r3
+a0300a64:	e1a03000 	mov	r3, r0
+a0300a68:	e50b3020 	str	r3, [fp, -#32]
+a0300a6c:	e51b3020 	ldr	r3, [fp, -#32]
+a0300a70:	e3530000 	cmp	r3, #0	; 0x0
+a0300a74:	aaffffe8 	bge	a0300a1c <flash_erase_region+0x88>
+a0300a78:	e59f0068 	ldr	r0, [pc, #104]	; a0300ae8 <flash_erase_region+0x154>
+a0300a7c:	e51b1018 	ldr	r1, [fp, -#24]
+a0300a80:	eb002806 	bl	a030aaa0 <printf>
+a0300a84:	e59f3050 	ldr	r3, [pc, #80]	; a0300adc <flash_erase_region+0x148>
+a0300a88:	e5933000 	ldr	r3, [r3]
+a0300a8c:	e5933018 	ldr	r3, [r3, #24]
+a0300a90:	e1a0e00f 	mov	lr, pc
+a0300a94:	e1a0f003 	mov	pc, r3
+a0300a98:	e51b3020 	ldr	r3, [fp, -#32]
+a0300a9c:	e50b3024 	str	r3, [fp, -#36]
+a0300aa0:	ea00000a 	b	a0300ad0 <flash_erase_region+0x13c>
+a0300aa4:	e51b3018 	ldr	r3, [fp, -#24]
+a0300aa8:	e2833004 	add	r3, r3, #4	; 0x4
+a0300aac:	e50b3018 	str	r3, [fp, -#24]
+a0300ab0:	eaffffd9 	b	a0300a1c <flash_erase_region+0x88>
+a0300ab4:	e59f3020 	ldr	r3, [pc, #32]	; a0300adc <flash_erase_region+0x148>
+a0300ab8:	e5933000 	ldr	r3, [r3]
+a0300abc:	e5933018 	ldr	r3, [r3, #24]
+a0300ac0:	e1a0e00f 	mov	lr, pc
+a0300ac4:	e1a0f003 	mov	pc, r3
+a0300ac8:	e3a03000 	mov	r3, #0	; 0x0
+a0300acc:	e50b3024 	str	r3, [fp, -#36]
+a0300ad0:	e51b0024 	ldr	r0, [fp, -#36]
+a0300ad4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0300ad8:	a030c20c 	eorges	ip, r0, ip, lsl #4
+a0300adc:	a030fd00 	eorges	pc, r0, r0, lsl #26
+a0300ae0:	a030c234 	eorges	ip, r0, r4, lsr r2
+a0300ae4:	a030c258 	eorges	ip, r0, r8, asr r2
+a0300ae8:	a030c278 	eorges	ip, r0, r8, ror r2
+
+a0300aec <flash_get_size>:
+a0300aec:	e1a0c00d 	mov	ip, sp
+a0300af0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0300af4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0300af8:	e24dd008 	sub	sp, sp, #8	; 0x8
+a0300afc:	e3a03000 	mov	r3, #0	; 0x0
+a0300b00:	e50b3014 	str	r3, [fp, -#20]
+a0300b04:	e3a03000 	mov	r3, #0	; 0x0
+a0300b08:	e50b3010 	str	r3, [fp, -#16]
+a0300b0c:	e59f306c 	ldr	r3, [pc, #108]	; a0300b80 <flash_get_size+0x94>
+a0300b10:	e51b2010 	ldr	r2, [fp, -#16]
+a0300b14:	e5933000 	ldr	r3, [r3]
+a0300b18:	e1520003 	cmp	r2, r3
+a0300b1c:	ba000000 	blt	a0300b24 <flash_get_size+0x38>
+a0300b20:	ea000010 	b	a0300b68 <flash_get_size+0x7c>
+a0300b24:	e59f0058 	ldr	r0, [pc, #88]	; a0300b84 <flash_get_size+0x98>
+a0300b28:	e51b2010 	ldr	r2, [fp, -#16]
+a0300b2c:	e3a01004 	mov	r1, #4	; 0x4
+a0300b30:	e1a03002 	mov	r3, r2
+a0300b34:	e1a03083 	mov	r3, r3, lsl #1
+a0300b38:	e0833002 	add	r3, r3, r2
+a0300b3c:	e1a03103 	mov	r3, r3, lsl #2
+a0300b40:	e0833000 	add	r3, r3, r0
+a0300b44:	e0833001 	add	r3, r3, r1
+a0300b48:	e51b2014 	ldr	r2, [fp, -#20]
+a0300b4c:	e5933000 	ldr	r3, [r3]
+a0300b50:	e0823003 	add	r3, r2, r3
+a0300b54:	e50b3014 	str	r3, [fp, -#20]
+a0300b58:	e51b3010 	ldr	r3, [fp, -#16]
+a0300b5c:	e2833001 	add	r3, r3, #1	; 0x1
+a0300b60:	e50b3010 	str	r3, [fp, -#16]
+a0300b64:	eaffffe8 	b	a0300b0c <flash_get_size+0x20>
+a0300b68:	e59f0018 	ldr	r0, [pc, #24]	; a0300b88 <flash_get_size+0x9c>
+a0300b6c:	e51b1010 	ldr	r1, [fp, -#16]
+a0300b70:	eb0027ca 	bl	a030aaa0 <printf>
+a0300b74:	e51b3014 	ldr	r3, [fp, -#20]
+a0300b78:	e1a00003 	mov	r0, r3
+a0300b7c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0300b80:	a030e580 	eorges	lr, r0, r0, lsl #11
+a0300b84:	a030df80 	eorges	sp, r0, r0, lsl #31
+a0300b88:	a030c298 	mlages	r0, r8, r2, ip
+
+a0300b8c <flash_write_region>:
+a0300b8c:	e1a0c00d 	mov	ip, sp
+a0300b90:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0300b94:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0300b98:	e24dd034 	sub	sp, sp, #52	; 0x34
+a0300b9c:	e50b0010 	str	r0, [fp, -#16]
+a0300ba0:	e50b1014 	str	r1, [fp, -#20]
+a0300ba4:	e50b2018 	str	r2, [fp, -#24]
+a0300ba8:	e3a03000 	mov	r3, #0	; 0x0
+a0300bac:	e50b3020 	str	r3, [fp, -#32]
+a0300bb0:	e3a03000 	mov	r3, #0	; 0x0
+a0300bb4:	e50b3024 	str	r3, [fp, -#36]
+a0300bb8:	e3a03000 	mov	r3, #0	; 0x0
+a0300bbc:	e50b3028 	str	r3, [fp, -#40]
+a0300bc0:	e3a03000 	mov	r3, #0	; 0x0
+a0300bc4:	e50b302c 	str	r3, [fp, -#44]
+a0300bc8:	e3a03000 	mov	r3, #0	; 0x0
+a0300bcc:	e50b3030 	str	r3, [fp, -#48]
+a0300bd0:	e3a03000 	mov	r3, #0	; 0x0
+a0300bd4:	e50b3034 	str	r3, [fp, -#52]
+a0300bd8:	e51b3010 	ldr	r3, [fp, -#16]
+a0300bdc:	e58d3000 	str	r3, [sp]
+a0300be0:	e59f0300 	ldr	r0, [pc, #768]	; a0300ee8 <flash_write_region+0x35c>
+a0300be4:	e51b1018 	ldr	r1, [fp, -#24]
+a0300be8:	e51b2018 	ldr	r2, [fp, -#24]
+a0300bec:	e51b3014 	ldr	r3, [fp, -#20]
+a0300bf0:	eb0027aa 	bl	a030aaa0 <printf>
+a0300bf4:	e59f32f0 	ldr	r3, [pc, #752]	; a0300eec <flash_write_region+0x360>
+a0300bf8:	e5933000 	ldr	r3, [r3]
+a0300bfc:	e5933014 	ldr	r3, [r3, #20]
+a0300c00:	e1a0e00f 	mov	lr, pc
+a0300c04:	e1a0f003 	mov	pc, r3
+a0300c08:	e51b2024 	ldr	r2, [fp, -#36]
+a0300c0c:	e51b3018 	ldr	r3, [fp, -#24]
+a0300c10:	e1520003 	cmp	r2, r3
+a0300c14:	3a000000 	bcc	a0300c1c <flash_write_region+0x90>
+a0300c18:	ea0000a9 	b	a0300ec4 <flash_write_region+0x338>
+a0300c1c:	e59f32cc 	ldr	r3, [pc, #716]	; a0300ef0 <flash_write_region+0x364>
+a0300c20:	e24b2038 	sub	r2, fp, #56	; 0x38
+a0300c24:	e3a0c004 	mov	ip, #4	; 0x4
+a0300c28:	e1a00002 	mov	r0, r2
+a0300c2c:	e1a01003 	mov	r1, r3
+a0300c30:	e1a0200c 	mov	r2, ip
+a0300c34:	eb0022e3 	bl	a03097c8 <memcpy>
+a0300c38:	e51b3024 	ldr	r3, [fp, -#36]
+a0300c3c:	e1a02103 	mov	r2, r3, lsl #2
+a0300c40:	e51b3010 	ldr	r3, [fp, -#16]
+a0300c44:	e0821003 	add	r1, r2, r3
+a0300c48:	e51b3024 	ldr	r3, [fp, -#36]
+a0300c4c:	e1a02103 	mov	r2, r3, lsl #2
+a0300c50:	e51b3014 	ldr	r3, [fp, -#20]
+a0300c54:	e0823003 	add	r3, r2, r3
+a0300c58:	e5912000 	ldr	r2, [r1]
+a0300c5c:	e5933000 	ldr	r3, [r3]
+a0300c60:	e1520003 	cmp	r2, r3
+a0300c64:	1a000006 	bne	a0300c84 <flash_write_region+0xf8>
+a0300c68:	e51b3024 	ldr	r3, [fp, -#36]
+a0300c6c:	e2833001 	add	r3, r3, #1	; 0x1
+a0300c70:	e50b3024 	str	r3, [fp, -#36]
+a0300c74:	e51b3034 	ldr	r3, [fp, -#52]
+a0300c78:	e2833001 	add	r3, r3, #1	; 0x1
+a0300c7c:	e50b3034 	str	r3, [fp, -#52]
+a0300c80:	eaffffe0 	b	a0300c08 <flash_write_region+0x7c>
+a0300c84:	e59f3260 	ldr	r3, [pc, #608]	; a0300eec <flash_write_region+0x360>
+a0300c88:	e5931000 	ldr	r1, [r3]
+a0300c8c:	e51b3024 	ldr	r3, [fp, -#36]
+a0300c90:	e1a02103 	mov	r2, r3, lsl #2
+a0300c94:	e51b3010 	ldr	r3, [fp, -#16]
+a0300c98:	e0823003 	add	r3, r2, r3
+a0300c9c:	e591200c 	ldr	r2, [r1, #12]
+a0300ca0:	e1a00003 	mov	r0, r3
+a0300ca4:	e1a0e00f 	mov	lr, pc
+a0300ca8:	e1a0f002 	mov	pc, r2
+a0300cac:	e1a03000 	mov	r3, r0
+a0300cb0:	e50b301c 	str	r3, [fp, -#28]
+a0300cb4:	e59f3230 	ldr	r3, [pc, #560]	; a0300eec <flash_write_region+0x360>
+a0300cb8:	e5930000 	ldr	r0, [r3]
+a0300cbc:	e51b3024 	ldr	r3, [fp, -#36]
+a0300cc0:	e1a02103 	mov	r2, r3, lsl #2
+a0300cc4:	e51b3010 	ldr	r3, [fp, -#16]
+a0300cc8:	e0821003 	add	r1, r2, r3
+a0300ccc:	e51b3024 	ldr	r3, [fp, -#36]
+a0300cd0:	e1a02103 	mov	r2, r3, lsl #2
+a0300cd4:	e51b3014 	ldr	r3, [fp, -#20]
+a0300cd8:	e0823003 	add	r3, r2, r3
+a0300cdc:	e5902004 	ldr	r2, [r0, #4]
+a0300ce0:	e1a00001 	mov	r0, r1
+a0300ce4:	e1a01003 	mov	r1, r3
+a0300ce8:	e1a0e00f 	mov	lr, pc
+a0300cec:	e1a0f002 	mov	pc, r2
+a0300cf0:	e1a03000 	mov	r3, r0
+a0300cf4:	e50b301c 	str	r3, [fp, -#28]
+a0300cf8:	e51b302c 	ldr	r3, [fp, -#44]
+a0300cfc:	e2833001 	add	r3, r3, #1	; 0x1
+a0300d00:	e50b302c 	str	r3, [fp, -#44]
+a0300d04:	e51b301c 	ldr	r3, [fp, -#28]
+a0300d08:	e3530000 	cmp	r3, #0	; 0x0
+a0300d0c:	1a000003 	bne	a0300d20 <flash_write_region+0x194>
+a0300d10:	e51b3024 	ldr	r3, [fp, -#36]
+a0300d14:	e2833001 	add	r3, r3, #1	; 0x1
+a0300d18:	e50b3024 	str	r3, [fp, -#36]
+a0300d1c:	ea000058 	b	a0300e84 <flash_write_region+0x2f8>
+a0300d20:	e51b3020 	ldr	r3, [fp, -#32]
+a0300d24:	e2833001 	add	r3, r3, #1	; 0x1
+a0300d28:	e50b3020 	str	r3, [fp, -#32]
+a0300d2c:	e51b3024 	ldr	r3, [fp, -#36]
+a0300d30:	e1a02103 	mov	r2, r3, lsl #2
+a0300d34:	e51b3010 	ldr	r3, [fp, -#16]
+a0300d38:	e0823003 	add	r3, r2, r3
+a0300d3c:	e59f01b0 	ldr	r0, [pc, #432]	; a0300ef4 <flash_write_region+0x368>
+a0300d40:	e1a01003 	mov	r1, r3
+a0300d44:	eb002755 	bl	a030aaa0 <printf>
+a0300d48:	e59f319c 	ldr	r3, [pc, #412]	; a0300eec <flash_write_region+0x360>
+a0300d4c:	e5931000 	ldr	r1, [r3]
+a0300d50:	e51b3024 	ldr	r3, [fp, -#36]
+a0300d54:	e1a02103 	mov	r2, r3, lsl #2
+a0300d58:	e51b3010 	ldr	r3, [fp, -#16]
+a0300d5c:	e0823003 	add	r3, r2, r3
+a0300d60:	e591200c 	ldr	r2, [r1, #12]
+a0300d64:	e1a00003 	mov	r0, r3
+a0300d68:	e1a0e00f 	mov	lr, pc
+a0300d6c:	e1a0f002 	mov	pc, r2
+a0300d70:	e1a03000 	mov	r3, r0
+a0300d74:	e50b301c 	str	r3, [fp, -#28]
+a0300d78:	e59f316c 	ldr	r3, [pc, #364]	; a0300eec <flash_write_region+0x360>
+a0300d7c:	e5931000 	ldr	r1, [r3]
+a0300d80:	e51b3024 	ldr	r3, [fp, -#36]
+a0300d84:	e1a02103 	mov	r2, r3, lsl #2
+a0300d88:	e51b3010 	ldr	r3, [fp, -#16]
+a0300d8c:	e0823003 	add	r3, r2, r3
+a0300d90:	e5912000 	ldr	r2, [r1]
+a0300d94:	e1a00003 	mov	r0, r3
+a0300d98:	e1a0e00f 	mov	lr, pc
+a0300d9c:	e1a0f002 	mov	pc, r2
+a0300da0:	e1a03000 	mov	r3, r0
+a0300da4:	e50b301c 	str	r3, [fp, -#28]
+a0300da8:	e51b3028 	ldr	r3, [fp, -#40]
+a0300dac:	e2833001 	add	r3, r3, #1	; 0x1
+a0300db0:	e50b3028 	str	r3, [fp, -#40]
+a0300db4:	e51b301c 	ldr	r3, [fp, -#28]
+a0300db8:	e3530000 	cmp	r3, #0	; 0x0
+a0300dbc:	aa000009 	bge	a0300de8 <flash_write_region+0x25c>
+a0300dc0:	e59f0130 	ldr	r0, [pc, #304]	; a0300ef8 <flash_write_region+0x36c>
+a0300dc4:	eb002735 	bl	a030aaa0 <printf>
+a0300dc8:	e59f311c 	ldr	r3, [pc, #284]	; a0300eec <flash_write_region+0x360>
+a0300dcc:	e5933000 	ldr	r3, [r3]
+a0300dd0:	e5933018 	ldr	r3, [r3, #24]
+a0300dd4:	e1a0e00f 	mov	lr, pc
+a0300dd8:	e1a0f003 	mov	pc, r3
+a0300ddc:	e51b301c 	ldr	r3, [fp, -#28]
+a0300de0:	e50b303c 	str	r3, [fp, -#60]
+a0300de4:	ea00003d 	b	a0300ee0 <flash_write_region+0x354>
+a0300de8:	e59f010c 	ldr	r0, [pc, #268]	; a0300efc <flash_write_region+0x370>
+a0300dec:	eb00272b 	bl	a030aaa0 <printf>
+a0300df0:	e51b3024 	ldr	r3, [fp, -#36]
+a0300df4:	e3530000 	cmp	r3, #0	; 0x0
+a0300df8:	0a00001a 	beq	a0300e68 <flash_write_region+0x2dc>
+a0300dfc:	e51b3024 	ldr	r3, [fp, -#36]
+a0300e00:	e1a02103 	mov	r2, r3, lsl #2
+a0300e04:	e51b3010 	ldr	r3, [fp, -#16]
+a0300e08:	e0821003 	add	r1, r2, r3
+a0300e0c:	e51b3024 	ldr	r3, [fp, -#36]
+a0300e10:	e1a02103 	mov	r2, r3, lsl #2
+a0300e14:	e51b3014 	ldr	r3, [fp, -#20]
+a0300e18:	e0823003 	add	r3, r2, r3
+a0300e1c:	e5912000 	ldr	r2, [r1]
+a0300e20:	e5933000 	ldr	r3, [r3]
+a0300e24:	e1520003 	cmp	r2, r3
+a0300e28:	1a000007 	bne	a0300e4c <flash_write_region+0x2c0>
+a0300e2c:	e51b3024 	ldr	r3, [fp, -#36]
+a0300e30:	e1a02103 	mov	r2, r3, lsl #2
+a0300e34:	e51b3010 	ldr	r3, [fp, -#16]
+a0300e38:	e0823003 	add	r3, r2, r3
+a0300e3c:	e5933000 	ldr	r3, [r3]
+a0300e40:	e3730001 	cmn	r3, #1	; 0x1
+a0300e44:	0a000000 	beq	a0300e4c <flash_write_region+0x2c0>
+a0300e48:	ea000006 	b	a0300e68 <flash_write_region+0x2dc>
+a0300e4c:	e51b3024 	ldr	r3, [fp, -#36]
+a0300e50:	e2433001 	sub	r3, r3, #1	; 0x1
+a0300e54:	e50b3024 	str	r3, [fp, -#36]
+a0300e58:	e51b3030 	ldr	r3, [fp, -#48]
+a0300e5c:	e2833001 	add	r3, r3, #1	; 0x1
+a0300e60:	e50b3030 	str	r3, [fp, -#48]
+a0300e64:	eaffffe1 	b	a0300df0 <flash_write_region+0x264>
+a0300e68:	e51b3024 	ldr	r3, [fp, -#36]
+a0300e6c:	e1a02103 	mov	r2, r3, lsl #2
+a0300e70:	e51b3010 	ldr	r3, [fp, -#16]
+a0300e74:	e0823003 	add	r3, r2, r3
+a0300e78:	e59f0080 	ldr	r0, [pc, #128]	; a0300f00 <flash_write_region+0x374>
+a0300e7c:	e1a01003 	mov	r1, r3
+a0300e80:	eb002706 	bl	a030aaa0 <printf>
+a0300e84:	e51b3018 	ldr	r3, [fp, -#24]
+a0300e88:	e1a02083 	mov	r2, r3, lsl #1
+a0300e8c:	e51b3020 	ldr	r3, [fp, -#32]
+a0300e90:	e1530002 	cmp	r3, r2
+a0300e94:	9affff5b 	bls	a0300c08 <flash_write_region+0x7c>
+a0300e98:	eb001957 	bl	a03073fc <printerrprefix>
+a0300e9c:	e59f0060 	ldr	r0, [pc, #96]	; a0300f04 <flash_write_region+0x378>
+a0300ea0:	eb0026fe 	bl	a030aaa0 <printf>
+a0300ea4:	e59f3040 	ldr	r3, [pc, #64]	; a0300eec <flash_write_region+0x360>
+a0300ea8:	e5933000 	ldr	r3, [r3]
+a0300eac:	e5933018 	ldr	r3, [r3, #24]
+a0300eb0:	e1a0e00f 	mov	lr, pc
+a0300eb4:	e1a0f003 	mov	pc, r3
+a0300eb8:	e3e0300c 	mvn	r3, #12	; 0xc
+a0300ebc:	e50b303c 	str	r3, [fp, -#60]
+a0300ec0:	ea000006 	b	a0300ee0 <flash_write_region+0x354>
+a0300ec4:	e59f3020 	ldr	r3, [pc, #32]	; a0300eec <flash_write_region+0x360>
+a0300ec8:	e5933000 	ldr	r3, [r3]
+a0300ecc:	e5933018 	ldr	r3, [r3, #24]
+a0300ed0:	e1a0e00f 	mov	lr, pc
+a0300ed4:	e1a0f003 	mov	pc, r3
+a0300ed8:	e3a03000 	mov	r3, #0	; 0x0
+a0300edc:	e50b303c 	str	r3, [fp, -#60]
+a0300ee0:	e51b003c 	ldr	r0, [fp, -#60]
+a0300ee4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0300ee8:	a030c2b4 	ldrgeh	ip, [r0], -r4
+a0300eec:	a030fd00 	eorges	pc, r0, r0, lsl #26
+a0300ef0:	a030c2af 	eorges	ip, r0, pc, lsr #5
+a0300ef4:	a030c2e8 	eorges	ip, r0, r8, ror #5
+a0300ef8:	a030c300 	eorges	ip, r0, r0, lsl #6
+a0300efc:	a030c308 	eorges	ip, r0, r8, lsl #6
+a0300f00:	a030c31c 	eorges	ip, r0, ip, lsl r3
+a0300f04:	a030c338 	eorges	ip, r0, r8, lsr r3
+
+a0300f08 <find_block>:
+a0300f08:	e1a0c00d 	mov	ip, sp
+a0300f0c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0300f10:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0300f14:	e24dd018 	sub	sp, sp, #24	; 0x18
+a0300f18:	e50b0010 	str	r0, [fp, -#16]
+a0300f1c:	e3a03000 	mov	r3, #0	; 0x0
+a0300f20:	e50b3014 	str	r3, [fp, -#20]
+a0300f24:	e59f30c0 	ldr	r3, [pc, #192]	; a0300fec <find_block+0xe4>
+a0300f28:	e51b2014 	ldr	r2, [fp, -#20]
+a0300f2c:	e5933000 	ldr	r3, [r3]
+a0300f30:	e1520003 	cmp	r2, r3
+a0300f34:	ba000000 	blt	a0300f3c <find_block+0x34>
+a0300f38:	ea000027 	b	a0300fdc <find_block+0xd4>
+a0300f3c:	e59f10ac 	ldr	r1, [pc, #172]	; a0300ff0 <find_block+0xe8>
+a0300f40:	e51b2014 	ldr	r2, [fp, -#20]
+a0300f44:	e1a03002 	mov	r3, r2
+a0300f48:	e1a03083 	mov	r3, r3, lsl #1
+a0300f4c:	e0833002 	add	r3, r3, r2
+a0300f50:	e1a03103 	mov	r3, r3, lsl #2
+a0300f54:	e0833001 	add	r3, r3, r1
+a0300f58:	e5933000 	ldr	r3, [r3]
+a0300f5c:	e50b3018 	str	r3, [fp, -#24]
+a0300f60:	e59f0088 	ldr	r0, [pc, #136]	; a0300ff0 <find_block+0xe8>
+a0300f64:	e51b2014 	ldr	r2, [fp, -#20]
+a0300f68:	e3a01004 	mov	r1, #4	; 0x4
+a0300f6c:	e1a03002 	mov	r3, r2
+a0300f70:	e1a03083 	mov	r3, r3, lsl #1
+a0300f74:	e0833002 	add	r3, r3, r2
+a0300f78:	e1a03103 	mov	r3, r3, lsl #2
+a0300f7c:	e0833000 	add	r3, r3, r0
+a0300f80:	e0833001 	add	r3, r3, r1
+a0300f84:	e5933000 	ldr	r3, [r3]
+a0300f88:	e50b301c 	str	r3, [fp, -#28]
+a0300f8c:	e51b2018 	ldr	r2, [fp, -#24]
+a0300f90:	e51b301c 	ldr	r3, [fp, -#28]
+a0300f94:	e0823003 	add	r3, r2, r3
+a0300f98:	e2433001 	sub	r3, r3, #1	; 0x1
+a0300f9c:	e50b3020 	str	r3, [fp, -#32]
+a0300fa0:	e51b2010 	ldr	r2, [fp, -#16]
+a0300fa4:	e51b3018 	ldr	r3, [fp, -#24]
+a0300fa8:	e1520003 	cmp	r2, r3
+a0300fac:	3a000006 	bcc	a0300fcc <find_block+0xc4>
+a0300fb0:	e51b2010 	ldr	r2, [fp, -#16]
+a0300fb4:	e51b3020 	ldr	r3, [fp, -#32]
+a0300fb8:	e1520003 	cmp	r2, r3
+a0300fbc:	8a000002 	bhi	a0300fcc <find_block+0xc4>
+a0300fc0:	e51b3014 	ldr	r3, [fp, -#20]
+a0300fc4:	e50b3024 	str	r3, [fp, -#36]
+a0300fc8:	ea000005 	b	a0300fe4 <find_block+0xdc>
+a0300fcc:	e51b3014 	ldr	r3, [fp, -#20]
+a0300fd0:	e2833001 	add	r3, r3, #1	; 0x1
+a0300fd4:	e50b3014 	str	r3, [fp, -#20]
+a0300fd8:	eaffffd1 	b	a0300f24 <find_block+0x1c>
+a0300fdc:	e3e03006 	mvn	r3, #6	; 0x6
+a0300fe0:	e50b3024 	str	r3, [fp, -#36]
+a0300fe4:	e51b0024 	ldr	r0, [fp, -#36]
+a0300fe8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0300fec:	a030e580 	eorges	lr, r0, r0, lsl #11
+a0300ff0:	a030df80 	eorges	sp, r0, r0, lsl #31
+
+a0300ff4 <flash_get_block_size>:
+a0300ff4:	e1a0c00d 	mov	ip, sp
+a0300ff8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0300ffc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301000:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0301004:	e50b0010 	str	r0, [fp, -#16]
+a0301008:	e51b0010 	ldr	r0, [fp, -#16]
+a030100c:	ebffffbd 	bl	a0300f08 <find_block>
+a0301010:	e1a03000 	mov	r3, r0
+a0301014:	e50b3014 	str	r3, [fp, -#20]
+a0301018:	e51b3014 	ldr	r3, [fp, -#20]
+a030101c:	e3730007 	cmn	r3, #7	; 0x7
+a0301020:	1a000002 	bne	a0301030 <flash_get_block_size+0x3c>
+a0301024:	e3a03000 	mov	r3, #0	; 0x0
+a0301028:	e50b3018 	str	r3, [fp, -#24]
+a030102c:	ea00000a 	b	a030105c <flash_get_block_size+0x68>
+a0301030:	e59f002c 	ldr	r0, [pc, #44]	; a0301064 <flash_get_block_size+0x70>
+a0301034:	e51b2014 	ldr	r2, [fp, -#20]
+a0301038:	e3a01004 	mov	r1, #4	; 0x4
+a030103c:	e1a03002 	mov	r3, r2
+a0301040:	e1a03083 	mov	r3, r3, lsl #1
+a0301044:	e0833002 	add	r3, r3, r2
+a0301048:	e1a03103 	mov	r3, r3, lsl #2
+a030104c:	e0833000 	add	r3, r3, r0
+a0301050:	e0833001 	add	r3, r3, r1
+a0301054:	e5933000 	ldr	r3, [r3]
+a0301058:	e50b3018 	str	r3, [fp, -#24]
+a030105c:	e51b0018 	ldr	r0, [fp, -#24]
+a0301060:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301064:	a030df80 	eorges	sp, r0, r0, lsl #31
+
+a0301068 <address_range_to_block_range>:
+a0301068:	e1a0c00d 	mov	ip, sp
+a030106c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301070:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301074:	e24dd01c 	sub	sp, sp, #28	; 0x1c
+a0301078:	e50b0010 	str	r0, [fp, -#16]
+a030107c:	e50b1014 	str	r1, [fp, -#20]
+a0301080:	e50b2018 	str	r2, [fp, -#24]
+a0301084:	e50b301c 	str	r3, [fp, -#28]
+a0301088:	e51b0010 	ldr	r0, [fp, -#16]
+a030108c:	ebffff9d 	bl	a0300f08 <find_block>
+a0301090:	e1a03000 	mov	r3, r0
+a0301094:	e50b3020 	str	r3, [fp, -#32]
+a0301098:	e51b2010 	ldr	r2, [fp, -#16]
+a030109c:	e51b3014 	ldr	r3, [fp, -#20]
+a03010a0:	e0823003 	add	r3, r2, r3
+a03010a4:	e2433001 	sub	r3, r3, #1	; 0x1
+a03010a8:	e1a00003 	mov	r0, r3
+a03010ac:	ebffff95 	bl	a0300f08 <find_block>
+a03010b0:	e1a03000 	mov	r3, r0
+a03010b4:	e50b3024 	str	r3, [fp, -#36]
+a03010b8:	e51b3020 	ldr	r3, [fp, -#32]
+a03010bc:	e3530000 	cmp	r3, #0	; 0x0
+a03010c0:	aa000002 	bge	a03010d0 <address_range_to_block_range+0x68>
+a03010c4:	e51b3020 	ldr	r3, [fp, -#32]
+a03010c8:	e50b3028 	str	r3, [fp, -#40]
+a03010cc:	ea00000d 	b	a0301108 <address_range_to_block_range+0xa0>
+a03010d0:	e51b3024 	ldr	r3, [fp, -#36]
+a03010d4:	e3530000 	cmp	r3, #0	; 0x0
+a03010d8:	aa000002 	bge	a03010e8 <address_range_to_block_range+0x80>
+a03010dc:	e51b3024 	ldr	r3, [fp, -#36]
+a03010e0:	e50b3028 	str	r3, [fp, -#40]
+a03010e4:	ea000007 	b	a0301108 <address_range_to_block_range+0xa0>
+a03010e8:	e51b2018 	ldr	r2, [fp, -#24]
+a03010ec:	e51b3020 	ldr	r3, [fp, -#32]
+a03010f0:	e5823000 	str	r3, [r2]
+a03010f4:	e51b201c 	ldr	r2, [fp, -#28]
+a03010f8:	e51b3024 	ldr	r3, [fp, -#36]
+a03010fc:	e5823000 	str	r3, [r2]
+a0301100:	e3a03000 	mov	r3, #0	; 0x0
+a0301104:	e50b3028 	str	r3, [fp, -#40]
+a0301108:	e51b0028 	ldr	r0, [fp, -#40]
+a030110c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0301110 <do_flash_lock>:
+a0301110:	e1a0c00d 	mov	ip, sp
+a0301114:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301118:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030111c:	e24dd024 	sub	sp, sp, #36	; 0x24
+a0301120:	e50b0010 	str	r0, [fp, -#16]
+a0301124:	e50b1014 	str	r1, [fp, -#20]
+a0301128:	e50b2018 	str	r2, [fp, -#24]
+a030112c:	e51b3014 	ldr	r3, [fp, -#20]
+a0301130:	e1a03103 	mov	r3, r3, lsl #2
+a0301134:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0301138:	e24bc020 	sub	ip, fp, #32	; 0x20
+a030113c:	e51b0010 	ldr	r0, [fp, -#16]
+a0301140:	e1a01003 	mov	r1, r3
+a0301144:	e1a0300c 	mov	r3, ip
+a0301148:	ebffffc6 	bl	a0301068 <address_range_to_block_range>
+a030114c:	e1a03000 	mov	r3, r0
+a0301150:	e50b3024 	str	r3, [fp, -#36]
+a0301154:	e51b3024 	ldr	r3, [fp, -#36]
+a0301158:	e3530000 	cmp	r3, #0	; 0x0
+a030115c:	aa000002 	bge	a030116c <do_flash_lock+0x5c>
+a0301160:	e51b3024 	ldr	r3, [fp, -#36]
+a0301164:	e50b3030 	str	r3, [fp, -#48]
+a0301168:	ea000058 	b	a03012d0 <do_flash_lock+0x1c0>
+a030116c:	e51b301c 	ldr	r3, [fp, -#28]
+a0301170:	e50b3028 	str	r3, [fp, -#40]
+a0301174:	e51b2028 	ldr	r2, [fp, -#40]
+a0301178:	e51b3020 	ldr	r3, [fp, -#32]
+a030117c:	e1520003 	cmp	r2, r3
+a0301180:	da000000 	ble	a0301188 <do_flash_lock+0x78>
+a0301184:	ea000012 	b	a03011d4 <do_flash_lock+0xc4>
+a0301188:	e59f0148 	ldr	r0, [pc, #328]	; a03012d8 <do_flash_lock+0x1c8>
+a030118c:	e51b2028 	ldr	r2, [fp, -#40]
+a0301190:	e3a01008 	mov	r1, #8	; 0x8
+a0301194:	e1a03002 	mov	r3, r2
+a0301198:	e1a03083 	mov	r3, r3, lsl #1
+a030119c:	e0833002 	add	r3, r3, r2
+a03011a0:	e1a03103 	mov	r3, r3, lsl #2
+a03011a4:	e0833000 	add	r3, r3, r0
+a03011a8:	e0833001 	add	r3, r3, r1
+a03011ac:	e5933000 	ldr	r3, [r3]
+a03011b0:	e3530000 	cmp	r3, #0	; 0x0
+a03011b4:	1a000002 	bne	a03011c4 <do_flash_lock+0xb4>
+a03011b8:	e3e0300c 	mvn	r3, #12	; 0xc
+a03011bc:	e50b3030 	str	r3, [fp, -#48]
+a03011c0:	ea000042 	b	a03012d0 <do_flash_lock+0x1c0>
+a03011c4:	e51b3028 	ldr	r3, [fp, -#40]
+a03011c8:	e2833001 	add	r3, r3, #1	; 0x1
+a03011cc:	e50b3028 	str	r3, [fp, -#40]
+a03011d0:	eaffffe7 	b	a0301174 <do_flash_lock+0x64>
+a03011d4:	e59f3100 	ldr	r3, [pc, #256]	; a03012dc <do_flash_lock+0x1cc>
+a03011d8:	e5933000 	ldr	r3, [r3]
+a03011dc:	e5933014 	ldr	r3, [r3, #20]
+a03011e0:	e1a0e00f 	mov	lr, pc
+a03011e4:	e1a0f003 	mov	pc, r3
+a03011e8:	e51b301c 	ldr	r3, [fp, -#28]
+a03011ec:	e50b3028 	str	r3, [fp, -#40]
+a03011f0:	e51b2028 	ldr	r2, [fp, -#40]
+a03011f4:	e51b3020 	ldr	r3, [fp, -#32]
+a03011f8:	e1520003 	cmp	r2, r3
+a03011fc:	da000000 	ble	a0301204 <do_flash_lock+0xf4>
+a0301200:	ea00002b 	b	a03012b4 <do_flash_lock+0x1a4>
+a0301204:	e59f10cc 	ldr	r1, [pc, #204]	; a03012d8 <do_flash_lock+0x1c8>
+a0301208:	e51b2028 	ldr	r2, [fp, -#40]
+a030120c:	e1a03002 	mov	r3, r2
+a0301210:	e1a03083 	mov	r3, r3, lsl #1
+a0301214:	e0833002 	add	r3, r3, r2
+a0301218:	e1a03103 	mov	r3, r3, lsl #2
+a030121c:	e0833001 	add	r3, r3, r1
+a0301220:	e5933000 	ldr	r3, [r3]
+a0301224:	e50b302c 	str	r3, [fp, -#44]
+a0301228:	e51b3018 	ldr	r3, [fp, -#24]
+a030122c:	e3530000 	cmp	r3, #0	; 0x0
+a0301230:	0a000008 	beq	a0301258 <do_flash_lock+0x148>
+a0301234:	e59f30a0 	ldr	r3, [pc, #160]	; a03012dc <do_flash_lock+0x1cc>
+a0301238:	e5933000 	ldr	r3, [r3]
+a030123c:	e5933008 	ldr	r3, [r3, #8]
+a0301240:	e51b002c 	ldr	r0, [fp, -#44]
+a0301244:	e1a0e00f 	mov	lr, pc
+a0301248:	e1a0f003 	mov	pc, r3
+a030124c:	e1a03000 	mov	r3, r0
+a0301250:	e50b3024 	str	r3, [fp, -#36]
+a0301254:	ea000007 	b	a0301278 <do_flash_lock+0x168>
+a0301258:	e59f307c 	ldr	r3, [pc, #124]	; a03012dc <do_flash_lock+0x1cc>
+a030125c:	e5933000 	ldr	r3, [r3]
+a0301260:	e593300c 	ldr	r3, [r3, #12]
+a0301264:	e51b002c 	ldr	r0, [fp, -#44]
+a0301268:	e1a0e00f 	mov	lr, pc
+a030126c:	e1a0f003 	mov	pc, r3
+a0301270:	e1a03000 	mov	r3, r0
+a0301274:	e50b3024 	str	r3, [fp, -#36]
+a0301278:	e51b3024 	ldr	r3, [fp, -#36]
+a030127c:	e3530000 	cmp	r3, #0	; 0x0
+a0301280:	aa000007 	bge	a03012a4 <do_flash_lock+0x194>
+a0301284:	e59f3050 	ldr	r3, [pc, #80]	; a03012dc <do_flash_lock+0x1cc>
+a0301288:	e5933000 	ldr	r3, [r3]
+a030128c:	e5933018 	ldr	r3, [r3, #24]
+a0301290:	e1a0e00f 	mov	lr, pc
+a0301294:	e1a0f003 	mov	pc, r3
+a0301298:	e51b3024 	ldr	r3, [fp, -#36]
+a030129c:	e50b3030 	str	r3, [fp, -#48]
+a03012a0:	ea00000a 	b	a03012d0 <do_flash_lock+0x1c0>
+a03012a4:	e51b3028 	ldr	r3, [fp, -#40]
+a03012a8:	e2833001 	add	r3, r3, #1	; 0x1
+a03012ac:	e50b3028 	str	r3, [fp, -#40]
+a03012b0:	eaffffce 	b	a03011f0 <do_flash_lock+0xe0>
+a03012b4:	e59f3020 	ldr	r3, [pc, #32]	; a03012dc <do_flash_lock+0x1cc>
+a03012b8:	e5933000 	ldr	r3, [r3]
+a03012bc:	e5933018 	ldr	r3, [r3, #24]
+a03012c0:	e1a0e00f 	mov	lr, pc
+a03012c4:	e1a0f003 	mov	pc, r3
+a03012c8:	e3a03000 	mov	r3, #0	; 0x0
+a03012cc:	e50b3030 	str	r3, [fp, -#48]
+a03012d0:	e51b0030 	ldr	r0, [fp, -#48]
+a03012d4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03012d8:	a030df80 	eorges	sp, r0, r0, lsl #31
+a03012dc:	a030fd00 	eorges	pc, r0, r0, lsl #26
+
+a03012e0 <flash_lock_region>:
+a03012e0:	e1a0c00d 	mov	ip, sp
+a03012e4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03012e8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03012ec:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03012f0:	e50b0010 	str	r0, [fp, -#16]
+a03012f4:	e50b1014 	str	r1, [fp, -#20]
+a03012f8:	e51b0010 	ldr	r0, [fp, -#16]
+a03012fc:	e51b1014 	ldr	r1, [fp, -#20]
+a0301300:	e3a02001 	mov	r2, #1	; 0x1
+a0301304:	ebffff81 	bl	a0301110 <do_flash_lock>
+a0301308:	e1a03000 	mov	r3, r0
+a030130c:	e1a00003 	mov	r0, r3
+a0301310:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0301314 <flash_unlock_region>:
+a0301314:	e1a0c00d 	mov	ip, sp
+a0301318:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030131c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301320:	e24dd008 	sub	sp, sp, #8	; 0x8
+a0301324:	e50b0010 	str	r0, [fp, -#16]
+a0301328:	e50b1014 	str	r1, [fp, -#20]
+a030132c:	e51b0010 	ldr	r0, [fp, -#16]
+a0301330:	e51b1014 	ldr	r1, [fp, -#20]
+a0301334:	e3a02000 	mov	r2, #0	; 0x0
+a0301338:	ebffff74 	bl	a0301110 <do_flash_lock>
+a030133c:	e1a03000 	mov	r3, r0
+a0301340:	e1a00003 	mov	r0, r3
+a0301344:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0301348 <flash_query_region>:
+a0301348:	e1a0c00d 	mov	ip, sp
+a030134c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301350:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301354:	e24dd024 	sub	sp, sp, #36	; 0x24
+a0301358:	e50b0010 	str	r0, [fp, -#16]
+a030135c:	e50b1014 	str	r1, [fp, -#20]
+a0301360:	e3a03000 	mov	r3, #0	; 0x0
+a0301364:	e50b3028 	str	r3, [fp, -#40]
+a0301368:	e51b3014 	ldr	r3, [fp, -#20]
+a030136c:	e1a03103 	mov	r3, r3, lsl #2
+a0301370:	e24b2018 	sub	r2, fp, #24	; 0x18
+a0301374:	e24bc01c 	sub	ip, fp, #28	; 0x1c
+a0301378:	e51b0010 	ldr	r0, [fp, -#16]
+a030137c:	e1a01003 	mov	r1, r3
+a0301380:	e1a0300c 	mov	r3, ip
+a0301384:	ebffff37 	bl	a0301068 <address_range_to_block_range>
+a0301388:	e1a03000 	mov	r3, r0
+a030138c:	e50b3020 	str	r3, [fp, -#32]
+a0301390:	e51b3020 	ldr	r3, [fp, -#32]
+a0301394:	e3530000 	cmp	r3, #0	; 0x0
+a0301398:	aa000002 	bge	a03013a8 <flash_query_region+0x60>
+a030139c:	e51b3020 	ldr	r3, [fp, -#32]
+a03013a0:	e50b3030 	str	r3, [fp, -#48]
+a03013a4:	ea000035 	b	a0301480 <flash_query_region+0x138>
+a03013a8:	e51b3018 	ldr	r3, [fp, -#24]
+a03013ac:	e50b3024 	str	r3, [fp, -#36]
+a03013b0:	e51b2024 	ldr	r2, [fp, -#36]
+a03013b4:	e51b301c 	ldr	r3, [fp, -#28]
+a03013b8:	e1520003 	cmp	r2, r3
+a03013bc:	da000000 	ble	a03013c4 <flash_query_region+0x7c>
+a03013c0:	ea00002c 	b	a0301478 <flash_query_region+0x130>
+a03013c4:	e59f10bc 	ldr	r1, [pc, #188]	; a0301488 <flash_query_region+0x140>
+a03013c8:	e51b2024 	ldr	r2, [fp, -#36]
+a03013cc:	e1a03002 	mov	r3, r2
+a03013d0:	e1a03083 	mov	r3, r3, lsl #1
+a03013d4:	e0833002 	add	r3, r3, r2
+a03013d8:	e1a03103 	mov	r3, r3, lsl #2
+a03013dc:	e0833001 	add	r3, r3, r1
+a03013e0:	e5933000 	ldr	r3, [r3]
+a03013e4:	e50b302c 	str	r3, [fp, -#44]
+a03013e8:	e59f0098 	ldr	r0, [pc, #152]	; a0301488 <flash_query_region+0x140>
+a03013ec:	e51b2024 	ldr	r2, [fp, -#36]
+a03013f0:	e3a01008 	mov	r1, #8	; 0x8
+a03013f4:	e1a03002 	mov	r3, r2
+a03013f8:	e1a03083 	mov	r3, r3, lsl #1
+a03013fc:	e0833002 	add	r3, r3, r2
+a0301400:	e1a03103 	mov	r3, r3, lsl #2
+a0301404:	e0833000 	add	r3, r3, r0
+a0301408:	e0833001 	add	r3, r3, r1
+a030140c:	e5933000 	ldr	r3, [r3]
+a0301410:	e3530000 	cmp	r3, #0	; 0x0
+a0301414:	0a000013 	beq	a0301468 <flash_query_region+0x120>
+a0301418:	e59f306c 	ldr	r3, [pc, #108]	; a030148c <flash_query_region+0x144>
+a030141c:	e5933000 	ldr	r3, [r3]
+a0301420:	e5933010 	ldr	r3, [r3, #16]
+a0301424:	e51b002c 	ldr	r0, [fp, -#44]
+a0301428:	e1a0e00f 	mov	lr, pc
+a030142c:	e1a0f003 	mov	pc, r3
+a0301430:	e1a03000 	mov	r3, r0
+a0301434:	e50b3020 	str	r3, [fp, -#32]
+a0301438:	e51b3020 	ldr	r3, [fp, -#32]
+a030143c:	e3530000 	cmp	r3, #0	; 0x0
+a0301440:	aa000002 	bge	a0301450 <flash_query_region+0x108>
+a0301444:	e51b3020 	ldr	r3, [fp, -#32]
+a0301448:	e50b3030 	str	r3, [fp, -#48]
+a030144c:	ea00000b 	b	a0301480 <flash_query_region+0x138>
+a0301450:	e51b3020 	ldr	r3, [fp, -#32]
+a0301454:	e3530000 	cmp	r3, #0	; 0x0
+a0301458:	da000002 	ble	a0301468 <flash_query_region+0x120>
+a030145c:	e51b3028 	ldr	r3, [fp, -#40]
+a0301460:	e2833001 	add	r3, r3, #1	; 0x1
+a0301464:	e50b3028 	str	r3, [fp, -#40]
+a0301468:	e51b3024 	ldr	r3, [fp, -#36]
+a030146c:	e2833001 	add	r3, r3, #1	; 0x1
+a0301470:	e50b3024 	str	r3, [fp, -#36]
+a0301474:	eaffffcd 	b	a03013b0 <flash_query_region+0x68>
+a0301478:	e51b3028 	ldr	r3, [fp, -#40]
+a030147c:	e50b3030 	str	r3, [fp, -#48]
+a0301480:	e51b0030 	ldr	r0, [fp, -#48]
+a0301484:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301488:	a030df80 	eorges	sp, r0, r0, lsl #31
+a030148c:	a030fd00 	eorges	pc, r0, r0, lsl #26
+
+a0301490 <flash_get_first_block_address>:
+a0301490:	e1a0c00d 	mov	ip, sp
+a0301494:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301498:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030149c:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03014a0:	e50b0010 	str	r0, [fp, -#16]
+a03014a4:	e59f3034 	ldr	r3, [pc, #52]	; a03014e0 <flash_get_first_block_address+0x50>
+a03014a8:	e5933000 	ldr	r3, [r3]
+a03014ac:	e3530000 	cmp	r3, #0	; 0x0
+a03014b0:	0a000006 	beq	a03014d0 <flash_get_first_block_address+0x40>
+a03014b4:	e51b3010 	ldr	r3, [fp, -#16]
+a03014b8:	e59f2024 	ldr	r2, [pc, #36]	; a03014e4 <flash_get_first_block_address+0x54>
+a03014bc:	e5922000 	ldr	r2, [r2]
+a03014c0:	e5832000 	str	r2, [r3]
+a03014c4:	e3a03000 	mov	r3, #0	; 0x0
+a03014c8:	e50b3014 	str	r3, [fp, -#20]
+a03014cc:	ea000001 	b	a03014d8 <flash_get_first_block_address+0x48>
+a03014d0:	e3e03006 	mvn	r3, #6	; 0x6
+a03014d4:	e50b3014 	str	r3, [fp, -#20]
+a03014d8:	e51b0014 	ldr	r0, [fp, -#20]
+a03014dc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03014e0:	a030e580 	eorges	lr, r0, r0, lsl #11
+a03014e4:	a030df80 	eorges	sp, r0, r0, lsl #31
+
+a03014e8 <flash_get_next_block_address>:
+a03014e8:	e1a0c00d 	mov	ip, sp
+a03014ec:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03014f0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03014f4:	e24dd014 	sub	sp, sp, #20	; 0x14
+a03014f8:	e50b0010 	str	r0, [fp, -#16]
+a03014fc:	e50b1014 	str	r1, [fp, -#20]
+a0301500:	e51b0014 	ldr	r0, [fp, -#20]
+a0301504:	ebfffe7f 	bl	a0300f08 <find_block>
+a0301508:	e1a03000 	mov	r3, r0
+a030150c:	e50b3018 	str	r3, [fp, -#24]
+a0301510:	e51b3018 	ldr	r3, [fp, -#24]
+a0301514:	e3530000 	cmp	r3, #0	; 0x0
+a0301518:	aa000002 	bge	a0301528 <flash_get_next_block_address+0x40>
+a030151c:	e51b3018 	ldr	r3, [fp, -#24]
+a0301520:	e50b3020 	str	r3, [fp, -#32]
+a0301524:	ea000022 	b	a03015b4 <flash_get_next_block_address+0xcc>
+a0301528:	e59f108c 	ldr	r1, [pc, #140]	; a03015bc <flash_get_next_block_address+0xd4>
+a030152c:	e51b2018 	ldr	r2, [fp, -#24]
+a0301530:	e1a03002 	mov	r3, r2
+a0301534:	e1a03083 	mov	r3, r3, lsl #1
+a0301538:	e0833002 	add	r3, r3, r2
+a030153c:	e1a03103 	mov	r3, r3, lsl #2
+a0301540:	e0830001 	add	r0, r3, r1
+a0301544:	e59fc070 	ldr	ip, [pc, #112]	; a03015bc <flash_get_next_block_address+0xd4>
+a0301548:	e51b2018 	ldr	r2, [fp, -#24]
+a030154c:	e3a01004 	mov	r1, #4	; 0x4
+a0301550:	e1a03002 	mov	r3, r2
+a0301554:	e1a03083 	mov	r3, r3, lsl #1
+a0301558:	e0833002 	add	r3, r3, r2
+a030155c:	e1a03103 	mov	r3, r3, lsl #2
+a0301560:	e083300c 	add	r3, r3, ip
+a0301564:	e0833001 	add	r3, r3, r1
+a0301568:	e5902000 	ldr	r2, [r0]
+a030156c:	e5933000 	ldr	r3, [r3]
+a0301570:	e0823003 	add	r3, r2, r3
+a0301574:	e50b301c 	str	r3, [fp, -#28]
+a0301578:	e51b001c 	ldr	r0, [fp, -#28]
+a030157c:	ebfffe61 	bl	a0300f08 <find_block>
+a0301580:	e1a03000 	mov	r3, r0
+a0301584:	e50b3018 	str	r3, [fp, -#24]
+a0301588:	e51b3018 	ldr	r3, [fp, -#24]
+a030158c:	e3530000 	cmp	r3, #0	; 0x0
+a0301590:	aa000002 	bge	a03015a0 <flash_get_next_block_address+0xb8>
+a0301594:	e51b3018 	ldr	r3, [fp, -#24]
+a0301598:	e50b3020 	str	r3, [fp, -#32]
+a030159c:	ea000004 	b	a03015b4 <flash_get_next_block_address+0xcc>
+a03015a0:	e51b2010 	ldr	r2, [fp, -#16]
+a03015a4:	e51b301c 	ldr	r3, [fp, -#28]
+a03015a8:	e5823000 	str	r3, [r2]
+a03015ac:	e3a03000 	mov	r3, #0	; 0x0
+a03015b0:	e50b3020 	str	r3, [fp, -#32]
+a03015b4:	e51b0020 	ldr	r0, [fp, -#32]
+a03015b8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03015bc:	a030df80 	eorges	sp, r0, r0, lsl #31
+
+a03015c0 <parse_partition>:
+a03015c0:	e1a0c00d 	mov	ip, sp
+a03015c4:	e92dd810 	stmdb	sp!, {r4, fp, ip, lr, pc}
+a03015c8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03015cc:	e24dd014 	sub	sp, sp, #20	; 0x14
+a03015d0:	e50b0014 	str	r0, [fp, -#20]
+a03015d4:	e50b1018 	str	r1, [fp, -#24]
+a03015d8:	e50b201c 	str	r2, [fp, -#28]
+a03015dc:	e51b0014 	ldr	r0, [fp, -#20]
+a03015e0:	eb000852 	bl	a0303730 <pt_find_by_name>
+a03015e4:	e1a03000 	mov	r3, r0
+a03015e8:	e50b3020 	str	r3, [fp, -#32]
+a03015ec:	e51b3020 	ldr	r3, [fp, -#32]
+a03015f0:	e3530000 	cmp	r3, #0	; 0x0
+a03015f4:	1a000002 	bne	a0301604 <parse_partition+0x44>
+a03015f8:	e3e03000 	mvn	r3, #0	; 0x0
+a03015fc:	e50b3024 	str	r3, [fp, -#36]
+a0301600:	ea000009 	b	a030162c <parse_partition+0x6c>
+a0301604:	e51b4018 	ldr	r4, [fp, -#24]
+a0301608:	e51b0020 	ldr	r0, [fp, -#32]
+a030160c:	eb0008cd 	bl	a0303948 <pt_flash_start>
+a0301610:	e5840000 	str	r0, [r4]
+a0301614:	e51b201c 	ldr	r2, [fp, -#28]
+a0301618:	e51b3020 	ldr	r3, [fp, -#32]
+a030161c:	e593300c 	ldr	r3, [r3, #12]
+a0301620:	e5823000 	str	r3, [r2]
+a0301624:	e3a03000 	mov	r3, #0	; 0x0
+a0301628:	e50b3024 	str	r3, [fp, -#36]
+a030162c:	e51b0024 	ldr	r0, [fp, -#36]
+a0301630:	e91ba810 	ldmdb	fp, {r4, fp, sp, pc}
+
+a0301634 <Flash>:
+a0301634:	e1a0c00d 	mov	ip, sp
+a0301638:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030163c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301640:	e24dd02c 	sub	sp, sp, #44	; 0x2c
+a0301644:	e50b0010 	str	r0, [fp, -#16]
+a0301648:	e50b1014 	str	r1, [fp, -#20]
+a030164c:	e3a03000 	mov	r3, #0	; 0x0
+a0301650:	e50b3024 	str	r3, [fp, -#36]
+a0301654:	e3a03000 	mov	r3, #0	; 0x0
+a0301658:	e50b3028 	str	r3, [fp, -#40]
+a030165c:	e3a03000 	mov	r3, #0	; 0x0
+a0301660:	e50b3034 	str	r3, [fp, -#52]
+a0301664:	e51b3010 	ldr	r3, [fp, -#16]
+a0301668:	e3530001 	cmp	r3, #1	; 0x1
+a030166c:	ca000002 	bgt	a030167c <Flash+0x48>
+a0301670:	e3e03001 	mvn	r3, #1	; 0x1
+a0301674:	e50b3038 	str	r3, [fp, -#56]
+a0301678:	ea00009f 	b	a03018fc <Flash+0x2c8>
+a030167c:	e51b3010 	ldr	r3, [fp, -#16]
+a0301680:	e3530002 	cmp	r3, #2	; 0x2
+a0301684:	da000005 	ble	a03016a0 <Flash+0x6c>
+a0301688:	e3a02008 	mov	r2, #8	; 0x8
+a030168c:	e51b3014 	ldr	r3, [fp, -#20]
+a0301690:	e0823003 	add	r3, r2, r3
+a0301694:	e5933000 	ldr	r3, [r3]
+a0301698:	e50b3030 	str	r3, [fp, -#48]
+a030169c:	ea000004 	b	a03016b4 <Flash+0x80>
+a03016a0:	e3a02004 	mov	r2, #4	; 0x4
+a03016a4:	e51b3014 	ldr	r3, [fp, -#20]
+a03016a8:	e0823003 	add	r3, r2, r3
+a03016ac:	e5933000 	ldr	r3, [r3]
+a03016b0:	e50b3030 	str	r3, [fp, -#48]
+a03016b4:	e24b3020 	sub	r3, fp, #32	; 0x20
+a03016b8:	e24b2028 	sub	r2, fp, #40	; 0x28
+a03016bc:	e51b0030 	ldr	r0, [fp, -#48]
+a03016c0:	e1a01003 	mov	r1, r3
+a03016c4:	ebffffbd 	bl	a03015c0 <parse_partition>
+a03016c8:	e1a03000 	mov	r3, r0
+a03016cc:	e50b3018 	str	r3, [fp, -#24]
+a03016d0:	e51b3018 	ldr	r3, [fp, -#24]
+a03016d4:	e3530000 	cmp	r3, #0	; 0x0
+a03016d8:	aa000005 	bge	a03016f4 <Flash+0xc0>
+a03016dc:	e51b0018 	ldr	r0, [fp, -#24]
+a03016e0:	e51b1030 	ldr	r1, [fp, -#48]
+a03016e4:	eb00174e 	bl	a0307424 <printerror>
+a03016e8:	e3a03000 	mov	r3, #0	; 0x0
+a03016ec:	e50b3038 	str	r3, [fp, -#56]
+a03016f0:	ea000081 	b	a03018fc <Flash+0x2c8>
+a03016f4:	e3a02004 	mov	r2, #4	; 0x4
+a03016f8:	e51b3014 	ldr	r3, [fp, -#20]
+a03016fc:	e0823003 	add	r3, r2, r3
+a0301700:	e5930000 	ldr	r0, [r3]
+a0301704:	e59f11f8 	ldr	r1, [pc, #504]	; a0301904 <Flash+0x2d0>
+a0301708:	e3a02005 	mov	r2, #5	; 0x5
+a030170c:	eb0026f9 	bl	a030b2f8 <strncmp>
+a0301710:	e1a03000 	mov	r3, r0
+a0301714:	e3530000 	cmp	r3, #0	; 0x0
+a0301718:	1a000009 	bne	a0301744 <Flash+0x110>
+a030171c:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0301720:	e2833602 	add	r3, r3, #2097152	; 0x200000
+a0301724:	e50b301c 	str	r3, [fp, -#28]
+a0301728:	e59f31d8 	ldr	r3, [pc, #472]	; a0301908 <Flash+0x2d4>
+a030172c:	e5933048 	ldr	r3, [r3, #72]
+a0301730:	e50b3024 	str	r3, [fp, -#36]
+a0301734:	e59f31cc 	ldr	r3, [pc, #460]	; a0301908 <Flash+0x2d4>
+a0301738:	e593304c 	ldr	r3, [r3, #76]
+a030173c:	e50b3034 	str	r3, [fp, -#52]
+a0301740:	ea000044 	b	a0301858 <Flash+0x224>
+a0301744:	e3a02004 	mov	r2, #4	; 0x4
+a0301748:	e51b3014 	ldr	r3, [fp, -#20]
+a030174c:	e0823003 	add	r3, r2, r3
+a0301750:	e5930000 	ldr	r0, [r3]
+a0301754:	e59f11b0 	ldr	r1, [pc, #432]	; a030190c <Flash+0x2d8>
+a0301758:	e3a02006 	mov	r2, #6	; 0x6
+a030175c:	eb0026e5 	bl	a030b2f8 <strncmp>
+a0301760:	e1a03000 	mov	r3, r0
+a0301764:	e3530000 	cmp	r3, #0	; 0x0
+a0301768:	1a000009 	bne	a0301794 <Flash+0x160>
+a030176c:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0301770:	e2833821 	add	r3, r3, #2162688	; 0x210000
+a0301774:	e50b301c 	str	r3, [fp, -#28]
+a0301778:	e59f3188 	ldr	r3, [pc, #392]	; a0301908 <Flash+0x2d4>
+a030177c:	e5933018 	ldr	r3, [r3, #24]
+a0301780:	e50b3024 	str	r3, [fp, -#36]
+a0301784:	e59f317c 	ldr	r3, [pc, #380]	; a0301908 <Flash+0x2d4>
+a0301788:	e593301c 	ldr	r3, [r3, #28]
+a030178c:	e50b3034 	str	r3, [fp, -#52]
+a0301790:	ea000030 	b	a0301858 <Flash+0x224>
+a0301794:	e3a02004 	mov	r2, #4	; 0x4
+a0301798:	e51b3014 	ldr	r3, [fp, -#20]
+a030179c:	e0823003 	add	r3, r2, r3
+a03017a0:	e5930000 	ldr	r0, [r3]
+a03017a4:	e59f1164 	ldr	r1, [pc, #356]	; a0301910 <Flash+0x2dc>
+a03017a8:	e3a02007 	mov	r2, #7	; 0x7
+a03017ac:	eb0026d1 	bl	a030b2f8 <strncmp>
+a03017b0:	e1a03000 	mov	r3, r0
+a03017b4:	e3530000 	cmp	r3, #0	; 0x0
+a03017b8:	1a000009 	bne	a03017e4 <Flash+0x1b0>
+a03017bc:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a03017c0:	e2833902 	add	r3, r3, #32768	; 0x8000
+a03017c4:	e50b301c 	str	r3, [fp, -#28]
+a03017c8:	e59f3138 	ldr	r3, [pc, #312]	; a0301908 <Flash+0x2d4>
+a03017cc:	e5933000 	ldr	r3, [r3]
+a03017d0:	e50b3024 	str	r3, [fp, -#36]
+a03017d4:	e59f312c 	ldr	r3, [pc, #300]	; a0301908 <Flash+0x2d4>
+a03017d8:	e5933004 	ldr	r3, [r3, #4]
+a03017dc:	e50b3034 	str	r3, [fp, -#52]
+a03017e0:	ea00001c 	b	a0301858 <Flash+0x224>
+a03017e4:	e3a02004 	mov	r2, #4	; 0x4
+a03017e8:	e51b3014 	ldr	r3, [fp, -#20]
+a03017ec:	e0823003 	add	r3, r2, r3
+a03017f0:	e5930000 	ldr	r0, [r3]
+a03017f4:	e59f1118 	ldr	r1, [pc, #280]	; a0301914 <Flash+0x2e0>
+a03017f8:	e3a02008 	mov	r2, #8	; 0x8
+a03017fc:	eb0026bd 	bl	a030b2f8 <strncmp>
+a0301800:	e1a03000 	mov	r3, r0
+a0301804:	e3530000 	cmp	r3, #0	; 0x0
+a0301808:	1a000009 	bne	a0301834 <Flash+0x200>
+a030180c:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0301810:	e2833605 	add	r3, r3, #5242880	; 0x500000
+a0301814:	e50b301c 	str	r3, [fp, -#28]
+a0301818:	e59f30e8 	ldr	r3, [pc, #232]	; a0301908 <Flash+0x2d4>
+a030181c:	e5933030 	ldr	r3, [r3, #48]
+a0301820:	e50b3024 	str	r3, [fp, -#36]
+a0301824:	e59f30dc 	ldr	r3, [pc, #220]	; a0301908 <Flash+0x2d4>
+a0301828:	e5933034 	ldr	r3, [r3, #52]
+a030182c:	e50b3034 	str	r3, [fp, -#52]
+a0301830:	ea000008 	b	a0301858 <Flash+0x224>
+a0301834:	e3a03004 	mov	r3, #4	; 0x4
+a0301838:	e51b2014 	ldr	r2, [fp, -#20]
+a030183c:	e0833002 	add	r3, r3, r2
+a0301840:	e3a00001 	mov	r0, #1	; 0x1
+a0301844:	e5931000 	ldr	r1, [r3]
+a0301848:	eb0016f5 	bl	a0307424 <printerror>
+a030184c:	e3a03000 	mov	r3, #0	; 0x0
+a0301850:	e50b3038 	str	r3, [fp, -#56]
+a0301854:	ea000028 	b	a03018fc <Flash+0x2c8>
+a0301858:	e51b3034 	ldr	r3, [fp, -#52]
+a030185c:	e3530000 	cmp	r3, #0	; 0x0
+a0301860:	1a000009 	bne	a030188c <Flash+0x258>
+a0301864:	eb0016e4 	bl	a03073fc <printerrprefix>
+a0301868:	e3a03004 	mov	r3, #4	; 0x4
+a030186c:	e51b2014 	ldr	r2, [fp, -#20]
+a0301870:	e0833002 	add	r3, r3, r2
+a0301874:	e59f009c 	ldr	r0, [pc, #156]	; a0301918 <Flash+0x2e4>
+a0301878:	e5931000 	ldr	r1, [r3]
+a030187c:	eb002487 	bl	a030aaa0 <printf>
+a0301880:	e3e03000 	mvn	r3, #0	; 0x0
+a0301884:	e50b3038 	str	r3, [fp, -#56]
+a0301888:	ea00001b 	b	a03018fc <Flash+0x2c8>
+a030188c:	e51b2024 	ldr	r2, [fp, -#36]
+a0301890:	e51b3028 	ldr	r3, [fp, -#40]
+a0301894:	e1520003 	cmp	r2, r3
+a0301898:	9a000007 	bls	a03018bc <Flash+0x288>
+a030189c:	eb0016d6 	bl	a03073fc <printerrprefix>
+a03018a0:	e59f0074 	ldr	r0, [pc, #116]	; a030191c <Flash+0x2e8>
+a03018a4:	e51b1024 	ldr	r1, [fp, -#36]
+a03018a8:	e51b2028 	ldr	r2, [fp, -#40]
+a03018ac:	eb00247b 	bl	a030aaa0 <printf>
+a03018b0:	e3e03009 	mvn	r3, #9	; 0x9
+a03018b4:	e50b3038 	str	r3, [fp, -#56]
+a03018b8:	ea00000f 	b	a03018fc <Flash+0x2c8>
+a03018bc:	e51b3024 	ldr	r3, [fp, -#36]
+a03018c0:	e2833003 	add	r3, r3, #3	; 0x3
+a03018c4:	e1a03123 	mov	r3, r3, lsr #2
+a03018c8:	e50b302c 	str	r3, [fp, -#44]
+a03018cc:	e3a02004 	mov	r2, #4	; 0x4
+a03018d0:	e51b3014 	ldr	r3, [fp, -#20]
+a03018d4:	e0823003 	add	r3, r2, r3
+a03018d8:	e59f0040 	ldr	r0, [pc, #64]	; a0301920 <Flash+0x2ec>
+a03018dc:	e5931000 	ldr	r1, [r3]
+a03018e0:	eb00246e 	bl	a030aaa0 <printf>
+a03018e4:	e51b0020 	ldr	r0, [fp, -#32]
+a03018e8:	e51b101c 	ldr	r1, [fp, -#28]
+a03018ec:	e51b202c 	ldr	r2, [fp, -#44]
+a03018f0:	ebfffca5 	bl	a0300b8c <flash_write_region>
+a03018f4:	e3a03000 	mov	r3, #0	; 0x0
+a03018f8:	e50b3038 	str	r3, [fp, -#56]
+a03018fc:	e51b0038 	ldr	r0, [fp, -#56]
+a0301900:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301904:	a030c368 	eorges	ip, r0, r8, ror #6
+a0301908:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a030190c:	a030c370 	eorges	ip, r0, r0, ror r3
+a0301910:	a030c378 	eorges	ip, r0, r8, ror r3
+a0301914:	a030c380 	eorges	ip, r0, r0, lsl #7
+a0301918:	a030c388 	eorges	ip, r0, r8, lsl #7
+a030191c:	a030c39c 	mlages	r0, ip, r3, ip
+a0301920:	a030c3c8 	eorges	ip, r0, r8, asr #7
+
+a0301924 <Lock>:
+a0301924:	e1a0c00d 	mov	ip, sp
+a0301928:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030192c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301930:	e24dd018 	sub	sp, sp, #24	; 0x18
+a0301934:	e50b0010 	str	r0, [fp, -#16]
+a0301938:	e50b1014 	str	r1, [fp, -#20]
+a030193c:	e51b3010 	ldr	r3, [fp, -#16]
+a0301940:	e3530002 	cmp	r3, #2	; 0x2
+a0301944:	0a000002 	beq	a0301954 <Lock+0x30>
+a0301948:	e3e03001 	mvn	r3, #1	; 0x1
+a030194c:	e50b3024 	str	r3, [fp, -#36]
+a0301950:	ea000039 	b	a0301a3c <Lock+0x118>
+a0301954:	e59f30e8 	ldr	r3, [pc, #232]	; a0301a44 <Lock+0x120>
+a0301958:	e5933000 	ldr	r3, [r3]
+a030195c:	e5933008 	ldr	r3, [r3, #8]
+a0301960:	e3530000 	cmp	r3, #0	; 0x0
+a0301964:	1a000008 	bne	a030198c <Lock+0x68>
+a0301968:	e3a03004 	mov	r3, #4	; 0x4
+a030196c:	e51b2014 	ldr	r2, [fp, -#20]
+a0301970:	e0833002 	add	r3, r3, r2
+a0301974:	e3a00001 	mov	r0, #1	; 0x1
+a0301978:	e5931000 	ldr	r1, [r3]
+a030197c:	eb0016a8 	bl	a0307424 <printerror>
+a0301980:	e3a03000 	mov	r3, #0	; 0x0
+a0301984:	e50b3024 	str	r3, [fp, -#36]
+a0301988:	ea00002b 	b	a0301a3c <Lock+0x118>
+a030198c:	e3a02004 	mov	r2, #4	; 0x4
+a0301990:	e51b3014 	ldr	r3, [fp, -#20]
+a0301994:	e0823003 	add	r3, r2, r3
+a0301998:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a030199c:	e24bc020 	sub	ip, fp, #32	; 0x20
+a03019a0:	e5930000 	ldr	r0, [r3]
+a03019a4:	e1a01002 	mov	r1, r2
+a03019a8:	e1a0200c 	mov	r2, ip
+a03019ac:	ebffff03 	bl	a03015c0 <parse_partition>
+a03019b0:	e1a03000 	mov	r3, r0
+a03019b4:	e50b3018 	str	r3, [fp, -#24]
+a03019b8:	e51b3018 	ldr	r3, [fp, -#24]
+a03019bc:	e3530000 	cmp	r3, #0	; 0x0
+a03019c0:	aa000008 	bge	a03019e8 <Lock+0xc4>
+a03019c4:	e3a03004 	mov	r3, #4	; 0x4
+a03019c8:	e51b2014 	ldr	r2, [fp, -#20]
+a03019cc:	e0833002 	add	r3, r3, r2
+a03019d0:	e51b0018 	ldr	r0, [fp, -#24]
+a03019d4:	e5931000 	ldr	r1, [r3]
+a03019d8:	eb001691 	bl	a0307424 <printerror>
+a03019dc:	e3a03000 	mov	r3, #0	; 0x0
+a03019e0:	e50b3024 	str	r3, [fp, -#36]
+a03019e4:	ea000014 	b	a0301a3c <Lock+0x118>
+a03019e8:	e51b3020 	ldr	r3, [fp, -#32]
+a03019ec:	e1a03123 	mov	r3, r3, lsr #2
+a03019f0:	e51b001c 	ldr	r0, [fp, -#28]
+a03019f4:	e1a01003 	mov	r1, r3
+a03019f8:	ebfffe38 	bl	a03012e0 <flash_lock_region>
+a03019fc:	e1a03000 	mov	r3, r0
+a0301a00:	e50b3018 	str	r3, [fp, -#24]
+a0301a04:	e51b3018 	ldr	r3, [fp, -#24]
+a0301a08:	e3530000 	cmp	r3, #0	; 0x0
+a0301a0c:	aa000008 	bge	a0301a34 <Lock+0x110>
+a0301a10:	e3a03004 	mov	r3, #4	; 0x4
+a0301a14:	e51b2014 	ldr	r2, [fp, -#20]
+a0301a18:	e0833002 	add	r3, r3, r2
+a0301a1c:	e51b0018 	ldr	r0, [fp, -#24]
+a0301a20:	e5931000 	ldr	r1, [r3]
+a0301a24:	eb00167e 	bl	a0307424 <printerror>
+a0301a28:	e3a03000 	mov	r3, #0	; 0x0
+a0301a2c:	e50b3024 	str	r3, [fp, -#36]
+a0301a30:	ea000001 	b	a0301a3c <Lock+0x118>
+a0301a34:	e3a03000 	mov	r3, #0	; 0x0
+a0301a38:	e50b3024 	str	r3, [fp, -#36]
+a0301a3c:	e51b0024 	ldr	r0, [fp, -#36]
+a0301a40:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301a44:	a030fd00 	eorges	pc, r0, r0, lsl #26
+
+a0301a48 <Unlock>:
+a0301a48:	e1a0c00d 	mov	ip, sp
+a0301a4c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301a50:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301a54:	e24dd018 	sub	sp, sp, #24	; 0x18
+a0301a58:	e50b0010 	str	r0, [fp, -#16]
+a0301a5c:	e50b1014 	str	r1, [fp, -#20]
+a0301a60:	e51b3010 	ldr	r3, [fp, -#16]
+a0301a64:	e3530002 	cmp	r3, #2	; 0x2
+a0301a68:	0a000002 	beq	a0301a78 <Unlock+0x30>
+a0301a6c:	e3e03001 	mvn	r3, #1	; 0x1
+a0301a70:	e50b3024 	str	r3, [fp, -#36]
+a0301a74:	ea000039 	b	a0301b60 <Unlock+0x118>
+a0301a78:	e59f30e8 	ldr	r3, [pc, #232]	; a0301b68 <Unlock+0x120>
+a0301a7c:	e5933000 	ldr	r3, [r3]
+a0301a80:	e593300c 	ldr	r3, [r3, #12]
+a0301a84:	e3530000 	cmp	r3, #0	; 0x0
+a0301a88:	1a000008 	bne	a0301ab0 <Unlock+0x68>
+a0301a8c:	e3a03004 	mov	r3, #4	; 0x4
+a0301a90:	e51b2014 	ldr	r2, [fp, -#20]
+a0301a94:	e0833002 	add	r3, r3, r2
+a0301a98:	e3a00001 	mov	r0, #1	; 0x1
+a0301a9c:	e5931000 	ldr	r1, [r3]
+a0301aa0:	eb00165f 	bl	a0307424 <printerror>
+a0301aa4:	e3a03000 	mov	r3, #0	; 0x0
+a0301aa8:	e50b3024 	str	r3, [fp, -#36]
+a0301aac:	ea00002b 	b	a0301b60 <Unlock+0x118>
+a0301ab0:	e3a02004 	mov	r2, #4	; 0x4
+a0301ab4:	e51b3014 	ldr	r3, [fp, -#20]
+a0301ab8:	e0823003 	add	r3, r2, r3
+a0301abc:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0301ac0:	e24bc020 	sub	ip, fp, #32	; 0x20
+a0301ac4:	e5930000 	ldr	r0, [r3]
+a0301ac8:	e1a01002 	mov	r1, r2
+a0301acc:	e1a0200c 	mov	r2, ip
+a0301ad0:	ebfffeba 	bl	a03015c0 <parse_partition>
+a0301ad4:	e1a03000 	mov	r3, r0
+a0301ad8:	e50b3018 	str	r3, [fp, -#24]
+a0301adc:	e51b3018 	ldr	r3, [fp, -#24]
+a0301ae0:	e3530000 	cmp	r3, #0	; 0x0
+a0301ae4:	aa000008 	bge	a0301b0c <Unlock+0xc4>
+a0301ae8:	e3a03004 	mov	r3, #4	; 0x4
+a0301aec:	e51b2014 	ldr	r2, [fp, -#20]
+a0301af0:	e0833002 	add	r3, r3, r2
+a0301af4:	e51b0018 	ldr	r0, [fp, -#24]
+a0301af8:	e5931000 	ldr	r1, [r3]
+a0301afc:	eb001648 	bl	a0307424 <printerror>
+a0301b00:	e3a03000 	mov	r3, #0	; 0x0
+a0301b04:	e50b3024 	str	r3, [fp, -#36]
+a0301b08:	ea000014 	b	a0301b60 <Unlock+0x118>
+a0301b0c:	e51b3020 	ldr	r3, [fp, -#32]
+a0301b10:	e1a03123 	mov	r3, r3, lsr #2
+a0301b14:	e51b001c 	ldr	r0, [fp, -#28]
+a0301b18:	e1a01003 	mov	r1, r3
+a0301b1c:	ebfffdfc 	bl	a0301314 <flash_unlock_region>
+a0301b20:	e1a03000 	mov	r3, r0
+a0301b24:	e50b3018 	str	r3, [fp, -#24]
+a0301b28:	e51b3018 	ldr	r3, [fp, -#24]
+a0301b2c:	e3530000 	cmp	r3, #0	; 0x0
+a0301b30:	aa000008 	bge	a0301b58 <Unlock+0x110>
+a0301b34:	e3a03004 	mov	r3, #4	; 0x4
+a0301b38:	e51b2014 	ldr	r2, [fp, -#20]
+a0301b3c:	e0833002 	add	r3, r3, r2
+a0301b40:	e51b0018 	ldr	r0, [fp, -#24]
+a0301b44:	e5931000 	ldr	r1, [r3]
+a0301b48:	eb001635 	bl	a0307424 <printerror>
+a0301b4c:	e3a03000 	mov	r3, #0	; 0x0
+a0301b50:	e50b3024 	str	r3, [fp, -#36]
+a0301b54:	ea000001 	b	a0301b60 <Unlock+0x118>
+a0301b58:	e3a03000 	mov	r3, #0	; 0x0
+a0301b5c:	e50b3024 	str	r3, [fp, -#36]
+a0301b60:	e51b0024 	ldr	r0, [fp, -#36]
+a0301b64:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301b68:	a030fd00 	eorges	pc, r0, r0, lsl #26
+
+a0301b6c <Erase>:
+a0301b6c:	e1a0c00d 	mov	ip, sp
+a0301b70:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301b74:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301b78:	e24dd018 	sub	sp, sp, #24	; 0x18
+a0301b7c:	e50b0010 	str	r0, [fp, -#16]
+a0301b80:	e50b1014 	str	r1, [fp, -#20]
+a0301b84:	e51b3010 	ldr	r3, [fp, -#16]
+a0301b88:	e3530002 	cmp	r3, #2	; 0x2
+a0301b8c:	0a000002 	beq	a0301b9c <Erase+0x30>
+a0301b90:	e3e03001 	mvn	r3, #1	; 0x1
+a0301b94:	e50b3024 	str	r3, [fp, -#36]
+a0301b98:	ea000039 	b	a0301c84 <Erase+0x118>
+a0301b9c:	e59f30e8 	ldr	r3, [pc, #232]	; a0301c8c <Erase+0x120>
+a0301ba0:	e5933000 	ldr	r3, [r3]
+a0301ba4:	e5933000 	ldr	r3, [r3]
+a0301ba8:	e3530000 	cmp	r3, #0	; 0x0
+a0301bac:	1a000008 	bne	a0301bd4 <Erase+0x68>
+a0301bb0:	e3a03004 	mov	r3, #4	; 0x4
+a0301bb4:	e51b2014 	ldr	r2, [fp, -#20]
+a0301bb8:	e0833002 	add	r3, r3, r2
+a0301bbc:	e3a00001 	mov	r0, #1	; 0x1
+a0301bc0:	e5931000 	ldr	r1, [r3]
+a0301bc4:	eb001616 	bl	a0307424 <printerror>
+a0301bc8:	e3a03000 	mov	r3, #0	; 0x0
+a0301bcc:	e50b3024 	str	r3, [fp, -#36]
+a0301bd0:	ea00002b 	b	a0301c84 <Erase+0x118>
+a0301bd4:	e3a02004 	mov	r2, #4	; 0x4
+a0301bd8:	e51b3014 	ldr	r3, [fp, -#20]
+a0301bdc:	e0823003 	add	r3, r2, r3
+a0301be0:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0301be4:	e24bc020 	sub	ip, fp, #32	; 0x20
+a0301be8:	e5930000 	ldr	r0, [r3]
+a0301bec:	e1a01002 	mov	r1, r2
+a0301bf0:	e1a0200c 	mov	r2, ip
+a0301bf4:	ebfffe71 	bl	a03015c0 <parse_partition>
+a0301bf8:	e1a03000 	mov	r3, r0
+a0301bfc:	e50b3018 	str	r3, [fp, -#24]
+a0301c00:	e51b3018 	ldr	r3, [fp, -#24]
+a0301c04:	e3530000 	cmp	r3, #0	; 0x0
+a0301c08:	aa000008 	bge	a0301c30 <Erase+0xc4>
+a0301c0c:	e3a03004 	mov	r3, #4	; 0x4
+a0301c10:	e51b2014 	ldr	r2, [fp, -#20]
+a0301c14:	e0833002 	add	r3, r3, r2
+a0301c18:	e51b0018 	ldr	r0, [fp, -#24]
+a0301c1c:	e5931000 	ldr	r1, [r3]
+a0301c20:	eb0015ff 	bl	a0307424 <printerror>
+a0301c24:	e3a03000 	mov	r3, #0	; 0x0
+a0301c28:	e50b3024 	str	r3, [fp, -#36]
+a0301c2c:	ea000014 	b	a0301c84 <Erase+0x118>
+a0301c30:	e51b3020 	ldr	r3, [fp, -#32]
+a0301c34:	e1a03123 	mov	r3, r3, lsr #2
+a0301c38:	e51b001c 	ldr	r0, [fp, -#28]
+a0301c3c:	e1a01003 	mov	r1, r3
+a0301c40:	ebfffb53 	bl	a0300994 <flash_erase_region>
+a0301c44:	e1a03000 	mov	r3, r0
+a0301c48:	e50b3018 	str	r3, [fp, -#24]
+a0301c4c:	e51b3018 	ldr	r3, [fp, -#24]
+a0301c50:	e3530000 	cmp	r3, #0	; 0x0
+a0301c54:	aa000008 	bge	a0301c7c <Erase+0x110>
+a0301c58:	e3a03004 	mov	r3, #4	; 0x4
+a0301c5c:	e51b2014 	ldr	r2, [fp, -#20]
+a0301c60:	e0833002 	add	r3, r3, r2
+a0301c64:	e51b0018 	ldr	r0, [fp, -#24]
+a0301c68:	e5931000 	ldr	r1, [r3]
+a0301c6c:	eb0015ec 	bl	a0307424 <printerror>
+a0301c70:	e3a03000 	mov	r3, #0	; 0x0
+a0301c74:	e50b3024 	str	r3, [fp, -#36]
+a0301c78:	ea000001 	b	a0301c84 <Erase+0x118>
+a0301c7c:	e3a03000 	mov	r3, #0	; 0x0
+a0301c80:	e50b3024 	str	r3, [fp, -#36]
+a0301c84:	e51b0024 	ldr	r0, [fp, -#36]
+a0301c88:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301c8c:	a030fd00 	eorges	pc, r0, r0, lsl #26
+
+a0301c90 <serial_default_init>:
+a0301c90:	e1a0c00d 	mov	ip, sp
+a0301c94:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301c98:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301c9c:	e3a00007 	mov	r0, #7	; 0x7
+a0301ca0:	eb0023c9 	bl	a030abcc <serial_init>
+a0301ca4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0301ca8 <boot_linux>:
+a0301ca8:	e1a0c00d 	mov	ip, sp
+a0301cac:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301cb0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301cb4:	e24dd008 	sub	sp, sp, #8	; 0x8
+a0301cb8:	e50b0010 	str	r0, [fp, -#16]
+a0301cbc:	e50b1014 	str	r1, [fp, -#20]
+a0301cc0:	eb000049 	bl	a0301dec <setup_start_tag>
+a0301cc4:	eb00006f 	bl	a0301e88 <setup_memory_tags>
+a0301cc8:	e51b0010 	ldr	r0, [fp, -#16]
+a0301ccc:	e51b1014 	ldr	r1, [fp, -#20]
+a0301cd0:	eb0000b3 	bl	a0301fa4 <setup_commandline_tag>
+a0301cd4:	e59f3064 	ldr	r3, [pc, #100]	; a0301d40 <boot_linux+0x98>
+a0301cd8:	e5933068 	ldr	r3, [r3, #104]
+a0301cdc:	e3530000 	cmp	r3, #0	; 0x0
+a0301ce0:	0a000001 	beq	a0301cec <boot_linux+0x44>
+a0301ce4:	eb000116 	bl	a0302144 <setup_initrd_tag>
+a0301ce8:	eb000152 	bl	a0302238 <setup_ramdisk_tag>
+a0301cec:	eb000175 	bl	a03022c8 <setup_end_tag>
+a0301cf0:	e59f004c 	ldr	r0, [pc, #76]	; a0301d44 <boot_linux+0x9c>
+a0301cf4:	eb002369 	bl	a030aaa0 <printf>
+a0301cf8:	eb002411 	bl	a030ad44 <serial_flush_output>
+a0301cfc:	eb0016b8 	bl	a03077e4 <exit_subsystems>
+a0301d00:	e59f0040 	ldr	r0, [pc, #64]	; a0301d48 <boot_linux+0xa0>
+a0301d04:	eb002365 	bl	a030aaa0 <printf>
+a0301d08:	e59f303c 	ldr	r3, [pc, #60]	; a0301d4c <boot_linux+0xa4>
+a0301d0c:	e5933000 	ldr	r3, [r3]
+a0301d10:	e3a00000 	mov	r0, #0	; 0x0
+a0301d14:	e3a01f65 	mov	r1, #404	; 0x194
+a0301d18:	e2811002 	add	r1, r1, #2	; 0x2
+a0301d1c:	e3a0220a 	mov	r2, #-1610612736	; 0xa0000000
+a0301d20:	e2822c01 	add	r2, r2, #256	; 0x100
+a0301d24:	e1a0e00f 	mov	lr, pc
+a0301d28:	e1a0f003 	mov	pc, r3
+a0301d2c:	e59f001c 	ldr	r0, [pc, #28]	; a0301d50 <boot_linux+0xa8>
+a0301d30:	eb00235a 	bl	a030aaa0 <printf>
+a0301d34:	e3a03000 	mov	r3, #0	; 0x0
+a0301d38:	e1a00003 	mov	r0, r3
+a0301d3c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301d40:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a0301d44:	a030c3fc 	ldrgesh	ip, [r0], -ip
+a0301d48:	a030c414 	eorges	ip, r0, r4, lsl r4
+a0301d4c:	a030d648 	eorges	sp, r0, r8, asr #12
+a0301d50:	a030c438 	eorges	ip, r0, r8, lsr r4
+
+a0301d54 <cmd_kernel>:
+a0301d54:	e1a0c00d 	mov	ip, sp
+a0301d58:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301d5c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301d60:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0301d64:	e50b0010 	str	r0, [fp, -#16]
+a0301d68:	e50b1014 	str	r1, [fp, -#20]
+a0301d6c:	e51b3010 	ldr	r3, [fp, -#16]
+a0301d70:	e3530001 	cmp	r3, #1	; 0x1
+a0301d74:	ca000000 	bgt	a0301d7c <cmd_kernel+0x28>
+a0301d78:	ea000011 	b	a0301dc4 <cmd_kernel+0x70>
+a0301d7c:	e3a02004 	mov	r2, #4	; 0x4
+a0301d80:	e51b3014 	ldr	r3, [fp, -#20]
+a0301d84:	e0823003 	add	r3, r2, r3
+a0301d88:	e24b2018 	sub	r2, fp, #24	; 0x18
+a0301d8c:	e5930000 	ldr	r0, [r3]
+a0301d90:	e1a01002 	mov	r1, r2
+a0301d94:	eb0025f5 	bl	a030b570 <strtou32>
+a0301d98:	e1a03000 	mov	r3, r0
+a0301d9c:	e50b301c 	str	r3, [fp, -#28]
+a0301da0:	e51b301c 	ldr	r3, [fp, -#28]
+a0301da4:	e3530000 	cmp	r3, #0	; 0x0
+a0301da8:	aa000002 	bge	a0301db8 <cmd_kernel+0x64>
+a0301dac:	e3e03000 	mvn	r3, #0	; 0x0
+a0301db0:	e50b3020 	str	r3, [fp, -#32]
+a0301db4:	ea000008 	b	a0301ddc <cmd_kernel+0x88>
+a0301db8:	e59f2024 	ldr	r2, [pc, #36]	; a0301de4 <cmd_kernel+0x90>
+a0301dbc:	e51b3018 	ldr	r3, [fp, -#24]
+a0301dc0:	e5823000 	str	r3, [r2]
+a0301dc4:	e59f3018 	ldr	r3, [pc, #24]	; a0301de4 <cmd_kernel+0x90>
+a0301dc8:	e59f0018 	ldr	r0, [pc, #24]	; a0301de8 <cmd_kernel+0x94>
+a0301dcc:	e5931000 	ldr	r1, [r3]
+a0301dd0:	eb002332 	bl	a030aaa0 <printf>
+a0301dd4:	e3a03000 	mov	r3, #0	; 0x0
+a0301dd8:	e50b3020 	str	r3, [fp, -#32]
+a0301ddc:	e51b0020 	ldr	r0, [fp, -#32]
+a0301de0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301de4:	a030d648 	eorges	sp, r0, r8, asr #12
+a0301de8:	a030c474 	eorges	ip, r0, r4, ror r4
+
+a0301dec <setup_start_tag>:
+a0301dec:	e1a0c00d 	mov	ip, sp
+a0301df0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0301df4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301df8:	e59f2084 	ldr	r2, [pc, #132]	; a0301e84 <setup_start_tag+0x98>
+a0301dfc:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0301e00:	e2833c01 	add	r3, r3, #256	; 0x100
+a0301e04:	e5823000 	str	r3, [r2]
+a0301e08:	e59f3074 	ldr	r3, [pc, #116]	; a0301e84 <setup_start_tag+0x98>
+a0301e0c:	e5932000 	ldr	r2, [r3]
+a0301e10:	e3a03355 	mov	r3, #1409286145	; 0x54000001
+a0301e14:	e2833841 	add	r3, r3, #4259840	; 0x410000
+a0301e18:	e5823004 	str	r3, [r2, #4]
+a0301e1c:	e59f3060 	ldr	r3, [pc, #96]	; a0301e84 <setup_start_tag+0x98>
+a0301e20:	e5932000 	ldr	r2, [r3]
+a0301e24:	e3a03005 	mov	r3, #5	; 0x5
+a0301e28:	e5823000 	str	r3, [r2]
+a0301e2c:	e59f3050 	ldr	r3, [pc, #80]	; a0301e84 <setup_start_tag+0x98>
+a0301e30:	e5932000 	ldr	r2, [r3]
+a0301e34:	e3a03000 	mov	r3, #0	; 0x0
+a0301e38:	e5823008 	str	r3, [r2, #8]
+a0301e3c:	e59f3040 	ldr	r3, [pc, #64]	; a0301e84 <setup_start_tag+0x98>
+a0301e40:	e5932000 	ldr	r2, [r3]
+a0301e44:	e3a03000 	mov	r3, #0	; 0x0
+a0301e48:	e582300c 	str	r3, [r2, #12]
+a0301e4c:	e59f3030 	ldr	r3, [pc, #48]	; a0301e84 <setup_start_tag+0x98>
+a0301e50:	e5932000 	ldr	r2, [r3]
+a0301e54:	e3a03000 	mov	r3, #0	; 0x0
+a0301e58:	e5823010 	str	r3, [r2, #16]
+a0301e5c:	e59f0020 	ldr	r0, [pc, #32]	; a0301e84 <setup_start_tag+0x98>
+a0301e60:	e59f101c 	ldr	r1, [pc, #28]	; a0301e84 <setup_start_tag+0x98>
+a0301e64:	e59f3018 	ldr	r3, [pc, #24]	; a0301e84 <setup_start_tag+0x98>
+a0301e68:	e5933000 	ldr	r3, [r3]
+a0301e6c:	e5933000 	ldr	r3, [r3]
+a0301e70:	e1a02103 	mov	r2, r3, lsl #2
+a0301e74:	e5913000 	ldr	r3, [r1]
+a0301e78:	e0833002 	add	r3, r3, r2
+a0301e7c:	e5803000 	str	r3, [r0]
+a0301e80:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0301e84:	a030e584 	eorges	lr, r0, r4, lsl #11
+
+a0301e88 <setup_memory_tags>:
+a0301e88:	e1a0c00d 	mov	ip, sp
+a0301e8c:	e92dd810 	stmdb	sp!, {r4, fp, ip, lr, pc}
+a0301e90:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301e94:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0301e98:	e3a03000 	mov	r3, #0	; 0x0
+a0301e9c:	e50b3014 	str	r3, [fp, -#20]
+a0301ea0:	e51b3014 	ldr	r3, [fp, -#20]
+a0301ea4:	e353001f 	cmp	r3, #31	; 0x1f
+a0301ea8:	da000000 	ble	a0301eb0 <setup_memory_tags+0x28>
+a0301eac:	ea000039 	b	a0301f98 <setup_memory_tags+0x110>
+a0301eb0:	e59f00e4 	ldr	r0, [pc, #228]	; a0301f9c <setup_memory_tags+0x114>
+a0301eb4:	e51b2014 	ldr	r2, [fp, -#20]
+a0301eb8:	e3a01008 	mov	r1, #8	; 0x8
+a0301ebc:	e1a03002 	mov	r3, r2
+a0301ec0:	e1a03083 	mov	r3, r3, lsl #1
+a0301ec4:	e0833002 	add	r3, r3, r2
+a0301ec8:	e1a03103 	mov	r3, r3, lsl #2
+a0301ecc:	e0833000 	add	r3, r3, r0
+a0301ed0:	e0833001 	add	r3, r3, r1
+a0301ed4:	e5933000 	ldr	r3, [r3]
+a0301ed8:	e3530000 	cmp	r3, #0	; 0x0
+a0301edc:	0a000029 	beq	a0301f88 <setup_memory_tags+0x100>
+a0301ee0:	e59f30b8 	ldr	r3, [pc, #184]	; a0301fa0 <setup_memory_tags+0x118>
+a0301ee4:	e5932000 	ldr	r2, [r3]
+a0301ee8:	e3a03395 	mov	r3, #1409286146	; 0x54000002
+a0301eec:	e2833841 	add	r3, r3, #4259840	; 0x410000
+a0301ef0:	e5823004 	str	r3, [r2, #4]
+a0301ef4:	e59f30a4 	ldr	r3, [pc, #164]	; a0301fa0 <setup_memory_tags+0x118>
+a0301ef8:	e5932000 	ldr	r2, [r3]
+a0301efc:	e3a03004 	mov	r3, #4	; 0x4
+a0301f00:	e5823000 	str	r3, [r2]
+a0301f04:	e59f3094 	ldr	r3, [pc, #148]	; a0301fa0 <setup_memory_tags+0x118>
+a0301f08:	e5930000 	ldr	r0, [r3]
+a0301f0c:	e59f1088 	ldr	r1, [pc, #136]	; a0301f9c <setup_memory_tags+0x114>
+a0301f10:	e51b2014 	ldr	r2, [fp, -#20]
+a0301f14:	e1a03002 	mov	r3, r2
+a0301f18:	e1a03083 	mov	r3, r3, lsl #1
+a0301f1c:	e0833002 	add	r3, r3, r2
+a0301f20:	e1a03103 	mov	r3, r3, lsl #2
+a0301f24:	e0833001 	add	r3, r3, r1
+a0301f28:	e5933000 	ldr	r3, [r3]
+a0301f2c:	e580300c 	str	r3, [r0, #12]
+a0301f30:	e59f3068 	ldr	r3, [pc, #104]	; a0301fa0 <setup_memory_tags+0x118>
+a0301f34:	e5934000 	ldr	r4, [r3]
+a0301f38:	e59f005c 	ldr	r0, [pc, #92]	; a0301f9c <setup_memory_tags+0x114>
+a0301f3c:	e51b2014 	ldr	r2, [fp, -#20]
+a0301f40:	e3a01004 	mov	r1, #4	; 0x4
+a0301f44:	e1a03002 	mov	r3, r2
+a0301f48:	e1a03083 	mov	r3, r3, lsl #1
+a0301f4c:	e0833002 	add	r3, r3, r2
+a0301f50:	e1a03103 	mov	r3, r3, lsl #2
+a0301f54:	e0833000 	add	r3, r3, r0
+a0301f58:	e0833001 	add	r3, r3, r1
+a0301f5c:	e5933000 	ldr	r3, [r3]
+a0301f60:	e5843008 	str	r3, [r4, #8]
+a0301f64:	e59f0034 	ldr	r0, [pc, #52]	; a0301fa0 <setup_memory_tags+0x118>
+a0301f68:	e59f1030 	ldr	r1, [pc, #48]	; a0301fa0 <setup_memory_tags+0x118>
+a0301f6c:	e59f302c 	ldr	r3, [pc, #44]	; a0301fa0 <setup_memory_tags+0x118>
+a0301f70:	e5933000 	ldr	r3, [r3]
+a0301f74:	e5933000 	ldr	r3, [r3]
+a0301f78:	e1a02103 	mov	r2, r3, lsl #2
+a0301f7c:	e5913000 	ldr	r3, [r1]
+a0301f80:	e0833002 	add	r3, r3, r2
+a0301f84:	e5803000 	str	r3, [r0]
+a0301f88:	e51b3014 	ldr	r3, [fp, -#20]
+a0301f8c:	e2833001 	add	r3, r3, #1	; 0x1
+a0301f90:	e50b3014 	str	r3, [fp, -#20]
+a0301f94:	eaffffc1 	b	a0301ea0 <setup_memory_tags+0x18>
+a0301f98:	e91ba810 	ldmdb	fp, {r4, fp, sp, pc}
+a0301f9c:	a03101a0 	eorges	r0, r1, r0, lsr #3
+a0301fa0:	a030e584 	eorges	lr, r0, r4, lsl #11
+
+a0301fa4 <setup_commandline_tag>:
+a0301fa4:	e1a0c00d 	mov	ip, sp
+a0301fa8:	e92dd810 	stmdb	sp!, {r4, fp, ip, lr, pc}
+a0301fac:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0301fb0:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0301fb4:	e50b0014 	str	r0, [fp, -#20]
+a0301fb8:	e50b1018 	str	r1, [fp, -#24]
+a0301fbc:	e59f3174 	ldr	r3, [pc, #372]	; a0302138 <setup_commandline_tag+0x194>
+a0301fc0:	e5932000 	ldr	r2, [r3]
+a0301fc4:	e3a03000 	mov	r3, #0	; 0x0
+a0301fc8:	e5c23008 	strb	r3, [r2, #8]
+a0301fcc:	e59f3168 	ldr	r3, [pc, #360]	; a030213c <setup_commandline_tag+0x198>
+a0301fd0:	e5d33070 	ldrb	r3, [r3, #112]
+a0301fd4:	e3530000 	cmp	r3, #0	; 0x0
+a0301fd8:	0a000006 	beq	a0301ff8 <setup_commandline_tag+0x54>
+a0301fdc:	e59f3154 	ldr	r3, [pc, #340]	; a0302138 <setup_commandline_tag+0x194>
+a0301fe0:	e5933000 	ldr	r3, [r3]
+a0301fe4:	e2833008 	add	r3, r3, #8	; 0x8
+a0301fe8:	e1a00003 	mov	r0, r3
+a0301fec:	e59f114c 	ldr	r1, [pc, #332]	; a0302140 <setup_commandline_tag+0x19c>
+a0301ff0:	e3a02b01 	mov	r2, #1024	; 0x400
+a0301ff4:	eb002514 	bl	a030b44c <strlcpy>
+a0301ff8:	e51b3014 	ldr	r3, [fp, -#20]
+a0301ffc:	e3530001 	cmp	r3, #1	; 0x1
+a0302000:	da000029 	ble	a03020ac <setup_commandline_tag+0x108>
+a0302004:	e59f312c 	ldr	r3, [pc, #300]	; a0302138 <setup_commandline_tag+0x194>
+a0302008:	e5933000 	ldr	r3, [r3]
+a030200c:	e2833008 	add	r3, r3, #8	; 0x8
+a0302010:	e50b301c 	str	r3, [fp, -#28]
+a0302014:	e3a03001 	mov	r3, #1	; 0x1
+a0302018:	e50b3020 	str	r3, [fp, -#32]
+a030201c:	e51b2020 	ldr	r2, [fp, -#32]
+a0302020:	e51b3014 	ldr	r3, [fp, -#20]
+a0302024:	e1520003 	cmp	r2, r3
+a0302028:	ba000000 	blt	a0302030 <setup_commandline_tag+0x8c>
+a030202c:	ea000018 	b	a0302094 <setup_commandline_tag+0xf0>
+a0302030:	e51b3020 	ldr	r3, [fp, -#32]
+a0302034:	e1a02103 	mov	r2, r3, lsl #2
+a0302038:	e51b3018 	ldr	r3, [fp, -#24]
+a030203c:	e0823003 	add	r3, r2, r3
+a0302040:	e51b001c 	ldr	r0, [fp, -#28]
+a0302044:	e5931000 	ldr	r1, [r3]
+a0302048:	e3a02b01 	mov	r2, #1024	; 0x400
+a030204c:	eb0024fe 	bl	a030b44c <strlcpy>
+a0302050:	e51b001c 	ldr	r0, [fp, -#28]
+a0302054:	eb002491 	bl	a030b2a0 <strlen>
+a0302058:	e1a02000 	mov	r2, r0
+a030205c:	e51b301c 	ldr	r3, [fp, -#28]
+a0302060:	e0833002 	add	r3, r3, r2
+a0302064:	e50b301c 	str	r3, [fp, -#28]
+a0302068:	e24b001c 	sub	r0, fp, #28	; 0x1c
+a030206c:	e5902000 	ldr	r2, [r0]
+a0302070:	e1a01002 	mov	r1, r2
+a0302074:	e3a03020 	mov	r3, #32	; 0x20
+a0302078:	e5c13000 	strb	r3, [r1]
+a030207c:	e2822001 	add	r2, r2, #1	; 0x1
+a0302080:	e5802000 	str	r2, [r0]
+a0302084:	e51b3020 	ldr	r3, [fp, -#32]
+a0302088:	e2833001 	add	r3, r3, #1	; 0x1
+a030208c:	e50b3020 	str	r3, [fp, -#32]
+a0302090:	eaffffe1 	b	a030201c <setup_commandline_tag+0x78>
+a0302094:	e51b301c 	ldr	r3, [fp, -#28]
+a0302098:	e2433001 	sub	r3, r3, #1	; 0x1
+a030209c:	e50b301c 	str	r3, [fp, -#28]
+a03020a0:	e51b201c 	ldr	r2, [fp, -#28]
+a03020a4:	e3a03000 	mov	r3, #0	; 0x0
+a03020a8:	e5c23000 	strb	r3, [r2]
+a03020ac:	e59f3084 	ldr	r3, [pc, #132]	; a0302138 <setup_commandline_tag+0x194>
+a03020b0:	e5933000 	ldr	r3, [r3]
+a03020b4:	e2833008 	add	r3, r3, #8	; 0x8
+a03020b8:	e1a00003 	mov	r0, r3
+a03020bc:	eb002477 	bl	a030b2a0 <strlen>
+a03020c0:	e1a03000 	mov	r3, r0
+a03020c4:	e3530000 	cmp	r3, #0	; 0x0
+a03020c8:	da000019 	ble	a0302134 <setup_commandline_tag+0x190>
+a03020cc:	e59f3064 	ldr	r3, [pc, #100]	; a0302138 <setup_commandline_tag+0x194>
+a03020d0:	e5932000 	ldr	r2, [r3]
+a03020d4:	e3a03315 	mov	r3, #1409286144	; 0x54000000
+a03020d8:	e2833841 	add	r3, r3, #4259840	; 0x410000
+a03020dc:	e2833009 	add	r3, r3, #9	; 0x9
+a03020e0:	e5823004 	str	r3, [r2, #4]
+a03020e4:	e59f304c 	ldr	r3, [pc, #76]	; a0302138 <setup_commandline_tag+0x194>
+a03020e8:	e5934000 	ldr	r4, [r3]
+a03020ec:	e59f3044 	ldr	r3, [pc, #68]	; a0302138 <setup_commandline_tag+0x194>
+a03020f0:	e5933000 	ldr	r3, [r3]
+a03020f4:	e2833008 	add	r3, r3, #8	; 0x8
+a03020f8:	e1a00003 	mov	r0, r3
+a03020fc:	eb002467 	bl	a030b2a0 <strlen>
+a0302100:	e1a03000 	mov	r3, r0
+a0302104:	e283300d 	add	r3, r3, #13	; 0xd
+a0302108:	e1a03123 	mov	r3, r3, lsr #2
+a030210c:	e5843000 	str	r3, [r4]
+a0302110:	e59f0020 	ldr	r0, [pc, #32]	; a0302138 <setup_commandline_tag+0x194>
+a0302114:	e59f101c 	ldr	r1, [pc, #28]	; a0302138 <setup_commandline_tag+0x194>
+a0302118:	e59f3018 	ldr	r3, [pc, #24]	; a0302138 <setup_commandline_tag+0x194>
+a030211c:	e5933000 	ldr	r3, [r3]
+a0302120:	e5933000 	ldr	r3, [r3]
+a0302124:	e1a02103 	mov	r2, r3, lsl #2
+a0302128:	e5913000 	ldr	r3, [r1]
+a030212c:	e0833002 	add	r3, r3, r2
+a0302130:	e5803000 	str	r3, [r0]
+a0302134:	e91ba810 	ldmdb	fp, {r4, fp, sp, pc}
+a0302138:	a030e584 	eorges	lr, r0, r4, lsl #11
+a030213c:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a0302140:	a030fd90 	mlages	r0, r0, sp, pc
+
+a0302144 <setup_initrd_tag>:
+a0302144:	e1a0c00d 	mov	ip, sp
+a0302148:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030214c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302150:	e59f30dc 	ldr	r3, [pc, #220]	; a0302234 <setup_initrd_tag+0xf0>
+a0302154:	e5932000 	ldr	r2, [r3]
+a0302158:	e3a03315 	mov	r3, #1409286144	; 0x54000000
+a030215c:	e2833841 	add	r3, r3, #4259840	; 0x410000
+a0302160:	e2833005 	add	r3, r3, #5	; 0x5
+a0302164:	e5823004 	str	r3, [r2, #4]
+a0302168:	e59f30c4 	ldr	r3, [pc, #196]	; a0302234 <setup_initrd_tag+0xf0>
+a030216c:	e5932000 	ldr	r2, [r3]
+a0302170:	e3a03004 	mov	r3, #4	; 0x4
+a0302174:	e5823000 	str	r3, [r2]
+a0302178:	e59f30b4 	ldr	r3, [pc, #180]	; a0302234 <setup_initrd_tag+0xf0>
+a030217c:	e5932000 	ldr	r2, [r3]
+a0302180:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0302184:	e2833605 	add	r3, r3, #5242880	; 0x500000
+a0302188:	e5823008 	str	r3, [r2, #8]
+a030218c:	e59f30a0 	ldr	r3, [pc, #160]	; a0302234 <setup_initrd_tag+0xf0>
+a0302190:	e5932000 	ldr	r2, [r3]
+a0302194:	e3a03501 	mov	r3, #4194304	; 0x400000
+a0302198:	e582300c 	str	r3, [r2, #12]
+a030219c:	e59f0090 	ldr	r0, [pc, #144]	; a0302234 <setup_initrd_tag+0xf0>
+a03021a0:	e59f108c 	ldr	r1, [pc, #140]	; a0302234 <setup_initrd_tag+0xf0>
+a03021a4:	e59f3088 	ldr	r3, [pc, #136]	; a0302234 <setup_initrd_tag+0xf0>
+a03021a8:	e5933000 	ldr	r3, [r3]
+a03021ac:	e5933000 	ldr	r3, [r3]
+a03021b0:	e1a02103 	mov	r2, r3, lsl #2
+a03021b4:	e5913000 	ldr	r3, [r1]
+a03021b8:	e0833002 	add	r3, r3, r2
+a03021bc:	e5803000 	str	r3, [r0]
+a03021c0:	e59f306c 	ldr	r3, [pc, #108]	; a0302234 <setup_initrd_tag+0xf0>
+a03021c4:	e5932000 	ldr	r2, [r3]
+a03021c8:	e3a03315 	mov	r3, #1409286144	; 0x54000000
+a03021cc:	e2833842 	add	r3, r3, #4325376	; 0x420000
+a03021d0:	e2833005 	add	r3, r3, #5	; 0x5
+a03021d4:	e5823004 	str	r3, [r2, #4]
+a03021d8:	e59f3054 	ldr	r3, [pc, #84]	; a0302234 <setup_initrd_tag+0xf0>
+a03021dc:	e5932000 	ldr	r2, [r3]
+a03021e0:	e3a03004 	mov	r3, #4	; 0x4
+a03021e4:	e5823000 	str	r3, [r2]
+a03021e8:	e59f3044 	ldr	r3, [pc, #68]	; a0302234 <setup_initrd_tag+0xf0>
+a03021ec:	e5932000 	ldr	r2, [r3]
+a03021f0:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a03021f4:	e2833605 	add	r3, r3, #5242880	; 0x500000
+a03021f8:	e5823008 	str	r3, [r2, #8]
+a03021fc:	e59f3030 	ldr	r3, [pc, #48]	; a0302234 <setup_initrd_tag+0xf0>
+a0302200:	e5932000 	ldr	r2, [r3]
+a0302204:	e3a03501 	mov	r3, #4194304	; 0x400000
+a0302208:	e582300c 	str	r3, [r2, #12]
+a030220c:	e59f0020 	ldr	r0, [pc, #32]	; a0302234 <setup_initrd_tag+0xf0>
+a0302210:	e59f101c 	ldr	r1, [pc, #28]	; a0302234 <setup_initrd_tag+0xf0>
+a0302214:	e59f3018 	ldr	r3, [pc, #24]	; a0302234 <setup_initrd_tag+0xf0>
+a0302218:	e5933000 	ldr	r3, [r3]
+a030221c:	e5933000 	ldr	r3, [r3]
+a0302220:	e1a02103 	mov	r2, r3, lsl #2
+a0302224:	e5913000 	ldr	r3, [r1]
+a0302228:	e0833002 	add	r3, r3, r2
+a030222c:	e5803000 	str	r3, [r0]
+a0302230:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302234:	a030e584 	eorges	lr, r0, r4, lsl #11
+
+a0302238 <setup_ramdisk_tag>:
+a0302238:	e1a0c00d 	mov	ip, sp
+a030223c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302240:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302244:	e59f3078 	ldr	r3, [pc, #120]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a0302248:	e5932000 	ldr	r2, [r3]
+a030224c:	e3a03315 	mov	r3, #1409286144	; 0x54000000
+a0302250:	e2833841 	add	r3, r3, #4259840	; 0x410000
+a0302254:	e2833004 	add	r3, r3, #4	; 0x4
+a0302258:	e5823004 	str	r3, [r2, #4]
+a030225c:	e59f3060 	ldr	r3, [pc, #96]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a0302260:	e5932000 	ldr	r2, [r3]
+a0302264:	e3a03005 	mov	r3, #5	; 0x5
+a0302268:	e5823000 	str	r3, [r2]
+a030226c:	e59f3050 	ldr	r3, [pc, #80]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a0302270:	e5932000 	ldr	r2, [r3]
+a0302274:	e3a03000 	mov	r3, #0	; 0x0
+a0302278:	e5823010 	str	r3, [r2, #16]
+a030227c:	e59f3040 	ldr	r3, [pc, #64]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a0302280:	e5932000 	ldr	r2, [r3]
+a0302284:	e3a03a02 	mov	r3, #8192	; 0x2000
+a0302288:	e582300c 	str	r3, [r2, #12]
+a030228c:	e59f3030 	ldr	r3, [pc, #48]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a0302290:	e5932000 	ldr	r2, [r3]
+a0302294:	e3a03001 	mov	r3, #1	; 0x1
+a0302298:	e5823008 	str	r3, [r2, #8]
+a030229c:	e59f0020 	ldr	r0, [pc, #32]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a03022a0:	e59f101c 	ldr	r1, [pc, #28]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a03022a4:	e59f3018 	ldr	r3, [pc, #24]	; a03022c4 <setup_ramdisk_tag+0x8c>
+a03022a8:	e5933000 	ldr	r3, [r3]
+a03022ac:	e5933000 	ldr	r3, [r3]
+a03022b0:	e1a02103 	mov	r2, r3, lsl #2
+a03022b4:	e5913000 	ldr	r3, [r1]
+a03022b8:	e0833002 	add	r3, r3, r2
+a03022bc:	e5803000 	str	r3, [r0]
+a03022c0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03022c4:	a030e584 	eorges	lr, r0, r4, lsl #11
+
+a03022c8 <setup_end_tag>:
+a03022c8:	e1a0c00d 	mov	ip, sp
+a03022cc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03022d0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03022d4:	e59f301c 	ldr	r3, [pc, #28]	; a03022f8 <setup_end_tag+0x30>
+a03022d8:	e5932000 	ldr	r2, [r3]
+a03022dc:	e3a03000 	mov	r3, #0	; 0x0
+a03022e0:	e5823004 	str	r3, [r2, #4]
+a03022e4:	e59f300c 	ldr	r3, [pc, #12]	; a03022f8 <setup_end_tag+0x30>
+a03022e8:	e5932000 	ldr	r2, [r3]
+a03022ec:	e3a03000 	mov	r3, #0	; 0x0
+a03022f0:	e5823000 	str	r3, [r2]
+a03022f4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03022f8:	a030e584 	eorges	lr, r0, r4, lsl #11
+
+a03022fc <main>:
+a03022fc:	e1a0c00d 	mov	ip, sp
+a0302300:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302304:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302308:	e24ddf45 	sub	sp, sp, #276	; 0x114
+a030230c:	e3a03000 	mov	r3, #0	; 0x0
+a0302310:	e50b3010 	str	r3, [fp, -#16]
+a0302314:	e3a03000 	mov	r3, #0	; 0x0
+a0302318:	e50b3114 	str	r3, [fp, -#276]
+a030231c:	e59f2278 	ldr	r2, [pc, #632]	; a030259c <l5+0x1fc>
+a0302320:	e3a03000 	mov	r3, #0	; 0x0
+a0302324:	e582301c 	str	r3, [r2, #28]
+a0302328:	e59f226c 	ldr	r2, [pc, #620]	; a030259c <l5+0x1fc>
+a030232c:	e3a03000 	mov	r3, #0	; 0x0
+a0302330:	e5823004 	str	r3, [r2, #4]
+a0302334:	e59f2260 	ldr	r2, [pc, #608]	; a030259c <l5+0x1fc>
+a0302338:	e3a03000 	mov	r3, #0	; 0x0
+a030233c:	e5823034 	str	r3, [r2, #52]
+a0302340:	e59f2254 	ldr	r2, [pc, #596]	; a030259c <l5+0x1fc>
+a0302344:	e3a03007 	mov	r3, #7	; 0x7
+a0302348:	e5823060 	str	r3, [r2, #96]
+a030234c:	e59f2248 	ldr	r2, [pc, #584]	; a030259c <l5+0x1fc>
+a0302350:	e3a03007 	mov	r3, #7	; 0x7
+a0302354:	e5823064 	str	r3, [r2, #100]
+a0302358:	e59f223c 	ldr	r2, [pc, #572]	; a030259c <l5+0x1fc>
+a030235c:	e3a03000 	mov	r3, #0	; 0x0
+a0302360:	e5823068 	str	r3, [r2, #104]
+a0302364:	e59f2230 	ldr	r2, [pc, #560]	; a030259c <l5+0x1fc>
+a0302368:	e3a03000 	mov	r3, #0	; 0x0
+a030236c:	e5c23070 	strb	r3, [r2, #112]
+a0302370:	e59f2224 	ldr	r2, [pc, #548]	; a030259c <l5+0x1fc>
+a0302374:	e3a0300a 	mov	r3, #10	; 0xa
+a0302378:	e582306c 	str	r3, [r2, #108]
+a030237c:	eb001501 	bl	a0307788 <init_subsystems>
+a0302380:	eb000112 	bl	a03027d0 <find_parameters>
+a0302384:	e1a03000 	mov	r3, r0
+a0302388:	e50b3118 	str	r3, [fp, -#280]
+a030238c:	e59f3208 	ldr	r3, [pc, #520]	; a030259c <l5+0x1fc>
+a0302390:	e5930064 	ldr	r0, [r3, #100]
+a0302394:	eb00220c 	bl	a030abcc <serial_init>
+a0302398:	e59f0234 	ldr	r0, [pc, #564]	; a03025d4 <l5+0x234>
+a030239c:	e3a0204b 	mov	r2, #75	; 0x4b
+
+a03023a0 <l5>:
+a03023a0:	e5901014 	ldr	r1, [r0, #20]
+a03023a4:	e2111020 	ands	r1, r1, #32	; 0x20
+a03023a8:	0afffffc 	beq	a03023a0 <l5>
+a03023ac:	e5c02000 	strb	r2, [r0]
+a03023b0:	e51b3118 	ldr	r3, [fp, -#280]
+a03023b4:	e3530000 	cmp	r3, #0	; 0x0
+a03023b8:	0a000003 	beq	a03023cc <l5+0x2c>
+a03023bc:	e24b3f45 	sub	r3, fp, #276	; 0x114
+a03023c0:	e51b0118 	ldr	r0, [fp, -#280]
+a03023c4:	e1a01003 	mov	r1, r3
+a03023c8:	eb000251 	bl	a0302d14 <parse_ptag>
+a03023cc:	e59f01cc 	ldr	r0, [pc, #460]	; a03025a0 <l5+0x200>
+a03023d0:	eb0021b2 	bl	a030aaa0 <printf>
+a03023d4:	e59f31c8 	ldr	r3, [pc, #456]	; a03025a4 <l5+0x204>
+a03023d8:	e59f01c8 	ldr	r0, [pc, #456]	; a03025a8 <l5+0x208>
+a03023dc:	e5931000 	ldr	r1, [r3]
+a03023e0:	eb0021ae 	bl	a030aaa0 <printf>
+a03023e4:	e59f01c0 	ldr	r0, [pc, #448]	; a03025ac <l5+0x20c>
+a03023e8:	eb0021ac 	bl	a030aaa0 <printf>
+a03023ec:	e59f01bc 	ldr	r0, [pc, #444]	; a03025b0 <l5+0x210>
+a03023f0:	eb0021aa 	bl	a030aaa0 <printf>
+a03023f4:	e59f01b8 	ldr	r0, [pc, #440]	; a03025b4 <l5+0x214>
+a03023f8:	eb0021a8 	bl	a030aaa0 <printf>
+a03023fc:	eb0000ef 	bl	a03027c0 <print_elf_sections>
+a0302400:	e51b3118 	ldr	r3, [fp, -#280]
+a0302404:	e3530000 	cmp	r3, #0	; 0x0
+a0302408:	0a000003 	beq	a030241c <l5+0x7c>
+a030240c:	e24b3f45 	sub	r3, fp, #276	; 0x114
+a0302410:	e51b0118 	ldr	r0, [fp, -#280]
+a0302414:	e1a01003 	mov	r1, r3
+a0302418:	eb000268 	bl	a0302dc0 <parse_ptags>
+a030241c:	e59f0194 	ldr	r0, [pc, #404]	; a03025b8 <l5+0x218>
+a0302420:	eb001266 	bl	a0306dc0 <do_reload>
+a0302424:	e59f0190 	ldr	r0, [pc, #400]	; a03025bc <l5+0x21c>
+a0302428:	eb001264 	bl	a0306dc0 <do_reload>
+a030242c:	e59f3168 	ldr	r3, [pc, #360]	; a030259c <l5+0x1fc>
+a0302430:	e5933068 	ldr	r3, [r3, #104]
+a0302434:	e3530000 	cmp	r3, #0	; 0x0
+a0302438:	0a000001 	beq	a0302444 <l5+0xa4>
+a030243c:	e59f017c 	ldr	r0, [pc, #380]	; a03025c0 <l5+0x220>
+a0302440:	eb00125e 	bl	a0306dc0 <do_reload>
+a0302444:	e59f3150 	ldr	r3, [pc, #336]	; a030259c <l5+0x1fc>
+a0302448:	e593306c 	ldr	r3, [r3, #108]
+a030244c:	e3730001 	cmn	r3, #1	; 0x1
+a0302450:	da000038 	ble	a0302538 <l5+0x198>
+a0302454:	e3a03000 	mov	r3, #0	; 0x0
+a0302458:	e50b3120 	str	r3, [fp, -#288]
+a030245c:	e59f3138 	ldr	r3, [pc, #312]	; a030259c <l5+0x1fc>
+a0302460:	e59f015c 	ldr	r0, [pc, #348]	; a03025c4 <l5+0x224>
+a0302464:	e593106c 	ldr	r1, [r3, #108]
+a0302468:	eb00218c 	bl	a030aaa0 <printf>
+a030246c:	e59f3128 	ldr	r3, [pc, #296]	; a030259c <l5+0x1fc>
+a0302470:	e593306c 	ldr	r3, [r3, #108]
+a0302474:	e3530000 	cmp	r3, #0	; 0x0
+a0302478:	1a000007 	bne	a030249c <l5+0xfc>
+a030247c:	e24b3e11 	sub	r3, fp, #272	; 0x110
+a0302480:	e1a00003 	mov	r0, r3
+a0302484:	e3a01001 	mov	r1, #1	; 0x1
+a0302488:	e3a02000 	mov	r2, #0	; 0x0
+a030248c:	eb00233e 	bl	a030b18c <SerialInputBlock>
+a0302490:	e1a03000 	mov	r3, r0
+a0302494:	e50b3120 	str	r3, [fp, -#288]
+a0302498:	ea000018 	b	a0302500 <l5+0x160>
+a030249c:	e3a03000 	mov	r3, #0	; 0x0
+a03024a0:	e50b311c 	str	r3, [fp, -#284]
+a03024a4:	e59f30f0 	ldr	r3, [pc, #240]	; a030259c <l5+0x1fc>
+a03024a8:	e51b211c 	ldr	r2, [fp, -#284]
+a03024ac:	e593306c 	ldr	r3, [r3, #108]
+a03024b0:	e1520003 	cmp	r2, r3
+a03024b4:	ba000000 	blt	a03024bc <l5+0x11c>
+a03024b8:	ea000010 	b	a0302500 <l5+0x160>
+a03024bc:	e3a0002e 	mov	r0, #46	; 0x2e
+a03024c0:	eb0021dc 	bl	a030ac38 <serial_write>
+a03024c4:	e24b3e11 	sub	r3, fp, #272	; 0x110
+a03024c8:	e1a00003 	mov	r0, r3
+a03024cc:	e3a01001 	mov	r1, #1	; 0x1
+a03024d0:	e3a02001 	mov	r2, #1	; 0x1
+a03024d4:	eb00232c 	bl	a030b18c <SerialInputBlock>
+a03024d8:	e1a03000 	mov	r3, r0
+a03024dc:	e50b3120 	str	r3, [fp, -#288]
+a03024e0:	e51b3120 	ldr	r3, [fp, -#288]
+a03024e4:	e3530000 	cmp	r3, #0	; 0x0
+a03024e8:	da000000 	ble	a03024f0 <l5+0x150>
+a03024ec:	ea000003 	b	a0302500 <l5+0x160>
+a03024f0:	e51b311c 	ldr	r3, [fp, -#284]
+a03024f4:	e2833001 	add	r3, r3, #1	; 0x1
+a03024f8:	e50b311c 	str	r3, [fp, -#284]
+a03024fc:	eaffffe8 	b	a03024a4 <l5+0x104>
+a0302500:	e51b3120 	ldr	r3, [fp, -#288]
+a0302504:	e3530000 	cmp	r3, #0	; 0x0
+a0302508:	1a000006 	bne	a0302528 <l5+0x188>
+a030250c:	e3a034bf 	mov	r3, #-1090519040	; 0xbf000000
+a0302510:	e1a03b43 	mov	r3, r3, asr #22
+a0302514:	e3a02000 	mov	r2, #0	; 0x0
+a0302518:	e24b100c 	sub	r1, fp, #12	; 0xc
+a030251c:	e7c12003 	strb	r2, [r1, r3]
+a0302520:	e59f00a0 	ldr	r0, [pc, #160]	; a03025c8 <l5+0x228>
+a0302524:	eb00105b 	bl	a0306698 <parse_command>
+a0302528:	e59f009c 	ldr	r0, [pc, #156]	; a03025cc <l5+0x22c>
+a030252c:	eb00215b 	bl	a030aaa0 <printf>
+a0302530:	e59f0098 	ldr	r0, [pc, #152]	; a03025d0 <l5+0x230>
+a0302534:	eb002159 	bl	a030aaa0 <printf>
+a0302538:	e1a00000 	nop			(mov r0,r0)
+a030253c:	e3a00000 	mov	r0, #0	; 0x0
+a0302540:	eb0010f2 	bl	a0306910 <DisplayPrompt>
+a0302544:	e24b3e11 	sub	r3, fp, #272	; 0x110
+a0302548:	e1a00003 	mov	r0, r3
+a030254c:	e3a01c01 	mov	r1, #256	; 0x100
+a0302550:	e3a02f96 	mov	r2, #600	; 0x258
+a0302554:	eb0010fe 	bl	a0306954 <GetCommand>
+a0302558:	e1a03000 	mov	r3, r0
+a030255c:	e50b3010 	str	r3, [fp, -#16]
+a0302560:	e51b3010 	ldr	r3, [fp, -#16]
+a0302564:	e3530000 	cmp	r3, #0	; 0x0
+a0302568:	dafffff3 	ble	a030253c <l5+0x19c>
+a030256c:	e24b3e11 	sub	r3, fp, #272	; 0x110
+a0302570:	e1a00003 	mov	r0, r3
+a0302574:	eb001047 	bl	a0306698 <parse_command>
+a0302578:	e1a03000 	mov	r3, r0
+a030257c:	e50b3120 	str	r3, [fp, -#288]
+a0302580:	e51b3120 	ldr	r3, [fp, -#288]
+a0302584:	e3530000 	cmp	r3, #0	; 0x0
+a0302588:	aaffffeb 	bge	a030253c <l5+0x19c>
+a030258c:	e51b0120 	ldr	r0, [fp, -#288]
+a0302590:	e3a01000 	mov	r1, #0	; 0x0
+a0302594:	eb0013a2 	bl	a0307424 <printerror>
+a0302598:	eaffffe7 	b	a030253c <l5+0x19c>
+a030259c:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a03025a0:	a030c4d0 	ldrgesb	ip, [r0], -r0
+a03025a4:	a030d6bc 	ldrgeh	sp, [r0], -ip
+a03025a8:	a030c4e8 	eorges	ip, r0, r8, ror #9
+a03025ac:	a030c530 	eorges	ip, r0, r0, lsr r5
+a03025b0:	a030c578 	eorges	ip, r0, r8, ror r5
+a03025b4:	a030c5b8 	ldrgeh	ip, [r0], -r8
+a03025b8:	a030c5f4 	ldrgesh	ip, [r0], -r4
+a03025bc:	a030c5fc 	ldrgesh	ip, [r0], -ip
+a03025c0:	a030c604 	eorges	ip, r0, r4, lsl #12
+a03025c4:	a030c60c 	eorges	ip, r0, ip, lsl #12
+a03025c8:	a030c648 	eorges	ip, r0, r8, asr #12
+a03025cc:	a030c650 	eorges	ip, r0, r0, asr r6
+a03025d0:	a030c664 	eorges	ip, r0, r4, ror #12
+a03025d4:	40700000 	rsbmis	r0, r0, r0
+
+a03025d8 <PrintStatus>:
+a03025d8:	e1a0c00d 	mov	ip, sp
+a03025dc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03025e0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03025e4:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03025e8:	e50b0010 	str	r0, [fp, -#16]
+a03025ec:	e50b1014 	str	r1, [fp, -#20]
+a03025f0:	e59f3148 	ldr	r3, [pc, #328]	; a0302740 <PrintStatus+0x168>
+a03025f4:	e5930000 	ldr	r0, [r3]
+a03025f8:	eb002128 	bl	a030aaa0 <printf>
+a03025fc:	e59f0140 	ldr	r0, [pc, #320]	; a0302744 <PrintStatus+0x16c>
+a0302600:	eb002126 	bl	a030aaa0 <printf>
+a0302604:	e59f313c 	ldr	r3, [pc, #316]	; a0302748 <PrintStatus+0x170>
+a0302608:	e5930060 	ldr	r0, [r3, #96]
+a030260c:	eb001158 	bl	a0306b74 <PrintSerialSpeed>
+a0302610:	e59f0134 	ldr	r0, [pc, #308]	; a030274c <PrintStatus+0x174>
+a0302614:	eb002121 	bl	a030aaa0 <printf>
+a0302618:	e59f0130 	ldr	r0, [pc, #304]	; a0302750 <PrintStatus+0x178>
+a030261c:	eb00211f 	bl	a030aaa0 <printf>
+a0302620:	e59f3120 	ldr	r3, [pc, #288]	; a0302748 <PrintStatus+0x170>
+a0302624:	e5930064 	ldr	r0, [r3, #100]
+a0302628:	eb001151 	bl	a0306b74 <PrintSerialSpeed>
+a030262c:	e59f0118 	ldr	r0, [pc, #280]	; a030274c <PrintStatus+0x174>
+a0302630:	eb00211a 	bl	a030aaa0 <printf>
+a0302634:	e59f0118 	ldr	r0, [pc, #280]	; a0302754 <PrintStatus+0x17c>
+a0302638:	e3a01000 	mov	r1, #0	; 0x0
+a030263c:	eb002117 	bl	a030aaa0 <printf>
+a0302640:	e59f3100 	ldr	r3, [pc, #256]	; a0302748 <PrintStatus+0x170>
+a0302644:	e593304c 	ldr	r3, [r3, #76]
+a0302648:	e3530000 	cmp	r3, #0	; 0x0
+a030264c:	1a000002 	bne	a030265c <PrintStatus+0x84>
+a0302650:	e59f0100 	ldr	r0, [pc, #256]	; a0302758 <PrintStatus+0x180>
+a0302654:	eb002111 	bl	a030aaa0 <printf>
+a0302658:	ea000005 	b	a0302674 <PrintStatus+0x9c>
+a030265c:	e59f30e4 	ldr	r3, [pc, #228]	; a0302748 <PrintStatus+0x170>
+a0302660:	e59f00f4 	ldr	r0, [pc, #244]	; a030275c <PrintStatus+0x184>
+a0302664:	e3a0120a 	mov	r1, #-1610612736	; 0xa0000000
+a0302668:	e2811602 	add	r1, r1, #2097152	; 0x200000
+a030266c:	e5932048 	ldr	r2, [r3, #72]
+a0302670:	eb00210a 	bl	a030aaa0 <printf>
+a0302674:	e59f00e4 	ldr	r0, [pc, #228]	; a0302760 <PrintStatus+0x188>
+a0302678:	e3a01701 	mov	r1, #262144	; 0x40000
+a030267c:	eb002107 	bl	a030aaa0 <printf>
+a0302680:	e59f30c0 	ldr	r3, [pc, #192]	; a0302748 <PrintStatus+0x170>
+a0302684:	e593301c 	ldr	r3, [r3, #28]
+a0302688:	e3530000 	cmp	r3, #0	; 0x0
+a030268c:	1a000002 	bne	a030269c <PrintStatus+0xc4>
+a0302690:	e59f00c0 	ldr	r0, [pc, #192]	; a0302758 <PrintStatus+0x180>
+a0302694:	eb002101 	bl	a030aaa0 <printf>
+a0302698:	ea000005 	b	a03026b4 <PrintStatus+0xdc>
+a030269c:	e59f30a4 	ldr	r3, [pc, #164]	; a0302748 <PrintStatus+0x170>
+a03026a0:	e59f00b4 	ldr	r0, [pc, #180]	; a030275c <PrintStatus+0x184>
+a03026a4:	e3a0120a 	mov	r1, #-1610612736	; 0xa0000000
+a03026a8:	e2811821 	add	r1, r1, #2162688	; 0x210000
+a03026ac:	e5932018 	ldr	r2, [r3, #24]
+a03026b0:	eb0020fa 	bl	a030aaa0 <printf>
+a03026b4:	e59f00a8 	ldr	r0, [pc, #168]	; a0302764 <PrintStatus+0x18c>
+a03026b8:	e3a01701 	mov	r1, #262144	; 0x40000
+a03026bc:	eb0020f7 	bl	a030aaa0 <printf>
+a03026c0:	e59f3080 	ldr	r3, [pc, #128]	; a0302748 <PrintStatus+0x170>
+a03026c4:	e5933004 	ldr	r3, [r3, #4]
+a03026c8:	e3530000 	cmp	r3, #0	; 0x0
+a03026cc:	1a000002 	bne	a03026dc <PrintStatus+0x104>
+a03026d0:	e59f0080 	ldr	r0, [pc, #128]	; a0302758 <PrintStatus+0x180>
+a03026d4:	eb0020f1 	bl	a030aaa0 <printf>
+a03026d8:	ea000005 	b	a03026f4 <PrintStatus+0x11c>
+a03026dc:	e59f3064 	ldr	r3, [pc, #100]	; a0302748 <PrintStatus+0x170>
+a03026e0:	e59f0074 	ldr	r0, [pc, #116]	; a030275c <PrintStatus+0x184>
+a03026e4:	e3a0120a 	mov	r1, #-1610612736	; 0xa0000000
+a03026e8:	e2811902 	add	r1, r1, #32768	; 0x8000
+a03026ec:	e5932000 	ldr	r2, [r3]
+a03026f0:	eb0020ea 	bl	a030aaa0 <printf>
+a03026f4:	e59f006c 	ldr	r0, [pc, #108]	; a0302768 <PrintStatus+0x190>
+a03026f8:	e3a01709 	mov	r1, #2359296	; 0x240000
+a03026fc:	eb0020e7 	bl	a030aaa0 <printf>
+a0302700:	e59f3040 	ldr	r3, [pc, #64]	; a0302748 <PrintStatus+0x170>
+a0302704:	e5933034 	ldr	r3, [r3, #52]
+a0302708:	e3530000 	cmp	r3, #0	; 0x0
+a030270c:	1a000002 	bne	a030271c <PrintStatus+0x144>
+a0302710:	e59f0040 	ldr	r0, [pc, #64]	; a0302758 <PrintStatus+0x180>
+a0302714:	eb0020e1 	bl	a030aaa0 <printf>
+a0302718:	ea000005 	b	a0302734 <PrintStatus+0x15c>
+a030271c:	e59f3024 	ldr	r3, [pc, #36]	; a0302748 <PrintStatus+0x170>
+a0302720:	e59f0034 	ldr	r0, [pc, #52]	; a030275c <PrintStatus+0x184>
+a0302724:	e3a0120a 	mov	r1, #-1610612736	; 0xa0000000
+a0302728:	e2811605 	add	r1, r1, #5242880	; 0x500000
+a030272c:	e5932030 	ldr	r2, [r3, #48]
+a0302730:	eb0020da 	bl	a030aaa0 <printf>
+a0302734:	e3a03000 	mov	r3, #0	; 0x0
+a0302738:	e1a00003 	mov	r0, r3
+a030273c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302740:	a030d6bc 	ldrgeh	sp, [r0], -ip
+a0302744:	a030c68c 	eorges	ip, r0, ip, lsl #13
+a0302748:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a030274c:	a030c6a4 	eorges	ip, r0, r4, lsr #13
+a0302750:	a030c6ac 	eorges	ip, r0, ip, lsr #13
+a0302754:	a030c6c4 	eorges	ip, r0, r4, asr #13
+a0302758:	a030c6d8 	ldrgesb	ip, [r0], -r8
+a030275c:	a030c6e4 	eorges	ip, r0, r4, ror #13
+a0302760:	a030c704 	eorges	ip, r0, r4, lsl #14
+a0302764:	a030c718 	eorges	ip, r0, r8, lsl r7
+a0302768:	a030c72c 	eorges	ip, r0, ip, lsr #14
+
+a030276c <Reload>:
+a030276c:	e1a0c00d 	mov	ip, sp
+a0302770:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302774:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302778:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a030277c:	e50b0010 	str	r0, [fp, -#16]
+a0302780:	e50b1014 	str	r1, [fp, -#20]
+a0302784:	e51b3010 	ldr	r3, [fp, -#16]
+a0302788:	e3530001 	cmp	r3, #1	; 0x1
+a030278c:	ca000002 	bgt	a030279c <Reload+0x30>
+a0302790:	e3e03001 	mvn	r3, #1	; 0x1
+a0302794:	e50b3018 	str	r3, [fp, -#24]
+a0302798:	ea000006 	b	a03027b8 <Reload+0x4c>
+a030279c:	e3a02004 	mov	r2, #4	; 0x4
+a03027a0:	e51b3014 	ldr	r3, [fp, -#20]
+a03027a4:	e0823003 	add	r3, r2, r3
+a03027a8:	e5930000 	ldr	r0, [r3]
+a03027ac:	eb001183 	bl	a0306dc0 <do_reload>
+a03027b0:	e1a03000 	mov	r3, r0
+a03027b4:	e50b3018 	str	r3, [fp, -#24]
+a03027b8:	e51b0018 	ldr	r0, [fp, -#24]
+a03027bc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03027c0 <print_elf_sections>:
+a03027c0:	e1a0c00d 	mov	ip, sp
+a03027c4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03027c8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03027cc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03027d0 <find_parameters>:
+a03027d0:	e1a0c00d 	mov	ip, sp
+a03027d4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03027d8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03027dc:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03027e0:	e59f0038 	ldr	r0, [pc, #56]	; a0302820 <find_parameters+0x50>
+a03027e4:	eb0003d1 	bl	a0303730 <pt_find_by_name>
+a03027e8:	e1a03000 	mov	r3, r0
+a03027ec:	e50b3010 	str	r3, [fp, -#16]
+a03027f0:	e51b3010 	ldr	r3, [fp, -#16]
+a03027f4:	e3530000 	cmp	r3, #0	; 0x0
+a03027f8:	0a000003 	beq	a030280c <find_parameters+0x3c>
+a03027fc:	e51b0010 	ldr	r0, [fp, -#16]
+a0302800:	eb000450 	bl	a0303948 <pt_flash_start>
+a0302804:	e50b0014 	str	r0, [fp, -#20]
+a0302808:	ea000001 	b	a0302814 <find_parameters+0x44>
+a030280c:	e3a03000 	mov	r3, #0	; 0x0
+a0302810:	e50b3014 	str	r3, [fp, -#20]
+a0302814:	e51b3014 	ldr	r3, [fp, -#20]
+a0302818:	e1a00003 	mov	r0, r3
+a030281c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302820:	a030c750 	eorges	ip, r0, r0, asr r7
+
+a0302824 <get_memory_map>:
+a0302824:	e1a0c00d 	mov	ip, sp
+a0302828:	e92dd830 	stmdb	sp!, {r4, r5, fp, ip, lr, pc}
+a030282c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302830:	e24dd008 	sub	sp, sp, #8	; 0x8
+a0302834:	e3a03000 	mov	r3, #0	; 0x0
+a0302838:	e50b301c 	str	r3, [fp, -#28]
+a030283c:	e51b301c 	ldr	r3, [fp, -#28]
+a0302840:	e353001f 	cmp	r3, #31	; 0x1f
+a0302844:	da000000 	ble	a030284c <get_memory_map+0x28>
+a0302848:	ea00000e 	b	a0302888 <get_memory_map+0x64>
+a030284c:	e59f032c 	ldr	r0, [pc, #812]	; a0302b80 <get_memory_map+0x35c>
+a0302850:	e51b201c 	ldr	r2, [fp, -#28]
+a0302854:	e3a01008 	mov	r1, #8	; 0x8
+a0302858:	e1a03002 	mov	r3, r2
+a030285c:	e1a03083 	mov	r3, r3, lsl #1
+a0302860:	e0833002 	add	r3, r3, r2
+a0302864:	e1a03103 	mov	r3, r3, lsl #2
+a0302868:	e0833000 	add	r3, r3, r0
+a030286c:	e0832001 	add	r2, r3, r1
+a0302870:	e3a03000 	mov	r3, #0	; 0x0
+a0302874:	e5823000 	str	r3, [r2]
+a0302878:	e51b301c 	ldr	r3, [fp, -#28]
+a030287c:	e2833001 	add	r3, r3, #1	; 0x1
+a0302880:	e50b301c 	str	r3, [fp, -#28]
+a0302884:	eaffffec 	b	a030283c <get_memory_map+0x18>
+a0302888:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a030288c:	e50b3018 	str	r3, [fp, -#24]
+a0302890:	e51b3018 	ldr	r3, [fp, -#24]
+a0302894:	e3730215 	cmn	r3, #1342177281	; 0x50000001
+a0302898:	9a000000 	bls	a03028a0 <get_memory_map+0x7c>
+a030289c:	ea000006 	b	a03028bc <get_memory_map+0x98>
+a03028a0:	e51b2018 	ldr	r2, [fp, -#24]
+a03028a4:	e3a03000 	mov	r3, #0	; 0x0
+a03028a8:	e5823000 	str	r3, [r2]
+a03028ac:	e51b3018 	ldr	r3, [fp, -#24]
+a03028b0:	e2833601 	add	r3, r3, #1048576	; 0x100000
+a03028b4:	e50b3018 	str	r3, [fp, -#24]
+a03028b8:	eafffff4 	b	a0302890 <get_memory_map+0x6c>
+a03028bc:	e3a03000 	mov	r3, #0	; 0x0
+a03028c0:	e50b301c 	str	r3, [fp, -#28]
+a03028c4:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a03028c8:	e50b3018 	str	r3, [fp, -#24]
+a03028cc:	e51b3018 	ldr	r3, [fp, -#24]
+a03028d0:	e3730215 	cmn	r3, #1342177281	; 0x50000001
+a03028d4:	9a000000 	bls	a03028dc <get_memory_map+0xb8>
+a03028d8:	ea000070 	b	a0302aa0 <get_memory_map+0x27c>
+a03028dc:	e51b0018 	ldr	r0, [fp, -#24]
+a03028e0:	ebfff6de 	bl	a0300460 <testram>
+a03028e4:	e1a03000 	mov	r3, r0
+a03028e8:	e3530000 	cmp	r3, #0	; 0x0
+a03028ec:	1a000058 	bne	a0302a54 <get_memory_map+0x230>
+a03028f0:	e51b3018 	ldr	r3, [fp, -#24]
+a03028f4:	e5933000 	ldr	r3, [r3]
+a03028f8:	e3530000 	cmp	r3, #0	; 0x0
+a03028fc:	0a00000f 	beq	a0302940 <get_memory_map+0x11c>
+a0302900:	e59f0278 	ldr	r0, [pc, #632]	; a0302b80 <get_memory_map+0x35c>
+a0302904:	e51b201c 	ldr	r2, [fp, -#28]
+a0302908:	e3a01008 	mov	r1, #8	; 0x8
+a030290c:	e1a03002 	mov	r3, r2
+a0302910:	e1a03083 	mov	r3, r3, lsl #1
+a0302914:	e0833002 	add	r3, r3, r2
+a0302918:	e1a03103 	mov	r3, r3, lsl #2
+a030291c:	e0833000 	add	r3, r3, r0
+a0302920:	e0833001 	add	r3, r3, r1
+a0302924:	e5933000 	ldr	r3, [r3]
+a0302928:	e3530000 	cmp	r3, #0	; 0x0
+a030292c:	0a000057 	beq	a0302a90 <get_memory_map+0x26c>
+a0302930:	e51b301c 	ldr	r3, [fp, -#28]
+a0302934:	e2833001 	add	r3, r3, #1	; 0x1
+a0302938:	e50b301c 	str	r3, [fp, -#28]
+a030293c:	ea000053 	b	a0302a90 <get_memory_map+0x26c>
+a0302940:	e51b2018 	ldr	r2, [fp, -#24]
+a0302944:	e51b3018 	ldr	r3, [fp, -#24]
+a0302948:	e5823000 	str	r3, [r2]
+a030294c:	e59f022c 	ldr	r0, [pc, #556]	; a0302b80 <get_memory_map+0x35c>
+a0302950:	e51b201c 	ldr	r2, [fp, -#28]
+a0302954:	e3a01008 	mov	r1, #8	; 0x8
+a0302958:	e1a03002 	mov	r3, r2
+a030295c:	e1a03083 	mov	r3, r3, lsl #1
+a0302960:	e0833002 	add	r3, r3, r2
+a0302964:	e1a03103 	mov	r3, r3, lsl #2
+a0302968:	e0833000 	add	r3, r3, r0
+a030296c:	e0833001 	add	r3, r3, r1
+a0302970:	e5933000 	ldr	r3, [r3]
+a0302974:	e3530000 	cmp	r3, #0	; 0x0
+a0302978:	1a00001f 	bne	a03029fc <get_memory_map+0x1d8>
+a030297c:	e59f11fc 	ldr	r1, [pc, #508]	; a0302b80 <get_memory_map+0x35c>
+a0302980:	e51b201c 	ldr	r2, [fp, -#28]
+a0302984:	e1a03002 	mov	r3, r2
+a0302988:	e1a03083 	mov	r3, r3, lsl #1
+a030298c:	e0833002 	add	r3, r3, r2
+a0302990:	e1a03103 	mov	r3, r3, lsl #2
+a0302994:	e0832001 	add	r2, r3, r1
+a0302998:	e51b3018 	ldr	r3, [fp, -#24]
+a030299c:	e5823000 	str	r3, [r2]
+a03029a0:	e59f01d8 	ldr	r0, [pc, #472]	; a0302b80 <get_memory_map+0x35c>
+a03029a4:	e51b201c 	ldr	r2, [fp, -#28]
+a03029a8:	e3a01004 	mov	r1, #4	; 0x4
+a03029ac:	e1a03002 	mov	r3, r2
+a03029b0:	e1a03083 	mov	r3, r3, lsl #1
+a03029b4:	e0833002 	add	r3, r3, r2
+a03029b8:	e1a03103 	mov	r3, r3, lsl #2
+a03029bc:	e0833000 	add	r3, r3, r0
+a03029c0:	e0832001 	add	r2, r3, r1
+a03029c4:	e3a03601 	mov	r3, #1048576	; 0x100000
+a03029c8:	e5823000 	str	r3, [r2]
+a03029cc:	e59f01ac 	ldr	r0, [pc, #428]	; a0302b80 <get_memory_map+0x35c>
+a03029d0:	e51b201c 	ldr	r2, [fp, -#28]
+a03029d4:	e3a01008 	mov	r1, #8	; 0x8
+a03029d8:	e1a03002 	mov	r3, r2
+a03029dc:	e1a03083 	mov	r3, r3, lsl #1
+a03029e0:	e0833002 	add	r3, r3, r2
+a03029e4:	e1a03103 	mov	r3, r3, lsl #2
+a03029e8:	e0833000 	add	r3, r3, r0
+a03029ec:	e0832001 	add	r2, r3, r1
+a03029f0:	e3a03001 	mov	r3, #1	; 0x1
+a03029f4:	e5823000 	str	r3, [r2]
+a03029f8:	ea000024 	b	a0302a90 <get_memory_map+0x26c>
+a03029fc:	e59f017c 	ldr	r0, [pc, #380]	; a0302b80 <get_memory_map+0x35c>
+a0302a00:	e51b201c 	ldr	r2, [fp, -#28]
+a0302a04:	e3a01004 	mov	r1, #4	; 0x4
+a0302a08:	e1a03002 	mov	r3, r2
+a0302a0c:	e1a03083 	mov	r3, r3, lsl #1
+a0302a10:	e0833002 	add	r3, r3, r2
+a0302a14:	e1a03103 	mov	r3, r3, lsl #2
+a0302a18:	e0833000 	add	r3, r3, r0
+a0302a1c:	e0834001 	add	r4, r3, r1
+a0302a20:	e59f0158 	ldr	r0, [pc, #344]	; a0302b80 <get_memory_map+0x35c>
+a0302a24:	e51b201c 	ldr	r2, [fp, -#28]
+a0302a28:	e3a01004 	mov	r1, #4	; 0x4
+a0302a2c:	e1a03002 	mov	r3, r2
+a0302a30:	e1a03083 	mov	r3, r3, lsl #1
+a0302a34:	e0833002 	add	r3, r3, r2
+a0302a38:	e1a03103 	mov	r3, r3, lsl #2
+a0302a3c:	e0833000 	add	r3, r3, r0
+a0302a40:	e0833001 	add	r3, r3, r1
+a0302a44:	e5933000 	ldr	r3, [r3]
+a0302a48:	e2833601 	add	r3, r3, #1048576	; 0x100000
+a0302a4c:	e5843000 	str	r3, [r4]
+a0302a50:	ea00000e 	b	a0302a90 <get_memory_map+0x26c>
+a0302a54:	e59f0124 	ldr	r0, [pc, #292]	; a0302b80 <get_memory_map+0x35c>
+a0302a58:	e51b201c 	ldr	r2, [fp, -#28]
+a0302a5c:	e3a01008 	mov	r1, #8	; 0x8
+a0302a60:	e1a03002 	mov	r3, r2
+a0302a64:	e1a03083 	mov	r3, r3, lsl #1
+a0302a68:	e0833002 	add	r3, r3, r2
+a0302a6c:	e1a03103 	mov	r3, r3, lsl #2
+a0302a70:	e0833000 	add	r3, r3, r0
+a0302a74:	e0833001 	add	r3, r3, r1
+a0302a78:	e5933000 	ldr	r3, [r3]
+a0302a7c:	e3530001 	cmp	r3, #1	; 0x1
+a0302a80:	1a000002 	bne	a0302a90 <get_memory_map+0x26c>
+a0302a84:	e51b301c 	ldr	r3, [fp, -#28]
+a0302a88:	e2833001 	add	r3, r3, #1	; 0x1
+a0302a8c:	e50b301c 	str	r3, [fp, -#28]
+a0302a90:	e51b3018 	ldr	r3, [fp, -#24]
+a0302a94:	e2833601 	add	r3, r3, #1048576	; 0x100000
+a0302a98:	e50b3018 	str	r3, [fp, -#24]
+a0302a9c:	eaffff8a 	b	a03028cc <get_memory_map+0xa8>
+a0302aa0:	e59f00dc 	ldr	r0, [pc, #220]	; a0302b84 <get_memory_map+0x360>
+a0302aa4:	eb001ffd 	bl	a030aaa0 <printf>
+a0302aa8:	e3a03000 	mov	r3, #0	; 0x0
+a0302aac:	e50b301c 	str	r3, [fp, -#28]
+a0302ab0:	e51b301c 	ldr	r3, [fp, -#28]
+a0302ab4:	e353001f 	cmp	r3, #31	; 0x1f
+a0302ab8:	da000000 	ble	a0302ac0 <get_memory_map+0x29c>
+a0302abc:	ea00002e 	b	a0302b7c <get_memory_map+0x358>
+a0302ac0:	e59f00b8 	ldr	r0, [pc, #184]	; a0302b80 <get_memory_map+0x35c>
+a0302ac4:	e51b201c 	ldr	r2, [fp, -#28]
+a0302ac8:	e3a01008 	mov	r1, #8	; 0x8
+a0302acc:	e1a03002 	mov	r3, r2
+a0302ad0:	e1a03083 	mov	r3, r3, lsl #1
+a0302ad4:	e0833002 	add	r3, r3, r2
+a0302ad8:	e1a03103 	mov	r3, r3, lsl #2
+a0302adc:	e0833000 	add	r3, r3, r0
+a0302ae0:	e0833001 	add	r3, r3, r1
+a0302ae4:	e5933000 	ldr	r3, [r3]
+a0302ae8:	e3530000 	cmp	r3, #0	; 0x0
+a0302aec:	0a00001e 	beq	a0302b6c <get_memory_map+0x348>
+a0302af0:	e59f0088 	ldr	r0, [pc, #136]	; a0302b80 <get_memory_map+0x35c>
+a0302af4:	e51b201c 	ldr	r2, [fp, -#28]
+a0302af8:	e3a01004 	mov	r1, #4	; 0x4
+a0302afc:	e1a03002 	mov	r3, r2
+a0302b00:	e1a03083 	mov	r3, r3, lsl #1
+a0302b04:	e0833002 	add	r3, r3, r2
+a0302b08:	e1a03103 	mov	r3, r3, lsl #2
+a0302b0c:	e0833000 	add	r3, r3, r0
+a0302b10:	e0834001 	add	r4, r3, r1
+a0302b14:	e59f1064 	ldr	r1, [pc, #100]	; a0302b80 <get_memory_map+0x35c>
+a0302b18:	e51b201c 	ldr	r2, [fp, -#28]
+a0302b1c:	e1a03002 	mov	r3, r2
+a0302b20:	e1a03083 	mov	r3, r3, lsl #1
+a0302b24:	e0833002 	add	r3, r3, r2
+a0302b28:	e1a03103 	mov	r3, r3, lsl #2
+a0302b2c:	e0835001 	add	r5, r3, r1
+a0302b30:	e59f0048 	ldr	r0, [pc, #72]	; a0302b80 <get_memory_map+0x35c>
+a0302b34:	e51b201c 	ldr	r2, [fp, -#28]
+a0302b38:	e3a01004 	mov	r1, #4	; 0x4
+a0302b3c:	e1a03002 	mov	r3, r2
+a0302b40:	e1a03083 	mov	r3, r3, lsl #1
+a0302b44:	e0833002 	add	r3, r3, r2
+a0302b48:	e1a03103 	mov	r3, r3, lsl #2
+a0302b4c:	e0833000 	add	r3, r3, r0
+a0302b50:	e0833001 	add	r3, r3, r1
+a0302b54:	e5933000 	ldr	r3, [r3]
+a0302b58:	e1a03a23 	mov	r3, r3, lsr #20
+a0302b5c:	e59f0024 	ldr	r0, [pc, #36]	; a0302b88 <get_memory_map+0x364>
+a0302b60:	e5941000 	ldr	r1, [r4]
+a0302b64:	e5952000 	ldr	r2, [r5]
+a0302b68:	eb001fcc 	bl	a030aaa0 <printf>
+a0302b6c:	e51b301c 	ldr	r3, [fp, -#28]
+a0302b70:	e2833001 	add	r3, r3, #1	; 0x1
+a0302b74:	e50b301c 	str	r3, [fp, -#28]
+a0302b78:	eaffffcc 	b	a0302ab0 <get_memory_map+0x28c>
+a0302b7c:	e91ba830 	ldmdb	fp, {r4, r5, fp, sp, pc}
+a0302b80:	a03101a0 	eorges	r0, r1, r0, lsr #3
+a0302b84:	a030c758 	eorges	ip, r0, r8, asr r7
+a0302b88:	a030c768 	eorges	ip, r0, r8, ror #14
+
+a0302b8c <parse_ptag_core>:
+a0302b8c:	e1a0c00d 	mov	ip, sp
+a0302b90:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302b94:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302b98:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0302b9c:	e50b0010 	str	r0, [fp, -#16]
+a0302ba0:	e59f2020 	ldr	r2, [pc, #32]	; a0302bc8 <parse_ptag_core+0x3c>
+a0302ba4:	e51b3010 	ldr	r3, [fp, -#16]
+a0302ba8:	e593300c 	ldr	r3, [r3, #12]
+a0302bac:	e5823064 	str	r3, [r2, #100]
+a0302bb0:	e59f3010 	ldr	r3, [pc, #16]	; a0302bc8 <parse_ptag_core+0x3c>
+a0302bb4:	e5930064 	ldr	r0, [r3, #100]
+a0302bb8:	eb002003 	bl	a030abcc <serial_init>
+a0302bbc:	e3a03000 	mov	r3, #0	; 0x0
+a0302bc0:	e1a00003 	mov	r0, r3
+a0302bc4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302bc8:	a030fd20 	eorges	pc, r0, r0, lsr #26
+
+a0302bcc <parse_ptag_ramdisk>:
+a0302bcc:	e1a0c00d 	mov	ip, sp
+a0302bd0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302bd4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302bd8:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0302bdc:	e50b0010 	str	r0, [fp, -#16]
+a0302be0:	e59f2018 	ldr	r2, [pc, #24]	; a0302c00 <parse_ptag_ramdisk+0x34>
+a0302be4:	e51b3010 	ldr	r3, [fp, -#16]
+a0302be8:	e593300c 	ldr	r3, [r3, #12]
+a0302bec:	e2033001 	and	r3, r3, #1	; 0x1
+a0302bf0:	e5823068 	str	r3, [r2, #104]
+a0302bf4:	e3a03000 	mov	r3, #0	; 0x0
+a0302bf8:	e1a00003 	mov	r0, r3
+a0302bfc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302c00:	a030fd20 	eorges	pc, r0, r0, lsr #26
+
+a0302c04 <parse_ptag_bootdelay>:
+a0302c04:	e1a0c00d 	mov	ip, sp
+a0302c08:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302c0c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302c10:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0302c14:	e50b0010 	str	r0, [fp, -#16]
+a0302c18:	e59f2014 	ldr	r2, [pc, #20]	; a0302c34 <parse_ptag_bootdelay+0x30>
+a0302c1c:	e51b3010 	ldr	r3, [fp, -#16]
+a0302c20:	e593300c 	ldr	r3, [r3, #12]
+a0302c24:	e582306c 	str	r3, [r2, #108]
+a0302c28:	e3a03000 	mov	r3, #0	; 0x0
+a0302c2c:	e1a00003 	mov	r0, r3
+a0302c30:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302c34:	a030fd20 	eorges	pc, r0, r0, lsr #26
+
+a0302c38 <parse_ptag_cmdline>:
+a0302c38:	e1a0c00d 	mov	ip, sp
+a0302c3c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302c40:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302c44:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0302c48:	e50b0010 	str	r0, [fp, -#16]
+a0302c4c:	e51b3010 	ldr	r3, [fp, -#16]
+a0302c50:	e283300c 	add	r3, r3, #12	; 0xc
+a0302c54:	e59f0014 	ldr	r0, [pc, #20]	; a0302c70 <parse_ptag_cmdline+0x38>
+a0302c58:	e1a01003 	mov	r1, r3
+a0302c5c:	e3a02b01 	mov	r2, #1024	; 0x400
+a0302c60:	eb0021f9 	bl	a030b44c <strlcpy>
+a0302c64:	e3a03000 	mov	r3, #0	; 0x0
+a0302c68:	e1a00003 	mov	r0, r3
+a0302c6c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302c70:	a030fd90 	mlages	r0, r0, sp, pc
+
+a0302c74 <parse_ptag_baud>:
+a0302c74:	e1a0c00d 	mov	ip, sp
+a0302c78:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302c7c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302c80:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0302c84:	e50b0010 	str	r0, [fp, -#16]
+a0302c88:	e59f2014 	ldr	r2, [pc, #20]	; a0302ca4 <parse_ptag_baud+0x30>
+a0302c8c:	e51b3010 	ldr	r3, [fp, -#16]
+a0302c90:	e593300c 	ldr	r3, [r3, #12]
+a0302c94:	e5823060 	str	r3, [r2, #96]
+a0302c98:	e3a03000 	mov	r3, #0	; 0x0
+a0302c9c:	e1a00003 	mov	r0, r3
+a0302ca0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302ca4:	a030fd20 	eorges	pc, r0, r0, lsr #26
+
+a0302ca8 <parse_ptag_hwaddr>:
+a0302ca8:	e1a0c00d 	mov	ip, sp
+a0302cac:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302cb0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302cb4:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0302cb8:	e50b0010 	str	r0, [fp, -#16]
+a0302cbc:	eb00126a 	bl	a030766c <ether_get_name>
+a0302cc0:	e1a03000 	mov	r3, r0
+a0302cc4:	e3530000 	cmp	r3, #0	; 0x0
+a0302cc8:	0a00000a 	beq	a0302cf8 <parse_ptag_hwaddr+0x50>
+a0302ccc:	eb001266 	bl	a030766c <ether_get_name>
+a0302cd0:	e1a02000 	mov	r2, r0
+a0302cd4:	e51b3010 	ldr	r3, [fp, -#16]
+a0302cd8:	e283300c 	add	r3, r3, #12	; 0xc
+a0302cdc:	e1a00002 	mov	r0, r2
+a0302ce0:	e1a01003 	mov	r1, r3
+a0302ce4:	e3a0200a 	mov	r2, #10	; 0xa
+a0302ce8:	eb002182 	bl	a030b2f8 <strncmp>
+a0302cec:	e1a03000 	mov	r3, r0
+a0302cf0:	e3530000 	cmp	r3, #0	; 0x0
+a0302cf4:	1a000003 	bne	a0302d08 <parse_ptag_hwaddr+0x60>
+a0302cf8:	e51b3010 	ldr	r3, [fp, -#16]
+a0302cfc:	e2833016 	add	r3, r3, #22	; 0x16
+a0302d00:	e1a00003 	mov	r0, r3
+a0302d04:	eb00123c 	bl	a03075fc <ether_set_addr>
+a0302d08:	e3a03000 	mov	r3, #0	; 0x0
+a0302d0c:	e1a00003 	mov	r0, r3
+a0302d10:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0302d14 <parse_ptag>:
+a0302d14:	e1a0c00d 	mov	ip, sp
+a0302d18:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302d1c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302d20:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0302d24:	e50b0010 	str	r0, [fp, -#16]
+a0302d28:	e50b1014 	str	r1, [fp, -#20]
+a0302d2c:	e59f3084 	ldr	r3, [pc, #132]	; a0302db8 <parse_ptag+0xa4>
+a0302d30:	e50b3018 	str	r3, [fp, -#24]
+a0302d34:	e51b2018 	ldr	r2, [fp, -#24]
+a0302d38:	e59f307c 	ldr	r3, [pc, #124]	; a0302dbc <parse_ptag+0xa8>
+a0302d3c:	e1520003 	cmp	r2, r3
+a0302d40:	3a000000 	bcc	a0302d48 <parse_ptag+0x34>
+a0302d44:	ea000014 	b	a0302d9c <parse_ptag+0x88>
+a0302d48:	e51b3010 	ldr	r3, [fp, -#16]
+a0302d4c:	e51b2018 	ldr	r2, [fp, -#24]
+a0302d50:	e5931004 	ldr	r1, [r3, #4]
+a0302d54:	e5923000 	ldr	r3, [r2]
+a0302d58:	e1510003 	cmp	r1, r3
+a0302d5c:	1a00000a 	bne	a0302d8c <parse_ptag+0x78>
+a0302d60:	e51b3014 	ldr	r3, [fp, -#20]
+a0302d64:	e51b2010 	ldr	r2, [fp, -#16]
+a0302d68:	e5931000 	ldr	r1, [r3]
+a0302d6c:	e5923008 	ldr	r3, [r2, #8]
+a0302d70:	e1510003 	cmp	r1, r3
+a0302d74:	1a000004 	bne	a0302d8c <parse_ptag+0x78>
+a0302d78:	e51b3018 	ldr	r3, [fp, -#24]
+a0302d7c:	e5933004 	ldr	r3, [r3, #4]
+a0302d80:	e51b0010 	ldr	r0, [fp, -#16]
+a0302d84:	e1a0e00f 	mov	lr, pc
+a0302d88:	e1a0f003 	mov	pc, r3
+a0302d8c:	e51b3018 	ldr	r3, [fp, -#24]
+a0302d90:	e2833008 	add	r3, r3, #8	; 0x8
+a0302d94:	e50b3018 	str	r3, [fp, -#24]
+a0302d98:	eaffffe5 	b	a0302d34 <parse_ptag+0x20>
+a0302d9c:	e51b2018 	ldr	r2, [fp, -#24]
+a0302da0:	e59f3014 	ldr	r3, [pc, #20]	; a0302dbc <parse_ptag+0xa8>
+a0302da4:	e1520003 	cmp	r2, r3
+a0302da8:	23a03000 	movcs	r3, #0	; 0x0
+a0302dac:	33a03001 	movcc	r3, #1	; 0x1
+a0302db0:	e1a00003 	mov	r0, r3
+a0302db4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302db8:	a030df50 	eorges	sp, r0, r0, asr pc
+a0302dbc:	a030df80 	eorges	sp, r0, r0, lsl #31
+
+a0302dc0 <parse_ptags>:
+a0302dc0:	e1a0c00d 	mov	ip, sp
+a0302dc4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302dc8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302dcc:	e24dd008 	sub	sp, sp, #8	; 0x8
+a0302dd0:	e50b0010 	str	r0, [fp, -#16]
+a0302dd4:	e50b1014 	str	r1, [fp, -#20]
+a0302dd8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0302ddc <check_ptable_magic>:
+a0302ddc:	e1a0c00d 	mov	ip, sp
+a0302de0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302de4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302de8:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0302dec:	e50b0010 	str	r0, [fp, -#16]
+a0302df0:	e50b1014 	str	r1, [fp, -#20]
+a0302df4:	e51b3010 	ldr	r3, [fp, -#16]
+a0302df8:	e5932000 	ldr	r2, [r3]
+a0302dfc:	e51b3014 	ldr	r3, [fp, -#20]
+a0302e00:	e1520003 	cmp	r2, r3
+a0302e04:	0a000008 	beq	a0302e2c <check_ptable_magic+0x50>
+a0302e08:	e51b3010 	ldr	r3, [fp, -#16]
+a0302e0c:	e59f0028 	ldr	r0, [pc, #40]	; a0302e3c <check_ptable_magic+0x60>
+a0302e10:	e51b1010 	ldr	r1, [fp, -#16]
+a0302e14:	e5932000 	ldr	r2, [r3]
+a0302e18:	e51b3014 	ldr	r3, [fp, -#20]
+a0302e1c:	eb001f1f 	bl	a030aaa0 <printf>
+a0302e20:	e3e03002 	mvn	r3, #2	; 0x2
+a0302e24:	e50b3018 	str	r3, [fp, -#24]
+a0302e28:	ea000001 	b	a0302e34 <check_ptable_magic+0x58>
+a0302e2c:	e3a03000 	mov	r3, #0	; 0x0
+a0302e30:	e50b3018 	str	r3, [fp, -#24]
+a0302e34:	e51b0018 	ldr	r0, [fp, -#24]
+a0302e38:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302e3c:	a030c784 	eorges	ip, r0, r4, lsl #15
+
+a0302e40 <find_flash_ptable>:
+a0302e40:	e1a0c00d 	mov	ip, sp
+a0302e44:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302e48:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302e4c:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0302e50:	e59f30b4 	ldr	r3, [pc, #180]	; a0302f0c <find_flash_ptable+0xcc>
+a0302e54:	e5933000 	ldr	r3, [r3]
+a0302e58:	e5932000 	ldr	r2, [r3]
+a0302e5c:	e59f30ac 	ldr	r3, [pc, #172]	; a0302f10 <find_flash_ptable+0xd0>
+a0302e60:	e1520003 	cmp	r2, r3
+a0302e64:	1a000004 	bne	a0302e7c <find_flash_ptable+0x3c>
+a0302e68:	e59f309c 	ldr	r3, [pc, #156]	; a0302f0c <find_flash_ptable+0xcc>
+a0302e6c:	e59f00a0 	ldr	r0, [pc, #160]	; a0302f14 <find_flash_ptable+0xd4>
+a0302e70:	e5931000 	ldr	r1, [r3]
+a0302e74:	eb001f09 	bl	a030aaa0 <printf>
+a0302e78:	ea000022 	b	a0302f08 <find_flash_ptable+0xc8>
+a0302e7c:	e59f0094 	ldr	r0, [pc, #148]	; a0302f18 <find_flash_ptable+0xd8>
+a0302e80:	eb001f06 	bl	a030aaa0 <printf>
+a0302e84:	e24b3014 	sub	r3, fp, #20	; 0x14
+a0302e88:	e1a00003 	mov	r0, r3
+a0302e8c:	ebfff97f 	bl	a0301490 <flash_get_first_block_address>
+a0302e90:	e1a03000 	mov	r3, r0
+a0302e94:	e50b3018 	str	r3, [fp, -#24]
+a0302e98:	e51b3018 	ldr	r3, [fp, -#24]
+a0302e9c:	e3530000 	cmp	r3, #0	; 0x0
+a0302ea0:	aa000002 	bge	a0302eb0 <find_flash_ptable+0x70>
+a0302ea4:	e59f0070 	ldr	r0, [pc, #112]	; a0302f1c <find_flash_ptable+0xdc>
+a0302ea8:	eb001efc 	bl	a030aaa0 <printf>
+a0302eac:	ea000015 	b	a0302f08 <find_flash_ptable+0xc8>
+a0302eb0:	e1a00000 	nop			(mov r0,r0)
+a0302eb4:	e51b3014 	ldr	r3, [fp, -#20]
+a0302eb8:	e5932000 	ldr	r2, [r3]
+a0302ebc:	e59f304c 	ldr	r3, [pc, #76]	; a0302f10 <find_flash_ptable+0xd0>
+a0302ec0:	e1520003 	cmp	r2, r3
+a0302ec4:	1a000000 	bne	a0302ecc <find_flash_ptable+0x8c>
+a0302ec8:	ea00000b 	b	a0302efc <find_flash_ptable+0xbc>
+a0302ecc:	e51b3014 	ldr	r3, [fp, -#20]
+a0302ed0:	e50b3010 	str	r3, [fp, -#16]
+a0302ed4:	e24b3014 	sub	r3, fp, #20	; 0x14
+a0302ed8:	e1a00003 	mov	r0, r3
+a0302edc:	e51b1010 	ldr	r1, [fp, -#16]
+a0302ee0:	ebfff980 	bl	a03014e8 <flash_get_next_block_address>
+a0302ee4:	e1a03000 	mov	r3, r0
+a0302ee8:	e50b3018 	str	r3, [fp, -#24]
+a0302eec:	e51b3018 	ldr	r3, [fp, -#24]
+a0302ef0:	e3530000 	cmp	r3, #0	; 0x0
+a0302ef4:	aaffffee 	bge	a0302eb4 <find_flash_ptable+0x74>
+a0302ef8:	ea000002 	b	a0302f08 <find_flash_ptable+0xc8>
+a0302efc:	e59f2008 	ldr	r2, [pc, #8]	; a0302f0c <find_flash_ptable+0xcc>
+a0302f00:	e51b3014 	ldr	r3, [fp, -#20]
+a0302f04:	e5823000 	str	r3, [r2]
+a0302f08:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0302f0c:	a0310340 	eorges	r0, r1, r0, asr #6
+a0302f10:	42465054 	submi	r5, r6, #84	; 0x54
+a0302f14:	a030c7b0 	ldrgeh	ip, [r0], -r0
+a0302f18:	a030c7e4 	eorges	ip, r0, r4, ror #15
+a0302f1c:	a030c80c 	eorges	ip, r0, ip, lsl #16
+
+a0302f20 <copy_ptable>:
+a0302f20:	e1a0c00d 	mov	ip, sp
+a0302f24:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0302f28:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0302f2c:	e24dd01c 	sub	sp, sp, #28	; 0x1c
+a0302f30:	e50b0010 	str	r0, [fp, -#16]
+a0302f34:	e50b1014 	str	r1, [fp, -#20]
+a0302f38:	e50b2018 	str	r2, [fp, -#24]
+a0302f3c:	e50b301c 	str	r3, [fp, -#28]
+a0302f40:	e3a03001 	mov	r3, #1	; 0x1
+a0302f44:	e50b3020 	str	r3, [fp, -#32]
+a0302f48:	e3a03000 	mov	r3, #0	; 0x0
+a0302f4c:	e50b3024 	str	r3, [fp, -#36]
+a0302f50:	e51b301c 	ldr	r3, [fp, -#28]
+a0302f54:	e3530001 	cmp	r3, #1	; 0x1
+a0302f58:	ca000002 	bgt	a0302f68 <copy_ptable+0x48>
+a0302f5c:	e3e03000 	mvn	r3, #0	; 0x0
+a0302f60:	e50b3028 	str	r3, [fp, -#40]
+a0302f64:	ea000061 	b	a03030f0 <copy_ptable+0x1d0>
+a0302f68:	e51b3010 	ldr	r3, [fp, -#16]
+a0302f6c:	e5932000 	ldr	r2, [r3]
+a0302f70:	e51b3018 	ldr	r3, [fp, -#24]
+a0302f74:	e1520003 	cmp	r2, r3
+a0302f78:	0a000002 	beq	a0302f88 <copy_ptable+0x68>
+a0302f7c:	e3e03000 	mvn	r3, #0	; 0x0
+a0302f80:	e50b3028 	str	r3, [fp, -#40]
+a0302f84:	ea000059 	b	a03030f0 <copy_ptable+0x1d0>
+a0302f88:	e51b3010 	ldr	r3, [fp, -#16]
+a0302f8c:	e51b0014 	ldr	r0, [fp, -#20]
+a0302f90:	e51b1010 	ldr	r1, [fp, -#16]
+a0302f94:	e5932004 	ldr	r2, [r3, #4]
+a0302f98:	eb001a0a 	bl	a03097c8 <memcpy>
+a0302f9c:	e51b3010 	ldr	r3, [fp, -#16]
+a0302fa0:	e51b2010 	ldr	r2, [fp, -#16]
+a0302fa4:	e5933004 	ldr	r3, [r3, #4]
+a0302fa8:	e0823003 	add	r3, r2, r3
+a0302fac:	e50b3010 	str	r3, [fp, -#16]
+a0302fb0:	e51b3014 	ldr	r3, [fp, -#20]
+a0302fb4:	e51b2014 	ldr	r2, [fp, -#20]
+a0302fb8:	e5933004 	ldr	r3, [r3, #4]
+a0302fbc:	e0823003 	add	r3, r2, r3
+a0302fc0:	e50b3014 	str	r3, [fp, -#20]
+a0302fc4:	e51b3020 	ldr	r3, [fp, -#32]
+a0302fc8:	e2833001 	add	r3, r3, #1	; 0x1
+a0302fcc:	e50b3020 	str	r3, [fp, -#32]
+a0302fd0:	e51b2020 	ldr	r2, [fp, -#32]
+a0302fd4:	e51b301c 	ldr	r3, [fp, -#28]
+a0302fd8:	e1520003 	cmp	r2, r3
+a0302fdc:	1a000002 	bne	a0302fec <copy_ptable+0xcc>
+a0302fe0:	e3e03006 	mvn	r3, #6	; 0x6
+a0302fe4:	e50b3024 	str	r3, [fp, -#36]
+a0302fe8:	ea000039 	b	a03030d4 <copy_ptable+0x1b4>
+a0302fec:	e51b0010 	ldr	r0, [fp, -#16]
+a0302ff0:	e3a01c45 	mov	r1, #17664	; 0x4500
+a0302ff4:	e28111c5 	add	r1, r1, #1073741873	; 0x40000031
+a0302ff8:	e2811625 	add	r1, r1, #38797312	; 0x2500000
+a0302ffc:	ebffff76 	bl	a0302ddc <check_ptable_magic>
+a0303000:	e1a03000 	mov	r3, r0
+a0303004:	e50b3024 	str	r3, [fp, -#36]
+a0303008:	e51b3024 	ldr	r3, [fp, -#36]
+a030300c:	e3530000 	cmp	r3, #0	; 0x0
+a0303010:	1a000000 	bne	a0303018 <copy_ptable+0xf8>
+a0303014:	ea00001b 	b	a0303088 <copy_ptable+0x168>
+a0303018:	e51b0010 	ldr	r0, [fp, -#16]
+a030301c:	e59f10d4 	ldr	r1, [pc, #212]	; a03030f8 <copy_ptable+0x1d8>
+a0303020:	ebffff6d 	bl	a0302ddc <check_ptable_magic>
+a0303024:	e1a03000 	mov	r3, r0
+a0303028:	e50b3024 	str	r3, [fp, -#36]
+a030302c:	e51b3024 	ldr	r3, [fp, -#36]
+a0303030:	e3530000 	cmp	r3, #0	; 0x0
+a0303034:	1a000003 	bne	a0303048 <copy_ptable+0x128>
+a0303038:	e59b3004 	ldr	r3, [fp, #4]
+a030303c:	e3530000 	cmp	r3, #0	; 0x0
+a0303040:	0affffe2 	beq	a0302fd0 <copy_ptable+0xb0>
+a0303044:	ea00000f 	b	a0303088 <copy_ptable+0x168>
+a0303048:	e51b0010 	ldr	r0, [fp, -#16]
+a030304c:	e3a01c45 	mov	r1, #17664	; 0x4500
+a0303050:	e28111cd 	add	r1, r1, #1073741875	; 0x40000033
+a0303054:	e2811625 	add	r1, r1, #38797312	; 0x2500000
+a0303058:	ebffff5f 	bl	a0302ddc <check_ptable_magic>
+a030305c:	e1a03000 	mov	r3, r0
+a0303060:	e50b3024 	str	r3, [fp, -#36]
+a0303064:	e51b3024 	ldr	r3, [fp, -#36]
+a0303068:	e3530000 	cmp	r3, #0	; 0x0
+a030306c:	1a000002 	bne	a030307c <copy_ptable+0x15c>
+a0303070:	e3a03000 	mov	r3, #0	; 0x0
+a0303074:	e50b3024 	str	r3, [fp, -#36]
+a0303078:	ea000015 	b	a03030d4 <copy_ptable+0x1b4>
+a030307c:	e3e03002 	mvn	r3, #2	; 0x2
+a0303080:	e50b3024 	str	r3, [fp, -#36]
+a0303084:	ea000012 	b	a03030d4 <copy_ptable+0x1b4>
+a0303088:	e51b3010 	ldr	r3, [fp, -#16]
+a030308c:	e51b0014 	ldr	r0, [fp, -#20]
+a0303090:	e51b1010 	ldr	r1, [fp, -#16]
+a0303094:	e5932004 	ldr	r2, [r3, #4]
+a0303098:	eb0019ca 	bl	a03097c8 <memcpy>
+a030309c:	e51b3010 	ldr	r3, [fp, -#16]
+a03030a0:	e51b2010 	ldr	r2, [fp, -#16]
+a03030a4:	e5933004 	ldr	r3, [r3, #4]
+a03030a8:	e0823003 	add	r3, r2, r3
+a03030ac:	e50b3010 	str	r3, [fp, -#16]
+a03030b0:	e51b3014 	ldr	r3, [fp, -#20]
+a03030b4:	e51b2014 	ldr	r2, [fp, -#20]
+a03030b8:	e5933004 	ldr	r3, [r3, #4]
+a03030bc:	e0823003 	add	r3, r2, r3
+a03030c0:	e50b3014 	str	r3, [fp, -#20]
+a03030c4:	e51b3020 	ldr	r3, [fp, -#32]
+a03030c8:	e2833001 	add	r3, r3, #1	; 0x1
+a03030cc:	e50b3020 	str	r3, [fp, -#32]
+a03030d0:	eaffffbe 	b	a0302fd0 <copy_ptable+0xb0>
+a03030d4:	e51b3014 	ldr	r3, [fp, -#20]
+a03030d8:	e3a02c45 	mov	r2, #17664	; 0x4500
+a03030dc:	e28221cd 	add	r2, r2, #1073741875	; 0x40000033
+a03030e0:	e2822625 	add	r2, r2, #38797312	; 0x2500000
+a03030e4:	e5832000 	str	r2, [r3]
+a03030e8:	e51b3024 	ldr	r3, [fp, -#36]
+a03030ec:	e50b3028 	str	r3, [fp, -#40]
+a03030f0:	e51b0028 	ldr	r0, [fp, -#40]
+a03030f4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03030f8:	42504530 	submis	r4, r0, #201326592	; 0xc000000
+
+a03030fc <ptable_print>:
+a03030fc:	e1a0c00d 	mov	ip, sp
+a0303100:	e92dd830 	stmdb	sp!, {r4, r5, fp, ip, lr, pc}
+a0303104:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303108:	e24dd010 	sub	sp, sp, #16	; 0x10
+a030310c:	e50b0018 	str	r0, [fp, -#24]
+a0303110:	e51b3018 	ldr	r3, [fp, -#24]
+a0303114:	e593300c 	ldr	r3, [r3, #12]
+a0303118:	e1a03523 	mov	r3, r3, lsr #10
+a030311c:	e51b2018 	ldr	r2, [fp, -#24]
+a0303120:	e59f01b4 	ldr	r0, [pc, #436]	; a03032dc <ptable_print+0x1e0>
+a0303124:	e1a01003 	mov	r1, r3
+a0303128:	e5922008 	ldr	r2, [r2, #8]
+a030312c:	eb001e5b 	bl	a030aaa0 <printf>
+a0303130:	e51b3018 	ldr	r3, [fp, -#24]
+a0303134:	e51b2018 	ldr	r2, [fp, -#24]
+a0303138:	e5933004 	ldr	r3, [r3, #4]
+a030313c:	e0823003 	add	r3, r2, r3
+a0303140:	e50b3018 	str	r3, [fp, -#24]
+a0303144:	e51b3018 	ldr	r3, [fp, -#24]
+a0303148:	e5933000 	ldr	r3, [r3]
+a030314c:	e50b3020 	str	r3, [fp, -#32]
+a0303150:	e3a03c45 	mov	r3, #17664	; 0x4500
+a0303154:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a0303158:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a030315c:	e51b2020 	ldr	r2, [fp, -#32]
+a0303160:	e1520003 	cmp	r2, r3
+a0303164:	0a000011 	beq	a03031b0 <ptable_print+0xb4>
+a0303168:	e3a03c45 	mov	r3, #17664	; 0x4500
+a030316c:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a0303170:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a0303174:	e51b2020 	ldr	r2, [fp, -#32]
+a0303178:	e1520003 	cmp	r2, r3
+a030317c:	8a000004 	bhi	a0303194 <ptable_print+0x98>
+a0303180:	e59f3158 	ldr	r3, [pc, #344]	; a03032e0 <ptable_print+0x1e4>
+a0303184:	e51b2020 	ldr	r2, [fp, -#32]
+a0303188:	e1520003 	cmp	r2, r3
+a030318c:	0affffe7 	beq	a0303130 <ptable_print+0x34>
+a0303190:	ea00004c 	b	a03032c8 <ptable_print+0x1cc>
+a0303194:	e3a03c45 	mov	r3, #17664	; 0x4500
+a0303198:	e28331cd 	add	r3, r3, #1073741875	; 0x40000033
+a030319c:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03031a0:	e51b2020 	ldr	r2, [fp, -#32]
+a03031a4:	e1520003 	cmp	r2, r3
+a03031a8:	0a00004a 	beq	a03032d8 <ptable_print+0x1dc>
+a03031ac:	ea000045 	b	a03032c8 <ptable_print+0x1cc>
+a03031b0:	e51b2018 	ldr	r2, [fp, -#24]
+a03031b4:	e51b4018 	ldr	r4, [fp, -#24]
+a03031b8:	e51b5018 	ldr	r5, [fp, -#24]
+a03031bc:	e51b3018 	ldr	r3, [fp, -#24]
+a03031c0:	e2833010 	add	r3, r3, #16	; 0x10
+a03031c4:	e58d3000 	str	r3, [sp]
+a03031c8:	e59f0114 	ldr	r0, [pc, #276]	; a03032e4 <ptable_print+0x1e8>
+a03031cc:	e592100c 	ldr	r1, [r2, #12]
+a03031d0:	e5942008 	ldr	r2, [r4, #8]
+a03031d4:	e595300c 	ldr	r3, [r5, #12]
+a03031d8:	eb001e30 	bl	a030aaa0 <printf>
+a03031dc:	e51b3018 	ldr	r3, [fp, -#24]
+a03031e0:	e5933030 	ldr	r3, [r3, #48]
+a03031e4:	e2033001 	and	r3, r3, #1	; 0x1
+a03031e8:	e3530000 	cmp	r3, #0	; 0x0
+a03031ec:	0a000001 	beq	a03031f8 <ptable_print+0xfc>
+a03031f0:	e59f00f0 	ldr	r0, [pc, #240]	; a03032e8 <ptable_print+0x1ec>
+a03031f4:	eb001e29 	bl	a030aaa0 <printf>
+a03031f8:	e51b3018 	ldr	r3, [fp, -#24]
+a03031fc:	e5933034 	ldr	r3, [r3, #52]
+a0303200:	e3530000 	cmp	r3, #0	; 0x0
+a0303204:	0a00000e 	beq	a0303244 <ptable_print+0x148>
+a0303208:	e51b3018 	ldr	r3, [fp, -#24]
+a030320c:	e5933030 	ldr	r3, [r3, #48]
+a0303210:	e2033002 	and	r3, r3, #2	; 0x2
+a0303214:	e3530000 	cmp	r3, #0	; 0x0
+a0303218:	0a000002 	beq	a0303228 <ptable_print+0x12c>
+a030321c:	e59f30c8 	ldr	r3, [pc, #200]	; a03032ec <ptable_print+0x1f0>
+a0303220:	e50b301c 	str	r3, [fp, -#28]
+a0303224:	ea000001 	b	a0303230 <ptable_print+0x134>
+a0303228:	e59f20c0 	ldr	r2, [pc, #192]	; a03032f0 <ptable_print+0x1f4>
+a030322c:	e50b201c 	str	r2, [fp, -#28]
+a0303230:	e51b3018 	ldr	r3, [fp, -#24]
+a0303234:	e59f00b8 	ldr	r0, [pc, #184]	; a03032f4 <ptable_print+0x1f8>
+a0303238:	e51b101c 	ldr	r1, [fp, -#28]
+a030323c:	e5932034 	ldr	r2, [r3, #52]
+a0303240:	eb001e16 	bl	a030aaa0 <printf>
+a0303244:	e51b3018 	ldr	r3, [fp, -#24]
+a0303248:	e5933038 	ldr	r3, [r3, #56]
+a030324c:	e3530000 	cmp	r3, #0	; 0x0
+a0303250:	0a00000d 	beq	a030328c <ptable_print+0x190>
+a0303254:	e51b3018 	ldr	r3, [fp, -#24]
+a0303258:	e59f0098 	ldr	r0, [pc, #152]	; a03032f8 <ptable_print+0x1fc>
+a030325c:	e5931038 	ldr	r1, [r3, #56]
+a0303260:	eb001e0e 	bl	a030aaa0 <printf>
+a0303264:	e51b3018 	ldr	r3, [fp, -#24]
+a0303268:	e5933030 	ldr	r3, [r3, #48]
+a030326c:	e2033004 	and	r3, r3, #4	; 0x4
+a0303270:	e3530000 	cmp	r3, #0	; 0x0
+a0303274:	0a000002 	beq	a0303284 <ptable_print+0x188>
+a0303278:	e59f007c 	ldr	r0, [pc, #124]	; a03032fc <ptable_print+0x200>
+a030327c:	eb001e07 	bl	a030aaa0 <printf>
+a0303280:	ea000001 	b	a030328c <ptable_print+0x190>
+a0303284:	e59f0074 	ldr	r0, [pc, #116]	; a0303300 <ptable_print+0x204>
+a0303288:	eb001e04 	bl	a030aaa0 <printf>
+a030328c:	e51b3018 	ldr	r3, [fp, -#24]
+a0303290:	e5933030 	ldr	r3, [r3, #48]
+a0303294:	e2033008 	and	r3, r3, #8	; 0x8
+a0303298:	e3530000 	cmp	r3, #0	; 0x0
+a030329c:	0a000001 	beq	a03032a8 <ptable_print+0x1ac>
+a03032a0:	e59f005c 	ldr	r0, [pc, #92]	; a0303304 <ptable_print+0x208>
+a03032a4:	eb001dfd 	bl	a030aaa0 <printf>
+a03032a8:	e51b3018 	ldr	r3, [fp, -#24]
+a03032ac:	e5933030 	ldr	r3, [r3, #48]
+a03032b0:	e2033010 	and	r3, r3, #16	; 0x10
+a03032b4:	e3530000 	cmp	r3, #0	; 0x0
+a03032b8:	0affff9c 	beq	a0303130 <ptable_print+0x34>
+a03032bc:	e59f0044 	ldr	r0, [pc, #68]	; a0303308 <ptable_print+0x20c>
+a03032c0:	eb001df6 	bl	a030aaa0 <printf>
+a03032c4:	eaffff99 	b	a0303130 <ptable_print+0x34>
+a03032c8:	eb00104b 	bl	a03073fc <printerrprefix>
+a03032cc:	e59f0038 	ldr	r0, [pc, #56]	; a030330c <ptable_print+0x210>
+a03032d0:	e51b1018 	ldr	r1, [fp, -#24]
+a03032d4:	eb001df1 	bl	a030aaa0 <printf>
+a03032d8:	e91ba830 	ldmdb	fp, {r4, r5, fp, sp, pc}
+a03032dc:	a030c824 	eorges	ip, r0, r4, lsr #16
+a03032e0:	42504530 	submis	r4, r0, #201326592	; 0xc000000
+a03032e4:	a030c850 	eorges	ip, r0, r0, asr r8
+a03032e8:	a030c874 	eorges	ip, r0, r4, ror r8
+a03032ec:	a030c894 	mlages	r0, r4, r8, ip
+a03032f0:	a030c8a4 	eorges	ip, r0, r4, lsr #17
+a03032f4:	a030c8a8 	eorges	ip, r0, r8, lsr #17
+a03032f8:	a030c8c0 	eorges	ip, r0, r0, asr #17
+a03032fc:	a030c8dc 	ldrgesb	ip, [r0], -ip
+a0303300:	a030c8f8 	ldrgesh	ip, [r0], -r8
+a0303304:	a030c8fc 	ldrgesh	ip, [r0], -ip
+a0303308:	a030c910 	eorges	ip, r0, r0, lsl r9
+a030330c:	a030c928 	eorges	ip, r0, r8, lsr #18
+
+a0303310 <fixup_ptable>:
+a0303310:	e1a0c00d 	mov	ip, sp
+a0303314:	e92dd810 	stmdb	sp!, {r4, fp, ip, lr, pc}
+a0303318:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030331c:	e24dd01c 	sub	sp, sp, #28	; 0x1c
+a0303320:	e50b0014 	str	r0, [fp, -#20]
+a0303324:	e51b3014 	ldr	r3, [fp, -#20]
+a0303328:	e5933008 	ldr	r3, [r3, #8]
+a030332c:	e50b3018 	str	r3, [fp, -#24]
+a0303330:	e51b3014 	ldr	r3, [fp, -#20]
+a0303334:	e593300c 	ldr	r3, [r3, #12]
+a0303338:	e50b301c 	str	r3, [fp, -#28]
+a030333c:	e3a03000 	mov	r3, #0	; 0x0
+a0303340:	e50b3020 	str	r3, [fp, -#32]
+a0303344:	e51b3014 	ldr	r3, [fp, -#20]
+a0303348:	e50b3024 	str	r3, [fp, -#36]
+a030334c:	e51b3014 	ldr	r3, [fp, -#20]
+a0303350:	e59f017c 	ldr	r0, [pc, #380]	; a03034d4 <fixup_ptable+0x1c4>
+a0303354:	e5931008 	ldr	r1, [r3, #8]
+a0303358:	eb001dd0 	bl	a030aaa0 <printf>
+a030335c:	e51b3014 	ldr	r3, [fp, -#20]
+a0303360:	e59f0170 	ldr	r0, [pc, #368]	; a03034d8 <fixup_ptable+0x1c8>
+a0303364:	e593100c 	ldr	r1, [r3, #12]
+a0303368:	eb001dcc 	bl	a030aaa0 <printf>
+a030336c:	e51b3014 	ldr	r3, [fp, -#20]
+a0303370:	e593300c 	ldr	r3, [r3, #12]
+a0303374:	e3730001 	cmn	r3, #1	; 0x1
+a0303378:	1a000005 	bne	a0303394 <fixup_ptable+0x84>
+a030337c:	e51b4014 	ldr	r4, [fp, -#20]
+a0303380:	ebfff5d9 	bl	a0300aec <flash_get_size>
+a0303384:	e1a03000 	mov	r3, r0
+a0303388:	e50b301c 	str	r3, [fp, -#28]
+a030338c:	e51b301c 	ldr	r3, [fp, -#28]
+a0303390:	e584300c 	str	r3, [r4, #12]
+a0303394:	e1a00000 	nop			(mov r0,r0)
+a0303398:	e51b3024 	ldr	r3, [fp, -#36]
+a030339c:	e51b2024 	ldr	r2, [fp, -#36]
+a03033a0:	e5933004 	ldr	r3, [r3, #4]
+a03033a4:	e0823003 	add	r3, r2, r3
+a03033a8:	e50b3024 	str	r3, [fp, -#36]
+a03033ac:	e51b3024 	ldr	r3, [fp, -#36]
+a03033b0:	e5933000 	ldr	r3, [r3]
+a03033b4:	e50b302c 	str	r3, [fp, -#44]
+a03033b8:	e3a03c45 	mov	r3, #17664	; 0x4500
+a03033bc:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a03033c0:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03033c4:	e51b202c 	ldr	r2, [fp, -#44]
+a03033c8:	e1520003 	cmp	r2, r3
+a03033cc:	0a000014 	beq	a0303424 <fixup_ptable+0x114>
+a03033d0:	e3a03c45 	mov	r3, #17664	; 0x4500
+a03033d4:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a03033d8:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03033dc:	e51b202c 	ldr	r2, [fp, -#44]
+a03033e0:	e1520003 	cmp	r2, r3
+a03033e4:	8a000004 	bhi	a03033fc <fixup_ptable+0xec>
+a03033e8:	e59f30ec 	ldr	r3, [pc, #236]	; a03034dc <fixup_ptable+0x1cc>
+a03033ec:	e51b202c 	ldr	r2, [fp, -#44]
+a03033f0:	e1520003 	cmp	r2, r3
+a03033f4:	0affffe7 	beq	a0303398 <fixup_ptable+0x88>
+a03033f8:	ea00002d 	b	a03034b4 <fixup_ptable+0x1a4>
+a03033fc:	e3a03c45 	mov	r3, #17664	; 0x4500
+a0303400:	e28331cd 	add	r3, r3, #1073741875	; 0x40000033
+a0303404:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a0303408:	e51b202c 	ldr	r2, [fp, -#44]
+a030340c:	e1520003 	cmp	r2, r3
+a0303410:	0a000000 	beq	a0303418 <fixup_ptable+0x108>
+a0303414:	ea000026 	b	a03034b4 <fixup_ptable+0x1a4>
+a0303418:	e3a03000 	mov	r3, #0	; 0x0
+a030341c:	e50b3028 	str	r3, [fp, -#40]
+a0303420:	ea000029 	b	a03034cc <fixup_ptable+0x1bc>
+a0303424:	e51b3020 	ldr	r3, [fp, -#32]
+a0303428:	e3530000 	cmp	r3, #0	; 0x0
+a030342c:	0a000005 	beq	a0303448 <fixup_ptable+0x138>
+a0303430:	eb000ff1 	bl	a03073fc <printerrprefix>
+a0303434:	e59f00a4 	ldr	r0, [pc, #164]	; a03034e0 <fixup_ptable+0x1d0>
+a0303438:	eb001d98 	bl	a030aaa0 <printf>
+a030343c:	e3e02000 	mvn	r2, #0	; 0x0
+a0303440:	e50b2028 	str	r2, [fp, -#40]
+a0303444:	ea000020 	b	a03034cc <fixup_ptable+0x1bc>
+a0303448:	e51b3024 	ldr	r3, [fp, -#36]
+a030344c:	e5933008 	ldr	r3, [r3, #8]
+a0303450:	e3730001 	cmn	r3, #1	; 0x1
+a0303454:	1a000002 	bne	a0303464 <fixup_ptable+0x154>
+a0303458:	e51b2024 	ldr	r2, [fp, -#36]
+a030345c:	e51b3018 	ldr	r3, [fp, -#24]
+a0303460:	e5823008 	str	r3, [r2, #8]
+a0303464:	e51b3024 	ldr	r3, [fp, -#36]
+a0303468:	e593300c 	ldr	r3, [r3, #12]
+a030346c:	e3730001 	cmn	r3, #1	; 0x1
+a0303470:	1a000004 	bne	a0303488 <fixup_ptable+0x178>
+a0303474:	e51b3024 	ldr	r3, [fp, -#36]
+a0303478:	e51b201c 	ldr	r2, [fp, -#28]
+a030347c:	e583200c 	str	r2, [r3, #12]
+a0303480:	e3a03001 	mov	r3, #1	; 0x1
+a0303484:	e50b3020 	str	r3, [fp, -#32]
+a0303488:	e51b3024 	ldr	r3, [fp, -#36]
+a030348c:	e51b2018 	ldr	r2, [fp, -#24]
+a0303490:	e593300c 	ldr	r3, [r3, #12]
+a0303494:	e0823003 	add	r3, r2, r3
+a0303498:	e50b3018 	str	r3, [fp, -#24]
+a030349c:	e51b3024 	ldr	r3, [fp, -#36]
+a03034a0:	e51b201c 	ldr	r2, [fp, -#28]
+a03034a4:	e593300c 	ldr	r3, [r3, #12]
+a03034a8:	e0633002 	rsb	r3, r3, r2
+a03034ac:	e50b301c 	str	r3, [fp, -#28]
+a03034b0:	eaffffb8 	b	a0303398 <fixup_ptable+0x88>
+a03034b4:	eb000fd0 	bl	a03073fc <printerrprefix>
+a03034b8:	e59f0024 	ldr	r0, [pc, #36]	; a03034e4 <fixup_ptable+0x1d4>
+a03034bc:	e51b1024 	ldr	r1, [fp, -#36]
+a03034c0:	eb001d76 	bl	a030aaa0 <printf>
+a03034c4:	e3e03000 	mvn	r3, #0	; 0x0
+a03034c8:	e50b3028 	str	r3, [fp, -#40]
+a03034cc:	e51b0028 	ldr	r0, [fp, -#40]
+a03034d0:	e91ba810 	ldmdb	fp, {r4, fp, sp, pc}
+a03034d4:	a030c948 	eorges	ip, r0, r8, asr #18
+a03034d8:	a030c964 	eorges	ip, r0, r4, ror #18
+a03034dc:	42504530 	submis	r4, r0, #201326592	; 0xc000000
+a03034e0:	a030c97c 	eorges	ip, r0, ip, ror r9
+a03034e4:	a030c928 	eorges	ip, r0, r8, lsr #18
+
+a03034e8 <ptable_init>:
+a03034e8:	e1a0c00d 	mov	ip, sp
+a03034ec:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03034f0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03034f4:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03034f8:	e59f2124 	ldr	r2, [pc, #292]	; a0303624 <ptable_init+0x13c>
+a03034fc:	e3a03000 	mov	r3, #0	; 0x0
+a0303500:	e58d3000 	str	r3, [sp]
+a0303504:	e5920000 	ldr	r0, [r2]
+a0303508:	e59f1118 	ldr	r1, [pc, #280]	; a0303628 <ptable_init+0x140>
+a030350c:	e59f2118 	ldr	r2, [pc, #280]	; a030362c <ptable_init+0x144>
+a0303510:	e3a03040 	mov	r3, #64	; 0x40
+a0303514:	ebfffe81 	bl	a0302f20 <copy_ptable>
+a0303518:	e1a03000 	mov	r3, r0
+a030351c:	e50b3010 	str	r3, [fp, -#16]
+a0303520:	e51b3010 	ldr	r3, [fp, -#16]
+a0303524:	e3530000 	cmp	r3, #0	; 0x0
+a0303528:	1a000006 	bne	a0303548 <ptable_init+0x60>
+a030352c:	e59f30f4 	ldr	r3, [pc, #244]	; a0303628 <ptable_init+0x140>
+a0303530:	e59f20f8 	ldr	r2, [pc, #248]	; a0303630 <ptable_init+0x148>
+a0303534:	e5832000 	str	r2, [r3]
+a0303538:	e59f30e4 	ldr	r3, [pc, #228]	; a0303624 <ptable_init+0x13c>
+a030353c:	e59f00f0 	ldr	r0, [pc, #240]	; a0303634 <ptable_init+0x14c>
+a0303540:	e5931000 	ldr	r1, [r3]
+a0303544:	eb001d55 	bl	a030aaa0 <printf>
+a0303548:	ebfffe3c 	bl	a0302e40 <find_flash_ptable>
+a030354c:	e59f20e4 	ldr	r2, [pc, #228]	; a0303638 <ptable_init+0x150>
+a0303550:	e3a03001 	mov	r3, #1	; 0x1
+a0303554:	e58d3000 	str	r3, [sp]
+a0303558:	e5920000 	ldr	r0, [r2]
+a030355c:	e59f10c4 	ldr	r1, [pc, #196]	; a0303628 <ptable_init+0x140>
+a0303560:	e59f20d4 	ldr	r2, [pc, #212]	; a030363c <ptable_init+0x154>
+a0303564:	e3a03040 	mov	r3, #64	; 0x40
+a0303568:	ebfffe6c 	bl	a0302f20 <copy_ptable>
+a030356c:	e1a03000 	mov	r3, r0
+a0303570:	e50b3010 	str	r3, [fp, -#16]
+a0303574:	e51b3010 	ldr	r3, [fp, -#16]
+a0303578:	e3530000 	cmp	r3, #0	; 0x0
+a030357c:	1a000006 	bne	a030359c <ptable_init+0xb4>
+a0303580:	e59f30a0 	ldr	r3, [pc, #160]	; a0303628 <ptable_init+0x140>
+a0303584:	e59f20a4 	ldr	r2, [pc, #164]	; a0303630 <ptable_init+0x148>
+a0303588:	e5832000 	str	r2, [r3]
+a030358c:	e59f30a4 	ldr	r3, [pc, #164]	; a0303638 <ptable_init+0x150>
+a0303590:	e59f00a8 	ldr	r0, [pc, #168]	; a0303640 <ptable_init+0x158>
+a0303594:	e5931000 	ldr	r1, [r3]
+a0303598:	eb001d40 	bl	a030aaa0 <printf>
+a030359c:	e59f0084 	ldr	r0, [pc, #132]	; a0303628 <ptable_init+0x140>
+a03035a0:	e59f1088 	ldr	r1, [pc, #136]	; a0303630 <ptable_init+0x148>
+a03035a4:	ebfffe0c 	bl	a0302ddc <check_ptable_magic>
+a03035a8:	e1a03000 	mov	r3, r0
+a03035ac:	e3530000 	cmp	r3, #0	; 0x0
+a03035b0:	0a000002 	beq	a03035c0 <ptable_init+0xd8>
+a03035b4:	e59f0088 	ldr	r0, [pc, #136]	; a0303644 <ptable_init+0x15c>
+a03035b8:	eb001d38 	bl	a030aaa0 <printf>
+a03035bc:	ea000006 	b	a03035dc <ptable_init+0xf4>
+a03035c0:	e59f0060 	ldr	r0, [pc, #96]	; a0303628 <ptable_init+0x140>
+a03035c4:	ebffff51 	bl	a0303310 <fixup_ptable>
+a03035c8:	e1a03000 	mov	r3, r0
+a03035cc:	e3530000 	cmp	r3, #0	; 0x0
+a03035d0:	0a000012 	beq	a0303620 <ptable_init+0x138>
+a03035d4:	e59f006c 	ldr	r0, [pc, #108]	; a0303648 <ptable_init+0x160>
+a03035d8:	eb001d30 	bl	a030aaa0 <printf>
+a03035dc:	e59f2044 	ldr	r2, [pc, #68]	; a0303628 <ptable_init+0x140>
+a03035e0:	e59f3048 	ldr	r3, [pc, #72]	; a0303630 <ptable_init+0x148>
+a03035e4:	e5823000 	str	r3, [r2]
+a03035e8:	e59f2038 	ldr	r2, [pc, #56]	; a0303628 <ptable_init+0x140>
+a03035ec:	e3a0303c 	mov	r3, #60	; 0x3c
+a03035f0:	e5823004 	str	r3, [r2, #4]
+a03035f4:	e59f202c 	ldr	r2, [pc, #44]	; a0303628 <ptable_init+0x140>
+a03035f8:	e3a03000 	mov	r3, #0	; 0x0
+a03035fc:	e5823008 	str	r3, [r2, #8]
+a0303600:	e59f2020 	ldr	r2, [pc, #32]	; a0303628 <ptable_init+0x140>
+a0303604:	e3a03000 	mov	r3, #0	; 0x0
+a0303608:	e582300c 	str	r3, [r2, #12]
+a030360c:	e59f2014 	ldr	r2, [pc, #20]	; a0303628 <ptable_init+0x140>
+a0303610:	e3a03c45 	mov	r3, #17664	; 0x4500
+a0303614:	e28331cd 	add	r3, r3, #1073741875	; 0x40000033
+a0303618:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a030361c:	e582303c 	str	r3, [r2, #60]
+a0303620:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303624:	a0310320 	eorges	r0, r1, r0, lsr #6
+a0303628:	a030e588 	eorges	lr, r0, r8, lsl #11
+a030362c:	42445054 	submi	r5, r4, #84	; 0x54
+a0303630:	42435054 	submi	r5, r3, #84	; 0x54
+a0303634:	a030c9c0 	eorges	ip, r0, r0, asr #19
+a0303638:	a0310340 	eorges	r0, r1, r0, asr #6
+a030363c:	42465054 	submi	r5, r6, #84	; 0x54
+a0303640:	a030c9ec 	eorges	ip, r0, ip, ror #19
+a0303644:	a030ca14 	eorges	ip, r0, r4, lsl sl
+a0303648:	a030ca34 	eorges	ip, r0, r4, lsr sl
+
+a030364c <pt_first>:
+a030364c:	e1a0c00d 	mov	ip, sp
+a0303650:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303654:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303658:	e59f000c 	ldr	r0, [pc, #12]	; a030366c <pt_first+0x20>
+a030365c:	eb000003 	bl	a0303670 <pt_next>
+a0303660:	e1a03000 	mov	r3, r0
+a0303664:	e1a00003 	mov	r0, r3
+a0303668:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030366c:	a030e588 	eorges	lr, r0, r8, lsl #11
+
+a0303670 <pt_next>:
+a0303670:	e1a0c00d 	mov	ip, sp
+a0303674:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303678:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030367c:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0303680:	e50b0010 	str	r0, [fp, -#16]
+a0303684:	e51b3010 	ldr	r3, [fp, -#16]
+a0303688:	e51b2010 	ldr	r2, [fp, -#16]
+a030368c:	e5933004 	ldr	r3, [r3, #4]
+a0303690:	e0823003 	add	r3, r2, r3
+a0303694:	e50b3010 	str	r3, [fp, -#16]
+a0303698:	e51b3010 	ldr	r3, [fp, -#16]
+a030369c:	e5933000 	ldr	r3, [r3]
+a03036a0:	e50b3018 	str	r3, [fp, -#24]
+a03036a4:	e3a03c45 	mov	r3, #17664	; 0x4500
+a03036a8:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a03036ac:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03036b0:	e51b2018 	ldr	r2, [fp, -#24]
+a03036b4:	e1520003 	cmp	r2, r3
+a03036b8:	0a000014 	beq	a0303710 <pt_next+0xa0>
+a03036bc:	e3a03c45 	mov	r3, #17664	; 0x4500
+a03036c0:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a03036c4:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03036c8:	e51b2018 	ldr	r2, [fp, -#24]
+a03036cc:	e1520003 	cmp	r2, r3
+a03036d0:	8a000004 	bhi	a03036e8 <pt_next+0x78>
+a03036d4:	e59f3050 	ldr	r3, [pc, #80]	; a030372c <pt_next+0xbc>
+a03036d8:	e51b2018 	ldr	r2, [fp, -#24]
+a03036dc:	e1520003 	cmp	r2, r3
+a03036e0:	0affffe7 	beq	a0303684 <pt_next+0x14>
+a03036e4:	ea00000c 	b	a030371c <pt_next+0xac>
+a03036e8:	e3a03c45 	mov	r3, #17664	; 0x4500
+a03036ec:	e28331cd 	add	r3, r3, #1073741875	; 0x40000033
+a03036f0:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03036f4:	e51b2018 	ldr	r2, [fp, -#24]
+a03036f8:	e1520003 	cmp	r2, r3
+a03036fc:	0a000000 	beq	a0303704 <pt_next+0x94>
+a0303700:	ea000005 	b	a030371c <pt_next+0xac>
+a0303704:	e3a03000 	mov	r3, #0	; 0x0
+a0303708:	e50b3014 	str	r3, [fp, -#20]
+a030370c:	ea000004 	b	a0303724 <pt_next+0xb4>
+a0303710:	e51b3010 	ldr	r3, [fp, -#16]
+a0303714:	e50b3014 	str	r3, [fp, -#20]
+a0303718:	ea000001 	b	a0303724 <pt_next+0xb4>
+a030371c:	e3a02000 	mov	r2, #0	; 0x0
+a0303720:	e50b2014 	str	r2, [fp, -#20]
+a0303724:	e51b0014 	ldr	r0, [fp, -#20]
+a0303728:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030372c:	42504530 	submis	r4, r0, #201326592	; 0xc000000
+
+a0303730 <pt_find_by_name>:
+a0303730:	e1a0c00d 	mov	ip, sp
+a0303734:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303738:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030373c:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0303740:	e50b0010 	str	r0, [fp, -#16]
+a0303744:	e59f30dc 	ldr	r3, [pc, #220]	; a0303828 <pt_find_by_name+0xf8>
+a0303748:	e50b3014 	str	r3, [fp, -#20]
+a030374c:	e51b3014 	ldr	r3, [fp, -#20]
+a0303750:	e51b2014 	ldr	r2, [fp, -#20]
+a0303754:	e5933004 	ldr	r3, [r3, #4]
+a0303758:	e0823003 	add	r3, r2, r3
+a030375c:	e50b3014 	str	r3, [fp, -#20]
+a0303760:	e51b3014 	ldr	r3, [fp, -#20]
+a0303764:	e5933000 	ldr	r3, [r3]
+a0303768:	e50b301c 	str	r3, [fp, -#28]
+a030376c:	e3a03c45 	mov	r3, #17664	; 0x4500
+a0303770:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a0303774:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a0303778:	e51b201c 	ldr	r2, [fp, -#28]
+a030377c:	e1520003 	cmp	r2, r3
+a0303780:	0a000014 	beq	a03037d8 <pt_find_by_name+0xa8>
+a0303784:	e3a03c45 	mov	r3, #17664	; 0x4500
+a0303788:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a030378c:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a0303790:	e51b201c 	ldr	r2, [fp, -#28]
+a0303794:	e1520003 	cmp	r2, r3
+a0303798:	8a000004 	bhi	a03037b0 <pt_find_by_name+0x80>
+a030379c:	e59f3088 	ldr	r3, [pc, #136]	; a030382c <pt_find_by_name+0xfc>
+a03037a0:	e51b201c 	ldr	r2, [fp, -#28]
+a03037a4:	e1520003 	cmp	r2, r3
+a03037a8:	0affffe7 	beq	a030374c <pt_find_by_name+0x1c>
+a03037ac:	ea000015 	b	a0303808 <pt_find_by_name+0xd8>
+a03037b0:	e3a03c45 	mov	r3, #17664	; 0x4500
+a03037b4:	e28331cd 	add	r3, r3, #1073741875	; 0x40000033
+a03037b8:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03037bc:	e51b201c 	ldr	r2, [fp, -#28]
+a03037c0:	e1520003 	cmp	r2, r3
+a03037c4:	0a000000 	beq	a03037cc <pt_find_by_name+0x9c>
+a03037c8:	ea00000e 	b	a0303808 <pt_find_by_name+0xd8>
+a03037cc:	e3a03000 	mov	r3, #0	; 0x0
+a03037d0:	e50b3018 	str	r3, [fp, -#24]
+a03037d4:	ea000011 	b	a0303820 <pt_find_by_name+0xf0>
+a03037d8:	e51b3014 	ldr	r3, [fp, -#20]
+a03037dc:	e2833010 	add	r3, r3, #16	; 0x10
+a03037e0:	e1a00003 	mov	r0, r3
+a03037e4:	e51b1010 	ldr	r1, [fp, -#16]
+a03037e8:	e3a02020 	mov	r2, #32	; 0x20
+a03037ec:	eb001ec1 	bl	a030b2f8 <strncmp>
+a03037f0:	e1a03000 	mov	r3, r0
+a03037f4:	e3530000 	cmp	r3, #0	; 0x0
+a03037f8:	1affffd3 	bne	a030374c <pt_find_by_name+0x1c>
+a03037fc:	e51b3014 	ldr	r3, [fp, -#20]
+a0303800:	e50b3018 	str	r3, [fp, -#24]
+a0303804:	ea000005 	b	a0303820 <pt_find_by_name+0xf0>
+a0303808:	eb000efb 	bl	a03073fc <printerrprefix>
+a030380c:	e59f001c 	ldr	r0, [pc, #28]	; a0303830 <pt_find_by_name+0x100>
+a0303810:	e51b1014 	ldr	r1, [fp, -#20]
+a0303814:	eb001ca1 	bl	a030aaa0 <printf>
+a0303818:	e3a02000 	mov	r2, #0	; 0x0
+a030381c:	e50b2018 	str	r2, [fp, -#24]
+a0303820:	e51b0018 	ldr	r0, [fp, -#24]
+a0303824:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303828:	a030e588 	eorges	lr, r0, r8, lsl #11
+a030382c:	42504530 	submis	r4, r0, #201326592	; 0xc000000
+a0303830:	a030c928 	eorges	ip, r0, r8, lsr #18
+
+a0303834 <pt_find_by_address>:
+a0303834:	e1a0c00d 	mov	ip, sp
+a0303838:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030383c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303840:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0303844:	e50b0010 	str	r0, [fp, -#16]
+a0303848:	e59f30ec 	ldr	r3, [pc, #236]	; a030393c <pt_find_by_address+0x108>
+a030384c:	e50b3014 	str	r3, [fp, -#20]
+a0303850:	e51b3014 	ldr	r3, [fp, -#20]
+a0303854:	e51b2014 	ldr	r2, [fp, -#20]
+a0303858:	e5933004 	ldr	r3, [r3, #4]
+a030385c:	e0823003 	add	r3, r2, r3
+a0303860:	e50b3014 	str	r3, [fp, -#20]
+a0303864:	e51b3014 	ldr	r3, [fp, -#20]
+a0303868:	e5933000 	ldr	r3, [r3]
+a030386c:	e50b301c 	str	r3, [fp, -#28]
+a0303870:	e3a03c45 	mov	r3, #17664	; 0x4500
+a0303874:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a0303878:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a030387c:	e51b201c 	ldr	r2, [fp, -#28]
+a0303880:	e1520003 	cmp	r2, r3
+a0303884:	0a000014 	beq	a03038dc <pt_find_by_address+0xa8>
+a0303888:	e3a03c45 	mov	r3, #17664	; 0x4500
+a030388c:	e28331c5 	add	r3, r3, #1073741873	; 0x40000031
+a0303890:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a0303894:	e51b201c 	ldr	r2, [fp, -#28]
+a0303898:	e1520003 	cmp	r2, r3
+a030389c:	8a000004 	bhi	a03038b4 <pt_find_by_address+0x80>
+a03038a0:	e59f3098 	ldr	r3, [pc, #152]	; a0303940 <pt_find_by_address+0x10c>
+a03038a4:	e51b201c 	ldr	r2, [fp, -#28]
+a03038a8:	e1520003 	cmp	r2, r3
+a03038ac:	0affffe7 	beq	a0303850 <pt_find_by_address+0x1c>
+a03038b0:	ea000019 	b	a030391c <pt_find_by_address+0xe8>
+a03038b4:	e3a03c45 	mov	r3, #17664	; 0x4500
+a03038b8:	e28331cd 	add	r3, r3, #1073741875	; 0x40000033
+a03038bc:	e2833625 	add	r3, r3, #38797312	; 0x2500000
+a03038c0:	e51b201c 	ldr	r2, [fp, -#28]
+a03038c4:	e1520003 	cmp	r2, r3
+a03038c8:	0a000000 	beq	a03038d0 <pt_find_by_address+0x9c>
+a03038cc:	ea000012 	b	a030391c <pt_find_by_address+0xe8>
+a03038d0:	e3a03000 	mov	r3, #0	; 0x0
+a03038d4:	e50b3018 	str	r3, [fp, -#24]
+a03038d8:	ea000015 	b	a0303934 <pt_find_by_address+0x100>
+a03038dc:	e51b3014 	ldr	r3, [fp, -#20]
+a03038e0:	e51b2010 	ldr	r2, [fp, -#16]
+a03038e4:	e5933008 	ldr	r3, [r3, #8]
+a03038e8:	e1520003 	cmp	r2, r3
+a03038ec:	3affffd7 	bcc	a0303850 <pt_find_by_address+0x1c>
+a03038f0:	e51b3014 	ldr	r3, [fp, -#20]
+a03038f4:	e51b2014 	ldr	r2, [fp, -#20]
+a03038f8:	e5931008 	ldr	r1, [r3, #8]
+a03038fc:	e592300c 	ldr	r3, [r2, #12]
+a0303900:	e0812003 	add	r2, r1, r3
+a0303904:	e51b3010 	ldr	r3, [fp, -#16]
+a0303908:	e1530002 	cmp	r3, r2
+a030390c:	2affffcf 	bcs	a0303850 <pt_find_by_address+0x1c>
+a0303910:	e51b3014 	ldr	r3, [fp, -#20]
+a0303914:	e50b3018 	str	r3, [fp, -#24]
+a0303918:	ea000005 	b	a0303934 <pt_find_by_address+0x100>
+a030391c:	eb000eb6 	bl	a03073fc <printerrprefix>
+a0303920:	e59f001c 	ldr	r0, [pc, #28]	; a0303944 <pt_find_by_address+0x110>
+a0303924:	e51b1014 	ldr	r1, [fp, -#20]
+a0303928:	eb001c5c 	bl	a030aaa0 <printf>
+a030392c:	e3a02000 	mov	r2, #0	; 0x0
+a0303930:	e50b2018 	str	r2, [fp, -#24]
+a0303934:	e51b0018 	ldr	r0, [fp, -#24]
+a0303938:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030393c:	a030e588 	eorges	lr, r0, r8, lsl #11
+a0303940:	42504530 	submis	r4, r0, #201326592	; 0xc000000
+a0303944:	a030c928 	eorges	ip, r0, r8, lsr #18
+
+a0303948 <pt_flash_start>:
+a0303948:	e1a0c00d 	mov	ip, sp
+a030394c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303950:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303954:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0303958:	e50b0010 	str	r0, [fp, -#16]
+a030395c:	e59f3014 	ldr	r3, [pc, #20]	; a0303978 <pt_flash_start+0x30>
+a0303960:	e51b2010 	ldr	r2, [fp, -#16]
+a0303964:	e5931008 	ldr	r1, [r3, #8]
+a0303968:	e5923008 	ldr	r3, [r2, #8]
+a030396c:	e0813003 	add	r3, r1, r3
+a0303970:	e1a00003 	mov	r0, r3
+a0303974:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303978:	a030e588 	eorges	lr, r0, r8, lsl #11
+
+a030397c <ptprint>:
+a030397c:	e1a0c00d 	mov	ip, sp
+a0303980:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303984:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303988:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030398c:	e50b0010 	str	r0, [fp, -#16]
+a0303990:	e50b1014 	str	r1, [fp, -#20]
+a0303994:	e59f000c 	ldr	r0, [pc, #12]	; a03039a8 <ptprint+0x2c>
+a0303998:	ebfffdd7 	bl	a03030fc <ptable_print>
+a030399c:	e3a03000 	mov	r3, #0	; 0x0
+a03039a0:	e1a00003 	mov	r0, r3
+a03039a4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03039a8:	a030e588 	eorges	lr, r0, r8, lsl #11
+
+a03039ac <reblob>:
+a03039ac:	e1a0c00d 	mov	ip, sp
+a03039b0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03039b4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03039b8:	e24dd010 	sub	sp, sp, #16	; 0x10
+a03039bc:	e50b0010 	str	r0, [fp, -#16]
+a03039c0:	e50b1014 	str	r1, [fp, -#20]
+a03039c4:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a03039c8:	e2833602 	add	r3, r3, #2097152	; 0x200000
+a03039cc:	e50b3018 	str	r3, [fp, -#24]
+a03039d0:	e59f304c 	ldr	r3, [pc, #76]	; a0303a24 <reblob+0x78>
+a03039d4:	e593304c 	ldr	r3, [r3, #76]
+a03039d8:	e3530000 	cmp	r3, #0	; 0x0
+a03039dc:	1a000005 	bne	a03039f8 <reblob+0x4c>
+a03039e0:	eb000e85 	bl	a03073fc <printerrprefix>
+a03039e4:	e59f003c 	ldr	r0, [pc, #60]	; a0303a28 <reblob+0x7c>
+a03039e8:	eb001c2c 	bl	a030aaa0 <printf>
+a03039ec:	e3e03000 	mvn	r3, #0	; 0x0
+a03039f0:	e50b301c 	str	r3, [fp, -#28]
+a03039f4:	ea000008 	b	a0303a1c <reblob+0x70>
+a03039f8:	e59f002c 	ldr	r0, [pc, #44]	; a0303a2c <reblob+0x80>
+a03039fc:	eb001c27 	bl	a030aaa0 <printf>
+a0303a00:	eb001ccf 	bl	a030ad44 <serial_flush_output>
+a0303a04:	eb000f76 	bl	a03077e4 <exit_subsystems>
+a0303a08:	e51b3018 	ldr	r3, [fp, -#24]
+a0303a0c:	e1a0e00f 	mov	lr, pc
+a0303a10:	e1a0f003 	mov	pc, r3
+a0303a14:	e3a03000 	mov	r3, #0	; 0x0
+a0303a18:	e50b301c 	str	r3, [fp, -#28]
+a0303a1c:	e51b001c 	ldr	r0, [fp, -#28]
+a0303a20:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303a24:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a0303a28:	a030ca60 	eorges	ip, r0, r0, ror #20
+a0303a2c:	a030ca78 	eorges	ip, r0, r8, ror sl
+
+a0303a30 <ldr_update_progress>:
+a0303a30:	e1a0c00d 	mov	ip, sp
+a0303a34:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303a38:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303a3c:	e59f0004 	ldr	r0, [pc, #4]	; a0303a48 <ldr_update_progress+0x18>
+a0303a40:	eb001c16 	bl	a030aaa0 <printf>
+a0303a44:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303a48:	a030caa0 	eorges	ip, r0, r0, lsr #21
+
+a0303a4c <load_kernel>:
+a0303a4c:	e1a0c00d 	mov	ip, sp
+a0303a50:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303a54:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303a58:	e24dd020 	sub	sp, sp, #32	; 0x20
+a0303a5c:	e50b0010 	str	r0, [fp, -#16]
+a0303a60:	e3a03000 	mov	r3, #0	; 0x0
+a0303a64:	e50b3018 	str	r3, [fp, -#24]
+a0303a68:	ebfffef7 	bl	a030364c <pt_first>
+a0303a6c:	e1a03000 	mov	r3, r0
+a0303a70:	e50b301c 	str	r3, [fp, -#28]
+a0303a74:	e51b301c 	ldr	r3, [fp, -#28]
+a0303a78:	e3530000 	cmp	r3, #0	; 0x0
+a0303a7c:	1a000000 	bne	a0303a84 <load_kernel+0x38>
+a0303a80:	ea00001e 	b	a0303b00 <load_kernel+0xb4>
+a0303a84:	e51b301c 	ldr	r3, [fp, -#28]
+a0303a88:	e5933030 	ldr	r3, [r3, #48]
+a0303a8c:	e2033004 	and	r3, r3, #4	; 0x4
+a0303a90:	e3530000 	cmp	r3, #0	; 0x0
+a0303a94:	0a000014 	beq	a0303aec <load_kernel+0xa0>
+a0303a98:	e59f3128 	ldr	r3, [pc, #296]	; a0303bc8 <load_kernel+0x17c>
+a0303a9c:	e50b3018 	str	r3, [fp, -#24]
+a0303aa0:	e51b001c 	ldr	r0, [fp, -#28]
+a0303aa4:	ebffffa7 	bl	a0303948 <pt_flash_start>
+a0303aa8:	e50b0020 	str	r0, [fp, -#32]
+a0303aac:	e51b301c 	ldr	r3, [fp, -#28]
+a0303ab0:	e593300c 	ldr	r3, [r3, #12]
+a0303ab4:	e50b3028 	str	r3, [fp, -#40]
+a0303ab8:	e51b0020 	ldr	r0, [fp, -#32]
+a0303abc:	ebfff54c 	bl	a0300ff4 <flash_get_block_size>
+a0303ac0:	e50b0024 	str	r0, [fp, -#36]
+a0303ac4:	e51b3018 	ldr	r3, [fp, -#24]
+a0303ac8:	e24b2028 	sub	r2, fp, #40	; 0x28
+a0303acc:	e5933000 	ldr	r3, [r3]
+a0303ad0:	e1a00002 	mov	r0, r2
+a0303ad4:	e1a0e00f 	mov	lr, pc
+a0303ad8:	e1a0f003 	mov	pc, r3
+a0303adc:	e1a03000 	mov	r3, r0
+a0303ae0:	e3530000 	cmp	r3, #0	; 0x0
+a0303ae4:	0a000000 	beq	a0303aec <load_kernel+0xa0>
+a0303ae8:	ea000004 	b	a0303b00 <load_kernel+0xb4>
+a0303aec:	e51b001c 	ldr	r0, [fp, -#28]
+a0303af0:	ebfffede 	bl	a0303670 <pt_next>
+a0303af4:	e1a03000 	mov	r3, r0
+a0303af8:	e50b301c 	str	r3, [fp, -#28]
+a0303afc:	eaffffdc 	b	a0303a74 <load_kernel+0x28>
+a0303b00:	e51b301c 	ldr	r3, [fp, -#28]
+a0303b04:	e3530000 	cmp	r3, #0	; 0x0
+a0303b08:	1a000005 	bne	a0303b24 <load_kernel+0xd8>
+a0303b0c:	eb000e3a 	bl	a03073fc <printerrprefix>
+a0303b10:	e59f00b4 	ldr	r0, [pc, #180]	; a0303bcc <load_kernel+0x180>
+a0303b14:	eb001be1 	bl	a030aaa0 <printf>
+a0303b18:	e3a03001 	mov	r3, #1	; 0x1
+a0303b1c:	e50b302c 	str	r3, [fp, -#44]
+a0303b20:	ea000026 	b	a0303bc0 <load_kernel+0x174>
+a0303b24:	e51b301c 	ldr	r3, [fp, -#28]
+a0303b28:	e2833010 	add	r3, r3, #16	; 0x10
+a0303b2c:	e51b2018 	ldr	r2, [fp, -#24]
+a0303b30:	e59f0098 	ldr	r0, [pc, #152]	; a0303bd0 <load_kernel+0x184>
+a0303b34:	e1a01003 	mov	r1, r3
+a0303b38:	e5922008 	ldr	r2, [r2, #8]
+a0303b3c:	eb001bd7 	bl	a030aaa0 <printf>
+a0303b40:	e51b3018 	ldr	r3, [fp, -#24]
+a0303b44:	e24b2028 	sub	r2, fp, #40	; 0x28
+a0303b48:	e5933004 	ldr	r3, [r3, #4]
+a0303b4c:	e3a0020a 	mov	r0, #-1610612736	; 0xa0000000
+a0303b50:	e2800902 	add	r0, r0, #32768	; 0x8000
+a0303b54:	e1a01002 	mov	r1, r2
+a0303b58:	e59f2074 	ldr	r2, [pc, #116]	; a0303bd4 <load_kernel+0x188>
+a0303b5c:	e1a0e00f 	mov	lr, pc
+a0303b60:	e1a0f003 	mov	pc, r3
+a0303b64:	e1a03000 	mov	r3, r0
+a0303b68:	e50b3014 	str	r3, [fp, -#20]
+a0303b6c:	e51b3014 	ldr	r3, [fp, -#20]
+a0303b70:	e3530000 	cmp	r3, #0	; 0x0
+a0303b74:	1a000005 	bne	a0303b90 <load_kernel+0x144>
+a0303b78:	eb000e1f 	bl	a03073fc <printerrprefix>
+a0303b7c:	e59f0054 	ldr	r0, [pc, #84]	; a0303bd8 <load_kernel+0x18c>
+a0303b80:	eb001bc6 	bl	a030aaa0 <printf>
+a0303b84:	e3a03001 	mov	r3, #1	; 0x1
+a0303b88:	e50b302c 	str	r3, [fp, -#44]
+a0303b8c:	ea00000b 	b	a0303bc0 <load_kernel+0x174>
+a0303b90:	e51b2010 	ldr	r2, [fp, -#16]
+a0303b94:	e51b3014 	ldr	r3, [fp, -#20]
+a0303b98:	e5823000 	str	r3, [r2]
+a0303b9c:	e51b2010 	ldr	r2, [fp, -#16]
+a0303ba0:	e3a03000 	mov	r3, #0	; 0x0
+a0303ba4:	e5823004 	str	r3, [r2, #4]
+a0303ba8:	e59f002c 	ldr	r0, [pc, #44]	; a0303bdc <load_kernel+0x190>
+a0303bac:	e51b1014 	ldr	r1, [fp, -#20]
+a0303bb0:	e51b2014 	ldr	r2, [fp, -#20]
+a0303bb4:	eb001bb9 	bl	a030aaa0 <printf>
+a0303bb8:	e3a03000 	mov	r3, #0	; 0x0
+a0303bbc:	e50b302c 	str	r3, [fp, -#44]
+a0303bc0:	e51b002c 	ldr	r0, [fp, -#44]
+a0303bc4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303bc8:	a030d77c 	eorges	sp, r0, ip, ror r7
+a0303bcc:	a030caa4 	eorges	ip, r0, r4, lsr #21
+a0303bd0:	a030cabc 	ldrgeh	ip, [r0], -ip
+a0303bd4:	a030cae8 	eorges	ip, r0, r8, ror #21
+a0303bd8:	a030caf4 	ldrgesh	ip, [r0], -r4
+a0303bdc:	a030cb0c 	eorges	ip, r0, ip, lsl #22
+
+a0303be0 <zImage_check_magic>:
+a0303be0:	e1a0c00d 	mov	ip, sp
+a0303be4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303be8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303bec:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0303bf0:	e50b0010 	str	r0, [fp, -#16]
+a0303bf4:	e51b3010 	ldr	r3, [fp, -#16]
+a0303bf8:	e3a02024 	mov	r2, #36	; 0x24
+a0303bfc:	e5933008 	ldr	r3, [r3, #8]
+a0303c00:	e0823003 	add	r3, r2, r3
+a0303c04:	e5932000 	ldr	r2, [r3]
+a0303c08:	e3a0375b 	mov	r3, #23855104	; 0x16c0000
+a0303c0c:	e2833bca 	add	r3, r3, #206848	; 0x32800
+a0303c10:	e2833018 	add	r3, r3, #24	; 0x18
+a0303c14:	e1520003 	cmp	r2, r3
+a0303c18:	13a03000 	movne	r3, #0	; 0x0
+a0303c1c:	03a03001 	moveq	r3, #1	; 0x1
+a0303c20:	e1a00003 	mov	r0, r3
+a0303c24:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0303c28 <zImage_load_kernel>:
+a0303c28:	e1a0c00d 	mov	ip, sp
+a0303c2c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303c30:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303c34:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0303c38:	e50b0010 	str	r0, [fp, -#16]
+a0303c3c:	e50b1014 	str	r1, [fp, -#20]
+a0303c40:	e50b2018 	str	r2, [fp, -#24]
+a0303c44:	e51b3014 	ldr	r3, [fp, -#20]
+a0303c48:	e3a0202c 	mov	r2, #44	; 0x2c
+a0303c4c:	e5933008 	ldr	r3, [r3, #8]
+a0303c50:	e0821003 	add	r1, r2, r3
+a0303c54:	e51b3014 	ldr	r3, [fp, -#20]
+a0303c58:	e3a02028 	mov	r2, #40	; 0x28
+a0303c5c:	e5933008 	ldr	r3, [r3, #8]
+a0303c60:	e0823003 	add	r3, r2, r3
+a0303c64:	e5912000 	ldr	r2, [r1]
+a0303c68:	e5933000 	ldr	r3, [r3]
+a0303c6c:	e0633002 	rsb	r3, r3, r2
+a0303c70:	e50b301c 	str	r3, [fp, -#28]
+a0303c74:	e3a03000 	mov	r3, #0	; 0x0
+a0303c78:	e50b3020 	str	r3, [fp, -#32]
+a0303c7c:	e51b301c 	ldr	r3, [fp, -#28]
+a0303c80:	e2432701 	sub	r2, r3, #262144	; 0x40000
+a0303c84:	e51b3020 	ldr	r3, [fp, -#32]
+a0303c88:	e1530002 	cmp	r3, r2
+a0303c8c:	9a000000 	bls	a0303c94 <zImage_load_kernel+0x6c>
+a0303c90:	ea00000f 	b	a0303cd4 <zImage_load_kernel+0xac>
+a0303c94:	ebffff65 	bl	a0303a30 <ldr_update_progress>
+a0303c98:	e51b2010 	ldr	r2, [fp, -#16]
+a0303c9c:	e51b3020 	ldr	r3, [fp, -#32]
+a0303ca0:	e0821003 	add	r1, r2, r3
+a0303ca4:	e51b3014 	ldr	r3, [fp, -#20]
+a0303ca8:	e5932008 	ldr	r2, [r3, #8]
+a0303cac:	e51b3020 	ldr	r3, [fp, -#32]
+a0303cb0:	e0823003 	add	r3, r2, r3
+a0303cb4:	e1a00001 	mov	r0, r1
+a0303cb8:	e1a01003 	mov	r1, r3
+a0303cbc:	e3a02701 	mov	r2, #262144	; 0x40000
+a0303cc0:	eb0016c0 	bl	a03097c8 <memcpy>
+a0303cc4:	e51b3020 	ldr	r3, [fp, -#32]
+a0303cc8:	e2833701 	add	r3, r3, #262144	; 0x40000
+a0303ccc:	e50b3020 	str	r3, [fp, -#32]
+a0303cd0:	eaffffe9 	b	a0303c7c <zImage_load_kernel+0x54>
+a0303cd4:	e51b2010 	ldr	r2, [fp, -#16]
+a0303cd8:	e51b3020 	ldr	r3, [fp, -#32]
+a0303cdc:	e0820003 	add	r0, r2, r3
+a0303ce0:	e51b3014 	ldr	r3, [fp, -#20]
+a0303ce4:	e5932008 	ldr	r2, [r3, #8]
+a0303ce8:	e51b3020 	ldr	r3, [fp, -#32]
+a0303cec:	e0821003 	add	r1, r2, r3
+a0303cf0:	e51b201c 	ldr	r2, [fp, -#28]
+a0303cf4:	e51b3020 	ldr	r3, [fp, -#32]
+a0303cf8:	e0633002 	rsb	r3, r3, r2
+a0303cfc:	e1a02003 	mov	r2, r3
+a0303d00:	eb0016b0 	bl	a03097c8 <memcpy>
+a0303d04:	e51b301c 	ldr	r3, [fp, -#28]
+a0303d08:	e1a00003 	mov	r0, r3
+a0303d0c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0303d10 <get_status>:
+a0303d10:	e1a0c00d 	mov	ip, sp
+a0303d14:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303d18:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303d1c:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0303d20:	e50b0010 	str	r0, [fp, -#16]
+a0303d24:	eb001e77 	bl	a030b708 <timer_read>
+a0303d28:	e1a03000 	mov	r3, r0
+a0303d2c:	e50b3014 	str	r3, [fp, -#20]
+a0303d30:	eb001eb1 	bl	a030b7fc <timer_tps>
+a0303d34:	e1a02000 	mov	r2, r0
+a0303d38:	e1a03002 	mov	r3, r2
+a0303d3c:	e1a03103 	mov	r3, r3, lsl #2
+a0303d40:	e0833002 	add	r3, r3, r2
+a0303d44:	e1a02103 	mov	r2, r3, lsl #2
+a0303d48:	e51b3014 	ldr	r3, [fp, -#20]
+a0303d4c:	e0833002 	add	r3, r3, r2
+a0303d50:	e50b3018 	str	r3, [fp, -#24]
+a0303d54:	e51b3010 	ldr	r3, [fp, -#16]
+a0303d58:	e1d330b0 	ldrh	r3, [r3]
+a0303d5c:	e14b31ba 	strh	r3, [fp, -#26]
+a0303d60:	e15b31ba 	ldrh	r3, [fp, -#26]
+a0303d64:	e2033080 	and	r3, r3, #128	; 0x80
+a0303d68:	e1a03803 	mov	r3, r3, lsl #16
+a0303d6c:	e1a03823 	mov	r3, r3, lsr #16
+a0303d70:	e3530000 	cmp	r3, #0	; 0x0
+a0303d74:	0a000002 	beq	a0303d84 <get_status+0x74>
+a0303d78:	e15b31ba 	ldrh	r3, [fp, -#26]
+a0303d7c:	e50b3020 	str	r3, [fp, -#32]
+a0303d80:	ea000006 	b	a0303da0 <get_status+0x90>
+a0303d84:	eb001e5f 	bl	a030b708 <timer_read>
+a0303d88:	e1a02000 	mov	r2, r0
+a0303d8c:	e51b3018 	ldr	r3, [fp, -#24]
+a0303d90:	e1520003 	cmp	r2, r3
+a0303d94:	3affffee 	bcc	a0303d54 <get_status+0x44>
+a0303d98:	e3e03000 	mvn	r3, #0	; 0x0
+a0303d9c:	e50b3020 	str	r3, [fp, -#32]
+a0303da0:	e51b0020 	ldr	r0, [fp, -#32]
+a0303da4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0303da8 <clear_status>:
+a0303da8:	e1a0c00d 	mov	ip, sp
+a0303dac:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303db0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303db4:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0303db8:	e50b0010 	str	r0, [fp, -#16]
+a0303dbc:	e51b3010 	ldr	r3, [fp, -#16]
+a0303dc0:	e3a02050 	mov	r2, #80	; 0x50
+a0303dc4:	e1c320b0 	strh	r2, [r3]
+a0303dc8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0303dcc <print_flash_error>:
+a0303dcc:	e1a0c00d 	mov	ip, sp
+a0303dd0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303dd4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303dd8:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0303ddc:	e50b0010 	str	r0, [fp, -#16]
+a0303de0:	e50b1014 	str	r1, [fp, -#20]
+a0303de4:	e50b2018 	str	r2, [fp, -#24]
+a0303de8:	e3a0000a 	mov	r0, #10	; 0xa
+a0303dec:	eb001b91 	bl	a030ac38 <serial_write>
+a0303df0:	e51b0010 	ldr	r0, [fp, -#16]
+a0303df4:	eb001bde 	bl	a030ad74 <SerialOutputString>
+a0303df8:	e59f0104 	ldr	r0, [pc, #260]	; a0303f04 <print_flash_error+0x138>
+a0303dfc:	eb001bdc 	bl	a030ad74 <SerialOutputString>
+a0303e00:	e51b0014 	ldr	r0, [fp, -#20]
+a0303e04:	eb001bee 	bl	a030adc4 <SerialOutputHex>
+a0303e08:	e3a0000a 	mov	r0, #10	; 0xa
+a0303e0c:	eb001b89 	bl	a030ac38 <serial_write>
+a0303e10:	e59f00f0 	ldr	r0, [pc, #240]	; a0303f08 <print_flash_error+0x13c>
+a0303e14:	eb001bd6 	bl	a030ad74 <SerialOutputString>
+a0303e18:	e51b0018 	ldr	r0, [fp, -#24]
+a0303e1c:	eb001be8 	bl	a030adc4 <SerialOutputHex>
+a0303e20:	e3a0000a 	mov	r0, #10	; 0xa
+a0303e24:	eb001b83 	bl	a030ac38 <serial_write>
+a0303e28:	e51b3018 	ldr	r3, [fp, -#24]
+a0303e2c:	e3530000 	cmp	r3, #0	; 0x0
+a0303e30:	aa000002 	bge	a0303e40 <print_flash_error+0x74>
+a0303e34:	e59f00d0 	ldr	r0, [pc, #208]	; a0303f0c <print_flash_error+0x140>
+a0303e38:	eb001bcd 	bl	a030ad74 <SerialOutputString>
+a0303e3c:	ea00002d 	b	a0303ef8 <print_flash_error+0x12c>
+a0303e40:	e59f00c8 	ldr	r0, [pc, #200]	; a0303f10 <print_flash_error+0x144>
+a0303e44:	eb001bca 	bl	a030ad74 <SerialOutputString>
+a0303e48:	e51b3018 	ldr	r3, [fp, -#24]
+a0303e4c:	e2033080 	and	r3, r3, #128	; 0x80
+a0303e50:	e3530000 	cmp	r3, #0	; 0x0
+a0303e54:	0a000001 	beq	a0303e60 <print_flash_error+0x94>
+a0303e58:	e59f00b4 	ldr	r0, [pc, #180]	; a0303f14 <print_flash_error+0x148>
+a0303e5c:	eb001bc4 	bl	a030ad74 <SerialOutputString>
+a0303e60:	e51b3018 	ldr	r3, [fp, -#24]
+a0303e64:	e2033040 	and	r3, r3, #64	; 0x40
+a0303e68:	e3530000 	cmp	r3, #0	; 0x0
+a0303e6c:	0a000001 	beq	a0303e78 <print_flash_error+0xac>
+a0303e70:	e59f00a0 	ldr	r0, [pc, #160]	; a0303f18 <print_flash_error+0x14c>
+a0303e74:	eb001bbe 	bl	a030ad74 <SerialOutputString>
+a0303e78:	e51b3018 	ldr	r3, [fp, -#24]
+a0303e7c:	e2033020 	and	r3, r3, #32	; 0x20
+a0303e80:	e3530000 	cmp	r3, #0	; 0x0
+a0303e84:	0a000001 	beq	a0303e90 <print_flash_error+0xc4>
+a0303e88:	e59f008c 	ldr	r0, [pc, #140]	; a0303f1c <print_flash_error+0x150>
+a0303e8c:	eb001bb8 	bl	a030ad74 <SerialOutputString>
+a0303e90:	e51b3018 	ldr	r3, [fp, -#24]
+a0303e94:	e2033010 	and	r3, r3, #16	; 0x10
+a0303e98:	e3530000 	cmp	r3, #0	; 0x0
+a0303e9c:	0a000001 	beq	a0303ea8 <print_flash_error+0xdc>
+a0303ea0:	e59f0078 	ldr	r0, [pc, #120]	; a0303f20 <print_flash_error+0x154>
+a0303ea4:	eb001bb2 	bl	a030ad74 <SerialOutputString>
+a0303ea8:	e51b3018 	ldr	r3, [fp, -#24]
+a0303eac:	e2033008 	and	r3, r3, #8	; 0x8
+a0303eb0:	e3530000 	cmp	r3, #0	; 0x0
+a0303eb4:	0a000001 	beq	a0303ec0 <print_flash_error+0xf4>
+a0303eb8:	e59f0064 	ldr	r0, [pc, #100]	; a0303f24 <print_flash_error+0x158>
+a0303ebc:	eb001bac 	bl	a030ad74 <SerialOutputString>
+a0303ec0:	e51b3018 	ldr	r3, [fp, -#24]
+a0303ec4:	e2033004 	and	r3, r3, #4	; 0x4
+a0303ec8:	e3530000 	cmp	r3, #0	; 0x0
+a0303ecc:	0a000001 	beq	a0303ed8 <print_flash_error+0x10c>
+a0303ed0:	e59f0050 	ldr	r0, [pc, #80]	; a0303f28 <print_flash_error+0x15c>
+a0303ed4:	eb001ba6 	bl	a030ad74 <SerialOutputString>
+a0303ed8:	e51b3018 	ldr	r3, [fp, -#24]
+a0303edc:	e2033002 	and	r3, r3, #2	; 0x2
+a0303ee0:	e3530000 	cmp	r3, #0	; 0x0
+a0303ee4:	0a000001 	beq	a0303ef0 <print_flash_error+0x124>
+a0303ee8:	e59f003c 	ldr	r0, [pc, #60]	; a0303f2c <print_flash_error+0x160>
+a0303eec:	eb001ba0 	bl	a030ad74 <SerialOutputString>
+a0303ef0:	e3a0007d 	mov	r0, #125	; 0x7d
+a0303ef4:	eb001b4f 	bl	a030ac38 <serial_write>
+a0303ef8:	e59f0030 	ldr	r0, [pc, #48]	; a0303f30 <print_flash_error+0x164>
+a0303efc:	eb001b9c 	bl	a030ad74 <SerialOutputString>
+a0303f00:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303f04:	a030cb30 	eorges	ip, r0, r0, lsr fp
+a0303f08:	a030cb48 	eorges	ip, r0, r8, asr #22
+a0303f0c:	a030cb58 	eorges	ip, r0, r8, asr fp
+a0303f10:	a030cb78 	eorges	ip, r0, r8, ror fp
+a0303f14:	a030cb80 	eorges	ip, r0, r0, lsl #23
+a0303f18:	a030cb90 	mlages	r0, r0, fp, ip
+a0303f1c:	a030cba4 	eorges	ip, r0, r4, lsr #23
+a0303f20:	a030cbb8 	ldrgeh	ip, [r0], -r8
+a0303f24:	a030cbc8 	eorges	ip, r0, r8, asr #23
+a0303f28:	a030cbdc 	ldrgesb	ip, [r0], -ip
+a0303f2c:	a030cbf0 	ldrgesh	ip, [r0], -r0
+a0303f30:	a030cc04 	eorges	ip, r0, r4, lsl #24
+
+a0303f34 <do_erase>:
+a0303f34:	e1a0c00d 	mov	ip, sp
+a0303f38:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303f3c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303f40:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0303f44:	e50b0010 	str	r0, [fp, -#16]
+a0303f48:	e51b0010 	ldr	r0, [fp, -#16]
+a0303f4c:	ebffff95 	bl	a0303da8 <clear_status>
+a0303f50:	e51b2010 	ldr	r2, [fp, -#16]
+a0303f54:	e3a03020 	mov	r3, #32	; 0x20
+a0303f58:	e1c230b0 	strh	r3, [r2]
+a0303f5c:	e51b2010 	ldr	r2, [fp, -#16]
+a0303f60:	e3a030d0 	mov	r3, #208	; 0xd0
+a0303f64:	e1c230b0 	strh	r3, [r2]
+a0303f68:	e51b0010 	ldr	r0, [fp, -#16]
+a0303f6c:	ebffff67 	bl	a0303d10 <get_status>
+a0303f70:	e1a03000 	mov	r3, r0
+a0303f74:	e50b3014 	str	r3, [fp, -#20]
+a0303f78:	e51b2010 	ldr	r2, [fp, -#16]
+a0303f7c:	e3a030ff 	mov	r3, #255	; 0xff
+a0303f80:	e1c230b0 	strh	r3, [r2]
+a0303f84:	e51b3014 	ldr	r3, [fp, -#20]
+a0303f88:	e3530000 	cmp	r3, #0	; 0x0
+a0303f8c:	ba000004 	blt	a0303fa4 <do_erase+0x70>
+a0303f90:	e51b3014 	ldr	r3, [fp, -#20]
+a0303f94:	e203302a 	and	r3, r3, #42	; 0x2a
+a0303f98:	e3530000 	cmp	r3, #0	; 0x0
+a0303f9c:	1a000000 	bne	a0303fa4 <do_erase+0x70>
+a0303fa0:	ea000006 	b	a0303fc0 <do_erase+0x8c>
+a0303fa4:	e59f0024 	ldr	r0, [pc, #36]	; a0303fd0 <do_erase+0x9c>
+a0303fa8:	e51b1010 	ldr	r1, [fp, -#16]
+a0303fac:	e51b2014 	ldr	r2, [fp, -#20]
+a0303fb0:	ebffff85 	bl	a0303dcc <print_flash_error>
+a0303fb4:	e3e0300b 	mvn	r3, #11	; 0xb
+a0303fb8:	e50b3018 	str	r3, [fp, -#24]
+a0303fbc:	ea000001 	b	a0303fc8 <do_erase+0x94>
+a0303fc0:	e3a03000 	mov	r3, #0	; 0x0
+a0303fc4:	e50b3018 	str	r3, [fp, -#24]
+a0303fc8:	e51b0018 	ldr	r0, [fp, -#24]
+a0303fcc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0303fd0:	a030cc08 	eorges	ip, r0, r8, lsl #24
+
+a0303fd4 <do_write>:
+a0303fd4:	e1a0c00d 	mov	ip, sp
+a0303fd8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0303fdc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0303fe0:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0303fe4:	e50b0010 	str	r0, [fp, -#16]
+a0303fe8:	e50b1014 	str	r1, [fp, -#20]
+a0303fec:	e51b0010 	ldr	r0, [fp, -#16]
+a0303ff0:	ebffff6c 	bl	a0303da8 <clear_status>
+a0303ff4:	e51b2010 	ldr	r2, [fp, -#16]
+a0303ff8:	e3a03040 	mov	r3, #64	; 0x40
+a0303ffc:	e1c230b0 	strh	r3, [r2]
+a0304000:	e51b2010 	ldr	r2, [fp, -#16]
+a0304004:	e51b3014 	ldr	r3, [fp, -#20]
+a0304008:	e1d330b0 	ldrh	r3, [r3]
+a030400c:	e1c230b0 	strh	r3, [r2]
+a0304010:	e51b0010 	ldr	r0, [fp, -#16]
+a0304014:	ebffff3d 	bl	a0303d10 <get_status>
+a0304018:	e1a03000 	mov	r3, r0
+a030401c:	e50b3018 	str	r3, [fp, -#24]
+a0304020:	e51b2010 	ldr	r2, [fp, -#16]
+a0304024:	e3a030ff 	mov	r3, #255	; 0xff
+a0304028:	e1c230b0 	strh	r3, [r2]
+a030402c:	e51b3018 	ldr	r3, [fp, -#24]
+a0304030:	e3530000 	cmp	r3, #0	; 0x0
+a0304034:	ba00000a 	blt	a0304064 <do_write+0x90>
+a0304038:	e51b3018 	ldr	r3, [fp, -#24]
+a030403c:	e203301a 	and	r3, r3, #26	; 0x1a
+a0304040:	e3530000 	cmp	r3, #0	; 0x0
+a0304044:	1a000006 	bne	a0304064 <do_write+0x90>
+a0304048:	e51b3010 	ldr	r3, [fp, -#16]
+a030404c:	e51b2014 	ldr	r2, [fp, -#20]
+a0304050:	e1d310b0 	ldrh	r1, [r3]
+a0304054:	e1d230b0 	ldrh	r3, [r2]
+a0304058:	e1510003 	cmp	r1, r3
+a030405c:	1a000000 	bne	a0304064 <do_write+0x90>
+a0304060:	ea000002 	b	a0304070 <do_write+0x9c>
+a0304064:	e3e0300c 	mvn	r3, #12	; 0xc
+a0304068:	e50b301c 	str	r3, [fp, -#28]
+a030406c:	ea000001 	b	a0304078 <do_write+0xa4>
+a0304070:	e3a03000 	mov	r3, #0	; 0x0
+a0304074:	e50b301c 	str	r3, [fp, -#28]
+a0304078:	e51b001c 	ldr	r0, [fp, -#28]
+a030407c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0304080 <flash_erase_intel16>:
+a0304080:	e1a0c00d 	mov	ip, sp
+a0304084:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304088:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030408c:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0304090:	e50b0010 	str	r0, [fp, -#16]
+a0304094:	e51b3010 	ldr	r3, [fp, -#16]
+a0304098:	e50b3018 	str	r3, [fp, -#24]
+a030409c:	e51b0018 	ldr	r0, [fp, -#24]
+a03040a0:	ebffffa3 	bl	a0303f34 <do_erase>
+a03040a4:	e1a03000 	mov	r3, r0
+a03040a8:	e50b3014 	str	r3, [fp, -#20]
+a03040ac:	e51b3014 	ldr	r3, [fp, -#20]
+a03040b0:	e3530000 	cmp	r3, #0	; 0x0
+a03040b4:	0a000002 	beq	a03040c4 <flash_erase_intel16+0x44>
+a03040b8:	e51b3014 	ldr	r3, [fp, -#20]
+a03040bc:	e50b301c 	str	r3, [fp, -#28]
+a03040c0:	ea000014 	b	a0304118 <flash_erase_intel16+0x98>
+a03040c4:	e51b3018 	ldr	r3, [fp, -#24]
+a03040c8:	e2833002 	add	r3, r3, #2	; 0x2
+a03040cc:	e50b3018 	str	r3, [fp, -#24]
+a03040d0:	e51b3018 	ldr	r3, [fp, -#24]
+a03040d4:	e1d320b0 	ldrh	r2, [r3]
+a03040d8:	e3a03cff 	mov	r3, #65280	; 0xff00
+a03040dc:	e28330ff 	add	r3, r3, #255	; 0xff
+a03040e0:	e1520003 	cmp	r2, r3
+a03040e4:	0a000003 	beq	a03040f8 <flash_erase_intel16+0x78>
+a03040e8:	e51b0018 	ldr	r0, [fp, -#24]
+a03040ec:	ebffff90 	bl	a0303f34 <do_erase>
+a03040f0:	e1a03000 	mov	r3, r0
+a03040f4:	e50b3014 	str	r3, [fp, -#20]
+a03040f8:	e51b3014 	ldr	r3, [fp, -#20]
+a03040fc:	e3530000 	cmp	r3, #0	; 0x0
+a0304100:	0a000002 	beq	a0304110 <flash_erase_intel16+0x90>
+a0304104:	e51b3014 	ldr	r3, [fp, -#20]
+a0304108:	e50b301c 	str	r3, [fp, -#28]
+a030410c:	ea000001 	b	a0304118 <flash_erase_intel16+0x98>
+a0304110:	e3a03000 	mov	r3, #0	; 0x0
+a0304114:	e50b301c 	str	r3, [fp, -#28]
+a0304118:	e51b001c 	ldr	r0, [fp, -#28]
+a030411c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0304120 <flash_write_intel16>:
+a0304120:	e1a0c00d 	mov	ip, sp
+a0304124:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304128:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030412c:	e24dd018 	sub	sp, sp, #24	; 0x18
+a0304130:	e50b0010 	str	r0, [fp, -#16]
+a0304134:	e50b1014 	str	r1, [fp, -#20]
+a0304138:	e51b3010 	ldr	r3, [fp, -#16]
+a030413c:	e50b3018 	str	r3, [fp, -#24]
+a0304140:	e51b3014 	ldr	r3, [fp, -#20]
+a0304144:	e50b301c 	str	r3, [fp, -#28]
+a0304148:	e51b0018 	ldr	r0, [fp, -#24]
+a030414c:	e51b101c 	ldr	r1, [fp, -#28]
+a0304150:	ebffff9f 	bl	a0303fd4 <do_write>
+a0304154:	e1a03000 	mov	r3, r0
+a0304158:	e50b3020 	str	r3, [fp, -#32]
+a030415c:	e51b3020 	ldr	r3, [fp, -#32]
+a0304160:	e3530000 	cmp	r3, #0	; 0x0
+a0304164:	0a000002 	beq	a0304174 <flash_write_intel16+0x54>
+a0304168:	e51b3020 	ldr	r3, [fp, -#32]
+a030416c:	e50b3024 	str	r3, [fp, -#36]
+a0304170:	ea000012 	b	a03041c0 <flash_write_intel16+0xa0>
+a0304174:	e51b3018 	ldr	r3, [fp, -#24]
+a0304178:	e2833002 	add	r3, r3, #2	; 0x2
+a030417c:	e50b3018 	str	r3, [fp, -#24]
+a0304180:	e51b301c 	ldr	r3, [fp, -#28]
+a0304184:	e2833002 	add	r3, r3, #2	; 0x2
+a0304188:	e50b301c 	str	r3, [fp, -#28]
+a030418c:	e51b0018 	ldr	r0, [fp, -#24]
+a0304190:	e51b101c 	ldr	r1, [fp, -#28]
+a0304194:	ebffff8e 	bl	a0303fd4 <do_write>
+a0304198:	e1a03000 	mov	r3, r0
+a030419c:	e50b3020 	str	r3, [fp, -#32]
+a03041a0:	e51b3020 	ldr	r3, [fp, -#32]
+a03041a4:	e3530000 	cmp	r3, #0	; 0x0
+a03041a8:	0a000002 	beq	a03041b8 <flash_write_intel16+0x98>
+a03041ac:	e51b3020 	ldr	r3, [fp, -#32]
+a03041b0:	e50b3024 	str	r3, [fp, -#36]
+a03041b4:	ea000001 	b	a03041c0 <flash_write_intel16+0xa0>
+a03041b8:	e3a03000 	mov	r3, #0	; 0x0
+a03041bc:	e50b3024 	str	r3, [fp, -#36]
+a03041c0:	e51b0024 	ldr	r0, [fp, -#36]
+a03041c4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03041c8 <flash_lock_block_intel16>:
+a03041c8:	e1a0c00d 	mov	ip, sp
+a03041cc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03041d0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03041d4:	e24dd010 	sub	sp, sp, #16	; 0x10
+a03041d8:	e50b0010 	str	r0, [fp, -#16]
+a03041dc:	e51b3010 	ldr	r3, [fp, -#16]
+a03041e0:	e50b3014 	str	r3, [fp, -#20]
+a03041e4:	e51b0014 	ldr	r0, [fp, -#20]
+a03041e8:	ebfffeee 	bl	a0303da8 <clear_status>
+a03041ec:	e51b2014 	ldr	r2, [fp, -#20]
+a03041f0:	e3a03060 	mov	r3, #96	; 0x60
+a03041f4:	e1c230b0 	strh	r3, [r2]
+a03041f8:	e51b2014 	ldr	r2, [fp, -#20]
+a03041fc:	e3a03001 	mov	r3, #1	; 0x1
+a0304200:	e1c230b0 	strh	r3, [r2]
+a0304204:	e51b0014 	ldr	r0, [fp, -#20]
+a0304208:	ebfffec0 	bl	a0303d10 <get_status>
+a030420c:	e1a03000 	mov	r3, r0
+a0304210:	e50b3018 	str	r3, [fp, -#24]
+a0304214:	e51b2014 	ldr	r2, [fp, -#20]
+a0304218:	e3a030ff 	mov	r3, #255	; 0xff
+a030421c:	e1c230b0 	strh	r3, [r2]
+a0304220:	e51b3018 	ldr	r3, [fp, -#24]
+a0304224:	e3530000 	cmp	r3, #0	; 0x0
+a0304228:	ba000004 	blt	a0304240 <flash_lock_block_intel16+0x78>
+a030422c:	e51b3018 	ldr	r3, [fp, -#24]
+a0304230:	e203301a 	and	r3, r3, #26	; 0x1a
+a0304234:	e3530000 	cmp	r3, #0	; 0x0
+a0304238:	1a000000 	bne	a0304240 <flash_lock_block_intel16+0x78>
+a030423c:	ea000006 	b	a030425c <flash_lock_block_intel16+0x94>
+a0304240:	e59f0024 	ldr	r0, [pc, #36]	; a030426c <flash_lock_block_intel16+0xa4>
+a0304244:	e51b1014 	ldr	r1, [fp, -#20]
+a0304248:	e51b2018 	ldr	r2, [fp, -#24]
+a030424c:	ebfffede 	bl	a0303dcc <print_flash_error>
+a0304250:	e51b3018 	ldr	r3, [fp, -#24]
+a0304254:	e50b301c 	str	r3, [fp, -#28]
+a0304258:	ea000001 	b	a0304264 <flash_lock_block_intel16+0x9c>
+a030425c:	e3a03000 	mov	r3, #0	; 0x0
+a0304260:	e50b301c 	str	r3, [fp, -#28]
+a0304264:	e51b001c 	ldr	r0, [fp, -#28]
+a0304268:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030426c:	a030cc14 	eorges	ip, r0, r4, lsl ip
+
+a0304270 <flash_unlock_block_intel16>:
+a0304270:	e1a0c00d 	mov	ip, sp
+a0304274:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304278:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030427c:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0304280:	e50b0010 	str	r0, [fp, -#16]
+a0304284:	e51b3010 	ldr	r3, [fp, -#16]
+a0304288:	e50b3014 	str	r3, [fp, -#20]
+a030428c:	e51b0014 	ldr	r0, [fp, -#20]
+a0304290:	ebfffec4 	bl	a0303da8 <clear_status>
+a0304294:	e51b2014 	ldr	r2, [fp, -#20]
+a0304298:	e3a03060 	mov	r3, #96	; 0x60
+a030429c:	e1c230b0 	strh	r3, [r2]
+a03042a0:	e51b2014 	ldr	r2, [fp, -#20]
+a03042a4:	e3a030d0 	mov	r3, #208	; 0xd0
+a03042a8:	e1c230b0 	strh	r3, [r2]
+a03042ac:	e51b0014 	ldr	r0, [fp, -#20]
+a03042b0:	ebfffe96 	bl	a0303d10 <get_status>
+a03042b4:	e1a03000 	mov	r3, r0
+a03042b8:	e50b3018 	str	r3, [fp, -#24]
+a03042bc:	e51b2014 	ldr	r2, [fp, -#20]
+a03042c0:	e3a030ff 	mov	r3, #255	; 0xff
+a03042c4:	e1c230b0 	strh	r3, [r2]
+a03042c8:	e51b3018 	ldr	r3, [fp, -#24]
+a03042cc:	e3530000 	cmp	r3, #0	; 0x0
+a03042d0:	ba000004 	blt	a03042e8 <flash_unlock_block_intel16+0x78>
+a03042d4:	e51b3018 	ldr	r3, [fp, -#24]
+a03042d8:	e203303a 	and	r3, r3, #58	; 0x3a
+a03042dc:	e3530000 	cmp	r3, #0	; 0x0
+a03042e0:	1a000000 	bne	a03042e8 <flash_unlock_block_intel16+0x78>
+a03042e4:	ea000006 	b	a0304304 <flash_unlock_block_intel16+0x94>
+a03042e8:	e59f0024 	ldr	r0, [pc, #36]	; a0304314 <flash_unlock_block_intel16+0xa4>
+a03042ec:	e51b1014 	ldr	r1, [fp, -#20]
+a03042f0:	e51b2018 	ldr	r2, [fp, -#24]
+a03042f4:	ebfffeb4 	bl	a0303dcc <print_flash_error>
+a03042f8:	e51b3018 	ldr	r3, [fp, -#24]
+a03042fc:	e50b301c 	str	r3, [fp, -#28]
+a0304300:	ea000001 	b	a030430c <flash_unlock_block_intel16+0x9c>
+a0304304:	e3a03000 	mov	r3, #0	; 0x0
+a0304308:	e50b301c 	str	r3, [fp, -#28]
+a030430c:	e51b001c 	ldr	r0, [fp, -#28]
+a0304310:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0304314:	a030cc30 	eorges	ip, r0, r0, lsr ip
+
+a0304318 <flash_query_block_lock_intel16>:
+a0304318:	e1a0c00d 	mov	ip, sp
+a030431c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304320:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0304324:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0304328:	e50b0010 	str	r0, [fp, -#16]
+a030432c:	e51b3010 	ldr	r3, [fp, -#16]
+a0304330:	e50b3014 	str	r3, [fp, -#20]
+a0304334:	e51b0014 	ldr	r0, [fp, -#20]
+a0304338:	ebfffe9a 	bl	a0303da8 <clear_status>
+a030433c:	e51b2014 	ldr	r2, [fp, -#20]
+a0304340:	e3a03090 	mov	r3, #144	; 0x90
+a0304344:	e1c230b0 	strh	r3, [r2]
+a0304348:	e3a02004 	mov	r2, #4	; 0x4
+a030434c:	e51b3014 	ldr	r3, [fp, -#20]
+a0304350:	e0823003 	add	r3, r2, r3
+a0304354:	e1d330b0 	ldrh	r3, [r3]
+a0304358:	e14b31b6 	strh	r3, [fp, -#22]
+a030435c:	e51b2014 	ldr	r2, [fp, -#20]
+a0304360:	e3a030ff 	mov	r3, #255	; 0xff
+a0304364:	e1c230b0 	strh	r3, [r2]
+a0304368:	e15b31b6 	ldrh	r3, [fp, -#22]
+a030436c:	e2033003 	and	r3, r3, #3	; 0x3
+a0304370:	e1a03803 	mov	r3, r3, lsl #16
+a0304374:	e1a03823 	mov	r3, r3, lsr #16
+a0304378:	e3530000 	cmp	r3, #0	; 0x0
+a030437c:	03a03000 	moveq	r3, #0	; 0x0
+a0304380:	13a03001 	movne	r3, #1	; 0x1
+a0304384:	e1a00003 	mov	r0, r3
+a0304388:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030438c <flash_query_descriptors_intel16>:
+a030438c:	e1a0c00d 	mov	ip, sp
+a0304390:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304394:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0304398:	e24dd02c 	sub	sp, sp, #44	; 0x2c
+a030439c:	e50b0010 	str	r0, [fp, -#16]
+a03043a0:	e50b1014 	str	r1, [fp, -#20]
+a03043a4:	e51b3010 	ldr	r3, [fp, -#16]
+a03043a8:	e50b3018 	str	r3, [fp, -#24]
+a03043ac:	e3a020aa 	mov	r2, #170	; 0xaa
+a03043b0:	e51b3018 	ldr	r3, [fp, -#24]
+a03043b4:	e0822003 	add	r2, r2, r3
+a03043b8:	e3a03098 	mov	r3, #152	; 0x98
+a03043bc:	e1c230b0 	strh	r3, [r2]
+a03043c0:	e3a02020 	mov	r2, #32	; 0x20
+a03043c4:	e51b3018 	ldr	r3, [fp, -#24]
+a03043c8:	e0823003 	add	r3, r2, r3
+a03043cc:	e1d330b0 	ldrh	r3, [r3]
+a03043d0:	e3530051 	cmp	r3, #81	; 0x51
+a03043d4:	0a00000e 	beq	a0304414 <flash_query_descriptors_intel16+0x88>
+a03043d8:	e3a02022 	mov	r2, #34	; 0x22
+a03043dc:	e51b3018 	ldr	r3, [fp, -#24]
+a03043e0:	e0823003 	add	r3, r2, r3
+a03043e4:	e1d330b0 	ldrh	r3, [r3]
+a03043e8:	e3530052 	cmp	r3, #82	; 0x52
+a03043ec:	0a000008 	beq	a0304414 <flash_query_descriptors_intel16+0x88>
+a03043f0:	e3a02024 	mov	r2, #36	; 0x24
+a03043f4:	e51b3018 	ldr	r3, [fp, -#24]
+a03043f8:	e0823003 	add	r3, r2, r3
+a03043fc:	e1d330b0 	ldrh	r3, [r3]
+a0304400:	e3530059 	cmp	r3, #89	; 0x59
+a0304404:	0a000002 	beq	a0304414 <flash_query_descriptors_intel16+0x88>
+a0304408:	e3e03000 	mvn	r3, #0	; 0x0
+a030440c:	e50b301c 	str	r3, [fp, -#28]
+a0304410:	ea00007a 	b	a0304600 <flash_query_descriptors_intel16+0x274>
+a0304414:	e3a02058 	mov	r2, #88	; 0x58
+a0304418:	e51b3018 	ldr	r3, [fp, -#24]
+a030441c:	e0823003 	add	r3, r2, r3
+a0304420:	e1d330b0 	ldrh	r3, [r3]
+a0304424:	e50b3020 	str	r3, [fp, -#32]
+a0304428:	e3a03000 	mov	r3, #0	; 0x0
+a030442c:	e50b3024 	str	r3, [fp, -#36]
+a0304430:	e51b2024 	ldr	r2, [fp, -#36]
+a0304434:	e51b3020 	ldr	r3, [fp, -#32]
+a0304438:	e1520003 	cmp	r2, r3
+a030443c:	aa000056 	bge	a030459c <flash_query_descriptors_intel16+0x210>
+a0304440:	e51b3024 	ldr	r3, [fp, -#36]
+a0304444:	e3530003 	cmp	r3, #3	; 0x3
+a0304448:	da000000 	ble	a0304450 <flash_query_descriptors_intel16+0xc4>
+a030444c:	ea000052 	b	a030459c <flash_query_descriptors_intel16+0x210>
+a0304450:	e51b3024 	ldr	r3, [fp, -#36]
+a0304454:	e3a0105a 	mov	r1, #90	; 0x5a
+a0304458:	e1a02183 	mov	r2, r3, lsl #3
+a030445c:	e51b3018 	ldr	r3, [fp, -#24]
+a0304460:	e0823003 	add	r3, r2, r3
+a0304464:	e0833001 	add	r3, r3, r1
+a0304468:	e1d300b0 	ldrh	r0, [r3]
+a030446c:	e51b3024 	ldr	r3, [fp, -#36]
+a0304470:	e3a0105c 	mov	r1, #92	; 0x5c
+a0304474:	e1a02183 	mov	r2, r3, lsl #3
+a0304478:	e51b3018 	ldr	r3, [fp, -#24]
+a030447c:	e0823003 	add	r3, r2, r3
+a0304480:	e0833001 	add	r3, r3, r1
+a0304484:	e1d330b0 	ldrh	r3, [r3]
+a0304488:	e1a03403 	mov	r3, r3, lsl #8
+a030448c:	e1803003 	orr	r3, r0, r3
+a0304490:	e50b3028 	str	r3, [fp, -#40]
+a0304494:	e51b3028 	ldr	r3, [fp, -#40]
+a0304498:	e2833001 	add	r3, r3, #1	; 0x1
+a030449c:	e50b302c 	str	r3, [fp, -#44]
+a03044a0:	e51b3024 	ldr	r3, [fp, -#36]
+a03044a4:	e3a0105e 	mov	r1, #94	; 0x5e
+a03044a8:	e1a02183 	mov	r2, r3, lsl #3
+a03044ac:	e51b3018 	ldr	r3, [fp, -#24]
+a03044b0:	e0823003 	add	r3, r2, r3
+a03044b4:	e0833001 	add	r3, r3, r1
+a03044b8:	e1d300b0 	ldrh	r0, [r3]
+a03044bc:	e51b3024 	ldr	r3, [fp, -#36]
+a03044c0:	e3a01060 	mov	r1, #96	; 0x60
+a03044c4:	e1a02183 	mov	r2, r3, lsl #3
+a03044c8:	e51b3018 	ldr	r3, [fp, -#24]
+a03044cc:	e0823003 	add	r3, r2, r3
+a03044d0:	e0833001 	add	r3, r3, r1
+a03044d4:	e1d330b0 	ldrh	r3, [r3]
+a03044d8:	e1a03403 	mov	r3, r3, lsl #8
+a03044dc:	e1803003 	orr	r3, r0, r3
+a03044e0:	e50b3030 	str	r3, [fp, -#48]
+a03044e4:	e51b3030 	ldr	r3, [fp, -#48]
+a03044e8:	e3530000 	cmp	r3, #0	; 0x0
+a03044ec:	0a000003 	beq	a0304500 <flash_query_descriptors_intel16+0x174>
+a03044f0:	e51b3030 	ldr	r3, [fp, -#48]
+a03044f4:	e1a03403 	mov	r3, r3, lsl #8
+a03044f8:	e50b3038 	str	r3, [fp, -#56]
+a03044fc:	ea000001 	b	a0304508 <flash_query_descriptors_intel16+0x17c>
+a0304500:	e3a03080 	mov	r3, #128	; 0x80
+a0304504:	e50b3038 	str	r3, [fp, -#56]
+a0304508:	e51b3038 	ldr	r3, [fp, -#56]
+a030450c:	e50b3034 	str	r3, [fp, -#52]
+a0304510:	e59f1100 	ldr	r1, [pc, #256]	; a0304618 <flash_query_descriptors_intel16+0x28c>
+a0304514:	e51b2024 	ldr	r2, [fp, -#36]
+a0304518:	e1a03002 	mov	r3, r2
+a030451c:	e1a03083 	mov	r3, r3, lsl #1
+a0304520:	e0833002 	add	r3, r3, r2
+a0304524:	e1a03103 	mov	r3, r3, lsl #2
+a0304528:	e0832001 	add	r2, r3, r1
+a030452c:	e51b3034 	ldr	r3, [fp, -#52]
+a0304530:	e5823000 	str	r3, [r2]
+a0304534:	e59f00dc 	ldr	r0, [pc, #220]	; a0304618 <flash_query_descriptors_intel16+0x28c>
+a0304538:	e51b2024 	ldr	r2, [fp, -#36]
+a030453c:	e3a01004 	mov	r1, #4	; 0x4
+a0304540:	e1a03002 	mov	r3, r2
+a0304544:	e1a03083 	mov	r3, r3, lsl #1
+a0304548:	e0833002 	add	r3, r3, r2
+a030454c:	e1a03103 	mov	r3, r3, lsl #2
+a0304550:	e0833000 	add	r3, r3, r0
+a0304554:	e0832001 	add	r2, r3, r1
+a0304558:	e51b302c 	ldr	r3, [fp, -#44]
+a030455c:	e5823000 	str	r3, [r2]
+a0304560:	e59f00b0 	ldr	r0, [pc, #176]	; a0304618 <flash_query_descriptors_intel16+0x28c>
+a0304564:	e51b2024 	ldr	r2, [fp, -#36]
+a0304568:	e3a01008 	mov	r1, #8	; 0x8
+a030456c:	e1a03002 	mov	r3, r2
+a0304570:	e1a03083 	mov	r3, r3, lsl #1
+a0304574:	e0833002 	add	r3, r3, r2
+a0304578:	e1a03103 	mov	r3, r3, lsl #2
+a030457c:	e0833000 	add	r3, r3, r0
+a0304580:	e0832001 	add	r2, r3, r1
+a0304584:	e3a03001 	mov	r3, #1	; 0x1
+a0304588:	e5823000 	str	r3, [r2]
+a030458c:	e51b3024 	ldr	r3, [fp, -#36]
+a0304590:	e2833001 	add	r3, r3, #1	; 0x1
+a0304594:	e50b3024 	str	r3, [fp, -#36]
+a0304598:	eaffffa4 	b	a0304430 <flash_query_descriptors_intel16+0xa4>
+a030459c:	e59f1074 	ldr	r1, [pc, #116]	; a0304618 <flash_query_descriptors_intel16+0x28c>
+a03045a0:	e51b2024 	ldr	r2, [fp, -#36]
+a03045a4:	e1a03002 	mov	r3, r2
+a03045a8:	e1a03083 	mov	r3, r3, lsl #1
+a03045ac:	e0833002 	add	r3, r3, r2
+a03045b0:	e1a03103 	mov	r3, r3, lsl #2
+a03045b4:	e0832001 	add	r2, r3, r1
+a03045b8:	e3a03000 	mov	r3, #0	; 0x0
+a03045bc:	e5823000 	str	r3, [r2]
+a03045c0:	e59f0050 	ldr	r0, [pc, #80]	; a0304618 <flash_query_descriptors_intel16+0x28c>
+a03045c4:	e51b2024 	ldr	r2, [fp, -#36]
+a03045c8:	e3a01004 	mov	r1, #4	; 0x4
+a03045cc:	e1a03002 	mov	r3, r2
+a03045d0:	e1a03083 	mov	r3, r3, lsl #1
+a03045d4:	e0833002 	add	r3, r3, r2
+a03045d8:	e1a03103 	mov	r3, r3, lsl #2
+a03045dc:	e0833000 	add	r3, r3, r0
+a03045e0:	e0832001 	add	r2, r3, r1
+a03045e4:	e3a03000 	mov	r3, #0	; 0x0
+a03045e8:	e5823000 	str	r3, [r2]
+a03045ec:	e51b2014 	ldr	r2, [fp, -#20]
+a03045f0:	e59f3020 	ldr	r3, [pc, #32]	; a0304618 <flash_query_descriptors_intel16+0x28c>
+a03045f4:	e5823000 	str	r3, [r2]
+a03045f8:	e3a03000 	mov	r3, #0	; 0x0
+a03045fc:	e50b301c 	str	r3, [fp, -#28]
+a0304600:	e51b2018 	ldr	r2, [fp, -#24]
+a0304604:	e3a030ff 	mov	r3, #255	; 0xff
+a0304608:	e1c230b0 	strh	r3, [r2]
+a030460c:	e51b301c 	ldr	r3, [fp, -#28]
+a0304610:	e1a00003 	mov	r0, r3
+a0304614:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0304618:	a030f488 	eorges	pc, r0, r8, lsl #9
+
+a030461c <mainstone_init_hardware>:
+a030461c:	e1a0c00d 	mov	ip, sp
+a0304620:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304624:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0304628:	e59f2050 	ldr	r2, [pc, #80]	; a0304680 <mainstone_init_hardware+0x64>
+a030462c:	e59f3050 	ldr	r3, [pc, #80]	; a0304684 <mainstone_init_hardware+0x68>
+a0304630:	e5823000 	str	r3, [r2]
+a0304634:	e59f204c 	ldr	r2, [pc, #76]	; a0304688 <mainstone_init_hardware+0x6c>
+a0304638:	e59f304c 	ldr	r3, [pc, #76]	; a030468c <mainstone_init_hardware+0x70>
+a030463c:	e5823000 	str	r3, [r2]
+a0304640:	e59f2048 	ldr	r2, [pc, #72]	; a0304690 <mainstone_init_hardware+0x74>
+a0304644:	e59f3048 	ldr	r3, [pc, #72]	; a0304694 <mainstone_init_hardware+0x78>
+a0304648:	e5823000 	str	r3, [r2]
+a030464c:	e59f2044 	ldr	r2, [pc, #68]	; a0304698 <mainstone_init_hardware+0x7c>
+a0304650:	e3a03000 	mov	r3, #0	; 0x0
+a0304654:	e5823000 	str	r3, [r2]
+a0304658:	e59f203c 	ldr	r2, [pc, #60]	; a030469c <mainstone_init_hardware+0x80>
+a030465c:	e59f303c 	ldr	r3, [pc, #60]	; a03046a0 <mainstone_init_hardware+0x84>
+a0304660:	e5823000 	str	r3, [r2]
+a0304664:	e59f2038 	ldr	r2, [pc, #56]	; a03046a4 <mainstone_init_hardware+0x88>
+a0304668:	e59f3038 	ldr	r3, [pc, #56]	; a03046a8 <mainstone_init_hardware+0x8c>
+a030466c:	e5823000 	str	r3, [r2]
+a0304670:	e59f2034 	ldr	r2, [pc, #52]	; a03046ac <mainstone_init_hardware+0x90>
+a0304674:	e59f3034 	ldr	r3, [pc, #52]	; a03046b0 <mainstone_init_hardware+0x94>
+a0304678:	e5823000 	str	r3, [r2]
+a030467c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0304680:	a030fce0 	eorges	pc, r0, r0, ror #25
+a0304684:	a030cc4c 	eorges	ip, r0, ip, asr #24
+a0304688:	a030fd00 	eorges	pc, r0, r0, lsl #26
+a030468c:	a030d788 	eorges	sp, r0, r8, lsl #15
+a0304690:	a0310320 	eorges	r0, r1, r0, lsr #6
+a0304694:	a030cc70 	eorges	ip, r0, r0, ror ip
+a0304698:	a0310340 	eorges	r0, r1, r0, asr #6
+a030469c:	a03103a0 	eorges	r0, r1, r0, lsr #7
+a03046a0:	a030dc84 	eorges	sp, r0, r4, lsl #25
+a03046a4:	a03103c0 	eorges	r0, r1, r0, asr #7
+a03046a8:	a030dc88 	eorges	sp, r0, r8, lsl #25
+a03046ac:	a03103e0 	eorges	r0, r1, r0, ror #7
+a03046b0:	a030dca0 	eorges	sp, r0, r0, lsr #25
+
+a03046b4 <cmd_flash_write>:
+a03046b4:	e1a0c00d 	mov	ip, sp
+a03046b8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03046bc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03046c0:	e24dd018 	sub	sp, sp, #24	; 0x18
+a03046c4:	e50b0010 	str	r0, [fp, -#16]
+a03046c8:	e50b1014 	str	r1, [fp, -#20]
+a03046cc:	e3a03000 	mov	r3, #0	; 0x0
+a03046d0:	e50b3018 	str	r3, [fp, -#24]
+a03046d4:	e3a03000 	mov	r3, #0	; 0x0
+a03046d8:	e50b301c 	str	r3, [fp, -#28]
+a03046dc:	e3a03000 	mov	r3, #0	; 0x0
+a03046e0:	e50b3020 	str	r3, [fp, -#32]
+a03046e4:	e3a03000 	mov	r3, #0	; 0x0
+a03046e8:	e50b3024 	str	r3, [fp, -#36]
+a03046ec:	e51b3010 	ldr	r3, [fp, -#16]
+a03046f0:	e3530003 	cmp	r3, #3	; 0x3
+a03046f4:	ca000002 	bgt	a0304704 <cmd_flash_write+0x50>
+a03046f8:	e3e03000 	mvn	r3, #0	; 0x0
+a03046fc:	e50b3018 	str	r3, [fp, -#24]
+a0304700:	ea000032 	b	a03047d0 <cmd_flash_write+0x11c>
+a0304704:	e3a02004 	mov	r2, #4	; 0x4
+a0304708:	e51b3014 	ldr	r3, [fp, -#20]
+a030470c:	e0823003 	add	r3, r2, r3
+a0304710:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0304714:	e5930000 	ldr	r0, [r3]
+a0304718:	e1a01002 	mov	r1, r2
+a030471c:	eb001b93 	bl	a030b570 <strtou32>
+a0304720:	e1a03000 	mov	r3, r0
+a0304724:	e50b3018 	str	r3, [fp, -#24]
+a0304728:	e51b3018 	ldr	r3, [fp, -#24]
+a030472c:	e3530000 	cmp	r3, #0	; 0x0
+a0304730:	aa000002 	bge	a0304740 <cmd_flash_write+0x8c>
+a0304734:	e3e03000 	mvn	r3, #0	; 0x0
+a0304738:	e50b3018 	str	r3, [fp, -#24]
+a030473c:	ea000023 	b	a03047d0 <cmd_flash_write+0x11c>
+a0304740:	e3a02008 	mov	r2, #8	; 0x8
+a0304744:	e51b3014 	ldr	r3, [fp, -#20]
+a0304748:	e0823003 	add	r3, r2, r3
+a030474c:	e24b2020 	sub	r2, fp, #32	; 0x20
+a0304750:	e5930000 	ldr	r0, [r3]
+a0304754:	e1a01002 	mov	r1, r2
+a0304758:	eb001b84 	bl	a030b570 <strtou32>
+a030475c:	e1a03000 	mov	r3, r0
+a0304760:	e50b3018 	str	r3, [fp, -#24]
+a0304764:	e51b3018 	ldr	r3, [fp, -#24]
+a0304768:	e3530000 	cmp	r3, #0	; 0x0
+a030476c:	aa000002 	bge	a030477c <cmd_flash_write+0xc8>
+a0304770:	e3e03000 	mvn	r3, #0	; 0x0
+a0304774:	e50b3018 	str	r3, [fp, -#24]
+a0304778:	ea000014 	b	a03047d0 <cmd_flash_write+0x11c>
+a030477c:	e3a0200c 	mov	r2, #12	; 0xc
+a0304780:	e51b3014 	ldr	r3, [fp, -#20]
+a0304784:	e0823003 	add	r3, r2, r3
+a0304788:	e24b2024 	sub	r2, fp, #36	; 0x24
+a030478c:	e5930000 	ldr	r0, [r3]
+a0304790:	e1a01002 	mov	r1, r2
+a0304794:	eb001b75 	bl	a030b570 <strtou32>
+a0304798:	e1a03000 	mov	r3, r0
+a030479c:	e50b3018 	str	r3, [fp, -#24]
+a03047a0:	e51b3018 	ldr	r3, [fp, -#24]
+a03047a4:	e3530000 	cmp	r3, #0	; 0x0
+a03047a8:	aa000002 	bge	a03047b8 <cmd_flash_write+0x104>
+a03047ac:	e3e03000 	mvn	r3, #0	; 0x0
+a03047b0:	e50b3018 	str	r3, [fp, -#24]
+a03047b4:	ea000005 	b	a03047d0 <cmd_flash_write+0x11c>
+a03047b8:	e51b0020 	ldr	r0, [fp, -#32]
+a03047bc:	e51b101c 	ldr	r1, [fp, -#28]
+a03047c0:	e51b2024 	ldr	r2, [fp, -#36]
+a03047c4:	ebfff0f0 	bl	a0300b8c <flash_write_region>
+a03047c8:	e1a03000 	mov	r3, r0
+a03047cc:	e50b3018 	str	r3, [fp, -#24]
+a03047d0:	e51b3018 	ldr	r3, [fp, -#24]
+a03047d4:	e1a00003 	mov	r0, r3
+a03047d8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03047dc <cmd_flash_erase>:
+a03047dc:	e1a0c00d 	mov	ip, sp
+a03047e0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03047e4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03047e8:	e24dd014 	sub	sp, sp, #20	; 0x14
+a03047ec:	e50b0010 	str	r0, [fp, -#16]
+a03047f0:	e50b1014 	str	r1, [fp, -#20]
+a03047f4:	e3a03000 	mov	r3, #0	; 0x0
+a03047f8:	e50b3018 	str	r3, [fp, -#24]
+a03047fc:	e3a03000 	mov	r3, #0	; 0x0
+a0304800:	e50b301c 	str	r3, [fp, -#28]
+a0304804:	e3a03000 	mov	r3, #0	; 0x0
+a0304808:	e50b3020 	str	r3, [fp, -#32]
+a030480c:	e51b3010 	ldr	r3, [fp, -#16]
+a0304810:	e3530002 	cmp	r3, #2	; 0x2
+a0304814:	ca000002 	bgt	a0304824 <cmd_flash_erase+0x48>
+a0304818:	e3e03000 	mvn	r3, #0	; 0x0
+a030481c:	e50b3018 	str	r3, [fp, -#24]
+a0304820:	ea000022 	b	a03048b0 <cmd_flash_erase+0xd4>
+a0304824:	e3a02004 	mov	r2, #4	; 0x4
+a0304828:	e51b3014 	ldr	r3, [fp, -#20]
+a030482c:	e0823003 	add	r3, r2, r3
+a0304830:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0304834:	e5930000 	ldr	r0, [r3]
+a0304838:	e1a01002 	mov	r1, r2
+a030483c:	eb001b4b 	bl	a030b570 <strtou32>
+a0304840:	e1a03000 	mov	r3, r0
+a0304844:	e50b3018 	str	r3, [fp, -#24]
+a0304848:	e51b3018 	ldr	r3, [fp, -#24]
+a030484c:	e3530000 	cmp	r3, #0	; 0x0
+a0304850:	aa000002 	bge	a0304860 <cmd_flash_erase+0x84>
+a0304854:	e3e03000 	mvn	r3, #0	; 0x0
+a0304858:	e50b3018 	str	r3, [fp, -#24]
+a030485c:	ea000013 	b	a03048b0 <cmd_flash_erase+0xd4>
+a0304860:	e3a02008 	mov	r2, #8	; 0x8
+a0304864:	e51b3014 	ldr	r3, [fp, -#20]
+a0304868:	e0823003 	add	r3, r2, r3
+a030486c:	e24b2020 	sub	r2, fp, #32	; 0x20
+a0304870:	e5930000 	ldr	r0, [r3]
+a0304874:	e1a01002 	mov	r1, r2
+a0304878:	eb001b3c 	bl	a030b570 <strtou32>
+a030487c:	e1a03000 	mov	r3, r0
+a0304880:	e50b3018 	str	r3, [fp, -#24]
+a0304884:	e51b3018 	ldr	r3, [fp, -#24]
+a0304888:	e3530000 	cmp	r3, #0	; 0x0
+a030488c:	aa000002 	bge	a030489c <cmd_flash_erase+0xc0>
+a0304890:	e3e03000 	mvn	r3, #0	; 0x0
+a0304894:	e50b3018 	str	r3, [fp, -#24]
+a0304898:	ea000004 	b	a03048b0 <cmd_flash_erase+0xd4>
+a030489c:	e51b001c 	ldr	r0, [fp, -#28]
+a03048a0:	e51b1020 	ldr	r1, [fp, -#32]
+a03048a4:	ebfff03a 	bl	a0300994 <flash_erase_region>
+a03048a8:	e1a03000 	mov	r3, r0
+a03048ac:	e50b3018 	str	r3, [fp, -#24]
+a03048b0:	e51b3018 	ldr	r3, [fp, -#24]
+a03048b4:	e1a00003 	mov	r0, r3
+a03048b8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03048bc <cmd_clock_info>:
+a03048bc:	e1a0c00d 	mov	ip, sp
+a03048c0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03048c4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03048c8:	e24dd050 	sub	sp, sp, #80	; 0x50
+a03048cc:	e50b0010 	str	r0, [fp, -#16]
+a03048d0:	e50b1014 	str	r1, [fp, -#20]
+a03048d4:	e3a03441 	mov	r3, #1090519040	; 0x41000000
+a03048d8:	e2833603 	add	r3, r3, #3145728	; 0x300000
+a03048dc:	e5933000 	ldr	r3, [r3]
+a03048e0:	e50b3018 	str	r3, [fp, -#24]
+a03048e4:	e3a03131 	mov	r3, #1073741836	; 0x4000000c
+a03048e8:	e2833613 	add	r3, r3, #19922944	; 0x1300000
+a03048ec:	e5933000 	ldr	r3, [r3]
+a03048f0:	e50b301c 	str	r3, [fp, -#28]
+a03048f4:	ee163e10 	mrc	14, 0, r3, cr6, cr0, {0}
+a03048f8:	e50b3020 	str	r3, [fp, -#32]
+a03048fc:	e51b301c 	ldr	r3, [fp, -#28]
+a0304900:	e203301f 	and	r3, r3, #31	; 0x1f
+a0304904:	e50b3024 	str	r3, [fp, -#36]
+a0304908:	e51b301c 	ldr	r3, [fp, -#28]
+a030490c:	e1a033a3 	mov	r3, r3, lsr #7
+a0304910:	e2033007 	and	r3, r3, #7	; 0x7
+a0304914:	e50b302c 	str	r3, [fp, -#44]
+a0304918:	e51b3024 	ldr	r3, [fp, -#36]
+a030491c:	e353000a 	cmp	r3, #10	; 0xa
+a0304920:	8a000002 	bhi	a0304930 <cmd_clock_info+0x74>
+a0304924:	e3a03001 	mov	r3, #1	; 0x1
+a0304928:	e50b3028 	str	r3, [fp, -#40]
+a030492c:	ea000007 	b	a0304950 <cmd_clock_info+0x94>
+a0304930:	e51b3024 	ldr	r3, [fp, -#36]
+a0304934:	e3530014 	cmp	r3, #20	; 0x14
+a0304938:	8a000002 	bhi	a0304948 <cmd_clock_info+0x8c>
+a030493c:	e3a03002 	mov	r3, #2	; 0x2
+a0304940:	e50b3028 	str	r3, [fp, -#40]
+a0304944:	ea000001 	b	a0304950 <cmd_clock_info+0x94>
+a0304948:	e3a03004 	mov	r3, #4	; 0x4
+a030494c:	e50b3028 	str	r3, [fp, -#40]
+a0304950:	e51b2024 	ldr	r2, [fp, -#36]
+a0304954:	e1a03002 	mov	r3, r2
+a0304958:	e1a03283 	mov	r3, r3, lsl #5
+a030495c:	e0623003 	rsb	r3, r2, r3
+a0304960:	e1a03103 	mov	r3, r3, lsl #2
+a0304964:	e0833002 	add	r3, r3, r2
+a0304968:	e1a02103 	mov	r2, r3, lsl #2
+a030496c:	e0833002 	add	r3, r3, r2
+a0304970:	e1a02103 	mov	r2, r3, lsl #2
+a0304974:	e0833002 	add	r3, r3, r2
+a0304978:	e1a02303 	mov	r2, r3, lsl #6
+a030497c:	e0833002 	add	r3, r3, r2
+a0304980:	e1a03303 	mov	r3, r3, lsl #6
+a0304984:	e50b3030 	str	r3, [fp, -#48]
+a0304988:	e51b2024 	ldr	r2, [fp, -#36]
+a030498c:	e51b302c 	ldr	r3, [fp, -#44]
+a0304990:	e0020293 	mul	r2, r3, r2
+a0304994:	e1a03002 	mov	r3, r2
+a0304998:	e1a03283 	mov	r3, r3, lsl #5
+a030499c:	e0623003 	rsb	r3, r2, r3
+a03049a0:	e1a03103 	mov	r3, r3, lsl #2
+a03049a4:	e0833002 	add	r3, r3, r2
+a03049a8:	e1a02103 	mov	r2, r3, lsl #2
+a03049ac:	e0833002 	add	r3, r3, r2
+a03049b0:	e1a02103 	mov	r2, r3, lsl #2
+a03049b4:	e0833002 	add	r3, r3, r2
+a03049b8:	e1a02303 	mov	r2, r3, lsl #6
+a03049bc:	e0833002 	add	r3, r3, r2
+a03049c0:	e1a03303 	mov	r3, r3, lsl #6
+a03049c4:	e1a030a3 	mov	r3, r3, lsr #1
+a03049c8:	e50b3034 	str	r3, [fp, -#52]
+a03049cc:	e51b3020 	ldr	r3, [fp, -#32]
+a03049d0:	e2033008 	and	r3, r3, #8	; 0x8
+a03049d4:	e3530000 	cmp	r3, #0	; 0x0
+a03049d8:	0a000002 	beq	a03049e8 <cmd_clock_info+0x12c>
+a03049dc:	e51b3030 	ldr	r3, [fp, -#48]
+a03049e0:	e50b3038 	str	r3, [fp, -#56]
+a03049e4:	ea000002 	b	a03049f4 <cmd_clock_info+0x138>
+a03049e8:	e51b3030 	ldr	r3, [fp, -#48]
+a03049ec:	e1a030a3 	mov	r3, r3, lsr #1
+a03049f0:	e50b3038 	str	r3, [fp, -#56]
+a03049f4:	e51b3018 	ldr	r3, [fp, -#24]
+a03049f8:	e2033402 	and	r3, r3, #33554432	; 0x2000000
+a03049fc:	e3530000 	cmp	r3, #0	; 0x0
+a0304a00:	0a000002 	beq	a0304a10 <cmd_clock_info+0x154>
+a0304a04:	e51b3038 	ldr	r3, [fp, -#56]
+a0304a08:	e50b303c 	str	r3, [fp, -#60]
+a0304a0c:	ea000004 	b	a0304a24 <cmd_clock_info+0x168>
+a0304a10:	e51b0030 	ldr	r0, [fp, -#48]
+a0304a14:	e51b1028 	ldr	r1, [fp, -#40]
+a0304a18:	eb001d45 	bl	a030bf34 <__udivsi3>
+a0304a1c:	e1a03000 	mov	r3, r0
+a0304a20:	e50b303c 	str	r3, [fp, -#60]
+a0304a24:	e3a03312 	mov	r3, #1207959552	; 0x48000000
+a0304a28:	e2833004 	add	r3, r3, #4	; 0x4
+a0304a2c:	e5933000 	ldr	r3, [r3]
+a0304a30:	e2033202 	and	r3, r3, #536870912	; 0x20000000
+a0304a34:	e3530000 	cmp	r3, #0	; 0x0
+a0304a38:	0a000002 	beq	a0304a48 <cmd_clock_info+0x18c>
+a0304a3c:	e3a03004 	mov	r3, #4	; 0x4
+a0304a40:	e50b3040 	str	r3, [fp, -#64]
+a0304a44:	ea00000a 	b	a0304a74 <cmd_clock_info+0x1b8>
+a0304a48:	e3a03312 	mov	r3, #1207959552	; 0x48000000
+a0304a4c:	e2833004 	add	r3, r3, #4	; 0x4
+a0304a50:	e5933000 	ldr	r3, [r3]
+a0304a54:	e2033901 	and	r3, r3, #16384	; 0x4000
+a0304a58:	e3530000 	cmp	r3, #0	; 0x0
+a0304a5c:	0a000002 	beq	a0304a6c <cmd_clock_info+0x1b0>
+a0304a60:	e3a03002 	mov	r3, #2	; 0x2
+a0304a64:	e50b3040 	str	r3, [fp, -#64]
+a0304a68:	ea000001 	b	a0304a74 <cmd_clock_info+0x1b8>
+a0304a6c:	e3a03001 	mov	r3, #1	; 0x1
+a0304a70:	e50b3040 	str	r3, [fp, -#64]
+a0304a74:	e3a03312 	mov	r3, #1207959552	; 0x48000000
+a0304a78:	e2833004 	add	r3, r3, #4	; 0x4
+a0304a7c:	e5933000 	ldr	r3, [r3]
+a0304a80:	e2033802 	and	r3, r3, #131072	; 0x20000
+a0304a84:	e3530000 	cmp	r3, #0	; 0x0
+a0304a88:	0a000002 	beq	a0304a98 <cmd_clock_info+0x1dc>
+a0304a8c:	e3a03002 	mov	r3, #2	; 0x2
+a0304a90:	e50b3044 	str	r3, [fp, -#68]
+a0304a94:	ea000001 	b	a0304aa0 <cmd_clock_info+0x1e4>
+a0304a98:	e3a03001 	mov	r3, #1	; 0x1
+a0304a9c:	e50b3044 	str	r3, [fp, -#68]
+a0304aa0:	e51b2030 	ldr	r2, [fp, -#48]
+a0304aa4:	e59f31f8 	ldr	r3, [pc, #504]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304aa8:	e0831392 	umull	r1, r3, r2, r3
+a0304aac:	e1a0c923 	mov	ip, r3, lsr #18
+a0304ab0:	e51b0030 	ldr	r0, [fp, -#48]
+a0304ab4:	e59f31e8 	ldr	r3, [pc, #488]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304ab8:	e0832390 	umull	r2, r3, r0, r3
+a0304abc:	e1a01923 	mov	r1, r3, lsr #18
+a0304ac0:	e1a02001 	mov	r2, r1
+a0304ac4:	e1a02282 	mov	r2, r2, lsl #5
+a0304ac8:	e0612002 	rsb	r2, r1, r2
+a0304acc:	e1a03302 	mov	r3, r2, lsl #6
+a0304ad0:	e0623003 	rsb	r3, r2, r3
+a0304ad4:	e1a03183 	mov	r3, r3, lsl #3
+a0304ad8:	e0833001 	add	r3, r3, r1
+a0304adc:	e1a03303 	mov	r3, r3, lsl #6
+a0304ae0:	e0632000 	rsb	r2, r3, r0
+a0304ae4:	e59f31bc 	ldr	r3, [pc, #444]	; a0304ca8 <cmd_clock_info+0x3ec>
+a0304ae8:	e0831392 	umull	r1, r3, r2, r3
+a0304aec:	e1a036a3 	mov	r3, r3, lsr #13
+a0304af0:	e59f01b4 	ldr	r0, [pc, #436]	; a0304cac <cmd_clock_info+0x3f0>
+a0304af4:	e1a0100c 	mov	r1, ip
+a0304af8:	e1a02003 	mov	r2, r3
+a0304afc:	e51b3024 	ldr	r3, [fp, -#36]
+a0304b00:	eb0017e6 	bl	a030aaa0 <printf>
+a0304b04:	e51b2034 	ldr	r2, [fp, -#52]
+a0304b08:	e59f3194 	ldr	r3, [pc, #404]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304b0c:	e0831392 	umull	r1, r3, r2, r3
+a0304b10:	e1a03923 	mov	r3, r3, lsr #18
+a0304b14:	e50b3048 	str	r3, [fp, -#72]
+a0304b18:	e51b0034 	ldr	r0, [fp, -#52]
+a0304b1c:	e59f3180 	ldr	r3, [pc, #384]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304b20:	e0832390 	umull	r2, r3, r0, r3
+a0304b24:	e1a01923 	mov	r1, r3, lsr #18
+a0304b28:	e1a02001 	mov	r2, r1
+a0304b2c:	e1a02282 	mov	r2, r2, lsl #5
+a0304b30:	e0612002 	rsb	r2, r1, r2
+a0304b34:	e1a03302 	mov	r3, r2, lsl #6
+a0304b38:	e0623003 	rsb	r3, r2, r3
+a0304b3c:	e1a03183 	mov	r3, r3, lsl #3
+a0304b40:	e0833001 	add	r3, r3, r1
+a0304b44:	e1a03303 	mov	r3, r3, lsl #6
+a0304b48:	e0632000 	rsb	r2, r3, r0
+a0304b4c:	e59f3154 	ldr	r3, [pc, #340]	; a0304ca8 <cmd_clock_info+0x3ec>
+a0304b50:	e0831392 	umull	r1, r3, r2, r3
+a0304b54:	e1a036a3 	mov	r3, r3, lsr #13
+a0304b58:	e50b304c 	str	r3, [fp, -#76]
+a0304b5c:	e51b302c 	ldr	r3, [fp, -#44]
+a0304b60:	e1a030a3 	mov	r3, r3, lsr #1
+a0304b64:	e50b3050 	str	r3, [fp, -#80]
+a0304b68:	e51b302c 	ldr	r3, [fp, -#44]
+a0304b6c:	e2032001 	and	r2, r3, #1	; 0x1
+a0304b70:	e1a03002 	mov	r3, r2
+a0304b74:	e1a03103 	mov	r3, r3, lsl #2
+a0304b78:	e0833002 	add	r3, r3, r2
+a0304b7c:	e58d3000 	str	r3, [sp]
+a0304b80:	e51b3020 	ldr	r3, [fp, -#32]
+a0304b84:	e2033001 	and	r3, r3, #1	; 0x1
+a0304b88:	e3530000 	cmp	r3, #0	; 0x0
+a0304b8c:	0a000002 	beq	a0304b9c <cmd_clock_info+0x2e0>
+a0304b90:	e59f2118 	ldr	r2, [pc, #280]	; a0304cb0 <cmd_clock_info+0x3f4>
+a0304b94:	e50b2054 	str	r2, [fp, -#84]
+a0304b98:	ea000001 	b	a0304ba4 <cmd_clock_info+0x2e8>
+a0304b9c:	e59f3110 	ldr	r3, [pc, #272]	; a0304cb4 <cmd_clock_info+0x3f8>
+a0304ba0:	e50b3054 	str	r3, [fp, -#84]
+a0304ba4:	e51b1054 	ldr	r1, [fp, -#84]
+a0304ba8:	e58d1004 	str	r1, [sp, #4]
+a0304bac:	e59f0104 	ldr	r0, [pc, #260]	; a0304cb8 <cmd_clock_info+0x3fc>
+a0304bb0:	e51b1048 	ldr	r1, [fp, -#72]
+a0304bb4:	e51b204c 	ldr	r2, [fp, -#76]
+a0304bb8:	e51b3050 	ldr	r3, [fp, -#80]
+a0304bbc:	eb0017b7 	bl	a030aaa0 <printf>
+a0304bc0:	e51b203c 	ldr	r2, [fp, -#60]
+a0304bc4:	e59f30d8 	ldr	r3, [pc, #216]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304bc8:	e0831392 	umull	r1, r3, r2, r3
+a0304bcc:	e1a0e923 	mov	lr, r3, lsr #18
+a0304bd0:	e51b003c 	ldr	r0, [fp, -#60]
+a0304bd4:	e59f30c8 	ldr	r3, [pc, #200]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304bd8:	e0832390 	umull	r2, r3, r0, r3
+a0304bdc:	e1a01923 	mov	r1, r3, lsr #18
+a0304be0:	e1a02001 	mov	r2, r1
+a0304be4:	e1a02282 	mov	r2, r2, lsl #5
+a0304be8:	e0612002 	rsb	r2, r1, r2
+a0304bec:	e1a03302 	mov	r3, r2, lsl #6
+a0304bf0:	e0623003 	rsb	r3, r2, r3
+a0304bf4:	e1a03183 	mov	r3, r3, lsl #3
+a0304bf8:	e0833001 	add	r3, r3, r1
+a0304bfc:	e1a03303 	mov	r3, r3, lsl #6
+a0304c00:	e0632000 	rsb	r2, r3, r0
+a0304c04:	e59f309c 	ldr	r3, [pc, #156]	; a0304ca8 <cmd_clock_info+0x3ec>
+a0304c08:	e0831392 	umull	r1, r3, r2, r3
+a0304c0c:	e1a026a3 	mov	r2, r3, lsr #13
+a0304c10:	e51b3018 	ldr	r3, [fp, -#24]
+a0304c14:	e1a03ca3 	mov	r3, r3, lsr #25
+a0304c18:	e203c001 	and	ip, r3, #1	; 0x1
+a0304c1c:	e51b3040 	ldr	r3, [fp, -#64]
+a0304c20:	e58d3000 	str	r3, [sp]
+a0304c24:	e51b3044 	ldr	r3, [fp, -#68]
+a0304c28:	e58d3004 	str	r3, [sp, #4]
+a0304c2c:	e59f0088 	ldr	r0, [pc, #136]	; a0304cbc <cmd_clock_info+0x400>
+a0304c30:	e1a0100e 	mov	r1, lr
+a0304c34:	e1a0300c 	mov	r3, ip
+a0304c38:	eb001798 	bl	a030aaa0 <printf>
+a0304c3c:	e51b2038 	ldr	r2, [fp, -#56]
+a0304c40:	e59f305c 	ldr	r3, [pc, #92]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304c44:	e0831392 	umull	r1, r3, r2, r3
+a0304c48:	e1a0c923 	mov	ip, r3, lsr #18
+a0304c4c:	e51b0038 	ldr	r0, [fp, -#56]
+a0304c50:	e59f304c 	ldr	r3, [pc, #76]	; a0304ca4 <cmd_clock_info+0x3e8>
+a0304c54:	e0832390 	umull	r2, r3, r0, r3
+a0304c58:	e1a01923 	mov	r1, r3, lsr #18
+a0304c5c:	e1a02001 	mov	r2, r1
+a0304c60:	e1a02282 	mov	r2, r2, lsl #5
+a0304c64:	e0612002 	rsb	r2, r1, r2
+a0304c68:	e1a03302 	mov	r3, r2, lsl #6
+a0304c6c:	e0623003 	rsb	r3, r2, r3
+a0304c70:	e1a03183 	mov	r3, r3, lsl #3
+a0304c74:	e0833001 	add	r3, r3, r1
+a0304c78:	e1a03303 	mov	r3, r3, lsl #6
+a0304c7c:	e0632000 	rsb	r2, r3, r0
+a0304c80:	e59f3020 	ldr	r3, [pc, #32]	; a0304ca8 <cmd_clock_info+0x3ec>
+a0304c84:	e0831392 	umull	r1, r3, r2, r3
+a0304c88:	e1a036a3 	mov	r3, r3, lsr #13
+a0304c8c:	e59f002c 	ldr	r0, [pc, #44]	; a0304cc0 <cmd_clock_info+0x404>
+a0304c90:	e1a0100c 	mov	r1, ip
+a0304c94:	e1a02003 	mov	r2, r3
+a0304c98:	eb001780 	bl	a030aaa0 <printf>
+a0304c9c:	e1a00003 	mov	r0, r3
+a0304ca0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0304ca4:	431bde83 	tstmi	fp, #2096	; 0x830
+a0304ca8:	d1b71759 	movles	r1, r9, asr r7
+a0304cac:	a030cdac 	eorges	ip, r0, ip, lsr #27
+a0304cb0:	a030cdd0 	ldrgesb	ip, [r0], -r0
+a0304cb4:	a030cdd4 	ldrgesb	ip, [r0], -r4
+a0304cb8:	a030cdd8 	ldrgesb	ip, [r0], -r8
+a0304cbc:	a030ce0c 	eorges	ip, r0, ip, lsl #28
+a0304cc0:	a030ce4c 	eorges	ip, r0, ip, asr #28
+
+a0304cc4 <cmd_go>:
+a0304cc4:	e1a0c00d 	mov	ip, sp
+a0304cc8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304ccc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0304cd0:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0304cd4:	e50b0010 	str	r0, [fp, -#16]
+a0304cd8:	e50b1014 	str	r1, [fp, -#20]
+a0304cdc:	e3a03000 	mov	r3, #0	; 0x0
+a0304ce0:	e50b3018 	str	r3, [fp, -#24]
+a0304ce4:	e51b3010 	ldr	r3, [fp, -#16]
+a0304ce8:	e3530002 	cmp	r3, #2	; 0x2
+a0304cec:	0a000002 	beq	a0304cfc <cmd_go+0x38>
+a0304cf0:	e3e03000 	mvn	r3, #0	; 0x0
+a0304cf4:	e50b3020 	str	r3, [fp, -#32]
+a0304cf8:	ea000018 	b	a0304d60 <cmd_go+0x9c>
+a0304cfc:	e3a02004 	mov	r2, #4	; 0x4
+a0304d00:	e51b3014 	ldr	r3, [fp, -#20]
+a0304d04:	e0823003 	add	r3, r2, r3
+a0304d08:	e24b2018 	sub	r2, fp, #24	; 0x18
+a0304d0c:	e5930000 	ldr	r0, [r3]
+a0304d10:	e1a01002 	mov	r1, r2
+a0304d14:	eb001a15 	bl	a030b570 <strtou32>
+a0304d18:	e1a03000 	mov	r3, r0
+a0304d1c:	e50b301c 	str	r3, [fp, -#28]
+a0304d20:	e51b301c 	ldr	r3, [fp, -#28]
+a0304d24:	e3530000 	cmp	r3, #0	; 0x0
+a0304d28:	aa000002 	bge	a0304d38 <cmd_go+0x74>
+a0304d2c:	e3e03000 	mvn	r3, #0	; 0x0
+a0304d30:	e50b3020 	str	r3, [fp, -#32]
+a0304d34:	ea000009 	b	a0304d60 <cmd_go+0x9c>
+a0304d38:	e59f0028 	ldr	r0, [pc, #40]	; a0304d68 <cmd_go+0xa4>
+a0304d3c:	e51b1018 	ldr	r1, [fp, -#24]
+a0304d40:	eb001756 	bl	a030aaa0 <printf>
+a0304d44:	e51b3018 	ldr	r3, [fp, -#24]
+a0304d48:	e1a0e00f 	mov	lr, pc
+a0304d4c:	e1a0f003 	mov	pc, r3
+a0304d50:	e59f0014 	ldr	r0, [pc, #20]	; a0304d6c <cmd_go+0xa8>
+a0304d54:	eb001751 	bl	a030aaa0 <printf>
+a0304d58:	e3a03000 	mov	r3, #0	; 0x0
+a0304d5c:	e50b3020 	str	r3, [fp, -#32]
+a0304d60:	e51b0020 	ldr	r0, [fp, -#32]
+a0304d64:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0304d68:	a030ce78 	eorges	ip, r0, r8, ror lr
+a0304d6c:	a030ce94 	mlages	r0, r4, lr, ip
+
+a0304d70 <ReadByteWithTimeout>:
+a0304d70:	e1a0c00d 	mov	ip, sp
+a0304d74:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304d78:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0304d7c:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0304d80:	e50b0010 	str	r0, [fp, -#16]
+a0304d84:	e24b3011 	sub	r3, fp, #17	; 0x11
+a0304d88:	e1a00003 	mov	r0, r3
+a0304d8c:	e3a01001 	mov	r1, #1	; 0x1
+a0304d90:	e51b2010 	ldr	r2, [fp, -#16]
+a0304d94:	eb0018fc 	bl	a030b18c <SerialInputBlock>
+a0304d98:	e1a03000 	mov	r3, r0
+a0304d9c:	e50b3018 	str	r3, [fp, -#24]
+a0304da0:	e51b3018 	ldr	r3, [fp, -#24]
+a0304da4:	e3530001 	cmp	r3, #1	; 0x1
+a0304da8:	1a000002 	bne	a0304db8 <ReadByteWithTimeout+0x48>
+a0304dac:	e55b3011 	ldrb	r3, [fp, -#17]
+a0304db0:	e50b301c 	str	r3, [fp, -#28]
+a0304db4:	ea000001 	b	a0304dc0 <ReadByteWithTimeout+0x50>
+a0304db8:	e3e03000 	mvn	r3, #0	; 0x0
+a0304dbc:	e50b301c 	str	r3, [fp, -#28]
+a0304dc0:	e51b001c 	ldr	r0, [fp, -#28]
+a0304dc4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0304dc8 <XModemReceive>:
+a0304dc8:	e1a0c00d 	mov	ip, sp
+a0304dcc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0304dd0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0304dd4:	e24dd05c 	sub	sp, sp, #92	; 0x5c
+a0304dd8:	e50b0010 	str	r0, [fp, -#16]
+a0304ddc:	e50b1014 	str	r1, [fp, -#20]
+a0304de0:	e3a03000 	mov	r3, #0	; 0x0
+a0304de4:	e50b3018 	str	r3, [fp, -#24]
+a0304de8:	e3a03001 	mov	r3, #1	; 0x1
+a0304dec:	e50b301c 	str	r3, [fp, -#28]
+a0304df0:	e3a03000 	mov	r3, #0	; 0x0
+a0304df4:	e50b3020 	str	r3, [fp, -#32]
+a0304df8:	e3a03001 	mov	r3, #1	; 0x1
+a0304dfc:	e50b3024 	str	r3, [fp, -#36]
+a0304e00:	e3a03043 	mov	r3, #67	; 0x43
+a0304e04:	e54b3025 	strb	r3, [fp, -#37]
+a0304e08:	eb00013f 	bl	a030530c <ReadFlush>
+a0304e0c:	e55b3025 	ldrb	r3, [fp, -#37]
+a0304e10:	e1a00003 	mov	r0, r3
+a0304e14:	eb000132 	bl	a03052e4 <WriteByte>
+a0304e18:	e3a03000 	mov	r3, #0	; 0x0
+a0304e1c:	e50b303c 	str	r3, [fp, -#60]
+a0304e20:	e3a03000 	mov	r3, #0	; 0x0
+a0304e24:	e50b3040 	str	r3, [fp, -#64]
+a0304e28:	e3a03000 	mov	r3, #0	; 0x0
+a0304e2c:	e50b3044 	str	r3, [fp, -#68]
+a0304e30:	e3a0000a 	mov	r0, #10	; 0xa
+a0304e34:	ebffffcd 	bl	a0304d70 <ReadByteWithTimeout>
+a0304e38:	e1a03000 	mov	r3, r0
+a0304e3c:	e50b302c 	str	r3, [fp, -#44]
+a0304e40:	e51b302c 	ldr	r3, [fp, -#44]
+a0304e44:	e3530000 	cmp	r3, #0	; 0x0
+a0304e48:	aa000000 	bge	a0304e50 <XModemReceive+0x88>
+a0304e4c:	ea0000ef 	b	a0305210 <XModemReceive+0x448>
+a0304e50:	e3a03015 	mov	r3, #21	; 0x15
+a0304e54:	e54b3025 	strb	r3, [fp, -#37]
+a0304e58:	e51b302c 	ldr	r3, [fp, -#44]
+a0304e5c:	e50b3064 	str	r3, [fp, -#100]
+a0304e60:	e51b3064 	ldr	r3, [fp, -#100]
+a0304e64:	e3530001 	cmp	r3, #1	; 0x1
+a0304e68:	ba0000e8 	blt	a0305210 <XModemReceive+0x448>
+a0304e6c:	e51b3064 	ldr	r3, [fp, -#100]
+a0304e70:	e3530002 	cmp	r3, #2	; 0x2
+a0304e74:	da000006 	ble	a0304e94 <XModemReceive+0xcc>
+a0304e78:	e51b3064 	ldr	r3, [fp, -#100]
+a0304e7c:	e3530004 	cmp	r3, #4	; 0x4
+a0304e80:	0a000000 	beq	a0304e88 <XModemReceive+0xc0>
+a0304e84:	ea0000e1 	b	a0305210 <XModemReceive+0x448>
+a0304e88:	e3a00006 	mov	r0, #6	; 0x6
+a0304e8c:	eb000114 	bl	a03052e4 <WriteByte>
+a0304e90:	ea00010e 	b	a03052d0 <XModemReceive+0x508>
+a0304e94:	e3a0000a 	mov	r0, #10	; 0xa
+a0304e98:	ebffffb4 	bl	a0304d70 <ReadByteWithTimeout>
+a0304e9c:	e1a03000 	mov	r3, r0
+a0304ea0:	e50b3030 	str	r3, [fp, -#48]
+a0304ea4:	e51b3030 	ldr	r3, [fp, -#48]
+a0304ea8:	e3530000 	cmp	r3, #0	; 0x0
+a0304eac:	aa000000 	bge	a0304eb4 <XModemReceive+0xec>
+a0304eb0:	ea0000d6 	b	a0305210 <XModemReceive+0x448>
+a0304eb4:	e3a0000a 	mov	r0, #10	; 0xa
+a0304eb8:	ebffffac 	bl	a0304d70 <ReadByteWithTimeout>
+a0304ebc:	e1a03000 	mov	r3, r0
+a0304ec0:	e50b3034 	str	r3, [fp, -#52]
+a0304ec4:	e51b3034 	ldr	r3, [fp, -#52]
+a0304ec8:	e3530000 	cmp	r3, #0	; 0x0
+a0304ecc:	aa000000 	bge	a0304ed4 <XModemReceive+0x10c>
+a0304ed0:	ea0000ce 	b	a0305210 <XModemReceive+0x448>
+a0304ed4:	e51b3034 	ldr	r3, [fp, -#52]
+a0304ed8:	e26320ff 	rsb	r2, r3, #255	; 0xff
+a0304edc:	e51b3030 	ldr	r3, [fp, -#48]
+a0304ee0:	e1530002 	cmp	r3, r2
+a0304ee4:	0a000000 	beq	a0304eec <XModemReceive+0x124>
+a0304ee8:	ea0000c8 	b	a0305210 <XModemReceive+0x448>
+a0304eec:	e51b302c 	ldr	r3, [fp, -#44]
+a0304ef0:	e3530001 	cmp	r3, #1	; 0x1
+a0304ef4:	1a000002 	bne	a0304f04 <XModemReceive+0x13c>
+a0304ef8:	e3a03080 	mov	r3, #128	; 0x80
+a0304efc:	e50b3068 	str	r3, [fp, -#104]
+a0304f00:	ea000001 	b	a0304f0c <XModemReceive+0x144>
+a0304f04:	e3a03b01 	mov	r3, #1024	; 0x400
+a0304f08:	e50b3068 	str	r3, [fp, -#104]
+a0304f0c:	e51b3068 	ldr	r3, [fp, -#104]
+a0304f10:	e50b3038 	str	r3, [fp, -#56]
+a0304f14:	e3a03000 	mov	r3, #0	; 0x0
+a0304f18:	e50b3048 	str	r3, [fp, -#72]
+a0304f1c:	e51b2048 	ldr	r2, [fp, -#72]
+a0304f20:	e51b3038 	ldr	r3, [fp, -#56]
+a0304f24:	e1520003 	cmp	r2, r3
+a0304f28:	ba000000 	blt	a0304f30 <XModemReceive+0x168>
+a0304f2c:	ea000010 	b	a0304f74 <XModemReceive+0x1ac>
+a0304f30:	e3a0000a 	mov	r0, #10	; 0xa
+a0304f34:	ebffff8d 	bl	a0304d70 <ReadByteWithTimeout>
+a0304f38:	e1a03000 	mov	r3, r0
+a0304f3c:	e50b304c 	str	r3, [fp, -#76]
+a0304f40:	e51b304c 	ldr	r3, [fp, -#76]
+a0304f44:	e3530000 	cmp	r3, #0	; 0x0
+a0304f48:	aa000000 	bge	a0304f50 <XModemReceive+0x188>
+a0304f4c:	ea0000af 	b	a0305210 <XModemReceive+0x448>
+a0304f50:	e59f2388 	ldr	r2, [pc, #904]	; a03052e0 <XModemReceive+0x518>
+a0304f54:	e51b3048 	ldr	r3, [fp, -#72]
+a0304f58:	e0822003 	add	r2, r2, r3
+a0304f5c:	e55b304c 	ldrb	r3, [fp, -#76]
+a0304f60:	e5c23000 	strb	r3, [r2]
+a0304f64:	e51b3048 	ldr	r3, [fp, -#72]
+a0304f68:	e2833001 	add	r3, r3, #1	; 0x1
+a0304f6c:	e50b3048 	str	r3, [fp, -#72]
+a0304f70:	eaffffe9 	b	a0304f1c <XModemReceive+0x154>
+a0304f74:	e51b3024 	ldr	r3, [fp, -#36]
+a0304f78:	e3530000 	cmp	r3, #0	; 0x0
+a0304f7c:	0a00000f 	beq	a0304fc0 <XModemReceive+0x1f8>
+a0304f80:	e3a0000a 	mov	r0, #10	; 0xa
+a0304f84:	ebffff79 	bl	a0304d70 <ReadByteWithTimeout>
+a0304f88:	e1a03000 	mov	r3, r0
+a0304f8c:	e50b3040 	str	r3, [fp, -#64]
+a0304f90:	e51b3040 	ldr	r3, [fp, -#64]
+a0304f94:	e3530000 	cmp	r3, #0	; 0x0
+a0304f98:	aa000000 	bge	a0304fa0 <XModemReceive+0x1d8>
+a0304f9c:	ea00009b 	b	a0305210 <XModemReceive+0x448>
+a0304fa0:	e3a0000a 	mov	r0, #10	; 0xa
+a0304fa4:	ebffff71 	bl	a0304d70 <ReadByteWithTimeout>
+a0304fa8:	e1a03000 	mov	r3, r0
+a0304fac:	e50b3044 	str	r3, [fp, -#68]
+a0304fb0:	e51b3044 	ldr	r3, [fp, -#68]
+a0304fb4:	e3530000 	cmp	r3, #0	; 0x0
+a0304fb8:	aa000008 	bge	a0304fe0 <XModemReceive+0x218>
+a0304fbc:	ea000093 	b	a0305210 <XModemReceive+0x448>
+a0304fc0:	e3a0000a 	mov	r0, #10	; 0xa
+a0304fc4:	ebffff69 	bl	a0304d70 <ReadByteWithTimeout>
+a0304fc8:	e1a03000 	mov	r3, r0
+a0304fcc:	e50b303c 	str	r3, [fp, -#60]
+a0304fd0:	e51b303c 	ldr	r3, [fp, -#60]
+a0304fd4:	e3530000 	cmp	r3, #0	; 0x0
+a0304fd8:	aa000000 	bge	a0304fe0 <XModemReceive+0x218>
+a0304fdc:	ea00008b 	b	a0305210 <XModemReceive+0x448>
+a0304fe0:	e51b301c 	ldr	r3, [fp, -#28]
+a0304fe4:	e2433001 	sub	r3, r3, #1	; 0x1
+a0304fe8:	e20320ff 	and	r2, r3, #255	; 0xff
+a0304fec:	e51b3030 	ldr	r3, [fp, -#48]
+a0304ff0:	e1530002 	cmp	r3, r2
+a0304ff4:	1a000000 	bne	a0304ffc <XModemReceive+0x234>
+a0304ff8:	ea00007f 	b	a03051fc <XModemReceive+0x434>
+a0304ffc:	e51b301c 	ldr	r3, [fp, -#28]
+a0305000:	e20320ff 	and	r2, r3, #255	; 0xff
+a0305004:	e51b3030 	ldr	r3, [fp, -#48]
+a0305008:	e1530002 	cmp	r3, r2
+a030500c:	0a000000 	beq	a0305014 <XModemReceive+0x24c>
+a0305010:	ea00007e 	b	a0305210 <XModemReceive+0x448>
+a0305014:	e51b3024 	ldr	r3, [fp, -#36]
+a0305018:	e3530000 	cmp	r3, #0	; 0x0
+a030501c:	0a00003c 	beq	a0305114 <XModemReceive+0x34c>
+a0305020:	e3a03000 	mov	r3, #0	; 0x0
+a0305024:	e50b304c 	str	r3, [fp, -#76]
+a0305028:	e3a03000 	mov	r3, #0	; 0x0
+a030502c:	e50b3048 	str	r3, [fp, -#72]
+a0305030:	e51b2048 	ldr	r2, [fp, -#72]
+a0305034:	e51b3038 	ldr	r3, [fp, -#56]
+a0305038:	e1520003 	cmp	r2, r3
+a030503c:	ba000000 	blt	a0305044 <XModemReceive+0x27c>
+a0305040:	ea000023 	b	a03050d4 <XModemReceive+0x30c>
+a0305044:	e59f2294 	ldr	r2, [pc, #660]	; a03052e0 <XModemReceive+0x518>
+a0305048:	e51b3048 	ldr	r3, [fp, -#72]
+a030504c:	e0823003 	add	r3, r2, r3
+a0305050:	e5d33000 	ldrb	r3, [r3]
+a0305054:	e1a02403 	mov	r2, r3, lsl #8
+a0305058:	e51b304c 	ldr	r3, [fp, -#76]
+a030505c:	e0233002 	eor	r3, r3, r2
+a0305060:	e50b304c 	str	r3, [fp, -#76]
+a0305064:	e3a03000 	mov	r3, #0	; 0x0
+a0305068:	e50b3050 	str	r3, [fp, -#80]
+a030506c:	e51b3050 	ldr	r3, [fp, -#80]
+a0305070:	e3530007 	cmp	r3, #7	; 0x7
+a0305074:	da000000 	ble	a030507c <XModemReceive+0x2b4>
+a0305078:	ea000011 	b	a03050c4 <XModemReceive+0x2fc>
+a030507c:	e51b304c 	ldr	r3, [fp, -#76]
+a0305080:	e2033902 	and	r3, r3, #32768	; 0x8000
+a0305084:	e3530000 	cmp	r3, #0	; 0x0
+a0305088:	0a000006 	beq	a03050a8 <XModemReceive+0x2e0>
+a030508c:	e51b304c 	ldr	r3, [fp, -#76]
+a0305090:	e1a02083 	mov	r2, r3, lsl #1
+a0305094:	e3a03a01 	mov	r3, #4096	; 0x1000
+a0305098:	e2833021 	add	r3, r3, #33	; 0x21
+a030509c:	e0223003 	eor	r3, r2, r3
+a03050a0:	e50b304c 	str	r3, [fp, -#76]
+a03050a4:	ea000002 	b	a03050b4 <XModemReceive+0x2ec>
+a03050a8:	e51b304c 	ldr	r3, [fp, -#76]
+a03050ac:	e1a03083 	mov	r3, r3, lsl #1
+a03050b0:	e50b304c 	str	r3, [fp, -#76]
+a03050b4:	e51b3050 	ldr	r3, [fp, -#80]
+a03050b8:	e2833001 	add	r3, r3, #1	; 0x1
+a03050bc:	e50b3050 	str	r3, [fp, -#80]
+a03050c0:	eaffffe9 	b	a030506c <XModemReceive+0x2a4>
+a03050c4:	e51b3048 	ldr	r3, [fp, -#72]
+a03050c8:	e2833001 	add	r3, r3, #1	; 0x1
+a03050cc:	e50b3048 	str	r3, [fp, -#72]
+a03050d0:	eaffffd6 	b	a0305030 <XModemReceive+0x268>
+a03050d4:	e51b304c 	ldr	r3, [fp, -#76]
+a03050d8:	e1a03443 	mov	r3, r3, asr #8
+a03050dc:	e20330ff 	and	r3, r3, #255	; 0xff
+a03050e0:	e50b3054 	str	r3, [fp, -#84]
+a03050e4:	e51b304c 	ldr	r3, [fp, -#76]
+a03050e8:	e20330ff 	and	r3, r3, #255	; 0xff
+a03050ec:	e50b3058 	str	r3, [fp, -#88]
+a03050f0:	e51b2040 	ldr	r2, [fp, -#64]
+a03050f4:	e51b3054 	ldr	r3, [fp, -#84]
+a03050f8:	e1520003 	cmp	r2, r3
+a03050fc:	1a000043 	bne	a0305210 <XModemReceive+0x448>
+a0305100:	e51b2044 	ldr	r2, [fp, -#68]
+a0305104:	e51b3058 	ldr	r3, [fp, -#88]
+a0305108:	e1520003 	cmp	r2, r3
+a030510c:	1a00003f 	bne	a0305210 <XModemReceive+0x448>
+a0305110:	ea000018 	b	a0305178 <XModemReceive+0x3b0>
+a0305114:	e3a03000 	mov	r3, #0	; 0x0
+a0305118:	e54b3059 	strb	r3, [fp, -#89]
+a030511c:	e3a03000 	mov	r3, #0	; 0x0
+a0305120:	e50b3058 	str	r3, [fp, -#88]
+a0305124:	e51b2058 	ldr	r2, [fp, -#88]
+a0305128:	e51b3038 	ldr	r3, [fp, -#56]
+a030512c:	e1520003 	cmp	r2, r3
+a0305130:	ba000000 	blt	a0305138 <XModemReceive+0x370>
+a0305134:	ea00000a 	b	a0305164 <XModemReceive+0x39c>
+a0305138:	e59f21a0 	ldr	r2, [pc, #416]	; a03052e0 <XModemReceive+0x518>
+a030513c:	e51b3058 	ldr	r3, [fp, -#88]
+a0305140:	e0823003 	add	r3, r2, r3
+a0305144:	e55b2059 	ldrb	r2, [fp, -#89]
+a0305148:	e5d33000 	ldrb	r3, [r3]
+a030514c:	e0823003 	add	r3, r2, r3
+a0305150:	e54b3059 	strb	r3, [fp, -#89]
+a0305154:	e51b3058 	ldr	r3, [fp, -#88]
+a0305158:	e2833001 	add	r3, r3, #1	; 0x1
+a030515c:	e50b3058 	str	r3, [fp, -#88]
+a0305160:	eaffffef 	b	a0305124 <XModemReceive+0x35c>
+a0305164:	e55b2059 	ldrb	r2, [fp, -#89]
+a0305168:	e51b303c 	ldr	r3, [fp, -#60]
+a030516c:	e1530002 	cmp	r3, r2
+a0305170:	0a000000 	beq	a0305178 <XModemReceive+0x3b0>
+a0305174:	ea000025 	b	a0305210 <XModemReceive+0x448>
+a0305178:	e51b301c 	ldr	r3, [fp, -#28]
+a030517c:	e2833001 	add	r3, r3, #1	; 0x1
+a0305180:	e50b301c 	str	r3, [fp, -#28]
+a0305184:	e51b2020 	ldr	r2, [fp, -#32]
+a0305188:	e51b3038 	ldr	r3, [fp, -#56]
+a030518c:	e0823003 	add	r3, r2, r3
+a0305190:	e50b3020 	str	r3, [fp, -#32]
+a0305194:	e51b2020 	ldr	r2, [fp, -#32]
+a0305198:	e51b3014 	ldr	r3, [fp, -#20]
+a030519c:	e1520003 	cmp	r2, r3
+a03051a0:	9a000000 	bls	a03051a8 <XModemReceive+0x3e0>
+a03051a4:	ea000019 	b	a0305210 <XModemReceive+0x448>
+a03051a8:	e3a03000 	mov	r3, #0	; 0x0
+a03051ac:	e50b3058 	str	r3, [fp, -#88]
+a03051b0:	e51b2058 	ldr	r2, [fp, -#88]
+a03051b4:	e51b3038 	ldr	r3, [fp, -#56]
+a03051b8:	e1520003 	cmp	r2, r3
+a03051bc:	ba000000 	blt	a03051c4 <XModemReceive+0x3fc>
+a03051c0:	ea00000d 	b	a03051fc <XModemReceive+0x434>
+a03051c4:	e24b0010 	sub	r0, fp, #16	; 0x10
+a03051c8:	e5902000 	ldr	r2, [r0]
+a03051cc:	e59f110c 	ldr	r1, [pc, #268]	; a03052e0 <XModemReceive+0x518>
+a03051d0:	e51b3058 	ldr	r3, [fp, -#88]
+a03051d4:	e0813003 	add	r3, r1, r3
+a03051d8:	e1a01002 	mov	r1, r2
+a03051dc:	e5d33000 	ldrb	r3, [r3]
+a03051e0:	e5c13000 	strb	r3, [r1]
+a03051e4:	e2822001 	add	r2, r2, #1	; 0x1
+a03051e8:	e5802000 	str	r2, [r0]
+a03051ec:	e51b3058 	ldr	r3, [fp, -#88]
+a03051f0:	e2833001 	add	r3, r3, #1	; 0x1
+a03051f4:	e50b3058 	str	r3, [fp, -#88]
+a03051f8:	eaffffec 	b	a03051b0 <XModemReceive+0x3e8>
+a03051fc:	e3a03000 	mov	r3, #0	; 0x0
+a0305200:	e50b3018 	str	r3, [fp, -#24]
+a0305204:	e3a00006 	mov	r0, #6	; 0x6
+a0305208:	eb000035 	bl	a03052e4 <WriteByte>
+a030520c:	eaffff01 	b	a0304e18 <XModemReceive+0x50>
+a0305210:	e51b3018 	ldr	r3, [fp, -#24]
+a0305214:	e2833001 	add	r3, r3, #1	; 0x1
+a0305218:	e50b3018 	str	r3, [fp, -#24]
+a030521c:	e51b3018 	ldr	r3, [fp, -#24]
+a0305220:	e3530005 	cmp	r3, #5	; 0x5
+a0305224:	1a000024 	bne	a03052bc <XModemReceive+0x4f4>
+a0305228:	e55b3025 	ldrb	r3, [fp, -#37]
+a030522c:	e3530043 	cmp	r3, #67	; 0x43
+a0305230:	1a000006 	bne	a0305250 <XModemReceive+0x488>
+a0305234:	e3a03015 	mov	r3, #21	; 0x15
+a0305238:	e54b3025 	strb	r3, [fp, -#37]
+a030523c:	e3a03000 	mov	r3, #0	; 0x0
+a0305240:	e50b3018 	str	r3, [fp, -#24]
+a0305244:	e3a03000 	mov	r3, #0	; 0x0
+a0305248:	e50b3024 	str	r3, [fp, -#36]
+a030524c:	eaffffef 	b	a0305210 <XModemReceive+0x448>
+a0305250:	e3a03000 	mov	r3, #0	; 0x0
+a0305254:	e50b3058 	str	r3, [fp, -#88]
+a0305258:	e51b3058 	ldr	r3, [fp, -#88]
+a030525c:	e3530004 	cmp	r3, #4	; 0x4
+a0305260:	da000000 	ble	a0305268 <XModemReceive+0x4a0>
+a0305264:	ea000005 	b	a0305280 <XModemReceive+0x4b8>
+a0305268:	e3a00018 	mov	r0, #24	; 0x18
+a030526c:	eb00001c 	bl	a03052e4 <WriteByte>
+a0305270:	e51b3058 	ldr	r3, [fp, -#88]
+a0305274:	e2833001 	add	r3, r3, #1	; 0x1
+a0305278:	e50b3058 	str	r3, [fp, -#88]
+a030527c:	eafffff5 	b	a0305258 <XModemReceive+0x490>
+a0305280:	e3a03000 	mov	r3, #0	; 0x0
+a0305284:	e50b3058 	str	r3, [fp, -#88]
+a0305288:	e51b3058 	ldr	r3, [fp, -#88]
+a030528c:	e3530004 	cmp	r3, #4	; 0x4
+a0305290:	da000000 	ble	a0305298 <XModemReceive+0x4d0>
+a0305294:	ea000005 	b	a03052b0 <XModemReceive+0x4e8>
+a0305298:	e3a00008 	mov	r0, #8	; 0x8
+a030529c:	eb000010 	bl	a03052e4 <WriteByte>
+a03052a0:	e51b3058 	ldr	r3, [fp, -#88]
+a03052a4:	e2833001 	add	r3, r3, #1	; 0x1
+a03052a8:	e50b3058 	str	r3, [fp, -#88]
+a03052ac:	eafffff5 	b	a0305288 <XModemReceive+0x4c0>
+a03052b0:	e3e03000 	mvn	r3, #0	; 0x0
+a03052b4:	e50b3060 	str	r3, [fp, -#96]
+a03052b8:	ea000006 	b	a03052d8 <XModemReceive+0x510>
+a03052bc:	eb000012 	bl	a030530c <ReadFlush>
+a03052c0:	e55b3025 	ldrb	r3, [fp, -#37]
+a03052c4:	e1a00003 	mov	r0, r3
+a03052c8:	eb000005 	bl	a03052e4 <WriteByte>
+a03052cc:	eafffed1 	b	a0304e18 <XModemReceive+0x50>
+a03052d0:	e51b3020 	ldr	r3, [fp, -#32]
+a03052d4:	e50b3060 	str	r3, [fp, -#96]
+a03052d8:	e51b0060 	ldr	r0, [fp, -#96]
+a03052dc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03052e0:	a030f4c4 	eorges	pc, r0, r4, asr #9
+
+a03052e4 <WriteByte>:
+a03052e4:	e1a0c00d 	mov	ip, sp
+a03052e8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03052ec:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03052f0:	e24dd004 	sub	sp, sp, #4	; 0x4
+a03052f4:	e1a03000 	mov	r3, r0
+a03052f8:	e54b300d 	strb	r3, [fp, -#13]
+a03052fc:	e55b300d 	ldrb	r3, [fp, -#13]
+a0305300:	e1a00003 	mov	r0, r3
+a0305304:	eb001667 	bl	a030aca8 <serial_write_raw>
+a0305308:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030530c <ReadFlush>:
+a030530c:	e1a0c00d 	mov	ip, sp
+a0305310:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0305314:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0305318:	eb00167d 	bl	a030ad14 <serial_flush_input>
+a030531c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0305320 <reset_cmd>:
+a0305320:	e1a0c00d 	mov	ip, sp
+a0305324:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0305328:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030532c:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0305330:	e50b0010 	str	r0, [fp, -#16]
+a0305334:	e50b1014 	str	r1, [fp, -#20]
+a0305338:	eb001681 	bl	a030ad44 <serial_flush_output>
+a030533c:	e59f0054 	ldr	r0, [pc, #84]	; a0305398 <reset_cmd+0x78>
+a0305340:	eb0015d6 	bl	a030aaa0 <printf>
+a0305344:	eb00167e 	bl	a030ad44 <serial_flush_output>
+a0305348:	e3a03000 	mov	r3, #0	; 0x0
+a030534c:	e50b3018 	str	r3, [fp, -#24]
+a0305350:	e51b3018 	ldr	r3, [fp, -#24]
+a0305354:	e3530063 	cmp	r3, #99	; 0x63
+a0305358:	da000000 	ble	a0305360 <reset_cmd+0x40>
+a030535c:	ea000005 	b	a0305378 <reset_cmd+0x58>
+a0305360:	e3a0000a 	mov	r0, #10	; 0xa
+a0305364:	eb001633 	bl	a030ac38 <serial_write>
+a0305368:	e51b3018 	ldr	r3, [fp, -#24]
+a030536c:	e2833001 	add	r3, r3, #1	; 0x1
+a0305370:	e50b3018 	str	r3, [fp, -#24]
+a0305374:	eafffff5 	b	a0305350 <reset_cmd+0x30>
+a0305378:	eb001671 	bl	a030ad44 <serial_flush_output>
+a030537c:	e59f0014 	ldr	r0, [pc, #20]	; a0305398 <reset_cmd+0x78>
+a0305380:	eb0015c6 	bl	a030aaa0 <printf>
+a0305384:	eb00166e 	bl	a030ad44 <serial_flush_output>
+a0305388:	eb001661 	bl	a030ad14 <serial_flush_input>
+a030538c:	e3a03000 	mov	r3, #0	; 0x0
+a0305390:	e1a00003 	mov	r0, r3
+a0305394:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0305398:	a030cea0 	eorges	ip, r0, r0, lsr #29
+
+a030539c <reboot_cmd>:
+a030539c:	e1a0c00d 	mov	ip, sp
+a03053a0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03053a4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03053a8:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03053ac:	e50b0010 	str	r0, [fp, -#16]
+a03053b0:	e50b1014 	str	r1, [fp, -#20]
+a03053b4:	e59f0014 	ldr	r0, [pc, #20]	; a03053d0 <reboot_cmd+0x34>
+a03053b8:	eb0015b8 	bl	a030aaa0 <printf>
+a03053bc:	eb001660 	bl	a030ad44 <serial_flush_output>
+a03053c0:	eb0015f2 	bl	a030ab90 <reboot_system>
+a03053c4:	e3a03000 	mov	r3, #0	; 0x0
+a03053c8:	e1a00003 	mov	r0, r3
+a03053cc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03053d0:	a030cea4 	eorges	ip, r0, r4, lsr #29
+
+a03053d4 <bogomips_cmd>:
+a03053d4:	e1a0c00d 	mov	ip, sp
+a03053d8:	e92dd810 	stmdb	sp!, {r4, fp, ip, lr, pc}
+a03053dc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03053e0:	e24dd014 	sub	sp, sp, #20	; 0x14
+a03053e4:	e50b0014 	str	r0, [fp, -#20]
+a03053e8:	e50b1018 	str	r1, [fp, -#24]
+a03053ec:	eb0018c5 	bl	a030b708 <timer_read>
+a03053f0:	e1a03000 	mov	r3, r0
+a03053f4:	e50b3020 	str	r3, [fp, -#32]
+a03053f8:	e3a03000 	mov	r3, #0	; 0x0
+a03053fc:	e50b301c 	str	r3, [fp, -#28]
+a0305400:	e51b201c 	ldr	r2, [fp, -#28]
+a0305404:	e3a03b61 	mov	r3, #99328	; 0x18400
+a0305408:	e2833fa7 	add	r3, r3, #668	; 0x29c
+a030540c:	e2833003 	add	r3, r3, #3	; 0x3
+a0305410:	e1520003 	cmp	r2, r3
+a0305414:	da000000 	ble	a030541c <bogomips_cmd+0x48>
+a0305418:	ea000003 	b	a030542c <bogomips_cmd+0x58>
+a030541c:	e51b301c 	ldr	r3, [fp, -#28]
+a0305420:	e2833001 	add	r3, r3, #1	; 0x1
+a0305424:	e50b301c 	str	r3, [fp, -#28]
+a0305428:	eafffff4 	b	a0305400 <bogomips_cmd+0x2c>
+a030542c:	eb0018b5 	bl	a030b708 <timer_read>
+a0305430:	e1a02000 	mov	r2, r0
+a0305434:	e51b3020 	ldr	r3, [fp, -#32]
+a0305438:	e0633002 	rsb	r3, r3, r2
+a030543c:	e50b3024 	str	r3, [fp, -#36]
+a0305440:	e51b2024 	ldr	r2, [fp, -#36]
+a0305444:	e1a03002 	mov	r3, r2
+a0305448:	e1a03283 	mov	r3, r3, lsl #5
+a030544c:	e0623003 	rsb	r3, r2, r3
+a0305450:	e1a03103 	mov	r3, r3, lsl #2
+a0305454:	e0833002 	add	r3, r3, r2
+a0305458:	e1a04183 	mov	r4, r3, lsl #3
+a030545c:	eb0018e6 	bl	a030b7fc <timer_tps>
+a0305460:	e1a03000 	mov	r3, r0
+a0305464:	e1a00004 	mov	r0, r4
+a0305468:	e1a01003 	mov	r1, r3
+a030546c:	eb001ab0 	bl	a030bf34 <__udivsi3>
+a0305470:	e1a03000 	mov	r3, r0
+a0305474:	e59f004c 	ldr	r0, [pc, #76]	; a03054c8 <bogomips_cmd+0xf4>
+a0305478:	e1a01003 	mov	r1, r3
+a030547c:	eb001587 	bl	a030aaa0 <printf>
+a0305480:	eb0018dd 	bl	a030b7fc <timer_tps>
+a0305484:	e1a02000 	mov	r2, r0
+a0305488:	e1a03002 	mov	r3, r2
+a030548c:	e1a03103 	mov	r3, r3, lsl #2
+a0305490:	e0833002 	add	r3, r3, r2
+a0305494:	e1a02103 	mov	r2, r3, lsl #2
+a0305498:	e0833002 	add	r3, r3, r2
+a030549c:	e1a03083 	mov	r3, r3, lsl #1
+a03054a0:	e1a00003 	mov	r0, r3
+a03054a4:	e51b1024 	ldr	r1, [fp, -#36]
+a03054a8:	eb001aa1 	bl	a030bf34 <__udivsi3>
+a03054ac:	e1a03000 	mov	r3, r0
+a03054b0:	e59f0014 	ldr	r0, [pc, #20]	; a03054cc <bogomips_cmd+0xf8>
+a03054b4:	e1a01003 	mov	r1, r3
+a03054b8:	eb001578 	bl	a030aaa0 <printf>
+a03054bc:	e3a03000 	mov	r3, #0	; 0x0
+a03054c0:	e1a00003 	mov	r0, r3
+a03054c4:	e91ba810 	ldmdb	fp, {r4, fp, sp, pc}
+a03054c8:	a030ceb4 	ldrgeh	ip, [r0], -r4
+a03054cc:	a030cec8 	eorges	ip, r0, r8, asr #29
+
+a03054d0 <call_cmd>:
+a03054d0:	e1a0c00d 	mov	ip, sp
+a03054d4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03054d8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03054dc:	e24dd024 	sub	sp, sp, #36	; 0x24
+a03054e0:	e50b0010 	str	r0, [fp, -#16]
+a03054e4:	e50b1014 	str	r1, [fp, -#20]
+a03054e8:	e3a03000 	mov	r3, #0	; 0x0
+a03054ec:	e50b3018 	str	r3, [fp, -#24]
+a03054f0:	e3a03000 	mov	r3, #0	; 0x0
+a03054f4:	e50b3020 	str	r3, [fp, -#32]
+a03054f8:	e3a03000 	mov	r3, #0	; 0x0
+a03054fc:	e50b3024 	str	r3, [fp, -#36]
+a0305500:	e3a03000 	mov	r3, #0	; 0x0
+a0305504:	e50b3028 	str	r3, [fp, -#40]
+a0305508:	e3a03000 	mov	r3, #0	; 0x0
+a030550c:	e50b302c 	str	r3, [fp, -#44]
+a0305510:	e51b3010 	ldr	r3, [fp, -#16]
+a0305514:	e3530001 	cmp	r3, #1	; 0x1
+a0305518:	da000003 	ble	a030552c <call_cmd+0x5c>
+a030551c:	e51b3010 	ldr	r3, [fp, -#16]
+a0305520:	e3530006 	cmp	r3, #6	; 0x6
+a0305524:	ca000000 	bgt	a030552c <call_cmd+0x5c>
+a0305528:	ea000002 	b	a0305538 <call_cmd+0x68>
+a030552c:	e3e03000 	mvn	r3, #0	; 0x0
+a0305530:	e50b3018 	str	r3, [fp, -#24]
+a0305534:	ea000064 	b	a03056cc <call_cmd+0x1fc>
+a0305538:	e3a02004 	mov	r2, #4	; 0x4
+a030553c:	e51b3014 	ldr	r3, [fp, -#20]
+a0305540:	e0823003 	add	r3, r2, r3
+a0305544:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0305548:	e5930000 	ldr	r0, [r3]
+a030554c:	e1a01002 	mov	r1, r2
+a0305550:	eb001806 	bl	a030b570 <strtou32>
+a0305554:	e1a03000 	mov	r3, r0
+a0305558:	e50b3018 	str	r3, [fp, -#24]
+a030555c:	e51b3018 	ldr	r3, [fp, -#24]
+a0305560:	e3530000 	cmp	r3, #0	; 0x0
+a0305564:	aa000002 	bge	a0305574 <call_cmd+0xa4>
+a0305568:	e3e03000 	mvn	r3, #0	; 0x0
+a030556c:	e50b3018 	str	r3, [fp, -#24]
+a0305570:	ea000055 	b	a03056cc <call_cmd+0x1fc>
+a0305574:	e51b3010 	ldr	r3, [fp, -#16]
+a0305578:	e3530002 	cmp	r3, #2	; 0x2
+a030557c:	da00000e 	ble	a03055bc <call_cmd+0xec>
+a0305580:	e3a02008 	mov	r2, #8	; 0x8
+a0305584:	e51b3014 	ldr	r3, [fp, -#20]
+a0305588:	e0823003 	add	r3, r2, r3
+a030558c:	e24b2020 	sub	r2, fp, #32	; 0x20
+a0305590:	e5930000 	ldr	r0, [r3]
+a0305594:	e1a01002 	mov	r1, r2
+a0305598:	eb0017f4 	bl	a030b570 <strtou32>
+a030559c:	e1a03000 	mov	r3, r0
+a03055a0:	e50b3018 	str	r3, [fp, -#24]
+a03055a4:	e51b3018 	ldr	r3, [fp, -#24]
+a03055a8:	e3530000 	cmp	r3, #0	; 0x0
+a03055ac:	aa000002 	bge	a03055bc <call_cmd+0xec>
+a03055b0:	e3e03000 	mvn	r3, #0	; 0x0
+a03055b4:	e50b3018 	str	r3, [fp, -#24]
+a03055b8:	ea000043 	b	a03056cc <call_cmd+0x1fc>
+a03055bc:	e51b3010 	ldr	r3, [fp, -#16]
+a03055c0:	e3530003 	cmp	r3, #3	; 0x3
+a03055c4:	da00000e 	ble	a0305604 <call_cmd+0x134>
+a03055c8:	e3a02008 	mov	r2, #8	; 0x8
+a03055cc:	e51b3014 	ldr	r3, [fp, -#20]
+a03055d0:	e0823003 	add	r3, r2, r3
+a03055d4:	e24b2024 	sub	r2, fp, #36	; 0x24
+a03055d8:	e5930000 	ldr	r0, [r3]
+a03055dc:	e1a01002 	mov	r1, r2
+a03055e0:	eb0017e2 	bl	a030b570 <strtou32>
+a03055e4:	e1a03000 	mov	r3, r0
+a03055e8:	e50b3018 	str	r3, [fp, -#24]
+a03055ec:	e51b3018 	ldr	r3, [fp, -#24]
+a03055f0:	e3530000 	cmp	r3, #0	; 0x0
+a03055f4:	aa000002 	bge	a0305604 <call_cmd+0x134>
+a03055f8:	e3e03000 	mvn	r3, #0	; 0x0
+a03055fc:	e50b3018 	str	r3, [fp, -#24]
+a0305600:	ea000031 	b	a03056cc <call_cmd+0x1fc>
+a0305604:	e51b3010 	ldr	r3, [fp, -#16]
+a0305608:	e3530004 	cmp	r3, #4	; 0x4
+a030560c:	da00000e 	ble	a030564c <call_cmd+0x17c>
+a0305610:	e3a02008 	mov	r2, #8	; 0x8
+a0305614:	e51b3014 	ldr	r3, [fp, -#20]
+a0305618:	e0823003 	add	r3, r2, r3
+a030561c:	e24b2028 	sub	r2, fp, #40	; 0x28
+a0305620:	e5930000 	ldr	r0, [r3]
+a0305624:	e1a01002 	mov	r1, r2
+a0305628:	eb0017d0 	bl	a030b570 <strtou32>
+a030562c:	e1a03000 	mov	r3, r0
+a0305630:	e50b3018 	str	r3, [fp, -#24]
+a0305634:	e51b3018 	ldr	r3, [fp, -#24]
+a0305638:	e3530000 	cmp	r3, #0	; 0x0
+a030563c:	aa000002 	bge	a030564c <call_cmd+0x17c>
+a0305640:	e3e03000 	mvn	r3, #0	; 0x0
+a0305644:	e50b3018 	str	r3, [fp, -#24]
+a0305648:	ea00001f 	b	a03056cc <call_cmd+0x1fc>
+a030564c:	e51b3010 	ldr	r3, [fp, -#16]
+a0305650:	e3530005 	cmp	r3, #5	; 0x5
+a0305654:	da00000e 	ble	a0305694 <call_cmd+0x1c4>
+a0305658:	e3a02008 	mov	r2, #8	; 0x8
+a030565c:	e51b3014 	ldr	r3, [fp, -#20]
+a0305660:	e0823003 	add	r3, r2, r3
+a0305664:	e24b202c 	sub	r2, fp, #44	; 0x2c
+a0305668:	e5930000 	ldr	r0, [r3]
+a030566c:	e1a01002 	mov	r1, r2
+a0305670:	eb0017be 	bl	a030b570 <strtou32>
+a0305674:	e1a03000 	mov	r3, r0
+a0305678:	e50b3018 	str	r3, [fp, -#24]
+a030567c:	e51b3018 	ldr	r3, [fp, -#24]
+a0305680:	e3530000 	cmp	r3, #0	; 0x0
+a0305684:	aa000002 	bge	a0305694 <call_cmd+0x1c4>
+a0305688:	e3e03000 	mvn	r3, #0	; 0x0
+a030568c:	e50b3018 	str	r3, [fp, -#24]
+a0305690:	ea00000d 	b	a03056cc <call_cmd+0x1fc>
+a0305694:	eb0015aa 	bl	a030ad44 <serial_flush_output>
+a0305698:	e51b301c 	ldr	r3, [fp, -#28]
+a030569c:	e50b3030 	str	r3, [fp, -#48]
+a03056a0:	e51bc030 	ldr	ip, [fp, -#48]
+a03056a4:	e51b0020 	ldr	r0, [fp, -#32]
+a03056a8:	e51b1024 	ldr	r1, [fp, -#36]
+a03056ac:	e51b2028 	ldr	r2, [fp, -#40]
+a03056b0:	e51b302c 	ldr	r3, [fp, -#44]
+a03056b4:	e1a0e00f 	mov	lr, pc
+a03056b8:	e1a0f00c 	mov	pc, ip
+a03056bc:	e1a03000 	mov	r3, r0
+a03056c0:	e50b3018 	str	r3, [fp, -#24]
+a03056c4:	e3a03000 	mov	r3, #0	; 0x0
+a03056c8:	e50b3018 	str	r3, [fp, -#24]
+a03056cc:	e51b3018 	ldr	r3, [fp, -#24]
+a03056d0:	e1a00003 	mov	r0, r3
+a03056d4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03056d8 <chgbit_cmd>:
+a03056d8:	e1a0c00d 	mov	ip, sp
+a03056dc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03056e0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03056e4:	e24dd014 	sub	sp, sp, #20	; 0x14
+a03056e8:	e50b0010 	str	r0, [fp, -#16]
+a03056ec:	e50b1014 	str	r1, [fp, -#20]
+a03056f0:	e3a03000 	mov	r3, #0	; 0x0
+a03056f4:	e50b3018 	str	r3, [fp, -#24]
+a03056f8:	e51b3010 	ldr	r3, [fp, -#16]
+a03056fc:	e3530003 	cmp	r3, #3	; 0x3
+a0305700:	ca000002 	bgt	a0305710 <chgbit_cmd+0x38>
+a0305704:	e3e03000 	mvn	r3, #0	; 0x0
+a0305708:	e50b3018 	str	r3, [fp, -#24]
+a030570c:	ea000071 	b	a03058d8 <chgbit_cmd+0x200>
+a0305710:	e3a02004 	mov	r2, #4	; 0x4
+a0305714:	e51b3014 	ldr	r3, [fp, -#20]
+a0305718:	e0823003 	add	r3, r2, r3
+a030571c:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0305720:	e5930000 	ldr	r0, [r3]
+a0305724:	e1a01002 	mov	r1, r2
+a0305728:	eb001790 	bl	a030b570 <strtou32>
+a030572c:	e1a03000 	mov	r3, r0
+a0305730:	e50b3018 	str	r3, [fp, -#24]
+a0305734:	e51b3018 	ldr	r3, [fp, -#24]
+a0305738:	e3530000 	cmp	r3, #0	; 0x0
+a030573c:	aa000002 	bge	a030574c <chgbit_cmd+0x74>
+a0305740:	e3e03000 	mvn	r3, #0	; 0x0
+a0305744:	e50b3018 	str	r3, [fp, -#24]
+a0305748:	ea000062 	b	a03058d8 <chgbit_cmd+0x200>
+a030574c:	e3a02008 	mov	r2, #8	; 0x8
+a0305750:	e51b3014 	ldr	r3, [fp, -#20]
+a0305754:	e0823003 	add	r3, r2, r3
+a0305758:	e24b2020 	sub	r2, fp, #32	; 0x20
+a030575c:	e5930000 	ldr	r0, [r3]
+a0305760:	e1a01002 	mov	r1, r2
+a0305764:	eb001781 	bl	a030b570 <strtou32>
+a0305768:	e1a03000 	mov	r3, r0
+a030576c:	e50b3018 	str	r3, [fp, -#24]
+a0305770:	e51b3018 	ldr	r3, [fp, -#24]
+a0305774:	e3530000 	cmp	r3, #0	; 0x0
+a0305778:	aa000002 	bge	a0305788 <chgbit_cmd+0xb0>
+a030577c:	e3e03000 	mvn	r3, #0	; 0x0
+a0305780:	e50b3018 	str	r3, [fp, -#24]
+a0305784:	ea000053 	b	a03058d8 <chgbit_cmd+0x200>
+a0305788:	e51b301c 	ldr	r3, [fp, -#28]
+a030578c:	e2033003 	and	r3, r3, #3	; 0x3
+a0305790:	e50b301c 	str	r3, [fp, -#28]
+a0305794:	e3530000 	cmp	r3, #0	; 0x0
+a0305798:	0a000002 	beq	a03057a8 <chgbit_cmd+0xd0>
+a030579c:	e3e03005 	mvn	r3, #5	; 0x5
+a03057a0:	e50b3018 	str	r3, [fp, -#24]
+a03057a4:	ea00004b 	b	a03058d8 <chgbit_cmd+0x200>
+a03057a8:	e51b301c 	ldr	r3, [fp, -#28]
+a03057ac:	e59f0130 	ldr	r0, [pc, #304]	; a03058e4 <chgbit_cmd+0x20c>
+a03057b0:	e5931000 	ldr	r1, [r3]
+a03057b4:	eb0014b9 	bl	a030aaa0 <printf>
+a03057b8:	e3a0200c 	mov	r2, #12	; 0xc
+a03057bc:	e51b3014 	ldr	r3, [fp, -#20]
+a03057c0:	e0823003 	add	r3, r2, r3
+a03057c4:	e5933000 	ldr	r3, [r3]
+a03057c8:	e5d33000 	ldrb	r3, [r3]
+a03057cc:	e3c33020 	bic	r3, r3, #32	; 0x20
+a03057d0:	e2433041 	sub	r3, r3, #65	; 0x41
+a03057d4:	e3530017 	cmp	r3, #23	; 0x17
+a03057d8:	979ff103 	ldrls	pc, [pc, r3, lsl #2]
+a03057dc:	ea000034 	b	a03058b4 <chgbit_cmd+0x1dc>
+a03057e0:	a0305840 	eorges	r5, r0, r0, asr #16
+a03057e4:	a03058b4 	ldrgeh	r5, [r0], -r4
+a03057e8:	a0305894 	mlages	r0, r4, r8, r5
+a03057ec:	a03058b4 	ldrgeh	r5, [r0], -r4
+a03057f0:	a03058b4 	ldrgeh	r5, [r0], -r4
+a03057f4:	a03058b4 	ldrgeh	r5, [r0], -r4
+a03057f8:	a03058b4 	ldrgeh	r5, [r0], -r4
+a03057fc:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305800:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305804:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305808:	a03058b4 	ldrgeh	r5, [r0], -r4
+a030580c:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305810:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305814:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305818:	a030585c 	eorges	r5, r0, ip, asr r8
+a030581c:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305820:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305824:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305828:	a030585c 	eorges	r5, r0, ip, asr r8
+a030582c:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305830:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305834:	a03058b4 	ldrgeh	r5, [r0], -r4
+a0305838:	a03058b4 	ldrgeh	r5, [r0], -r4
+a030583c:	a0305878 	eorges	r5, r0, r8, ror r8
+a0305840:	e51b101c 	ldr	r1, [fp, -#28]
+a0305844:	e51b301c 	ldr	r3, [fp, -#28]
+a0305848:	e5932000 	ldr	r2, [r3]
+a030584c:	e51b3020 	ldr	r3, [fp, -#32]
+a0305850:	e0023003 	and	r3, r2, r3
+a0305854:	e5813000 	str	r3, [r1]
+a0305858:	ea000018 	b	a03058c0 <chgbit_cmd+0x1e8>
+a030585c:	e51b101c 	ldr	r1, [fp, -#28]
+a0305860:	e51b301c 	ldr	r3, [fp, -#28]
+a0305864:	e5932000 	ldr	r2, [r3]
+a0305868:	e51b3020 	ldr	r3, [fp, -#32]
+a030586c:	e1823003 	orr	r3, r2, r3
+a0305870:	e5813000 	str	r3, [r1]
+a0305874:	ea000011 	b	a03058c0 <chgbit_cmd+0x1e8>
+a0305878:	e51b101c 	ldr	r1, [fp, -#28]
+a030587c:	e51b301c 	ldr	r3, [fp, -#28]
+a0305880:	e5932000 	ldr	r2, [r3]
+a0305884:	e51b3020 	ldr	r3, [fp, -#32]
+a0305888:	e0223003 	eor	r3, r2, r3
+a030588c:	e5813000 	str	r3, [r1]
+a0305890:	ea00000a 	b	a03058c0 <chgbit_cmd+0x1e8>
+a0305894:	e51b001c 	ldr	r0, [fp, -#28]
+a0305898:	e51b101c 	ldr	r1, [fp, -#28]
+a030589c:	e51b3020 	ldr	r3, [fp, -#32]
+a03058a0:	e1e02003 	mvn	r2, r3
+a03058a4:	e5913000 	ldr	r3, [r1]
+a03058a8:	e0033002 	and	r3, r3, r2
+a03058ac:	e5803000 	str	r3, [r0]
+a03058b0:	ea000002 	b	a03058c0 <chgbit_cmd+0x1e8>
+a03058b4:	e3e03000 	mvn	r3, #0	; 0x0
+a03058b8:	e50b3018 	str	r3, [fp, -#24]
+a03058bc:	ea000005 	b	a03058d8 <chgbit_cmd+0x200>
+a03058c0:	e51b301c 	ldr	r3, [fp, -#28]
+a03058c4:	e59f001c 	ldr	r0, [pc, #28]	; a03058e8 <chgbit_cmd+0x210>
+a03058c8:	e5931000 	ldr	r1, [r3]
+a03058cc:	eb001473 	bl	a030aaa0 <printf>
+a03058d0:	e3a03000 	mov	r3, #0	; 0x0
+a03058d4:	e50b3018 	str	r3, [fp, -#24]
+a03058d8:	e51b3018 	ldr	r3, [fp, -#24]
+a03058dc:	e1a00003 	mov	r0, r3
+a03058e0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03058e4:	a030ced8 	ldrgesb	ip, [r0], -r8
+a03058e8:	a030cee0 	eorges	ip, r0, r0, ror #29
+
+a03058ec <dummy_cmd>:
+a03058ec:	e1a0c00d 	mov	ip, sp
+a03058f0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03058f4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03058f8:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a03058fc:	e50b0010 	str	r0, [fp, -#16]
+a0305900:	e50b1014 	str	r1, [fp, -#20]
+a0305904:	e3a03000 	mov	r3, #0	; 0x0
+a0305908:	e50b3018 	str	r3, [fp, -#24]
+a030590c:	e51b2018 	ldr	r2, [fp, -#24]
+a0305910:	e51b3010 	ldr	r3, [fp, -#16]
+a0305914:	e1520003 	cmp	r2, r3
+a0305918:	ba000000 	blt	a0305920 <dummy_cmd+0x34>
+a030591c:	ea00000b 	b	a0305950 <dummy_cmd+0x64>
+a0305920:	e51b3018 	ldr	r3, [fp, -#24]
+a0305924:	e1a02103 	mov	r2, r3, lsl #2
+a0305928:	e51b3014 	ldr	r3, [fp, -#20]
+a030592c:	e0823003 	add	r3, r2, r3
+a0305930:	e59f0024 	ldr	r0, [pc, #36]	; a030595c <dummy_cmd+0x70>
+a0305934:	e51b1018 	ldr	r1, [fp, -#24]
+a0305938:	e5932000 	ldr	r2, [r3]
+a030593c:	eb001457 	bl	a030aaa0 <printf>
+a0305940:	e51b3018 	ldr	r3, [fp, -#24]
+a0305944:	e2833001 	add	r3, r3, #1	; 0x1
+a0305948:	e50b3018 	str	r3, [fp, -#24]
+a030594c:	eaffffee 	b	a030590c <dummy_cmd+0x20>
+a0305950:	e3a03000 	mov	r3, #0	; 0x0
+a0305954:	e1a00003 	mov	r0, r3
+a0305958:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030595c:	a030cef0 	ldrgesh	ip, [r0], -r0
+
+a0305960 <dump_cmd>:
+a0305960:	e1a0c00d 	mov	ip, sp
+a0305964:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0305968:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030596c:	e24dd018 	sub	sp, sp, #24	; 0x18
+a0305970:	e50b0010 	str	r0, [fp, -#16]
+a0305974:	e50b1014 	str	r1, [fp, -#20]
+a0305978:	e3a03000 	mov	r3, #0	; 0x0
+a030597c:	e50b3018 	str	r3, [fp, -#24]
+a0305980:	e51b3010 	ldr	r3, [fp, -#16]
+a0305984:	e3530000 	cmp	r3, #0	; 0x0
+a0305988:	ca000002 	bgt	a0305998 <dump_cmd+0x38>
+a030598c:	e3e03000 	mvn	r3, #0	; 0x0
+a0305990:	e50b3018 	str	r3, [fp, -#24]
+a0305994:	ea000078 	b	a0305b7c <dump_cmd+0x21c>
+a0305998:	e51b3010 	ldr	r3, [fp, -#16]
+a030599c:	e3530001 	cmp	r3, #1	; 0x1
+a03059a0:	da00000d 	ble	a03059dc <dump_cmd+0x7c>
+a03059a4:	e3a02004 	mov	r2, #4	; 0x4
+a03059a8:	e51b3014 	ldr	r3, [fp, -#20]
+a03059ac:	e0823003 	add	r3, r2, r3
+a03059b0:	e5930000 	ldr	r0, [r3]
+a03059b4:	e59f11cc 	ldr	r1, [pc, #460]	; a0305b88 <dump_cmd+0x228>
+a03059b8:	eb0016ec 	bl	a030b570 <strtou32>
+a03059bc:	e1a03000 	mov	r3, r0
+a03059c0:	e50b3018 	str	r3, [fp, -#24]
+a03059c4:	e51b3018 	ldr	r3, [fp, -#24]
+a03059c8:	e3530000 	cmp	r3, #0	; 0x0
+a03059cc:	aa000002 	bge	a03059dc <dump_cmd+0x7c>
+a03059d0:	e3e03000 	mvn	r3, #0	; 0x0
+a03059d4:	e50b3018 	str	r3, [fp, -#24]
+a03059d8:	ea000067 	b	a0305b7c <dump_cmd+0x21c>
+a03059dc:	e51b3010 	ldr	r3, [fp, -#16]
+a03059e0:	e3530003 	cmp	r3, #3	; 0x3
+a03059e4:	1a00000e 	bne	a0305a24 <dump_cmd+0xc4>
+a03059e8:	e3a02008 	mov	r2, #8	; 0x8
+a03059ec:	e51b3014 	ldr	r3, [fp, -#20]
+a03059f0:	e0823003 	add	r3, r2, r3
+a03059f4:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a03059f8:	e5930000 	ldr	r0, [r3]
+a03059fc:	e1a01002 	mov	r1, r2
+a0305a00:	eb0016da 	bl	a030b570 <strtou32>
+a0305a04:	e1a03000 	mov	r3, r0
+a0305a08:	e50b3018 	str	r3, [fp, -#24]
+a0305a0c:	e51b3018 	ldr	r3, [fp, -#24]
+a0305a10:	e3530000 	cmp	r3, #0	; 0x0
+a0305a14:	aa000006 	bge	a0305a34 <dump_cmd+0xd4>
+a0305a18:	e3e03000 	mvn	r3, #0	; 0x0
+a0305a1c:	e50b3018 	str	r3, [fp, -#24]
+a0305a20:	ea000055 	b	a0305b7c <dump_cmd+0x21c>
+a0305a24:	e59f315c 	ldr	r3, [pc, #348]	; a0305b88 <dump_cmd+0x228>
+a0305a28:	e5933000 	ldr	r3, [r3]
+a0305a2c:	e2833080 	add	r3, r3, #128	; 0x80
+a0305a30:	e50b301c 	str	r3, [fp, -#28]
+a0305a34:	e59f314c 	ldr	r3, [pc, #332]	; a0305b88 <dump_cmd+0x228>
+a0305a38:	e5933000 	ldr	r3, [r3]
+a0305a3c:	e2033003 	and	r3, r3, #3	; 0x3
+a0305a40:	e3530000 	cmp	r3, #0	; 0x0
+a0305a44:	1a000004 	bne	a0305a5c <dump_cmd+0xfc>
+a0305a48:	e51b301c 	ldr	r3, [fp, -#28]
+a0305a4c:	e2033003 	and	r3, r3, #3	; 0x3
+a0305a50:	e3530000 	cmp	r3, #0	; 0x0
+a0305a54:	1a000000 	bne	a0305a5c <dump_cmd+0xfc>
+a0305a58:	ea000002 	b	a0305a68 <dump_cmd+0x108>
+a0305a5c:	e3e03005 	mvn	r3, #5	; 0x5
+a0305a60:	e50b3018 	str	r3, [fp, -#24]
+a0305a64:	ea000044 	b	a0305b7c <dump_cmd+0x21c>
+a0305a68:	e1a00000 	nop			(mov r0,r0)
+a0305a6c:	e59f3114 	ldr	r3, [pc, #276]	; a0305b88 <dump_cmd+0x228>
+a0305a70:	e5932000 	ldr	r2, [r3]
+a0305a74:	e51b301c 	ldr	r3, [fp, -#28]
+a0305a78:	e1520003 	cmp	r2, r3
+a0305a7c:	3a000000 	bcc	a0305a84 <dump_cmd+0x124>
+a0305a80:	ea00003b 	b	a0305b74 <dump_cmd+0x214>
+a0305a84:	e59f30fc 	ldr	r3, [pc, #252]	; a0305b88 <dump_cmd+0x228>
+a0305a88:	e59f00fc 	ldr	r0, [pc, #252]	; a0305b8c <dump_cmd+0x22c>
+a0305a8c:	e5931000 	ldr	r1, [r3]
+a0305a90:	eb001402 	bl	a030aaa0 <printf>
+a0305a94:	e59f30ec 	ldr	r3, [pc, #236]	; a0305b88 <dump_cmd+0x228>
+a0305a98:	e5933000 	ldr	r3, [r3]
+a0305a9c:	e50b3020 	str	r3, [fp, -#32]
+a0305aa0:	e59f30e0 	ldr	r3, [pc, #224]	; a0305b88 <dump_cmd+0x228>
+a0305aa4:	e5933000 	ldr	r3, [r3]
+a0305aa8:	e2832010 	add	r2, r3, #16	; 0x10
+a0305aac:	e51b3020 	ldr	r3, [fp, -#32]
+a0305ab0:	e1530002 	cmp	r3, r2
+a0305ab4:	3a000000 	bcc	a0305abc <dump_cmd+0x15c>
+a0305ab8:	ea000009 	b	a0305ae4 <dump_cmd+0x184>
+a0305abc:	e51b3020 	ldr	r3, [fp, -#32]
+a0305ac0:	e5933000 	ldr	r3, [r3]
+a0305ac4:	e50b3024 	str	r3, [fp, -#36]
+a0305ac8:	e59f00c0 	ldr	r0, [pc, #192]	; a0305b90 <dump_cmd+0x230>
+a0305acc:	e51b1024 	ldr	r1, [fp, -#36]
+a0305ad0:	eb0013f2 	bl	a030aaa0 <printf>
+a0305ad4:	e51b3020 	ldr	r3, [fp, -#32]
+a0305ad8:	e2833004 	add	r3, r3, #4	; 0x4
+a0305adc:	e50b3020 	str	r3, [fp, -#32]
+a0305ae0:	eaffffee 	b	a0305aa0 <dump_cmd+0x140>
+a0305ae4:	e59f309c 	ldr	r3, [pc, #156]	; a0305b88 <dump_cmd+0x228>
+a0305ae8:	e5933000 	ldr	r3, [r3]
+a0305aec:	e50b3020 	str	r3, [fp, -#32]
+a0305af0:	e59f3090 	ldr	r3, [pc, #144]	; a0305b88 <dump_cmd+0x228>
+a0305af4:	e5933000 	ldr	r3, [r3]
+a0305af8:	e2832010 	add	r2, r3, #16	; 0x10
+a0305afc:	e51b3020 	ldr	r3, [fp, -#32]
+a0305b00:	e1530002 	cmp	r3, r2
+a0305b04:	3a000000 	bcc	a0305b0c <dump_cmd+0x1ac>
+a0305b08:	ea000011 	b	a0305b54 <dump_cmd+0x1f4>
+a0305b0c:	e51b3020 	ldr	r3, [fp, -#32]
+a0305b10:	e5d33000 	ldrb	r3, [r3]
+a0305b14:	e50b3024 	str	r3, [fp, -#36]
+a0305b18:	e51b3024 	ldr	r3, [fp, -#36]
+a0305b1c:	e353001f 	cmp	r3, #31	; 0x1f
+a0305b20:	9a000005 	bls	a0305b3c <dump_cmd+0x1dc>
+a0305b24:	e51b3024 	ldr	r3, [fp, -#36]
+a0305b28:	e353007e 	cmp	r3, #126	; 0x7e
+a0305b2c:	8a000002 	bhi	a0305b3c <dump_cmd+0x1dc>
+a0305b30:	e51b0024 	ldr	r0, [fp, -#36]
+a0305b34:	eb00143f 	bl	a030ac38 <serial_write>
+a0305b38:	ea000001 	b	a0305b44 <dump_cmd+0x1e4>
+a0305b3c:	e3a0002e 	mov	r0, #46	; 0x2e
+a0305b40:	eb00143c 	bl	a030ac38 <serial_write>
+a0305b44:	e51b3020 	ldr	r3, [fp, -#32]
+a0305b48:	e2833001 	add	r3, r3, #1	; 0x1
+a0305b4c:	e50b3020 	str	r3, [fp, -#32]
+a0305b50:	eaffffe6 	b	a0305af0 <dump_cmd+0x190>
+a0305b54:	e3a0000a 	mov	r0, #10	; 0xa
+a0305b58:	eb001436 	bl	a030ac38 <serial_write>
+a0305b5c:	e59f2024 	ldr	r2, [pc, #36]	; a0305b88 <dump_cmd+0x228>
+a0305b60:	e59f3020 	ldr	r3, [pc, #32]	; a0305b88 <dump_cmd+0x228>
+a0305b64:	e5933000 	ldr	r3, [r3]
+a0305b68:	e2833010 	add	r3, r3, #16	; 0x10
+a0305b6c:	e5823000 	str	r3, [r2]
+a0305b70:	eaffffbd 	b	a0305a6c <dump_cmd+0x10c>
+a0305b74:	e3a03000 	mov	r3, #0	; 0x0
+a0305b78:	e50b3018 	str	r3, [fp, -#24]
+a0305b7c:	e51b3018 	ldr	r3, [fp, -#24]
+a0305b80:	e1a00003 	mov	r0, r3
+a0305b84:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0305b88:	a030d9c4 	eorges	sp, r0, r4, asr #19
+a0305b8c:	a030cf04 	eorges	ip, r0, r4, lsl #30
+a0305b90:	a030cf10 	eorges	ip, r0, r0, lsl pc
+
+a0305b94 <memcpy_cmd>:
+a0305b94:	e1a0c00d 	mov	ip, sp
+a0305b98:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0305b9c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0305ba0:	e24dd018 	sub	sp, sp, #24	; 0x18
+a0305ba4:	e50b0010 	str	r0, [fp, -#16]
+a0305ba8:	e50b1014 	str	r1, [fp, -#20]
+a0305bac:	e3a03000 	mov	r3, #0	; 0x0
+a0305bb0:	e50b3018 	str	r3, [fp, -#24]
+a0305bb4:	e51b3010 	ldr	r3, [fp, -#16]
+a0305bb8:	e3530003 	cmp	r3, #3	; 0x3
+a0305bbc:	ca000002 	bgt	a0305bcc <memcpy_cmd+0x38>
+a0305bc0:	e3e03000 	mvn	r3, #0	; 0x0
+a0305bc4:	e50b3018 	str	r3, [fp, -#24]
+a0305bc8:	ea00004d 	b	a0305d04 <memcpy_cmd+0x170>
+a0305bcc:	e3a02004 	mov	r2, #4	; 0x4
+a0305bd0:	e51b3014 	ldr	r3, [fp, -#20]
+a0305bd4:	e0823003 	add	r3, r2, r3
+a0305bd8:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0305bdc:	e5930000 	ldr	r0, [r3]
+a0305be0:	e1a01002 	mov	r1, r2
+a0305be4:	eb001661 	bl	a030b570 <strtou32>
+a0305be8:	e1a03000 	mov	r3, r0
+a0305bec:	e50b3018 	str	r3, [fp, -#24]
+a0305bf0:	e51b3018 	ldr	r3, [fp, -#24]
+a0305bf4:	e3530000 	cmp	r3, #0	; 0x0
+a0305bf8:	aa000002 	bge	a0305c08 <memcpy_cmd+0x74>
+a0305bfc:	e3e03000 	mvn	r3, #0	; 0x0
+a0305c00:	e50b3018 	str	r3, [fp, -#24]
+a0305c04:	ea00003e 	b	a0305d04 <memcpy_cmd+0x170>
+a0305c08:	e3a02008 	mov	r2, #8	; 0x8
+a0305c0c:	e51b3014 	ldr	r3, [fp, -#20]
+a0305c10:	e0823003 	add	r3, r2, r3
+a0305c14:	e24b2020 	sub	r2, fp, #32	; 0x20
+a0305c18:	e5930000 	ldr	r0, [r3]
+a0305c1c:	e1a01002 	mov	r1, r2
+a0305c20:	eb001652 	bl	a030b570 <strtou32>
+a0305c24:	e1a03000 	mov	r3, r0
+a0305c28:	e50b3018 	str	r3, [fp, -#24]
+a0305c2c:	e51b3018 	ldr	r3, [fp, -#24]
+a0305c30:	e3530000 	cmp	r3, #0	; 0x0
+a0305c34:	aa000002 	bge	a0305c44 <memcpy_cmd+0xb0>
+a0305c38:	e3e03000 	mvn	r3, #0	; 0x0
+a0305c3c:	e50b3018 	str	r3, [fp, -#24]
+a0305c40:	ea00002f 	b	a0305d04 <memcpy_cmd+0x170>
+a0305c44:	e3a0200c 	mov	r2, #12	; 0xc
+a0305c48:	e51b3014 	ldr	r3, [fp, -#20]
+a0305c4c:	e0823003 	add	r3, r2, r3
+a0305c50:	e24b2024 	sub	r2, fp, #36	; 0x24
+a0305c54:	e5930000 	ldr	r0, [r3]
+a0305c58:	e1a01002 	mov	r1, r2
+a0305c5c:	eb001643 	bl	a030b570 <strtou32>
+a0305c60:	e1a03000 	mov	r3, r0
+a0305c64:	e50b3018 	str	r3, [fp, -#24]
+a0305c68:	e51b3018 	ldr	r3, [fp, -#24]
+a0305c6c:	e3530000 	cmp	r3, #0	; 0x0
+a0305c70:	aa000002 	bge	a0305c80 <memcpy_cmd+0xec>
+a0305c74:	e3e03000 	mvn	r3, #0	; 0x0
+a0305c78:	e50b3018 	str	r3, [fp, -#24]
+a0305c7c:	ea000020 	b	a0305d04 <memcpy_cmd+0x170>
+a0305c80:	e51b301c 	ldr	r3, [fp, -#28]
+a0305c84:	e2033003 	and	r3, r3, #3	; 0x3
+a0305c88:	e3530000 	cmp	r3, #0	; 0x0
+a0305c8c:	1a000004 	bne	a0305ca4 <memcpy_cmd+0x110>
+a0305c90:	e51b3020 	ldr	r3, [fp, -#32]
+a0305c94:	e2033003 	and	r3, r3, #3	; 0x3
+a0305c98:	e3530000 	cmp	r3, #0	; 0x0
+a0305c9c:	1a000000 	bne	a0305ca4 <memcpy_cmd+0x110>
+a0305ca0:	ea000002 	b	a0305cb0 <memcpy_cmd+0x11c>
+a0305ca4:	e3e03005 	mvn	r3, #5	; 0x5
+a0305ca8:	e50b3018 	str	r3, [fp, -#24]
+a0305cac:	ea000014 	b	a0305d04 <memcpy_cmd+0x170>
+a0305cb0:	e51b3024 	ldr	r3, [fp, -#36]
+a0305cb4:	e2033003 	and	r3, r3, #3	; 0x3
+a0305cb8:	e3530000 	cmp	r3, #0	; 0x0
+a0305cbc:	0a000004 	beq	a0305cd4 <memcpy_cmd+0x140>
+a0305cc0:	e51b3024 	ldr	r3, [fp, -#36]
+a0305cc4:	e1a03123 	mov	r3, r3, lsr #2
+a0305cc8:	e2833001 	add	r3, r3, #1	; 0x1
+a0305ccc:	e50b3024 	str	r3, [fp, -#36]
+a0305cd0:	ea000002 	b	a0305ce0 <memcpy_cmd+0x14c>
+a0305cd4:	e51b3024 	ldr	r3, [fp, -#36]
+a0305cd8:	e1a03123 	mov	r3, r3, lsr #2
+a0305cdc:	e50b3024 	str	r3, [fp, -#36]
+a0305ce0:	e51b0020 	ldr	r0, [fp, -#32]
+a0305ce4:	e51b101c 	ldr	r1, [fp, -#28]
+a0305ce8:	e51b2024 	ldr	r2, [fp, -#36]
+a0305cec:	eb00170c 	bl	a030b924 <MyMemCpy>
+a0305cf0:	e59f0018 	ldr	r0, [pc, #24]	; a0305d10 <memcpy_cmd+0x17c>
+a0305cf4:	e51b1024 	ldr	r1, [fp, -#36]
+a0305cf8:	eb001368 	bl	a030aaa0 <printf>
+a0305cfc:	e3a03000 	mov	r3, #0	; 0x0
+a0305d00:	e50b3018 	str	r3, [fp, -#24]
+a0305d04:	e51b3018 	ldr	r3, [fp, -#24]
+a0305d08:	e1a00003 	mov	r0, r3
+a0305d0c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0305d10:	a030cf18 	eorges	ip, r0, r8, lsl pc
+
+a0305d14 <peek_cmd>:
+a0305d14:	e1a0c00d 	mov	ip, sp
+a0305d18:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0305d1c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0305d20:	e24dd020 	sub	sp, sp, #32	; 0x20
+a0305d24:	e50b0010 	str	r0, [fp, -#16]
+a0305d28:	e50b1014 	str	r1, [fp, -#20]
+a0305d2c:	e3a03000 	mov	r3, #0	; 0x0
+a0305d30:	e50b3018 	str	r3, [fp, -#24]
+a0305d34:	e3a03077 	mov	r3, #119	; 0x77
+a0305d38:	e54b3021 	strb	r3, [fp, -#33]
+a0305d3c:	e51b3010 	ldr	r3, [fp, -#16]
+a0305d40:	e3530001 	cmp	r3, #1	; 0x1
+a0305d44:	ca000002 	bgt	a0305d54 <peek_cmd+0x40>
+a0305d48:	e3e03000 	mvn	r3, #0	; 0x0
+a0305d4c:	e50b3018 	str	r3, [fp, -#24]
+a0305d50:	ea000062 	b	a0305ee0 <peek_cmd+0x1cc>
+a0305d54:	e3a02004 	mov	r2, #4	; 0x4
+a0305d58:	e51b3014 	ldr	r3, [fp, -#20]
+a0305d5c:	e0823003 	add	r3, r2, r3
+a0305d60:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0305d64:	e5930000 	ldr	r0, [r3]
+a0305d68:	e1a01002 	mov	r1, r2
+a0305d6c:	eb0015ff 	bl	a030b570 <strtou32>
+a0305d70:	e1a03000 	mov	r3, r0
+a0305d74:	e50b3018 	str	r3, [fp, -#24]
+a0305d78:	e51b3018 	ldr	r3, [fp, -#24]
+a0305d7c:	e3530000 	cmp	r3, #0	; 0x0
+a0305d80:	aa000002 	bge	a0305d90 <peek_cmd+0x7c>
+a0305d84:	e3e03000 	mvn	r3, #0	; 0x0
+a0305d88:	e50b3018 	str	r3, [fp, -#24]
+a0305d8c:	ea000053 	b	a0305ee0 <peek_cmd+0x1cc>
+a0305d90:	e51b3010 	ldr	r3, [fp, -#16]
+a0305d94:	e3530001 	cmp	r3, #1	; 0x1
+a0305d98:	da000005 	ble	a0305db4 <peek_cmd+0xa0>
+a0305d9c:	e3a02008 	mov	r2, #8	; 0x8
+a0305da0:	e51b3014 	ldr	r3, [fp, -#20]
+a0305da4:	e0823003 	add	r3, r2, r3
+a0305da8:	e5933000 	ldr	r3, [r3]
+a0305dac:	e5d33000 	ldrb	r3, [r3]
+a0305db0:	e54b3021 	strb	r3, [fp, -#33]
+a0305db4:	e55b3021 	ldrb	r3, [fp, -#33]
+a0305db8:	e3833020 	orr	r3, r3, #32	; 0x20
+a0305dbc:	e20330ff 	and	r3, r3, #255	; 0xff
+a0305dc0:	e50b3028 	str	r3, [fp, -#40]
+a0305dc4:	e51b3028 	ldr	r3, [fp, -#40]
+a0305dc8:	e3530068 	cmp	r3, #104	; 0x68
+a0305dcc:	0a00000a 	beq	a0305dfc <peek_cmd+0xe8>
+a0305dd0:	e51b3028 	ldr	r3, [fp, -#40]
+a0305dd4:	e3530068 	cmp	r3, #104	; 0x68
+a0305dd8:	ca000003 	bgt	a0305dec <peek_cmd+0xd8>
+a0305ddc:	e51b3028 	ldr	r3, [fp, -#40]
+a0305de0:	e3530062 	cmp	r3, #98	; 0x62
+a0305de4:	0a000015 	beq	a0305e40 <peek_cmd+0x12c>
+a0305de8:	ea000011 	b	a0305e34 <peek_cmd+0x120>
+a0305dec:	e51b3028 	ldr	r3, [fp, -#40]
+a0305df0:	e3530077 	cmp	r3, #119	; 0x77
+a0305df4:	0a000007 	beq	a0305e18 <peek_cmd+0x104>
+a0305df8:	ea00000d 	b	a0305e34 <peek_cmd+0x120>
+a0305dfc:	e51b301c 	ldr	r3, [fp, -#28]
+a0305e00:	e2033001 	and	r3, r3, #1	; 0x1
+a0305e04:	e3530000 	cmp	r3, #0	; 0x0
+a0305e08:	0a00000c 	beq	a0305e40 <peek_cmd+0x12c>
+a0305e0c:	e3e03005 	mvn	r3, #5	; 0x5
+a0305e10:	e50b3018 	str	r3, [fp, -#24]
+a0305e14:	ea000031 	b	a0305ee0 <peek_cmd+0x1cc>
+a0305e18:	e51b301c 	ldr	r3, [fp, -#28]
+a0305e1c:	e2033003 	and	r3, r3, #3	; 0x3
+a0305e20:	e3530000 	cmp	r3, #0	; 0x0
+a0305e24:	0a000005 	beq	a0305e40 <peek_cmd+0x12c>
+a0305e28:	e3e03005 	mvn	r3, #5	; 0x5
+a0305e2c:	e50b3018 	str	r3, [fp, -#24]
+a0305e30:	ea00002a 	b	a0305ee0 <peek_cmd+0x1cc>
+a0305e34:	e3e03000 	mvn	r3, #0	; 0x0
+a0305e38:	e50b3018 	str	r3, [fp, -#24]
+a0305e3c:	ea000027 	b	a0305ee0 <peek_cmd+0x1cc>
+a0305e40:	e55b3021 	ldrb	r3, [fp, -#33]
+a0305e44:	e3833020 	orr	r3, r3, #32	; 0x20
+a0305e48:	e20330ff 	and	r3, r3, #255	; 0xff
+a0305e4c:	e50b302c 	str	r3, [fp, -#44]
+a0305e50:	e51b302c 	ldr	r3, [fp, -#44]
+a0305e54:	e3530068 	cmp	r3, #104	; 0x68
+a0305e58:	0a00000e 	beq	a0305e98 <peek_cmd+0x184>
+a0305e5c:	e51b302c 	ldr	r3, [fp, -#44]
+a0305e60:	e3530068 	cmp	r3, #104	; 0x68
+a0305e64:	ca000003 	bgt	a0305e78 <peek_cmd+0x164>
+a0305e68:	e51b302c 	ldr	r3, [fp, -#44]
+a0305e6c:	e3530062 	cmp	r3, #98	; 0x62
+a0305e70:	0a000004 	beq	a0305e88 <peek_cmd+0x174>
+a0305e74:	ea00000f 	b	a0305eb8 <peek_cmd+0x1a4>
+a0305e78:	e51b302c 	ldr	r3, [fp, -#44]
+a0305e7c:	e3530077 	cmp	r3, #119	; 0x77
+a0305e80:	0a000008 	beq	a0305ea8 <peek_cmd+0x194>
+a0305e84:	ea00000b 	b	a0305eb8 <peek_cmd+0x1a4>
+a0305e88:	e51b301c 	ldr	r3, [fp, -#28]
+a0305e8c:	e5d33000 	ldrb	r3, [r3]
+a0305e90:	e50b3020 	str	r3, [fp, -#32]
+a0305e94:	ea00000a 	b	a0305ec4 <peek_cmd+0x1b0>
+a0305e98:	e51b301c 	ldr	r3, [fp, -#28]
+a0305e9c:	e1d330b0 	ldrh	r3, [r3]
+a0305ea0:	e50b3020 	str	r3, [fp, -#32]
+a0305ea4:	ea000006 	b	a0305ec4 <peek_cmd+0x1b0>
+a0305ea8:	e51b301c 	ldr	r3, [fp, -#28]
+a0305eac:	e5933000 	ldr	r3, [r3]
+a0305eb0:	e50b3020 	str	r3, [fp, -#32]
+a0305eb4:	ea000002 	b	a0305ec4 <peek_cmd+0x1b0>
+a0305eb8:	e3e03000 	mvn	r3, #0	; 0x0
+a0305ebc:	e50b3018 	str	r3, [fp, -#24]
+a0305ec0:	ea000006 	b	a0305ee0 <peek_cmd+0x1cc>
+a0305ec4:	e55b3021 	ldrb	r3, [fp, -#33]
+a0305ec8:	e59f001c 	ldr	r0, [pc, #28]	; a0305eec <peek_cmd+0x1d8>
+a0305ecc:	e1a01003 	mov	r1, r3
+a0305ed0:	e51b2020 	ldr	r2, [fp, -#32]
+a0305ed4:	eb0012f1 	bl	a030aaa0 <printf>
+a0305ed8:	e3a03000 	mov	r3, #0	; 0x0
+a0305edc:	e50b3018 	str	r3, [fp, -#24]
+a0305ee0:	e51b3018 	ldr	r3, [fp, -#24]
+a0305ee4:	e1a00003 	mov	r0, r3
+a0305ee8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0305eec:	a030cf2c 	eorges	ip, r0, ip, lsr #30
+
+a0305ef0 <poke_cmd>:
+a0305ef0:	e1a0c00d 	mov	ip, sp
+a0305ef4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0305ef8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0305efc:	e24dd020 	sub	sp, sp, #32	; 0x20
+a0305f00:	e50b0010 	str	r0, [fp, -#16]
+a0305f04:	e50b1014 	str	r1, [fp, -#20]
+a0305f08:	e3a03000 	mov	r3, #0	; 0x0
+a0305f0c:	e50b3018 	str	r3, [fp, -#24]
+a0305f10:	e3a03077 	mov	r3, #119	; 0x77
+a0305f14:	e54b3021 	strb	r3, [fp, -#33]
+a0305f18:	e51b3010 	ldr	r3, [fp, -#16]
+a0305f1c:	e3530002 	cmp	r3, #2	; 0x2
+a0305f20:	ca000002 	bgt	a0305f30 <poke_cmd+0x40>
+a0305f24:	e3e03000 	mvn	r3, #0	; 0x0
+a0305f28:	e50b3018 	str	r3, [fp, -#24]
+a0305f2c:	ea00006c 	b	a03060e4 <poke_cmd+0x1f4>
+a0305f30:	e3a02004 	mov	r2, #4	; 0x4
+a0305f34:	e51b3014 	ldr	r3, [fp, -#20]
+a0305f38:	e0823003 	add	r3, r2, r3
+a0305f3c:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0305f40:	e5930000 	ldr	r0, [r3]
+a0305f44:	e1a01002 	mov	r1, r2
+a0305f48:	eb001588 	bl	a030b570 <strtou32>
+a0305f4c:	e1a03000 	mov	r3, r0
+a0305f50:	e50b3018 	str	r3, [fp, -#24]
+a0305f54:	e51b3018 	ldr	r3, [fp, -#24]
+a0305f58:	e3530000 	cmp	r3, #0	; 0x0
+a0305f5c:	aa000002 	bge	a0305f6c <poke_cmd+0x7c>
+a0305f60:	e3e03000 	mvn	r3, #0	; 0x0
+a0305f64:	e50b3018 	str	r3, [fp, -#24]
+a0305f68:	ea00005d 	b	a03060e4 <poke_cmd+0x1f4>
+a0305f6c:	e3a02008 	mov	r2, #8	; 0x8
+a0305f70:	e51b3014 	ldr	r3, [fp, -#20]
+a0305f74:	e0823003 	add	r3, r2, r3
+a0305f78:	e24b2020 	sub	r2, fp, #32	; 0x20
+a0305f7c:	e5930000 	ldr	r0, [r3]
+a0305f80:	e1a01002 	mov	r1, r2
+a0305f84:	eb001579 	bl	a030b570 <strtou32>
+a0305f88:	e1a03000 	mov	r3, r0
+a0305f8c:	e50b3018 	str	r3, [fp, -#24]
+a0305f90:	e51b3018 	ldr	r3, [fp, -#24]
+a0305f94:	e3530000 	cmp	r3, #0	; 0x0
+a0305f98:	aa000002 	bge	a0305fa8 <poke_cmd+0xb8>
+a0305f9c:	e3e03000 	mvn	r3, #0	; 0x0
+a0305fa0:	e50b3018 	str	r3, [fp, -#24]
+a0305fa4:	ea00004e 	b	a03060e4 <poke_cmd+0x1f4>
+a0305fa8:	e51b3010 	ldr	r3, [fp, -#16]
+a0305fac:	e3530002 	cmp	r3, #2	; 0x2
+a0305fb0:	da000005 	ble	a0305fcc <poke_cmd+0xdc>
+a0305fb4:	e3a0200c 	mov	r2, #12	; 0xc
+a0305fb8:	e51b3014 	ldr	r3, [fp, -#20]
+a0305fbc:	e0823003 	add	r3, r2, r3
+a0305fc0:	e5933000 	ldr	r3, [r3]
+a0305fc4:	e5d33000 	ldrb	r3, [r3]
+a0305fc8:	e54b3021 	strb	r3, [fp, -#33]
+a0305fcc:	e55b3021 	ldrb	r3, [fp, -#33]
+a0305fd0:	e3833020 	orr	r3, r3, #32	; 0x20
+a0305fd4:	e20330ff 	and	r3, r3, #255	; 0xff
+a0305fd8:	e50b3028 	str	r3, [fp, -#40]
+a0305fdc:	e51b3028 	ldr	r3, [fp, -#40]
+a0305fe0:	e3530068 	cmp	r3, #104	; 0x68
+a0305fe4:	0a00000a 	beq	a0306014 <poke_cmd+0x124>
+a0305fe8:	e51b3028 	ldr	r3, [fp, -#40]
+a0305fec:	e3530068 	cmp	r3, #104	; 0x68
+a0305ff0:	ca000003 	bgt	a0306004 <poke_cmd+0x114>
+a0305ff4:	e51b3028 	ldr	r3, [fp, -#40]
+a0305ff8:	e3530062 	cmp	r3, #98	; 0x62
+a0305ffc:	0a000015 	beq	a0306058 <poke_cmd+0x168>
+a0306000:	ea000011 	b	a030604c <poke_cmd+0x15c>
+a0306004:	e51b3028 	ldr	r3, [fp, -#40]
+a0306008:	e3530077 	cmp	r3, #119	; 0x77
+a030600c:	0a000007 	beq	a0306030 <poke_cmd+0x140>
+a0306010:	ea00000d 	b	a030604c <poke_cmd+0x15c>
+a0306014:	e51b301c 	ldr	r3, [fp, -#28]
+a0306018:	e2033001 	and	r3, r3, #1	; 0x1
+a030601c:	e3530000 	cmp	r3, #0	; 0x0
+a0306020:	0a00000c 	beq	a0306058 <poke_cmd+0x168>
+a0306024:	e3e03005 	mvn	r3, #5	; 0x5
+a0306028:	e50b3018 	str	r3, [fp, -#24]
+a030602c:	ea00002c 	b	a03060e4 <poke_cmd+0x1f4>
+a0306030:	e51b301c 	ldr	r3, [fp, -#28]
+a0306034:	e2033003 	and	r3, r3, #3	; 0x3
+a0306038:	e3530000 	cmp	r3, #0	; 0x0
+a030603c:	0a000005 	beq	a0306058 <poke_cmd+0x168>
+a0306040:	e3e03005 	mvn	r3, #5	; 0x5
+a0306044:	e50b3018 	str	r3, [fp, -#24]
+a0306048:	ea000025 	b	a03060e4 <poke_cmd+0x1f4>
+a030604c:	e3e03000 	mvn	r3, #0	; 0x0
+a0306050:	e50b3018 	str	r3, [fp, -#24]
+a0306054:	ea000022 	b	a03060e4 <poke_cmd+0x1f4>
+a0306058:	e55b3021 	ldrb	r3, [fp, -#33]
+a030605c:	e3833020 	orr	r3, r3, #32	; 0x20
+a0306060:	e20330ff 	and	r3, r3, #255	; 0xff
+a0306064:	e50b302c 	str	r3, [fp, -#44]
+a0306068:	e51b302c 	ldr	r3, [fp, -#44]
+a030606c:	e3530068 	cmp	r3, #104	; 0x68
+a0306070:	0a00000e 	beq	a03060b0 <poke_cmd+0x1c0>
+a0306074:	e51b302c 	ldr	r3, [fp, -#44]
+a0306078:	e3530068 	cmp	r3, #104	; 0x68
+a030607c:	ca000003 	bgt	a0306090 <poke_cmd+0x1a0>
+a0306080:	e51b302c 	ldr	r3, [fp, -#44]
+a0306084:	e3530062 	cmp	r3, #98	; 0x62
+a0306088:	0a000004 	beq	a03060a0 <poke_cmd+0x1b0>
+a030608c:	ea00000f 	b	a03060d0 <poke_cmd+0x1e0>
+a0306090:	e51b302c 	ldr	r3, [fp, -#44]
+a0306094:	e3530077 	cmp	r3, #119	; 0x77
+a0306098:	0a000008 	beq	a03060c0 <poke_cmd+0x1d0>
+a030609c:	ea00000b 	b	a03060d0 <poke_cmd+0x1e0>
+a03060a0:	e51b201c 	ldr	r2, [fp, -#28]
+a03060a4:	e55b3020 	ldrb	r3, [fp, -#32]
+a03060a8:	e5c23000 	strb	r3, [r2]
+a03060ac:	ea00000a 	b	a03060dc <poke_cmd+0x1ec>
+a03060b0:	e51b201c 	ldr	r2, [fp, -#28]
+a03060b4:	e15b32b0 	ldrh	r3, [fp, -#32]
+a03060b8:	e1c230b0 	strh	r3, [r2]
+a03060bc:	ea000006 	b	a03060dc <poke_cmd+0x1ec>
+a03060c0:	e51b201c 	ldr	r2, [fp, -#28]
+a03060c4:	e51b3020 	ldr	r3, [fp, -#32]
+a03060c8:	e5823000 	str	r3, [r2]
+a03060cc:	ea000002 	b	a03060dc <poke_cmd+0x1ec>
+a03060d0:	e3e03000 	mvn	r3, #0	; 0x0
+a03060d4:	e50b3018 	str	r3, [fp, -#24]
+a03060d8:	ea000001 	b	a03060e4 <poke_cmd+0x1f4>
+a03060dc:	e3a03000 	mov	r3, #0	; 0x0
+a03060e0:	e50b3018 	str	r3, [fp, -#24]
+a03060e4:	e51b3018 	ldr	r3, [fp, -#24]
+a03060e8:	e1a00003 	mov	r0, r3
+a03060ec:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03060f0 <md5chk_cmd>:
+a03060f0:	e1a0c00d 	mov	ip, sp
+a03060f4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03060f8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03060fc:	e24dd024 	sub	sp, sp, #36	; 0x24
+a0306100:	e50b0010 	str	r0, [fp, -#16]
+a0306104:	e50b1014 	str	r1, [fp, -#20]
+a0306108:	e3a03000 	mov	r3, #0	; 0x0
+a030610c:	e50b3018 	str	r3, [fp, -#24]
+a0306110:	e51b3010 	ldr	r3, [fp, -#16]
+a0306114:	e3530002 	cmp	r3, #2	; 0x2
+a0306118:	ca000002 	bgt	a0306128 <md5chk_cmd+0x38>
+a030611c:	e3e03000 	mvn	r3, #0	; 0x0
+a0306120:	e50b3018 	str	r3, [fp, -#24]
+a0306124:	ea000029 	b	a03061d0 <md5chk_cmd+0xe0>
+a0306128:	e3a02004 	mov	r2, #4	; 0x4
+a030612c:	e51b3014 	ldr	r3, [fp, -#20]
+a0306130:	e0823003 	add	r3, r2, r3
+a0306134:	e24b201c 	sub	r2, fp, #28	; 0x1c
+a0306138:	e5930000 	ldr	r0, [r3]
+a030613c:	e1a01002 	mov	r1, r2
+a0306140:	eb00150a 	bl	a030b570 <strtou32>
+a0306144:	e1a03000 	mov	r3, r0
+a0306148:	e50b3018 	str	r3, [fp, -#24]
+a030614c:	e51b3018 	ldr	r3, [fp, -#24]
+a0306150:	e3530000 	cmp	r3, #0	; 0x0
+a0306154:	aa000002 	bge	a0306164 <md5chk_cmd+0x74>
+a0306158:	e3e03000 	mvn	r3, #0	; 0x0
+a030615c:	e50b3018 	str	r3, [fp, -#24]
+a0306160:	ea00001a 	b	a03061d0 <md5chk_cmd+0xe0>
+a0306164:	e3a02008 	mov	r2, #8	; 0x8
+a0306168:	e51b3014 	ldr	r3, [fp, -#20]
+a030616c:	e0823003 	add	r3, r2, r3
+a0306170:	e24b2020 	sub	r2, fp, #32	; 0x20
+a0306174:	e5930000 	ldr	r0, [r3]
+a0306178:	e1a01002 	mov	r1, r2
+a030617c:	eb0014fb 	bl	a030b570 <strtou32>
+a0306180:	e1a03000 	mov	r3, r0
+a0306184:	e50b3018 	str	r3, [fp, -#24]
+a0306188:	e51b3018 	ldr	r3, [fp, -#24]
+a030618c:	e3530000 	cmp	r3, #0	; 0x0
+a0306190:	aa000002 	bge	a03061a0 <md5chk_cmd+0xb0>
+a0306194:	e3e03000 	mvn	r3, #0	; 0x0
+a0306198:	e50b3018 	str	r3, [fp, -#24]
+a030619c:	ea00000b 	b	a03061d0 <md5chk_cmd+0xe0>
+a03061a0:	e24b3030 	sub	r3, fp, #48	; 0x30
+a03061a4:	e51b001c 	ldr	r0, [fp, -#28]
+a03061a8:	e51b1020 	ldr	r1, [fp, -#32]
+a03061ac:	e1a02003 	mov	r2, r3
+a03061b0:	eb000638 	bl	a0307a98 <md5_buffer>
+a03061b4:	e24b3030 	sub	r3, fp, #48	; 0x30
+a03061b8:	e1a00003 	mov	r0, r3
+a03061bc:	eb000d43 	bl	a03096d0 <print_md5_digest>
+a03061c0:	e3a0000a 	mov	r0, #10	; 0xa
+a03061c4:	eb00129b 	bl	a030ac38 <serial_write>
+a03061c8:	e3a03000 	mov	r3, #0	; 0x0
+a03061cc:	e50b3018 	str	r3, [fp, -#24]
+a03061d0:	e51b3018 	ldr	r3, [fp, -#24]
+a03061d4:	e1a00003 	mov	r0, r3
+a03061d8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03061dc <xdownload_cmd>:
+a03061dc:	e1a0c00d 	mov	ip, sp
+a03061e0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03061e4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03061e8:	e24dd024 	sub	sp, sp, #36	; 0x24
+a03061ec:	e50b0010 	str	r0, [fp, -#16]
+a03061f0:	e50b1014 	str	r1, [fp, -#20]
+a03061f4:	e51b3010 	ldr	r3, [fp, -#16]
+a03061f8:	e3530001 	cmp	r3, #1	; 0x1
+a03061fc:	ca000002 	bgt	a030620c <xdownload_cmd+0x30>
+a0306200:	e3e03001 	mvn	r3, #1	; 0x1
+a0306204:	e50b302c 	str	r3, [fp, -#44]
+a0306208:	ea000070 	b	a03063d0 <xdownload_cmd+0x1f4>
+a030620c:	e3a02004 	mov	r2, #4	; 0x4
+a0306210:	e51b3014 	ldr	r3, [fp, -#20]
+a0306214:	e0822003 	add	r2, r2, r3
+a0306218:	e24b1018 	sub	r1, fp, #24	; 0x18
+a030621c:	e24bc01c 	sub	ip, fp, #28	; 0x1c
+a0306220:	e24be020 	sub	lr, fp, #32	; 0x20
+a0306224:	e24b3028 	sub	r3, fp, #40	; 0x28
+a0306228:	e58d3000 	str	r3, [sp]
+a030622c:	e5920000 	ldr	r0, [r2]
+a0306230:	e1a0200c 	mov	r2, ip
+a0306234:	e1a0300e 	mov	r3, lr
+a0306238:	eb000262 	bl	a0306bc8 <set_download_parameters>
+a030623c:	e1a03000 	mov	r3, r0
+a0306240:	e50b3024 	str	r3, [fp, -#36]
+a0306244:	e51b3024 	ldr	r3, [fp, -#36]
+a0306248:	e3530000 	cmp	r3, #0	; 0x0
+a030624c:	aa000002 	bge	a030625c <xdownload_cmd+0x80>
+a0306250:	e3a03000 	mov	r3, #0	; 0x0
+a0306254:	e50b302c 	str	r3, [fp, -#44]
+a0306258:	ea00005c 	b	a03063d0 <xdownload_cmd+0x1f4>
+a030625c:	e59f3174 	ldr	r3, [pc, #372]	; a03063d8 <xdownload_cmd+0x1fc>
+a0306260:	e59f2170 	ldr	r2, [pc, #368]	; a03063d8 <xdownload_cmd+0x1fc>
+a0306264:	e5931064 	ldr	r1, [r3, #100]
+a0306268:	e5923060 	ldr	r3, [r2, #96]
+a030626c:	e1510003 	cmp	r1, r3
+a0306270:	0a000015 	beq	a03062cc <xdownload_cmd+0xf0>
+a0306274:	e59f0160 	ldr	r0, [pc, #352]	; a03063dc <xdownload_cmd+0x200>
+a0306278:	eb001208 	bl	a030aaa0 <printf>
+a030627c:	e59f3154 	ldr	r3, [pc, #340]	; a03063d8 <xdownload_cmd+0x1fc>
+a0306280:	e5930060 	ldr	r0, [r3, #96]
+a0306284:	eb00023a 	bl	a0306b74 <PrintSerialSpeed>
+a0306288:	e59f0150 	ldr	r0, [pc, #336]	; a03063e0 <xdownload_cmd+0x204>
+a030628c:	eb001203 	bl	a030aaa0 <printf>
+a0306290:	e59f014c 	ldr	r0, [pc, #332]	; a03063e4 <xdownload_cmd+0x208>
+a0306294:	eb001201 	bl	a030aaa0 <printf>
+a0306298:	e59f0148 	ldr	r0, [pc, #328]	; a03063e8 <xdownload_cmd+0x20c>
+a030629c:	eb0011ff 	bl	a030aaa0 <printf>
+a03062a0:	e59f0144 	ldr	r0, [pc, #324]	; a03063ec <xdownload_cmd+0x210>
+a03062a4:	eb0011fd 	bl	a030aaa0 <printf>
+a03062a8:	e59f3128 	ldr	r3, [pc, #296]	; a03063d8 <xdownload_cmd+0x1fc>
+a03062ac:	e5930064 	ldr	r0, [r3, #100]
+a03062b0:	eb00022f 	bl	a0306b74 <PrintSerialSpeed>
+a03062b4:	e59f0134 	ldr	r0, [pc, #308]	; a03063f0 <xdownload_cmd+0x214>
+a03062b8:	eb0011f8 	bl	a030aaa0 <printf>
+a03062bc:	e59f3114 	ldr	r3, [pc, #276]	; a03063d8 <xdownload_cmd+0x1fc>
+a03062c0:	e5930060 	ldr	r0, [r3, #96]
+a03062c4:	eb001240 	bl	a030abcc <serial_init>
+a03062c8:	ea000001 	b	a03062d4 <xdownload_cmd+0xf8>
+a03062cc:	e59f0120 	ldr	r0, [pc, #288]	; a03063f4 <xdownload_cmd+0x218>
+a03062d0:	eb0011f2 	bl	a030aaa0 <printf>
+a03062d4:	e51b0018 	ldr	r0, [fp, -#24]
+a03062d8:	e51b101c 	ldr	r1, [fp, -#28]
+a03062dc:	ebfffab9 	bl	a0304dc8 <XModemReceive>
+a03062e0:	e1a02000 	mov	r2, r0
+a03062e4:	e51b3020 	ldr	r3, [fp, -#32]
+a03062e8:	e5832000 	str	r2, [r3]
+a03062ec:	e3a00064 	mov	r0, #100	; 0x64
+a03062f0:	eb00154a 	bl	a030b820 <msleep>
+a03062f4:	e59f00fc 	ldr	r0, [pc, #252]	; a03063f8 <xdownload_cmd+0x21c>
+a03062f8:	eb0011e8 	bl	a030aaa0 <printf>
+a03062fc:	eb001290 	bl	a030ad44 <serial_flush_output>
+a0306300:	e59f30d0 	ldr	r3, [pc, #208]	; a03063d8 <xdownload_cmd+0x1fc>
+a0306304:	e59f20cc 	ldr	r2, [pc, #204]	; a03063d8 <xdownload_cmd+0x1fc>
+a0306308:	e5931064 	ldr	r1, [r3, #100]
+a030630c:	e5923060 	ldr	r3, [r2, #96]
+a0306310:	e1510003 	cmp	r1, r3
+a0306314:	0a000006 	beq	a0306334 <xdownload_cmd+0x158>
+a0306318:	e59f00dc 	ldr	r0, [pc, #220]	; a03063fc <xdownload_cmd+0x220>
+a030631c:	eb0011df 	bl	a030aaa0 <printf>
+a0306320:	e59f30b0 	ldr	r3, [pc, #176]	; a03063d8 <xdownload_cmd+0x1fc>
+a0306324:	e5930064 	ldr	r0, [r3, #100]
+a0306328:	eb000211 	bl	a0306b74 <PrintSerialSpeed>
+a030632c:	e59f00cc 	ldr	r0, [pc, #204]	; a0306400 <xdownload_cmd+0x224>
+a0306330:	eb0011da 	bl	a030aaa0 <printf>
+a0306334:	e51b3020 	ldr	r3, [fp, -#32]
+a0306338:	e5933000 	ldr	r3, [r3]
+a030633c:	e3530000 	cmp	r3, #0	; 0x0
+a0306340:	aa00000d 	bge	a030637c <xdownload_cmd+0x1a0>
+a0306344:	e51b3020 	ldr	r3, [fp, -#32]
+a0306348:	e5933000 	ldr	r3, [r3]
+a030634c:	e50b3024 	str	r3, [fp, -#36]
+a0306350:	e3a02004 	mov	r2, #4	; 0x4
+a0306354:	e51b3014 	ldr	r3, [fp, -#20]
+a0306358:	e0823003 	add	r3, r2, r3
+a030635c:	e5930000 	ldr	r0, [r3]
+a0306360:	eb000296 	bl	a0306dc0 <do_reload>
+a0306364:	e59f306c 	ldr	r3, [pc, #108]	; a03063d8 <xdownload_cmd+0x1fc>
+a0306368:	e5930064 	ldr	r0, [r3, #100]
+a030636c:	eb001216 	bl	a030abcc <serial_init>
+a0306370:	e51b3024 	ldr	r3, [fp, -#36]
+a0306374:	e50b302c 	str	r3, [fp, -#44]
+a0306378:	ea000014 	b	a03063d0 <xdownload_cmd+0x1f4>
+a030637c:	e51b3020 	ldr	r3, [fp, -#32]
+a0306380:	e51b0018 	ldr	r0, [fp, -#24]
+a0306384:	e5931000 	ldr	r1, [r3]
+a0306388:	e51b2028 	ldr	r2, [fp, -#40]
+a030638c:	eb000306 	bl	a0306fac <do_md5sum>
+a0306390:	e51b3020 	ldr	r3, [fp, -#32]
+a0306394:	e51b2020 	ldr	r2, [fp, -#32]
+a0306398:	e59f0064 	ldr	r0, [pc, #100]	; a0306404 <xdownload_cmd+0x228>
+a030639c:	e5931000 	ldr	r1, [r3]
+a03063a0:	e5922000 	ldr	r2, [r2]
+a03063a4:	eb0011bd 	bl	a030aaa0 <printf>
+a03063a8:	e59f0058 	ldr	r0, [pc, #88]	; a0306408 <xdownload_cmd+0x22c>
+a03063ac:	e51b1018 	ldr	r1, [fp, -#24]
+a03063b0:	eb0011ba 	bl	a030aaa0 <printf>
+a03063b4:	e59f0050 	ldr	r0, [pc, #80]	; a030640c <xdownload_cmd+0x230>
+a03063b8:	eb0011b8 	bl	a030aaa0 <printf>
+a03063bc:	e59f3014 	ldr	r3, [pc, #20]	; a03063d8 <xdownload_cmd+0x1fc>
+a03063c0:	e5930064 	ldr	r0, [r3, #100]
+a03063c4:	eb001200 	bl	a030abcc <serial_init>
+a03063c8:	e3a03000 	mov	r3, #0	; 0x0
+a03063cc:	e50b302c 	str	r3, [fp, -#44]
+a03063d0:	e51b002c 	ldr	r0, [fp, -#44]
+a03063d4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03063d8:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a03063dc:	a030cf38 	eorges	ip, r0, r8, lsr pc
+a03063e0:	a030cf48 	eorges	ip, r0, r8, asr #30
+a03063e4:	a030cf50 	eorges	ip, r0, r0, asr pc
+a03063e8:	a030cf88 	eorges	ip, r0, r8, lsl #31
+a03063ec:	a030cfc8 	eorges	ip, r0, r8, asr #31
+a03063f0:	a030cfe4 	eorges	ip, r0, r4, ror #31
+a03063f4:	a030d010 	eorges	sp, r0, r0, lsl r0
+a03063f8:	a030d054 	eorges	sp, r0, r4, asr r0
+a03063fc:	a030d058 	eorges	sp, r0, r8, asr r0
+a0306400:	a030d088 	eorges	sp, r0, r8, lsl #1
+a0306404:	a030d090 	mlages	r0, r0, r0, sp
+a0306408:	a030d0ac 	eorges	sp, r0, ip, lsr #1
+a030640c:	a030d0b8 	ldrgeh	sp, [r0], -r8
+
+a0306410 <init_commands>:
+a0306410:	e1a0c00d 	mov	ip, sp
+a0306414:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0306418:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030641c:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0306420:	e59f2068 	ldr	r2, [pc, #104]	; a0306490 <init_commands+0x80>
+a0306424:	e59f3068 	ldr	r3, [pc, #104]	; a0306494 <init_commands+0x84>
+a0306428:	e5823000 	str	r3, [r2]
+a030642c:	e59f3064 	ldr	r3, [pc, #100]	; a0306498 <init_commands+0x88>
+a0306430:	e50b3010 	str	r3, [fp, -#16]
+a0306434:	e59f3054 	ldr	r3, [pc, #84]	; a0306490 <init_commands+0x80>
+a0306438:	e5933000 	ldr	r3, [r3]
+a030643c:	e50b3018 	str	r3, [fp, -#24]
+a0306440:	e50b3014 	str	r3, [fp, -#20]
+a0306444:	e51b3018 	ldr	r3, [fp, -#24]
+a0306448:	e2833014 	add	r3, r3, #20	; 0x14
+a030644c:	e50b3018 	str	r3, [fp, -#24]
+a0306450:	e51b2018 	ldr	r2, [fp, -#24]
+a0306454:	e51b3010 	ldr	r3, [fp, -#16]
+a0306458:	e1520003 	cmp	r2, r3
+a030645c:	3a000000 	bcc	a0306464 <init_commands+0x54>
+a0306460:	ea000009 	b	a030648c <init_commands+0x7c>
+a0306464:	e51b2014 	ldr	r2, [fp, -#20]
+a0306468:	e51b3018 	ldr	r3, [fp, -#24]
+a030646c:	e5823010 	str	r3, [r2, #16]
+a0306470:	e51b3014 	ldr	r3, [fp, -#20]
+a0306474:	e2833014 	add	r3, r3, #20	; 0x14
+a0306478:	e50b3014 	str	r3, [fp, -#20]
+a030647c:	e51b3018 	ldr	r3, [fp, -#24]
+a0306480:	e2833014 	add	r3, r3, #20	; 0x14
+a0306484:	e50b3018 	str	r3, [fp, -#24]
+a0306488:	eafffff0 	b	a0306450 <init_commands+0x40>
+a030648c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0306490:	a0310360 	eorges	r0, r1, r0, ror #6
+a0306494:	a030dcb4 	ldrgeh	sp, [r0], -r4
+a0306498:	a030dee4 	eorges	sp, r0, r4, ror #29
+
+a030649c <parse_args>:
+a030649c:	e1a0c00d 	mov	ip, sp
+a03064a0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03064a4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03064a8:	e24dd018 	sub	sp, sp, #24	; 0x18
+a03064ac:	e50b0010 	str	r0, [fp, -#16]
+a03064b0:	e50b1014 	str	r1, [fp, -#20]
+a03064b4:	e50b2018 	str	r2, [fp, -#24]
+a03064b8:	e3a03000 	mov	r3, #0	; 0x0
+a03064bc:	e50b3020 	str	r3, [fp, -#32]
+a03064c0:	e51b2014 	ldr	r2, [fp, -#20]
+a03064c4:	e3a03000 	mov	r3, #0	; 0x0
+a03064c8:	e5823000 	str	r3, [r2]
+a03064cc:	e51b3010 	ldr	r3, [fp, -#16]
+a03064d0:	e5d33000 	ldrb	r3, [r3]
+a03064d4:	e3530000 	cmp	r3, #0	; 0x0
+a03064d8:	1a000000 	bne	a03064e0 <parse_args+0x44>
+a03064dc:	ea00003d 	b	a03065d8 <parse_args+0x13c>
+a03064e0:	e51b3010 	ldr	r3, [fp, -#16]
+a03064e4:	e50b301c 	str	r3, [fp, -#28]
+a03064e8:	e51b301c 	ldr	r3, [fp, -#28]
+a03064ec:	e5d33000 	ldrb	r3, [r3]
+a03064f0:	e3530000 	cmp	r3, #0	; 0x0
+a03064f4:	1a000000 	bne	a03064fc <parse_args+0x60>
+a03064f8:	ea00000a 	b	a0306528 <parse_args+0x8c>
+a03064fc:	e51b301c 	ldr	r3, [fp, -#28]
+a0306500:	e5d33000 	ldrb	r3, [r3]
+a0306504:	e3530009 	cmp	r3, #9	; 0x9
+a0306508:	1a000002 	bne	a0306518 <parse_args+0x7c>
+a030650c:	e51b301c 	ldr	r3, [fp, -#28]
+a0306510:	e3a02020 	mov	r2, #32	; 0x20
+a0306514:	e5c32000 	strb	r2, [r3]
+a0306518:	e51b301c 	ldr	r3, [fp, -#28]
+a030651c:	e2833001 	add	r3, r3, #1	; 0x1
+a0306520:	e50b301c 	str	r3, [fp, -#28]
+a0306524:	eaffffef 	b	a03064e8 <parse_args+0x4c>
+a0306528:	e51b3010 	ldr	r3, [fp, -#16]
+a030652c:	e50b301c 	str	r3, [fp, -#28]
+a0306530:	e3a03000 	mov	r3, #0	; 0x0
+a0306534:	e50b3024 	str	r3, [fp, -#36]
+a0306538:	e51b301c 	ldr	r3, [fp, -#28]
+a030653c:	e5d33000 	ldrb	r3, [r3]
+a0306540:	e3530000 	cmp	r3, #0	; 0x0
+a0306544:	1a000000 	bne	a030654c <parse_args+0xb0>
+a0306548:	ea00001f 	b	a03065cc <parse_args+0x130>
+a030654c:	e51b3020 	ldr	r3, [fp, -#32]
+a0306550:	e3530000 	cmp	r3, #0	; 0x0
+a0306554:	1a00000f 	bne	a0306598 <parse_args+0xfc>
+a0306558:	e51b301c 	ldr	r3, [fp, -#28]
+a030655c:	e5d33000 	ldrb	r3, [r3]
+a0306560:	e3530020 	cmp	r3, #32	; 0x20
+a0306564:	0a000014 	beq	a03065bc <parse_args+0x120>
+a0306568:	e51b3024 	ldr	r3, [fp, -#36]
+a030656c:	e1a02103 	mov	r2, r3, lsl #2
+a0306570:	e51b3018 	ldr	r3, [fp, -#24]
+a0306574:	e0822003 	add	r2, r2, r3
+a0306578:	e51b301c 	ldr	r3, [fp, -#28]
+a030657c:	e5823000 	str	r3, [r2]
+a0306580:	e51b3024 	ldr	r3, [fp, -#36]
+a0306584:	e2833001 	add	r3, r3, #1	; 0x1
+a0306588:	e50b3024 	str	r3, [fp, -#36]
+a030658c:	e3a03001 	mov	r3, #1	; 0x1
+a0306590:	e50b3020 	str	r3, [fp, -#32]
+a0306594:	ea000008 	b	a03065bc <parse_args+0x120>
+a0306598:	e51b301c 	ldr	r3, [fp, -#28]
+a030659c:	e5d33000 	ldrb	r3, [r3]
+a03065a0:	e3530020 	cmp	r3, #32	; 0x20
+a03065a4:	1a000004 	bne	a03065bc <parse_args+0x120>
+a03065a8:	e51b201c 	ldr	r2, [fp, -#28]
+a03065ac:	e3a03000 	mov	r3, #0	; 0x0
+a03065b0:	e5c23000 	strb	r3, [r2]
+a03065b4:	e3a03000 	mov	r3, #0	; 0x0
+a03065b8:	e50b3020 	str	r3, [fp, -#32]
+a03065bc:	e51b301c 	ldr	r3, [fp, -#28]
+a03065c0:	e2833001 	add	r3, r3, #1	; 0x1
+a03065c4:	e50b301c 	str	r3, [fp, -#28]
+a03065c8:	eaffffda 	b	a0306538 <parse_args+0x9c>
+a03065cc:	e51b2014 	ldr	r2, [fp, -#20]
+a03065d0:	e51b3024 	ldr	r3, [fp, -#36]
+a03065d4:	e5823000 	str	r3, [r2]
+a03065d8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03065dc <get_num_command_matches>:
+a03065dc:	e1a0c00d 	mov	ip, sp
+a03065e0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03065e4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03065e8:	e24dd014 	sub	sp, sp, #20	; 0x14
+a03065ec:	e50b0010 	str	r0, [fp, -#16]
+a03065f0:	e3a03000 	mov	r3, #0	; 0x0
+a03065f4:	e50b301c 	str	r3, [fp, -#28]
+a03065f8:	e51b0010 	ldr	r0, [fp, -#16]
+a03065fc:	eb001327 	bl	a030b2a0 <strlen>
+a0306600:	e1a03000 	mov	r3, r0
+a0306604:	e50b3018 	str	r3, [fp, -#24]
+a0306608:	e59f3080 	ldr	r3, [pc, #128]	; a0306690 <get_num_command_matches+0xb4>
+a030660c:	e5933000 	ldr	r3, [r3]
+a0306610:	e50b3014 	str	r3, [fp, -#20]
+a0306614:	e51b3014 	ldr	r3, [fp, -#20]
+a0306618:	e3530000 	cmp	r3, #0	; 0x0
+a030661c:	1a000000 	bne	a0306624 <get_num_command_matches+0x48>
+a0306620:	ea000016 	b	a0306680 <get_num_command_matches+0xa4>
+a0306624:	e51b3014 	ldr	r3, [fp, -#20]
+a0306628:	e5932000 	ldr	r2, [r3]
+a030662c:	e59f3060 	ldr	r3, [pc, #96]	; a0306694 <get_num_command_matches+0xb8>
+a0306630:	e1520003 	cmp	r2, r3
+a0306634:	0a000002 	beq	a0306644 <get_num_command_matches+0x68>
+a0306638:	e3e03002 	mvn	r3, #2	; 0x2
+a030663c:	e50b3020 	str	r3, [fp, -#32]
+a0306640:	ea000010 	b	a0306688 <get_num_command_matches+0xac>
+a0306644:	e51b3014 	ldr	r3, [fp, -#20]
+a0306648:	e5930004 	ldr	r0, [r3, #4]
+a030664c:	e51b1010 	ldr	r1, [fp, -#16]
+a0306650:	e51b2018 	ldr	r2, [fp, -#24]
+a0306654:	eb001327 	bl	a030b2f8 <strncmp>
+a0306658:	e1a03000 	mov	r3, r0
+a030665c:	e3530000 	cmp	r3, #0	; 0x0
+a0306660:	1a000002 	bne	a0306670 <get_num_command_matches+0x94>
+a0306664:	e51b301c 	ldr	r3, [fp, -#28]
+a0306668:	e2833001 	add	r3, r3, #1	; 0x1
+a030666c:	e50b301c 	str	r3, [fp, -#28]
+a0306670:	e51b3014 	ldr	r3, [fp, -#20]
+a0306674:	e5933010 	ldr	r3, [r3, #16]
+a0306678:	e50b3014 	str	r3, [fp, -#20]
+a030667c:	eaffffe4 	b	a0306614 <get_num_command_matches+0x38>
+a0306680:	e51b301c 	ldr	r3, [fp, -#28]
+a0306684:	e50b3020 	str	r3, [fp, -#32]
+a0306688:	e51b0020 	ldr	r0, [fp, -#32]
+a030668c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0306690:	a0310360 	eorges	r0, r1, r0, ror #6
+a0306694:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+
+a0306698 <parse_command>:
+a0306698:	e1a0c00d 	mov	ip, sp
+a030669c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03066a0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03066a4:	e24ddf46 	sub	sp, sp, #280	; 0x118
+a03066a8:	e50b0010 	str	r0, [fp, -#16]
+a03066ac:	e24b3018 	sub	r3, fp, #24	; 0x18
+a03066b0:	e24b2e12 	sub	r2, fp, #288	; 0x120
+a03066b4:	e51b0010 	ldr	r0, [fp, -#16]
+a03066b8:	e1a01003 	mov	r1, r3
+a03066bc:	ebffff76 	bl	a030649c <parse_args>
+a03066c0:	e51b3018 	ldr	r3, [fp, -#24]
+a03066c4:	e3530000 	cmp	r3, #0	; 0x0
+a03066c8:	1a000002 	bne	a03066d8 <parse_command+0x40>
+a03066cc:	e3a03000 	mov	r3, #0	; 0x0
+a03066d0:	e50b3124 	str	r3, [fp, -#292]
+a03066d4:	ea000040 	b	a03067dc <parse_command+0x144>
+a03066d8:	e51b0120 	ldr	r0, [fp, -#288]
+a03066dc:	ebffffbe 	bl	a03065dc <get_num_command_matches>
+a03066e0:	e1a03000 	mov	r3, r0
+a03066e4:	e50b301c 	str	r3, [fp, -#28]
+a03066e8:	e51b301c 	ldr	r3, [fp, -#28]
+a03066ec:	e3530000 	cmp	r3, #0	; 0x0
+a03066f0:	aa000002 	bge	a0306700 <parse_command+0x68>
+a03066f4:	e51b301c 	ldr	r3, [fp, -#28]
+a03066f8:	e50b3124 	str	r3, [fp, -#292]
+a03066fc:	ea000036 	b	a03067dc <parse_command+0x144>
+a0306700:	e51b301c 	ldr	r3, [fp, -#28]
+a0306704:	e3530000 	cmp	r3, #0	; 0x0
+a0306708:	1a000002 	bne	a0306718 <parse_command+0x80>
+a030670c:	e3e03003 	mvn	r3, #3	; 0x3
+a0306710:	e50b3124 	str	r3, [fp, -#292]
+a0306714:	ea000030 	b	a03067dc <parse_command+0x144>
+a0306718:	e51b301c 	ldr	r3, [fp, -#28]
+a030671c:	e3530001 	cmp	r3, #1	; 0x1
+a0306720:	da000002 	ble	a0306730 <parse_command+0x98>
+a0306724:	e3e0300a 	mvn	r3, #10	; 0xa
+a0306728:	e50b3124 	str	r3, [fp, -#292]
+a030672c:	ea00002a 	b	a03067dc <parse_command+0x144>
+a0306730:	e51b0120 	ldr	r0, [fp, -#288]
+a0306734:	eb0012d9 	bl	a030b2a0 <strlen>
+a0306738:	e1a03000 	mov	r3, r0
+a030673c:	e50b3020 	str	r3, [fp, -#32]
+a0306740:	e59f309c 	ldr	r3, [pc, #156]	; a03067e4 <parse_command+0x14c>
+a0306744:	e5933000 	ldr	r3, [r3]
+a0306748:	e50b3014 	str	r3, [fp, -#20]
+a030674c:	e51b3014 	ldr	r3, [fp, -#20]
+a0306750:	e3530000 	cmp	r3, #0	; 0x0
+a0306754:	1a000000 	bne	a030675c <parse_command+0xc4>
+a0306758:	ea00001d 	b	a03067d4 <parse_command+0x13c>
+a030675c:	e51b3014 	ldr	r3, [fp, -#20]
+a0306760:	e5932000 	ldr	r2, [r3]
+a0306764:	e59f307c 	ldr	r3, [pc, #124]	; a03067e8 <parse_command+0x150>
+a0306768:	e1520003 	cmp	r2, r3
+a030676c:	0a000002 	beq	a030677c <parse_command+0xe4>
+a0306770:	e3e03002 	mvn	r3, #2	; 0x2
+a0306774:	e50b3124 	str	r3, [fp, -#292]
+a0306778:	ea000017 	b	a03067dc <parse_command+0x144>
+a030677c:	e51b3014 	ldr	r3, [fp, -#20]
+a0306780:	e5930004 	ldr	r0, [r3, #4]
+a0306784:	e51b1120 	ldr	r1, [fp, -#288]
+a0306788:	e51b2020 	ldr	r2, [fp, -#32]
+a030678c:	eb0012d9 	bl	a030b2f8 <strncmp>
+a0306790:	e1a03000 	mov	r3, r0
+a0306794:	e3530000 	cmp	r3, #0	; 0x0
+a0306798:	1a000009 	bne	a03067c4 <parse_command+0x12c>
+a030679c:	e51b3014 	ldr	r3, [fp, -#20]
+a03067a0:	e24b2e12 	sub	r2, fp, #288	; 0x120
+a03067a4:	e593300c 	ldr	r3, [r3, #12]
+a03067a8:	e51b0018 	ldr	r0, [fp, -#24]
+a03067ac:	e1a01002 	mov	r1, r2
+a03067b0:	e1a0e00f 	mov	lr, pc
+a03067b4:	e1a0f003 	mov	pc, r3
+a03067b8:	e1a03000 	mov	r3, r0
+a03067bc:	e50b3124 	str	r3, [fp, -#292]
+a03067c0:	ea000005 	b	a03067dc <parse_command+0x144>
+a03067c4:	e51b3014 	ldr	r3, [fp, -#20]
+a03067c8:	e5933010 	ldr	r3, [r3, #16]
+a03067cc:	e50b3014 	str	r3, [fp, -#20]
+a03067d0:	eaffffdd 	b	a030674c <parse_command+0xb4>
+a03067d4:	e3e03003 	mvn	r3, #3	; 0x3
+a03067d8:	e50b3124 	str	r3, [fp, -#292]
+a03067dc:	e51b0124 	ldr	r0, [fp, -#292]
+a03067e0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03067e4:	a0310360 	eorges	r0, r1, r0, ror #6
+a03067e8:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+
+a03067ec <help>:
+a03067ec:	e1a0c00d 	mov	ip, sp
+a03067f0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03067f4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03067f8:	e24dd010 	sub	sp, sp, #16	; 0x10
+a03067fc:	e50b0010 	str	r0, [fp, -#16]
+a0306800:	e50b1014 	str	r1, [fp, -#20]
+a0306804:	e51b3010 	ldr	r3, [fp, -#16]
+a0306808:	e3530001 	cmp	r3, #1	; 0x1
+a030680c:	da000023 	ble	a03068a0 <help+0xb4>
+a0306810:	e59f30e4 	ldr	r3, [pc, #228]	; a03068fc <help+0x110>
+a0306814:	e5933000 	ldr	r3, [r3]
+a0306818:	e50b3018 	str	r3, [fp, -#24]
+a030681c:	e51b3018 	ldr	r3, [fp, -#24]
+a0306820:	e3530000 	cmp	r3, #0	; 0x0
+a0306824:	1a000000 	bne	a030682c <help+0x40>
+a0306828:	ea000019 	b	a0306894 <help+0xa8>
+a030682c:	e51b1018 	ldr	r1, [fp, -#24]
+a0306830:	e3a02004 	mov	r2, #4	; 0x4
+a0306834:	e51b3014 	ldr	r3, [fp, -#20]
+a0306838:	e0823003 	add	r3, r2, r3
+a030683c:	e5910004 	ldr	r0, [r1, #4]
+a0306840:	e5931000 	ldr	r1, [r3]
+a0306844:	e3a02c01 	mov	r2, #256	; 0x100
+a0306848:	eb0012aa 	bl	a030b2f8 <strncmp>
+a030684c:	e1a03000 	mov	r3, r0
+a0306850:	e3530000 	cmp	r3, #0	; 0x0
+a0306854:	1a00000a 	bne	a0306884 <help+0x98>
+a0306858:	e3a02004 	mov	r2, #4	; 0x4
+a030685c:	e51b3014 	ldr	r3, [fp, -#20]
+a0306860:	e0823003 	add	r3, r2, r3
+a0306864:	e51b2018 	ldr	r2, [fp, -#24]
+a0306868:	e59f0090 	ldr	r0, [pc, #144]	; a0306900 <help+0x114>
+a030686c:	e5931000 	ldr	r1, [r3]
+a0306870:	e5922008 	ldr	r2, [r2, #8]
+a0306874:	eb001089 	bl	a030aaa0 <printf>
+a0306878:	e3a03000 	mov	r3, #0	; 0x0
+a030687c:	e50b301c 	str	r3, [fp, -#28]
+a0306880:	ea00001b 	b	a03068f4 <help+0x108>
+a0306884:	e51b3018 	ldr	r3, [fp, -#24]
+a0306888:	e5933010 	ldr	r3, [r3, #16]
+a030688c:	e50b3018 	str	r3, [fp, -#24]
+a0306890:	eaffffe1 	b	a030681c <help+0x30>
+a0306894:	e3e03000 	mvn	r3, #0	; 0x0
+a0306898:	e50b301c 	str	r3, [fp, -#28]
+a030689c:	ea000014 	b	a03068f4 <help+0x108>
+a03068a0:	e59f005c 	ldr	r0, [pc, #92]	; a0306904 <help+0x118>
+a03068a4:	eb00107d 	bl	a030aaa0 <printf>
+a03068a8:	e59f304c 	ldr	r3, [pc, #76]	; a03068fc <help+0x110>
+a03068ac:	e5933000 	ldr	r3, [r3]
+a03068b0:	e50b3018 	str	r3, [fp, -#24]
+a03068b4:	e51b3018 	ldr	r3, [fp, -#24]
+a03068b8:	e3530000 	cmp	r3, #0	; 0x0
+a03068bc:	1a000000 	bne	a03068c4 <help+0xd8>
+a03068c0:	ea000007 	b	a03068e4 <help+0xf8>
+a03068c4:	e51b3018 	ldr	r3, [fp, -#24]
+a03068c8:	e59f0038 	ldr	r0, [pc, #56]	; a0306908 <help+0x11c>
+a03068cc:	e5931004 	ldr	r1, [r3, #4]
+a03068d0:	eb001072 	bl	a030aaa0 <printf>
+a03068d4:	e51b3018 	ldr	r3, [fp, -#24]
+a03068d8:	e5933010 	ldr	r3, [r3, #16]
+a03068dc:	e50b3018 	str	r3, [fp, -#24]
+a03068e0:	eafffff3 	b	a03068b4 <help+0xc8>
+a03068e4:	e59f0020 	ldr	r0, [pc, #32]	; a030690c <help+0x120>
+a03068e8:	eb00106c 	bl	a030aaa0 <printf>
+a03068ec:	e3a03000 	mov	r3, #0	; 0x0
+a03068f0:	e50b301c 	str	r3, [fp, -#28]
+a03068f4:	e51b001c 	ldr	r0, [fp, -#28]
+a03068f8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03068fc:	a0310360 	eorges	r0, r1, r0, ror #6
+a0306900:	a030d0bc 	ldrgeh	sp, [r0], -ip
+a0306904:	a030d0d8 	ldrgesb	sp, [r0], -r8
+a0306908:	a030d100 	eorges	sp, r0, r0, lsl #2
+a030690c:	a030d108 	eorges	sp, r0, r8, lsl #2
+
+a0306910 <DisplayPrompt>:
+a0306910:	e1a0c00d 	mov	ip, sp
+a0306914:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0306918:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030691c:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0306920:	e50b0010 	str	r0, [fp, -#16]
+a0306924:	e51b3010 	ldr	r3, [fp, -#16]
+a0306928:	e3530000 	cmp	r3, #0	; 0x0
+a030692c:	1a000002 	bne	a030693c <DisplayPrompt+0x2c>
+a0306930:	e59f0014 	ldr	r0, [pc, #20]	; a030694c <DisplayPrompt+0x3c>
+a0306934:	eb001059 	bl	a030aaa0 <printf>
+a0306938:	ea000002 	b	a0306948 <DisplayPrompt+0x38>
+a030693c:	e59f000c 	ldr	r0, [pc, #12]	; a0306950 <DisplayPrompt+0x40>
+a0306940:	e51b1010 	ldr	r1, [fp, -#16]
+a0306944:	eb001055 	bl	a030aaa0 <printf>
+a0306948:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030694c:	a030d148 	eorges	sp, r0, r8, asr #2
+a0306950:	a030d150 	eorges	sp, r0, r0, asr r1
+
+a0306954 <GetCommand>:
+a0306954:	e1a0c00d 	mov	ip, sp
+a0306958:	e92dd810 	stmdb	sp!, {r4, fp, ip, lr, pc}
+a030695c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0306960:	e24dd028 	sub	sp, sp, #40	; 0x28
+a0306964:	e50b0014 	str	r0, [fp, -#20]
+a0306968:	e50b1018 	str	r1, [fp, -#24]
+a030696c:	e50b201c 	str	r2, [fp, -#28]
+a0306970:	e51b3018 	ldr	r3, [fp, -#24]
+a0306974:	e2433001 	sub	r3, r3, #1	; 0x1
+a0306978:	e50b3034 	str	r3, [fp, -#52]
+a030697c:	eb00138a 	bl	a030b7ac <timer_overflow_clear>
+a0306980:	eb001360 	bl	a030b708 <timer_read>
+a0306984:	e1a03000 	mov	r3, r0
+a0306988:	e50b3020 	str	r3, [fp, -#32]
+a030698c:	e3a03000 	mov	r3, #0	; 0x0
+a0306990:	e50b3030 	str	r3, [fp, -#48]
+a0306994:	e3a03000 	mov	r3, #0	; 0x0
+a0306998:	e50b302c 	str	r3, [fp, -#44]
+a030699c:	e51b2030 	ldr	r2, [fp, -#48]
+a03069a0:	e51b3034 	ldr	r3, [fp, -#52]
+a03069a4:	e1520003 	cmp	r2, r3
+a03069a8:	ba000000 	blt	a03069b0 <GetCommand+0x5c>
+a03069ac:	ea00006a 	b	a0306b5c <GetCommand+0x208>
+a03069b0:	eb0010cb 	bl	a030ace4 <serial_poll>
+a03069b4:	e1a03000 	mov	r3, r0
+a03069b8:	e3530000 	cmp	r3, #0	; 0x0
+a03069bc:	0a000000 	beq	a03069c4 <GetCommand+0x70>
+a03069c0:	ea000017 	b	a0306a24 <GetCommand+0xd0>
+a03069c4:	eb00134f 	bl	a030b708 <timer_read>
+a03069c8:	e1a03000 	mov	r3, r0
+a03069cc:	e50b3024 	str	r3, [fp, -#36]
+a03069d0:	e51b2024 	ldr	r2, [fp, -#36]
+a03069d4:	e51b3020 	ldr	r3, [fp, -#32]
+a03069d8:	e0634002 	rsb	r4, r3, r2
+a03069dc:	eb001386 	bl	a030b7fc <timer_tps>
+a03069e0:	e1a02000 	mov	r2, r0
+a03069e4:	e51b301c 	ldr	r3, [fp, -#28]
+a03069e8:	e0030392 	mul	r3, r2, r3
+a03069ec:	e1540003 	cmp	r4, r3
+a03069f0:	9affffee 	bls	a03069b0 <GetCommand+0x5c>
+a03069f4:	e24b002c 	sub	r0, fp, #44	; 0x2c
+a03069f8:	e5902000 	ldr	r2, [r0]
+a03069fc:	e1a01002 	mov	r1, r2
+a0306a00:	e51b3014 	ldr	r3, [fp, -#20]
+a0306a04:	e0811003 	add	r1, r1, r3
+a0306a08:	e3a03000 	mov	r3, #0	; 0x0
+a0306a0c:	e5c13000 	strb	r3, [r1]
+a0306a10:	e2822001 	add	r2, r2, #1	; 0x1
+a0306a14:	e5802000 	str	r2, [r0]
+a0306a18:	e51b3030 	ldr	r3, [fp, -#48]
+a0306a1c:	e50b3038 	str	r3, [fp, -#56]
+a0306a20:	ea00004f 	b	a0306b64 <GetCommand+0x210>
+a0306a24:	eb001077 	bl	a030ac08 <serial_read>
+a0306a28:	e1a03000 	mov	r3, r0
+a0306a2c:	e50b3028 	str	r3, [fp, -#40]
+a0306a30:	e51b3028 	ldr	r3, [fp, -#40]
+a0306a34:	e3530000 	cmp	r3, #0	; 0x0
+a0306a38:	aa000010 	bge	a0306a80 <GetCommand+0x12c>
+a0306a3c:	e24b002c 	sub	r0, fp, #44	; 0x2c
+a0306a40:	e5902000 	ldr	r2, [r0]
+a0306a44:	e1a01002 	mov	r1, r2
+a0306a48:	e51b3014 	ldr	r3, [fp, -#20]
+a0306a4c:	e0811003 	add	r1, r1, r3
+a0306a50:	e3a03000 	mov	r3, #0	; 0x0
+a0306a54:	e5c13000 	strb	r3, [r1]
+a0306a58:	e2822001 	add	r2, r2, #1	; 0x1
+a0306a5c:	e5802000 	str	r2, [r0]
+a0306a60:	e3a0000a 	mov	r0, #10	; 0xa
+a0306a64:	eb001073 	bl	a030ac38 <serial_write>
+a0306a68:	e51b0028 	ldr	r0, [fp, -#40]
+a0306a6c:	e59f10f8 	ldr	r1, [pc, #248]	; a0306b6c <GetCommand+0x218>
+a0306a70:	eb00026b 	bl	a0307424 <printerror>
+a0306a74:	e51b3028 	ldr	r3, [fp, -#40]
+a0306a78:	e50b3038 	str	r3, [fp, -#56]
+a0306a7c:	ea000038 	b	a0306b64 <GetCommand+0x210>
+a0306a80:	e51b3028 	ldr	r3, [fp, -#40]
+a0306a84:	e353000d 	cmp	r3, #13	; 0xd
+a0306a88:	0a000003 	beq	a0306a9c <GetCommand+0x148>
+a0306a8c:	e51b3028 	ldr	r3, [fp, -#40]
+a0306a90:	e353000a 	cmp	r3, #10	; 0xa
+a0306a94:	0a000000 	beq	a0306a9c <GetCommand+0x148>
+a0306a98:	ea00000d 	b	a0306ad4 <GetCommand+0x180>
+a0306a9c:	e24b002c 	sub	r0, fp, #44	; 0x2c
+a0306aa0:	e5902000 	ldr	r2, [r0]
+a0306aa4:	e1a01002 	mov	r1, r2
+a0306aa8:	e51b3014 	ldr	r3, [fp, -#20]
+a0306aac:	e0811003 	add	r1, r1, r3
+a0306ab0:	e3a03000 	mov	r3, #0	; 0x0
+a0306ab4:	e5c13000 	strb	r3, [r1]
+a0306ab8:	e2822001 	add	r2, r2, #1	; 0x1
+a0306abc:	e5802000 	str	r2, [r0]
+a0306ac0:	e3a0000a 	mov	r0, #10	; 0xa
+a0306ac4:	eb00105b 	bl	a030ac38 <serial_write>
+a0306ac8:	e51b3030 	ldr	r3, [fp, -#48]
+a0306acc:	e50b3038 	str	r3, [fp, -#56]
+a0306ad0:	ea000023 	b	a0306b64 <GetCommand+0x210>
+a0306ad4:	e51b3028 	ldr	r3, [fp, -#40]
+a0306ad8:	e3530008 	cmp	r3, #8	; 0x8
+a0306adc:	0a000003 	beq	a0306af0 <GetCommand+0x19c>
+a0306ae0:	e51b3028 	ldr	r3, [fp, -#40]
+a0306ae4:	e353007f 	cmp	r3, #127	; 0x7f
+a0306ae8:	0a000000 	beq	a0306af0 <GetCommand+0x19c>
+a0306aec:	ea00000b 	b	a0306b20 <GetCommand+0x1cc>
+a0306af0:	e51b302c 	ldr	r3, [fp, -#44]
+a0306af4:	e3530000 	cmp	r3, #0	; 0x0
+a0306af8:	daffffa7 	ble	a030699c <GetCommand+0x48>
+a0306afc:	e51b302c 	ldr	r3, [fp, -#44]
+a0306b00:	e2433001 	sub	r3, r3, #1	; 0x1
+a0306b04:	e50b302c 	str	r3, [fp, -#44]
+a0306b08:	e51b3030 	ldr	r3, [fp, -#48]
+a0306b0c:	e2433001 	sub	r3, r3, #1	; 0x1
+a0306b10:	e50b3030 	str	r3, [fp, -#48]
+a0306b14:	e59f0054 	ldr	r0, [pc, #84]	; a0306b70 <GetCommand+0x21c>
+a0306b18:	eb000fe0 	bl	a030aaa0 <printf>
+a0306b1c:	eaffff9e 	b	a030699c <GetCommand+0x48>
+a0306b20:	e24b002c 	sub	r0, fp, #44	; 0x2c
+a0306b24:	e5902000 	ldr	r2, [r0]
+a0306b28:	e1a01002 	mov	r1, r2
+a0306b2c:	e51b3014 	ldr	r3, [fp, -#20]
+a0306b30:	e0811003 	add	r1, r1, r3
+a0306b34:	e55b3028 	ldrb	r3, [fp, -#40]
+a0306b38:	e5c13000 	strb	r3, [r1]
+a0306b3c:	e2822001 	add	r2, r2, #1	; 0x1
+a0306b40:	e5802000 	str	r2, [r0]
+a0306b44:	e51b3030 	ldr	r3, [fp, -#48]
+a0306b48:	e2833001 	add	r3, r3, #1	; 0x1
+a0306b4c:	e50b3030 	str	r3, [fp, -#48]
+a0306b50:	e51b0028 	ldr	r0, [fp, -#40]
+a0306b54:	eb001037 	bl	a030ac38 <serial_write>
+a0306b58:	eaffff8f 	b	a030699c <GetCommand+0x48>
+a0306b5c:	e51b3030 	ldr	r3, [fp, -#48]
+a0306b60:	e50b3038 	str	r3, [fp, -#56]
+a0306b64:	e51b0038 	ldr	r0, [fp, -#56]
+a0306b68:	e91ba810 	ldmdb	fp, {r4, fp, sp, pc}
+a0306b6c:	a030d154 	eorges	sp, r0, r4, asr r1
+a0306b70:	a030d168 	eorges	sp, r0, r8, ror #2
+
+a0306b74 <PrintSerialSpeed>:
+a0306b74:	e1a0c00d 	mov	ip, sp
+a0306b78:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0306b7c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0306b80:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0306b84:	e50b0010 	str	r0, [fp, -#16]
+a0306b88:	e51b3010 	ldr	r3, [fp, -#16]
+a0306b8c:	e3530008 	cmp	r3, #8	; 0x8
+a0306b90:	9a000002 	bls	a0306ba0 <PrintSerialSpeed+0x2c>
+a0306b94:	e59f0020 	ldr	r0, [pc, #32]	; a0306bbc <PrintSerialSpeed+0x48>
+a0306b98:	eb000fc0 	bl	a030aaa0 <printf>
+a0306b9c:	ea000005 	b	a0306bb8 <PrintSerialSpeed+0x44>
+a0306ba0:	e59f2018 	ldr	r2, [pc, #24]	; a0306bc0 <PrintSerialSpeed+0x4c>
+a0306ba4:	e51b3010 	ldr	r3, [fp, -#16]
+a0306ba8:	e59f0014 	ldr	r0, [pc, #20]	; a0306bc4 <PrintSerialSpeed+0x50>
+a0306bac:	e51b1010 	ldr	r1, [fp, -#16]
+a0306bb0:	e7922103 	ldr	r2, [r2, r3, lsl #2]
+a0306bb4:	eb000fb9 	bl	a030aaa0 <printf>
+a0306bb8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0306bbc:	a030d16c 	eorges	sp, r0, ip, ror #2
+a0306bc0:	a030d488 	eorges	sp, r0, r8, lsl #9
+a0306bc4:	a030d178 	eorges	sp, r0, r8, ror r1
+
+a0306bc8 <set_download_parameters>:
+a0306bc8:	e1a0c00d 	mov	ip, sp
+a0306bcc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0306bd0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0306bd4:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0306bd8:	e50b0010 	str	r0, [fp, -#16]
+a0306bdc:	e50b1014 	str	r1, [fp, -#20]
+a0306be0:	e50b2018 	str	r2, [fp, -#24]
+a0306be4:	e50b301c 	str	r3, [fp, -#28]
+a0306be8:	e51b0010 	ldr	r0, [fp, -#16]
+a0306bec:	e59f119c 	ldr	r1, [pc, #412]	; a0306d90 <set_download_parameters+0x1c8>
+a0306bf0:	e3a02005 	mov	r2, #5	; 0x5
+a0306bf4:	eb0011bf 	bl	a030b2f8 <strncmp>
+a0306bf8:	e1a03000 	mov	r3, r0
+a0306bfc:	e3530000 	cmp	r3, #0	; 0x0
+a0306c00:	1a000010 	bne	a0306c48 <set_download_parameters+0x80>
+a0306c04:	e51b2014 	ldr	r2, [fp, -#20]
+a0306c08:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306c0c:	e2833602 	add	r3, r3, #2097152	; 0x200000
+a0306c10:	e5823000 	str	r3, [r2]
+a0306c14:	e51b2018 	ldr	r2, [fp, -#24]
+a0306c18:	e3a03701 	mov	r3, #262144	; 0x40000
+a0306c1c:	e5823000 	str	r3, [r2]
+a0306c20:	e51b201c 	ldr	r2, [fp, -#28]
+a0306c24:	e59f3168 	ldr	r3, [pc, #360]	; a0306d94 <set_download_parameters+0x1cc>
+a0306c28:	e5823000 	str	r3, [r2]
+a0306c2c:	e59b2004 	ldr	r2, [fp, #4]
+a0306c30:	e59f3160 	ldr	r3, [pc, #352]	; a0306d98 <set_download_parameters+0x1d0>
+a0306c34:	e5823000 	str	r3, [r2]
+a0306c38:	e59f215c 	ldr	r2, [pc, #348]	; a0306d9c <set_download_parameters+0x1d4>
+a0306c3c:	e3a03001 	mov	r3, #1	; 0x1
+a0306c40:	e582304c 	str	r3, [r2, #76]
+a0306c44:	ea00004d 	b	a0306d80 <set_download_parameters+0x1b8>
+a0306c48:	e51b0010 	ldr	r0, [fp, -#16]
+a0306c4c:	e59f114c 	ldr	r1, [pc, #332]	; a0306da0 <set_download_parameters+0x1d8>
+a0306c50:	e3a02006 	mov	r2, #6	; 0x6
+a0306c54:	eb0011a7 	bl	a030b2f8 <strncmp>
+a0306c58:	e1a03000 	mov	r3, r0
+a0306c5c:	e3530000 	cmp	r3, #0	; 0x0
+a0306c60:	1a000010 	bne	a0306ca8 <set_download_parameters+0xe0>
+a0306c64:	e51b2014 	ldr	r2, [fp, -#20]
+a0306c68:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306c6c:	e2833821 	add	r3, r3, #2162688	; 0x210000
+a0306c70:	e5823000 	str	r3, [r2]
+a0306c74:	e51b2018 	ldr	r2, [fp, -#24]
+a0306c78:	e3a03000 	mov	r3, #0	; 0x0
+a0306c7c:	e5823000 	str	r3, [r2]
+a0306c80:	e51b201c 	ldr	r2, [fp, -#28]
+a0306c84:	e59f3118 	ldr	r3, [pc, #280]	; a0306da4 <set_download_parameters+0x1dc>
+a0306c88:	e5823000 	str	r3, [r2]
+a0306c8c:	e59b2004 	ldr	r2, [fp, #4]
+a0306c90:	e59f3110 	ldr	r3, [pc, #272]	; a0306da8 <set_download_parameters+0x1e0>
+a0306c94:	e5823000 	str	r3, [r2]
+a0306c98:	e59f20fc 	ldr	r2, [pc, #252]	; a0306d9c <set_download_parameters+0x1d4>
+a0306c9c:	e3a03001 	mov	r3, #1	; 0x1
+a0306ca0:	e582301c 	str	r3, [r2, #28]
+a0306ca4:	ea000035 	b	a0306d80 <set_download_parameters+0x1b8>
+a0306ca8:	e51b0010 	ldr	r0, [fp, -#16]
+a0306cac:	e59f10f8 	ldr	r1, [pc, #248]	; a0306dac <set_download_parameters+0x1e4>
+a0306cb0:	e3a02007 	mov	r2, #7	; 0x7
+a0306cb4:	eb00118f 	bl	a030b2f8 <strncmp>
+a0306cb8:	e1a03000 	mov	r3, r0
+a0306cbc:	e3530000 	cmp	r3, #0	; 0x0
+a0306cc0:	1a000010 	bne	a0306d08 <set_download_parameters+0x140>
+a0306cc4:	e51b2014 	ldr	r2, [fp, -#20]
+a0306cc8:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306ccc:	e2833902 	add	r3, r3, #32768	; 0x8000
+a0306cd0:	e5823000 	str	r3, [r2]
+a0306cd4:	e51b2018 	ldr	r2, [fp, -#24]
+a0306cd8:	e3a03602 	mov	r3, #2097152	; 0x200000
+a0306cdc:	e5823000 	str	r3, [r2]
+a0306ce0:	e51b201c 	ldr	r2, [fp, -#28]
+a0306ce4:	e59f30b0 	ldr	r3, [pc, #176]	; a0306d9c <set_download_parameters+0x1d4>
+a0306ce8:	e5823000 	str	r3, [r2]
+a0306cec:	e59b2004 	ldr	r2, [fp, #4]
+a0306cf0:	e59f30b8 	ldr	r3, [pc, #184]	; a0306db0 <set_download_parameters+0x1e8>
+a0306cf4:	e5823000 	str	r3, [r2]
+a0306cf8:	e59f209c 	ldr	r2, [pc, #156]	; a0306d9c <set_download_parameters+0x1d4>
+a0306cfc:	e3a03001 	mov	r3, #1	; 0x1
+a0306d00:	e5823004 	str	r3, [r2, #4]
+a0306d04:	ea00001d 	b	a0306d80 <set_download_parameters+0x1b8>
+a0306d08:	e51b0010 	ldr	r0, [fp, -#16]
+a0306d0c:	e59f10a0 	ldr	r1, [pc, #160]	; a0306db4 <set_download_parameters+0x1ec>
+a0306d10:	e3a02008 	mov	r2, #8	; 0x8
+a0306d14:	eb001177 	bl	a030b2f8 <strncmp>
+a0306d18:	e1a03000 	mov	r3, r0
+a0306d1c:	e3530000 	cmp	r3, #0	; 0x0
+a0306d20:	1a000010 	bne	a0306d68 <set_download_parameters+0x1a0>
+a0306d24:	e51b2014 	ldr	r2, [fp, -#20]
+a0306d28:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306d2c:	e2833605 	add	r3, r3, #5242880	; 0x500000
+a0306d30:	e5823000 	str	r3, [r2]
+a0306d34:	e51b2018 	ldr	r2, [fp, -#24]
+a0306d38:	e3a03501 	mov	r3, #4194304	; 0x400000
+a0306d3c:	e5823000 	str	r3, [r2]
+a0306d40:	e51b201c 	ldr	r2, [fp, -#28]
+a0306d44:	e59f306c 	ldr	r3, [pc, #108]	; a0306db8 <set_download_parameters+0x1f0>
+a0306d48:	e5823000 	str	r3, [r2]
+a0306d4c:	e59b2004 	ldr	r2, [fp, #4]
+a0306d50:	e59f3064 	ldr	r3, [pc, #100]	; a0306dbc <set_download_parameters+0x1f4>
+a0306d54:	e5823000 	str	r3, [r2]
+a0306d58:	e59f203c 	ldr	r2, [pc, #60]	; a0306d9c <set_download_parameters+0x1d4>
+a0306d5c:	e3a03001 	mov	r3, #1	; 0x1
+a0306d60:	e5823034 	str	r3, [r2, #52]
+a0306d64:	ea000005 	b	a0306d80 <set_download_parameters+0x1b8>
+a0306d68:	e3e00000 	mvn	r0, #0	; 0x0
+a0306d6c:	e51b1010 	ldr	r1, [fp, -#16]
+a0306d70:	eb0001ab 	bl	a0307424 <printerror>
+a0306d74:	e3e03000 	mvn	r3, #0	; 0x0
+a0306d78:	e50b3020 	str	r3, [fp, -#32]
+a0306d7c:	ea000001 	b	a0306d88 <set_download_parameters+0x1c0>
+a0306d80:	e3a03000 	mov	r3, #0	; 0x0
+a0306d84:	e50b3020 	str	r3, [fp, -#32]
+a0306d88:	e51b0020 	ldr	r0, [fp, -#32]
+a0306d8c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0306d90:	a030d180 	eorges	sp, r0, r0, lsl #3
+a0306d94:	a030fd68 	eorges	pc, r0, r8, ror #26
+a0306d98:	a030fd70 	eorges	pc, r0, r0, ror sp
+a0306d9c:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a0306da0:	a030d188 	eorges	sp, r0, r8, lsl #3
+a0306da4:	a030fd38 	eorges	pc, r0, r8, lsr sp
+a0306da8:	a030fd40 	eorges	pc, r0, r0, asr #26
+a0306dac:	a030d190 	mlages	r0, r0, r1, sp
+a0306db0:	a030fd28 	eorges	pc, r0, r8, lsr #26
+a0306db4:	a030d198 	mlages	r0, r8, r1, sp
+a0306db8:	a030fd50 	eorges	pc, r0, r0, asr sp
+a0306dbc:	a030fd58 	eorges	pc, r0, r8, asr sp
+
+a0306dc0 <do_reload>:
+a0306dc0:	e1a0c00d 	mov	ip, sp
+a0306dc4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0306dc8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0306dcc:	e24dd010 	sub	sp, sp, #16	; 0x10
+a0306dd0:	e50b0010 	str	r0, [fp, -#16]
+a0306dd4:	e3a03000 	mov	r3, #0	; 0x0
+a0306dd8:	e50b3014 	str	r3, [fp, -#20]
+a0306ddc:	e3a03000 	mov	r3, #0	; 0x0
+a0306de0:	e50b3018 	str	r3, [fp, -#24]
+a0306de4:	e51b0010 	ldr	r0, [fp, -#16]
+a0306de8:	e59f1194 	ldr	r1, [pc, #404]	; a0306f84 <do_reload+0x1c4>
+a0306dec:	e3a02005 	mov	r2, #5	; 0x5
+a0306df0:	eb001140 	bl	a030b2f8 <strncmp>
+a0306df4:	e1a03000 	mov	r3, r0
+a0306df8:	e3530000 	cmp	r3, #0	; 0x0
+a0306dfc:	1a00000f 	bne	a0306e40 <do_reload+0x80>
+a0306e00:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306e04:	e2833602 	add	r3, r3, #2097152	; 0x200000
+a0306e08:	e50b3014 	str	r3, [fp, -#20]
+a0306e0c:	e3a03000 	mov	r3, #0	; 0x0
+a0306e10:	e50b3018 	str	r3, [fp, -#24]
+a0306e14:	e3a03801 	mov	r3, #65536	; 0x10000
+a0306e18:	e50b301c 	str	r3, [fp, -#28]
+a0306e1c:	e59f2164 	ldr	r2, [pc, #356]	; a0306f88 <do_reload+0x1c8>
+a0306e20:	e3a03000 	mov	r3, #0	; 0x0
+a0306e24:	e5823048 	str	r3, [r2, #72]
+a0306e28:	e59f2158 	ldr	r2, [pc, #344]	; a0306f88 <do_reload+0x1c8>
+a0306e2c:	e3a03000 	mov	r3, #0	; 0x0
+a0306e30:	e582304c 	str	r3, [r2, #76]
+a0306e34:	e59f0150 	ldr	r0, [pc, #336]	; a0306f8c <do_reload+0x1cc>
+a0306e38:	eb000f18 	bl	a030aaa0 <printf>
+a0306e3c:	ea000048 	b	a0306f64 <do_reload+0x1a4>
+a0306e40:	e51b0010 	ldr	r0, [fp, -#16]
+a0306e44:	e59f1144 	ldr	r1, [pc, #324]	; a0306f90 <do_reload+0x1d0>
+a0306e48:	e3a02006 	mov	r2, #6	; 0x6
+a0306e4c:	eb001129 	bl	a030b2f8 <strncmp>
+a0306e50:	e1a03000 	mov	r3, r0
+a0306e54:	e3530000 	cmp	r3, #0	; 0x0
+a0306e58:	1a00000f 	bne	a0306e9c <do_reload+0xdc>
+a0306e5c:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306e60:	e2833821 	add	r3, r3, #2162688	; 0x210000
+a0306e64:	e50b3014 	str	r3, [fp, -#20]
+a0306e68:	e3a03701 	mov	r3, #262144	; 0x40000
+a0306e6c:	e50b3018 	str	r3, [fp, -#24]
+a0306e70:	e3a03000 	mov	r3, #0	; 0x0
+a0306e74:	e50b301c 	str	r3, [fp, -#28]
+a0306e78:	e59f2108 	ldr	r2, [pc, #264]	; a0306f88 <do_reload+0x1c8>
+a0306e7c:	e3a03000 	mov	r3, #0	; 0x0
+a0306e80:	e5823018 	str	r3, [r2, #24]
+a0306e84:	e59f20fc 	ldr	r2, [pc, #252]	; a0306f88 <do_reload+0x1c8>
+a0306e88:	e3a03000 	mov	r3, #0	; 0x0
+a0306e8c:	e582301c 	str	r3, [r2, #28]
+a0306e90:	e59f00fc 	ldr	r0, [pc, #252]	; a0306f94 <do_reload+0x1d4>
+a0306e94:	eb000f01 	bl	a030aaa0 <printf>
+a0306e98:	ea000031 	b	a0306f64 <do_reload+0x1a4>
+a0306e9c:	e51b0010 	ldr	r0, [fp, -#16]
+a0306ea0:	e59f10f0 	ldr	r1, [pc, #240]	; a0306f98 <do_reload+0x1d8>
+a0306ea4:	e3a02007 	mov	r2, #7	; 0x7
+a0306ea8:	eb001112 	bl	a030b2f8 <strncmp>
+a0306eac:	e1a03000 	mov	r3, r0
+a0306eb0:	e3530000 	cmp	r3, #0	; 0x0
+a0306eb4:	1a00000f 	bne	a0306ef8 <do_reload+0x138>
+a0306eb8:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306ebc:	e2833902 	add	r3, r3, #32768	; 0x8000
+a0306ec0:	e50b3014 	str	r3, [fp, -#20]
+a0306ec4:	e3a03701 	mov	r3, #262144	; 0x40000
+a0306ec8:	e50b3018 	str	r3, [fp, -#24]
+a0306ecc:	e3a03702 	mov	r3, #524288	; 0x80000
+a0306ed0:	e50b301c 	str	r3, [fp, -#28]
+a0306ed4:	e59f20ac 	ldr	r2, [pc, #172]	; a0306f88 <do_reload+0x1c8>
+a0306ed8:	e3a03000 	mov	r3, #0	; 0x0
+a0306edc:	e5823000 	str	r3, [r2]
+a0306ee0:	e59f20a0 	ldr	r2, [pc, #160]	; a0306f88 <do_reload+0x1c8>
+a0306ee4:	e3a03000 	mov	r3, #0	; 0x0
+a0306ee8:	e5823004 	str	r3, [r2, #4]
+a0306eec:	e59f00a8 	ldr	r0, [pc, #168]	; a0306f9c <do_reload+0x1dc>
+a0306ef0:	eb000eea 	bl	a030aaa0 <printf>
+a0306ef4:	ea00001a 	b	a0306f64 <do_reload+0x1a4>
+a0306ef8:	e51b0010 	ldr	r0, [fp, -#16]
+a0306efc:	e59f109c 	ldr	r1, [pc, #156]	; a0306fa0 <do_reload+0x1e0>
+a0306f00:	e3a02008 	mov	r2, #8	; 0x8
+a0306f04:	eb0010fb 	bl	a030b2f8 <strncmp>
+a0306f08:	e1a03000 	mov	r3, r0
+a0306f0c:	e3530000 	cmp	r3, #0	; 0x0
+a0306f10:	1a00000f 	bne	a0306f54 <do_reload+0x194>
+a0306f14:	e3a0320a 	mov	r3, #-1610612736	; 0xa0000000
+a0306f18:	e2833605 	add	r3, r3, #5242880	; 0x500000
+a0306f1c:	e50b3014 	str	r3, [fp, -#20]
+a0306f20:	e3a03709 	mov	r3, #2359296	; 0x240000
+a0306f24:	e50b3018 	str	r3, [fp, -#24]
+a0306f28:	e3a03601 	mov	r3, #1048576	; 0x100000
+a0306f2c:	e50b301c 	str	r3, [fp, -#28]
+a0306f30:	e59f2050 	ldr	r2, [pc, #80]	; a0306f88 <do_reload+0x1c8>
+a0306f34:	e3a03000 	mov	r3, #0	; 0x0
+a0306f38:	e5823030 	str	r3, [r2, #48]
+a0306f3c:	e59f2044 	ldr	r2, [pc, #68]	; a0306f88 <do_reload+0x1c8>
+a0306f40:	e3a03000 	mov	r3, #0	; 0x0
+a0306f44:	e5823034 	str	r3, [r2, #52]
+a0306f48:	e59f0054 	ldr	r0, [pc, #84]	; a0306fa4 <do_reload+0x1e4>
+a0306f4c:	eb000ed3 	bl	a030aaa0 <printf>
+a0306f50:	ea000003 	b	a0306f64 <do_reload+0x1a4>
+a0306f54:	e3a00001 	mov	r0, #1	; 0x1
+a0306f58:	e51b1010 	ldr	r1, [fp, -#16]
+a0306f5c:	eb000130 	bl	a0307424 <printerror>
+a0306f60:	ea000005 	b	a0306f7c <do_reload+0x1bc>
+a0306f64:	e51b0014 	ldr	r0, [fp, -#20]
+a0306f68:	e51b1018 	ldr	r1, [fp, -#24]
+a0306f6c:	e51b201c 	ldr	r2, [fp, -#28]
+a0306f70:	eb00126b 	bl	a030b924 <MyMemCpy>
+a0306f74:	e59f002c 	ldr	r0, [pc, #44]	; a0306fa8 <do_reload+0x1e8>
+a0306f78:	eb000ec8 	bl	a030aaa0 <printf>
+a0306f7c:	e3a00000 	mov	r0, #0	; 0x0
+a0306f80:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0306f84:	a030d180 	eorges	sp, r0, r0, lsl #3
+a0306f88:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a0306f8c:	a030d1a0 	eorges	sp, r0, r0, lsr #3
+a0306f90:	a030d188 	eorges	sp, r0, r8, lsl #3
+a0306f94:	a030d1bc 	ldrgeh	sp, [r0], -ip
+a0306f98:	a030d190 	mlages	r0, r0, r1, sp
+a0306f9c:	a030d1e0 	eorges	sp, r0, r0, ror #3
+a0306fa0:	a030d198 	mlages	r0, r8, r1, sp
+a0306fa4:	a030d1fc 	ldrgesh	sp, [r0], -ip
+a0306fa8:	a030d218 	eorges	sp, r0, r8, lsl r2
+
+a0306fac <do_md5sum>:
+a0306fac:	e1a0c00d 	mov	ip, sp
+a0306fb0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0306fb4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0306fb8:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0306fbc:	e50b0010 	str	r0, [fp, -#16]
+a0306fc0:	e50b1014 	str	r1, [fp, -#20]
+a0306fc4:	e50b2018 	str	r2, [fp, -#24]
+a0306fc8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0306fcc <SetDownloadSpeed>:
+a0306fcc:	e1a0c00d 	mov	ip, sp
+a0306fd0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0306fd4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0306fd8:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0306fdc:	e50b0010 	str	r0, [fp, -#16]
+a0306fe0:	e50b1014 	str	r1, [fp, -#20]
+a0306fe4:	e51b3010 	ldr	r3, [fp, -#16]
+a0306fe8:	e3530001 	cmp	r3, #1	; 0x1
+a0306fec:	ca000002 	bgt	a0306ffc <SetDownloadSpeed+0x30>
+a0306ff0:	e3e03001 	mvn	r3, #1	; 0x1
+a0306ff4:	e50b3018 	str	r3, [fp, -#24]
+a0306ff8:	ea0000cf 	b	a030733c <SetDownloadSpeed+0x370>
+a0306ffc:	e3a02004 	mov	r2, #4	; 0x4
+a0307000:	e51b3014 	ldr	r3, [fp, -#20]
+a0307004:	e0823003 	add	r3, r2, r3
+a0307008:	e5930000 	ldr	r0, [r3]
+a030700c:	e59f1330 	ldr	r1, [pc, #816]	; a0307344 <SetDownloadSpeed+0x378>
+a0307010:	e3a02005 	mov	r2, #5	; 0x5
+a0307014:	eb0010b7 	bl	a030b2f8 <strncmp>
+a0307018:	e1a03000 	mov	r3, r0
+a030701c:	e3530000 	cmp	r3, #0	; 0x0
+a0307020:	1a000003 	bne	a0307034 <SetDownloadSpeed+0x68>
+a0307024:	e59f231c 	ldr	r2, [pc, #796]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307028:	e3a03000 	mov	r3, #0	; 0x0
+a030702c:	e5823060 	str	r3, [r2, #96]
+a0307030:	ea0000b8 	b	a0307318 <SetDownloadSpeed+0x34c>
+a0307034:	e3a02004 	mov	r2, #4	; 0x4
+a0307038:	e51b3014 	ldr	r3, [fp, -#20]
+a030703c:	e0823003 	add	r3, r2, r3
+a0307040:	e5930000 	ldr	r0, [r3]
+a0307044:	e59f1300 	ldr	r1, [pc, #768]	; a030734c <SetDownloadSpeed+0x380>
+a0307048:	e3a02004 	mov	r2, #4	; 0x4
+a030704c:	eb0010a9 	bl	a030b2f8 <strncmp>
+a0307050:	e1a03000 	mov	r3, r0
+a0307054:	e3530000 	cmp	r3, #0	; 0x0
+a0307058:	1a000003 	bne	a030706c <SetDownloadSpeed+0xa0>
+a030705c:	e59f22e4 	ldr	r2, [pc, #740]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307060:	e3a03000 	mov	r3, #0	; 0x0
+a0307064:	e5823060 	str	r3, [r2, #96]
+a0307068:	ea0000aa 	b	a0307318 <SetDownloadSpeed+0x34c>
+a030706c:	e3a02004 	mov	r2, #4	; 0x4
+a0307070:	e51b3014 	ldr	r3, [fp, -#20]
+a0307074:	e0823003 	add	r3, r2, r3
+a0307078:	e5930000 	ldr	r0, [r3]
+a030707c:	e59f12cc 	ldr	r1, [pc, #716]	; a0307350 <SetDownloadSpeed+0x384>
+a0307080:	e3a02005 	mov	r2, #5	; 0x5
+a0307084:	eb00109b 	bl	a030b2f8 <strncmp>
+a0307088:	e1a03000 	mov	r3, r0
+a030708c:	e3530000 	cmp	r3, #0	; 0x0
+a0307090:	1a000003 	bne	a03070a4 <SetDownloadSpeed+0xd8>
+a0307094:	e59f22ac 	ldr	r2, [pc, #684]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307098:	e3a03003 	mov	r3, #3	; 0x3
+a030709c:	e5823060 	str	r3, [r2, #96]
+a03070a0:	ea00009c 	b	a0307318 <SetDownloadSpeed+0x34c>
+a03070a4:	e3a02004 	mov	r2, #4	; 0x4
+a03070a8:	e51b3014 	ldr	r3, [fp, -#20]
+a03070ac:	e0823003 	add	r3, r2, r3
+a03070b0:	e5930000 	ldr	r0, [r3]
+a03070b4:	e59f1298 	ldr	r1, [pc, #664]	; a0307354 <SetDownloadSpeed+0x388>
+a03070b8:	e3a02004 	mov	r2, #4	; 0x4
+a03070bc:	eb00108d 	bl	a030b2f8 <strncmp>
+a03070c0:	e1a03000 	mov	r3, r0
+a03070c4:	e3530000 	cmp	r3, #0	; 0x0
+a03070c8:	1a000003 	bne	a03070dc <SetDownloadSpeed+0x110>
+a03070cc:	e59f2274 	ldr	r2, [pc, #628]	; a0307348 <SetDownloadSpeed+0x37c>
+a03070d0:	e3a03003 	mov	r3, #3	; 0x3
+a03070d4:	e5823060 	str	r3, [r2, #96]
+a03070d8:	ea00008e 	b	a0307318 <SetDownloadSpeed+0x34c>
+a03070dc:	e3a02004 	mov	r2, #4	; 0x4
+a03070e0:	e51b3014 	ldr	r3, [fp, -#20]
+a03070e4:	e0823003 	add	r3, r2, r3
+a03070e8:	e5930000 	ldr	r0, [r3]
+a03070ec:	e59f1264 	ldr	r1, [pc, #612]	; a0307358 <SetDownloadSpeed+0x38c>
+a03070f0:	e3a02006 	mov	r2, #6	; 0x6
+a03070f4:	eb00107f 	bl	a030b2f8 <strncmp>
+a03070f8:	e1a03000 	mov	r3, r0
+a03070fc:	e3530000 	cmp	r3, #0	; 0x0
+a0307100:	1a000003 	bne	a0307114 <SetDownloadSpeed+0x148>
+a0307104:	e59f223c 	ldr	r2, [pc, #572]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307108:	e3a03004 	mov	r3, #4	; 0x4
+a030710c:	e5823060 	str	r3, [r2, #96]
+a0307110:	ea000080 	b	a0307318 <SetDownloadSpeed+0x34c>
+a0307114:	e3a02004 	mov	r2, #4	; 0x4
+a0307118:	e51b3014 	ldr	r3, [fp, -#20]
+a030711c:	e0823003 	add	r3, r2, r3
+a0307120:	e5930000 	ldr	r0, [r3]
+a0307124:	e59f1230 	ldr	r1, [pc, #560]	; a030735c <SetDownloadSpeed+0x390>
+a0307128:	e3a02005 	mov	r2, #5	; 0x5
+a030712c:	eb001071 	bl	a030b2f8 <strncmp>
+a0307130:	e1a03000 	mov	r3, r0
+a0307134:	e3530000 	cmp	r3, #0	; 0x0
+a0307138:	1a000003 	bne	a030714c <SetDownloadSpeed+0x180>
+a030713c:	e59f2204 	ldr	r2, [pc, #516]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307140:	e3a03004 	mov	r3, #4	; 0x4
+a0307144:	e5823060 	str	r3, [r2, #96]
+a0307148:	ea000072 	b	a0307318 <SetDownloadSpeed+0x34c>
+a030714c:	e3a02004 	mov	r2, #4	; 0x4
+a0307150:	e51b3014 	ldr	r3, [fp, -#20]
+a0307154:	e0823003 	add	r3, r2, r3
+a0307158:	e5930000 	ldr	r0, [r3]
+a030715c:	e59f11fc 	ldr	r1, [pc, #508]	; a0307360 <SetDownloadSpeed+0x394>
+a0307160:	e3a02007 	mov	r2, #7	; 0x7
+a0307164:	eb001063 	bl	a030b2f8 <strncmp>
+a0307168:	e1a03000 	mov	r3, r0
+a030716c:	e3530000 	cmp	r3, #0	; 0x0
+a0307170:	1a000003 	bne	a0307184 <SetDownloadSpeed+0x1b8>
+a0307174:	e59f21cc 	ldr	r2, [pc, #460]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307178:	e3a03005 	mov	r3, #5	; 0x5
+a030717c:	e5823060 	str	r3, [r2, #96]
+a0307180:	ea000064 	b	a0307318 <SetDownloadSpeed+0x34c>
+a0307184:	e3a02004 	mov	r2, #4	; 0x4
+a0307188:	e51b3014 	ldr	r3, [fp, -#20]
+a030718c:	e0823003 	add	r3, r2, r3
+a0307190:	e5930000 	ldr	r0, [r3]
+a0307194:	e59f11c8 	ldr	r1, [pc, #456]	; a0307364 <SetDownloadSpeed+0x398>
+a0307198:	e3a02005 	mov	r2, #5	; 0x5
+a030719c:	eb001055 	bl	a030b2f8 <strncmp>
+a03071a0:	e1a03000 	mov	r3, r0
+a03071a4:	e3530000 	cmp	r3, #0	; 0x0
+a03071a8:	1a000003 	bne	a03071bc <SetDownloadSpeed+0x1f0>
+a03071ac:	e59f2194 	ldr	r2, [pc, #404]	; a0307348 <SetDownloadSpeed+0x37c>
+a03071b0:	e3a03005 	mov	r3, #5	; 0x5
+a03071b4:	e5823060 	str	r3, [r2, #96]
+a03071b8:	ea000056 	b	a0307318 <SetDownloadSpeed+0x34c>
+a03071bc:	e3a02004 	mov	r2, #4	; 0x4
+a03071c0:	e51b3014 	ldr	r3, [fp, -#20]
+a03071c4:	e0823003 	add	r3, r2, r3
+a03071c8:	e5930000 	ldr	r0, [r3]
+a03071cc:	e59f1194 	ldr	r1, [pc, #404]	; a0307368 <SetDownloadSpeed+0x39c>
+a03071d0:	e3a02006 	mov	r2, #6	; 0x6
+a03071d4:	eb001047 	bl	a030b2f8 <strncmp>
+a03071d8:	e1a03000 	mov	r3, r0
+a03071dc:	e3530000 	cmp	r3, #0	; 0x0
+a03071e0:	1a000003 	bne	a03071f4 <SetDownloadSpeed+0x228>
+a03071e4:	e59f215c 	ldr	r2, [pc, #348]	; a0307348 <SetDownloadSpeed+0x37c>
+a03071e8:	e3a03006 	mov	r3, #6	; 0x6
+a03071ec:	e5823060 	str	r3, [r2, #96]
+a03071f0:	ea000048 	b	a0307318 <SetDownloadSpeed+0x34c>
+a03071f4:	e3a02004 	mov	r2, #4	; 0x4
+a03071f8:	e51b3014 	ldr	r3, [fp, -#20]
+a03071fc:	e0823003 	add	r3, r2, r3
+a0307200:	e5930000 	ldr	r0, [r3]
+a0307204:	e59f1160 	ldr	r1, [pc, #352]	; a030736c <SetDownloadSpeed+0x3a0>
+a0307208:	e3a02005 	mov	r2, #5	; 0x5
+a030720c:	eb001039 	bl	a030b2f8 <strncmp>
+a0307210:	e1a03000 	mov	r3, r0
+a0307214:	e3530000 	cmp	r3, #0	; 0x0
+a0307218:	1a000003 	bne	a030722c <SetDownloadSpeed+0x260>
+a030721c:	e59f2124 	ldr	r2, [pc, #292]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307220:	e3a03006 	mov	r3, #6	; 0x6
+a0307224:	e5823060 	str	r3, [r2, #96]
+a0307228:	ea00003a 	b	a0307318 <SetDownloadSpeed+0x34c>
+a030722c:	e3a02004 	mov	r2, #4	; 0x4
+a0307230:	e51b3014 	ldr	r3, [fp, -#20]
+a0307234:	e0823003 	add	r3, r2, r3
+a0307238:	e5930000 	ldr	r0, [r3]
+a030723c:	e59f112c 	ldr	r1, [pc, #300]	; a0307370 <SetDownloadSpeed+0x3a4>
+a0307240:	e3a02007 	mov	r2, #7	; 0x7
+a0307244:	eb00102b 	bl	a030b2f8 <strncmp>
+a0307248:	e1a03000 	mov	r3, r0
+a030724c:	e3530000 	cmp	r3, #0	; 0x0
+a0307250:	1a000003 	bne	a0307264 <SetDownloadSpeed+0x298>
+a0307254:	e59f20ec 	ldr	r2, [pc, #236]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307258:	e3a03007 	mov	r3, #7	; 0x7
+a030725c:	e5823060 	str	r3, [r2, #96]
+a0307260:	ea00002c 	b	a0307318 <SetDownloadSpeed+0x34c>
+a0307264:	e3a02004 	mov	r2, #4	; 0x4
+a0307268:	e51b3014 	ldr	r3, [fp, -#20]
+a030726c:	e0823003 	add	r3, r2, r3
+a0307270:	e5930000 	ldr	r0, [r3]
+a0307274:	e59f10f8 	ldr	r1, [pc, #248]	; a0307374 <SetDownloadSpeed+0x3a8>
+a0307278:	e3a02006 	mov	r2, #6	; 0x6
+a030727c:	eb00101d 	bl	a030b2f8 <strncmp>
+a0307280:	e1a03000 	mov	r3, r0
+a0307284:	e3530000 	cmp	r3, #0	; 0x0
+a0307288:	1a000003 	bne	a030729c <SetDownloadSpeed+0x2d0>
+a030728c:	e59f20b4 	ldr	r2, [pc, #180]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307290:	e3a03007 	mov	r3, #7	; 0x7
+a0307294:	e5823060 	str	r3, [r2, #96]
+a0307298:	ea00001e 	b	a0307318 <SetDownloadSpeed+0x34c>
+a030729c:	e3a02004 	mov	r2, #4	; 0x4
+a03072a0:	e51b3014 	ldr	r3, [fp, -#20]
+a03072a4:	e0823003 	add	r3, r2, r3
+a03072a8:	e5930000 	ldr	r0, [r3]
+a03072ac:	e59f10c4 	ldr	r1, [pc, #196]	; a0307378 <SetDownloadSpeed+0x3ac>
+a03072b0:	e3a02007 	mov	r2, #7	; 0x7
+a03072b4:	eb00100f 	bl	a030b2f8 <strncmp>
+a03072b8:	e1a03000 	mov	r3, r0
+a03072bc:	e3530000 	cmp	r3, #0	; 0x0
+a03072c0:	1a000003 	bne	a03072d4 <SetDownloadSpeed+0x308>
+a03072c4:	e59f207c 	ldr	r2, [pc, #124]	; a0307348 <SetDownloadSpeed+0x37c>
+a03072c8:	e3a03008 	mov	r3, #8	; 0x8
+a03072cc:	e5823060 	str	r3, [r2, #96]
+a03072d0:	ea000010 	b	a0307318 <SetDownloadSpeed+0x34c>
+a03072d4:	e3a02004 	mov	r2, #4	; 0x4
+a03072d8:	e51b3014 	ldr	r3, [fp, -#20]
+a03072dc:	e0823003 	add	r3, r2, r3
+a03072e0:	e5930000 	ldr	r0, [r3]
+a03072e4:	e59f1090 	ldr	r1, [pc, #144]	; a030737c <SetDownloadSpeed+0x3b0>
+a03072e8:	e3a02006 	mov	r2, #6	; 0x6
+a03072ec:	eb001001 	bl	a030b2f8 <strncmp>
+a03072f0:	e1a03000 	mov	r3, r0
+a03072f4:	e3530000 	cmp	r3, #0	; 0x0
+a03072f8:	1a000003 	bne	a030730c <SetDownloadSpeed+0x340>
+a03072fc:	e59f2044 	ldr	r2, [pc, #68]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307300:	e3a03008 	mov	r3, #8	; 0x8
+a0307304:	e5823060 	str	r3, [r2, #96]
+a0307308:	ea000002 	b	a0307318 <SetDownloadSpeed+0x34c>
+a030730c:	e3e03000 	mvn	r3, #0	; 0x0
+a0307310:	e50b3018 	str	r3, [fp, -#24]
+a0307314:	ea000008 	b	a030733c <SetDownloadSpeed+0x370>
+a0307318:	e59f0060 	ldr	r0, [pc, #96]	; a0307380 <SetDownloadSpeed+0x3b4>
+a030731c:	eb000ddf 	bl	a030aaa0 <printf>
+a0307320:	e59f3020 	ldr	r3, [pc, #32]	; a0307348 <SetDownloadSpeed+0x37c>
+a0307324:	e5930060 	ldr	r0, [r3, #96]
+a0307328:	ebfffe11 	bl	a0306b74 <PrintSerialSpeed>
+a030732c:	e59f0050 	ldr	r0, [pc, #80]	; a0307384 <SetDownloadSpeed+0x3b8>
+a0307330:	eb000dda 	bl	a030aaa0 <printf>
+a0307334:	e3a03000 	mov	r3, #0	; 0x0
+a0307338:	e50b3018 	str	r3, [fp, -#24]
+a030733c:	e51b0018 	ldr	r0, [fp, -#24]
+a0307340:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0307344:	a030d220 	eorges	sp, r0, r0, lsr #4
+a0307348:	a030fd20 	eorges	pc, r0, r0, lsr #26
+a030734c:	a030d228 	eorges	sp, r0, r8, lsr #4
+a0307350:	a030d22c 	eorges	sp, r0, ip, lsr #4
+a0307354:	a030d234 	eorges	sp, r0, r4, lsr r2
+a0307358:	a030d238 	eorges	sp, r0, r8, lsr r2
+a030735c:	a030d240 	eorges	sp, r0, r0, asr #4
+a0307360:	a030d248 	eorges	sp, r0, r8, asr #4
+a0307364:	a030d250 	eorges	sp, r0, r0, asr r2
+a0307368:	a030d258 	eorges	sp, r0, r8, asr r2
+a030736c:	a030d260 	eorges	sp, r0, r0, ror #4
+a0307370:	a030d268 	eorges	sp, r0, r8, ror #4
+a0307374:	a030d270 	eorges	sp, r0, r0, ror r2
+a0307378:	a030d278 	eorges	sp, r0, r8, ror r2
+a030737c:	a030d280 	eorges	sp, r0, r0, lsl #5
+a0307380:	a030d288 	eorges	sp, r0, r8, lsl #5
+a0307384:	a030d2a0 	eorges	sp, r0, r0, lsr #5
+
+a0307388 <strerror>:
+a0307388:	e1a0c00d 	mov	ip, sp
+a030738c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307390:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307394:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a0307398:	e50b0010 	str	r0, [fp, -#16]
+a030739c:	e3a0300f 	mov	r3, #15	; 0xf
+a03073a0:	e50b3014 	str	r3, [fp, -#20]
+a03073a4:	e51b3010 	ldr	r3, [fp, -#16]
+a03073a8:	e3530000 	cmp	r3, #0	; 0x0
+a03073ac:	aa000002 	bge	a03073bc <strerror+0x34>
+a03073b0:	e51b3010 	ldr	r3, [fp, -#16]
+a03073b4:	e2633000 	rsb	r3, r3, #0	; 0x0
+a03073b8:	e50b3010 	str	r3, [fp, -#16]
+a03073bc:	e51b2010 	ldr	r2, [fp, -#16]
+a03073c0:	e51b3014 	ldr	r3, [fp, -#20]
+a03073c4:	e1520003 	cmp	r2, r3
+a03073c8:	ba000003 	blt	a03073dc <strerror+0x54>
+a03073cc:	e59f3020 	ldr	r3, [pc, #32]	; a03073f4 <strerror+0x6c>
+a03073d0:	e5933000 	ldr	r3, [r3]
+a03073d4:	e50b3018 	str	r3, [fp, -#24]
+a03073d8:	ea000003 	b	a03073ec <strerror+0x64>
+a03073dc:	e59f3014 	ldr	r3, [pc, #20]	; a03073f8 <strerror+0x70>
+a03073e0:	e51b2010 	ldr	r2, [fp, -#16]
+a03073e4:	e7933102 	ldr	r3, [r3, r2, lsl #2]
+a03073e8:	e50b3018 	str	r3, [fp, -#24]
+a03073ec:	e51b0018 	ldr	r0, [fp, -#24]
+a03073f0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03073f4:	a030dc74 	eorges	sp, r0, r4, ror ip
+a03073f8:	a030dc38 	eorges	sp, r0, r8, lsr ip
+
+a03073fc <printerrprefix>:
+a03073fc:	e1a0c00d 	mov	ip, sp
+a0307400:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307404:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307408:	e59f300c 	ldr	r3, [pc, #12]	; a030741c <printerrprefix+0x20>
+a030740c:	e59f000c 	ldr	r0, [pc, #12]	; a0307420 <printerrprefix+0x24>
+a0307410:	e5931000 	ldr	r1, [r3]
+a0307414:	eb000da1 	bl	a030aaa0 <printf>
+a0307418:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030741c:	a030dc78 	eorges	sp, r0, r8, ror ip
+a0307420:	a030d3d4 	ldrgesb	sp, [r0], -r4
+
+a0307424 <printerror>:
+a0307424:	e1a0c00d 	mov	ip, sp
+a0307428:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030742c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307430:	e24dd008 	sub	sp, sp, #8	; 0x8
+a0307434:	e50b0010 	str	r0, [fp, -#16]
+a0307438:	e50b1014 	str	r1, [fp, -#20]
+a030743c:	e51b0010 	ldr	r0, [fp, -#16]
+a0307440:	ebffffd0 	bl	a0307388 <strerror>
+a0307444:	e1a02000 	mov	r2, r0
+a0307448:	e59f3030 	ldr	r3, [pc, #48]	; a0307480 <printerror+0x5c>
+a030744c:	e59f0030 	ldr	r0, [pc, #48]	; a0307484 <printerror+0x60>
+a0307450:	e5931000 	ldr	r1, [r3]
+a0307454:	eb000d91 	bl	a030aaa0 <printf>
+a0307458:	e51b3014 	ldr	r3, [fp, -#20]
+a030745c:	e3530000 	cmp	r3, #0	; 0x0
+a0307460:	0a000003 	beq	a0307474 <printerror+0x50>
+a0307464:	e59f001c 	ldr	r0, [pc, #28]	; a0307488 <printerror+0x64>
+a0307468:	e51b1014 	ldr	r1, [fp, -#20]
+a030746c:	eb000d8b 	bl	a030aaa0 <printf>
+a0307470:	ea000001 	b	a030747c <printerror+0x58>
+a0307474:	e59f0010 	ldr	r0, [pc, #16]	; a030748c <printerror+0x68>
+a0307478:	eb000d88 	bl	a030aaa0 <printf>
+a030747c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0307480:	a030dc78 	eorges	sp, r0, r8, ror ip
+a0307484:	a030d3d8 	ldrgesb	sp, [r0], -r8
+a0307488:	a030d3e0 	eorges	sp, r0, r0, ror #7
+a030748c:	a030d3e8 	eorges	sp, r0, r8, ror #7
+
+a0307490 <ether_init>:
+a0307490:	e1a0c00d 	mov	ip, sp
+a0307494:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307498:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030749c:	e59f3030 	ldr	r3, [pc, #48]	; a03074d4 <ether_init+0x44>
+a03074a0:	e5933000 	ldr	r3, [r3]
+a03074a4:	e3530000 	cmp	r3, #0	; 0x0
+a03074a8:	1a000000 	bne	a03074b0 <ether_init+0x20>
+a03074ac:	ea000007 	b	a03074d0 <ether_init+0x40>
+a03074b0:	e59f301c 	ldr	r3, [pc, #28]	; a03074d4 <ether_init+0x44>
+a03074b4:	e5932000 	ldr	r2, [r3]
+a03074b8:	e59f3014 	ldr	r3, [pc, #20]	; a03074d4 <ether_init+0x44>
+a03074bc:	e5933000 	ldr	r3, [r3]
+a03074c0:	e5922000 	ldr	r2, [r2]
+a03074c4:	e5930014 	ldr	r0, [r3, #20]
+a03074c8:	e1a0e00f 	mov	lr, pc
+a03074cc:	e1a0f002 	mov	pc, r2
+a03074d0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03074d4:	a0310380 	eorges	r0, r1, r0, lsl #7
+
+a03074d8 <ether_rcv>:
+a03074d8:	e1a0c00d 	mov	ip, sp
+a03074dc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03074e0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03074e4:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a03074e8:	e50b0010 	str	r0, [fp, -#16]
+a03074ec:	e50b1014 	str	r1, [fp, -#20]
+a03074f0:	e59f3040 	ldr	r3, [pc, #64]	; a0307538 <ether_rcv+0x60>
+a03074f4:	e5933000 	ldr	r3, [r3]
+a03074f8:	e3530000 	cmp	r3, #0	; 0x0
+a03074fc:	1a000002 	bne	a030750c <ether_rcv+0x34>
+a0307500:	e3e03000 	mvn	r3, #0	; 0x0
+a0307504:	e50b3018 	str	r3, [fp, -#24]
+a0307508:	ea000008 	b	a0307530 <ether_rcv+0x58>
+a030750c:	e59f3024 	ldr	r3, [pc, #36]	; a0307538 <ether_rcv+0x60>
+a0307510:	e5933000 	ldr	r3, [r3]
+a0307514:	e5933004 	ldr	r3, [r3, #4]
+a0307518:	e51b0010 	ldr	r0, [fp, -#16]
+a030751c:	e51b1014 	ldr	r1, [fp, -#20]
+a0307520:	e1a0e00f 	mov	lr, pc
+a0307524:	e1a0f003 	mov	pc, r3
+a0307528:	e1a03000 	mov	r3, r0
+a030752c:	e50b3018 	str	r3, [fp, -#24]
+a0307530:	e51b0018 	ldr	r0, [fp, -#24]
+a0307534:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0307538:	a0310380 	eorges	r0, r1, r0, lsl #7
+
+a030753c <ether_snd>:
+a030753c:	e1a0c00d 	mov	ip, sp
+a0307540:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307544:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307548:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a030754c:	e50b0010 	str	r0, [fp, -#16]
+a0307550:	e50b1014 	str	r1, [fp, -#20]
+a0307554:	e59f3040 	ldr	r3, [pc, #64]	; a030759c <ether_snd+0x60>
+a0307558:	e5933000 	ldr	r3, [r3]
+a030755c:	e3530000 	cmp	r3, #0	; 0x0
+a0307560:	1a000002 	bne	a0307570 <ether_snd+0x34>
+a0307564:	e3e03000 	mvn	r3, #0	; 0x0
+a0307568:	e50b3018 	str	r3, [fp, -#24]
+a030756c:	ea000008 	b	a0307594 <ether_snd+0x58>
+a0307570:	e59f3024 	ldr	r3, [pc, #36]	; a030759c <ether_snd+0x60>
+a0307574:	e5933000 	ldr	r3, [r3]
+a0307578:	e5933008 	ldr	r3, [r3, #8]
+a030757c:	e51b0010 	ldr	r0, [fp, -#16]
+a0307580:	e51b1014 	ldr	r1, [fp, -#20]
+a0307584:	e1a0e00f 	mov	lr, pc
+a0307588:	e1a0f003 	mov	pc, r3
+a030758c:	e1a03000 	mov	r3, r0
+a0307590:	e50b3018 	str	r3, [fp, -#24]
+a0307594:	e51b0018 	ldr	r0, [fp, -#24]
+a0307598:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030759c:	a0310380 	eorges	r0, r1, r0, lsl #7
+
+a03075a0 <ether_get_addr>:
+a03075a0:	e1a0c00d 	mov	ip, sp
+a03075a4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03075a8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03075ac:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03075b0:	e50b0010 	str	r0, [fp, -#16]
+a03075b4:	e59f303c 	ldr	r3, [pc, #60]	; a03075f8 <ether_get_addr+0x58>
+a03075b8:	e5933000 	ldr	r3, [r3]
+a03075bc:	e3530000 	cmp	r3, #0	; 0x0
+a03075c0:	1a000002 	bne	a03075d0 <ether_get_addr+0x30>
+a03075c4:	e3e03000 	mvn	r3, #0	; 0x0
+a03075c8:	e50b3014 	str	r3, [fp, -#20]
+a03075cc:	ea000007 	b	a03075f0 <ether_get_addr+0x50>
+a03075d0:	e59f3020 	ldr	r3, [pc, #32]	; a03075f8 <ether_get_addr+0x58>
+a03075d4:	e5933000 	ldr	r3, [r3]
+a03075d8:	e5933010 	ldr	r3, [r3, #16]
+a03075dc:	e51b0010 	ldr	r0, [fp, -#16]
+a03075e0:	e1a0e00f 	mov	lr, pc
+a03075e4:	e1a0f003 	mov	pc, r3
+a03075e8:	e1a03000 	mov	r3, r0
+a03075ec:	e50b3014 	str	r3, [fp, -#20]
+a03075f0:	e51b0014 	ldr	r0, [fp, -#20]
+a03075f4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03075f8:	a0310380 	eorges	r0, r1, r0, lsl #7
+
+a03075fc <ether_set_addr>:
+a03075fc:	e1a0c00d 	mov	ip, sp
+a0307600:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307604:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307608:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030760c:	e50b0010 	str	r0, [fp, -#16]
+a0307610:	e59f304c 	ldr	r3, [pc, #76]	; a0307664 <ether_set_addr+0x68>
+a0307614:	e5933000 	ldr	r3, [r3]
+a0307618:	e3530000 	cmp	r3, #0	; 0x0
+a030761c:	1a000002 	bne	a030762c <ether_set_addr+0x30>
+a0307620:	e3e03000 	mvn	r3, #0	; 0x0
+a0307624:	e50b3014 	str	r3, [fp, -#20]
+a0307628:	ea00000b 	b	a030765c <ether_set_addr+0x60>
+a030762c:	e59f0034 	ldr	r0, [pc, #52]	; a0307668 <ether_set_addr+0x6c>
+a0307630:	e51b1010 	ldr	r1, [fp, -#16]
+a0307634:	e3a02006 	mov	r2, #6	; 0x6
+a0307638:	eb000862 	bl	a03097c8 <memcpy>
+a030763c:	e59f3020 	ldr	r3, [pc, #32]	; a0307664 <ether_set_addr+0x68>
+a0307640:	e5933000 	ldr	r3, [r3]
+a0307644:	e593300c 	ldr	r3, [r3, #12]
+a0307648:	e51b0010 	ldr	r0, [fp, -#16]
+a030764c:	e1a0e00f 	mov	lr, pc
+a0307650:	e1a0f003 	mov	pc, r3
+a0307654:	e1a03000 	mov	r3, r0
+a0307658:	e50b3014 	str	r3, [fp, -#20]
+a030765c:	e51b0014 	ldr	r0, [fp, -#20]
+a0307660:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0307664:	a0310380 	eorges	r0, r1, r0, lsl #7
+a0307668:	a030dc7c 	eorges	sp, r0, ip, ror ip
+
+a030766c <ether_get_name>:
+a030766c:	e1a0c00d 	mov	ip, sp
+a0307670:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307674:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307678:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030767c:	e59f302c 	ldr	r3, [pc, #44]	; a03076b0 <ether_get_name+0x44>
+a0307680:	e5933000 	ldr	r3, [r3]
+a0307684:	e3530000 	cmp	r3, #0	; 0x0
+a0307688:	1a000002 	bne	a0307698 <ether_get_name+0x2c>
+a030768c:	e3e03000 	mvn	r3, #0	; 0x0
+a0307690:	e50b3010 	str	r3, [fp, -#16]
+a0307694:	ea000003 	b	a03076a8 <ether_get_name+0x3c>
+a0307698:	e59f3010 	ldr	r3, [pc, #16]	; a03076b0 <ether_get_name+0x44>
+a030769c:	e5933000 	ldr	r3, [r3]
+a03076a0:	e5933018 	ldr	r3, [r3, #24]
+a03076a4:	e50b3010 	str	r3, [fp, -#16]
+a03076a8:	e51b0010 	ldr	r0, [fp, -#16]
+a03076ac:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03076b0:	a0310380 	eorges	r0, r1, r0, lsl #7
+
+a03076b4 <enable_icache>:
+a03076b4:	e1a0c00d 	mov	ip, sp
+a03076b8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03076bc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03076c0:	ee113f10 	mrc	15, 0, r3, cr1, cr0, {0}
+a03076c4:	e3833a01 	orr	r3, r3, #4096	; 0x1000
+a03076c8:	ee013f10 	mcr	15, 0, r3, cr1, cr0, {0}
+a03076cc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03076d0 <disable_icache>:
+a03076d0:	e1a0c00d 	mov	ip, sp
+a03076d4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03076d8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03076dc:	ee113f10 	mrc	15, 0, r3, cr1, cr0, {0}
+a03076e0:	e3c33a01 	bic	r3, r3, #4096	; 0x1000
+a03076e4:	ee013f10 	mcr	15, 0, r3, cr1, cr0, {0}
+a03076e8:	ee073f15 	mcr	15, 0, r3, cr7, cr5, {0}
+a03076ec:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03076f0 <call_funcs>:
+a03076f0:	e1a0c00d 	mov	ip, sp
+a03076f4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03076f8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03076fc:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0307700:	e50b0010 	str	r0, [fp, -#16]
+a0307704:	e50b1014 	str	r1, [fp, -#20]
+a0307708:	e50b2018 	str	r2, [fp, -#24]
+a030770c:	e50b301c 	str	r3, [fp, -#28]
+a0307710:	e51b3010 	ldr	r3, [fp, -#16]
+a0307714:	e50b3020 	str	r3, [fp, -#32]
+a0307718:	e51b2020 	ldr	r2, [fp, -#32]
+a030771c:	e51b3014 	ldr	r3, [fp, -#20]
+a0307720:	e1520003 	cmp	r2, r3
+a0307724:	1a000000 	bne	a030772c <call_funcs+0x3c>
+a0307728:	ea000015 	b	a0307784 <call_funcs+0x94>
+a030772c:	e51b3020 	ldr	r3, [fp, -#32]
+a0307730:	e5932000 	ldr	r2, [r3]
+a0307734:	e51b3018 	ldr	r3, [fp, -#24]
+a0307738:	e1520003 	cmp	r2, r3
+a030773c:	0a000003 	beq	a0307750 <call_funcs+0x60>
+a0307740:	e3a00003 	mov	r0, #3	; 0x3
+a0307744:	e3a01000 	mov	r1, #0	; 0x0
+a0307748:	ebffff35 	bl	a0307424 <printerror>
+a030774c:	ea00000c 	b	a0307784 <call_funcs+0x94>
+a0307750:	e51b3020 	ldr	r3, [fp, -#32]
+a0307754:	e5932008 	ldr	r2, [r3, #8]
+a0307758:	e51b301c 	ldr	r3, [fp, -#28]
+a030775c:	e1520003 	cmp	r2, r3
+a0307760:	1a000003 	bne	a0307774 <call_funcs+0x84>
+a0307764:	e51b3020 	ldr	r3, [fp, -#32]
+a0307768:	e5933004 	ldr	r3, [r3, #4]
+a030776c:	e1a0e00f 	mov	lr, pc
+a0307770:	e1a0f003 	mov	pc, r3
+a0307774:	e51b3020 	ldr	r3, [fp, -#32]
+a0307778:	e283300c 	add	r3, r3, #12	; 0xc
+a030777c:	e50b3020 	str	r3, [fp, -#32]
+a0307780:	eaffffe4 	b	a0307718 <call_funcs+0x28>
+a0307784:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0307788 <init_subsystems>:
+a0307788:	e1a0c00d 	mov	ip, sp
+a030778c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307790:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307794:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0307798:	e3a03000 	mov	r3, #0	; 0x0
+a030779c:	e50b3010 	str	r3, [fp, -#16]
+a03077a0:	e51b3010 	ldr	r3, [fp, -#16]
+a03077a4:	e3530063 	cmp	r3, #99	; 0x63
+a03077a8:	da000000 	ble	a03077b0 <init_subsystems+0x28>
+a03077ac:	ea000008 	b	a03077d4 <init_subsystems+0x4c>
+a03077b0:	e59f0020 	ldr	r0, [pc, #32]	; a03077d8 <init_subsystems+0x50>
+a03077b4:	e59f1020 	ldr	r1, [pc, #32]	; a03077dc <init_subsystems+0x54>
+a03077b8:	e59f2020 	ldr	r2, [pc, #32]	; a03077e0 <init_subsystems+0x58>
+a03077bc:	e51b3010 	ldr	r3, [fp, -#16]
+a03077c0:	ebffffca 	bl	a03076f0 <call_funcs>
+a03077c4:	e51b3010 	ldr	r3, [fp, -#16]
+a03077c8:	e2833001 	add	r3, r3, #1	; 0x1
+a03077cc:	e50b3010 	str	r3, [fp, -#16]
+a03077d0:	eafffff2 	b	a03077a0 <init_subsystems+0x18>
+a03077d4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03077d8:	a030dee4 	eorges	sp, r0, r4, ror #29
+a03077dc:	a030df44 	eorges	sp, r0, r4, asr #30
+a03077e0:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+
+a03077e4 <exit_subsystems>:
+a03077e4:	e1a0c00d 	mov	ip, sp
+a03077e8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03077ec:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03077f0:	e24dd004 	sub	sp, sp, #4	; 0x4
+a03077f4:	e3a03063 	mov	r3, #99	; 0x63
+a03077f8:	e50b3010 	str	r3, [fp, -#16]
+a03077fc:	e51b3010 	ldr	r3, [fp, -#16]
+a0307800:	e3530000 	cmp	r3, #0	; 0x0
+a0307804:	aa000000 	bge	a030780c <exit_subsystems+0x28>
+a0307808:	ea000008 	b	a0307830 <exit_subsystems+0x4c>
+a030780c:	e59f0020 	ldr	r0, [pc, #32]	; a0307834 <exit_subsystems+0x50>
+a0307810:	e59f1020 	ldr	r1, [pc, #32]	; a0307838 <exit_subsystems+0x54>
+a0307814:	e59f2020 	ldr	r2, [pc, #32]	; a030783c <exit_subsystems+0x58>
+a0307818:	e51b3010 	ldr	r3, [fp, -#16]
+a030781c:	ebffffb3 	bl	a03076f0 <call_funcs>
+a0307820:	e51b3010 	ldr	r3, [fp, -#16]
+a0307824:	e2433001 	sub	r3, r3, #1	; 0x1
+a0307828:	e50b3010 	str	r3, [fp, -#16]
+a030782c:	eafffff2 	b	a03077fc <exit_subsystems+0x18>
+a0307830:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0307834:	a030df44 	eorges	sp, r0, r4, asr #30
+a0307838:	a030df50 	eorges	sp, r0, r0, asr pc
+a030783c:	45786974 	ldrmib	r6, [r8, -#2420]!
+
+a0307840 <md5_init_ctx>:
+a0307840:	e1a0c00d 	mov	ip, sp
+a0307844:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307848:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030784c:	e24dd004 	sub	sp, sp, #4	; 0x4
+a0307850:	e50b0010 	str	r0, [fp, -#16]
+a0307854:	e51b2010 	ldr	r2, [fp, -#16]
+a0307858:	e59f304c 	ldr	r3, [pc, #76]	; a03078ac <md5_init_ctx+0x6c>
+a030785c:	e5823000 	str	r3, [r2]
+a0307860:	e51b2010 	ldr	r2, [fp, -#16]
+a0307864:	e59f3044 	ldr	r3, [pc, #68]	; a03078b0 <md5_init_ctx+0x70>
+a0307868:	e5823004 	str	r3, [r2, #4]
+a030786c:	e51b2010 	ldr	r2, [fp, -#16]
+a0307870:	e59f303c 	ldr	r3, [pc, #60]	; a03078b4 <md5_init_ctx+0x74>
+a0307874:	e5823008 	str	r3, [r2, #8]
+a0307878:	e51b2010 	ldr	r2, [fp, -#16]
+a030787c:	e59f3034 	ldr	r3, [pc, #52]	; a03078b8 <md5_init_ctx+0x78>
+a0307880:	e582300c 	str	r3, [r2, #12]
+a0307884:	e51b1010 	ldr	r1, [fp, -#16]
+a0307888:	e51b2010 	ldr	r2, [fp, -#16]
+a030788c:	e3a03000 	mov	r3, #0	; 0x0
+a0307890:	e5823014 	str	r3, [r2, #20]
+a0307894:	e3a03000 	mov	r3, #0	; 0x0
+a0307898:	e5813010 	str	r3, [r1, #16]
+a030789c:	e51b2010 	ldr	r2, [fp, -#16]
+a03078a0:	e3a03000 	mov	r3, #0	; 0x0
+a03078a4:	e5823018 	str	r3, [r2, #24]
+a03078a8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03078ac:	67452301 	strvsb	r2, [r5, -r1, lsl #6]
+a03078b0:	efcdab89 	swi	0x00cdab89
+a03078b4:	98badcfe 	ldmlsia	sl!, {r1, r2, r3, r4, r5, r6, r7, sl, fp, ip, lr, pc}
+a03078b8:	10325476 	eornes	r5, r2, r6, ror r4
+
+a03078bc <md5_read_ctx>:
+a03078bc:	e1a0c00d 	mov	ip, sp
+a03078c0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03078c4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03078c8:	e24dd008 	sub	sp, sp, #8	; 0x8
+a03078cc:	e50b0010 	str	r0, [fp, -#16]
+a03078d0:	e50b1014 	str	r1, [fp, -#20]
+a03078d4:	e51b2014 	ldr	r2, [fp, -#20]
+a03078d8:	e51b3010 	ldr	r3, [fp, -#16]
+a03078dc:	e5933000 	ldr	r3, [r3]
+a03078e0:	e5823000 	str	r3, [r2]
+a03078e4:	e3a02004 	mov	r2, #4	; 0x4
+a03078e8:	e51b3014 	ldr	r3, [fp, -#20]
+a03078ec:	e0822003 	add	r2, r2, r3
+a03078f0:	e51b3010 	ldr	r3, [fp, -#16]
+a03078f4:	e5933004 	ldr	r3, [r3, #4]
+a03078f8:	e5823000 	str	r3, [r2]
+a03078fc:	e3a02008 	mov	r2, #8	; 0x8
+a0307900:	e51b3014 	ldr	r3, [fp, -#20]
+a0307904:	e0822003 	add	r2, r2, r3
+a0307908:	e51b3010 	ldr	r3, [fp, -#16]
+a030790c:	e5933008 	ldr	r3, [r3, #8]
+a0307910:	e5823000 	str	r3, [r2]
+a0307914:	e3a0200c 	mov	r2, #12	; 0xc
+a0307918:	e51b3014 	ldr	r3, [fp, -#20]
+a030791c:	e0822003 	add	r2, r2, r3
+a0307920:	e51b3010 	ldr	r3, [fp, -#16]
+a0307924:	e593300c 	ldr	r3, [r3, #12]
+a0307928:	e5823000 	str	r3, [r2]
+a030792c:	e51b3014 	ldr	r3, [fp, -#20]
+a0307930:	e1a00003 	mov	r0, r3
+a0307934:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0307938 <md5_finish_ctx>:
+a0307938:	e1a0c00d 	mov	ip, sp
+a030793c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307940:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307944:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0307948:	e50b0010 	str	r0, [fp, -#16]
+a030794c:	e50b1014 	str	r1, [fp, -#20]
+a0307950:	e51b3010 	ldr	r3, [fp, -#16]
+a0307954:	e5933018 	ldr	r3, [r3, #24]
+a0307958:	e50b3018 	str	r3, [fp, -#24]
+a030795c:	e51b1010 	ldr	r1, [fp, -#16]
+a0307960:	e51b3010 	ldr	r3, [fp, -#16]
+a0307964:	e5932010 	ldr	r2, [r3, #16]
+a0307968:	e51b3018 	ldr	r3, [fp, -#24]
+a030796c:	e0823003 	add	r3, r2, r3
+a0307970:	e5813010 	str	r3, [r1, #16]
+a0307974:	e51b3010 	ldr	r3, [fp, -#16]
+a0307978:	e5932010 	ldr	r2, [r3, #16]
+a030797c:	e51b3018 	ldr	r3, [fp, -#24]
+a0307980:	e1520003 	cmp	r2, r3
+a0307984:	2a000004 	bcs	a030799c <md5_finish_ctx+0x64>
+a0307988:	e51b2010 	ldr	r2, [fp, -#16]
+a030798c:	e51b3010 	ldr	r3, [fp, -#16]
+a0307990:	e5933014 	ldr	r3, [r3, #20]
+a0307994:	e2833001 	add	r3, r3, #1	; 0x1
+a0307998:	e5823014 	str	r3, [r2, #20]
+a030799c:	e51b3018 	ldr	r3, [fp, -#24]
+a03079a0:	e3530037 	cmp	r3, #55	; 0x37
+a03079a4:	9a000003 	bls	a03079b8 <md5_finish_ctx+0x80>
+a03079a8:	e51b3018 	ldr	r3, [fp, -#24]
+a03079ac:	e2633078 	rsb	r3, r3, #120	; 0x78
+a03079b0:	e50b3020 	str	r3, [fp, -#32]
+a03079b4:	ea000002 	b	a03079c4 <md5_finish_ctx+0x8c>
+a03079b8:	e51b3018 	ldr	r3, [fp, -#24]
+a03079bc:	e2633038 	rsb	r3, r3, #56	; 0x38
+a03079c0:	e50b3020 	str	r3, [fp, -#32]
+a03079c4:	e51b3020 	ldr	r3, [fp, -#32]
+a03079c8:	e50b301c 	str	r3, [fp, -#28]
+a03079cc:	e51b2010 	ldr	r2, [fp, -#16]
+a03079d0:	e51b3018 	ldr	r3, [fp, -#24]
+a03079d4:	e0823003 	add	r3, r2, r3
+a03079d8:	e283301c 	add	r3, r3, #28	; 0x1c
+a03079dc:	e1a00003 	mov	r0, r3
+a03079e0:	e59f10ac 	ldr	r1, [pc, #172]	; a0307a94 <md5_finish_ctx+0x15c>
+a03079e4:	e51b201c 	ldr	r2, [fp, -#28]
+a03079e8:	eb000776 	bl	a03097c8 <memcpy>
+a03079ec:	e3a0101c 	mov	r1, #28	; 0x1c
+a03079f0:	e51b2018 	ldr	r2, [fp, -#24]
+a03079f4:	e51b301c 	ldr	r3, [fp, -#28]
+a03079f8:	e0822003 	add	r2, r2, r3
+a03079fc:	e51b3010 	ldr	r3, [fp, -#16]
+a0307a00:	e0823003 	add	r3, r2, r3
+a0307a04:	e0832001 	add	r2, r3, r1
+a0307a08:	e51b3010 	ldr	r3, [fp, -#16]
+a0307a0c:	e5933010 	ldr	r3, [r3, #16]
+a0307a10:	e1a03183 	mov	r3, r3, lsl #3
+a0307a14:	e5823000 	str	r3, [r2]
+a0307a18:	e3a01020 	mov	r1, #32	; 0x20
+a0307a1c:	e51b2018 	ldr	r2, [fp, -#24]
+a0307a20:	e51b301c 	ldr	r3, [fp, -#28]
+a0307a24:	e0822003 	add	r2, r2, r3
+a0307a28:	e51b3010 	ldr	r3, [fp, -#16]
+a0307a2c:	e0823003 	add	r3, r2, r3
+a0307a30:	e0831001 	add	r1, r3, r1
+a0307a34:	e51b3010 	ldr	r3, [fp, -#16]
+a0307a38:	e5933014 	ldr	r3, [r3, #20]
+a0307a3c:	e1a02183 	mov	r2, r3, lsl #3
+a0307a40:	e51b3010 	ldr	r3, [fp, -#16]
+a0307a44:	e5933010 	ldr	r3, [r3, #16]
+a0307a48:	e1a03ea3 	mov	r3, r3, lsr #29
+a0307a4c:	e1823003 	orr	r3, r2, r3
+a0307a50:	e5813000 	str	r3, [r1]
+a0307a54:	e51b3010 	ldr	r3, [fp, -#16]
+a0307a58:	e283101c 	add	r1, r3, #28	; 0x1c
+a0307a5c:	e51b2018 	ldr	r2, [fp, -#24]
+a0307a60:	e51b301c 	ldr	r3, [fp, -#28]
+a0307a64:	e0823003 	add	r3, r2, r3
+a0307a68:	e2833008 	add	r3, r3, #8	; 0x8
+a0307a6c:	e1a00001 	mov	r0, r1
+a0307a70:	e1a01003 	mov	r1, r3
+a0307a74:	e51b2010 	ldr	r2, [fp, -#16]
+a0307a78:	eb000088 	bl	a0307ca0 <md5_process_block>
+a0307a7c:	e51b0010 	ldr	r0, [fp, -#16]
+a0307a80:	e51b1014 	ldr	r1, [fp, -#20]
+a0307a84:	ebffff8c 	bl	a03078bc <md5_read_ctx>
+a0307a88:	e1a03000 	mov	r3, r0
+a0307a8c:	e1a00003 	mov	r0, r3
+a0307a90:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a0307a94:	a030d3ec 	eorges	sp, r0, ip, ror #7
+
+a0307a98 <md5_buffer>:
+a0307a98:	e1a0c00d 	mov	ip, sp
+a0307a9c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307aa0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307aa4:	e24dd0a8 	sub	sp, sp, #168	; 0xa8
+a0307aa8:	e50b0010 	str	r0, [fp, -#16]
+a0307aac:	e50b1014 	str	r1, [fp, -#20]
+a0307ab0:	e50b2018 	str	r2, [fp, -#24]
+a0307ab4:	e24b30b4 	sub	r3, fp, #180	; 0xb4
+a0307ab8:	e1a00003 	mov	r0, r3
+a0307abc:	ebffff5f 	bl	a0307840 <md5_init_ctx>
+a0307ac0:	e24b30b4 	sub	r3, fp, #180	; 0xb4
+a0307ac4:	e51b0010 	ldr	r0, [fp, -#16]
+a0307ac8:	e51b1014 	ldr	r1, [fp, -#20]
+a0307acc:	e1a02003 	mov	r2, r3
+a0307ad0:	eb000006 	bl	a0307af0 <md5_process_bytes>
+a0307ad4:	e24b30b4 	sub	r3, fp, #180	; 0xb4
+a0307ad8:	e1a00003 	mov	r0, r3
+a0307adc:	e51b1018 	ldr	r1, [fp, -#24]
+a0307ae0:	ebffff94 	bl	a0307938 <md5_finish_ctx>
+a0307ae4:	e1a03000 	mov	r3, r0
+a0307ae8:	e1a00003 	mov	r0, r3
+a0307aec:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0307af0 <md5_process_bytes>:
+a0307af0:	e1a0c00d 	mov	ip, sp
+a0307af4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a0307af8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307afc:	e24dd014 	sub	sp, sp, #20	; 0x14
+a0307b00:	e50b0010 	str	r0, [fp, -#16]
+a0307b04:	e50b1014 	str	r1, [fp, -#20]
+a0307b08:	e50b2018 	str	r2, [fp, -#24]
+a0307b0c:	e51b3018 	ldr	r3, [fp, -#24]
+a0307b10:	e5933018 	ldr	r3, [r3, #24]
+a0307b14:	e3530000 	cmp	r3, #0	; 0x0
+a0307b18:	0a000042 	beq	a0307c28 <md5_process_bytes+0x138>
+a0307b1c:	e51b3018 	ldr	r3, [fp, -#24]
+a0307b20:	e5933018 	ldr	r3, [r3, #24]
+a0307b24:	e50b301c 	str	r3, [fp, -#28]
+a0307b28:	e51b301c 	ldr	r3, [fp, -#28]
+a0307b2c:	e2632080 	rsb	r2, r3, #128	; 0x80
+a0307b30:	e51b3014 	ldr	r3, [fp, -#20]
+a0307b34:	e1520003 	cmp	r2, r3
+a0307b38:	31a03002 	movcc	r3, r2
+a0307b3c:	e50b3020 	str	r3, [fp, -#32]
+a0307b40:	e51b2018 	ldr	r2, [fp, -#24]
+a0307b44:	e51b301c 	ldr	r3, [fp, -#28]
+a0307b48:	e0823003 	add	r3, r2, r3
+a0307b4c:	e283301c 	add	r3, r3, #28	; 0x1c
+a0307b50:	e1a00003 	mov	r0, r3
+a0307b54:	e51b1010 	ldr	r1, [fp, -#16]
+a0307b58:	e51b2020 	ldr	r2, [fp, -#32]
+a0307b5c:	eb000719 	bl	a03097c8 <memcpy>
+a0307b60:	e51b1018 	ldr	r1, [fp, -#24]
+a0307b64:	e51b3018 	ldr	r3, [fp, -#24]
+a0307b68:	e5932018 	ldr	r2, [r3, #24]
+a0307b6c:	e51b3020 	ldr	r3, [fp, -#32]
+a0307b70:	e0823003 	add	r3, r2, r3
+a0307b74:	e5813018 	str	r3, [r1, #24]
+a0307b78:	e51b201c 	ldr	r2, [fp, -#28]
+a0307b7c:	e51b3020 	ldr	r3, [fp, -#32]
+a0307b80:	e0823003 	add	r3, r2, r3
+a0307b84:	e3530040 	cmp	r3, #64	; 0x40
+a0307b88:	9a00001e 	bls	a0307c08 <md5_process_bytes+0x118>
+a0307b8c:	e51b3018 	ldr	r3, [fp, -#24]
+a0307b90:	e283101c 	add	r1, r3, #28	; 0x1c
+a0307b94:	e51b201c 	ldr	r2, [fp, -#28]
+a0307b98:	e51b3020 	ldr	r3, [fp, -#32]
+a0307b9c:	e0823003 	add	r3, r2, r3
+a0307ba0:	e3c3303f 	bic	r3, r3, #63	; 0x3f
+a0307ba4:	e1a00001 	mov	r0, r1
+a0307ba8:	e1a01003 	mov	r1, r3
+a0307bac:	e51b2018 	ldr	r2, [fp, -#24]
+a0307bb0:	eb00003a 	bl	a0307ca0 <md5_process_block>
+a0307bb4:	e51b3018 	ldr	r3, [fp, -#24]
+a0307bb8:	e283001c 	add	r0, r3, #28	; 0x1c
+a0307bbc:	e51b201c 	ldr	r2, [fp, -#28]
+a0307bc0:	e51b3020 	ldr	r3, [fp, -#32]
+a0307bc4:	e0823003 	add	r3, r2, r3
+a0307bc8:	e3c3203f 	bic	r2, r3, #63	; 0x3f
+a0307bcc:	e51b3018 	ldr	r3, [fp, -#24]
+a0307bd0:	e0823003 	add	r3, r2, r3
+a0307bd4:	e283101c 	add	r1, r3, #28	; 0x1c
+a0307bd8:	e51b201c 	ldr	r2, [fp, -#28]
+a0307bdc:	e51b3020 	ldr	r3, [fp, -#32]
+a0307be0:	e0823003 	add	r3, r2, r3
+a0307be4:	e203303f 	and	r3, r3, #63	; 0x3f
+a0307be8:	e1a02003 	mov	r2, r3
+a0307bec:	eb0006f5 	bl	a03097c8 <memcpy>
+a0307bf0:	e51b1018 	ldr	r1, [fp, -#24]
+a0307bf4:	e51b201c 	ldr	r2, [fp, -#28]
+a0307bf8:	e51b3020 	ldr	r3, [fp, -#32]
+a0307bfc:	e0823003 	add	r3, r2, r3
+a0307c00:	e203303f 	and	r3, r3, #63	; 0x3f
+a0307c04:	e5813018 	str	r3, [r1, #24]
+a0307c08:	e51b2010 	ldr	r2, [fp, -#16]
+a0307c0c:	e51b3020 	ldr	r3, [fp, -#32]
+a0307c10:	e0823003 	add	r3, r2, r3
+a0307c14:	e50b3010 	str	r3, [fp, -#16]
+a0307c18:	e51b2014 	ldr	r2, [fp, -#20]
+a0307c1c:	e51b3020 	ldr	r3, [fp, -#32]
+a0307c20:	e0633002 	rsb	r3, r3, r2
+a0307c24:	e50b3014 	str	r3, [fp, -#20]
+a0307c28:	e51b3014 	ldr	r3, [fp, -#20]
+a0307c2c:	e3530040 	cmp	r3, #64	; 0x40
+a0307c30:	9a00000d 	bls	a0307c6c <md5_process_bytes+0x17c>
+a0307c34:	e51b3014 	ldr	r3, [fp, -#20]
+a0307c38:	e3c3303f 	bic	r3, r3, #63	; 0x3f
+a0307c3c:	e51b0010 	ldr	r0, [fp, -#16]
+a0307c40:	e1a01003 	mov	r1, r3
+a0307c44:	e51b2018 	ldr	r2, [fp, -#24]
+a0307c48:	eb000014 	bl	a0307ca0 <md5_process_block>
+a0307c4c:	e51b3014 	ldr	r3, [fp, -#20]
+a0307c50:	e3c3203f 	bic	r2, r3, #63	; 0x3f
+a0307c54:	e51b3010 	ldr	r3, [fp, -#16]
+a0307c58:	e0833002 	add	r3, r3, r2
+a0307c5c:	e50b3010 	str	r3, [fp, -#16]
+a0307c60:	e51b3014 	ldr	r3, [fp, -#20]
+a0307c64:	e203303f 	and	r3, r3, #63	; 0x3f
+a0307c68:	e50b3014 	str	r3, [fp, -#20]
+a0307c6c:	e51b3014 	ldr	r3, [fp, -#20]
+a0307c70:	e3530000 	cmp	r3, #0	; 0x0
+a0307c74:	0a000008 	beq	a0307c9c <md5_process_bytes+0x1ac>
+a0307c78:	e51b3018 	ldr	r3, [fp, -#24]
+a0307c7c:	e283301c 	add	r3, r3, #28	; 0x1c
+a0307c80:	e1a00003 	mov	r0, r3
+a0307c84:	e51b1010 	ldr	r1, [fp, -#16]
+a0307c88:	e51b2014 	ldr	r2, [fp, -#20]
+a0307c8c:	eb0006cd 	bl	a03097c8 <memcpy>
+a0307c90:	e51b2018 	ldr	r2, [fp, -#24]
+a0307c94:	e51b3014 	ldr	r3, [fp, -#20]
+a0307c98:	e5823018 	str	r3, [r2, #24]
+a0307c9c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a0307ca0 <md5_process_block>:
+a0307ca0:	e1a0c00d 	mov	ip, sp
+a0307ca4:	e92dd810 	stmdb	sp!, {r4, fp, ip, lr, pc}
+a0307ca8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0307cac:	e24dd07c 	sub	sp, sp, #124	; 0x7c
+a0307cb0:	e50b0014 	str	r0, [fp, -#20]
+a0307cb4:	e50b1018 	str	r1, [fp, -#24]
+a0307cb8:	e50b201c 	str	r2, [fp, -#28]
+a0307cbc:	e51b3014 	ldr	r3, [fp, -#20]
+a0307cc0:	e50b3060 	str	r3, [fp, -#96]
+a0307cc4:	e51b3018 	ldr	r3, [fp, -#24]
+a0307cc8:	e1a03123 	mov	r3, r3, lsr #2
+a0307ccc:	e50b3064 	str	r3, [fp, -#100]
+a0307cd0:	e51b3064 	ldr	r3, [fp, -#100]
+a0307cd4:	e1a02103 	mov	r2, r3, lsl #2
+a0307cd8:	e51b3060 	ldr	r3, [fp, -#96]
+a0307cdc:	e0833002 	add	r3, r3, r2
+a0307ce0:	e50b3068 	str	r3, [fp, -#104]
+a0307ce4:	e51b301c 	ldr	r3, [fp, -#28]
+a0307ce8:	e5933000 	ldr	r3, [r3]
+a0307cec:	e50b306c 	str	r3, [fp, -#108]
+a0307cf0:	e51b301c 	ldr	r3, [fp, -#28]
+a0307cf4:	e5933004 	ldr	r3, [r3, #4]
+a0307cf8:	e50b3070 	str	r3, [fp, -#112]
+a0307cfc:	e51b301c 	ldr	r3, [fp, -#28]
+a0307d00:	e5933008 	ldr	r3, [r3, #8]
+a0307d04:	e50b3074 	str	r3, [fp, -#116]
+a0307d08:	e51b301c 	ldr	r3, [fp, -#28]
+a0307d0c:	e593300c 	ldr	r3, [r3, #12]
+a0307d10:	e50b3078 	str	r3, [fp, -#120]
+a0307d14:	e51b101c 	ldr	r1, [fp, -#28]
+a0307d18:	e51b301c 	ldr	r3, [fp, -#28]
+a0307d1c:	e5932010 	ldr	r2, [r3, #16]
+a0307d20:	e51b3018 	ldr	r3, [fp, -#24]
+a0307d24:	e0823003 	add	r3, r2, r3
+a0307d28:	e5813010 	str	r3, [r1, #16]
+a0307d2c:	e51b301c 	ldr	r3, [fp, -#28]
+a0307d30:	e5932010 	ldr	r2, [r3, #16]
+a0307d34:	e51b3018 	ldr	r3, [fp, -#24]
+a0307d38:	e1520003 	cmp	r2, r3
+a0307d3c:	2a000004 	bcs	a0307d54 <md5_process_block+0xb4>
+a0307d40:	e51b201c 	ldr	r2, [fp, -#28]
+a0307d44:	e51b301c 	ldr	r3, [fp, -#28]
+a0307d48:	e5933014 	ldr	r3, [r3, #20]
+a0307d4c:	e2833001 	add	r3, r3, #1	; 0x1
+a0307d50:	e5823014 	str	r3, [r2, #20]
+a0307d54:	e1a00000 	nop			(mov r0,r0)
+a0307d58:	e51b2060 	ldr	r2, [fp, -#96]
+a0307d5c:	e51b3068 	ldr	r3, [fp, -#104]
+a0307d60:	e1520003 	cmp	r2, r3
+a0307d64:	3a000000 	bcc	a0307d6c <md5_process_block+0xcc>
+a0307d68:	ea00064b 	b	a030969c <md5_process_block+0x19fc>
+a0307d6c:	e24b305c 	sub	r3, fp, #92	; 0x5c
+a0307d70:	e50b307c 	str	r3, [fp, -#124]
+a0307d74:	e51b306c 	ldr	r3, [fp, -#108]
+a0307d78:	e50b3080 	str	r3, [fp, -#128]
+a0307d7c:	e51b3070 	ldr	r3, [fp, -#112]
+a0307d80:	e50b3084 	str	r3, [fp, -#132]
+a0307d84:	e51b3074 	ldr	r3, [fp, -#116]
+a0307d88:	e50b3088 	str	r3, [fp, -#136]
+a0307d8c:	e51b3078 	ldr	r3, [fp, -#120]
+a0307d90:	e50b308c 	str	r3, [fp, -#140]
+a0307d94:	e51b2074 	ldr	r2, [fp, -#116]
+a0307d98:	e51b3078 	ldr	r3, [fp, -#120]
+a0307d9c:	e0222003 	eor	r2, r2, r3
+a0307da0:	e51b3070 	ldr	r3, [fp, -#112]
+a0307da4:	e0022003 	and	r2, r2, r3
+a0307da8:	e51b3078 	ldr	r3, [fp, -#120]
+a0307dac:	e0220003 	eor	r0, r2, r3
+a0307db0:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0307db4:	e5941000 	ldr	r1, [r4]
+a0307db8:	e51b3060 	ldr	r3, [fp, -#96]
+a0307dbc:	e1a02001 	mov	r2, r1
+a0307dc0:	e5933000 	ldr	r3, [r3]
+a0307dc4:	e5823000 	str	r3, [r2]
+a0307dc8:	e5923000 	ldr	r3, [r2]
+a0307dcc:	e0802003 	add	r2, r0, r3
+a0307dd0:	e51b306c 	ldr	r3, [fp, -#108]
+a0307dd4:	e0823003 	add	r3, r2, r3
+a0307dd8:	e24335a2 	sub	r3, r3, #679477248	; 0x28800000
+a0307ddc:	e2433955 	sub	r3, r3, #1392640	; 0x154000
+a0307de0:	e2433d6e 	sub	r3, r3, #7040	; 0x1b80
+a0307de4:	e2433008 	sub	r3, r3, #8	; 0x8
+a0307de8:	e50b306c 	str	r3, [fp, -#108]
+a0307dec:	e2811004 	add	r1, r1, #4	; 0x4
+a0307df0:	e5841000 	str	r1, [r4]
+a0307df4:	e51b3060 	ldr	r3, [fp, -#96]
+a0307df8:	e2833004 	add	r3, r3, #4	; 0x4
+a0307dfc:	e50b3060 	str	r3, [fp, -#96]
+a0307e00:	e51b306c 	ldr	r3, [fp, -#108]
+a0307e04:	e1a03ce3 	mov	r3, r3, ror #25
+a0307e08:	e50b306c 	str	r3, [fp, -#108]
+a0307e0c:	e51b206c 	ldr	r2, [fp, -#108]
+a0307e10:	e51b3070 	ldr	r3, [fp, -#112]
+a0307e14:	e0823003 	add	r3, r2, r3
+a0307e18:	e50b306c 	str	r3, [fp, -#108]
+a0307e1c:	e51b2070 	ldr	r2, [fp, -#112]
+a0307e20:	e51b3074 	ldr	r3, [fp, -#116]
+a0307e24:	e0222003 	eor	r2, r2, r3
+a0307e28:	e51b306c 	ldr	r3, [fp, -#108]
+a0307e2c:	e0022003 	and	r2, r2, r3
+a0307e30:	e51b3074 	ldr	r3, [fp, -#116]
+a0307e34:	e0220003 	eor	r0, r2, r3
+a0307e38:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0307e3c:	e5941000 	ldr	r1, [r4]
+a0307e40:	e51b3060 	ldr	r3, [fp, -#96]
+a0307e44:	e1a02001 	mov	r2, r1
+a0307e48:	e5933000 	ldr	r3, [r3]
+a0307e4c:	e5823000 	str	r3, [r2]
+a0307e50:	e5923000 	ldr	r3, [r2]
+a0307e54:	e0802003 	add	r2, r0, r3
+a0307e58:	e51b3078 	ldr	r3, [fp, -#120]
+a0307e5c:	e0823003 	add	r3, r2, r3
+a0307e60:	e28334e9 	add	r3, r3, #-385875968	; 0xe9000000
+a0307e64:	e24339e1 	sub	r3, r3, #3686400	; 0x384000
+a0307e68:	e2433e8a 	sub	r3, r3, #2208	; 0x8a0
+a0307e6c:	e243300a 	sub	r3, r3, #10	; 0xa
+a0307e70:	e50b3078 	str	r3, [fp, -#120]
+a0307e74:	e2811004 	add	r1, r1, #4	; 0x4
+a0307e78:	e5841000 	str	r1, [r4]
+a0307e7c:	e51b3060 	ldr	r3, [fp, -#96]
+a0307e80:	e2833004 	add	r3, r3, #4	; 0x4
+a0307e84:	e50b3060 	str	r3, [fp, -#96]
+a0307e88:	e51b3078 	ldr	r3, [fp, -#120]
+a0307e8c:	e1a03a63 	mov	r3, r3, ror #20
+a0307e90:	e50b3078 	str	r3, [fp, -#120]
+a0307e94:	e51b2078 	ldr	r2, [fp, -#120]
+a0307e98:	e51b306c 	ldr	r3, [fp, -#108]
+a0307e9c:	e0823003 	add	r3, r2, r3
+a0307ea0:	e50b3078 	str	r3, [fp, -#120]
+a0307ea4:	e51b206c 	ldr	r2, [fp, -#108]
+a0307ea8:	e51b3070 	ldr	r3, [fp, -#112]
+a0307eac:	e0222003 	eor	r2, r2, r3
+a0307eb0:	e51b3078 	ldr	r3, [fp, -#120]
+a0307eb4:	e0022003 	and	r2, r2, r3
+a0307eb8:	e51b3070 	ldr	r3, [fp, -#112]
+a0307ebc:	e0220003 	eor	r0, r2, r3
+a0307ec0:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0307ec4:	e5941000 	ldr	r1, [r4]
+a0307ec8:	e51b3060 	ldr	r3, [fp, -#96]
+a0307ecc:	e1a02001 	mov	r2, r1
+a0307ed0:	e5933000 	ldr	r3, [r3]
+a0307ed4:	e5823000 	str	r3, [r2]
+a0307ed8:	e5923000 	ldr	r3, [r2]
+a0307edc:	e0802003 	add	r2, r0, r3
+a0307ee0:	e51b3074 	ldr	r3, [fp, -#116]
+a0307ee4:	e0823003 	add	r3, r2, r3
+a0307ee8:	e2833309 	add	r3, r3, #603979776	; 0x24000000
+a0307eec:	e2833981 	add	r3, r3, #2113536	; 0x204000
+a0307ef0:	e2833dc3 	add	r3, r3, #12480	; 0x30c0
+a0307ef4:	e283301b 	add	r3, r3, #27	; 0x1b
+a0307ef8:	e50b3074 	str	r3, [fp, -#116]
+a0307efc:	e2811004 	add	r1, r1, #4	; 0x4
+a0307f00:	e5841000 	str	r1, [r4]
+a0307f04:	e51b3060 	ldr	r3, [fp, -#96]
+a0307f08:	e2833004 	add	r3, r3, #4	; 0x4
+a0307f0c:	e50b3060 	str	r3, [fp, -#96]
+a0307f10:	e51b3074 	ldr	r3, [fp, -#116]
+a0307f14:	e1a037e3 	mov	r3, r3, ror #15
+a0307f18:	e50b3074 	str	r3, [fp, -#116]
+a0307f1c:	e51b2074 	ldr	r2, [fp, -#116]
+a0307f20:	e51b3078 	ldr	r3, [fp, -#120]
+a0307f24:	e0823003 	add	r3, r2, r3
+a0307f28:	e50b3074 	str	r3, [fp, -#116]
+a0307f2c:	e51b2078 	ldr	r2, [fp, -#120]
+a0307f30:	e51b306c 	ldr	r3, [fp, -#108]
+a0307f34:	e0222003 	eor	r2, r2, r3
+a0307f38:	e51b3074 	ldr	r3, [fp, -#116]
+a0307f3c:	e0022003 	and	r2, r2, r3
+a0307f40:	e51b306c 	ldr	r3, [fp, -#108]
+a0307f44:	e0220003 	eor	r0, r2, r3
+a0307f48:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0307f4c:	e5941000 	ldr	r1, [r4]
+a0307f50:	e51b3060 	ldr	r3, [fp, -#96]
+a0307f54:	e1a02001 	mov	r2, r1
+a0307f58:	e5933000 	ldr	r3, [r3]
+a0307f5c:	e5823000 	str	r3, [r2]
+a0307f60:	e5923000 	ldr	r3, [r2]
+a0307f64:	e0802003 	add	r2, r0, r3
+a0307f68:	e51b3070 	ldr	r3, [fp, -#112]
+a0307f6c:	e0823003 	add	r3, r2, r3
+a0307f70:	e24335f9 	sub	r3, r3, #1044381696	; 0x3e400000
+a0307f74:	e2433a23 	sub	r3, r3, #143360	; 0x23000
+a0307f78:	e2433e11 	sub	r3, r3, #272	; 0x110
+a0307f7c:	e2433002 	sub	r3, r3, #2	; 0x2
+a0307f80:	e50b3070 	str	r3, [fp, -#112]
+a0307f84:	e2811004 	add	r1, r1, #4	; 0x4
+a0307f88:	e5841000 	str	r1, [r4]
+a0307f8c:	e51b3060 	ldr	r3, [fp, -#96]
+a0307f90:	e2833004 	add	r3, r3, #4	; 0x4
+a0307f94:	e50b3060 	str	r3, [fp, -#96]
+a0307f98:	e51b3070 	ldr	r3, [fp, -#112]
+a0307f9c:	e1a03563 	mov	r3, r3, ror #10
+a0307fa0:	e50b3070 	str	r3, [fp, -#112]
+a0307fa4:	e51b2070 	ldr	r2, [fp, -#112]
+a0307fa8:	e51b3074 	ldr	r3, [fp, -#116]
+a0307fac:	e0823003 	add	r3, r2, r3
+a0307fb0:	e50b3070 	str	r3, [fp, -#112]
+a0307fb4:	e51b2074 	ldr	r2, [fp, -#116]
+a0307fb8:	e51b3078 	ldr	r3, [fp, -#120]
+a0307fbc:	e0222003 	eor	r2, r2, r3
+a0307fc0:	e51b3070 	ldr	r3, [fp, -#112]
+a0307fc4:	e0022003 	and	r2, r2, r3
+a0307fc8:	e51b3078 	ldr	r3, [fp, -#120]
+a0307fcc:	e0220003 	eor	r0, r2, r3
+a0307fd0:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0307fd4:	e5941000 	ldr	r1, [r4]
+a0307fd8:	e51b3060 	ldr	r3, [fp, -#96]
+a0307fdc:	e1a02001 	mov	r2, r1
+a0307fe0:	e5933000 	ldr	r3, [r3]
+a0307fe4:	e5823000 	str	r3, [r2]
+a0307fe8:	e5923000 	ldr	r3, [r2]
+a0307fec:	e0802003 	add	r2, r0, r3
+a0307ff0:	e51b306c 	ldr	r3, [fp, -#108]
+a0307ff4:	e0823003 	add	r3, r2, r3
+a0307ff8:	e243352a 	sub	r3, r3, #176160768	; 0xa800000
+a0307ffc:	e2433a3f 	sub	r3, r3, #258048	; 0x3f000
+a0308000:	e2433051 	sub	r3, r3, #81	; 0x51
+a0308004:	e50b306c 	str	r3, [fp, -#108]
+a0308008:	e2811004 	add	r1, r1, #4	; 0x4
+a030800c:	e5841000 	str	r1, [r4]
+a0308010:	e51b3060 	ldr	r3, [fp, -#96]
+a0308014:	e2833004 	add	r3, r3, #4	; 0x4
+a0308018:	e50b3060 	str	r3, [fp, -#96]
+a030801c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308020:	e1a03ce3 	mov	r3, r3, ror #25
+a0308024:	e50b306c 	str	r3, [fp, -#108]
+a0308028:	e51b206c 	ldr	r2, [fp, -#108]
+a030802c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308030:	e0823003 	add	r3, r2, r3
+a0308034:	e50b306c 	str	r3, [fp, -#108]
+a0308038:	e51b2070 	ldr	r2, [fp, -#112]
+a030803c:	e51b3074 	ldr	r3, [fp, -#116]
+a0308040:	e0222003 	eor	r2, r2, r3
+a0308044:	e51b306c 	ldr	r3, [fp, -#108]
+a0308048:	e0022003 	and	r2, r2, r3
+a030804c:	e51b3074 	ldr	r3, [fp, -#116]
+a0308050:	e0220003 	eor	r0, r2, r3
+a0308054:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0308058:	e5941000 	ldr	r1, [r4]
+a030805c:	e51b3060 	ldr	r3, [fp, -#96]
+a0308060:	e1a02001 	mov	r2, r1
+a0308064:	e5933000 	ldr	r3, [r3]
+a0308068:	e5823000 	str	r3, [r2]
+a030806c:	e5923000 	ldr	r3, [r2]
+a0308070:	e0802003 	add	r2, r0, r3
+a0308074:	e51b3078 	ldr	r3, [fp, -#120]
+a0308078:	e0823003 	add	r3, r2, r3
+a030807c:	e2833447 	add	r3, r3, #1191182336	; 0x47000000
+a0308080:	e2833887 	add	r3, r3, #8847360	; 0x870000
+a0308084:	e2833cc6 	add	r3, r3, #50688	; 0xc600
+a0308088:	e283302a 	add	r3, r3, #42	; 0x2a
+a030808c:	e50b3078 	str	r3, [fp, -#120]
+a0308090:	e2811004 	add	r1, r1, #4	; 0x4
+a0308094:	e5841000 	str	r1, [r4]
+a0308098:	e51b3060 	ldr	r3, [fp, -#96]
+a030809c:	e2833004 	add	r3, r3, #4	; 0x4
+a03080a0:	e50b3060 	str	r3, [fp, -#96]
+a03080a4:	e51b3078 	ldr	r3, [fp, -#120]
+a03080a8:	e1a03a63 	mov	r3, r3, ror #20
+a03080ac:	e50b3078 	str	r3, [fp, -#120]
+a03080b0:	e51b2078 	ldr	r2, [fp, -#120]
+a03080b4:	e51b306c 	ldr	r3, [fp, -#108]
+a03080b8:	e0823003 	add	r3, r2, r3
+a03080bc:	e50b3078 	str	r3, [fp, -#120]
+a03080c0:	e51b206c 	ldr	r2, [fp, -#108]
+a03080c4:	e51b3070 	ldr	r3, [fp, -#112]
+a03080c8:	e0222003 	eor	r2, r2, r3
+a03080cc:	e51b3078 	ldr	r3, [fp, -#120]
+a03080d0:	e0022003 	and	r2, r2, r3
+a03080d4:	e51b3070 	ldr	r3, [fp, -#112]
+a03080d8:	e0220003 	eor	r0, r2, r3
+a03080dc:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a03080e0:	e5941000 	ldr	r1, [r4]
+a03080e4:	e51b3060 	ldr	r3, [fp, -#96]
+a03080e8:	e1a02001 	mov	r2, r1
+a03080ec:	e5933000 	ldr	r3, [r3]
+a03080f0:	e5823000 	str	r3, [r2]
+a03080f4:	e5923000 	ldr	r3, [r2]
+a03080f8:	e0802003 	add	r2, r0, r3
+a03080fc:	e51b3074 	ldr	r3, [fp, -#116]
+a0308100:	e0823003 	add	r3, r2, r3
+a0308104:	e283332a 	add	r3, r3, #-1476395008	; 0xa8000000
+a0308108:	e28339c1 	add	r3, r3, #3162112	; 0x304000
+a030810c:	e2833e61 	add	r3, r3, #1552	; 0x610
+a0308110:	e2833003 	add	r3, r3, #3	; 0x3
+a0308114:	e50b3074 	str	r3, [fp, -#116]
+a0308118:	e2811004 	add	r1, r1, #4	; 0x4
+a030811c:	e5841000 	str	r1, [r4]
+a0308120:	e51b3060 	ldr	r3, [fp, -#96]
+a0308124:	e2833004 	add	r3, r3, #4	; 0x4
+a0308128:	e50b3060 	str	r3, [fp, -#96]
+a030812c:	e51b3074 	ldr	r3, [fp, -#116]
+a0308130:	e1a037e3 	mov	r3, r3, ror #15
+a0308134:	e50b3074 	str	r3, [fp, -#116]
+a0308138:	e51b2074 	ldr	r2, [fp, -#116]
+a030813c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308140:	e0823003 	add	r3, r2, r3
+a0308144:	e50b3074 	str	r3, [fp, -#116]
+a0308148:	e51b2078 	ldr	r2, [fp, -#120]
+a030814c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308150:	e0222003 	eor	r2, r2, r3
+a0308154:	e51b3074 	ldr	r3, [fp, -#116]
+a0308158:	e0022003 	and	r2, r2, r3
+a030815c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308160:	e0220003 	eor	r0, r2, r3
+a0308164:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0308168:	e5941000 	ldr	r1, [r4]
+a030816c:	e51b3060 	ldr	r3, [fp, -#96]
+a0308170:	e1a02001 	mov	r2, r1
+a0308174:	e5933000 	ldr	r3, [r3]
+a0308178:	e5823000 	str	r3, [r2]
+a030817c:	e5923000 	ldr	r3, [r2]
+a0308180:	e0802003 	add	r2, r0, r3
+a0308184:	e51b3070 	ldr	r3, [fp, -#112]
+a0308188:	e0823003 	add	r3, r2, r3
+a030818c:	e28334fd 	add	r3, r3, #-50331648	; 0xfd000000
+a0308190:	e2833846 	add	r3, r3, #4587520	; 0x460000
+a0308194:	e2833c95 	add	r3, r3, #38144	; 0x9500
+a0308198:	e2833001 	add	r3, r3, #1	; 0x1
+a030819c:	e50b3070 	str	r3, [fp, -#112]
+a03081a0:	e2811004 	add	r1, r1, #4	; 0x4
+a03081a4:	e5841000 	str	r1, [r4]
+a03081a8:	e51b3060 	ldr	r3, [fp, -#96]
+a03081ac:	e2833004 	add	r3, r3, #4	; 0x4
+a03081b0:	e50b3060 	str	r3, [fp, -#96]
+a03081b4:	e51b3070 	ldr	r3, [fp, -#112]
+a03081b8:	e1a03563 	mov	r3, r3, ror #10
+a03081bc:	e50b3070 	str	r3, [fp, -#112]
+a03081c0:	e51b2070 	ldr	r2, [fp, -#112]
+a03081c4:	e51b3074 	ldr	r3, [fp, -#116]
+a03081c8:	e0823003 	add	r3, r2, r3
+a03081cc:	e50b3070 	str	r3, [fp, -#112]
+a03081d0:	e51b2074 	ldr	r2, [fp, -#116]
+a03081d4:	e51b3078 	ldr	r3, [fp, -#120]
+a03081d8:	e0222003 	eor	r2, r2, r3
+a03081dc:	e51b3070 	ldr	r3, [fp, -#112]
+a03081e0:	e0022003 	and	r2, r2, r3
+a03081e4:	e51b3078 	ldr	r3, [fp, -#120]
+a03081e8:	e0220003 	eor	r0, r2, r3
+a03081ec:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a03081f0:	e5941000 	ldr	r1, [r4]
+a03081f4:	e51b3060 	ldr	r3, [fp, -#96]
+a03081f8:	e1a02001 	mov	r2, r1
+a03081fc:	e5933000 	ldr	r3, [r3]
+a0308200:	e5823000 	str	r3, [r2]
+a0308204:	e5923000 	ldr	r3, [r2]
+a0308208:	e0802003 	add	r2, r0, r3
+a030820c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308210:	e0823003 	add	r3, r2, r3
+a0308214:	e2833469 	add	r3, r3, #1761607680	; 0x69000000
+a0308218:	e2833502 	add	r3, r3, #8388608	; 0x800000
+a030821c:	e2833b26 	add	r3, r3, #38912	; 0x9800
+a0308220:	e28330d8 	add	r3, r3, #216	; 0xd8
+a0308224:	e50b306c 	str	r3, [fp, -#108]
+a0308228:	e2811004 	add	r1, r1, #4	; 0x4
+a030822c:	e5841000 	str	r1, [r4]
+a0308230:	e51b3060 	ldr	r3, [fp, -#96]
+a0308234:	e2833004 	add	r3, r3, #4	; 0x4
+a0308238:	e50b3060 	str	r3, [fp, -#96]
+a030823c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308240:	e1a03ce3 	mov	r3, r3, ror #25
+a0308244:	e50b306c 	str	r3, [fp, -#108]
+a0308248:	e51b206c 	ldr	r2, [fp, -#108]
+a030824c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308250:	e0823003 	add	r3, r2, r3
+a0308254:	e50b306c 	str	r3, [fp, -#108]
+a0308258:	e51b2070 	ldr	r2, [fp, -#112]
+a030825c:	e51b3074 	ldr	r3, [fp, -#116]
+a0308260:	e0222003 	eor	r2, r2, r3
+a0308264:	e51b306c 	ldr	r3, [fp, -#108]
+a0308268:	e0022003 	and	r2, r2, r3
+a030826c:	e51b3074 	ldr	r3, [fp, -#116]
+a0308270:	e0220003 	eor	r0, r2, r3
+a0308274:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0308278:	e5941000 	ldr	r1, [r4]
+a030827c:	e51b3060 	ldr	r3, [fp, -#96]
+a0308280:	e1a02001 	mov	r2, r1
+a0308284:	e5933000 	ldr	r3, [r3]
+a0308288:	e5823000 	str	r3, [r2]
+a030828c:	e5923000 	ldr	r3, [r2]
+a0308290:	e0802003 	add	r2, r0, r3
+a0308294:	e51b3078 	ldr	r3, [fp, -#120]
+a0308298:	e0823003 	add	r3, r2, r3
+a030829c:	e2433e85 	sub	r3, r3, #2128	; 0x850
+a03082a0:	e243335d 	sub	r3, r3, #1946157057	; 0x74000001
+a03082a4:	e24338bb 	sub	r3, r3, #12255232	; 0xbb0000
+a03082a8:	e50b3078 	str	r3, [fp, -#120]
+a03082ac:	e2811004 	add	r1, r1, #4	; 0x4
+a03082b0:	e5841000 	str	r1, [r4]
+a03082b4:	e51b3060 	ldr	r3, [fp, -#96]
+a03082b8:	e2833004 	add	r3, r3, #4	; 0x4
+a03082bc:	e50b3060 	str	r3, [fp, -#96]
+a03082c0:	e51b3078 	ldr	r3, [fp, -#120]
+a03082c4:	e1a03a63 	mov	r3, r3, ror #20
+a03082c8:	e50b3078 	str	r3, [fp, -#120]
+a03082cc:	e51b2078 	ldr	r2, [fp, -#120]
+a03082d0:	e51b306c 	ldr	r3, [fp, -#108]
+a03082d4:	e0823003 	add	r3, r2, r3
+a03082d8:	e50b3078 	str	r3, [fp, -#120]
+a03082dc:	e51b206c 	ldr	r2, [fp, -#108]
+a03082e0:	e51b3070 	ldr	r3, [fp, -#112]
+a03082e4:	e0222003 	eor	r2, r2, r3
+a03082e8:	e51b3078 	ldr	r3, [fp, -#120]
+a03082ec:	e0022003 	and	r2, r2, r3
+a03082f0:	e51b3070 	ldr	r3, [fp, -#112]
+a03082f4:	e0220003 	eor	r0, r2, r3
+a03082f8:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a03082fc:	e5941000 	ldr	r1, [r4]
+a0308300:	e51b3060 	ldr	r3, [fp, -#96]
+a0308304:	e1a02001 	mov	r2, r1
+a0308308:	e5933000 	ldr	r3, [r3]
+a030830c:	e5823000 	str	r3, [r2]
+a0308310:	e5923000 	ldr	r3, [r2]
+a0308314:	e0802003 	add	r2, r0, r3
+a0308318:	e51b3074 	ldr	r3, [fp, -#116]
+a030831c:	e0823003 	add	r3, r2, r3
+a0308320:	e2433b29 	sub	r3, r3, #41984	; 0xa400
+a0308324:	e243304f 	sub	r3, r3, #79	; 0x4f
+a0308328:	e50b3074 	str	r3, [fp, -#116]
+a030832c:	e2811004 	add	r1, r1, #4	; 0x4
+a0308330:	e5841000 	str	r1, [r4]
+a0308334:	e51b3060 	ldr	r3, [fp, -#96]
+a0308338:	e2833004 	add	r3, r3, #4	; 0x4
+a030833c:	e50b3060 	str	r3, [fp, -#96]
+a0308340:	e51b3074 	ldr	r3, [fp, -#116]
+a0308344:	e1a037e3 	mov	r3, r3, ror #15
+a0308348:	e50b3074 	str	r3, [fp, -#116]
+a030834c:	e51b2074 	ldr	r2, [fp, -#116]
+a0308350:	e51b3078 	ldr	r3, [fp, -#120]
+a0308354:	e0823003 	add	r3, r2, r3
+a0308358:	e50b3074 	str	r3, [fp, -#116]
+a030835c:	e51b2078 	ldr	r2, [fp, -#120]
+a0308360:	e51b306c 	ldr	r3, [fp, -#108]
+a0308364:	e0222003 	eor	r2, r2, r3
+a0308368:	e51b3074 	ldr	r3, [fp, -#116]
+a030836c:	e0022003 	and	r2, r2, r3
+a0308370:	e51b306c 	ldr	r3, [fp, -#108]
+a0308374:	e0220003 	eor	r0, r2, r3
+a0308378:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a030837c:	e5941000 	ldr	r1, [r4]
+a0308380:	e51b3060 	ldr	r3, [fp, -#96]
+a0308384:	e1a02001 	mov	r2, r1
+a0308388:	e5933000 	ldr	r3, [r3]
+a030838c:	e5823000 	str	r3, [r2]
+a0308390:	e5923000 	ldr	r3, [r2]
+a0308394:	e0802003 	add	r2, r0, r3
+a0308398:	e51b3070 	ldr	r3, [fp, -#112]
+a030839c:	e0823003 	add	r3, r2, r3
+a03083a0:	e283348a 	add	r3, r3, #-1979711488	; 0x8a000000
+a03083a4:	e24338a3 	sub	r3, r3, #10682368	; 0xa30000
+a03083a8:	e2433da1 	sub	r3, r3, #10304	; 0x2840
+a03083ac:	e2433002 	sub	r3, r3, #2	; 0x2
+a03083b0:	e50b3070 	str	r3, [fp, -#112]
+a03083b4:	e2811004 	add	r1, r1, #4	; 0x4
+a03083b8:	e5841000 	str	r1, [r4]
+a03083bc:	e51b3060 	ldr	r3, [fp, -#96]
+a03083c0:	e2833004 	add	r3, r3, #4	; 0x4
+a03083c4:	e50b3060 	str	r3, [fp, -#96]
+a03083c8:	e51b3070 	ldr	r3, [fp, -#112]
+a03083cc:	e1a03563 	mov	r3, r3, ror #10
+a03083d0:	e50b3070 	str	r3, [fp, -#112]
+a03083d4:	e51b2070 	ldr	r2, [fp, -#112]
+a03083d8:	e51b3074 	ldr	r3, [fp, -#116]
+a03083dc:	e0823003 	add	r3, r2, r3
+a03083e0:	e50b3070 	str	r3, [fp, -#112]
+a03083e4:	e51b2074 	ldr	r2, [fp, -#116]
+a03083e8:	e51b3078 	ldr	r3, [fp, -#120]
+a03083ec:	e0222003 	eor	r2, r2, r3
+a03083f0:	e51b3070 	ldr	r3, [fp, -#112]
+a03083f4:	e0022003 	and	r2, r2, r3
+a03083f8:	e51b3078 	ldr	r3, [fp, -#120]
+a03083fc:	e0220003 	eor	r0, r2, r3
+a0308400:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0308404:	e5941000 	ldr	r1, [r4]
+a0308408:	e51b3060 	ldr	r3, [fp, -#96]
+a030840c:	e1a02001 	mov	r2, r1
+a0308410:	e5933000 	ldr	r3, [r3]
+a0308414:	e5823000 	str	r3, [r2]
+a0308418:	e5923000 	ldr	r3, [r2]
+a030841c:	e0802003 	add	r2, r0, r3
+a0308420:	e51b306c 	ldr	r3, [fp, -#108]
+a0308424:	e0823003 	add	r3, r2, r3
+a0308428:	e283346b 	add	r3, r3, #1795162112	; 0x6b000000
+a030842c:	e2833609 	add	r3, r3, #9437184	; 0x900000
+a0308430:	e2833c11 	add	r3, r3, #4352	; 0x1100
+a0308434:	e2833022 	add	r3, r3, #34	; 0x22
+a0308438:	e50b306c 	str	r3, [fp, -#108]
+a030843c:	e2811004 	add	r1, r1, #4	; 0x4
+a0308440:	e5841000 	str	r1, [r4]
+a0308444:	e51b3060 	ldr	r3, [fp, -#96]
+a0308448:	e2833004 	add	r3, r3, #4	; 0x4
+a030844c:	e50b3060 	str	r3, [fp, -#96]
+a0308450:	e51b306c 	ldr	r3, [fp, -#108]
+a0308454:	e1a03ce3 	mov	r3, r3, ror #25
+a0308458:	e50b306c 	str	r3, [fp, -#108]
+a030845c:	e51b206c 	ldr	r2, [fp, -#108]
+a0308460:	e51b3070 	ldr	r3, [fp, -#112]
+a0308464:	e0823003 	add	r3, r2, r3
+a0308468:	e50b306c 	str	r3, [fp, -#108]
+a030846c:	e51b2070 	ldr	r2, [fp, -#112]
+a0308470:	e51b3074 	ldr	r3, [fp, -#116]
+a0308474:	e0222003 	eor	r2, r2, r3
+a0308478:	e51b306c 	ldr	r3, [fp, -#108]
+a030847c:	e0022003 	and	r2, r2, r3
+a0308480:	e51b3074 	ldr	r3, [fp, -#116]
+a0308484:	e0220003 	eor	r0, r2, r3
+a0308488:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a030848c:	e5941000 	ldr	r1, [r4]
+a0308490:	e51b3060 	ldr	r3, [fp, -#96]
+a0308494:	e1a02001 	mov	r2, r1
+a0308498:	e5933000 	ldr	r3, [r3]
+a030849c:	e5823000 	str	r3, [r2]
+a03084a0:	e5923000 	ldr	r3, [r2]
+a03084a4:	e0802003 	add	r2, r0, r3
+a03084a8:	e51b3078 	ldr	r3, [fp, -#120]
+a03084ac:	e0823003 	add	r3, r2, r3
+a03084b0:	e2433799 	sub	r3, r3, #40108032	; 0x2640000
+a03084b4:	e2433be3 	sub	r3, r3, #232448	; 0x38c00
+a03084b8:	e2433f9b 	sub	r3, r3, #620	; 0x26c
+a03084bc:	e2433001 	sub	r3, r3, #1	; 0x1
+a03084c0:	e50b3078 	str	r3, [fp, -#120]
+a03084c4:	e2811004 	add	r1, r1, #4	; 0x4
+a03084c8:	e5841000 	str	r1, [r4]
+a03084cc:	e51b3060 	ldr	r3, [fp, -#96]
+a03084d0:	e2833004 	add	r3, r3, #4	; 0x4
+a03084d4:	e50b3060 	str	r3, [fp, -#96]
+a03084d8:	e51b3078 	ldr	r3, [fp, -#120]
+a03084dc:	e1a03a63 	mov	r3, r3, ror #20
+a03084e0:	e50b3078 	str	r3, [fp, -#120]
+a03084e4:	e51b2078 	ldr	r2, [fp, -#120]
+a03084e8:	e51b306c 	ldr	r3, [fp, -#108]
+a03084ec:	e0823003 	add	r3, r2, r3
+a03084f0:	e50b3078 	str	r3, [fp, -#120]
+a03084f4:	e51b206c 	ldr	r2, [fp, -#108]
+a03084f8:	e51b3070 	ldr	r3, [fp, -#112]
+a03084fc:	e0222003 	eor	r2, r2, r3
+a0308500:	e51b3078 	ldr	r3, [fp, -#120]
+a0308504:	e0022003 	and	r2, r2, r3
+a0308508:	e51b3070 	ldr	r3, [fp, -#112]
+a030850c:	e0220003 	eor	r0, r2, r3
+a0308510:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a0308514:	e5941000 	ldr	r1, [r4]
+a0308518:	e51b3060 	ldr	r3, [fp, -#96]
+a030851c:	e1a02001 	mov	r2, r1
+a0308520:	e5933000 	ldr	r3, [r3]
+a0308524:	e5823000 	str	r3, [r2]
+a0308528:	e5923000 	ldr	r3, [r2]
+a030852c:	e0802003 	add	r2, r0, r3
+a0308530:	e51b3074 	ldr	r3, [fp, -#116]
+a0308534:	e0823003 	add	r3, r2, r3
+a0308538:	e28334a6 	add	r3, r3, #-1509949440	; 0xa6000000
+a030853c:	e2833879 	add	r3, r3, #7929856	; 0x790000
+a0308540:	e2833c43 	add	r3, r3, #17152	; 0x4300
+a0308544:	e283308e 	add	r3, r3, #142	; 0x8e
+a0308548:	e50b3074 	str	r3, [fp, -#116]
+a030854c:	e2811004 	add	r1, r1, #4	; 0x4
+a0308550:	e5841000 	str	r1, [r4]
+a0308554:	e51b3060 	ldr	r3, [fp, -#96]
+a0308558:	e2833004 	add	r3, r3, #4	; 0x4
+a030855c:	e50b3060 	str	r3, [fp, -#96]
+a0308560:	e51b3074 	ldr	r3, [fp, -#116]
+a0308564:	e1a037e3 	mov	r3, r3, ror #15
+a0308568:	e50b3074 	str	r3, [fp, -#116]
+a030856c:	e51b2074 	ldr	r2, [fp, -#116]
+a0308570:	e51b3078 	ldr	r3, [fp, -#120]
+a0308574:	e0823003 	add	r3, r2, r3
+a0308578:	e50b3074 	str	r3, [fp, -#116]
+a030857c:	e51b2078 	ldr	r2, [fp, -#120]
+a0308580:	e51b306c 	ldr	r3, [fp, -#108]
+a0308584:	e0222003 	eor	r2, r2, r3
+a0308588:	e51b3074 	ldr	r3, [fp, -#116]
+a030858c:	e0022003 	and	r2, r2, r3
+a0308590:	e51b306c 	ldr	r3, [fp, -#108]
+a0308594:	e0220003 	eor	r0, r2, r3
+a0308598:	e24b407c 	sub	r4, fp, #124	; 0x7c
+a030859c:	e5941000 	ldr	r1, [r4]
+a03085a0:	e51b3060 	ldr	r3, [fp, -#96]
+a03085a4:	e1a02001 	mov	r2, r1
+a03085a8:	e5933000 	ldr	r3, [r3]
+a03085ac:	e5823000 	str	r3, [r2]
+a03085b0:	e5923000 	ldr	r3, [r2]
+a03085b4:	e0802003 	add	r2, r0, r3
+a03085b8:	e51b3070 	ldr	r3, [fp, -#112]
+a03085bc:	e0823003 	add	r3, r2, r3
+a03085c0:	e2833e82 	add	r3, r3, #2080	; 0x820
+a03085c4:	e2833352 	add	r3, r3, #1207959553	; 0x48000001
+a03085c8:	e283376d 	add	r3, r3, #28573696	; 0x1b40000
+a03085cc:	e50b3070 	str	r3, [fp, -#112]
+a03085d0:	e2811004 	add	r1, r1, #4	; 0x4
+a03085d4:	e5841000 	str	r1, [r4]
+a03085d8:	e51b3060 	ldr	r3, [fp, -#96]
+a03085dc:	e2833004 	add	r3, r3, #4	; 0x4
+a03085e0:	e50b3060 	str	r3, [fp, -#96]
+a03085e4:	e51b3070 	ldr	r3, [fp, -#112]
+a03085e8:	e1a03563 	mov	r3, r3, ror #10
+a03085ec:	e50b3070 	str	r3, [fp, -#112]
+a03085f0:	e51b2070 	ldr	r2, [fp, -#112]
+a03085f4:	e51b3074 	ldr	r3, [fp, -#116]
+a03085f8:	e0823003 	add	r3, r2, r3
+a03085fc:	e50b3070 	str	r3, [fp, -#112]
+a0308600:	e51b2070 	ldr	r2, [fp, -#112]
+a0308604:	e51b3074 	ldr	r3, [fp, -#116]
+a0308608:	e0222003 	eor	r2, r2, r3
+a030860c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308610:	e0022003 	and	r2, r2, r3
+a0308614:	e51b3074 	ldr	r3, [fp, -#116]
+a0308618:	e0222003 	eor	r2, r2, r3
+a030861c:	e51b3058 	ldr	r3, [fp, -#88]
+a0308620:	e0822003 	add	r2, r2, r3
+a0308624:	e51b306c 	ldr	r3, [fp, -#108]
+a0308628:	e0823003 	add	r3, r2, r3
+a030862c:	e28334f6 	add	r3, r3, #-167772160	; 0xf6000000
+a0308630:	e283381e 	add	r3, r3, #1966080	; 0x1e0000
+a0308634:	e2833d95 	add	r3, r3, #9536	; 0x2540
+a0308638:	e2833022 	add	r3, r3, #34	; 0x22
+a030863c:	e50b306c 	str	r3, [fp, -#108]
+a0308640:	e51b306c 	ldr	r3, [fp, -#108]
+a0308644:	e1a03de3 	mov	r3, r3, ror #27
+a0308648:	e50b306c 	str	r3, [fp, -#108]
+a030864c:	e51b206c 	ldr	r2, [fp, -#108]
+a0308650:	e51b3070 	ldr	r3, [fp, -#112]
+a0308654:	e0823003 	add	r3, r2, r3
+a0308658:	e50b306c 	str	r3, [fp, -#108]
+a030865c:	e51b206c 	ldr	r2, [fp, -#108]
+a0308660:	e51b3070 	ldr	r3, [fp, -#112]
+a0308664:	e0222003 	eor	r2, r2, r3
+a0308668:	e51b3074 	ldr	r3, [fp, -#116]
+a030866c:	e0022003 	and	r2, r2, r3
+a0308670:	e51b3070 	ldr	r3, [fp, -#112]
+a0308674:	e0222003 	eor	r2, r2, r3
+a0308678:	e51b3044 	ldr	r3, [fp, -#68]
+a030867c:	e0822003 	add	r2, r2, r3
+a0308680:	e51b3078 	ldr	r3, [fp, -#120]
+a0308684:	e0823003 	add	r3, r2, r3
+a0308688:	e2833103 	add	r3, r3, #-1073741824	; 0xc0000000
+a030868c:	e2833501 	add	r3, r3, #4194304	; 0x400000
+a0308690:	e2833cb3 	add	r3, r3, #45824	; 0xb300
+a0308694:	e2833040 	add	r3, r3, #64	; 0x40
+a0308698:	e50b3078 	str	r3, [fp, -#120]
+a030869c:	e51b3078 	ldr	r3, [fp, -#120]
+a03086a0:	e1a03be3 	mov	r3, r3, ror #23
+a03086a4:	e50b3078 	str	r3, [fp, -#120]
+a03086a8:	e51b2078 	ldr	r2, [fp, -#120]
+a03086ac:	e51b306c 	ldr	r3, [fp, -#108]
+a03086b0:	e0823003 	add	r3, r2, r3
+a03086b4:	e50b3078 	str	r3, [fp, -#120]
+a03086b8:	e51b2078 	ldr	r2, [fp, -#120]
+a03086bc:	e51b306c 	ldr	r3, [fp, -#108]
+a03086c0:	e0222003 	eor	r2, r2, r3
+a03086c4:	e51b3070 	ldr	r3, [fp, -#112]
+a03086c8:	e0022003 	and	r2, r2, r3
+a03086cc:	e51b306c 	ldr	r3, [fp, -#108]
+a03086d0:	e0222003 	eor	r2, r2, r3
+a03086d4:	e51b3030 	ldr	r3, [fp, -#48]
+a03086d8:	e0822003 	add	r2, r2, r3
+a03086dc:	e51b3074 	ldr	r3, [fp, -#116]
+a03086e0:	e0823003 	add	r3, r2, r3
+a03086e4:	e2833599 	add	r3, r3, #641728512	; 0x26400000
+a03086e8:	e2833979 	add	r3, r3, #1982464	; 0x1e4000
+a03086ec:	e2833d69 	add	r3, r3, #6720	; 0x1a40
+a03086f0:	e2833011 	add	r3, r3, #17	; 0x11
+a03086f4:	e50b3074 	str	r3, [fp, -#116]
+a03086f8:	e51b3074 	ldr	r3, [fp, -#116]
+a03086fc:	e1a03963 	mov	r3, r3, ror #18
+a0308700:	e50b3074 	str	r3, [fp, -#116]
+a0308704:	e51b2074 	ldr	r2, [fp, -#116]
+a0308708:	e51b3078 	ldr	r3, [fp, -#120]
+a030870c:	e0823003 	add	r3, r2, r3
+a0308710:	e50b3074 	str	r3, [fp, -#116]
+a0308714:	e51b2074 	ldr	r2, [fp, -#116]
+a0308718:	e51b3078 	ldr	r3, [fp, -#120]
+a030871c:	e0222003 	eor	r2, r2, r3
+a0308720:	e51b306c 	ldr	r3, [fp, -#108]
+a0308724:	e0022003 	and	r2, r2, r3
+a0308728:	e51b3078 	ldr	r3, [fp, -#120]
+a030872c:	e0222003 	eor	r2, r2, r3
+a0308730:	e51b305c 	ldr	r3, [fp, -#92]
+a0308734:	e0822003 	add	r2, r2, r3
+a0308738:	e51b3070 	ldr	r3, [fp, -#112]
+a030873c:	e0823003 	add	r3, r2, r3
+a0308740:	e2433559 	sub	r3, r3, #373293056	; 0x16400000
+a0308744:	e2433a93 	sub	r3, r3, #602112	; 0x93000
+a0308748:	e2433e85 	sub	r3, r3, #2128	; 0x850
+a030874c:	e2433006 	sub	r3, r3, #6	; 0x6
+a0308750:	e50b3070 	str	r3, [fp, -#112]
+a0308754:	e51b3070 	ldr	r3, [fp, -#112]
+a0308758:	e1a03663 	mov	r3, r3, ror #12
+a030875c:	e50b3070 	str	r3, [fp, -#112]
+a0308760:	e51b2070 	ldr	r2, [fp, -#112]
+a0308764:	e51b3074 	ldr	r3, [fp, -#116]
+a0308768:	e0823003 	add	r3, r2, r3
+a030876c:	e50b3070 	str	r3, [fp, -#112]
+a0308770:	e51b2070 	ldr	r2, [fp, -#112]
+a0308774:	e51b3074 	ldr	r3, [fp, -#116]
+a0308778:	e0222003 	eor	r2, r2, r3
+a030877c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308780:	e0022003 	and	r2, r2, r3
+a0308784:	e51b3074 	ldr	r3, [fp, -#116]
+a0308788:	e0222003 	eor	r2, r2, r3
+a030878c:	e51b3048 	ldr	r3, [fp, -#72]
+a0308790:	e0822003 	add	r2, r2, r3
+a0308794:	e51b306c 	ldr	r3, [fp, -#108]
+a0308798:	e0823003 	add	r3, r2, r3
+a030879c:	e28334d6 	add	r3, r3, #-704643072	; 0xd6000000
+a03087a0:	e283382f 	add	r3, r3, #3080192	; 0x2f0000
+a03087a4:	e2833d41 	add	r3, r3, #4160	; 0x1040
+a03087a8:	e283301d 	add	r3, r3, #29	; 0x1d
+a03087ac:	e50b306c 	str	r3, [fp, -#108]
+a03087b0:	e51b306c 	ldr	r3, [fp, -#108]
+a03087b4:	e1a03de3 	mov	r3, r3, ror #27
+a03087b8:	e50b306c 	str	r3, [fp, -#108]
+a03087bc:	e51b206c 	ldr	r2, [fp, -#108]
+a03087c0:	e51b3070 	ldr	r3, [fp, -#112]
+a03087c4:	e0823003 	add	r3, r2, r3
+a03087c8:	e50b306c 	str	r3, [fp, -#108]
+a03087cc:	e51b206c 	ldr	r2, [fp, -#108]
+a03087d0:	e51b3070 	ldr	r3, [fp, -#112]
+a03087d4:	e0222003 	eor	r2, r2, r3
+a03087d8:	e51b3074 	ldr	r3, [fp, -#116]
+a03087dc:	e0022003 	and	r2, r2, r3
+a03087e0:	e51b3070 	ldr	r3, [fp, -#112]
+a03087e4:	e0222003 	eor	r2, r2, r3
+a03087e8:	e51b3034 	ldr	r3, [fp, -#52]
+a03087ec:	e0822003 	add	r2, r2, r3
+a03087f0:	e51b3078 	ldr	r3, [fp, -#120]
+a03087f4:	e0823003 	add	r3, r2, r3
+a03087f8:	e2833791 	add	r3, r3, #38010880	; 0x2440000
+a03087fc:	e2833d51 	add	r3, r3, #5184	; 0x1440
+a0308800:	e2833013 	add	r3, r3, #19	; 0x13
+a0308804:	e50b3078 	str	r3, [fp, -#120]
+a0308808:	e51b3078 	ldr	r3, [fp, -#120]
+a030880c:	e1a03be3 	mov	r3, r3, ror #23
+a0308810:	e50b3078 	str	r3, [fp, -#120]
+a0308814:	e51b2078 	ldr	r2, [fp, -#120]
+a0308818:	e51b306c 	ldr	r3, [fp, -#108]
+a030881c:	e0823003 	add	r3, r2, r3
+a0308820:	e50b3078 	str	r3, [fp, -#120]
+a0308824:	e51b2078 	ldr	r2, [fp, -#120]
+a0308828:	e51b306c 	ldr	r3, [fp, -#108]
+a030882c:	e0222003 	eor	r2, r2, r3
+a0308830:	e51b3070 	ldr	r3, [fp, -#112]
+a0308834:	e0022003 	and	r2, r2, r3
+a0308838:	e51b306c 	ldr	r3, [fp, -#108]
+a030883c:	e0222003 	eor	r2, r2, r3
+a0308840:	e51b3020 	ldr	r3, [fp, -#32]
+a0308844:	e0822003 	add	r2, r2, r3
+a0308848:	e51b3074 	ldr	r3, [fp, -#116]
+a030884c:	e0823003 	add	r3, r2, r3
+a0308850:	e2833336 	add	r3, r3, #-671088640	; 0xd8000000
+a0308854:	e28338a1 	add	r3, r3, #10551296	; 0xa10000
+a0308858:	e2833ce6 	add	r3, r3, #58880	; 0xe600
+a030885c:	e2833081 	add	r3, r3, #129	; 0x81
+a0308860:	e50b3074 	str	r3, [fp, -#116]
+a0308864:	e51b3074 	ldr	r3, [fp, -#116]
+a0308868:	e1a03963 	mov	r3, r3, ror #18
+a030886c:	e50b3074 	str	r3, [fp, -#116]
+a0308870:	e51b2074 	ldr	r2, [fp, -#116]
+a0308874:	e51b3078 	ldr	r3, [fp, -#120]
+a0308878:	e0823003 	add	r3, r2, r3
+a030887c:	e50b3074 	str	r3, [fp, -#116]
+a0308880:	e51b2074 	ldr	r2, [fp, -#116]
+a0308884:	e51b3078 	ldr	r3, [fp, -#120]
+a0308888:	e0222003 	eor	r2, r2, r3
+a030888c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308890:	e0022003 	and	r2, r2, r3
+a0308894:	e51b3078 	ldr	r3, [fp, -#120]
+a0308898:	e0222003 	eor	r2, r2, r3
+a030889c:	e51b304c 	ldr	r3, [fp, -#76]
+a03088a0:	e0822003 	add	r2, r2, r3
+a03088a4:	e51b3070 	ldr	r3, [fp, -#112]
+a03088a8:	e0823003 	add	r3, r2, r3
+a03088ac:	e283333a 	add	r3, r3, #-402653184	; 0xe8000000
+a03088b0:	e243370b 	sub	r3, r3, #2883584	; 0x2c0000
+a03088b4:	e2433e43 	sub	r3, r3, #1072	; 0x430
+a03088b8:	e2433008 	sub	r3, r3, #8	; 0x8
+a03088bc:	e50b3070 	str	r3, [fp, -#112]
+a03088c0:	e51b3070 	ldr	r3, [fp, -#112]
+a03088c4:	e1a03663 	mov	r3, r3, ror #12
+a03088c8:	e50b3070 	str	r3, [fp, -#112]
+a03088cc:	e51b2070 	ldr	r2, [fp, -#112]
+a03088d0:	e51b3074 	ldr	r3, [fp, -#116]
+a03088d4:	e0823003 	add	r3, r2, r3
+a03088d8:	e50b3070 	str	r3, [fp, -#112]
+a03088dc:	e51b2070 	ldr	r2, [fp, -#112]
+a03088e0:	e51b3074 	ldr	r3, [fp, -#116]
+a03088e4:	e0222003 	eor	r2, r2, r3
+a03088e8:	e51b3078 	ldr	r3, [fp, -#120]
+a03088ec:	e0022003 	and	r2, r2, r3
+a03088f0:	e51b3074 	ldr	r3, [fp, -#116]
+a03088f4:	e0222003 	eor	r2, r2, r3
+a03088f8:	e51b3038 	ldr	r3, [fp, -#56]
+a03088fc:	e0822003 	add	r2, r2, r3
+a0308900:	e51b306c 	ldr	r3, [fp, -#108]
+a0308904:	e0823003 	add	r3, r2, r3
+a0308908:	e2833587 	add	r3, r3, #566231040	; 0x21c00000
+a030890c:	e2833987 	add	r3, r3, #2211840	; 0x21c000
+a0308910:	e2833ede 	add	r3, r3, #3552	; 0xde0
+a0308914:	e2833006 	add	r3, r3, #6	; 0x6
+a0308918:	e50b306c 	str	r3, [fp, -#108]
+a030891c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308920:	e1a03de3 	mov	r3, r3, ror #27
+a0308924:	e50b306c 	str	r3, [fp, -#108]
+a0308928:	e51b206c 	ldr	r2, [fp, -#108]
+a030892c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308930:	e0823003 	add	r3, r2, r3
+a0308934:	e50b306c 	str	r3, [fp, -#108]
+a0308938:	e51b206c 	ldr	r2, [fp, -#108]
+a030893c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308940:	e0222003 	eor	r2, r2, r3
+a0308944:	e51b3074 	ldr	r3, [fp, -#116]
+a0308948:	e0022003 	and	r2, r2, r3
+a030894c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308950:	e0222003 	eor	r2, r2, r3
+a0308954:	e51b3024 	ldr	r3, [fp, -#36]
+a0308958:	e0822003 	add	r2, r2, r3
+a030895c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308960:	e0823003 	add	r3, r2, r3
+a0308964:	e24335f3 	sub	r3, r3, #1019215872	; 0x3cc00000
+a0308968:	e2433a8f 	sub	r3, r3, #585728	; 0x8f000
+a030896c:	e2433e82 	sub	r3, r3, #2080	; 0x820
+a0308970:	e243300a 	sub	r3, r3, #10	; 0xa
+a0308974:	e50b3078 	str	r3, [fp, -#120]
+a0308978:	e51b3078 	ldr	r3, [fp, -#120]
+a030897c:	e1a03be3 	mov	r3, r3, ror #23
+a0308980:	e50b3078 	str	r3, [fp, -#120]
+a0308984:	e51b2078 	ldr	r2, [fp, -#120]
+a0308988:	e51b306c 	ldr	r3, [fp, -#108]
+a030898c:	e0823003 	add	r3, r2, r3
+a0308990:	e50b3078 	str	r3, [fp, -#120]
+a0308994:	e51b2078 	ldr	r2, [fp, -#120]
+a0308998:	e51b306c 	ldr	r3, [fp, -#108]
+a030899c:	e0222003 	eor	r2, r2, r3
+a03089a0:	e51b3070 	ldr	r3, [fp, -#112]
+a03089a4:	e0022003 	and	r2, r2, r3
+a03089a8:	e51b306c 	ldr	r3, [fp, -#108]
+a03089ac:	e0222003 	eor	r2, r2, r3
+a03089b0:	e51b3050 	ldr	r3, [fp, -#80]
+a03089b4:	e0822003 	add	r2, r2, r3
+a03089b8:	e51b3074 	ldr	r3, [fp, -#116]
+a03089bc:	e0823003 	add	r3, r2, r3
+a03089c0:	e24336b2 	sub	r3, r3, #186646528	; 0xb200000
+a03089c4:	e2433aaf 	sub	r3, r3, #716800	; 0xaf000
+a03089c8:	e2433f9e 	sub	r3, r3, #632	; 0x278
+a03089cc:	e2433001 	sub	r3, r3, #1	; 0x1
+a03089d0:	e50b3074 	str	r3, [fp, -#116]
+a03089d4:	e51b3074 	ldr	r3, [fp, -#116]
+a03089d8:	e1a03963 	mov	r3, r3, ror #18
+a03089dc:	e50b3074 	str	r3, [fp, -#116]
+a03089e0:	e51b2074 	ldr	r2, [fp, -#116]
+a03089e4:	e51b3078 	ldr	r3, [fp, -#120]
+a03089e8:	e0823003 	add	r3, r2, r3
+a03089ec:	e50b3074 	str	r3, [fp, -#116]
+a03089f0:	e51b2074 	ldr	r2, [fp, -#116]
+a03089f4:	e51b3078 	ldr	r3, [fp, -#120]
+a03089f8:	e0222003 	eor	r2, r2, r3
+a03089fc:	e51b306c 	ldr	r3, [fp, -#108]
+a0308a00:	e0022003 	and	r2, r2, r3
+a0308a04:	e51b3078 	ldr	r3, [fp, -#120]
+a0308a08:	e0222003 	eor	r2, r2, r3
+a0308a0c:	e51b303c 	ldr	r3, [fp, -#60]
+a0308a10:	e0822003 	add	r2, r2, r3
+a0308a14:	e51b3070 	ldr	r3, [fp, -#112]
+a0308a18:	e0823003 	add	r3, r2, r3
+a0308a1c:	e2833445 	add	r3, r3, #1157627904	; 0x45000000
+a0308a20:	e283385a 	add	r3, r3, #5898240	; 0x5a0000
+a0308a24:	e2833d53 	add	r3, r3, #5312	; 0x14c0
+a0308a28:	e283302d 	add	r3, r3, #45	; 0x2d
+a0308a2c:	e50b3070 	str	r3, [fp, -#112]
+a0308a30:	e51b3070 	ldr	r3, [fp, -#112]
+a0308a34:	e1a03663 	mov	r3, r3, ror #12
+a0308a38:	e50b3070 	str	r3, [fp, -#112]
+a0308a3c:	e51b2070 	ldr	r2, [fp, -#112]
+a0308a40:	e51b3074 	ldr	r3, [fp, -#116]
+a0308a44:	e0823003 	add	r3, r2, r3
+a0308a48:	e50b3070 	str	r3, [fp, -#112]
+a0308a4c:	e51b2070 	ldr	r2, [fp, -#112]
+a0308a50:	e51b3074 	ldr	r3, [fp, -#116]
+a0308a54:	e0222003 	eor	r2, r2, r3
+a0308a58:	e51b3078 	ldr	r3, [fp, -#120]
+a0308a5c:	e0022003 	and	r2, r2, r3
+a0308a60:	e51b3074 	ldr	r3, [fp, -#116]
+a0308a64:	e0222003 	eor	r2, r2, r3
+a0308a68:	e51b3028 	ldr	r3, [fp, -#40]
+a0308a6c:	e0822003 	add	r2, r2, r3
+a0308a70:	e51b306c 	ldr	r3, [fp, -#108]
+a0308a74:	e0823003 	add	r3, r2, r3
+a0308a78:	e28334a9 	add	r3, r3, #-1459617792	; 0xa9000000
+a0308a7c:	e28338e3 	add	r3, r3, #14876672	; 0xe30000
+a0308a80:	e2833ce9 	add	r3, r3, #59648	; 0xe900
+a0308a84:	e2833005 	add	r3, r3, #5	; 0x5
+a0308a88:	e50b306c 	str	r3, [fp, -#108]
+a0308a8c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308a90:	e1a03de3 	mov	r3, r3, ror #27
+a0308a94:	e50b306c 	str	r3, [fp, -#108]
+a0308a98:	e51b206c 	ldr	r2, [fp, -#108]
+a0308a9c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308aa0:	e0823003 	add	r3, r2, r3
+a0308aa4:	e50b306c 	str	r3, [fp, -#108]
+a0308aa8:	e51b206c 	ldr	r2, [fp, -#108]
+a0308aac:	e51b3070 	ldr	r3, [fp, -#112]
+a0308ab0:	e0222003 	eor	r2, r2, r3
+a0308ab4:	e51b3074 	ldr	r3, [fp, -#116]
+a0308ab8:	e0022003 	and	r2, r2, r3
+a0308abc:	e51b3070 	ldr	r3, [fp, -#112]
+a0308ac0:	e0222003 	eor	r2, r2, r3
+a0308ac4:	e51b3054 	ldr	r3, [fp, -#84]
+a0308ac8:	e0822003 	add	r2, r2, r3
+a0308acc:	e51b3078 	ldr	r3, [fp, -#120]
+a0308ad0:	e0823003 	add	r3, r2, r3
+a0308ad4:	e2433631 	sub	r3, r3, #51380224	; 0x3100000
+a0308ad8:	e2433b17 	sub	r3, r3, #23552	; 0x5c00
+a0308adc:	e2433008 	sub	r3, r3, #8	; 0x8
+a0308ae0:	e50b3078 	str	r3, [fp, -#120]
+a0308ae4:	e51b3078 	ldr	r3, [fp, -#120]
+a0308ae8:	e1a03be3 	mov	r3, r3, ror #23
+a0308aec:	e50b3078 	str	r3, [fp, -#120]
+a0308af0:	e51b2078 	ldr	r2, [fp, -#120]
+a0308af4:	e51b306c 	ldr	r3, [fp, -#108]
+a0308af8:	e0823003 	add	r3, r2, r3
+a0308afc:	e50b3078 	str	r3, [fp, -#120]
+a0308b00:	e51b2078 	ldr	r2, [fp, -#120]
+a0308b04:	e51b306c 	ldr	r3, [fp, -#108]
+a0308b08:	e0222003 	eor	r2, r2, r3
+a0308b0c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308b10:	e0022003 	and	r2, r2, r3
+a0308b14:	e51b306c 	ldr	r3, [fp, -#108]
+a0308b18:	e0222003 	eor	r2, r2, r3
+a0308b1c:	e51b3040 	ldr	r3, [fp, -#64]
+a0308b20:	e0822003 	add	r2, r2, r3
+a0308b24:	e51b3074 	ldr	r3, [fp, -#116]
+a0308b28:	e0823003 	add	r3, r2, r3
+a0308b2c:	e283331a 	add	r3, r3, #1744830464	; 0x68000000
+a0308b30:	e2433609 	sub	r3, r3, #9437184	; 0x900000
+a0308b34:	e2433cfd 	sub	r3, r3, #64768	; 0xfd00
+a0308b38:	e2433027 	sub	r3, r3, #39	; 0x27
+a0308b3c:	e50b3074 	str	r3, [fp, -#116]
+a0308b40:	e51b3074 	ldr	r3, [fp, -#116]
+a0308b44:	e1a03963 	mov	r3, r3, ror #18
+a0308b48:	e50b3074 	str	r3, [fp, -#116]
+a0308b4c:	e51b2074 	ldr	r2, [fp, -#116]
+a0308b50:	e51b3078 	ldr	r3, [fp, -#120]
+a0308b54:	e0823003 	add	r3, r2, r3
+a0308b58:	e50b3074 	str	r3, [fp, -#116]
+a0308b5c:	e51b2074 	ldr	r2, [fp, -#116]
+a0308b60:	e51b3078 	ldr	r3, [fp, -#120]
+a0308b64:	e0222003 	eor	r2, r2, r3
+a0308b68:	e51b306c 	ldr	r3, [fp, -#108]
+a0308b6c:	e0022003 	and	r2, r2, r3
+a0308b70:	e51b3078 	ldr	r3, [fp, -#120]
+a0308b74:	e0222003 	eor	r2, r2, r3
+a0308b78:	e51b302c 	ldr	r3, [fp, -#44]
+a0308b7c:	e0822003 	add	r2, r2, r3
+a0308b80:	e51b3070 	ldr	r3, [fp, -#112]
+a0308b84:	e0823003 	add	r3, r2, r3
+a0308b88:	e283348d 	add	r3, r3, #-1929379840	; 0x8d000000
+a0308b8c:	e28339a9 	add	r3, r3, #2768896	; 0x2a4000
+a0308b90:	e2833d32 	add	r3, r3, #3200	; 0xc80
+a0308b94:	e283300a 	add	r3, r3, #10	; 0xa
+a0308b98:	e50b3070 	str	r3, [fp, -#112]
+a0308b9c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308ba0:	e1a03663 	mov	r3, r3, ror #12
+a0308ba4:	e50b3070 	str	r3, [fp, -#112]
+a0308ba8:	e51b2070 	ldr	r2, [fp, -#112]
+a0308bac:	e51b3074 	ldr	r3, [fp, -#116]
+a0308bb0:	e0823003 	add	r3, r2, r3
+a0308bb4:	e50b3070 	str	r3, [fp, -#112]
+a0308bb8:	e51b2070 	ldr	r2, [fp, -#112]
+a0308bbc:	e51b3074 	ldr	r3, [fp, -#116]
+a0308bc0:	e0222003 	eor	r2, r2, r3
+a0308bc4:	e51b3078 	ldr	r3, [fp, -#120]
+a0308bc8:	e0222003 	eor	r2, r2, r3
+a0308bcc:	e51b3048 	ldr	r3, [fp, -#72]
+a0308bd0:	e0822003 	add	r2, r2, r3
+a0308bd4:	e51b306c 	ldr	r3, [fp, -#108]
+a0308bd8:	e0823003 	add	r3, r2, r3
+a0308bdc:	e2433917 	sub	r3, r3, #376832	; 0x5c000
+a0308be0:	e2433e6b 	sub	r3, r3, #1712	; 0x6b0
+a0308be4:	e243300e 	sub	r3, r3, #14	; 0xe
+a0308be8:	e50b306c 	str	r3, [fp, -#108]
+a0308bec:	e51b306c 	ldr	r3, [fp, -#108]
+a0308bf0:	e1a03e63 	mov	r3, r3, ror #28
+a0308bf4:	e50b306c 	str	r3, [fp, -#108]
+a0308bf8:	e51b206c 	ldr	r2, [fp, -#108]
+a0308bfc:	e51b3070 	ldr	r3, [fp, -#112]
+a0308c00:	e0823003 	add	r3, r2, r3
+a0308c04:	e50b306c 	str	r3, [fp, -#108]
+a0308c08:	e51b206c 	ldr	r2, [fp, -#108]
+a0308c0c:	e51b3070 	ldr	r3, [fp, -#112]
+a0308c10:	e0222003 	eor	r2, r2, r3
+a0308c14:	e51b3074 	ldr	r3, [fp, -#116]
+a0308c18:	e0222003 	eor	r2, r2, r3
+a0308c1c:	e51b303c 	ldr	r3, [fp, -#60]
+a0308c20:	e0822003 	add	r2, r2, r3
+a0308c24:	e51b3078 	ldr	r3, [fp, -#120]
+a0308c28:	e0823003 	add	r3, r2, r3
+a0308c2c:	e2833487 	add	r3, r3, #-2030043136	; 0x87000000
+a0308c30:	e2833871 	add	r3, r3, #7405568	; 0x710000
+a0308c34:	e2833cf6 	add	r3, r3, #62976	; 0xf600
+a0308c38:	e2833081 	add	r3, r3, #129	; 0x81
+a0308c3c:	e50b3078 	str	r3, [fp, -#120]
+a0308c40:	e51b3078 	ldr	r3, [fp, -#120]
+a0308c44:	e1a03ae3 	mov	r3, r3, ror #21
+a0308c48:	e50b3078 	str	r3, [fp, -#120]
+a0308c4c:	e51b2078 	ldr	r2, [fp, -#120]
+a0308c50:	e51b306c 	ldr	r3, [fp, -#108]
+a0308c54:	e0823003 	add	r3, r2, r3
+a0308c58:	e50b3078 	str	r3, [fp, -#120]
+a0308c5c:	e51b2078 	ldr	r2, [fp, -#120]
+a0308c60:	e51b306c 	ldr	r3, [fp, -#108]
+a0308c64:	e0222003 	eor	r2, r2, r3
+a0308c68:	e51b3070 	ldr	r3, [fp, -#112]
+a0308c6c:	e0222003 	eor	r2, r2, r3
+a0308c70:	e51b3030 	ldr	r3, [fp, -#48]
+a0308c74:	e0822003 	add	r2, r2, r3
+a0308c78:	e51b3074 	ldr	r3, [fp, -#116]
+a0308c7c:	e0823003 	add	r3, r2, r3
+a0308c80:	e283346d 	add	r3, r3, #1828716544	; 0x6d000000
+a0308c84:	e283389d 	add	r3, r3, #10289152	; 0x9d0000
+a0308c88:	e2833c61 	add	r3, r3, #24832	; 0x6100
+a0308c8c:	e2833022 	add	r3, r3, #34	; 0x22
+a0308c90:	e50b3074 	str	r3, [fp, -#116]
+a0308c94:	e51b3074 	ldr	r3, [fp, -#116]
+a0308c98:	e1a03863 	mov	r3, r3, ror #16
+a0308c9c:	e50b3074 	str	r3, [fp, -#116]
+a0308ca0:	e51b2074 	ldr	r2, [fp, -#116]
+a0308ca4:	e51b3078 	ldr	r3, [fp, -#120]
+a0308ca8:	e0823003 	add	r3, r2, r3
+a0308cac:	e50b3074 	str	r3, [fp, -#116]
+a0308cb0:	e51b2074 	ldr	r2, [fp, -#116]
+a0308cb4:	e51b3078 	ldr	r3, [fp, -#120]
+a0308cb8:	e0222003 	eor	r2, r2, r3
+a0308cbc:	e51b306c 	ldr	r3, [fp, -#108]
+a0308cc0:	e0222003 	eor	r2, r2, r3
+a0308cc4:	e51b3024 	ldr	r3, [fp, -#36]
+a0308cc8:	e0822003 	add	r2, r2, r3
+a0308ccc:	e51b3070 	ldr	r3, [fp, -#112]
+a0308cd0:	e0823003 	add	r3, r2, r3
+a0308cd4:	e2433786 	sub	r3, r3, #35127296	; 0x2180000
+a0308cd8:	e2433bb1 	sub	r3, r3, #181248	; 0x2c400
+a0308cdc:	e2433ffd 	sub	r3, r3, #1012	; 0x3f4
+a0308ce0:	e50b3070 	str	r3, [fp, -#112]
+a0308ce4:	e51b3070 	ldr	r3, [fp, -#112]
+a0308ce8:	e1a034e3 	mov	r3, r3, ror #9
+a0308cec:	e50b3070 	str	r3, [fp, -#112]
+a0308cf0:	e51b2070 	ldr	r2, [fp, -#112]
+a0308cf4:	e51b3074 	ldr	r3, [fp, -#116]
+a0308cf8:	e0823003 	add	r3, r2, r3
+a0308cfc:	e50b3070 	str	r3, [fp, -#112]
+a0308d00:	e51b2070 	ldr	r2, [fp, -#112]
+a0308d04:	e51b3074 	ldr	r3, [fp, -#116]
+a0308d08:	e0222003 	eor	r2, r2, r3
+a0308d0c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308d10:	e0222003 	eor	r2, r2, r3
+a0308d14:	e51b3058 	ldr	r3, [fp, -#88]
+a0308d18:	e0822003 	add	r2, r2, r3
+a0308d1c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308d20:	e0823003 	add	r3, r2, r3
+a0308d24:	e2833329 	add	r3, r3, #-1543503872	; 0xa4000000
+a0308d28:	e28338be 	add	r3, r3, #12451840	; 0xbe0000
+a0308d2c:	e2833cea 	add	r3, r3, #59904	; 0xea00
+a0308d30:	e2833044 	add	r3, r3, #68	; 0x44
+a0308d34:	e50b306c 	str	r3, [fp, -#108]
+a0308d38:	e51b306c 	ldr	r3, [fp, -#108]
+a0308d3c:	e1a03e63 	mov	r3, r3, ror #28
+a0308d40:	e50b306c 	str	r3, [fp, -#108]
+a0308d44:	e51b206c 	ldr	r2, [fp, -#108]
+a0308d48:	e51b3070 	ldr	r3, [fp, -#112]
+a0308d4c:	e0823003 	add	r3, r2, r3
+a0308d50:	e50b306c 	str	r3, [fp, -#108]
+a0308d54:	e51b206c 	ldr	r2, [fp, -#108]
+a0308d58:	e51b3070 	ldr	r3, [fp, -#112]
+a0308d5c:	e0222003 	eor	r2, r2, r3
+a0308d60:	e51b3074 	ldr	r3, [fp, -#116]
+a0308d64:	e0222003 	eor	r2, r2, r3
+a0308d68:	e51b304c 	ldr	r3, [fp, -#76]
+a0308d6c:	e0822003 	add	r2, r2, r3
+a0308d70:	e51b3078 	ldr	r3, [fp, -#120]
+a0308d74:	e0823003 	add	r3, r2, r3
+a0308d78:	e2833313 	add	r3, r3, #1275068416	; 0x4c000000
+a0308d7c:	e2433821 	sub	r3, r3, #2162688	; 0x210000
+a0308d80:	e2433dc1 	sub	r3, r3, #12352	; 0x3040
+a0308d84:	e2433017 	sub	r3, r3, #23	; 0x17
+a0308d88:	e50b3078 	str	r3, [fp, -#120]
+a0308d8c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308d90:	e1a03ae3 	mov	r3, r3, ror #21
+a0308d94:	e50b3078 	str	r3, [fp, -#120]
+a0308d98:	e51b2078 	ldr	r2, [fp, -#120]
+a0308d9c:	e51b306c 	ldr	r3, [fp, -#108]
+a0308da0:	e0823003 	add	r3, r2, r3
+a0308da4:	e50b3078 	str	r3, [fp, -#120]
+a0308da8:	e51b2078 	ldr	r2, [fp, -#120]
+a0308dac:	e51b306c 	ldr	r3, [fp, -#108]
+a0308db0:	e0222003 	eor	r2, r2, r3
+a0308db4:	e51b3070 	ldr	r3, [fp, -#112]
+a0308db8:	e0222003 	eor	r2, r2, r3
+a0308dbc:	e51b3040 	ldr	r3, [fp, -#64]
+a0308dc0:	e0822003 	add	r2, r2, r3
+a0308dc4:	e51b3074 	ldr	r3, [fp, -#116]
+a0308dc8:	e0823003 	add	r3, r2, r3
+a0308dcc:	e2433525 	sub	r3, r3, #155189248	; 0x9400000
+a0308dd0:	e2433a4b 	sub	r3, r3, #307200	; 0x4b000
+a0308dd4:	e2433e4a 	sub	r3, r3, #1184	; 0x4a0
+a0308dd8:	e50b3074 	str	r3, [fp, -#116]
+a0308ddc:	e51b3074 	ldr	r3, [fp, -#116]
+a0308de0:	e1a03863 	mov	r3, r3, ror #16
+a0308de4:	e50b3074 	str	r3, [fp, -#116]
+a0308de8:	e51b2074 	ldr	r2, [fp, -#116]
+a0308dec:	e51b3078 	ldr	r3, [fp, -#120]
+a0308df0:	e0823003 	add	r3, r2, r3
+a0308df4:	e50b3074 	str	r3, [fp, -#116]
+a0308df8:	e51b2074 	ldr	r2, [fp, -#116]
+a0308dfc:	e51b3078 	ldr	r3, [fp, -#120]
+a0308e00:	e0222003 	eor	r2, r2, r3
+a0308e04:	e51b306c 	ldr	r3, [fp, -#108]
+a0308e08:	e0222003 	eor	r2, r2, r3
+a0308e0c:	e51b3034 	ldr	r3, [fp, -#52]
+a0308e10:	e0822003 	add	r2, r2, r3
+a0308e14:	e51b3070 	ldr	r3, [fp, -#112]
+a0308e18:	e0823003 	add	r3, r2, r3
+a0308e1c:	e28334bf 	add	r3, r3, #-1090519040	; 0xbf000000
+a0308e20:	e2433501 	sub	r3, r3, #4194304	; 0x400000
+a0308e24:	e2433c43 	sub	r3, r3, #17152	; 0x4300
+a0308e28:	e2433090 	sub	r3, r3, #144	; 0x90
+a0308e2c:	e50b3070 	str	r3, [fp, -#112]
+a0308e30:	e51b3070 	ldr	r3, [fp, -#112]
+a0308e34:	e1a034e3 	mov	r3, r3, ror #9
+a0308e38:	e50b3070 	str	r3, [fp, -#112]
+a0308e3c:	e51b2070 	ldr	r2, [fp, -#112]
+a0308e40:	e51b3074 	ldr	r3, [fp, -#116]
+a0308e44:	e0823003 	add	r3, r2, r3
+a0308e48:	e50b3070 	str	r3, [fp, -#112]
+a0308e4c:	e51b2070 	ldr	r2, [fp, -#112]
+a0308e50:	e51b3074 	ldr	r3, [fp, -#116]
+a0308e54:	e0222003 	eor	r2, r2, r3
+a0308e58:	e51b3078 	ldr	r3, [fp, -#120]
+a0308e5c:	e0222003 	eor	r2, r2, r3
+a0308e60:	e51b3028 	ldr	r3, [fp, -#40]
+a0308e64:	e0822003 	add	r2, r2, r3
+a0308e68:	e51b306c 	ldr	r3, [fp, -#108]
+a0308e6c:	e0823003 	add	r3, r2, r3
+a0308e70:	e2833429 	add	r3, r3, #687865856	; 0x29000000
+a0308e74:	e2433719 	sub	r3, r3, #6553600	; 0x640000
+a0308e78:	e2433c81 	sub	r3, r3, #33024	; 0x8100
+a0308e7c:	e243303a 	sub	r3, r3, #58	; 0x3a
+a0308e80:	e50b306c 	str	r3, [fp, -#108]
+a0308e84:	e51b306c 	ldr	r3, [fp, -#108]
+a0308e88:	e1a03e63 	mov	r3, r3, ror #28
+a0308e8c:	e50b306c 	str	r3, [fp, -#108]
+a0308e90:	e51b206c 	ldr	r2, [fp, -#108]
+a0308e94:	e51b3070 	ldr	r3, [fp, -#112]
+a0308e98:	e0823003 	add	r3, r2, r3
+a0308e9c:	e50b306c 	str	r3, [fp, -#108]
+a0308ea0:	e51b206c 	ldr	r2, [fp, -#108]
+a0308ea4:	e51b3070 	ldr	r3, [fp, -#112]
+a0308ea8:	e0222003 	eor	r2, r2, r3
+a0308eac:	e51b3074 	ldr	r3, [fp, -#116]
+a0308eb0:	e0222003 	eor	r2, r2, r3
+a0308eb4:	e51b305c 	ldr	r3, [fp, -#92]
+a0308eb8:	e0822003 	add	r2, r2, r3
+a0308ebc:	e51b3078 	ldr	r3, [fp, -#120]
+a0308ec0:	e0823003 	add	r3, r2, r3
+a0308ec4:	e2433555 	sub	r3, r3, #356515840	; 0x15400000
+a0308ec8:	e243397b 	sub	r3, r3, #2015232	; 0x1ec000
+a0308ecc:	e2433b06 	sub	r3, r3, #6144	; 0x1800
+a0308ed0:	e2433006 	sub	r3, r3, #6	; 0x6
+a0308ed4:	e50b3078 	str	r3, [fp, -#120]
+a0308ed8:	e51b3078 	ldr	r3, [fp, -#120]
+a0308edc:	e1a03ae3 	mov	r3, r3, ror #21
+a0308ee0:	e50b3078 	str	r3, [fp, -#120]
+a0308ee4:	e51b2078 	ldr	r2, [fp, -#120]
+a0308ee8:	e51b306c 	ldr	r3, [fp, -#108]
+a0308eec:	e0823003 	add	r3, r2, r3
+a0308ef0:	e50b3078 	str	r3, [fp, -#120]
+a0308ef4:	e51b2078 	ldr	r2, [fp, -#120]
+a0308ef8:	e51b306c 	ldr	r3, [fp, -#108]
+a0308efc:	e0222003 	eor	r2, r2, r3
+a0308f00:	e51b3070 	ldr	r3, [fp, -#112]
+a0308f04:	e0222003 	eor	r2, r2, r3
+a0308f08:	e51b3050 	ldr	r3, [fp, -#80]
+a0308f0c:	e0822003 	add	r2, r2, r3
+a0308f10:	e51b3074 	ldr	r3, [fp, -#116]
+a0308f14:	e0823003 	add	r3, r2, r3
+a0308f18:	e2833335 	add	r3, r3, #-738197504	; 0xd4000000
+a0308f1c:	e28338ef 	add	r3, r3, #15663104	; 0xef0000
+a0308f20:	e2833dc2 	add	r3, r3, #12416	; 0x3080
+a0308f24:	e2833005 	add	r3, r3, #5	; 0x5
+a0308f28:	e50b3074 	str	r3, [fp, -#116]
+a0308f2c:	e51b3074 	ldr	r3, [fp, -#116]
+a0308f30:	e1a03863 	mov	r3, r3, ror #16
+a0308f34:	e50b3074 	str	r3, [fp, -#116]
+a0308f38:	e51b2074 	ldr	r2, [fp, -#116]
+a0308f3c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308f40:	e0823003 	add	r3, r2, r3
+a0308f44:	e50b3074 	str	r3, [fp, -#116]
+a0308f48:	e51b2074 	ldr	r2, [fp, -#116]
+a0308f4c:	e51b3078 	ldr	r3, [fp, -#120]
+a0308f50:	e0222003 	eor	r2, r2, r3
+a0308f54:	e51b306c 	ldr	r3, [fp, -#108]
+a0308f58:	e0222003 	eor	r2, r2, r3
+a0308f5c:	e51b3044 	ldr	r3, [fp, -#68]
+a0308f60:	e0822003 	add	r2, r2, r3
+a0308f64:	e51b3070 	ldr	r3, [fp, -#112]
+a0308f68:	e0823003 	add	r3, r2, r3
+a0308f6c:	e2833512 	add	r3, r3, #75497472	; 0x4800000
+a0308f70:	e2833a81 	add	r3, r3, #528384	; 0x81000
+a0308f74:	e2833c0d 	add	r3, r3, #3328	; 0xd00
+a0308f78:	e2833005 	add	r3, r3, #5	; 0x5
+a0308f7c:	e50b3070 	str	r3, [fp, -#112]
+a0308f80:	e51b3070 	ldr	r3, [fp, -#112]
+a0308f84:	e1a034e3 	mov	r3, r3, ror #9
+a0308f88:	e50b3070 	str	r3, [fp, -#112]
+a0308f8c:	e51b2070 	ldr	r2, [fp, -#112]
+a0308f90:	e51b3074 	ldr	r3, [fp, -#116]
+a0308f94:	e0823003 	add	r3, r2, r3
+a0308f98:	e50b3070 	str	r3, [fp, -#112]
+a0308f9c:	e51b2070 	ldr	r2, [fp, -#112]
+a0308fa0:	e51b3074 	ldr	r3, [fp, -#116]
+a0308fa4:	e0222003 	eor	r2, r2, r3
+a0308fa8:	e51b3078 	ldr	r3, [fp, -#120]
+a0308fac:	e0222003 	eor	r2, r2, r3
+a0308fb0:	e51b3038 	ldr	r3, [fp, -#56]
+a0308fb4:	e0822003 	add	r2, r2, r3
+a0308fb8:	e51b306c 	ldr	r3, [fp, -#108]
+a0308fbc:	e0823003 	add	r3, r2, r3
+a0308fc0:	e28334d9 	add	r3, r3, #-654311424	; 0xd9000000
+a0308fc4:	e2833735 	add	r3, r3, #13893632	; 0xd40000
+a0308fc8:	e2833a0d 	add	r3, r3, #53248	; 0xd000
+a0308fcc:	e2833039 	add	r3, r3, #57	; 0x39
+a0308fd0:	e50b306c 	str	r3, [fp, -#108]
+a0308fd4:	e51b306c 	ldr	r3, [fp, -#108]
+a0308fd8:	e1a03e63 	mov	r3, r3, ror #28
+a0308fdc:	e50b306c 	str	r3, [fp, -#108]
+a0308fe0:	e51b206c 	ldr	r2, [fp, -#108]
+a0308fe4:	e51b3070 	ldr	r3, [fp, -#112]
+a0308fe8:	e0823003 	add	r3, r2, r3
+a0308fec:	e50b306c 	str	r3, [fp, -#108]
+a0308ff0:	e51b206c 	ldr	r2, [fp, -#108]
+a0308ff4:	e51b3070 	ldr	r3, [fp, -#112]
+a0308ff8:	e0222003 	eor	r2, r2, r3
+a0308ffc:	e51b3074 	ldr	r3, [fp, -#116]
+a0309000:	e0222003 	eor	r2, r2, r3
+a0309004:	e51b302c 	ldr	r3, [fp, -#44]
+a0309008:	e0822003 	add	r2, r2, r3
+a030900c:	e51b3078 	ldr	r3, [fp, -#120]
+a0309010:	e0823003 	add	r3, r2, r3
+a0309014:	e28334e7 	add	r3, r3, #-419430400	; 0xe7000000
+a0309018:	e2433991 	sub	r3, r3, #2375680	; 0x244000
+a030901c:	e2433c26 	sub	r3, r3, #9728	; 0x2600
+a0309020:	e243301b 	sub	r3, r3, #27	; 0x1b
+a0309024:	e50b3078 	str	r3, [fp, -#120]
+a0309028:	e51b3078 	ldr	r3, [fp, -#120]
+a030902c:	e1a03ae3 	mov	r3, r3, ror #21
+a0309030:	e50b3078 	str	r3, [fp, -#120]
+a0309034:	e51b2078 	ldr	r2, [fp, -#120]
+a0309038:	e51b306c 	ldr	r3, [fp, -#108]
+a030903c:	e0823003 	add	r3, r2, r3
+a0309040:	e50b3078 	str	r3, [fp, -#120]
+a0309044:	e51b2078 	ldr	r2, [fp, -#120]
+a0309048:	e51b306c 	ldr	r3, [fp, -#108]
+a030904c:	e0222003 	eor	r2, r2, r3
+a0309050:	e51b3070 	ldr	r3, [fp, -#112]
+a0309054:	e0222003 	eor	r2, r2, r3
+a0309058:	e51b3020 	ldr	r3, [fp, -#32]
+a030905c:	e0822003 	add	r2, r2, r3
+a0309060:	e51b3074 	ldr	r3, [fp, -#116]
+a0309064:	e0823003 	add	r3, r2, r3
+a0309068:	e243328e 	sub	r3, r3, #-536870904	; 0xe0000008
+a030906c:	e243385d 	sub	r3, r3, #6094848	; 0x5d0000
+a0309070:	e2433c83 	sub	r3, r3, #33536	; 0x8300
+a0309074:	e50b3074 	str	r3, [fp, -#116]
+a0309078:	e51b3074 	ldr	r3, [fp, -#116]
+a030907c:	e1a03863 	mov	r3, r3, ror #16
+a0309080:	e50b3074 	str	r3, [fp, -#116]
+a0309084:	e51b2074 	ldr	r2, [fp, -#116]
+a0309088:	e51b3078 	ldr	r3, [fp, -#120]
+a030908c:	e0823003 	add	r3, r2, r3
+a0309090:	e50b3074 	str	r3, [fp, -#116]
+a0309094:	e51b2074 	ldr	r2, [fp, -#116]
+a0309098:	e51b3078 	ldr	r3, [fp, -#120]
+a030909c:	e0222003 	eor	r2, r2, r3
+a03090a0:	e51b306c 	ldr	r3, [fp, -#108]
+a03090a4:	e0222003 	eor	r2, r2, r3
+a03090a8:	e51b3054 	ldr	r3, [fp, -#84]
+a03090ac:	e0822003 	add	r2, r2, r3
+a03090b0:	e51b3070 	ldr	r3, [fp, -#112]
+a03090b4:	e0823003 	add	r3, r2, r3
+a03090b8:	e2833331 	add	r3, r3, #-1006632960	; 0xc4000000
+a03090bc:	e283372b 	add	r3, r3, #11272192	; 0xac0000
+a03090c0:	e2833c56 	add	r3, r3, #22016	; 0x5600
+a03090c4:	e2833065 	add	r3, r3, #101	; 0x65
+a03090c8:	e50b3070 	str	r3, [fp, -#112]
+a03090cc:	e51b3070 	ldr	r3, [fp, -#112]
+a03090d0:	e1a034e3 	mov	r3, r3, ror #9
+a03090d4:	e50b3070 	str	r3, [fp, -#112]
+a03090d8:	e51b2070 	ldr	r2, [fp, -#112]
+a03090dc:	e51b3074 	ldr	r3, [fp, -#116]
+a03090e0:	e0823003 	add	r3, r2, r3
+a03090e4:	e50b3070 	str	r3, [fp, -#112]
+a03090e8:	e51b3078 	ldr	r3, [fp, -#120]
+a03090ec:	e1e02003 	mvn	r2, r3
+a03090f0:	e51b3070 	ldr	r3, [fp, -#112]
+a03090f4:	e1822003 	orr	r2, r2, r3
+a03090f8:	e51b3074 	ldr	r3, [fp, -#116]
+a03090fc:	e0222003 	eor	r2, r2, r3
+a0309100:	e51b305c 	ldr	r3, [fp, -#92]
+a0309104:	e0822003 	add	r2, r2, r3
+a0309108:	e51b306c 	ldr	r3, [fp, -#108]
+a030910c:	e0823003 	add	r3, r2, r3
+a0309110:	e283333d 	add	r3, r3, #-201326592	; 0xf4000000
+a0309114:	e2833829 	add	r3, r3, #2686976	; 0x290000
+a0309118:	e2833d89 	add	r3, r3, #8768	; 0x2240
+a030911c:	e2833004 	add	r3, r3, #4	; 0x4
+a0309120:	e50b306c 	str	r3, [fp, -#108]
+a0309124:	e51b306c 	ldr	r3, [fp, -#108]
+a0309128:	e1a03d63 	mov	r3, r3, ror #26
+a030912c:	e50b306c 	str	r3, [fp, -#108]
+a0309130:	e51b206c 	ldr	r2, [fp, -#108]
+a0309134:	e51b3070 	ldr	r3, [fp, -#112]
+a0309138:	e0823003 	add	r3, r2, r3
+a030913c:	e50b306c 	str	r3, [fp, -#108]
+a0309140:	e51b3074 	ldr	r3, [fp, -#116]
+a0309144:	e1e02003 	mvn	r2, r3
+a0309148:	e51b306c 	ldr	r3, [fp, -#108]
+a030914c:	e1822003 	orr	r2, r2, r3
+a0309150:	e51b3070 	ldr	r3, [fp, -#112]
+a0309154:	e0222003 	eor	r2, r2, r3
+a0309158:	e51b3040 	ldr	r3, [fp, -#64]
+a030915c:	e0822003 	add	r2, r2, r3
+a0309160:	e51b3078 	ldr	r3, [fp, -#120]
+a0309164:	e0823003 	add	r3, r2, r3
+a0309168:	e2833311 	add	r3, r3, #1140850688	; 0x44000000
+a030916c:	e24338d5 	sub	r3, r3, #13959168	; 0xd50000
+a0309170:	e2433069 	sub	r3, r3, #105	; 0x69
+a0309174:	e50b3078 	str	r3, [fp, -#120]
+a0309178:	e51b3078 	ldr	r3, [fp, -#120]
+a030917c:	e1a03b63 	mov	r3, r3, ror #22
+a0309180:	e50b3078 	str	r3, [fp, -#120]
+a0309184:	e51b2078 	ldr	r2, [fp, -#120]
+a0309188:	e51b306c 	ldr	r3, [fp, -#108]
+a030918c:	e0823003 	add	r3, r2, r3
+a0309190:	e50b3078 	str	r3, [fp, -#120]
+a0309194:	e51b3070 	ldr	r3, [fp, -#112]
+a0309198:	e1e02003 	mvn	r2, r3
+a030919c:	e51b3078 	ldr	r3, [fp, -#120]
+a03091a0:	e1822003 	orr	r2, r2, r3
+a03091a4:	e51b306c 	ldr	r3, [fp, -#108]
+a03091a8:	e0222003 	eor	r2, r2, r3
+a03091ac:	e51b3024 	ldr	r3, [fp, -#36]
+a03091b0:	e0822003 	add	r2, r2, r3
+a03091b4:	e51b3074 	ldr	r3, [fp, -#116]
+a03091b8:	e0823003 	add	r3, r2, r3
+a03091bc:	e28334ab 	add	r3, r3, #-1426063360	; 0xab000000
+a03091c0:	e2833725 	add	r3, r3, #9699328	; 0x940000
+a03091c4:	e2833d8e 	add	r3, r3, #9088	; 0x2380
+a03091c8:	e2833027 	add	r3, r3, #39	; 0x27
+a03091cc:	e50b3074 	str	r3, [fp, -#116]
+a03091d0:	e51b3074 	ldr	r3, [fp, -#116]
+a03091d4:	e1a038e3 	mov	r3, r3, ror #17
+a03091d8:	e50b3074 	str	r3, [fp, -#116]
+a03091dc:	e51b2074 	ldr	r2, [fp, -#116]
+a03091e0:	e51b3078 	ldr	r3, [fp, -#120]
+a03091e4:	e0823003 	add	r3, r2, r3
+a03091e8:	e50b3074 	str	r3, [fp, -#116]
+a03091ec:	e51b306c 	ldr	r3, [fp, -#108]
+a03091f0:	e1e02003 	mvn	r2, r3
+a03091f4:	e51b3074 	ldr	r3, [fp, -#116]
+a03091f8:	e1822003 	orr	r2, r2, r3
+a03091fc:	e51b3078 	ldr	r3, [fp, -#120]
+a0309200:	e0222003 	eor	r2, r2, r3
+a0309204:	e51b3048 	ldr	r3, [fp, -#72]
+a0309208:	e0822003 	add	r2, r2, r3
+a030920c:	e51b3070 	ldr	r3, [fp, -#112]
+a0309210:	e0823003 	add	r3, r2, r3
+a0309214:	e283333f 	add	r3, r3, #-67108864	; 0xfc000000
+a0309218:	e2833893 	add	r3, r3, #9633792	; 0x930000
+a030921c:	e2833a0a 	add	r3, r3, #40960	; 0xa000
+a0309220:	e2833039 	add	r3, r3, #57	; 0x39
+a0309224:	e50b3070 	str	r3, [fp, -#112]
+a0309228:	e51b3070 	ldr	r3, [fp, -#112]
+a030922c:	e1a035e3 	mov	r3, r3, ror #11
+a0309230:	e50b3070 	str	r3, [fp, -#112]
+a0309234:	e51b2070 	ldr	r2, [fp, -#112]
+a0309238:	e51b3074 	ldr	r3, [fp, -#116]
+a030923c:	e0823003 	add	r3, r2, r3
+a0309240:	e50b3070 	str	r3, [fp, -#112]
+a0309244:	e51b3078 	ldr	r3, [fp, -#120]
+a0309248:	e1e02003 	mvn	r2, r3
+a030924c:	e51b3070 	ldr	r3, [fp, -#112]
+a0309250:	e1822003 	orr	r2, r2, r3
+a0309254:	e51b3074 	ldr	r3, [fp, -#116]
+a0309258:	e0222003 	eor	r2, r2, r3
+a030925c:	e51b302c 	ldr	r3, [fp, -#44]
+a0309260:	e0822003 	add	r2, r2, r3
+a0309264:	e51b306c 	ldr	r3, [fp, -#108]
+a0309268:	e0823003 	add	r3, r2, r3
+a030926c:	e2833466 	add	r3, r3, #1711276032	; 0x66000000
+a0309270:	e2433729 	sub	r3, r3, #10747904	; 0xa40000
+a0309274:	e2433ca6 	sub	r3, r3, #42496	; 0xa600
+a0309278:	e243303d 	sub	r3, r3, #61	; 0x3d
+a030927c:	e50b306c 	str	r3, [fp, -#108]
+a0309280:	e51b306c 	ldr	r3, [fp, -#108]
+a0309284:	e1a03d63 	mov	r3, r3, ror #26
+a0309288:	e50b306c 	str	r3, [fp, -#108]
+a030928c:	e51b206c 	ldr	r2, [fp, -#108]
+a0309290:	e51b3070 	ldr	r3, [fp, -#112]
+a0309294:	e0823003 	add	r3, r2, r3
+a0309298:	e50b306c 	str	r3, [fp, -#108]
+a030929c:	e51b3074 	ldr	r3, [fp, -#116]
+a03092a0:	e1e02003 	mvn	r2, r3
+a03092a4:	e51b306c 	ldr	r3, [fp, -#108]
+a03092a8:	e1822003 	orr	r2, r2, r3
+a03092ac:	e51b3070 	ldr	r3, [fp, -#112]
+a03092b0:	e0222003 	eor	r2, r2, r3
+a03092b4:	e51b3050 	ldr	r3, [fp, -#80]
+a03092b8:	e0822003 	add	r2, r2, r3
+a03092bc:	e51b3078 	ldr	r3, [fp, -#120]
+a03092c0:	e0823003 	add	r3, r2, r3
+a03092c4:	e283348f 	add	r3, r3, #-1895825408	; 0x8f000000
+a03092c8:	e2833933 	add	r3, r3, #835584	; 0xcc000
+a03092cc:	e2833ec9 	add	r3, r3, #3216	; 0xc90
+a03092d0:	e2833002 	add	r3, r3, #2	; 0x2
+a03092d4:	e50b3078 	str	r3, [fp, -#120]
+a03092d8:	e51b3078 	ldr	r3, [fp, -#120]
+a03092dc:	e1a03b63 	mov	r3, r3, ror #22
+a03092e0:	e50b3078 	str	r3, [fp, -#120]
+a03092e4:	e51b2078 	ldr	r2, [fp, -#120]
+a03092e8:	e51b306c 	ldr	r3, [fp, -#108]
+a03092ec:	e0823003 	add	r3, r2, r3
+a03092f0:	e50b3078 	str	r3, [fp, -#120]
+a03092f4:	e51b3070 	ldr	r3, [fp, -#112]
+a03092f8:	e1e02003 	mvn	r2, r3
+a03092fc:	e51b3078 	ldr	r3, [fp, -#120]
+a0309300:	e1822003 	orr	r2, r2, r3
+a0309304:	e51b306c 	ldr	r3, [fp, -#108]
+a0309308:	e0222003 	eor	r2, r2, r3
+a030930c:	e51b3034 	ldr	r3, [fp, -#52]
+a0309310:	e0822003 	add	r2, r2, r3
+a0309314:	e51b3074 	ldr	r3, [fp, -#116]
+a0309318:	e0823003 	add	r3, r2, r3
+a030931c:	e2433601 	sub	r3, r3, #1048576	; 0x100000
+a0309320:	e2433d2e 	sub	r3, r3, #2944	; 0xb80
+a0309324:	e2433003 	sub	r3, r3, #3	; 0x3
+a0309328:	e50b3074 	str	r3, [fp, -#116]
+a030932c:	e51b3074 	ldr	r3, [fp, -#116]
+a0309330:	e1a038e3 	mov	r3, r3, ror #17
+a0309334:	e50b3074 	str	r3, [fp, -#116]
+a0309338:	e51b2074 	ldr	r2, [fp, -#116]
+a030933c:	e51b3078 	ldr	r3, [fp, -#120]
+a0309340:	e0823003 	add	r3, r2, r3
+a0309344:	e50b3074 	str	r3, [fp, -#116]
+a0309348:	e51b306c 	ldr	r3, [fp, -#108]
+a030934c:	e1e02003 	mvn	r2, r3
+a0309350:	e51b3074 	ldr	r3, [fp, -#116]
+a0309354:	e1822003 	orr	r2, r2, r3
+a0309358:	e51b3078 	ldr	r3, [fp, -#120]
+a030935c:	e0222003 	eor	r2, r2, r3
+a0309360:	e51b3058 	ldr	r3, [fp, -#88]
+a0309364:	e0822003 	add	r2, r2, r3
+a0309368:	e51b3070 	ldr	r3, [fp, -#112]
+a030936c:	e0823003 	add	r3, r2, r3
+a0309370:	e2833485 	add	r3, r3, #-2063597568	; 0x85000000
+a0309374:	e2833721 	add	r3, r3, #8650752	; 0x840000
+a0309378:	e2833c5d 	add	r3, r3, #23808	; 0x5d00
+a030937c:	e28330d1 	add	r3, r3, #209	; 0xd1
+a0309380:	e50b3070 	str	r3, [fp, -#112]
+a0309384:	e51b3070 	ldr	r3, [fp, -#112]
+a0309388:	e1a035e3 	mov	r3, r3, ror #11
+a030938c:	e50b3070 	str	r3, [fp, -#112]
+a0309390:	e51b2070 	ldr	r2, [fp, -#112]
+a0309394:	e51b3074 	ldr	r3, [fp, -#116]
+a0309398:	e0823003 	add	r3, r2, r3
+a030939c:	e50b3070 	str	r3, [fp, -#112]
+a03093a0:	e51b3078 	ldr	r3, [fp, -#120]
+a03093a4:	e1e02003 	mvn	r2, r3
+a03093a8:	e51b3070 	ldr	r3, [fp, -#112]
+a03093ac:	e1822003 	orr	r2, r2, r3
+a03093b0:	e51b3074 	ldr	r3, [fp, -#116]
+a03093b4:	e0222003 	eor	r2, r2, r3
+a03093b8:	e51b303c 	ldr	r3, [fp, -#60]
+a03093bc:	e0822003 	add	r2, r2, r3
+a03093c0:	e51b306c 	ldr	r3, [fp, -#108]
+a03093c4:	e0823003 	add	r3, r2, r3
+a03093c8:	e2833207 	add	r3, r3, #1879048192	; 0x70000000
+a03093cc:	e2433857 	sub	r3, r3, #5701632	; 0x570000
+a03093d0:	e2433c81 	sub	r3, r3, #33024	; 0x8100
+a03093d4:	e24330b1 	sub	r3, r3, #177	; 0xb1
+a03093d8:	e50b306c 	str	r3, [fp, -#108]
+a03093dc:	e51b306c 	ldr	r3, [fp, -#108]
+a03093e0:	e1a03d63 	mov	r3, r3, ror #26
+a03093e4:	e50b306c 	str	r3, [fp, -#108]
+a03093e8:	e51b206c 	ldr	r2, [fp, -#108]
+a03093ec:	e51b3070 	ldr	r3, [fp, -#112]
+a03093f0:	e0823003 	add	r3, r2, r3
+a03093f4:	e50b306c 	str	r3, [fp, -#108]
+a03093f8:	e51b3074 	ldr	r3, [fp, -#116]
+a03093fc:	e1e02003 	mvn	r2, r3
+a0309400:	e51b306c 	ldr	r3, [fp, -#108]
+a0309404:	e1822003 	orr	r2, r2, r3
+a0309408:	e51b3070 	ldr	r3, [fp, -#112]
+a030940c:	e0222003 	eor	r2, r2, r3
+a0309410:	e51b3020 	ldr	r3, [fp, -#32]
+a0309414:	e0822003 	add	r2, r2, r3
+a0309418:	e51b3078 	ldr	r3, [fp, -#120]
+a030941c:	e0823003 	add	r3, r2, r3
+a0309420:	e243361d 	sub	r3, r3, #30408704	; 0x1d00000
+a0309424:	e2433bc6 	sub	r3, r3, #202752	; 0x31800
+a0309428:	e2433e12 	sub	r3, r3, #288	; 0x120
+a030942c:	e50b3078 	str	r3, [fp, -#120]
+a0309430:	e51b3078 	ldr	r3, [fp, -#120]
+a0309434:	e1a03b63 	mov	r3, r3, ror #22
+a0309438:	e50b3078 	str	r3, [fp, -#120]
+a030943c:	e51b2078 	ldr	r2, [fp, -#120]
+a0309440:	e51b306c 	ldr	r3, [fp, -#108]
+a0309444:	e0823003 	add	r3, r2, r3
+a0309448:	e50b3078 	str	r3, [fp, -#120]
+a030944c:	e51b3070 	ldr	r3, [fp, -#112]
+a0309450:	e1e02003 	mvn	r2, r3
+a0309454:	e51b3078 	ldr	r3, [fp, -#120]
+a0309458:	e1822003 	orr	r2, r2, r3
+a030945c:	e51b306c 	ldr	r3, [fp, -#108]
+a0309460:	e0222003 	eor	r2, r2, r3
+a0309464:	e51b3044 	ldr	r3, [fp, -#68]
+a0309468:	e0822003 	add	r2, r2, r3
+a030946c:	e51b3074 	ldr	r3, [fp, -#116]
+a0309470:	e0823003 	add	r3, r2, r3
+a0309474:	e28334a3 	add	r3, r3, #-1560281088	; 0xa3000000
+a0309478:	e2833905 	add	r3, r3, #81920	; 0x14000
+a030947c:	e2833fc5 	add	r3, r3, #788	; 0x314
+a0309480:	e50b3074 	str	r3, [fp, -#116]
+a0309484:	e51b3074 	ldr	r3, [fp, -#116]
+a0309488:	e1a038e3 	mov	r3, r3, ror #17
+a030948c:	e50b3074 	str	r3, [fp, -#116]
+a0309490:	e51b2074 	ldr	r2, [fp, -#116]
+a0309494:	e51b3078 	ldr	r3, [fp, -#120]
+a0309498:	e0823003 	add	r3, r2, r3
+a030949c:	e50b3074 	str	r3, [fp, -#116]
+a03094a0:	e51b306c 	ldr	r3, [fp, -#108]
+a03094a4:	e1e02003 	mvn	r2, r3
+a03094a8:	e51b3074 	ldr	r3, [fp, -#116]
+a03094ac:	e1822003 	orr	r2, r2, r3
+a03094b0:	e51b3078 	ldr	r3, [fp, -#120]
+a03094b4:	e0222003 	eor	r2, r2, r3
+a03094b8:	e51b3028 	ldr	r3, [fp, -#40]
+a03094bc:	e0822003 	add	r2, r2, r3
+a03094c0:	e51b3070 	ldr	r3, [fp, -#112]
+a03094c4:	e0823003 	add	r3, r2, r3
+a03094c8:	e283344e 	add	r3, r3, #1308622848	; 0x4e000000
+a03094cc:	e2833a81 	add	r3, r3, #528384	; 0x81000
+a03094d0:	e2833e1a 	add	r3, r3, #416	; 0x1a0
+a03094d4:	e2833001 	add	r3, r3, #1	; 0x1
+a03094d8:	e50b3070 	str	r3, [fp, -#112]
+a03094dc:	e51b3070 	ldr	r3, [fp, -#112]
+a03094e0:	e1a035e3 	mov	r3, r3, ror #11
+a03094e4:	e50b3070 	str	r3, [fp, -#112]
+a03094e8:	e51b2070 	ldr	r2, [fp, -#112]
+a03094ec:	e51b3074 	ldr	r3, [fp, -#116]
+a03094f0:	e0823003 	add	r3, r2, r3
+a03094f4:	e50b3070 	str	r3, [fp, -#112]
+a03094f8:	e51b3078 	ldr	r3, [fp, -#120]
+a03094fc:	e1e02003 	mvn	r2, r3
+a0309500:	e51b3070 	ldr	r3, [fp, -#112]
+a0309504:	e1822003 	orr	r2, r2, r3
+a0309508:	e51b3074 	ldr	r3, [fp, -#116]
+a030950c:	e0222003 	eor	r2, r2, r3
+a0309510:	e51b304c 	ldr	r3, [fp, -#76]
+a0309514:	e0822003 	add	r2, r2, r3
+a0309518:	e51b306c 	ldr	r3, [fp, -#108]
+a030951c:	e0823003 	add	r3, r2, r3
+a0309520:	e243368a 	sub	r3, r3, #144703488	; 0x8a00000
+a0309524:	e2433932 	sub	r3, r3, #819200	; 0xc8000
+a0309528:	e2433f5f 	sub	r3, r3, #380	; 0x17c
+a030952c:	e2433002 	sub	r3, r3, #2	; 0x2
+a0309530:	e50b306c 	str	r3, [fp, -#108]
+a0309534:	e51b306c 	ldr	r3, [fp, -#108]
+a0309538:	e1a03d63 	mov	r3, r3, ror #26
+a030953c:	e50b306c 	str	r3, [fp, -#108]
+a0309540:	e51b206c 	ldr	r2, [fp, -#108]
+a0309544:	e51b3070 	ldr	r3, [fp, -#112]
+a0309548:	e0823003 	add	r3, r2, r3
+a030954c:	e50b306c 	str	r3, [fp, -#108]
+a0309550:	e51b3074 	ldr	r3, [fp, -#116]
+a0309554:	e1e02003 	mvn	r2, r3
+a0309558:	e51b306c 	ldr	r3, [fp, -#108]
+a030955c:	e1822003 	orr	r2, r2, r3
+a0309560:	e51b3070 	ldr	r3, [fp, -#112]
+a0309564:	e0222003 	eor	r2, r2, r3
+a0309568:	e51b3030 	ldr	r3, [fp, -#48]
+a030956c:	e0822003 	add	r2, r2, r3
+a0309570:	e51b3078 	ldr	r3, [fp, -#120]
+a0309574:	e0823003 	add	r3, r2, r3
+a0309578:	e28334be 	add	r3, r3, #-1107296256	; 0xbe000000
+a030957c:	e24338c5 	sub	r3, r3, #12910592	; 0xc50000
+a0309580:	e2433d37 	sub	r3, r3, #3520	; 0xdc0
+a0309584:	e243300b 	sub	r3, r3, #11	; 0xb
+a0309588:	e50b3078 	str	r3, [fp, -#120]
+a030958c:	e51b3078 	ldr	r3, [fp, -#120]
+a0309590:	e1a03b63 	mov	r3, r3, ror #22
+a0309594:	e50b3078 	str	r3, [fp, -#120]
+a0309598:	e51b2078 	ldr	r2, [fp, -#120]
+a030959c:	e51b306c 	ldr	r3, [fp, -#108]
+a03095a0:	e0823003 	add	r3, r2, r3
+a03095a4:	e50b3078 	str	r3, [fp, -#120]
+a03095a8:	e51b3070 	ldr	r3, [fp, -#112]
+a03095ac:	e1e02003 	mvn	r2, r3
+a03095b0:	e51b3078 	ldr	r3, [fp, -#120]
+a03095b4:	e1822003 	orr	r2, r2, r3
+a03095b8:	e51b306c 	ldr	r3, [fp, -#108]
+a03095bc:	e0222003 	eor	r2, r2, r3
+a03095c0:	e51b3054 	ldr	r3, [fp, -#84]
+a03095c4:	e0822003 	add	r2, r2, r3
+a03095c8:	e51b3074 	ldr	r3, [fp, -#116]
+a03095cc:	e0823003 	add	r3, r2, r3
+a03095d0:	e283342b 	add	r3, r3, #721420288	; 0x2b000000
+a03095d4:	e243370a 	sub	r3, r3, #2621440	; 0x280000
+a03095d8:	e2433db5 	sub	r3, r3, #11584	; 0x2d40
+a03095dc:	e2433005 	sub	r3, r3, #5	; 0x5
+a03095e0:	e50b3074 	str	r3, [fp, -#116]
+a03095e4:	e51b3074 	ldr	r3, [fp, -#116]
+a03095e8:	e1a038e3 	mov	r3, r3, ror #17
+a03095ec:	e50b3074 	str	r3, [fp, -#116]
+a03095f0:	e51b2074 	ldr	r2, [fp, -#116]
+a03095f4:	e51b3078 	ldr	r3, [fp, -#120]
+a03095f8:	e0823003 	add	r3, r2, r3
+a03095fc:	e50b3074 	str	r3, [fp, -#116]
+a0309600:	e51b306c 	ldr	r3, [fp, -#108]
+a0309604:	e1e02003 	mvn	r2, r3
+a0309608:	e51b3074 	ldr	r3, [fp, -#116]
+a030960c:	e1822003 	orr	r2, r2, r3
+a0309610:	e51b3078 	ldr	r3, [fp, -#120]
+a0309614:	e0222003 	eor	r2, r2, r3
+a0309618:	e51b3038 	ldr	r3, [fp, -#56]
+a030961c:	e0822003 	add	r2, r2, r3
+a0309620:	e51b3070 	ldr	r3, [fp, -#112]
+a0309624:	e0823003 	add	r3, r2, r3
+a0309628:	e2433551 	sub	r3, r3, #339738624	; 0x14400000
+a030962c:	e2433839 	sub	r3, r3, #3735552	; 0x390000
+a0309630:	e2433db1 	sub	r3, r3, #11328	; 0x2c40
+a0309634:	e243302f 	sub	r3, r3, #47	; 0x2f
+a0309638:	e50b3070 	str	r3, [fp, -#112]
+a030963c:	e51b3070 	ldr	r3, [fp, -#112]
+a0309640:	e1a035e3 	mov	r3, r3, ror #11
+a0309644:	e50b3070 	str	r3, [fp, -#112]
+a0309648:	e51b2070 	ldr	r2, [fp, -#112]
+a030964c:	e51b3074 	ldr	r3, [fp, -#116]
+a0309650:	e0823003 	add	r3, r2, r3
+a0309654:	e50b3070 	str	r3, [fp, -#112]
+a0309658:	e51b206c 	ldr	r2, [fp, -#108]
+a030965c:	e51b3080 	ldr	r3, [fp, -#128]
+a0309660:	e0823003 	add	r3, r2, r3
+a0309664:	e50b306c 	str	r3, [fp, -#108]
+a0309668:	e51b2070 	ldr	r2, [fp, -#112]
+a030966c:	e51b3084 	ldr	r3, [fp, -#132]
+a0309670:	e0823003 	add	r3, r2, r3
+a0309674:	e50b3070 	str	r3, [fp, -#112]
+a0309678:	e51b2074 	ldr	r2, [fp, -#116]
+a030967c:	e51b3088 	ldr	r3, [fp, -#136]
+a0309680:	e0823003 	add	r3, r2, r3
+a0309684:	e50b3074 	str	r3, [fp, -#116]
+a0309688:	e51b2078 	ldr	r2, [fp, -#120]
+a030968c:	e51b308c 	ldr	r3, [fp, -#140]
+a0309690:	e0823003 	add	r3, r2, r3
+a0309694:	e50b3078 	str	r3, [fp, -#120]
+a0309698:	eafff9ae 	b	a0307d58 <md5_process_block+0xb8>
+a030969c:	e51b201c 	ldr	r2, [fp, -#28]
+a03096a0:	e51b306c 	ldr	r3, [fp, -#108]
+a03096a4:	e5823000 	str	r3, [r2]
+a03096a8:	e51b201c 	ldr	r2, [fp, -#28]
+a03096ac:	e51b3070 	ldr	r3, [fp, -#112]
+a03096b0:	e5823004 	str	r3, [r2, #4]
+a03096b4:	e51b201c 	ldr	r2, [fp, -#28]
+a03096b8:	e51b3074 	ldr	r3, [fp, -#116]
+a03096bc:	e5823008 	str	r3, [r2, #8]
+a03096c0:	e51b201c 	ldr	r2, [fp, -#28]
+a03096c4:	e51b3078 	ldr	r3, [fp, -#120]
+a03096c8:	e582300c 	str	r3, [r2, #12]
+a03096cc:	e91ba810 	ldmdb	fp, {r4, fp, sp, pc}
+
+a03096d0 <print_md5_digest>:
+a03096d0:	e1a0c00d 	mov	ip, sp
+a03096d4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a03096d8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03096dc:	e24dd010 	sub	sp, sp, #16	; 0x10
+a03096e0:	e50b0010 	str	r0, [fp, -#16]
+a03096e4:	e51b3010 	ldr	r3, [fp, -#16]
+a03096e8:	e50b301c 	str	r3, [fp, -#28]
+a03096ec:	e3a03000 	mov	r3, #0	; 0x0
+a03096f0:	e50b3014 	str	r3, [fp, -#20]
+a03096f4:	e51b3014 	ldr	r3, [fp, -#20]
+a03096f8:	e353000f 	cmp	r3, #15	; 0xf
+a03096fc:	da000000 	ble	a0309704 <print_md5_digest+0x34>
+a0309700:	ea00002c 	b	a03097b8 <print_md5_digest+0xe8>
+a0309704:	e51b201c 	ldr	r2, [fp, -#28]
+a0309708:	e51b3014 	ldr	r3, [fp, -#20]
+a030970c:	e0823003 	add	r3, r2, r3
+a0309710:	e5d33000 	ldrb	r3, [r3]
+a0309714:	e1a03223 	mov	r3, r3, lsr #4
+a0309718:	e203300f 	and	r3, r3, #15	; 0xf
+a030971c:	e20330ff 	and	r3, r3, #255	; 0xff
+a0309720:	e50b3018 	str	r3, [fp, -#24]
+a0309724:	e51b3018 	ldr	r3, [fp, -#24]
+a0309728:	e3530009 	cmp	r3, #9	; 0x9
+a030972c:	da000003 	ble	a0309740 <print_md5_digest+0x70>
+a0309730:	e51b3018 	ldr	r3, [fp, -#24]
+a0309734:	e2833057 	add	r3, r3, #87	; 0x57
+a0309738:	e50b3018 	str	r3, [fp, -#24]
+a030973c:	ea000002 	b	a030974c <print_md5_digest+0x7c>
+a0309740:	e51b3018 	ldr	r3, [fp, -#24]
+a0309744:	e2833030 	add	r3, r3, #48	; 0x30
+a0309748:	e50b3018 	str	r3, [fp, -#24]
+a030974c:	e59f0070 	ldr	r0, [pc, #112]	; a03097c4 <print_md5_digest+0xf4>
+a0309750:	e51b1018 	ldr	r1, [fp, -#24]
+a0309754:	eb0004d1 	bl	a030aaa0 <printf>
+a0309758:	e51b201c 	ldr	r2, [fp, -#28]
+a030975c:	e51b3014 	ldr	r3, [fp, -#20]
+a0309760:	e0823003 	add	r3, r2, r3
+a0309764:	e5d33000 	ldrb	r3, [r3]
+a0309768:	e203300f 	and	r3, r3, #15	; 0xf
+a030976c:	e20330ff 	and	r3, r3, #255	; 0xff
+a0309770:	e50b3018 	str	r3, [fp, -#24]
+a0309774:	e51b3018 	ldr	r3, [fp, -#24]
+a0309778:	e3530009 	cmp	r3, #9	; 0x9
+a030977c:	da000003 	ble	a0309790 <print_md5_digest+0xc0>
+a0309780:	e51b3018 	ldr	r3, [fp, -#24]
+a0309784:	e2833057 	add	r3, r3, #87	; 0x57
+a0309788:	e50b3018 	str	r3, [fp, -#24]
+a030978c:	ea000002 	b	a030979c <print_md5_digest+0xcc>
+a0309790:	e51b3018 	ldr	r3, [fp, -#24]
+a0309794:	e2833030 	add	r3, r3, #48	; 0x30
+a0309798:	e50b3018 	str	r3, [fp, -#24]
+a030979c:	e59f0020 	ldr	r0, [pc, #32]	; a03097c4 <print_md5_digest+0xf4>
+a03097a0:	e51b1018 	ldr	r1, [fp, -#24]
+a03097a4:	eb0004bd 	bl	a030aaa0 <printf>
+a03097a8:	e51b3014 	ldr	r3, [fp, -#20]
+a03097ac:	e2833001 	add	r3, r3, #1	; 0x1
+a03097b0:	e50b3014 	str	r3, [fp, -#20]
+a03097b4:	eaffffce 	b	a03096f4 <print_md5_digest+0x24>
+a03097b8:	e51b3014 	ldr	r3, [fp, -#20]
+a03097bc:	e1a00003 	mov	r0, r3
+a03097c0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a03097c4:	a030d42c 	eorges	sp, r0, ip, lsr #8
+
+a03097c8 <memcpy>:
+a03097c8:	e1a0c00d 	mov	ip, sp
+a03097cc:	e92dd830 	stmdb	sp!, {r4, r5, fp, ip, lr, pc}
+a03097d0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03097d4:	e24dd014 	sub	sp, sp, #20	; 0x14
+a03097d8:	e50b0018 	str	r0, [fp, -#24]
+a03097dc:	e50b101c 	str	r1, [fp, -#28]
+a03097e0:	e50b2020 	str	r2, [fp, -#32]
+a03097e4:	e51b301c 	ldr	r3, [fp, -#28]
+a03097e8:	e50b3024 	str	r3, [fp, -#36]
+a03097ec:	e51b3018 	ldr	r3, [fp, -#24]
+a03097f0:	e50b3028 	str	r3, [fp, -#40]
+a03097f4:	e24b3020 	sub	r3, fp, #32	; 0x20
+a03097f8:	e5932000 	ldr	r2, [r3]
+a03097fc:	e1a01002 	mov	r1, r2
+a0309800:	e2422001 	sub	r2, r2, #1	; 0x1
+a0309804:	e5832000 	str	r2, [r3]
+a0309808:	e3510000 	cmp	r1, #0	; 0x0
+a030980c:	1a000000 	bne	a0309814 <memcpy+0x4c>
+a0309810:	ea00000c 	b	a0309848 <memcpy+0x80>
+a0309814:	e24b5028 	sub	r5, fp, #40	; 0x28
+a0309818:	e5951000 	ldr	r1, [r5]
+a030981c:	e24b4024 	sub	r4, fp, #36	; 0x24
+a0309820:	e5942000 	ldr	r2, [r4]
+a0309824:	e1a00001 	mov	r0, r1
+a0309828:	e1a03002 	mov	r3, r2
+a030982c:	e5d33000 	ldrb	r3, [r3]
+a0309830:	e5c03000 	strb	r3, [r0]
+a0309834:	e2822001 	add	r2, r2, #1	; 0x1
+a0309838:	e5842000 	str	r2, [r4]
+a030983c:	e2811001 	add	r1, r1, #1	; 0x1
+a0309840:	e5851000 	str	r1, [r5]
+a0309844:	eaffffea 	b	a03097f4 <memcpy+0x2c>
+a0309848:	e51b3018 	ldr	r3, [fp, -#24]
+a030984c:	e1a00003 	mov	r0, r3
+a0309850:	e91ba830 	ldmdb	fp, {r4, r5, fp, sp, pc}
+
+a0309854 <skip_atoi>:
+a0309854:	e1a0c00d 	mov	ip, sp
+a0309858:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030985c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0309860:	e24dd008 	sub	sp, sp, #8	; 0x8
+a0309864:	e50b0010 	str	r0, [fp, -#16]
+a0309868:	e3a03000 	mov	r3, #0	; 0x0
+a030986c:	e50b3014 	str	r3, [fp, -#20]
+a0309870:	e51b3010 	ldr	r3, [fp, -#16]
+a0309874:	e5933000 	ldr	r3, [r3]
+a0309878:	e5d33000 	ldrb	r3, [r3]
+a030987c:	e1a00003 	mov	r0, r3
+a0309880:	eb00049a 	bl	a030aaf0 <isdigit>
+a0309884:	e1a03000 	mov	r3, r0
+a0309888:	e3530000 	cmp	r3, #0	; 0x0
+a030988c:	1a000000 	bne	a0309894 <skip_atoi+0x40>
+a0309890:	ea00000e 	b	a03098d0 <skip_atoi+0x7c>
+a0309894:	e51b2014 	ldr	r2, [fp, -#20]
+a0309898:	e1a03002 	mov	r3, r2
+a030989c:	e1a03103 	mov	r3, r3, lsl #2
+a03098a0:	e0833002 	add	r3, r3, r2
+a03098a4:	e1a01083 	mov	r1, r3, lsl #1
+a03098a8:	e51b0010 	ldr	r0, [fp, -#16]
+a03098ac:	e5902000 	ldr	r2, [r0]
+a03098b0:	e1a03002 	mov	r3, r2
+a03098b4:	e5d33000 	ldrb	r3, [r3]
+a03098b8:	e0813003 	add	r3, r1, r3
+a03098bc:	e2433030 	sub	r3, r3, #48	; 0x30
+a03098c0:	e50b3014 	str	r3, [fp, -#20]
+a03098c4:	e2822001 	add	r2, r2, #1	; 0x1
+a03098c8:	e5802000 	str	r2, [r0]
+a03098cc:	eaffffe7 	b	a0309870 <skip_atoi+0x1c>
+a03098d0:	e51b3014 	ldr	r3, [fp, -#20]
+a03098d4:	e1a00003 	mov	r0, r3
+a03098d8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a03098dc <number>:
+a03098dc:	e1a0c00d 	mov	ip, sp
+a03098e0:	e92dd870 	stmdb	sp!, {r4, r5, r6, fp, ip, lr, pc}
+a03098e4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a03098e8:	e24dd0c4 	sub	sp, sp, #196	; 0xc4
+a03098ec:	e50b001c 	str	r0, [fp, -#28]
+a03098f0:	e50b1020 	str	r1, [fp, -#32]
+a03098f4:	e3e0100f 	mvn	r1, #15	; 0xf
+a03098f8:	e24b0018 	sub	r0, fp, #24	; 0x18
+a03098fc:	e0801001 	add	r1, r0, r1
+a0309900:	e881000c 	stmia	r1, {r2, r3}
+a0309904:	e59f3604 	ldr	r3, [pc, #1540]	; a0309f10 <number+0x634>
+a0309908:	e24b409c 	sub	r4, fp, #156	; 0x9c
+a030990c:	e1a0c003 	mov	ip, r3
+a0309910:	e8bc000f 	ldmia	ip!, {r0, r1, r2, r3}
+a0309914:	e8a4000f 	stmia	r4!, {r0, r1, r2, r3}
+a0309918:	e8bc000f 	ldmia	ip!, {r0, r1, r2, r3}
+a030991c:	e8a4000f 	stmia	r4!, {r0, r1, r2, r3}
+a0309920:	e89c0003 	ldmia	ip, {r0, r1}
+a0309924:	e5840000 	str	r0, [r4]
+a0309928:	e2844004 	add	r4, r4, #4	; 0x4
+a030992c:	e5c41000 	strb	r1, [r4]
+a0309930:	e59f35dc 	ldr	r3, [pc, #1500]	; a0309f14 <number+0x638>
+a0309934:	e24b40c4 	sub	r4, fp, #196	; 0xc4
+a0309938:	e1a0c003 	mov	ip, r3
+a030993c:	e8bc000f 	ldmia	ip!, {r0, r1, r2, r3}
+a0309940:	e8a4000f 	stmia	r4!, {r0, r1, r2, r3}
+a0309944:	e8bc000f 	ldmia	ip!, {r0, r1, r2, r3}
+a0309948:	e8a4000f 	stmia	r4!, {r0, r1, r2, r3}
+a030994c:	e89c0003 	ldmia	ip, {r0, r1}
+a0309950:	e5840000 	str	r0, [r4]
+a0309954:	e2844004 	add	r4, r4, #4	; 0x4
+a0309958:	e5c41000 	strb	r1, [r4]
+a030995c:	e59b3010 	ldr	r3, [fp, #16]
+a0309960:	e2033040 	and	r3, r3, #64	; 0x40
+a0309964:	e3530000 	cmp	r3, #0	; 0x0
+a0309968:	0a000002 	beq	a0309978 <number+0x9c>
+a030996c:	e24b10c4 	sub	r1, fp, #196	; 0xc4
+a0309970:	e50b10d4 	str	r1, [fp, -#212]
+a0309974:	ea000001 	b	a0309980 <number+0xa4>
+a0309978:	e24b209c 	sub	r2, fp, #156	; 0x9c
+a030997c:	e50b20d4 	str	r2, [fp, -#212]
+a0309980:	e51b30d4 	ldr	r3, [fp, -#212]
+a0309984:	e50b3074 	str	r3, [fp, -#116]
+a0309988:	e59b3010 	ldr	r3, [fp, #16]
+a030998c:	e2033010 	and	r3, r3, #16	; 0x10
+a0309990:	e3530000 	cmp	r3, #0	; 0x0
+a0309994:	0a000002 	beq	a03099a4 <number+0xc8>
+a0309998:	e59b3010 	ldr	r3, [fp, #16]
+a030999c:	e3c33001 	bic	r3, r3, #1	; 0x1
+a03099a0:	e58b3010 	str	r3, [fp, #16]
+a03099a4:	e59b3004 	ldr	r3, [fp, #4]
+a03099a8:	e3530001 	cmp	r3, #1	; 0x1
+a03099ac:	da000003 	ble	a03099c0 <number+0xe4>
+a03099b0:	e59b3004 	ldr	r3, [fp, #4]
+a03099b4:	e3530024 	cmp	r3, #36	; 0x24
+a03099b8:	ca000000 	bgt	a03099c0 <number+0xe4>
+a03099bc:	ea000002 	b	a03099cc <number+0xf0>
+a03099c0:	e3a0c000 	mov	ip, #0	; 0x0
+a03099c4:	e50bc0d0 	str	ip, [fp, -#208]
+a03099c8:	ea00014e 	b	a0309f08 <number+0x62c>
+a03099cc:	e59b3010 	ldr	r3, [fp, #16]
+a03099d0:	e2033001 	and	r3, r3, #1	; 0x1
+a03099d4:	e3530000 	cmp	r3, #0	; 0x0
+a03099d8:	0a000002 	beq	a03099e8 <number+0x10c>
+a03099dc:	e3a03030 	mov	r3, #48	; 0x30
+a03099e0:	e54b30d5 	strb	r3, [fp, -#213]
+a03099e4:	ea000001 	b	a03099f0 <number+0x114>
+a03099e8:	e3a03020 	mov	r3, #32	; 0x20
+a03099ec:	e54b30d5 	strb	r3, [fp, -#213]
+a03099f0:	e55b00d5 	ldrb	r0, [fp, -#213]
+a03099f4:	e54b0029 	strb	r0, [fp, -#41]
+a03099f8:	e3a03000 	mov	r3, #0	; 0x0
+a03099fc:	e54b302a 	strb	r3, [fp, -#42]
+a0309a00:	e59b3010 	ldr	r3, [fp, #16]
+a0309a04:	e2033002 	and	r3, r3, #2	; 0x2
+a0309a08:	e3530000 	cmp	r3, #0	; 0x0
+a0309a0c:	0a000033 	beq	a0309ae0 <number+0x204>
+a0309a10:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309a14:	e24b1018 	sub	r1, fp, #24	; 0x18
+a0309a18:	e0811003 	add	r1, r1, r3
+a0309a1c:	e50b10dc 	str	r1, [fp, -#220]
+a0309a20:	e51b20dc 	ldr	r2, [fp, -#220]
+a0309a24:	e5923004 	ldr	r3, [r2, #4]
+a0309a28:	e3530000 	cmp	r3, #0	; 0x0
+a0309a2c:	ba000008 	blt	a0309a54 <number+0x178>
+a0309a30:	e51b00dc 	ldr	r0, [fp, -#220]
+a0309a34:	e5903004 	ldr	r3, [r0, #4]
+a0309a38:	e3530000 	cmp	r3, #0	; 0x0
+a0309a3c:	1a000014 	bne	a0309a94 <number+0x1b8>
+a0309a40:	e51b10dc 	ldr	r1, [fp, -#220]
+a0309a44:	e5913000 	ldr	r3, [r1]
+a0309a48:	e3530000 	cmp	r3, #0	; 0x0
+a0309a4c:	3a000000 	bcc	a0309a54 <number+0x178>
+a0309a50:	ea00000f 	b	a0309a94 <number+0x1b8>
+a0309a54:	e3a0302d 	mov	r3, #45	; 0x2d
+a0309a58:	e54b302a 	strb	r3, [fp, -#42]
+a0309a5c:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309a60:	e24bc018 	sub	ip, fp, #24	; 0x18
+a0309a64:	e08c2003 	add	r2, ip, r3
+a0309a68:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309a6c:	e24b0018 	sub	r0, fp, #24	; 0x18
+a0309a70:	e0803003 	add	r3, r0, r3
+a0309a74:	e8930018 	ldmia	r3, {r3, r4}
+a0309a78:	e2733000 	rsbs	r3, r3, #0	; 0x0
+a0309a7c:	e2e44000 	rsc	r4, r4, #0	; 0x0
+a0309a80:	e8820018 	stmia	r2, {r3, r4}
+a0309a84:	e59b3008 	ldr	r3, [fp, #8]
+a0309a88:	e2433001 	sub	r3, r3, #1	; 0x1
+a0309a8c:	e58b3008 	str	r3, [fp, #8]
+a0309a90:	ea000012 	b	a0309ae0 <number+0x204>
+a0309a94:	e59b3010 	ldr	r3, [fp, #16]
+a0309a98:	e2033004 	and	r3, r3, #4	; 0x4
+a0309a9c:	e3530000 	cmp	r3, #0	; 0x0
+a0309aa0:	0a000005 	beq	a0309abc <number+0x1e0>
+a0309aa4:	e3a0302b 	mov	r3, #43	; 0x2b
+a0309aa8:	e54b302a 	strb	r3, [fp, -#42]
+a0309aac:	e59b3008 	ldr	r3, [fp, #8]
+a0309ab0:	e2433001 	sub	r3, r3, #1	; 0x1
+a0309ab4:	e58b3008 	str	r3, [fp, #8]
+a0309ab8:	ea000008 	b	a0309ae0 <number+0x204>
+a0309abc:	e59b3010 	ldr	r3, [fp, #16]
+a0309ac0:	e2033008 	and	r3, r3, #8	; 0x8
+a0309ac4:	e3530000 	cmp	r3, #0	; 0x0
+a0309ac8:	0a000004 	beq	a0309ae0 <number+0x204>
+a0309acc:	e3a03020 	mov	r3, #32	; 0x20
+a0309ad0:	e54b302a 	strb	r3, [fp, -#42]
+a0309ad4:	e59b3008 	ldr	r3, [fp, #8]
+a0309ad8:	e2433001 	sub	r3, r3, #1	; 0x1
+a0309adc:	e58b3008 	str	r3, [fp, #8]
+a0309ae0:	e59b3010 	ldr	r3, [fp, #16]
+a0309ae4:	e2033020 	and	r3, r3, #32	; 0x20
+a0309ae8:	e3530000 	cmp	r3, #0	; 0x0
+a0309aec:	0a00000c 	beq	a0309b24 <number+0x248>
+a0309af0:	e59b3004 	ldr	r3, [fp, #4]
+a0309af4:	e3530010 	cmp	r3, #16	; 0x10
+a0309af8:	1a000003 	bne	a0309b0c <number+0x230>
+a0309afc:	e59b3008 	ldr	r3, [fp, #8]
+a0309b00:	e2433002 	sub	r3, r3, #2	; 0x2
+a0309b04:	e58b3008 	str	r3, [fp, #8]
+a0309b08:	ea000005 	b	a0309b24 <number+0x248>
+a0309b0c:	e59b3004 	ldr	r3, [fp, #4]
+a0309b10:	e3530008 	cmp	r3, #8	; 0x8
+a0309b14:	1a000002 	bne	a0309b24 <number+0x248>
+a0309b18:	e59b3008 	ldr	r3, [fp, #8]
+a0309b1c:	e2433001 	sub	r3, r3, #1	; 0x1
+a0309b20:	e58b3008 	str	r3, [fp, #8]
+a0309b24:	e3a03000 	mov	r3, #0	; 0x0
+a0309b28:	e50b30c8 	str	r3, [fp, -#200]
+a0309b2c:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309b30:	e24b1018 	sub	r1, fp, #24	; 0x18
+a0309b34:	e0812003 	add	r2, r1, r3
+a0309b38:	e5923000 	ldr	r3, [r2]
+a0309b3c:	e5922004 	ldr	r2, [r2, #4]
+a0309b40:	e1833002 	orr	r3, r3, r2
+a0309b44:	e3530000 	cmp	r3, #0	; 0x0
+a0309b48:	1a00000b 	bne	a0309b7c <number+0x2a0>
+a0309b4c:	e24b00c8 	sub	r0, fp, #200	; 0xc8
+a0309b50:	e5902000 	ldr	r2, [r0]
+a0309b54:	e3e01057 	mvn	r1, #87	; 0x57
+a0309b58:	e1a03002 	mov	r3, r2
+a0309b5c:	e24bc018 	sub	ip, fp, #24	; 0x18
+a0309b60:	e083300c 	add	r3, r3, ip
+a0309b64:	e0831001 	add	r1, r3, r1
+a0309b68:	e3a03030 	mov	r3, #48	; 0x30
+a0309b6c:	e5c13000 	strb	r3, [r1]
+a0309b70:	e2822001 	add	r2, r2, #1	; 0x1
+a0309b74:	e5802000 	str	r2, [r0]
+a0309b78:	ea00002d 	b	a0309c34 <number+0x358>
+a0309b7c:	e1a00000 	nop			(mov r0,r0)
+a0309b80:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309b84:	e24b0018 	sub	r0, fp, #24	; 0x18
+a0309b88:	e0802003 	add	r2, r0, r3
+a0309b8c:	e5923000 	ldr	r3, [r2]
+a0309b90:	e5922004 	ldr	r2, [r2, #4]
+a0309b94:	e1833002 	orr	r3, r3, r2
+a0309b98:	e3530000 	cmp	r3, #0	; 0x0
+a0309b9c:	1a000000 	bne	a0309ba4 <number+0x2c8>
+a0309ba0:	ea000023 	b	a0309c34 <number+0x358>
+a0309ba4:	e24b50c8 	sub	r5, fp, #200	; 0xc8
+a0309ba8:	e5954000 	ldr	r4, [r5]
+a0309bac:	e3e02057 	mvn	r2, #87	; 0x57
+a0309bb0:	e1a03004 	mov	r3, r4
+a0309bb4:	e24b1018 	sub	r1, fp, #24	; 0x18
+a0309bb8:	e0833001 	add	r3, r3, r1
+a0309bbc:	e0836002 	add	r6, r3, r2
+a0309bc0:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309bc4:	e24b2018 	sub	r2, fp, #24	; 0x18
+a0309bc8:	e0823003 	add	r3, r2, r3
+a0309bcc:	e5933000 	ldr	r3, [r3]
+a0309bd0:	e1a00003 	mov	r0, r3
+a0309bd4:	e59b1004 	ldr	r1, [fp, #4]
+a0309bd8:	eb0008fb 	bl	a030bfcc <__umodsi3>
+a0309bdc:	e1a03000 	mov	r3, r0
+a0309be0:	e50b30cc 	str	r3, [fp, -#204]
+a0309be4:	e2844001 	add	r4, r4, #1	; 0x1
+a0309be8:	e5854000 	str	r4, [r5]
+a0309bec:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309bf0:	e24bc018 	sub	ip, fp, #24	; 0x18
+a0309bf4:	e08c5003 	add	r5, ip, r3
+a0309bf8:	e3e0300f 	mvn	r3, #15	; 0xf
+a0309bfc:	e24b0018 	sub	r0, fp, #24	; 0x18
+a0309c00:	e0803003 	add	r3, r0, r3
+a0309c04:	e5930000 	ldr	r0, [r3]
+a0309c08:	e59b1004 	ldr	r1, [fp, #4]
+a0309c0c:	eb0008c8 	bl	a030bf34 <__udivsi3>
+a0309c10:	e1a03000 	mov	r3, r0
+a0309c14:	e3a04000 	mov	r4, #0	; 0x0
+a0309c18:	e8850018 	stmia	r5, {r3, r4}
+a0309c1c:	e51b20cc 	ldr	r2, [fp, -#204]
+a0309c20:	e51b3074 	ldr	r3, [fp, -#116]
+a0309c24:	e0823003 	add	r3, r2, r3
+a0309c28:	e5d33000 	ldrb	r3, [r3]
+a0309c2c:	e5c63000 	strb	r3, [r6]
+a0309c30:	eaffffd2 	b	a0309b80 <number+0x2a4>
+a0309c34:	e51b20c8 	ldr	r2, [fp, -#200]
+a0309c38:	e59b300c 	ldr	r3, [fp, #12]
+a0309c3c:	e1520003 	cmp	r2, r3
+a0309c40:	da000001 	ble	a0309c4c <number+0x370>
+a0309c44:	e51b30c8 	ldr	r3, [fp, -#200]
+a0309c48:	e58b300c 	str	r3, [fp, #12]
+a0309c4c:	e59b2008 	ldr	r2, [fp, #8]
+a0309c50:	e59b300c 	ldr	r3, [fp, #12]
+a0309c54:	e0633002 	rsb	r3, r3, r2
+a0309c58:	e58b3008 	str	r3, [fp, #8]
+a0309c5c:	e59b3010 	ldr	r3, [fp, #16]
+a0309c60:	e2033011 	and	r3, r3, #17	; 0x11
+a0309c64:	e3530000 	cmp	r3, #0	; 0x0
+a0309c68:	1a000012 	bne	a0309cb8 <number+0x3dc>
+a0309c6c:	e28b3008 	add	r3, fp, #8	; 0x8
+a0309c70:	e5932000 	ldr	r2, [r3]
+a0309c74:	e1a01002 	mov	r1, r2
+a0309c78:	e2422001 	sub	r2, r2, #1	; 0x1
+a0309c7c:	e5832000 	str	r2, [r3]
+a0309c80:	e3510000 	cmp	r1, #0	; 0x0
+a0309c84:	ca000000 	bgt	a0309c8c <number+0x3b0>
+a0309c88:	ea00000a 	b	a0309cb8 <number+0x3dc>
+a0309c8c:	e51b201c 	ldr	r2, [fp, -#28]
+a0309c90:	e51b3020 	ldr	r3, [fp, -#32]
+a0309c94:	e1520003 	cmp	r2, r3
+a0309c98:	8a000002 	bhi	a0309ca8 <number+0x3cc>
+a0309c9c:	e51b301c 	ldr	r3, [fp, -#28]
+a0309ca0:	e3a02020 	mov	r2, #32	; 0x20
+a0309ca4:	e5c32000 	strb	r2, [r3]
+a0309ca8:	e51b301c 	ldr	r3, [fp, -#28]
+a0309cac:	e2833001 	add	r3, r3, #1	; 0x1
+a0309cb0:	e50b301c 	str	r3, [fp, -#28]
+a0309cb4:	eaffffec 	b	a0309c6c <number+0x390>
+a0309cb8:	e55b302a 	ldrb	r3, [fp, -#42]
+a0309cbc:	e3530000 	cmp	r3, #0	; 0x0
+a0309cc0:	0a000009 	beq	a0309cec <number+0x410>
+a0309cc4:	e51b201c 	ldr	r2, [fp, -#28]
+a0309cc8:	e51b3020 	ldr	r3, [fp, -#32]
+a0309ccc:	e1520003 	cmp	r2, r3
+a0309cd0:	8a000002 	bhi	a0309ce0 <number+0x404>
+a0309cd4:	e51b201c 	ldr	r2, [fp, -#28]
+a0309cd8:	e55b302a 	ldrb	r3, [fp, -#42]
+a0309cdc:	e5c23000 	strb	r3, [r2]
+a0309ce0:	e51b301c 	ldr	r3, [fp, -#28]
+a0309ce4:	e2833001 	add	r3, r3, #1	; 0x1
+a0309ce8:	e50b301c 	str	r3, [fp, -#28]
+a0309cec:	e59b3010 	ldr	r3, [fp, #16]
+a0309cf0:	e2033020 	and	r3, r3, #32	; 0x20
+a0309cf4:	e3530000 	cmp	r3, #0	; 0x0
+a0309cf8:	0a000027 	beq	a0309d9c <number+0x4c0>
+a0309cfc:	e59b3004 	ldr	r3, [fp, #4]
+a0309d00:	e3530008 	cmp	r3, #8	; 0x8
+a0309d04:	1a00000a 	bne	a0309d34 <number+0x458>
+a0309d08:	e51b201c 	ldr	r2, [fp, -#28]
+a0309d0c:	e51b3020 	ldr	r3, [fp, -#32]
+a0309d10:	e1520003 	cmp	r2, r3
+a0309d14:	8a000002 	bhi	a0309d24 <number+0x448>
+a0309d18:	e51b301c 	ldr	r3, [fp, -#28]
+a0309d1c:	e3a02030 	mov	r2, #48	; 0x30
+a0309d20:	e5c32000 	strb	r2, [r3]
+a0309d24:	e51b301c 	ldr	r3, [fp, -#28]
+a0309d28:	e2833001 	add	r3, r3, #1	; 0x1
+a0309d2c:	e50b301c 	str	r3, [fp, -#28]
+a0309d30:	ea000019 	b	a0309d9c <number+0x4c0>
+a0309d34:	e59b3004 	ldr	r3, [fp, #4]
+a0309d38:	e3530010 	cmp	r3, #16	; 0x10
+a0309d3c:	1a000016 	bne	a0309d9c <number+0x4c0>
+a0309d40:	e51b201c 	ldr	r2, [fp, -#28]
+a0309d44:	e51b3020 	ldr	r3, [fp, -#32]
+a0309d48:	e1520003 	cmp	r2, r3
+a0309d4c:	8a000002 	bhi	a0309d5c <number+0x480>
+a0309d50:	e51b301c 	ldr	r3, [fp, -#28]
+a0309d54:	e3a02030 	mov	r2, #48	; 0x30
+a0309d58:	e5c32000 	strb	r2, [r3]
+a0309d5c:	e51b301c 	ldr	r3, [fp, -#28]
+a0309d60:	e2833001 	add	r3, r3, #1	; 0x1
+a0309d64:	e50b301c 	str	r3, [fp, -#28]
+a0309d68:	e51b201c 	ldr	r2, [fp, -#28]
+a0309d6c:	e51b3020 	ldr	r3, [fp, -#32]
+a0309d70:	e1520003 	cmp	r2, r3
+a0309d74:	8a000005 	bhi	a0309d90 <number+0x4b4>
+a0309d78:	e51b101c 	ldr	r1, [fp, -#28]
+a0309d7c:	e3a02021 	mov	r2, #33	; 0x21
+a0309d80:	e51b3074 	ldr	r3, [fp, -#116]
+a0309d84:	e0823003 	add	r3, r2, r3
+a0309d88:	e5d33000 	ldrb	r3, [r3]
+a0309d8c:	e5c13000 	strb	r3, [r1]
+a0309d90:	e51b301c 	ldr	r3, [fp, -#28]
+a0309d94:	e2833001 	add	r3, r3, #1	; 0x1
+a0309d98:	e50b301c 	str	r3, [fp, -#28]
+a0309d9c:	e59b3010 	ldr	r3, [fp, #16]
+a0309da0:	e2033010 	and	r3, r3, #16	; 0x10
+a0309da4:	e3530000 	cmp	r3, #0	; 0x0
+a0309da8:	1a000012 	bne	a0309df8 <number+0x51c>
+a0309dac:	e28b3008 	add	r3, fp, #8	; 0x8
+a0309db0:	e5932000 	ldr	r2, [r3]
+a0309db4:	e1a01002 	mov	r1, r2
+a0309db8:	e2422001 	sub	r2, r2, #1	; 0x1
+a0309dbc:	e5832000 	str	r2, [r3]
+a0309dc0:	e3510000 	cmp	r1, #0	; 0x0
+a0309dc4:	ca000000 	bgt	a0309dcc <number+0x4f0>
+a0309dc8:	ea00000a 	b	a0309df8 <number+0x51c>
+a0309dcc:	e51b201c 	ldr	r2, [fp, -#28]
+a0309dd0:	e51b3020 	ldr	r3, [fp, -#32]
+a0309dd4:	e1520003 	cmp	r2, r3
+a0309dd8:	8a000002 	bhi	a0309de8 <number+0x50c>
+a0309ddc:	e51b201c 	ldr	r2, [fp, -#28]
+a0309de0:	e55b3029 	ldrb	r3, [fp, -#41]
+a0309de4:	e5c23000 	strb	r3, [r2]
+a0309de8:	e51b301c 	ldr	r3, [fp, -#28]
+a0309dec:	e2833001 	add	r3, r3, #1	; 0x1
+a0309df0:	e50b301c 	str	r3, [fp, -#28]
+a0309df4:	eaffffec 	b	a0309dac <number+0x4d0>
+a0309df8:	e1a00000 	nop			(mov r0,r0)
+a0309dfc:	e28b200c 	add	r2, fp, #12	; 0xc
+a0309e00:	e5923000 	ldr	r3, [r2]
+a0309e04:	e1a01003 	mov	r1, r3
+a0309e08:	e2433001 	sub	r3, r3, #1	; 0x1
+a0309e0c:	e5823000 	str	r3, [r2]
+a0309e10:	e51b30c8 	ldr	r3, [fp, -#200]
+a0309e14:	e1510003 	cmp	r1, r3
+a0309e18:	ca000000 	bgt	a0309e20 <number+0x544>
+a0309e1c:	ea00000a 	b	a0309e4c <number+0x570>
+a0309e20:	e51b201c 	ldr	r2, [fp, -#28]
+a0309e24:	e51b3020 	ldr	r3, [fp, -#32]
+a0309e28:	e1520003 	cmp	r2, r3
+a0309e2c:	8a000002 	bhi	a0309e3c <number+0x560>
+a0309e30:	e51b301c 	ldr	r3, [fp, -#28]
+a0309e34:	e3a02030 	mov	r2, #48	; 0x30
+a0309e38:	e5c32000 	strb	r2, [r3]
+a0309e3c:	e51b301c 	ldr	r3, [fp, -#28]
+a0309e40:	e2833001 	add	r3, r3, #1	; 0x1
+a0309e44:	e50b301c 	str	r3, [fp, -#28]
+a0309e48:	eaffffeb 	b	a0309dfc <number+0x520>
+a0309e4c:	e1a00000 	nop			(mov r0,r0)
+a0309e50:	e24b30c8 	sub	r3, fp, #200	; 0xc8
+a0309e54:	e5932000 	ldr	r2, [r3]
+a0309e58:	e1a01002 	mov	r1, r2
+a0309e5c:	e2422001 	sub	r2, r2, #1	; 0x1
+a0309e60:	e5832000 	str	r2, [r3]
+a0309e64:	e3510000 	cmp	r1, #0	; 0x0
+a0309e68:	ca000000 	bgt	a0309e70 <number+0x594>
+a0309e6c:	ea00000f 	b	a0309eb0 <number+0x5d4>
+a0309e70:	e51b201c 	ldr	r2, [fp, -#28]
+a0309e74:	e51b3020 	ldr	r3, [fp, -#32]
+a0309e78:	e1520003 	cmp	r2, r3
+a0309e7c:	8a000007 	bhi	a0309ea0 <number+0x5c4>
+a0309e80:	e51b101c 	ldr	r1, [fp, -#28]
+a0309e84:	e3e02057 	mvn	r2, #87	; 0x57
+a0309e88:	e51b30c8 	ldr	r3, [fp, -#200]
+a0309e8c:	e24bc018 	sub	ip, fp, #24	; 0x18
+a0309e90:	e08c3003 	add	r3, ip, r3
+a0309e94:	e0833002 	add	r3, r3, r2
+a0309e98:	e5d33000 	ldrb	r3, [r3]
+a0309e9c:	e5c13000 	strb	r3, [r1]
+a0309ea0:	e51b301c 	ldr	r3, [fp, -#28]
+a0309ea4:	e2833001 	add	r3, r3, #1	; 0x1
+a0309ea8:	e50b301c 	str	r3, [fp, -#28]
+a0309eac:	eaffffe7 	b	a0309e50 <number+0x574>
+a0309eb0:	e1a00000 	nop			(mov r0,r0)
+a0309eb4:	e28b3008 	add	r3, fp, #8	; 0x8
+a0309eb8:	e5932000 	ldr	r2, [r3]
+a0309ebc:	e1a01002 	mov	r1, r2
+a0309ec0:	e2422001 	sub	r2, r2, #1	; 0x1
+a0309ec4:	e5832000 	str	r2, [r3]
+a0309ec8:	e3510000 	cmp	r1, #0	; 0x0
+a0309ecc:	ca000000 	bgt	a0309ed4 <number+0x5f8>
+a0309ed0:	ea00000a 	b	a0309f00 <number+0x624>
+a0309ed4:	e51b201c 	ldr	r2, [fp, -#28]
+a0309ed8:	e51b3020 	ldr	r3, [fp, -#32]
+a0309edc:	e1520003 	cmp	r2, r3
+a0309ee0:	8a000002 	bhi	a0309ef0 <number+0x614>
+a0309ee4:	e51b301c 	ldr	r3, [fp, -#28]
+a0309ee8:	e3a02020 	mov	r2, #32	; 0x20
+a0309eec:	e5c32000 	strb	r2, [r3]
+a0309ef0:	e51b301c 	ldr	r3, [fp, -#28]
+a0309ef4:	e2833001 	add	r3, r3, #1	; 0x1
+a0309ef8:	e50b301c 	str	r3, [fp, -#28]
+a0309efc:	eaffffec 	b	a0309eb4 <number+0x5d8>
+a0309f00:	e51b301c 	ldr	r3, [fp, -#28]
+a0309f04:	e50b30d0 	str	r3, [fp, -#208]
+a0309f08:	e51b00d0 	ldr	r0, [fp, -#208]
+a0309f0c:	e91ba870 	ldmdb	fp, {r4, r5, r6, fp, sp, pc}
+a0309f10:	a030d430 	eorges	sp, r0, r0, lsr r4
+a0309f14:	a030d458 	eorges	sp, r0, r8, asr r4
+
+a0309f18 <vsnprintf>:
+a0309f18:	e1a0c00d 	mov	ip, sp
+a0309f1c:	e92dd830 	stmdb	sp!, {r4, r5, fp, ip, lr, pc}
+a0309f20:	e24cb004 	sub	fp, ip, #4	; 0x4
+a0309f24:	e24dd058 	sub	sp, sp, #88	; 0x58
+a0309f28:	e50b0018 	str	r0, [fp, -#24]
+a0309f2c:	e50b101c 	str	r1, [fp, -#28]
+a0309f30:	e50b2020 	str	r2, [fp, -#32]
+a0309f34:	e50b3024 	str	r3, [fp, -#36]
+a0309f38:	e51b3018 	ldr	r3, [fp, -#24]
+a0309f3c:	e50b303c 	str	r3, [fp, -#60]
+a0309f40:	e51b2018 	ldr	r2, [fp, -#24]
+a0309f44:	e51b301c 	ldr	r3, [fp, -#28]
+a0309f48:	e0823003 	add	r3, r2, r3
+a0309f4c:	e2433001 	sub	r3, r3, #1	; 0x1
+a0309f50:	e50b3040 	str	r3, [fp, -#64]
+a0309f54:	e51b3018 	ldr	r3, [fp, -#24]
+a0309f58:	e2432001 	sub	r2, r3, #1	; 0x1
+a0309f5c:	e51b3040 	ldr	r3, [fp, -#64]
+a0309f60:	e1530002 	cmp	r3, r2
+a0309f64:	2a000006 	bcs	a0309f84 <vsnprintf+0x6c>
+a0309f68:	e3e03000 	mvn	r3, #0	; 0x0
+a0309f6c:	e50b3040 	str	r3, [fp, -#64]
+a0309f70:	e51b2040 	ldr	r2, [fp, -#64]
+a0309f74:	e51b3018 	ldr	r3, [fp, -#24]
+a0309f78:	e0633002 	rsb	r3, r3, r2
+a0309f7c:	e2833001 	add	r3, r3, #1	; 0x1
+a0309f80:	e50b301c 	str	r3, [fp, -#28]
+a0309f84:	e1a00000 	nop			(mov r0,r0)
+a0309f88:	e51b3020 	ldr	r3, [fp, -#32]
+a0309f8c:	e5d33000 	ldrb	r3, [r3]
+a0309f90:	e3530000 	cmp	r3, #0	; 0x0
+a0309f94:	1a000000 	bne	a0309f9c <vsnprintf+0x84>
+a0309f98:	ea000299 	b	a030aa04 <vsnprintf+0xaec>
+a0309f9c:	e51b3020 	ldr	r3, [fp, -#32]
+a0309fa0:	e5d33000 	ldrb	r3, [r3]
+a0309fa4:	e3530025 	cmp	r3, #37	; 0x25
+a0309fa8:	0a00000b 	beq	a0309fdc <vsnprintf+0xc4>
+a0309fac:	e51b203c 	ldr	r2, [fp, -#60]
+a0309fb0:	e51b3040 	ldr	r3, [fp, -#64]
+a0309fb4:	e1520003 	cmp	r2, r3
+a0309fb8:	8a000003 	bhi	a0309fcc <vsnprintf+0xb4>
+a0309fbc:	e51b303c 	ldr	r3, [fp, -#60]
+a0309fc0:	e51b2020 	ldr	r2, [fp, -#32]
+a0309fc4:	e5d22000 	ldrb	r2, [r2]
+a0309fc8:	e5c32000 	strb	r2, [r3]
+a0309fcc:	e51b303c 	ldr	r3, [fp, -#60]
+a0309fd0:	e2833001 	add	r3, r3, #1	; 0x1
+a0309fd4:	e50b303c 	str	r3, [fp, -#60]
+a0309fd8:	ea000285 	b	a030a9f4 <vsnprintf+0xadc>
+a0309fdc:	e3a03000 	mov	r3, #0	; 0x0
+a0309fe0:	e50b304c 	str	r3, [fp, -#76]
+a0309fe4:	e51b3020 	ldr	r3, [fp, -#32]
+a0309fe8:	e2833001 	add	r3, r3, #1	; 0x1
+a0309fec:	e50b3020 	str	r3, [fp, -#32]
+a0309ff0:	e51b3020 	ldr	r3, [fp, -#32]
+a0309ff4:	e5d33000 	ldrb	r3, [r3]
+a0309ff8:	e2433020 	sub	r3, r3, #32	; 0x20
+a0309ffc:	e3530010 	cmp	r3, #16	; 0x10
+a030a000:	979ff103 	ldrls	pc, [pc, r3, lsl #2]
+a030a004:	ea000024 	b	a030a09c <vsnprintf+0x184>
+a030a008:	a030a06c 	eorges	sl, r0, ip, rrx
+a030a00c:	a030a09c 	mlages	r0, ip, r0, sl
+a030a010:	a030a09c 	mlages	r0, ip, r0, sl
+a030a014:	a030a07c 	eorges	sl, r0, ip, ror r0
+a030a018:	a030a09c 	mlages	r0, ip, r0, sl
+a030a01c:	a030a09c 	mlages	r0, ip, r0, sl
+a030a020:	a030a09c 	mlages	r0, ip, r0, sl
+a030a024:	a030a09c 	mlages	r0, ip, r0, sl
+a030a028:	a030a09c 	mlages	r0, ip, r0, sl
+a030a02c:	a030a09c 	mlages	r0, ip, r0, sl
+a030a030:	a030a09c 	mlages	r0, ip, r0, sl
+a030a034:	a030a05c 	eorges	sl, r0, ip, asr r0
+a030a038:	a030a09c 	mlages	r0, ip, r0, sl
+a030a03c:	a030a04c 	eorges	sl, r0, ip, asr #32
+a030a040:	a030a09c 	mlages	r0, ip, r0, sl
+a030a044:	a030a09c 	mlages	r0, ip, r0, sl
+a030a048:	a030a08c 	eorges	sl, r0, ip, lsl #1
+a030a04c:	e51b304c 	ldr	r3, [fp, -#76]
+a030a050:	e3833010 	orr	r3, r3, #16	; 0x10
+a030a054:	e50b304c 	str	r3, [fp, -#76]
+a030a058:	eaffffe1 	b	a0309fe4 <vsnprintf+0xcc>
+a030a05c:	e51b304c 	ldr	r3, [fp, -#76]
+a030a060:	e3833004 	orr	r3, r3, #4	; 0x4
+a030a064:	e50b304c 	str	r3, [fp, -#76]
+a030a068:	eaffffdd 	b	a0309fe4 <vsnprintf+0xcc>
+a030a06c:	e51b304c 	ldr	r3, [fp, -#76]
+a030a070:	e3833008 	orr	r3, r3, #8	; 0x8
+a030a074:	e50b304c 	str	r3, [fp, -#76]
+a030a078:	eaffffd9 	b	a0309fe4 <vsnprintf+0xcc>
+a030a07c:	e51b304c 	ldr	r3, [fp, -#76]
+a030a080:	e3833020 	orr	r3, r3, #32	; 0x20
+a030a084:	e50b304c 	str	r3, [fp, -#76]
+a030a088:	eaffffd5 	b	a0309fe4 <vsnprintf+0xcc>
+a030a08c:	e51b304c 	ldr	r3, [fp, -#76]
+a030a090:	e3833001 	orr	r3, r3, #1	; 0x1
+a030a094:	e50b304c 	str	r3, [fp, -#76]
+a030a098:	eaffffd1 	b	a0309fe4 <vsnprintf+0xcc>
+a030a09c:	e3e03000 	mvn	r3, #0	; 0x0
+a030a0a0:	e50b3050 	str	r3, [fp, -#80]
+a030a0a4:	e51b3020 	ldr	r3, [fp, -#32]
+a030a0a8:	e5d33000 	ldrb	r3, [r3]
+a030a0ac:	e1a00003 	mov	r0, r3
+a030a0b0:	eb00028e 	bl	a030aaf0 <isdigit>
+a030a0b4:	e1a03000 	mov	r3, r0
+a030a0b8:	e3530000 	cmp	r3, #0	; 0x0
+a030a0bc:	0a000005 	beq	a030a0d8 <vsnprintf+0x1c0>
+a030a0c0:	e24b3020 	sub	r3, fp, #32	; 0x20
+a030a0c4:	e1a00003 	mov	r0, r3
+a030a0c8:	ebfffde1 	bl	a0309854 <skip_atoi>
+a030a0cc:	e1a03000 	mov	r3, r0
+a030a0d0:	e50b3050 	str	r3, [fp, -#80]
+a030a0d4:	ea000015 	b	a030a130 <vsnprintf+0x218>
+a030a0d8:	e51b3020 	ldr	r3, [fp, -#32]
+a030a0dc:	e5d33000 	ldrb	r3, [r3]
+a030a0e0:	e353002a 	cmp	r3, #42	; 0x2a
+a030a0e4:	1a000011 	bne	a030a130 <vsnprintf+0x218>
+a030a0e8:	e51b3020 	ldr	r3, [fp, -#32]
+a030a0ec:	e2833001 	add	r3, r3, #1	; 0x1
+a030a0f0:	e50b3020 	str	r3, [fp, -#32]
+a030a0f4:	e51b2024 	ldr	r2, [fp, -#36]
+a030a0f8:	e51b3024 	ldr	r3, [fp, -#36]
+a030a0fc:	e2833004 	add	r3, r3, #4	; 0x4
+a030a100:	e50b3024 	str	r3, [fp, -#36]
+a030a104:	e5923000 	ldr	r3, [r2]
+a030a108:	e50b3050 	str	r3, [fp, -#80]
+a030a10c:	e51b3050 	ldr	r3, [fp, -#80]
+a030a110:	e3530000 	cmp	r3, #0	; 0x0
+a030a114:	aa000005 	bge	a030a130 <vsnprintf+0x218>
+a030a118:	e51b3050 	ldr	r3, [fp, -#80]
+a030a11c:	e2633000 	rsb	r3, r3, #0	; 0x0
+a030a120:	e50b3050 	str	r3, [fp, -#80]
+a030a124:	e51b304c 	ldr	r3, [fp, -#76]
+a030a128:	e3833010 	orr	r3, r3, #16	; 0x10
+a030a12c:	e50b304c 	str	r3, [fp, -#76]
+a030a130:	e3e03000 	mvn	r3, #0	; 0x0
+a030a134:	e50b3054 	str	r3, [fp, -#84]
+a030a138:	e51b3020 	ldr	r3, [fp, -#32]
+a030a13c:	e5d33000 	ldrb	r3, [r3]
+a030a140:	e353002e 	cmp	r3, #46	; 0x2e
+a030a144:	1a000021 	bne	a030a1d0 <vsnprintf+0x2b8>
+a030a148:	e51b3020 	ldr	r3, [fp, -#32]
+a030a14c:	e2833001 	add	r3, r3, #1	; 0x1
+a030a150:	e50b3020 	str	r3, [fp, -#32]
+a030a154:	e51b3020 	ldr	r3, [fp, -#32]
+a030a158:	e5d33000 	ldrb	r3, [r3]
+a030a15c:	e1a00003 	mov	r0, r3
+a030a160:	eb000262 	bl	a030aaf0 <isdigit>
+a030a164:	e1a03000 	mov	r3, r0
+a030a168:	e3530000 	cmp	r3, #0	; 0x0
+a030a16c:	0a000005 	beq	a030a188 <vsnprintf+0x270>
+a030a170:	e24b3020 	sub	r3, fp, #32	; 0x20
+a030a174:	e1a00003 	mov	r0, r3
+a030a178:	ebfffdb5 	bl	a0309854 <skip_atoi>
+a030a17c:	e1a03000 	mov	r3, r0
+a030a180:	e50b3054 	str	r3, [fp, -#84]
+a030a184:	ea00000c 	b	a030a1bc <vsnprintf+0x2a4>
+a030a188:	e51b3020 	ldr	r3, [fp, -#32]
+a030a18c:	e5d33000 	ldrb	r3, [r3]
+a030a190:	e353002a 	cmp	r3, #42	; 0x2a
+a030a194:	1a000008 	bne	a030a1bc <vsnprintf+0x2a4>
+a030a198:	e51b3020 	ldr	r3, [fp, -#32]
+a030a19c:	e2833001 	add	r3, r3, #1	; 0x1
+a030a1a0:	e50b3020 	str	r3, [fp, -#32]
+a030a1a4:	e51b2024 	ldr	r2, [fp, -#36]
+a030a1a8:	e51b3024 	ldr	r3, [fp, -#36]
+a030a1ac:	e2833004 	add	r3, r3, #4	; 0x4
+a030a1b0:	e50b3024 	str	r3, [fp, -#36]
+a030a1b4:	e5923000 	ldr	r3, [r2]
+a030a1b8:	e50b3054 	str	r3, [fp, -#84]
+a030a1bc:	e51b3054 	ldr	r3, [fp, -#84]
+a030a1c0:	e3530000 	cmp	r3, #0	; 0x0
+a030a1c4:	aa000001 	bge	a030a1d0 <vsnprintf+0x2b8>
+a030a1c8:	e3a03000 	mov	r3, #0	; 0x0
+a030a1cc:	e50b3054 	str	r3, [fp, -#84]
+a030a1d0:	e3e03000 	mvn	r3, #0	; 0x0
+a030a1d4:	e50b3058 	str	r3, [fp, -#88]
+a030a1d8:	e51b3020 	ldr	r3, [fp, -#32]
+a030a1dc:	e5d33000 	ldrb	r3, [r3]
+a030a1e0:	e3530068 	cmp	r3, #104	; 0x68
+a030a1e4:	0a00000c 	beq	a030a21c <vsnprintf+0x304>
+a030a1e8:	e51b3020 	ldr	r3, [fp, -#32]
+a030a1ec:	e5d33000 	ldrb	r3, [r3]
+a030a1f0:	e353006c 	cmp	r3, #108	; 0x6c
+a030a1f4:	0a000008 	beq	a030a21c <vsnprintf+0x304>
+a030a1f8:	e51b3020 	ldr	r3, [fp, -#32]
+a030a1fc:	e5d33000 	ldrb	r3, [r3]
+a030a200:	e353004c 	cmp	r3, #76	; 0x4c
+a030a204:	0a000004 	beq	a030a21c <vsnprintf+0x304>
+a030a208:	e51b3020 	ldr	r3, [fp, -#32]
+a030a20c:	e5d33000 	ldrb	r3, [r3]
+a030a210:	e353005a 	cmp	r3, #90	; 0x5a
+a030a214:	0a000000 	beq	a030a21c <vsnprintf+0x304>
+a030a218:	ea000011 	b	a030a264 <vsnprintf+0x34c>
+a030a21c:	e51b3020 	ldr	r3, [fp, -#32]
+a030a220:	e5d33000 	ldrb	r3, [r3]
+a030a224:	e50b3058 	str	r3, [fp, -#88]
+a030a228:	e51b3020 	ldr	r3, [fp, -#32]
+a030a22c:	e2833001 	add	r3, r3, #1	; 0x1
+a030a230:	e50b3020 	str	r3, [fp, -#32]
+a030a234:	e51b3058 	ldr	r3, [fp, -#88]
+a030a238:	e353006c 	cmp	r3, #108	; 0x6c
+a030a23c:	1a000008 	bne	a030a264 <vsnprintf+0x34c>
+a030a240:	e51b3020 	ldr	r3, [fp, -#32]
+a030a244:	e5d33000 	ldrb	r3, [r3]
+a030a248:	e353006c 	cmp	r3, #108	; 0x6c
+a030a24c:	1a000004 	bne	a030a264 <vsnprintf+0x34c>
+a030a250:	e3a0304c 	mov	r3, #76	; 0x4c
+a030a254:	e50b3058 	str	r3, [fp, -#88]
+a030a258:	e51b3020 	ldr	r3, [fp, -#32]
+a030a25c:	e2833001 	add	r3, r3, #1	; 0x1
+a030a260:	e50b3020 	str	r3, [fp, -#32]
+a030a264:	e3a0300a 	mov	r3, #10	; 0xa
+a030a268:	e50b3038 	str	r3, [fp, -#56]
+a030a26c:	e51b3020 	ldr	r3, [fp, -#32]
+a030a270:	e5d33000 	ldrb	r3, [r3]
+a030a274:	e2433025 	sub	r3, r3, #37	; 0x25
+a030a278:	e3530053 	cmp	r3, #83	; 0x53
+a030a27c:	979ff103 	ldrls	pc, [pc, r3, lsl #2]
+a030a280:	ea000140 	b	a030a788 <vsnprintf+0x870>
+a030a284:	a030a728 	eorges	sl, r0, r8, lsr #14
+a030a288:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a28c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a290:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a294:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a298:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a29c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2a0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2a4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2a8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2ac:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2b0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2b4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2b8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2bc:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2c0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2c4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2c8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2cc:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2d0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2d4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2d8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2dc:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2e0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2e4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2e8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2ec:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2f0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2f4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2f8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a2fc:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a300:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a304:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a308:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a30c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a310:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a314:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a318:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a31c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a320:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a324:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a328:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a32c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a330:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a334:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a338:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a33c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a340:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a344:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a348:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a34c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a350:	a030a760 	eorges	sl, r0, r0, ror #14
+a030a354:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a358:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a35c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a360:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a364:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a368:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a36c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a370:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a374:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a378:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a37c:	a030a3d4 	ldrgesb	sl, [r0], -r4
+a030a380:	a030a778 	eorges	sl, r0, r8, ror r7
+a030a384:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a388:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a38c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a390:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a394:	a030a778 	eorges	sl, r0, r8, ror r7
+a030a398:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a39c:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3a0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3a4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3a8:	a030a680 	eorges	sl, r0, r0, lsl #13
+a030a3ac:	a030a754 	eorges	sl, r0, r4, asr r7
+a030a3b0:	a030a604 	eorges	sl, r0, r4, lsl #12
+a030a3b4:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3b8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3bc:	a030a4ac 	eorges	sl, r0, ip, lsr #9
+a030a3c0:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3c4:	a030a800 	eorges	sl, r0, r0, lsl #16
+a030a3c8:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3cc:	a030a788 	eorges	sl, r0, r8, lsl #15
+a030a3d0:	a030a76c 	eorges	sl, r0, ip, ror #14
+a030a3d4:	e51b304c 	ldr	r3, [fp, -#76]
+a030a3d8:	e2033010 	and	r3, r3, #16	; 0x10
+a030a3dc:	e3530000 	cmp	r3, #0	; 0x0
+a030a3e0:	1a000010 	bne	a030a428 <vsnprintf+0x510>
+a030a3e4:	e51b3050 	ldr	r3, [fp, -#80]
+a030a3e8:	e2433001 	sub	r3, r3, #1	; 0x1
+a030a3ec:	e50b3050 	str	r3, [fp, -#80]
+a030a3f0:	e3530000 	cmp	r3, #0	; 0x0
+a030a3f4:	ca000000 	bgt	a030a3fc <vsnprintf+0x4e4>
+a030a3f8:	ea00000a 	b	a030a428 <vsnprintf+0x510>
+a030a3fc:	e51b203c 	ldr	r2, [fp, -#60]
+a030a400:	e51b3040 	ldr	r3, [fp, -#64]
+a030a404:	e1520003 	cmp	r2, r3
+a030a408:	8a000002 	bhi	a030a418 <vsnprintf+0x500>
+a030a40c:	e51b303c 	ldr	r3, [fp, -#60]
+a030a410:	e3a02020 	mov	r2, #32	; 0x20
+a030a414:	e5c32000 	strb	r2, [r3]
+a030a418:	e51b303c 	ldr	r3, [fp, -#60]
+a030a41c:	e2833001 	add	r3, r3, #1	; 0x1
+a030a420:	e50b303c 	str	r3, [fp, -#60]
+a030a424:	eaffffee 	b	a030a3e4 <vsnprintf+0x4cc>
+a030a428:	e51b2024 	ldr	r2, [fp, -#36]
+a030a42c:	e51b3024 	ldr	r3, [fp, -#36]
+a030a430:	e2833004 	add	r3, r3, #4	; 0x4
+a030a434:	e50b3024 	str	r3, [fp, -#36]
+a030a438:	e5d23000 	ldrb	r3, [r2]
+a030a43c:	e54b3041 	strb	r3, [fp, -#65]
+a030a440:	e51b203c 	ldr	r2, [fp, -#60]
+a030a444:	e51b3040 	ldr	r3, [fp, -#64]
+a030a448:	e1520003 	cmp	r2, r3
+a030a44c:	8a000002 	bhi	a030a45c <vsnprintf+0x544>
+a030a450:	e51b203c 	ldr	r2, [fp, -#60]
+a030a454:	e55b3041 	ldrb	r3, [fp, -#65]
+a030a458:	e5c23000 	strb	r3, [r2]
+a030a45c:	e51b303c 	ldr	r3, [fp, -#60]
+a030a460:	e2833001 	add	r3, r3, #1	; 0x1
+a030a464:	e50b303c 	str	r3, [fp, -#60]
+a030a468:	e51b3050 	ldr	r3, [fp, -#80]
+a030a46c:	e2433001 	sub	r3, r3, #1	; 0x1
+a030a470:	e50b3050 	str	r3, [fp, -#80]
+a030a474:	e3530000 	cmp	r3, #0	; 0x0
+a030a478:	ca000000 	bgt	a030a480 <vsnprintf+0x568>
+a030a47c:	ea00015c 	b	a030a9f4 <vsnprintf+0xadc>
+a030a480:	e51b203c 	ldr	r2, [fp, -#60]
+a030a484:	e51b3040 	ldr	r3, [fp, -#64]
+a030a488:	e1520003 	cmp	r2, r3
+a030a48c:	8a000002 	bhi	a030a49c <vsnprintf+0x584>
+a030a490:	e51b303c 	ldr	r3, [fp, -#60]
+a030a494:	e3a02020 	mov	r2, #32	; 0x20
+a030a498:	e5c32000 	strb	r2, [r3]
+a030a49c:	e51b303c 	ldr	r3, [fp, -#60]
+a030a4a0:	e2833001 	add	r3, r3, #1	; 0x1
+a030a4a4:	e50b303c 	str	r3, [fp, -#60]
+a030a4a8:	eaffffee 	b	a030a468 <vsnprintf+0x550>
+a030a4ac:	e51b2024 	ldr	r2, [fp, -#36]
+a030a4b0:	e51b3024 	ldr	r3, [fp, -#36]
+a030a4b4:	e2833004 	add	r3, r3, #4	; 0x4
+a030a4b8:	e50b3024 	str	r3, [fp, -#36]
+a030a4bc:	e5923000 	ldr	r3, [r2]
+a030a4c0:	e50b3048 	str	r3, [fp, -#72]
+a030a4c4:	e51b3048 	ldr	r3, [fp, -#72]
+a030a4c8:	e3530000 	cmp	r3, #0	; 0x0
+a030a4cc:	1a000001 	bne	a030a4d8 <vsnprintf+0x5c0>
+a030a4d0:	e59f3578 	ldr	r3, [pc, #1400]	; a030aa50 <vsnprintf+0xb38>
+a030a4d4:	e50b3048 	str	r3, [fp, -#72]
+a030a4d8:	e51b0048 	ldr	r0, [fp, -#72]
+a030a4dc:	e51b1054 	ldr	r1, [fp, -#84]
+a030a4e0:	eb000195 	bl	a030ab3c <strnlen>
+a030a4e4:	e1a03000 	mov	r3, r0
+a030a4e8:	e50b3028 	str	r3, [fp, -#40]
+a030a4ec:	e51b304c 	ldr	r3, [fp, -#76]
+a030a4f0:	e2033010 	and	r3, r3, #16	; 0x10
+a030a4f4:	e3530000 	cmp	r3, #0	; 0x0
+a030a4f8:	1a000013 	bne	a030a54c <vsnprintf+0x634>
+a030a4fc:	e24b2050 	sub	r2, fp, #80	; 0x50
+a030a500:	e5923000 	ldr	r3, [r2]
+a030a504:	e1a01003 	mov	r1, r3
+a030a508:	e2433001 	sub	r3, r3, #1	; 0x1
+a030a50c:	e5823000 	str	r3, [r2]
+a030a510:	e51b3028 	ldr	r3, [fp, -#40]
+a030a514:	e1510003 	cmp	r1, r3
+a030a518:	ca000000 	bgt	a030a520 <vsnprintf+0x608>
+a030a51c:	ea00000a 	b	a030a54c <vsnprintf+0x634>
+a030a520:	e51b203c 	ldr	r2, [fp, -#60]
+a030a524:	e51b3040 	ldr	r3, [fp, -#64]
+a030a528:	e1520003 	cmp	r2, r3
+a030a52c:	8a000002 	bhi	a030a53c <vsnprintf+0x624>
+a030a530:	e51b303c 	ldr	r3, [fp, -#60]
+a030a534:	e3a02020 	mov	r2, #32	; 0x20
+a030a538:	e5c32000 	strb	r2, [r3]
+a030a53c:	e51b303c 	ldr	r3, [fp, -#60]
+a030a540:	e2833001 	add	r3, r3, #1	; 0x1
+a030a544:	e50b303c 	str	r3, [fp, -#60]
+a030a548:	eaffffeb 	b	a030a4fc <vsnprintf+0x5e4>
+a030a54c:	e3a03000 	mov	r3, #0	; 0x0
+a030a550:	e50b3034 	str	r3, [fp, -#52]
+a030a554:	e51b2034 	ldr	r2, [fp, -#52]
+a030a558:	e51b3028 	ldr	r3, [fp, -#40]
+a030a55c:	e1520003 	cmp	r2, r3
+a030a560:	ba000000 	blt	a030a568 <vsnprintf+0x650>
+a030a564:	ea000011 	b	a030a5b0 <vsnprintf+0x698>
+a030a568:	e51b203c 	ldr	r2, [fp, -#60]
+a030a56c:	e51b3040 	ldr	r3, [fp, -#64]
+a030a570:	e1520003 	cmp	r2, r3
+a030a574:	8a000003 	bhi	a030a588 <vsnprintf+0x670>
+a030a578:	e51b303c 	ldr	r3, [fp, -#60]
+a030a57c:	e51b2048 	ldr	r2, [fp, -#72]
+a030a580:	e5d22000 	ldrb	r2, [r2]
+a030a584:	e5c32000 	strb	r2, [r3]
+a030a588:	e51b303c 	ldr	r3, [fp, -#60]
+a030a58c:	e2833001 	add	r3, r3, #1	; 0x1
+a030a590:	e50b303c 	str	r3, [fp, -#60]
+a030a594:	e51b3048 	ldr	r3, [fp, -#72]
+a030a598:	e2833001 	add	r3, r3, #1	; 0x1
+a030a59c:	e50b3048 	str	r3, [fp, -#72]
+a030a5a0:	e51b3034 	ldr	r3, [fp, -#52]
+a030a5a4:	e2833001 	add	r3, r3, #1	; 0x1
+a030a5a8:	e50b3034 	str	r3, [fp, -#52]
+a030a5ac:	eaffffe8 	b	a030a554 <vsnprintf+0x63c>
+a030a5b0:	e1a00000 	nop			(mov r0,r0)
+a030a5b4:	e24b2050 	sub	r2, fp, #80	; 0x50
+a030a5b8:	e5923000 	ldr	r3, [r2]
+a030a5bc:	e1a01003 	mov	r1, r3
+a030a5c0:	e2433001 	sub	r3, r3, #1	; 0x1
+a030a5c4:	e5823000 	str	r3, [r2]
+a030a5c8:	e51b3028 	ldr	r3, [fp, -#40]
+a030a5cc:	e1510003 	cmp	r1, r3
+a030a5d0:	ca000000 	bgt	a030a5d8 <vsnprintf+0x6c0>
+a030a5d4:	ea000106 	b	a030a9f4 <vsnprintf+0xadc>
+a030a5d8:	e51b203c 	ldr	r2, [fp, -#60]
+a030a5dc:	e51b3040 	ldr	r3, [fp, -#64]
+a030a5e0:	e1520003 	cmp	r2, r3
+a030a5e4:	8a000002 	bhi	a030a5f4 <vsnprintf+0x6dc>
+a030a5e8:	e51b303c 	ldr	r3, [fp, -#60]
+a030a5ec:	e3a02020 	mov	r2, #32	; 0x20
+a030a5f0:	e5c32000 	strb	r2, [r3]
+a030a5f4:	e51b303c 	ldr	r3, [fp, -#60]
+a030a5f8:	e2833001 	add	r3, r3, #1	; 0x1
+a030a5fc:	e50b303c 	str	r3, [fp, -#60]
+a030a600:	eaffffeb 	b	a030a5b4 <vsnprintf+0x69c>
+a030a604:	e51b3050 	ldr	r3, [fp, -#80]
+a030a608:	e3730001 	cmn	r3, #1	; 0x1
+a030a60c:	1a000004 	bne	a030a624 <vsnprintf+0x70c>
+a030a610:	e3a03008 	mov	r3, #8	; 0x8
+a030a614:	e50b3050 	str	r3, [fp, -#80]
+a030a618:	e51b304c 	ldr	r3, [fp, -#76]
+a030a61c:	e3833001 	orr	r3, r3, #1	; 0x1
+a030a620:	e50b304c 	str	r3, [fp, -#76]
+a030a624:	e51b2024 	ldr	r2, [fp, -#36]
+a030a628:	e51b3024 	ldr	r3, [fp, -#36]
+a030a62c:	e2833004 	add	r3, r3, #4	; 0x4
+a030a630:	e50b3024 	str	r3, [fp, -#36]
+a030a634:	e5923000 	ldr	r3, [r2]
+a030a638:	e1a04003 	mov	r4, r3
+a030a63c:	e3a05000 	mov	r5, #0	; 0x0
+a030a640:	e3a03010 	mov	r3, #16	; 0x10
+a030a644:	e58d3000 	str	r3, [sp]
+a030a648:	e51b3050 	ldr	r3, [fp, -#80]
+a030a64c:	e58d3004 	str	r3, [sp, #4]
+a030a650:	e51b3054 	ldr	r3, [fp, -#84]
+a030a654:	e58d3008 	str	r3, [sp, #8]
+a030a658:	e51b304c 	ldr	r3, [fp, -#76]
+a030a65c:	e58d300c 	str	r3, [sp, #12]
+a030a660:	e51b003c 	ldr	r0, [fp, -#60]
+a030a664:	e51b1040 	ldr	r1, [fp, -#64]
+a030a668:	e1a03005 	mov	r3, r5
+a030a66c:	e1a02004 	mov	r2, r4
+a030a670:	ebfffc99 	bl	a03098dc <number>
+a030a674:	e1a03000 	mov	r3, r0
+a030a678:	e50b303c 	str	r3, [fp, -#60]
+a030a67c:	ea0000dc 	b	a030a9f4 <vsnprintf+0xadc>
+a030a680:	e51b3058 	ldr	r3, [fp, -#88]
+a030a684:	e353006c 	cmp	r3, #108	; 0x6c
+a030a688:	1a00000b 	bne	a030a6bc <vsnprintf+0x7a4>
+a030a68c:	e51b2024 	ldr	r2, [fp, -#36]
+a030a690:	e51b3024 	ldr	r3, [fp, -#36]
+a030a694:	e2833004 	add	r3, r3, #4	; 0x4
+a030a698:	e50b3024 	str	r3, [fp, -#36]
+a030a69c:	e5923000 	ldr	r3, [r2]
+a030a6a0:	e50b305c 	str	r3, [fp, -#92]
+a030a6a4:	e51b105c 	ldr	r1, [fp, -#92]
+a030a6a8:	e51b203c 	ldr	r2, [fp, -#60]
+a030a6ac:	e51b3018 	ldr	r3, [fp, -#24]
+a030a6b0:	e0633002 	rsb	r3, r3, r2
+a030a6b4:	e5813000 	str	r3, [r1]
+a030a6b8:	ea0000cd 	b	a030a9f4 <vsnprintf+0xadc>
+a030a6bc:	e51b3058 	ldr	r3, [fp, -#88]
+a030a6c0:	e353005a 	cmp	r3, #90	; 0x5a
+a030a6c4:	1a00000b 	bne	a030a6f8 <vsnprintf+0x7e0>
+a030a6c8:	e51b2024 	ldr	r2, [fp, -#36]
+a030a6cc:	e51b3024 	ldr	r3, [fp, -#36]
+a030a6d0:	e2833004 	add	r3, r3, #4	; 0x4
+a030a6d4:	e50b3024 	str	r3, [fp, -#36]
+a030a6d8:	e5923000 	ldr	r3, [r2]
+a030a6dc:	e50b305c 	str	r3, [fp, -#92]
+a030a6e0:	e51b105c 	ldr	r1, [fp, -#92]
+a030a6e4:	e51b203c 	ldr	r2, [fp, -#60]
+a030a6e8:	e51b3018 	ldr	r3, [fp, -#24]
+a030a6ec:	e0633002 	rsb	r3, r3, r2
+a030a6f0:	e5813000 	str	r3, [r1]
+a030a6f4:	ea0000be 	b	a030a9f4 <vsnprintf+0xadc>
+a030a6f8:	e51b2024 	ldr	r2, [fp, -#36]
+a030a6fc:	e51b3024 	ldr	r3, [fp, -#36]
+a030a700:	e2833004 	add	r3, r3, #4	; 0x4
+a030a704:	e50b3024 	str	r3, [fp, -#36]
+a030a708:	e5923000 	ldr	r3, [r2]
+a030a70c:	e50b305c 	str	r3, [fp, -#92]
+a030a710:	e51b105c 	ldr	r1, [fp, -#92]
+a030a714:	e51b203c 	ldr	r2, [fp, -#60]
+a030a718:	e51b3018 	ldr	r3, [fp, -#24]
+a030a71c:	e0633002 	rsb	r3, r3, r2
+a030a720:	e5813000 	str	r3, [r1]
+a030a724:	ea0000b2 	b	a030a9f4 <vsnprintf+0xadc>
+a030a728:	e51b203c 	ldr	r2, [fp, -#60]
+a030a72c:	e51b3040 	ldr	r3, [fp, -#64]
+a030a730:	e1520003 	cmp	r2, r3
+a030a734:	8a000002 	bhi	a030a744 <vsnprintf+0x82c>
+a030a738:	e51b303c 	ldr	r3, [fp, -#60]
+a030a73c:	e3a02025 	mov	r2, #37	; 0x25
+a030a740:	e5c32000 	strb	r2, [r3]
+a030a744:	e51b303c 	ldr	r3, [fp, -#60]
+a030a748:	e2833001 	add	r3, r3, #1	; 0x1
+a030a74c:	e50b303c 	str	r3, [fp, -#60]
+a030a750:	ea0000a7 	b	a030a9f4 <vsnprintf+0xadc>
+a030a754:	e3a03008 	mov	r3, #8	; 0x8
+a030a758:	e50b3038 	str	r3, [fp, -#56]
+a030a75c:	ea000027 	b	a030a800 <vsnprintf+0x8e8>
+a030a760:	e51b304c 	ldr	r3, [fp, -#76]
+a030a764:	e3833040 	orr	r3, r3, #64	; 0x40
+a030a768:	e50b304c 	str	r3, [fp, -#76]
+a030a76c:	e3a03010 	mov	r3, #16	; 0x10
+a030a770:	e50b3038 	str	r3, [fp, -#56]
+a030a774:	ea000021 	b	a030a800 <vsnprintf+0x8e8>
+a030a778:	e51b304c 	ldr	r3, [fp, -#76]
+a030a77c:	e3833002 	orr	r3, r3, #2	; 0x2
+a030a780:	e50b304c 	str	r3, [fp, -#76]
+a030a784:	ea00001d 	b	a030a800 <vsnprintf+0x8e8>
+a030a788:	e51b203c 	ldr	r2, [fp, -#60]
+a030a78c:	e51b3040 	ldr	r3, [fp, -#64]
+a030a790:	e1520003 	cmp	r2, r3
+a030a794:	8a000002 	bhi	a030a7a4 <vsnprintf+0x88c>
+a030a798:	e51b303c 	ldr	r3, [fp, -#60]
+a030a79c:	e3a02025 	mov	r2, #37	; 0x25
+a030a7a0:	e5c32000 	strb	r2, [r3]
+a030a7a4:	e51b303c 	ldr	r3, [fp, -#60]
+a030a7a8:	e2833001 	add	r3, r3, #1	; 0x1
+a030a7ac:	e50b303c 	str	r3, [fp, -#60]
+a030a7b0:	e51b3020 	ldr	r3, [fp, -#32]
+a030a7b4:	e5d33000 	ldrb	r3, [r3]
+a030a7b8:	e3530000 	cmp	r3, #0	; 0x0
+a030a7bc:	0a00000b 	beq	a030a7f0 <vsnprintf+0x8d8>
+a030a7c0:	e51b203c 	ldr	r2, [fp, -#60]
+a030a7c4:	e51b3040 	ldr	r3, [fp, -#64]
+a030a7c8:	e1520003 	cmp	r2, r3
+a030a7cc:	8a000003 	bhi	a030a7e0 <vsnprintf+0x8c8>
+a030a7d0:	e51b303c 	ldr	r3, [fp, -#60]
+a030a7d4:	e51b2020 	ldr	r2, [fp, -#32]
+a030a7d8:	e5d22000 	ldrb	r2, [r2]
+a030a7dc:	e5c32000 	strb	r2, [r3]
+a030a7e0:	e51b303c 	ldr	r3, [fp, -#60]
+a030a7e4:	e2833001 	add	r3, r3, #1	; 0x1
+a030a7e8:	e50b303c 	str	r3, [fp, -#60]
+a030a7ec:	ea000080 	b	a030a9f4 <vsnprintf+0xadc>
+a030a7f0:	e51b3020 	ldr	r3, [fp, -#32]
+a030a7f4:	e2433001 	sub	r3, r3, #1	; 0x1
+a030a7f8:	e50b3020 	str	r3, [fp, -#32]
+a030a7fc:	ea00007c 	b	a030a9f4 <vsnprintf+0xadc>
+a030a800:	e51b3058 	ldr	r3, [fp, -#88]
+a030a804:	e353004c 	cmp	r3, #76	; 0x4c
+a030a808:	1a000009 	bne	a030a834 <vsnprintf+0x91c>
+a030a80c:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a810:	e24b2014 	sub	r2, fp, #20	; 0x14
+a030a814:	e0821003 	add	r1, r2, r3
+a030a818:	e51b2024 	ldr	r2, [fp, -#36]
+a030a81c:	e51b3024 	ldr	r3, [fp, -#36]
+a030a820:	e2833008 	add	r3, r3, #8	; 0x8
+a030a824:	e50b3024 	str	r3, [fp, -#36]
+a030a828:	e8920018 	ldmia	r2, {r3, r4}
+a030a82c:	e8810018 	stmia	r1, {r3, r4}
+a030a830:	ea00005e 	b	a030a9b0 <vsnprintf+0xa98>
+a030a834:	e51b3058 	ldr	r3, [fp, -#88]
+a030a838:	e353006c 	cmp	r3, #108	; 0x6c
+a030a83c:	1a000017 	bne	a030a8a0 <vsnprintf+0x988>
+a030a840:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a844:	e24b4014 	sub	r4, fp, #20	; 0x14
+a030a848:	e0841003 	add	r1, r4, r3
+a030a84c:	e51b2024 	ldr	r2, [fp, -#36]
+a030a850:	e51b3024 	ldr	r3, [fp, -#36]
+a030a854:	e2833004 	add	r3, r3, #4	; 0x4
+a030a858:	e50b3024 	str	r3, [fp, -#36]
+a030a85c:	e5923000 	ldr	r3, [r2]
+a030a860:	e3a04000 	mov	r4, #0	; 0x0
+a030a864:	e8810018 	stmia	r1, {r3, r4}
+a030a868:	e51b304c 	ldr	r3, [fp, -#76]
+a030a86c:	e2033002 	and	r3, r3, #2	; 0x2
+a030a870:	e3530000 	cmp	r3, #0	; 0x0
+a030a874:	0a00004d 	beq	a030a9b0 <vsnprintf+0xa98>
+a030a878:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a87c:	e24b1014 	sub	r1, fp, #20	; 0x14
+a030a880:	e0812003 	add	r2, r1, r3
+a030a884:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a888:	e24b4014 	sub	r4, fp, #20	; 0x14
+a030a88c:	e0843003 	add	r3, r4, r3
+a030a890:	e5933000 	ldr	r3, [r3]
+a030a894:	e1a04fc3 	mov	r4, r3, asr #31
+a030a898:	e8820018 	stmia	r2, {r3, r4}
+a030a89c:	ea000043 	b	a030a9b0 <vsnprintf+0xa98>
+a030a8a0:	e51b3058 	ldr	r3, [fp, -#88]
+a030a8a4:	e353005a 	cmp	r3, #90	; 0x5a
+a030a8a8:	1a00000a 	bne	a030a8d8 <vsnprintf+0x9c0>
+a030a8ac:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a8b0:	e24b2014 	sub	r2, fp, #20	; 0x14
+a030a8b4:	e0821003 	add	r1, r2, r3
+a030a8b8:	e51b2024 	ldr	r2, [fp, -#36]
+a030a8bc:	e51b3024 	ldr	r3, [fp, -#36]
+a030a8c0:	e2833004 	add	r3, r3, #4	; 0x4
+a030a8c4:	e50b3024 	str	r3, [fp, -#36]
+a030a8c8:	e5923000 	ldr	r3, [r2]
+a030a8cc:	e3a04000 	mov	r4, #0	; 0x0
+a030a8d0:	e8810018 	stmia	r1, {r3, r4}
+a030a8d4:	ea000035 	b	a030a9b0 <vsnprintf+0xa98>
+a030a8d8:	e51b3058 	ldr	r3, [fp, -#88]
+a030a8dc:	e3530068 	cmp	r3, #104	; 0x68
+a030a8e0:	1a00001b 	bne	a030a954 <vsnprintf+0xa3c>
+a030a8e4:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a8e8:	e24b4014 	sub	r4, fp, #20	; 0x14
+a030a8ec:	e0842003 	add	r2, r4, r3
+a030a8f0:	e51b1024 	ldr	r1, [fp, -#36]
+a030a8f4:	e51b3024 	ldr	r3, [fp, -#36]
+a030a8f8:	e2833004 	add	r3, r3, #4	; 0x4
+a030a8fc:	e50b3024 	str	r3, [fp, -#36]
+a030a900:	e1d130b0 	ldrh	r3, [r1]
+a030a904:	e5823000 	str	r3, [r2]
+a030a908:	e5923000 	ldr	r3, [r2]
+a030a90c:	e3a04000 	mov	r4, #0	; 0x0
+a030a910:	e8820018 	stmia	r2, {r3, r4}
+a030a914:	e51b304c 	ldr	r3, [fp, -#76]
+a030a918:	e2033002 	and	r3, r3, #2	; 0x2
+a030a91c:	e3530000 	cmp	r3, #0	; 0x0
+a030a920:	0a000022 	beq	a030a9b0 <vsnprintf+0xa98>
+a030a924:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a928:	e24b1014 	sub	r1, fp, #20	; 0x14
+a030a92c:	e0812003 	add	r2, r1, r3
+a030a930:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a934:	e24b4014 	sub	r4, fp, #20	; 0x14
+a030a938:	e0843003 	add	r3, r4, r3
+a030a93c:	e1d330f0 	ldrsh	r3, [r3]
+a030a940:	e5823000 	str	r3, [r2]
+a030a944:	e5923000 	ldr	r3, [r2]
+a030a948:	e1a04fc3 	mov	r4, r3, asr #31
+a030a94c:	e8820018 	stmia	r2, {r3, r4}
+a030a950:	ea000016 	b	a030a9b0 <vsnprintf+0xa98>
+a030a954:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a958:	e24b2014 	sub	r2, fp, #20	; 0x14
+a030a95c:	e0821003 	add	r1, r2, r3
+a030a960:	e51b2024 	ldr	r2, [fp, -#36]
+a030a964:	e51b3024 	ldr	r3, [fp, -#36]
+a030a968:	e2833004 	add	r3, r3, #4	; 0x4
+a030a96c:	e50b3024 	str	r3, [fp, -#36]
+a030a970:	e5923000 	ldr	r3, [r2]
+a030a974:	e3a04000 	mov	r4, #0	; 0x0
+a030a978:	e8810018 	stmia	r1, {r3, r4}
+a030a97c:	e51b304c 	ldr	r3, [fp, -#76]
+a030a980:	e2033002 	and	r3, r3, #2	; 0x2
+a030a984:	e3530000 	cmp	r3, #0	; 0x0
+a030a988:	0a000008 	beq	a030a9b0 <vsnprintf+0xa98>
+a030a98c:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a990:	e24b4014 	sub	r4, fp, #20	; 0x14
+a030a994:	e0842003 	add	r2, r4, r3
+a030a998:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a99c:	e24b1014 	sub	r1, fp, #20	; 0x14
+a030a9a0:	e0813003 	add	r3, r1, r3
+a030a9a4:	e5933000 	ldr	r3, [r3]
+a030a9a8:	e1a04fc3 	mov	r4, r3, asr #31
+a030a9ac:	e8820018 	stmia	r2, {r3, r4}
+a030a9b0:	e3e0301b 	mvn	r3, #27	; 0x1b
+a030a9b4:	e24b4014 	sub	r4, fp, #20	; 0x14
+a030a9b8:	e0842003 	add	r2, r4, r3
+a030a9bc:	e51b3038 	ldr	r3, [fp, -#56]
+a030a9c0:	e58d3000 	str	r3, [sp]
+a030a9c4:	e51b3050 	ldr	r3, [fp, -#80]
+a030a9c8:	e58d3004 	str	r3, [sp, #4]
+a030a9cc:	e51b3054 	ldr	r3, [fp, -#84]
+a030a9d0:	e58d3008 	str	r3, [sp, #8]
+a030a9d4:	e51b304c 	ldr	r3, [fp, -#76]
+a030a9d8:	e58d300c 	str	r3, [sp, #12]
+a030a9dc:	e51b003c 	ldr	r0, [fp, -#60]
+a030a9e0:	e51b1040 	ldr	r1, [fp, -#64]
+a030a9e4:	e892000c 	ldmia	r2, {r2, r3}
+a030a9e8:	ebfffbbb 	bl	a03098dc <number>
+a030a9ec:	e1a03000 	mov	r3, r0
+a030a9f0:	e50b303c 	str	r3, [fp, -#60]
+a030a9f4:	e51b3020 	ldr	r3, [fp, -#32]
+a030a9f8:	e2833001 	add	r3, r3, #1	; 0x1
+a030a9fc:	e50b3020 	str	r3, [fp, -#32]
+a030aa00:	eafffd60 	b	a0309f88 <vsnprintf+0x70>
+a030aa04:	e51b203c 	ldr	r2, [fp, -#60]
+a030aa08:	e51b3040 	ldr	r3, [fp, -#64]
+a030aa0c:	e1520003 	cmp	r2, r3
+a030aa10:	8a000003 	bhi	a030aa24 <vsnprintf+0xb0c>
+a030aa14:	e51b303c 	ldr	r3, [fp, -#60]
+a030aa18:	e3a02000 	mov	r2, #0	; 0x0
+a030aa1c:	e5c32000 	strb	r2, [r3]
+a030aa20:	ea000005 	b	a030aa3c <vsnprintf+0xb24>
+a030aa24:	e51b301c 	ldr	r3, [fp, -#28]
+a030aa28:	e3530000 	cmp	r3, #0	; 0x0
+a030aa2c:	0a000002 	beq	a030aa3c <vsnprintf+0xb24>
+a030aa30:	e51b3040 	ldr	r3, [fp, -#64]
+a030aa34:	e3a02000 	mov	r2, #0	; 0x0
+a030aa38:	e5c32000 	strb	r2, [r3]
+a030aa3c:	e51b203c 	ldr	r2, [fp, -#60]
+a030aa40:	e51b3018 	ldr	r3, [fp, -#24]
+a030aa44:	e0633002 	rsb	r3, r3, r2
+a030aa48:	e1a00003 	mov	r0, r3
+a030aa4c:	e91ba830 	ldmdb	fp, {r4, r5, fp, sp, pc}
+a030aa50:	a030d480 	eorges	sp, r0, r0, lsl #9
+
+a030aa54 <snprintf>:
+a030aa54:	e1a0c00d 	mov	ip, sp
+a030aa58:	e92d000c 	stmdb	sp!, {r2, r3}
+a030aa5c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030aa60:	e24cb00c 	sub	fp, ip, #12	; 0xc
+a030aa64:	e24dd010 	sub	sp, sp, #16	; 0x10
+a030aa68:	e50b0010 	str	r0, [fp, -#16]
+a030aa6c:	e50b1014 	str	r1, [fp, -#20]
+a030aa70:	e28b3008 	add	r3, fp, #8	; 0x8
+a030aa74:	e50b3018 	str	r3, [fp, -#24]
+a030aa78:	e51b0010 	ldr	r0, [fp, -#16]
+a030aa7c:	e51b1014 	ldr	r1, [fp, -#20]
+a030aa80:	e59b2004 	ldr	r2, [fp, #4]
+a030aa84:	e51b3018 	ldr	r3, [fp, -#24]
+a030aa88:	ebfffd22 	bl	a0309f18 <vsnprintf>
+a030aa8c:	e1a03000 	mov	r3, r0
+a030aa90:	e50b301c 	str	r3, [fp, -#28]
+a030aa94:	e51b301c 	ldr	r3, [fp, -#28]
+a030aa98:	e1a00003 	mov	r0, r3
+a030aa9c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030aaa0 <printf>:
+a030aaa0:	e1a0c00d 	mov	ip, sp
+a030aaa4:	e92d000f 	stmdb	sp!, {r0, r1, r2, r3}
+a030aaa8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030aaac:	e24cb014 	sub	fp, ip, #20	; 0x14
+a030aab0:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030aab4:	e28b3008 	add	r3, fp, #8	; 0x8
+a030aab8:	e50b3010 	str	r3, [fp, -#16]
+a030aabc:	e59f0028 	ldr	r0, [pc, #40]	; a030aaec <printf+0x4c>
+a030aac0:	e3a01b01 	mov	r1, #1024	; 0x400
+a030aac4:	e59b2004 	ldr	r2, [fp, #4]
+a030aac8:	e51b3010 	ldr	r3, [fp, -#16]
+a030aacc:	ebfffd11 	bl	a0309f18 <vsnprintf>
+a030aad0:	e1a03000 	mov	r3, r0
+a030aad4:	e50b3014 	str	r3, [fp, -#20]
+a030aad8:	e59f000c 	ldr	r0, [pc, #12]	; a030aaec <printf+0x4c>
+a030aadc:	eb0000a4 	bl	a030ad74 <SerialOutputString>
+a030aae0:	e51b3014 	ldr	r3, [fp, -#20]
+a030aae4:	e1a00003 	mov	r0, r3
+a030aae8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030aaec:	a030f8c4 	eorges	pc, r0, r4, asr #17
+
+a030aaf0 <isdigit>:
+a030aaf0:	e1a0c00d 	mov	ip, sp
+a030aaf4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030aaf8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030aafc:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030ab00:	e1a03000 	mov	r3, r0
+a030ab04:	e54b300d 	strb	r3, [fp, -#13]
+a030ab08:	e55b300d 	ldrb	r3, [fp, -#13]
+a030ab0c:	e353002f 	cmp	r3, #47	; 0x2f
+a030ab10:	9a000005 	bls	a030ab2c <isdigit+0x3c>
+a030ab14:	e55b300d 	ldrb	r3, [fp, -#13]
+a030ab18:	e3530039 	cmp	r3, #57	; 0x39
+a030ab1c:	8a000002 	bhi	a030ab2c <isdigit+0x3c>
+a030ab20:	e3a03001 	mov	r3, #1	; 0x1
+a030ab24:	e50b3014 	str	r3, [fp, -#20]
+a030ab28:	ea000001 	b	a030ab34 <isdigit+0x44>
+a030ab2c:	e3a03000 	mov	r3, #0	; 0x0
+a030ab30:	e50b3014 	str	r3, [fp, -#20]
+a030ab34:	e51b0014 	ldr	r0, [fp, -#20]
+a030ab38:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030ab3c <strnlen>:
+a030ab3c:	e1a0c00d 	mov	ip, sp
+a030ab40:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ab44:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ab48:	e24dd010 	sub	sp, sp, #16	; 0x10
+a030ab4c:	e50b0010 	str	r0, [fp, -#16]
+a030ab50:	e50b1014 	str	r1, [fp, -#20]
+a030ab54:	e51b0010 	ldr	r0, [fp, -#16]
+a030ab58:	eb0001d0 	bl	a030b2a0 <strlen>
+a030ab5c:	e1a03000 	mov	r3, r0
+a030ab60:	e50b3018 	str	r3, [fp, -#24]
+a030ab64:	e51b2018 	ldr	r2, [fp, -#24]
+a030ab68:	e51b3014 	ldr	r3, [fp, -#20]
+a030ab6c:	e1520003 	cmp	r2, r3
+a030ab70:	9a000002 	bls	a030ab80 <strnlen+0x44>
+a030ab74:	e51b3014 	ldr	r3, [fp, -#20]
+a030ab78:	e50b301c 	str	r3, [fp, -#28]
+a030ab7c:	ea000001 	b	a030ab88 <strnlen+0x4c>
+a030ab80:	e51b3018 	ldr	r3, [fp, -#24]
+a030ab84:	e50b301c 	str	r3, [fp, -#28]
+a030ab88:	e51b001c 	ldr	r0, [fp, -#28]
+a030ab8c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030ab90 <reboot_system>:
+a030ab90:	e1a0c00d 	mov	ip, sp
+a030ab94:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ab98:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ab9c:	e59f3024 	ldr	r3, [pc, #36]	; a030abc8 <reboot_system+0x38>
+a030aba0:	e5933000 	ldr	r3, [r3]
+a030aba4:	e3530000 	cmp	r3, #0	; 0x0
+a030aba8:	1a000000 	bne	a030abb0 <reboot_system+0x20>
+a030abac:	ea000004 	b	a030abc4 <reboot_system+0x34>
+a030abb0:	e59f3010 	ldr	r3, [pc, #16]	; a030abc8 <reboot_system+0x38>
+a030abb4:	e5933000 	ldr	r3, [r3]
+a030abb8:	e5933000 	ldr	r3, [r3]
+a030abbc:	e1a0e00f 	mov	lr, pc
+a030abc0:	e1a0f003 	mov	pc, r3
+a030abc4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030abc8:	a03103a0 	eorges	r0, r1, r0, lsr #7
+
+a030abcc <serial_init>:
+a030abcc:	e1a0c00d 	mov	ip, sp
+a030abd0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030abd4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030abd8:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030abdc:	e50b0010 	str	r0, [fp, -#16]
+a030abe0:	e59f301c 	ldr	r3, [pc, #28]	; a030ac04 <serial_init+0x38>
+a030abe4:	e5933000 	ldr	r3, [r3]
+a030abe8:	e5933000 	ldr	r3, [r3]
+a030abec:	e51b0010 	ldr	r0, [fp, -#16]
+a030abf0:	e1a0e00f 	mov	lr, pc
+a030abf4:	e1a0f003 	mov	pc, r3
+a030abf8:	e1a03000 	mov	r3, r0
+a030abfc:	e1a00003 	mov	r0, r3
+a030ac00:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030ac04:	a03103c0 	eorges	r0, r1, r0, asr #7
+
+a030ac08 <serial_read>:
+a030ac08:	e1a0c00d 	mov	ip, sp
+a030ac0c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ac10:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ac14:	e59f3018 	ldr	r3, [pc, #24]	; a030ac34 <serial_read+0x2c>
+a030ac18:	e5933000 	ldr	r3, [r3]
+a030ac1c:	e5933004 	ldr	r3, [r3, #4]
+a030ac20:	e1a0e00f 	mov	lr, pc
+a030ac24:	e1a0f003 	mov	pc, r3
+a030ac28:	e1a03000 	mov	r3, r0
+a030ac2c:	e1a00003 	mov	r0, r3
+a030ac30:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030ac34:	a03103c0 	eorges	r0, r1, r0, asr #7
+
+a030ac38 <serial_write>:
+a030ac38:	e1a0c00d 	mov	ip, sp
+a030ac3c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ac40:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ac44:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030ac48:	e50b0010 	str	r0, [fp, -#16]
+a030ac4c:	e59f3050 	ldr	r3, [pc, #80]	; a030aca4 <serial_write+0x6c>
+a030ac50:	e5933000 	ldr	r3, [r3]
+a030ac54:	e5933008 	ldr	r3, [r3, #8]
+a030ac58:	e51b0010 	ldr	r0, [fp, -#16]
+a030ac5c:	e1a0e00f 	mov	lr, pc
+a030ac60:	e1a0f003 	mov	pc, r3
+a030ac64:	e1a03000 	mov	r3, r0
+a030ac68:	e50b3014 	str	r3, [fp, -#20]
+a030ac6c:	e51b3010 	ldr	r3, [fp, -#16]
+a030ac70:	e353000a 	cmp	r3, #10	; 0xa
+a030ac74:	1a000007 	bne	a030ac98 <serial_write+0x60>
+a030ac78:	e59f3024 	ldr	r3, [pc, #36]	; a030aca4 <serial_write+0x6c>
+a030ac7c:	e5933000 	ldr	r3, [r3]
+a030ac80:	e5933008 	ldr	r3, [r3, #8]
+a030ac84:	e3a0000d 	mov	r0, #13	; 0xd
+a030ac88:	e1a0e00f 	mov	lr, pc
+a030ac8c:	e1a0f003 	mov	pc, r3
+a030ac90:	e1a03000 	mov	r3, r0
+a030ac94:	e50b3014 	str	r3, [fp, -#20]
+a030ac98:	e51b3014 	ldr	r3, [fp, -#20]
+a030ac9c:	e1a00003 	mov	r0, r3
+a030aca0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030aca4:	a03103c0 	eorges	r0, r1, r0, asr #7
+
+a030aca8 <serial_write_raw>:
+a030aca8:	e1a0c00d 	mov	ip, sp
+a030acac:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030acb0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030acb4:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030acb8:	e50b0010 	str	r0, [fp, -#16]
+a030acbc:	e59f301c 	ldr	r3, [pc, #28]	; a030ace0 <serial_write_raw+0x38>
+a030acc0:	e5933000 	ldr	r3, [r3]
+a030acc4:	e5933008 	ldr	r3, [r3, #8]
+a030acc8:	e51b0010 	ldr	r0, [fp, -#16]
+a030accc:	e1a0e00f 	mov	lr, pc
+a030acd0:	e1a0f003 	mov	pc, r3
+a030acd4:	e1a03000 	mov	r3, r0
+a030acd8:	e1a00003 	mov	r0, r3
+a030acdc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030ace0:	a03103c0 	eorges	r0, r1, r0, asr #7
+
+a030ace4 <serial_poll>:
+a030ace4:	e1a0c00d 	mov	ip, sp
+a030ace8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030acec:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030acf0:	e59f3018 	ldr	r3, [pc, #24]	; a030ad10 <serial_poll+0x2c>
+a030acf4:	e5933000 	ldr	r3, [r3]
+a030acf8:	e593300c 	ldr	r3, [r3, #12]
+a030acfc:	e1a0e00f 	mov	lr, pc
+a030ad00:	e1a0f003 	mov	pc, r3
+a030ad04:	e1a03000 	mov	r3, r0
+a030ad08:	e1a00003 	mov	r0, r3
+a030ad0c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030ad10:	a03103c0 	eorges	r0, r1, r0, asr #7
+
+a030ad14 <serial_flush_input>:
+a030ad14:	e1a0c00d 	mov	ip, sp
+a030ad18:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ad1c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ad20:	e59f3018 	ldr	r3, [pc, #24]	; a030ad40 <serial_flush_input+0x2c>
+a030ad24:	e5933000 	ldr	r3, [r3]
+a030ad28:	e5933010 	ldr	r3, [r3, #16]
+a030ad2c:	e1a0e00f 	mov	lr, pc
+a030ad30:	e1a0f003 	mov	pc, r3
+a030ad34:	e1a03000 	mov	r3, r0
+a030ad38:	e1a00003 	mov	r0, r3
+a030ad3c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030ad40:	a03103c0 	eorges	r0, r1, r0, asr #7
+
+a030ad44 <serial_flush_output>:
+a030ad44:	e1a0c00d 	mov	ip, sp
+a030ad48:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ad4c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ad50:	e59f3018 	ldr	r3, [pc, #24]	; a030ad70 <serial_flush_output+0x2c>
+a030ad54:	e5933000 	ldr	r3, [r3]
+a030ad58:	e5933014 	ldr	r3, [r3, #20]
+a030ad5c:	e1a0e00f 	mov	lr, pc
+a030ad60:	e1a0f003 	mov	pc, r3
+a030ad64:	e1a03000 	mov	r3, r0
+a030ad68:	e1a00003 	mov	r0, r3
+a030ad6c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030ad70:	a03103c0 	eorges	r0, r1, r0, asr #7
+
+a030ad74 <SerialOutputString>:
+a030ad74:	e1a0c00d 	mov	ip, sp
+a030ad78:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ad7c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ad80:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030ad84:	e50b0010 	str	r0, [fp, -#16]
+a030ad88:	e51b3010 	ldr	r3, [fp, -#16]
+a030ad8c:	e5d33000 	ldrb	r3, [r3]
+a030ad90:	e3530000 	cmp	r3, #0	; 0x0
+a030ad94:	1a000000 	bne	a030ad9c <SerialOutputString+0x28>
+a030ad98:	ea000008 	b	a030adc0 <SerialOutputString+0x4c>
+a030ad9c:	e24b1010 	sub	r1, fp, #16	; 0x10
+a030ada0:	e5913000 	ldr	r3, [r1]
+a030ada4:	e1a02003 	mov	r2, r3
+a030ada8:	e5d22000 	ldrb	r2, [r2]
+a030adac:	e2833001 	add	r3, r3, #1	; 0x1
+a030adb0:	e5813000 	str	r3, [r1]
+a030adb4:	e1a00002 	mov	r0, r2
+a030adb8:	ebffff9e 	bl	a030ac38 <serial_write>
+a030adbc:	eafffff1 	b	a030ad88 <SerialOutputString+0x14>
+a030adc0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030adc4 <SerialOutputHex>:
+a030adc4:	e1a0c00d 	mov	ip, sp
+a030adc8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030adcc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030add0:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a030add4:	e50b0010 	str	r0, [fp, -#16]
+a030add8:	e3a03007 	mov	r3, #7	; 0x7
+a030addc:	e50b3018 	str	r3, [fp, -#24]
+a030ade0:	e51b3018 	ldr	r3, [fp, -#24]
+a030ade4:	e3530000 	cmp	r3, #0	; 0x0
+a030ade8:	aa000000 	bge	a030adf0 <SerialOutputHex+0x2c>
+a030adec:	ea000016 	b	a030ae4c <SerialOutputHex+0x88>
+a030adf0:	e51b3018 	ldr	r3, [fp, -#24]
+a030adf4:	e1a02103 	mov	r2, r3, lsl #2
+a030adf8:	e51b3010 	ldr	r3, [fp, -#16]
+a030adfc:	e1a03233 	mov	r3, r3, lsr r2
+a030ae00:	e203300f 	and	r3, r3, #15	; 0xf
+a030ae04:	e54b3011 	strb	r3, [fp, -#17]
+a030ae08:	e55b3011 	ldrb	r3, [fp, -#17]
+a030ae0c:	e3530009 	cmp	r3, #9	; 0x9
+a030ae10:	9a000003 	bls	a030ae24 <SerialOutputHex+0x60>
+a030ae14:	e55b3011 	ldrb	r3, [fp, -#17]
+a030ae18:	e2833057 	add	r3, r3, #87	; 0x57
+a030ae1c:	e54b3011 	strb	r3, [fp, -#17]
+a030ae20:	ea000002 	b	a030ae30 <SerialOutputHex+0x6c>
+a030ae24:	e55b3011 	ldrb	r3, [fp, -#17]
+a030ae28:	e2833030 	add	r3, r3, #48	; 0x30
+a030ae2c:	e54b3011 	strb	r3, [fp, -#17]
+a030ae30:	e55b3011 	ldrb	r3, [fp, -#17]
+a030ae34:	e1a00003 	mov	r0, r3
+a030ae38:	ebffff7e 	bl	a030ac38 <serial_write>
+a030ae3c:	e51b3018 	ldr	r3, [fp, -#24]
+a030ae40:	e2433001 	sub	r3, r3, #1	; 0x1
+a030ae44:	e50b3018 	str	r3, [fp, -#24]
+a030ae48:	eaffffe4 	b	a030ade0 <SerialOutputHex+0x1c>
+a030ae4c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030ae50 <SerialOutputDec>:
+a030ae50:	e1a0c00d 	mov	ip, sp
+a030ae54:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ae58:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ae5c:	e24dd014 	sub	sp, sp, #20	; 0x14
+a030ae60:	e50b0010 	str	r0, [fp, -#16]
+a030ae64:	e3a03001 	mov	r3, #1	; 0x1
+a030ae68:	e50b3014 	str	r3, [fp, -#20]
+a030ae6c:	e51b3010 	ldr	r3, [fp, -#16]
+a030ae70:	e50b3020 	str	r3, [fp, -#32]
+a030ae74:	e3a035ee 	mov	r3, #998244352	; 0x3b800000
+a030ae78:	e283396b 	add	r3, r3, #1753088	; 0x1ac000
+a030ae7c:	e2833c0a 	add	r3, r3, #2560	; 0xa00
+a030ae80:	e50b3018 	str	r3, [fp, -#24]
+a030ae84:	e51b3018 	ldr	r3, [fp, -#24]
+a030ae88:	e3530000 	cmp	r3, #0	; 0x0
+a030ae8c:	1a000000 	bne	a030ae94 <SerialOutputDec+0x44>
+a030ae90:	ea000020 	b	a030af18 <SerialOutputDec+0xc8>
+a030ae94:	e51b0020 	ldr	r0, [fp, -#32]
+a030ae98:	e51b1018 	ldr	r1, [fp, -#24]
+a030ae9c:	eb000424 	bl	a030bf34 <__udivsi3>
+a030aea0:	e1a03000 	mov	r3, r0
+a030aea4:	e50b301c 	str	r3, [fp, -#28]
+a030aea8:	e51b3020 	ldr	r3, [fp, -#32]
+a030aeac:	e1a00003 	mov	r0, r3
+a030aeb0:	e51b1018 	ldr	r1, [fp, -#24]
+a030aeb4:	eb000444 	bl	a030bfcc <__umodsi3>
+a030aeb8:	e1a03000 	mov	r3, r0
+a030aebc:	e50b3020 	str	r3, [fp, -#32]
+a030aec0:	e51b301c 	ldr	r3, [fp, -#28]
+a030aec4:	e3530000 	cmp	r3, #0	; 0x0
+a030aec8:	1a000003 	bne	a030aedc <SerialOutputDec+0x8c>
+a030aecc:	e51b3018 	ldr	r3, [fp, -#24]
+a030aed0:	e3530001 	cmp	r3, #1	; 0x1
+a030aed4:	0a000000 	beq	a030aedc <SerialOutputDec+0x8c>
+a030aed8:	ea000001 	b	a030aee4 <SerialOutputDec+0x94>
+a030aedc:	e3a03000 	mov	r3, #0	; 0x0
+a030aee0:	e50b3014 	str	r3, [fp, -#20]
+a030aee4:	e51b3014 	ldr	r3, [fp, -#20]
+a030aee8:	e3530000 	cmp	r3, #0	; 0x0
+a030aeec:	1a000003 	bne	a030af00 <SerialOutputDec+0xb0>
+a030aef0:	e55b301c 	ldrb	r3, [fp, -#28]
+a030aef4:	e2833030 	add	r3, r3, #48	; 0x30
+a030aef8:	e1a00003 	mov	r0, r3
+a030aefc:	ebffff4d 	bl	a030ac38 <serial_write>
+a030af00:	e51b2018 	ldr	r2, [fp, -#24]
+a030af04:	e59f3010 	ldr	r3, [pc, #16]	; a030af1c <SerialOutputDec+0xcc>
+a030af08:	e0831392 	umull	r1, r3, r2, r3
+a030af0c:	e1a031a3 	mov	r3, r3, lsr #3
+a030af10:	e50b3018 	str	r3, [fp, -#24]
+a030af14:	eaffffda 	b	a030ae84 <SerialOutputDec+0x34>
+a030af18:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030af1c:	cccccccd 	stcgtl	12, cr12, [ip], #820
+
+a030af20 <SerialOutputBlock>:
+a030af20:	e1a0c00d 	mov	ip, sp
+a030af24:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030af28:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030af2c:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030af30:	e50b0010 	str	r0, [fp, -#16]
+a030af34:	e50b1014 	str	r1, [fp, -#20]
+a030af38:	e51b3014 	ldr	r3, [fp, -#20]
+a030af3c:	e2433001 	sub	r3, r3, #1	; 0x1
+a030af40:	e50b3014 	str	r3, [fp, -#20]
+a030af44:	e3730001 	cmn	r3, #1	; 0x1
+a030af48:	1a000000 	bne	a030af50 <SerialOutputBlock+0x30>
+a030af4c:	ea000008 	b	a030af74 <SerialOutputBlock+0x54>
+a030af50:	e24b1010 	sub	r1, fp, #16	; 0x10
+a030af54:	e5913000 	ldr	r3, [r1]
+a030af58:	e1a02003 	mov	r2, r3
+a030af5c:	e5d22000 	ldrb	r2, [r2]
+a030af60:	e2833001 	add	r3, r3, #1	; 0x1
+a030af64:	e5813000 	str	r3, [r1]
+a030af68:	e1a00002 	mov	r0, r2
+a030af6c:	ebffff31 	bl	a030ac38 <serial_write>
+a030af70:	eafffff0 	b	a030af38 <SerialOutputBlock+0x18>
+a030af74:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030af78 <SerialOutputChar>:
+a030af78:	e1a0c00d 	mov	ip, sp
+a030af7c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030af80:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030af84:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030af88:	e1a03000 	mov	r3, r0
+a030af8c:	e54b300d 	strb	r3, [fp, -#13]
+a030af90:	e55b300d 	ldrb	r3, [fp, -#13]
+a030af94:	e1a00003 	mov	r0, r3
+a030af98:	ebffff26 	bl	a030ac38 <serial_write>
+a030af9c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030afa0 <SerialInputString>:
+a030afa0:	e1a0c00d 	mov	ip, sp
+a030afa4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030afa8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030afac:	e24dd02c 	sub	sp, sp, #44	; 0x2c
+a030afb0:	e50b0010 	str	r0, [fp, -#16]
+a030afb4:	e50b1014 	str	r1, [fp, -#20]
+a030afb8:	e50b2018 	str	r2, [fp, -#24]
+a030afbc:	e3a03001 	mov	r3, #1	; 0x1
+a030afc0:	e50b3030 	str	r3, [fp, -#48]
+a030afc4:	e51b3014 	ldr	r3, [fp, -#20]
+a030afc8:	e2433001 	sub	r3, r3, #1	; 0x1
+a030afcc:	e50b3034 	str	r3, [fp, -#52]
+a030afd0:	eb000209 	bl	a030b7fc <timer_tps>
+a030afd4:	e1a02000 	mov	r2, r0
+a030afd8:	e51b3018 	ldr	r3, [fp, -#24]
+a030afdc:	e0030392 	mul	r3, r2, r3
+a030afe0:	e50b3018 	str	r3, [fp, -#24]
+a030afe4:	eb0001c7 	bl	a030b708 <timer_read>
+a030afe8:	e1a03000 	mov	r3, r0
+a030afec:	e50b301c 	str	r3, [fp, -#28]
+a030aff0:	e3a03000 	mov	r3, #0	; 0x0
+a030aff4:	e50b302c 	str	r3, [fp, -#44]
+a030aff8:	e3a03000 	mov	r3, #0	; 0x0
+a030affc:	e50b3028 	str	r3, [fp, -#40]
+a030b000:	e51b202c 	ldr	r2, [fp, -#44]
+a030b004:	e51b3034 	ldr	r3, [fp, -#52]
+a030b008:	e1520003 	cmp	r2, r3
+a030b00c:	ba000000 	blt	a030b014 <SerialInputString+0x74>
+a030b010:	ea000059 	b	a030b17c <SerialInputString+0x1dc>
+a030b014:	ebffff32 	bl	a030ace4 <serial_poll>
+a030b018:	e1a03000 	mov	r3, r0
+a030b01c:	e3530000 	cmp	r3, #0	; 0x0
+a030b020:	0a000000 	beq	a030b028 <SerialInputString+0x88>
+a030b024:	ea000014 	b	a030b07c <SerialInputString+0xdc>
+a030b028:	eb0001b6 	bl	a030b708 <timer_read>
+a030b02c:	e1a03000 	mov	r3, r0
+a030b030:	e50b3020 	str	r3, [fp, -#32]
+a030b034:	e51b2020 	ldr	r2, [fp, -#32]
+a030b038:	e51b301c 	ldr	r3, [fp, -#28]
+a030b03c:	e0632002 	rsb	r2, r3, r2
+a030b040:	e51b3018 	ldr	r3, [fp, -#24]
+a030b044:	e1520003 	cmp	r2, r3
+a030b048:	9afffff1 	bls	a030b014 <SerialInputString+0x74>
+a030b04c:	e24b0028 	sub	r0, fp, #40	; 0x28
+a030b050:	e5902000 	ldr	r2, [r0]
+a030b054:	e1a01002 	mov	r1, r2
+a030b058:	e51b3010 	ldr	r3, [fp, -#16]
+a030b05c:	e0811003 	add	r1, r1, r3
+a030b060:	e3a03000 	mov	r3, #0	; 0x0
+a030b064:	e5c13000 	strb	r3, [r1]
+a030b068:	e2822001 	add	r2, r2, #1	; 0x1
+a030b06c:	e5802000 	str	r2, [r0]
+a030b070:	e51b302c 	ldr	r3, [fp, -#44]
+a030b074:	e50b3038 	str	r3, [fp, -#56]
+a030b078:	ea000041 	b	a030b184 <SerialInputString+0x1e4>
+a030b07c:	ebfffee1 	bl	a030ac08 <serial_read>
+a030b080:	e1a03000 	mov	r3, r0
+a030b084:	e50b3024 	str	r3, [fp, -#36]
+a030b088:	e51b3024 	ldr	r3, [fp, -#36]
+a030b08c:	e3530000 	cmp	r3, #0	; 0x0
+a030b090:	aa00000b 	bge	a030b0c4 <SerialInputString+0x124>
+a030b094:	e24b0028 	sub	r0, fp, #40	; 0x28
+a030b098:	e5902000 	ldr	r2, [r0]
+a030b09c:	e1a01002 	mov	r1, r2
+a030b0a0:	e51b3010 	ldr	r3, [fp, -#16]
+a030b0a4:	e0811003 	add	r1, r1, r3
+a030b0a8:	e3a03000 	mov	r3, #0	; 0x0
+a030b0ac:	e5c13000 	strb	r3, [r1]
+a030b0b0:	e2822001 	add	r2, r2, #1	; 0x1
+a030b0b4:	e5802000 	str	r2, [r0]
+a030b0b8:	e51b3024 	ldr	r3, [fp, -#36]
+a030b0bc:	e50b3038 	str	r3, [fp, -#56]
+a030b0c0:	ea00002f 	b	a030b184 <SerialInputString+0x1e4>
+a030b0c4:	e51b3030 	ldr	r3, [fp, -#48]
+a030b0c8:	e3530001 	cmp	r3, #1	; 0x1
+a030b0cc:	1a000007 	bne	a030b0f0 <SerialInputString+0x150>
+a030b0d0:	e51b3024 	ldr	r3, [fp, -#36]
+a030b0d4:	e353000d 	cmp	r3, #13	; 0xd
+a030b0d8:	0a000004 	beq	a030b0f0 <SerialInputString+0x150>
+a030b0dc:	e51b3024 	ldr	r3, [fp, -#36]
+a030b0e0:	e353000a 	cmp	r3, #10	; 0xa
+a030b0e4:	0a000001 	beq	a030b0f0 <SerialInputString+0x150>
+a030b0e8:	e3a03000 	mov	r3, #0	; 0x0
+a030b0ec:	e50b3030 	str	r3, [fp, -#48]
+a030b0f0:	e51b3030 	ldr	r3, [fp, -#48]
+a030b0f4:	e3530000 	cmp	r3, #0	; 0x0
+a030b0f8:	1affffc0 	bne	a030b000 <SerialInputString+0x60>
+a030b0fc:	e51b3024 	ldr	r3, [fp, -#36]
+a030b100:	e353000d 	cmp	r3, #13	; 0xd
+a030b104:	0a000003 	beq	a030b118 <SerialInputString+0x178>
+a030b108:	e51b3024 	ldr	r3, [fp, -#36]
+a030b10c:	e353000a 	cmp	r3, #10	; 0xa
+a030b110:	0a000000 	beq	a030b118 <SerialInputString+0x178>
+a030b114:	ea00000b 	b	a030b148 <SerialInputString+0x1a8>
+a030b118:	e24b0028 	sub	r0, fp, #40	; 0x28
+a030b11c:	e5902000 	ldr	r2, [r0]
+a030b120:	e1a01002 	mov	r1, r2
+a030b124:	e51b3010 	ldr	r3, [fp, -#16]
+a030b128:	e0811003 	add	r1, r1, r3
+a030b12c:	e3a03000 	mov	r3, #0	; 0x0
+a030b130:	e5c13000 	strb	r3, [r1]
+a030b134:	e2822001 	add	r2, r2, #1	; 0x1
+a030b138:	e5802000 	str	r2, [r0]
+a030b13c:	e51b302c 	ldr	r3, [fp, -#44]
+a030b140:	e50b3038 	str	r3, [fp, -#56]
+a030b144:	ea00000e 	b	a030b184 <SerialInputString+0x1e4>
+a030b148:	e24b0028 	sub	r0, fp, #40	; 0x28
+a030b14c:	e5902000 	ldr	r2, [r0]
+a030b150:	e1a01002 	mov	r1, r2
+a030b154:	e51b3010 	ldr	r3, [fp, -#16]
+a030b158:	e0811003 	add	r1, r1, r3
+a030b15c:	e55b3024 	ldrb	r3, [fp, -#36]
+a030b160:	e5c13000 	strb	r3, [r1]
+a030b164:	e2822001 	add	r2, r2, #1	; 0x1
+a030b168:	e5802000 	str	r2, [r0]
+a030b16c:	e51b302c 	ldr	r3, [fp, -#44]
+a030b170:	e2833001 	add	r3, r3, #1	; 0x1
+a030b174:	e50b302c 	str	r3, [fp, -#44]
+a030b178:	eaffffa0 	b	a030b000 <SerialInputString+0x60>
+a030b17c:	e51b302c 	ldr	r3, [fp, -#44]
+a030b180:	e50b3038 	str	r3, [fp, -#56]
+a030b184:	e51b0038 	ldr	r0, [fp, -#56]
+a030b188:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030b18c <SerialInputBlock>:
+a030b18c:	e1a0c00d 	mov	ip, sp
+a030b190:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b194:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b198:	e24dd028 	sub	sp, sp, #40	; 0x28
+a030b19c:	e50b0010 	str	r0, [fp, -#16]
+a030b1a0:	e50b1014 	str	r1, [fp, -#20]
+a030b1a4:	e50b2018 	str	r2, [fp, -#24]
+a030b1a8:	e51b3014 	ldr	r3, [fp, -#20]
+a030b1ac:	e50b3030 	str	r3, [fp, -#48]
+a030b1b0:	eb000191 	bl	a030b7fc <timer_tps>
+a030b1b4:	e1a02000 	mov	r2, r0
+a030b1b8:	e51b3018 	ldr	r3, [fp, -#24]
+a030b1bc:	e0030392 	mul	r3, r2, r3
+a030b1c0:	e50b3018 	str	r3, [fp, -#24]
+a030b1c4:	eb00014f 	bl	a030b708 <timer_read>
+a030b1c8:	e1a03000 	mov	r3, r0
+a030b1cc:	e50b301c 	str	r3, [fp, -#28]
+a030b1d0:	e3a03000 	mov	r3, #0	; 0x0
+a030b1d4:	e50b302c 	str	r3, [fp, -#44]
+a030b1d8:	e3a03000 	mov	r3, #0	; 0x0
+a030b1dc:	e50b3028 	str	r3, [fp, -#40]
+a030b1e0:	e51b202c 	ldr	r2, [fp, -#44]
+a030b1e4:	e51b3030 	ldr	r3, [fp, -#48]
+a030b1e8:	e1520003 	cmp	r2, r3
+a030b1ec:	ba000000 	blt	a030b1f4 <SerialInputBlock+0x68>
+a030b1f0:	ea000026 	b	a030b290 <SerialInputBlock+0x104>
+a030b1f4:	ebfffeba 	bl	a030ace4 <serial_poll>
+a030b1f8:	e1a03000 	mov	r3, r0
+a030b1fc:	e3530000 	cmp	r3, #0	; 0x0
+a030b200:	0a000000 	beq	a030b208 <SerialInputBlock+0x7c>
+a030b204:	ea00000b 	b	a030b238 <SerialInputBlock+0xac>
+a030b208:	eb00013e 	bl	a030b708 <timer_read>
+a030b20c:	e1a03000 	mov	r3, r0
+a030b210:	e50b3020 	str	r3, [fp, -#32]
+a030b214:	e51b2020 	ldr	r2, [fp, -#32]
+a030b218:	e51b301c 	ldr	r3, [fp, -#28]
+a030b21c:	e0632002 	rsb	r2, r3, r2
+a030b220:	e51b3018 	ldr	r3, [fp, -#24]
+a030b224:	e1520003 	cmp	r2, r3
+a030b228:	9afffff1 	bls	a030b1f4 <SerialInputBlock+0x68>
+a030b22c:	e51b302c 	ldr	r3, [fp, -#44]
+a030b230:	e50b3034 	str	r3, [fp, -#52]
+a030b234:	ea000017 	b	a030b298 <SerialInputBlock+0x10c>
+a030b238:	ebfffe72 	bl	a030ac08 <serial_read>
+a030b23c:	e1a03000 	mov	r3, r0
+a030b240:	e50b3024 	str	r3, [fp, -#36]
+a030b244:	e51b3024 	ldr	r3, [fp, -#36]
+a030b248:	e3530000 	cmp	r3, #0	; 0x0
+a030b24c:	aa000002 	bge	a030b25c <SerialInputBlock+0xd0>
+a030b250:	e51b3024 	ldr	r3, [fp, -#36]
+a030b254:	e50b3034 	str	r3, [fp, -#52]
+a030b258:	ea00000e 	b	a030b298 <SerialInputBlock+0x10c>
+a030b25c:	e24b0028 	sub	r0, fp, #40	; 0x28
+a030b260:	e5902000 	ldr	r2, [r0]
+a030b264:	e1a01002 	mov	r1, r2
+a030b268:	e51b3010 	ldr	r3, [fp, -#16]
+a030b26c:	e0811003 	add	r1, r1, r3
+a030b270:	e55b3024 	ldrb	r3, [fp, -#36]
+a030b274:	e5c13000 	strb	r3, [r1]
+a030b278:	e2822001 	add	r2, r2, #1	; 0x1
+a030b27c:	e5802000 	str	r2, [r0]
+a030b280:	e51b302c 	ldr	r3, [fp, -#44]
+a030b284:	e2833001 	add	r3, r3, #1	; 0x1
+a030b288:	e50b302c 	str	r3, [fp, -#44]
+a030b28c:	eaffffd3 	b	a030b1e0 <SerialInputBlock+0x54>
+a030b290:	e51b302c 	ldr	r3, [fp, -#44]
+a030b294:	e50b3034 	str	r3, [fp, -#52]
+a030b298:	e51b0034 	ldr	r0, [fp, -#52]
+a030b29c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030b2a0 <strlen>:
+a030b2a0:	e1a0c00d 	mov	ip, sp
+a030b2a4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b2a8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b2ac:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030b2b0:	e50b0010 	str	r0, [fp, -#16]
+a030b2b4:	e3a03000 	mov	r3, #0	; 0x0
+a030b2b8:	e50b3014 	str	r3, [fp, -#20]
+a030b2bc:	e51b3010 	ldr	r3, [fp, -#16]
+a030b2c0:	e5d33000 	ldrb	r3, [r3]
+a030b2c4:	e3530000 	cmp	r3, #0	; 0x0
+a030b2c8:	1a000000 	bne	a030b2d0 <strlen+0x30>
+a030b2cc:	ea000006 	b	a030b2ec <strlen+0x4c>
+a030b2d0:	e51b3014 	ldr	r3, [fp, -#20]
+a030b2d4:	e2833001 	add	r3, r3, #1	; 0x1
+a030b2d8:	e50b3014 	str	r3, [fp, -#20]
+a030b2dc:	e51b3010 	ldr	r3, [fp, -#16]
+a030b2e0:	e2833001 	add	r3, r3, #1	; 0x1
+a030b2e4:	e50b3010 	str	r3, [fp, -#16]
+a030b2e8:	eafffff3 	b	a030b2bc <strlen+0x1c>
+a030b2ec:	e51b3014 	ldr	r3, [fp, -#20]
+a030b2f0:	e1a00003 	mov	r0, r3
+a030b2f4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030b2f8 <strncmp>:
+a030b2f8:	e1a0c00d 	mov	ip, sp
+a030b2fc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b300:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b304:	e24dd014 	sub	sp, sp, #20	; 0x14
+a030b308:	e50b0010 	str	r0, [fp, -#16]
+a030b30c:	e50b1014 	str	r1, [fp, -#20]
+a030b310:	e50b2018 	str	r2, [fp, -#24]
+a030b314:	e3a03000 	mov	r3, #0	; 0x0
+a030b318:	e50b301c 	str	r3, [fp, -#28]
+a030b31c:	e51b201c 	ldr	r2, [fp, -#28]
+a030b320:	e51b3018 	ldr	r3, [fp, -#24]
+a030b324:	e1520003 	cmp	r2, r3
+a030b328:	3a000000 	bcc	a030b330 <strncmp+0x38>
+a030b32c:	ea000021 	b	a030b3b8 <strncmp+0xc0>
+a030b330:	e51b2010 	ldr	r2, [fp, -#16]
+a030b334:	e51b301c 	ldr	r3, [fp, -#28]
+a030b338:	e0821003 	add	r1, r2, r3
+a030b33c:	e51b2014 	ldr	r2, [fp, -#20]
+a030b340:	e51b301c 	ldr	r3, [fp, -#28]
+a030b344:	e0823003 	add	r3, r2, r3
+a030b348:	e5d12000 	ldrb	r2, [r1]
+a030b34c:	e5d33000 	ldrb	r3, [r3]
+a030b350:	e1520003 	cmp	r2, r3
+a030b354:	0a00000a 	beq	a030b384 <strncmp+0x8c>
+a030b358:	e51b2010 	ldr	r2, [fp, -#16]
+a030b35c:	e51b301c 	ldr	r3, [fp, -#28]
+a030b360:	e0823003 	add	r3, r2, r3
+a030b364:	e5d32000 	ldrb	r2, [r3]
+a030b368:	e51b1014 	ldr	r1, [fp, -#20]
+a030b36c:	e51b301c 	ldr	r3, [fp, -#28]
+a030b370:	e0813003 	add	r3, r1, r3
+a030b374:	e5d33000 	ldrb	r3, [r3]
+a030b378:	e0632002 	rsb	r2, r3, r2
+a030b37c:	e50b2020 	str	r2, [fp, -#32]
+a030b380:	ea00000e 	b	a030b3c0 <strncmp+0xc8>
+a030b384:	e51b2010 	ldr	r2, [fp, -#16]
+a030b388:	e51b301c 	ldr	r3, [fp, -#28]
+a030b38c:	e0823003 	add	r3, r2, r3
+a030b390:	e5d33000 	ldrb	r3, [r3]
+a030b394:	e3530000 	cmp	r3, #0	; 0x0
+a030b398:	1a000002 	bne	a030b3a8 <strncmp+0xb0>
+a030b39c:	e3a03000 	mov	r3, #0	; 0x0
+a030b3a0:	e50b3020 	str	r3, [fp, -#32]
+a030b3a4:	ea000005 	b	a030b3c0 <strncmp+0xc8>
+a030b3a8:	e51b301c 	ldr	r3, [fp, -#28]
+a030b3ac:	e2833001 	add	r3, r3, #1	; 0x1
+a030b3b0:	e50b301c 	str	r3, [fp, -#28]
+a030b3b4:	eaffffd8 	b	a030b31c <strncmp+0x24>
+a030b3b8:	e3a03000 	mov	r3, #0	; 0x0
+a030b3bc:	e50b3020 	str	r3, [fp, -#32]
+a030b3c0:	e51b0020 	ldr	r0, [fp, -#32]
+a030b3c4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030b3c8 <strncpy>:
+a030b3c8:	e1a0c00d 	mov	ip, sp
+a030b3cc:	e92dd830 	stmdb	sp!, {r4, r5, fp, ip, lr, pc}
+a030b3d0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b3d4:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a030b3d8:	e50b0018 	str	r0, [fp, -#24]
+a030b3dc:	e50b101c 	str	r1, [fp, -#28]
+a030b3e0:	e50b2020 	str	r2, [fp, -#32]
+a030b3e4:	e51b3020 	ldr	r3, [fp, -#32]
+a030b3e8:	e3530000 	cmp	r3, #0	; 0x0
+a030b3ec:	1a000000 	bne	a030b3f4 <strncpy+0x2c>
+a030b3f0:	ea000012 	b	a030b440 <strncpy+0x78>
+a030b3f4:	e51b3020 	ldr	r3, [fp, -#32]
+a030b3f8:	e2433001 	sub	r3, r3, #1	; 0x1
+a030b3fc:	e50b3020 	str	r3, [fp, -#32]
+a030b400:	e24b5018 	sub	r5, fp, #24	; 0x18
+a030b404:	e5951000 	ldr	r1, [r5]
+a030b408:	e24b401c 	sub	r4, fp, #28	; 0x1c
+a030b40c:	e5942000 	ldr	r2, [r4]
+a030b410:	e1a00001 	mov	r0, r1
+a030b414:	e1a03002 	mov	r3, r2
+a030b418:	e5d33000 	ldrb	r3, [r3]
+a030b41c:	e5c03000 	strb	r3, [r0]
+a030b420:	e5d03000 	ldrb	r3, [r0]
+a030b424:	e2822001 	add	r2, r2, #1	; 0x1
+a030b428:	e5842000 	str	r2, [r4]
+a030b42c:	e2811001 	add	r1, r1, #1	; 0x1
+a030b430:	e5851000 	str	r1, [r5]
+a030b434:	e20330ff 	and	r3, r3, #255	; 0xff
+a030b438:	e3530000 	cmp	r3, #0	; 0x0
+a030b43c:	1affffe8 	bne	a030b3e4 <strncpy+0x1c>
+a030b440:	e51b3018 	ldr	r3, [fp, -#24]
+a030b444:	e1a00003 	mov	r0, r3
+a030b448:	e91ba830 	ldmdb	fp, {r4, r5, fp, sp, pc}
+
+a030b44c <strlcpy>:
+a030b44c:	e1a0c00d 	mov	ip, sp
+a030b450:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b454:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b458:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a030b45c:	e50b0010 	str	r0, [fp, -#16]
+a030b460:	e50b1014 	str	r1, [fp, -#20]
+a030b464:	e50b2018 	str	r2, [fp, -#24]
+a030b468:	e51b0010 	ldr	r0, [fp, -#16]
+a030b46c:	e51b1014 	ldr	r1, [fp, -#20]
+a030b470:	e51b2018 	ldr	r2, [fp, -#24]
+a030b474:	ebffffd3 	bl	a030b3c8 <strncpy>
+a030b478:	e51b3018 	ldr	r3, [fp, -#24]
+a030b47c:	e3530000 	cmp	r3, #0	; 0x0
+a030b480:	0a000005 	beq	a030b49c <strlcpy+0x50>
+a030b484:	e51b2010 	ldr	r2, [fp, -#16]
+a030b488:	e51b3018 	ldr	r3, [fp, -#24]
+a030b48c:	e0823003 	add	r3, r2, r3
+a030b490:	e2432001 	sub	r2, r3, #1	; 0x1
+a030b494:	e3a03000 	mov	r3, #0	; 0x0
+a030b498:	e5c23000 	strb	r3, [r2]
+a030b49c:	e51b3010 	ldr	r3, [fp, -#16]
+a030b4a0:	e1a00003 	mov	r0, r3
+a030b4a4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030b4a8 <digitvalue>:
+a030b4a8:	e1a0c00d 	mov	ip, sp
+a030b4ac:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b4b0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b4b4:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030b4b8:	e1a03000 	mov	r3, r0
+a030b4bc:	e54b300d 	strb	r3, [fp, -#13]
+a030b4c0:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b4c4:	e353002f 	cmp	r3, #47	; 0x2f
+a030b4c8:	9a000006 	bls	a030b4e8 <digitvalue+0x40>
+a030b4cc:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b4d0:	e3530039 	cmp	r3, #57	; 0x39
+a030b4d4:	8a000003 	bhi	a030b4e8 <digitvalue+0x40>
+a030b4d8:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b4dc:	e2433030 	sub	r3, r3, #48	; 0x30
+a030b4e0:	e50b3014 	str	r3, [fp, -#20]
+a030b4e4:	ea000001 	b	a030b4f0 <digitvalue+0x48>
+a030b4e8:	e3e03000 	mvn	r3, #0	; 0x0
+a030b4ec:	e50b3014 	str	r3, [fp, -#20]
+a030b4f0:	e51b0014 	ldr	r0, [fp, -#20]
+a030b4f4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030b4f8 <xdigitvalue>:
+a030b4f8:	e1a0c00d 	mov	ip, sp
+a030b4fc:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b500:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b504:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030b508:	e1a03000 	mov	r3, r0
+a030b50c:	e54b300d 	strb	r3, [fp, -#13]
+a030b510:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b514:	e353002f 	cmp	r3, #47	; 0x2f
+a030b518:	9a000006 	bls	a030b538 <xdigitvalue+0x40>
+a030b51c:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b520:	e3530039 	cmp	r3, #57	; 0x39
+a030b524:	8a000003 	bhi	a030b538 <xdigitvalue+0x40>
+a030b528:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b52c:	e2433030 	sub	r3, r3, #48	; 0x30
+a030b530:	e50b3014 	str	r3, [fp, -#20]
+a030b534:	ea00000b 	b	a030b568 <xdigitvalue+0x70>
+a030b538:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b53c:	e3530060 	cmp	r3, #96	; 0x60
+a030b540:	9a000006 	bls	a030b560 <xdigitvalue+0x68>
+a030b544:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b548:	e3530066 	cmp	r3, #102	; 0x66
+a030b54c:	8a000003 	bhi	a030b560 <xdigitvalue+0x68>
+a030b550:	e55b300d 	ldrb	r3, [fp, -#13]
+a030b554:	e2433057 	sub	r3, r3, #87	; 0x57
+a030b558:	e50b3014 	str	r3, [fp, -#20]
+a030b55c:	ea000001 	b	a030b568 <xdigitvalue+0x70>
+a030b560:	e3e03000 	mvn	r3, #0	; 0x0
+a030b564:	e50b3014 	str	r3, [fp, -#20]
+a030b568:	e51b0014 	ldr	r0, [fp, -#20]
+a030b56c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030b570 <strtou32>:
+a030b570:	e1a0c00d 	mov	ip, sp
+a030b574:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b578:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b57c:	e24dd010 	sub	sp, sp, #16	; 0x10
+a030b580:	e50b0010 	str	r0, [fp, -#16]
+a030b584:	e50b1014 	str	r1, [fp, -#20]
+a030b588:	e51b3014 	ldr	r3, [fp, -#20]
+a030b58c:	e3a02000 	mov	r2, #0	; 0x0
+a030b590:	e5832000 	str	r2, [r3]
+a030b594:	e51b0010 	ldr	r0, [fp, -#16]
+a030b598:	e59f1118 	ldr	r1, [pc, #280]	; a030b6b8 <strtou32+0x148>
+a030b59c:	e3a02002 	mov	r2, #2	; 0x2
+a030b5a0:	ebffff54 	bl	a030b2f8 <strncmp>
+a030b5a4:	e1a03000 	mov	r3, r0
+a030b5a8:	e3530000 	cmp	r3, #0	; 0x0
+a030b5ac:	1a00001e 	bne	a030b62c <strtou32+0xbc>
+a030b5b0:	e51b3010 	ldr	r3, [fp, -#16]
+a030b5b4:	e2833002 	add	r3, r3, #2	; 0x2
+a030b5b8:	e50b3010 	str	r3, [fp, -#16]
+a030b5bc:	e51b3010 	ldr	r3, [fp, -#16]
+a030b5c0:	e5d33000 	ldrb	r3, [r3]
+a030b5c4:	e3530000 	cmp	r3, #0	; 0x0
+a030b5c8:	1a000000 	bne	a030b5d0 <strtou32+0x60>
+a030b5cc:	ea000035 	b	a030b6a8 <strtou32+0x138>
+a030b5d0:	e51b3010 	ldr	r3, [fp, -#16]
+a030b5d4:	e5d33000 	ldrb	r3, [r3]
+a030b5d8:	e1a00003 	mov	r0, r3
+a030b5dc:	ebffffc5 	bl	a030b4f8 <xdigitvalue>
+a030b5e0:	e1a03000 	mov	r3, r0
+a030b5e4:	e50b3018 	str	r3, [fp, -#24]
+a030b5e8:	e51b3018 	ldr	r3, [fp, -#24]
+a030b5ec:	e3530000 	cmp	r3, #0	; 0x0
+a030b5f0:	aa000002 	bge	a030b600 <strtou32+0x90>
+a030b5f4:	e3e03000 	mvn	r3, #0	; 0x0
+a030b5f8:	e50b301c 	str	r3, [fp, -#28]
+a030b5fc:	ea00002b 	b	a030b6b0 <strtou32+0x140>
+a030b600:	e51b1014 	ldr	r1, [fp, -#20]
+a030b604:	e51b3014 	ldr	r3, [fp, -#20]
+a030b608:	e5933000 	ldr	r3, [r3]
+a030b60c:	e1a02203 	mov	r2, r3, lsl #4
+a030b610:	e51b3018 	ldr	r3, [fp, -#24]
+a030b614:	e1823003 	orr	r3, r2, r3
+a030b618:	e5813000 	str	r3, [r1]
+a030b61c:	e51b3010 	ldr	r3, [fp, -#16]
+a030b620:	e2833001 	add	r3, r3, #1	; 0x1
+a030b624:	e50b3010 	str	r3, [fp, -#16]
+a030b628:	eaffffe3 	b	a030b5bc <strtou32+0x4c>
+a030b62c:	e51b3010 	ldr	r3, [fp, -#16]
+a030b630:	e5d33000 	ldrb	r3, [r3]
+a030b634:	e3530000 	cmp	r3, #0	; 0x0
+a030b638:	1a000000 	bne	a030b640 <strtou32+0xd0>
+a030b63c:	ea000019 	b	a030b6a8 <strtou32+0x138>
+a030b640:	e51b3010 	ldr	r3, [fp, -#16]
+a030b644:	e5d33000 	ldrb	r3, [r3]
+a030b648:	e1a00003 	mov	r0, r3
+a030b64c:	ebffff95 	bl	a030b4a8 <digitvalue>
+a030b650:	e1a03000 	mov	r3, r0
+a030b654:	e50b3018 	str	r3, [fp, -#24]
+a030b658:	e51b3018 	ldr	r3, [fp, -#24]
+a030b65c:	e3530000 	cmp	r3, #0	; 0x0
+a030b660:	aa000002 	bge	a030b670 <strtou32+0x100>
+a030b664:	e3e03000 	mvn	r3, #0	; 0x0
+a030b668:	e50b301c 	str	r3, [fp, -#28]
+a030b66c:	ea00000f 	b	a030b6b0 <strtou32+0x140>
+a030b670:	e51b1014 	ldr	r1, [fp, -#20]
+a030b674:	e51b3014 	ldr	r3, [fp, -#20]
+a030b678:	e5932000 	ldr	r2, [r3]
+a030b67c:	e1a03002 	mov	r3, r2
+a030b680:	e1a03103 	mov	r3, r3, lsl #2
+a030b684:	e0833002 	add	r3, r3, r2
+a030b688:	e1a02083 	mov	r2, r3, lsl #1
+a030b68c:	e51b3018 	ldr	r3, [fp, -#24]
+a030b690:	e0823003 	add	r3, r2, r3
+a030b694:	e5813000 	str	r3, [r1]
+a030b698:	e51b3010 	ldr	r3, [fp, -#16]
+a030b69c:	e2833001 	add	r3, r3, #1	; 0x1
+a030b6a0:	e50b3010 	str	r3, [fp, -#16]
+a030b6a4:	eaffffe0 	b	a030b62c <strtou32+0xbc>
+a030b6a8:	e3a03000 	mov	r3, #0	; 0x0
+a030b6ac:	e50b301c 	str	r3, [fp, -#28]
+a030b6b0:	e51b001c 	ldr	r0, [fp, -#28]
+a030b6b4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030b6b8:	a030d4ac 	eorges	sp, r0, ip, lsr #9
+
+a030b6bc <timer_init>:
+a030b6bc:	e1a0c00d 	mov	ip, sp
+a030b6c0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b6c4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b6c8:	e59f3030 	ldr	r3, [pc, #48]	; a030b700 <timer_init+0x44>
+a030b6cc:	e5933000 	ldr	r3, [r3]
+a030b6d0:	e3530000 	cmp	r3, #0	; 0x0
+a030b6d4:	1a000000 	bne	a030b6dc <timer_init+0x20>
+a030b6d8:	ea000007 	b	a030b6fc <timer_init+0x40>
+a030b6dc:	e59f301c 	ldr	r3, [pc, #28]	; a030b700 <timer_init+0x44>
+a030b6e0:	e5933000 	ldr	r3, [r3]
+a030b6e4:	e5933000 	ldr	r3, [r3]
+a030b6e8:	e1a0e00f 	mov	lr, pc
+a030b6ec:	e1a0f003 	mov	pc, r3
+a030b6f0:	e59f200c 	ldr	r2, [pc, #12]	; a030b704 <timer_init+0x48>
+a030b6f4:	e3a03000 	mov	r3, #0	; 0x0
+a030b6f8:	e5823000 	str	r3, [r2]
+a030b6fc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030b700:	a03103e0 	eorges	r0, r1, r0, ror #7
+a030b704:	a030fcc4 	eorges	pc, r0, r4, asr #25
+
+a030b708 <timer_read>:
+a030b708:	e1a0c00d 	mov	ip, sp
+a030b70c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b710:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b714:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030b718:	e59f3058 	ldr	r3, [pc, #88]	; a030b778 <timer_read+0x70>
+a030b71c:	e5933000 	ldr	r3, [r3]
+a030b720:	e5933004 	ldr	r3, [r3, #4]
+a030b724:	e1a0e00f 	mov	lr, pc
+a030b728:	e1a0f003 	mov	pc, r3
+a030b72c:	e1a03000 	mov	r3, r0
+a030b730:	e50b3010 	str	r3, [fp, -#16]
+a030b734:	e59f303c 	ldr	r3, [pc, #60]	; a030b778 <timer_read+0x70>
+a030b738:	e5932000 	ldr	r2, [r3]
+a030b73c:	e51b3010 	ldr	r3, [fp, -#16]
+a030b740:	e1a00003 	mov	r0, r3
+a030b744:	e5921010 	ldr	r1, [r2, #16]
+a030b748:	eb00021f 	bl	a030bfcc <__umodsi3>
+a030b74c:	e1a02000 	mov	r2, r0
+a030b750:	e59f3020 	ldr	r3, [pc, #32]	; a030b778 <timer_read+0x70>
+a030b754:	e5933000 	ldr	r3, [r3]
+a030b758:	e5933010 	ldr	r3, [r3, #16]
+a030b75c:	e1a033c3 	mov	r3, r3, asr #7
+a030b760:	e1520003 	cmp	r2, r3
+a030b764:	2a000000 	bcs	a030b76c <timer_read+0x64>
+a030b768:	eb0001a9 	bl	a030be14 <led_on>
+a030b76c:	e51b3010 	ldr	r3, [fp, -#16]
+a030b770:	e1a00003 	mov	r0, r3
+a030b774:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030b778:	a03103e0 	eorges	r0, r1, r0, ror #7
+
+a030b77c <timer_overflow>:
+a030b77c:	e1a0c00d 	mov	ip, sp
+a030b780:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b784:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b788:	e59f3018 	ldr	r3, [pc, #24]	; a030b7a8 <timer_overflow+0x2c>
+a030b78c:	e5933000 	ldr	r3, [r3]
+a030b790:	e5933008 	ldr	r3, [r3, #8]
+a030b794:	e1a0e00f 	mov	lr, pc
+a030b798:	e1a0f003 	mov	pc, r3
+a030b79c:	e1a03000 	mov	r3, r0
+a030b7a0:	e1a00003 	mov	r0, r3
+a030b7a4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030b7a8:	a03103e0 	eorges	r0, r1, r0, ror #7
+
+a030b7ac <timer_overflow_clear>:
+a030b7ac:	e1a0c00d 	mov	ip, sp
+a030b7b0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b7b4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b7b8:	ebffffef 	bl	a030b77c <timer_overflow>
+a030b7bc:	e1a03000 	mov	r3, r0
+a030b7c0:	e3530000 	cmp	r3, #0	; 0x0
+a030b7c4:	0a000004 	beq	a030b7dc <timer_overflow_clear+0x30>
+a030b7c8:	e59f2024 	ldr	r2, [pc, #36]	; a030b7f4 <timer_overflow_clear+0x48>
+a030b7cc:	e59f3020 	ldr	r3, [pc, #32]	; a030b7f4 <timer_overflow_clear+0x48>
+a030b7d0:	e5933000 	ldr	r3, [r3]
+a030b7d4:	e2833001 	add	r3, r3, #1	; 0x1
+a030b7d8:	e5823000 	str	r3, [r2]
+a030b7dc:	e59f3014 	ldr	r3, [pc, #20]	; a030b7f8 <timer_overflow_clear+0x4c>
+a030b7e0:	e5933000 	ldr	r3, [r3]
+a030b7e4:	e593300c 	ldr	r3, [r3, #12]
+a030b7e8:	e1a0e00f 	mov	lr, pc
+a030b7ec:	e1a0f003 	mov	pc, r3
+a030b7f0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030b7f4:	a030fcc4 	eorges	pc, r0, r4, asr #25
+a030b7f8:	a03103e0 	eorges	r0, r1, r0, ror #7
+
+a030b7fc <timer_tps>:
+a030b7fc:	e1a0c00d 	mov	ip, sp
+a030b800:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b804:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b808:	e59f300c 	ldr	r3, [pc, #12]	; a030b81c <timer_tps+0x20>
+a030b80c:	e5933000 	ldr	r3, [r3]
+a030b810:	e5933010 	ldr	r3, [r3, #16]
+a030b814:	e1a00003 	mov	r0, r3
+a030b818:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030b81c:	a03103e0 	eorges	r0, r1, r0, ror #7
+
+a030b820 <msleep>:
+a030b820:	e1a0c00d 	mov	ip, sp
+a030b824:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b828:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b82c:	e24dd01c 	sub	sp, sp, #28	; 0x1c
+a030b830:	e50b0010 	str	r0, [fp, -#16]
+a030b834:	e3a03000 	mov	r3, #0	; 0x0
+a030b838:	e50b3020 	str	r3, [fp, -#32]
+a030b83c:	e3a03000 	mov	r3, #0	; 0x0
+a030b840:	e50b3024 	str	r3, [fp, -#36]
+a030b844:	e3a03000 	mov	r3, #0	; 0x0
+a030b848:	e50b3028 	str	r3, [fp, -#40]
+a030b84c:	e51b3010 	ldr	r3, [fp, -#16]
+a030b850:	e3530000 	cmp	r3, #0	; 0x0
+a030b854:	1a000000 	bne	a030b85c <msleep+0x3c>
+a030b858:	ea00002e 	b	a030b918 <msleep+0xf8>
+a030b85c:	e59f30b8 	ldr	r3, [pc, #184]	; a030b91c <msleep+0xfc>
+a030b860:	e5933000 	ldr	r3, [r3]
+a030b864:	e5932010 	ldr	r2, [r3, #16]
+a030b868:	e51b3010 	ldr	r3, [fp, -#16]
+a030b86c:	e0020293 	mul	r2, r3, r2
+a030b870:	e59f30a8 	ldr	r3, [pc, #168]	; a030b920 <msleep+0x100>
+a030b874:	e0831392 	umull	r1, r3, r2, r3
+a030b878:	e1a03323 	mov	r3, r3, lsr #6
+a030b87c:	e50b3014 	str	r3, [fp, -#20]
+a030b880:	ebffffa0 	bl	a030b708 <timer_read>
+a030b884:	e1a03000 	mov	r3, r0
+a030b888:	e50b3018 	str	r3, [fp, -#24]
+a030b88c:	e51b2018 	ldr	r2, [fp, -#24]
+a030b890:	e51b3014 	ldr	r3, [fp, -#20]
+a030b894:	e0823003 	add	r3, r2, r3
+a030b898:	e50b301c 	str	r3, [fp, -#28]
+a030b89c:	e51b201c 	ldr	r2, [fp, -#28]
+a030b8a0:	e51b3018 	ldr	r3, [fp, -#24]
+a030b8a4:	e1520003 	cmp	r2, r3
+a030b8a8:	2a000002 	bcs	a030b8b8 <msleep+0x98>
+a030b8ac:	ebffffbe 	bl	a030b7ac <timer_overflow_clear>
+a030b8b0:	e3a03001 	mov	r3, #1	; 0x1
+a030b8b4:	e50b3020 	str	r3, [fp, -#32]
+a030b8b8:	e1a00000 	nop			(mov r0,r0)
+a030b8bc:	e51b3020 	ldr	r3, [fp, -#32]
+a030b8c0:	e3530000 	cmp	r3, #0	; 0x0
+a030b8c4:	0a000009 	beq	a030b8f0 <msleep+0xd0>
+a030b8c8:	e51b3024 	ldr	r3, [fp, -#36]
+a030b8cc:	e3530000 	cmp	r3, #0	; 0x0
+a030b8d0:	1a000006 	bne	a030b8f0 <msleep+0xd0>
+a030b8d4:	ebffffa8 	bl	a030b77c <timer_overflow>
+a030b8d8:	e1a03000 	mov	r3, r0
+a030b8dc:	e3530000 	cmp	r3, #0	; 0x0
+a030b8e0:	0a000009 	beq	a030b90c <msleep+0xec>
+a030b8e4:	e3a03001 	mov	r3, #1	; 0x1
+a030b8e8:	e50b3024 	str	r3, [fp, -#36]
+a030b8ec:	ea000006 	b	a030b90c <msleep+0xec>
+a030b8f0:	ebffff84 	bl	a030b708 <timer_read>
+a030b8f4:	e1a02000 	mov	r2, r0
+a030b8f8:	e51b301c 	ldr	r3, [fp, -#28]
+a030b8fc:	e1520003 	cmp	r2, r3
+a030b900:	3a000001 	bcc	a030b90c <msleep+0xec>
+a030b904:	e3a03001 	mov	r3, #1	; 0x1
+a030b908:	e50b3028 	str	r3, [fp, -#40]
+a030b90c:	e51b3028 	ldr	r3, [fp, -#40]
+a030b910:	e3530000 	cmp	r3, #0	; 0x0
+a030b914:	0affffe8 	beq	a030b8bc <msleep+0x9c>
+a030b918:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030b91c:	a03103e0 	eorges	r0, r1, r0, ror #7
+a030b920:	10624dd3 	ldrned	r4, [r2], -#211
+
+a030b924 <MyMemCpy>:
+a030b924:	e1a0c00d 	mov	ip, sp
+a030b928:	e92dd830 	stmdb	sp!, {r4, r5, fp, ip, lr, pc}
+a030b92c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b930:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a030b934:	e50b0018 	str	r0, [fp, -#24]
+a030b938:	e50b101c 	str	r1, [fp, -#28]
+a030b93c:	e50b2020 	str	r2, [fp, -#32]
+a030b940:	e51b3020 	ldr	r3, [fp, -#32]
+a030b944:	e2433001 	sub	r3, r3, #1	; 0x1
+a030b948:	e50b3020 	str	r3, [fp, -#32]
+a030b94c:	e3730001 	cmn	r3, #1	; 0x1
+a030b950:	1a000000 	bne	a030b958 <MyMemCpy+0x34>
+a030b954:	ea000013 	b	a030b9a8 <MyMemCpy+0x84>
+a030b958:	e51b3020 	ldr	r3, [fp, -#32]
+a030b95c:	e1a03803 	mov	r3, r3, lsl #16
+a030b960:	e1a03823 	mov	r3, r3, lsr #16
+a030b964:	e3530000 	cmp	r3, #0	; 0x0
+a030b968:	1a000001 	bne	a030b974 <MyMemCpy+0x50>
+a030b96c:	e59f0038 	ldr	r0, [pc, #56]	; a030b9ac <MyMemCpy+0x88>
+a030b970:	ebfffc4a 	bl	a030aaa0 <printf>
+a030b974:	e24b5018 	sub	r5, fp, #24	; 0x18
+a030b978:	e5951000 	ldr	r1, [r5]
+a030b97c:	e24b401c 	sub	r4, fp, #28	; 0x1c
+a030b980:	e5942000 	ldr	r2, [r4]
+a030b984:	e1a00001 	mov	r0, r1
+a030b988:	e1a03002 	mov	r3, r2
+a030b98c:	e5933000 	ldr	r3, [r3]
+a030b990:	e5803000 	str	r3, [r0]
+a030b994:	e2822004 	add	r2, r2, #4	; 0x4
+a030b998:	e5842000 	str	r2, [r4]
+a030b99c:	e2811004 	add	r1, r1, #4	; 0x4
+a030b9a0:	e5851000 	str	r1, [r5]
+a030b9a4:	eaffffe5 	b	a030b940 <MyMemCpy+0x1c>
+a030b9a8:	e91ba830 	ldmdb	fp, {r4, r5, fp, sp, pc}
+a030b9ac:	a030d4b0 	ldrgeh	sp, [r0], -r0
+
+a030b9b0 <pxa_reboot>:
+a030b9b0:	e1a0c00d 	mov	ip, sp
+a030b9b4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b9b8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b9bc:	e59f0010 	ldr	r0, [pc, #16]	; a030b9d4 <pxa_reboot+0x24>
+a030b9c0:	ebfffc36 	bl	a030aaa0 <printf>
+a030b9c4:	e59f000c 	ldr	r0, [pc, #12]	; a030b9d8 <pxa_reboot+0x28>
+a030b9c8:	ebfffc34 	bl	a030aaa0 <printf>
+a030b9cc:	ebfffcdc 	bl	a030ad44 <serial_flush_output>
+a030b9d0:	eafffffe 	b	a030b9d0 <pxa_reboot+0x20>
+a030b9d4:	a030d4b4 	ldrgeh	sp, [r0], -r4
+a030b9d8:	a030d4dc 	ldrgesb	sp, [r0], -ip
+
+a030b9dc <pxa_serial_flush_input>:
+a030b9dc:	e1a0c00d 	mov	ip, sp
+a030b9e0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030b9e4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030b9e8:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030b9ec:	e1a00000 	nop			(mov r0,r0)
+a030b9f0:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030b9f4:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030b9f8:	e5933000 	ldr	r3, [r3]
+a030b9fc:	e2033001 	and	r3, r3, #1	; 0x1
+a030ba00:	e3530000 	cmp	r3, #0	; 0x0
+a030ba04:	1a000000 	bne	a030ba0c <pxa_serial_flush_input+0x30>
+a030ba08:	ea00000d 	b	a030ba44 <pxa_serial_flush_input+0x68>
+a030ba0c:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030ba10:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030ba14:	e5933000 	ldr	r3, [r3]
+a030ba18:	e203300e 	and	r3, r3, #14	; 0xe
+a030ba1c:	e3530000 	cmp	r3, #0	; 0x0
+a030ba20:	0a000002 	beq	a030ba30 <pxa_serial_flush_input+0x54>
+a030ba24:	e3e0300d 	mvn	r3, #13	; 0xd
+a030ba28:	e50b3014 	str	r3, [fp, -#20]
+a030ba2c:	ea000006 	b	a030ba4c <pxa_serial_flush_input+0x70>
+a030ba30:	e3a03101 	mov	r3, #1073741824	; 0x40000000
+a030ba34:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030ba38:	e5933000 	ldr	r3, [r3]
+a030ba3c:	e50b3010 	str	r3, [fp, -#16]
+a030ba40:	eaffffea 	b	a030b9f0 <pxa_serial_flush_input+0x14>
+a030ba44:	e3a03000 	mov	r3, #0	; 0x0
+a030ba48:	e50b3014 	str	r3, [fp, -#20]
+a030ba4c:	e51b0014 	ldr	r0, [fp, -#20]
+a030ba50:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030ba54 <pxa_serial_flush_output>:
+a030ba54:	e1a0c00d 	mov	ip, sp
+a030ba58:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ba5c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ba60:	e1a00000 	nop			(mov r0,r0)
+a030ba64:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030ba68:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030ba6c:	e5933000 	ldr	r3, [r3]
+a030ba70:	e3c33020 	bic	r3, r3, #32	; 0x20
+a030ba74:	e3530000 	cmp	r3, #0	; 0x0
+a030ba78:	1afffff9 	bne	a030ba64 <pxa_serial_flush_output+0x10>
+a030ba7c:	e3a03000 	mov	r3, #0	; 0x0
+a030ba80:	e1a00003 	mov	r0, r3
+a030ba84:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030ba88 <pxa_serial_init>:
+a030ba88:	e1a0c00d 	mov	ip, sp
+a030ba8c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030ba90:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030ba94:	e24dd00c 	sub	sp, sp, #12	; 0xc
+a030ba98:	e50b0010 	str	r0, [fp, -#16]
+a030ba9c:	e3a02111 	mov	r2, #1073741828	; 0x40000004
+a030baa0:	e2822613 	add	r2, r2, #19922944	; 0x1300000
+a030baa4:	e3a03111 	mov	r3, #1073741828	; 0x40000004
+a030baa8:	e2833613 	add	r3, r3, #19922944	; 0x1300000
+a030baac:	e5933000 	ldr	r3, [r3]
+a030bab0:	e3833020 	orr	r3, r3, #32	; 0x20
+a030bab4:	e5823000 	str	r3, [r2]
+a030bab8:	e51b3010 	ldr	r3, [fp, -#16]
+a030babc:	e3530008 	cmp	r3, #8	; 0x8
+a030bac0:	979ff103 	ldrls	pc, [pc, r3, lsl #2]
+a030bac4:	ea00001d 	b	a030bb40 <pxa_serial_init+0xb8>
+a030bac8:	a030baec 	eorges	fp, r0, ip, ror #21
+a030bacc:	a030bb40 	eorges	fp, r0, r0, asr #22
+a030bad0:	a030bb40 	eorges	fp, r0, r0, asr #22
+a030bad4:	a030baf8 	ldrgesh	fp, [r0], -r8
+a030bad8:	a030bb04 	eorges	fp, r0, r4, lsl #22
+a030badc:	a030bb10 	eorges	fp, r0, r0, lsl fp
+a030bae0:	a030bb1c 	eorges	fp, r0, ip, lsl fp
+a030bae4:	a030bb28 	eorges	fp, r0, r8, lsr #22
+a030bae8:	a030bb34 	eorges	fp, r0, r4, lsr fp
+a030baec:	e3a03c03 	mov	r3, #768	; 0x300
+a030baf0:	e50b3014 	str	r3, [fp, -#20]
+a030baf4:	ea000014 	b	a030bb4c <pxa_serial_init+0xc4>
+a030baf8:	e3a03060 	mov	r3, #96	; 0x60
+a030bafc:	e50b3014 	str	r3, [fp, -#20]
+a030bb00:	ea000011 	b	a030bb4c <pxa_serial_init+0xc4>
+a030bb04:	e3a03030 	mov	r3, #48	; 0x30
+a030bb08:	e50b3014 	str	r3, [fp, -#20]
+a030bb0c:	ea00000e 	b	a030bb4c <pxa_serial_init+0xc4>
+a030bb10:	e3a03018 	mov	r3, #24	; 0x18
+a030bb14:	e50b3014 	str	r3, [fp, -#20]
+a030bb18:	ea00000b 	b	a030bb4c <pxa_serial_init+0xc4>
+a030bb1c:	e3a03010 	mov	r3, #16	; 0x10
+a030bb20:	e50b3014 	str	r3, [fp, -#20]
+a030bb24:	ea000008 	b	a030bb4c <pxa_serial_init+0xc4>
+a030bb28:	e3a03008 	mov	r3, #8	; 0x8
+a030bb2c:	e50b3014 	str	r3, [fp, -#20]
+a030bb30:	ea000005 	b	a030bb4c <pxa_serial_init+0xc4>
+a030bb34:	e3a03004 	mov	r3, #4	; 0x4
+a030bb38:	e50b3014 	str	r3, [fp, -#20]
+a030bb3c:	ea000002 	b	a030bb4c <pxa_serial_init+0xc4>
+a030bb40:	e3e03006 	mvn	r3, #6	; 0x6
+a030bb44:	e50b3018 	str	r3, [fp, -#24]
+a030bb48:	ea000024 	b	a030bbe0 <pxa_serial_init+0x158>
+a030bb4c:	e3a03131 	mov	r3, #1073741836	; 0x4000000c
+a030bb50:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bb54:	e3a02000 	mov	r2, #0	; 0x0
+a030bb58:	e5832000 	str	r2, [r3]
+a030bb5c:	e3a03111 	mov	r3, #1073741828	; 0x40000004
+a030bb60:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bb64:	e3a02000 	mov	r2, #0	; 0x0
+a030bb68:	e5832000 	str	r2, [r3]
+a030bb6c:	e3a03121 	mov	r3, #1073741832	; 0x40000008
+a030bb70:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bb74:	e3a02000 	mov	r2, #0	; 0x0
+a030bb78:	e5832000 	str	r2, [r3]
+a030bb7c:	e3a03131 	mov	r3, #1073741836	; 0x4000000c
+a030bb80:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bb84:	e3a02083 	mov	r2, #131	; 0x83
+a030bb88:	e5832000 	str	r2, [r3]
+a030bb8c:	e3a03101 	mov	r3, #1073741824	; 0x40000000
+a030bb90:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bb94:	e51b2014 	ldr	r2, [fp, -#20]
+a030bb98:	e20220ff 	and	r2, r2, #255	; 0xff
+a030bb9c:	e5832000 	str	r2, [r3]
+a030bba0:	e3a02111 	mov	r2, #1073741828	; 0x40000004
+a030bba4:	e2822607 	add	r2, r2, #7340032	; 0x700000
+a030bba8:	e51b3014 	ldr	r3, [fp, -#20]
+a030bbac:	e1a03423 	mov	r3, r3, lsr #8
+a030bbb0:	e20330ff 	and	r3, r3, #255	; 0xff
+a030bbb4:	e5823000 	str	r3, [r2]
+a030bbb8:	e3a03131 	mov	r3, #1073741836	; 0x4000000c
+a030bbbc:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bbc0:	e3a02003 	mov	r2, #3	; 0x3
+a030bbc4:	e5832000 	str	r2, [r3]
+a030bbc8:	e3a03111 	mov	r3, #1073741828	; 0x40000004
+a030bbcc:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bbd0:	e3a02040 	mov	r2, #64	; 0x40
+a030bbd4:	e5832000 	str	r2, [r3]
+a030bbd8:	e3a03000 	mov	r3, #0	; 0x0
+a030bbdc:	e50b3018 	str	r3, [fp, -#24]
+a030bbe0:	e51b0018 	ldr	r0, [fp, -#24]
+a030bbe4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bbe8 <pxa_serial_poll>:
+a030bbe8:	e1a0c00d 	mov	ip, sp
+a030bbec:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bbf0:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bbf4:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030bbf8:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030bbfc:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bc00:	e5933000 	ldr	r3, [r3]
+a030bc04:	e203300e 	and	r3, r3, #14	; 0xe
+a030bc08:	e3530000 	cmp	r3, #0	; 0x0
+a030bc0c:	0a000002 	beq	a030bc1c <pxa_serial_poll+0x34>
+a030bc10:	e3e0300d 	mvn	r3, #13	; 0xd
+a030bc14:	e50b3010 	str	r3, [fp, -#16]
+a030bc18:	ea00000a 	b	a030bc48 <pxa_serial_poll+0x60>
+a030bc1c:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030bc20:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bc24:	e5933000 	ldr	r3, [r3]
+a030bc28:	e2033001 	and	r3, r3, #1	; 0x1
+a030bc2c:	e3530000 	cmp	r3, #0	; 0x0
+a030bc30:	0a000002 	beq	a030bc40 <pxa_serial_poll+0x58>
+a030bc34:	e3a03001 	mov	r3, #1	; 0x1
+a030bc38:	e50b3010 	str	r3, [fp, -#16]
+a030bc3c:	ea000001 	b	a030bc48 <pxa_serial_poll+0x60>
+a030bc40:	e3a03000 	mov	r3, #0	; 0x0
+a030bc44:	e50b3010 	str	r3, [fp, -#16]
+a030bc48:	e51b0010 	ldr	r0, [fp, -#16]
+a030bc4c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bc50 <pxa_serial_read>:
+a030bc50:	e1a0c00d 	mov	ip, sp
+a030bc54:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bc58:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bc5c:	e24dd008 	sub	sp, sp, #8	; 0x8
+a030bc60:	e1a00000 	nop			(mov r0,r0)
+a030bc64:	ebffffdf 	bl	a030bbe8 <pxa_serial_poll>
+a030bc68:	e1a03000 	mov	r3, r0
+a030bc6c:	e50b3010 	str	r3, [fp, -#16]
+a030bc70:	e51b3010 	ldr	r3, [fp, -#16]
+a030bc74:	e3530000 	cmp	r3, #0	; 0x0
+a030bc78:	aa000002 	bge	a030bc88 <pxa_serial_read+0x38>
+a030bc7c:	e51b3010 	ldr	r3, [fp, -#16]
+a030bc80:	e50b3014 	str	r3, [fp, -#20]
+a030bc84:	ea000007 	b	a030bca8 <pxa_serial_read+0x58>
+a030bc88:	e51b3010 	ldr	r3, [fp, -#16]
+a030bc8c:	e3530000 	cmp	r3, #0	; 0x0
+a030bc90:	dafffff3 	ble	a030bc64 <pxa_serial_read+0x14>
+a030bc94:	e3a03101 	mov	r3, #1073741824	; 0x40000000
+a030bc98:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bc9c:	e5933000 	ldr	r3, [r3]
+a030bca0:	e20330ff 	and	r3, r3, #255	; 0xff
+a030bca4:	e50b3014 	str	r3, [fp, -#20]
+a030bca8:	e51b0014 	ldr	r0, [fp, -#20]
+a030bcac:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bcb0 <pxa_serial_write>:
+a030bcb0:	e1a0c00d 	mov	ip, sp
+a030bcb4:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bcb8:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bcbc:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030bcc0:	e50b0010 	str	r0, [fp, -#16]
+a030bcc4:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030bcc8:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bccc:	e5933000 	ldr	r3, [r3]
+a030bcd0:	e2033020 	and	r3, r3, #32	; 0x20
+a030bcd4:	e3530000 	cmp	r3, #0	; 0x0
+a030bcd8:	0afffff9 	beq	a030bcc4 <pxa_serial_write+0x14>
+a030bcdc:	e3a03101 	mov	r3, #1073741824	; 0x40000000
+a030bce0:	e2833607 	add	r3, r3, #7340032	; 0x700000
+a030bce4:	e51b2010 	ldr	r2, [fp, -#16]
+a030bce8:	e20220ff 	and	r2, r2, #255	; 0xff
+a030bcec:	e5832000 	str	r2, [r3]
+a030bcf0:	e3a03000 	mov	r3, #0	; 0x0
+a030bcf4:	e1a00003 	mov	r0, r3
+a030bcf8:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bcfc <intelarm_timer_init>:
+a030bcfc:	e1a0c00d 	mov	ip, sp
+a030bd00:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bd04:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bd08:	e3a03141 	mov	r3, #1073741840	; 0x40000010
+a030bd0c:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bd10:	e3a02000 	mov	r2, #0	; 0x0
+a030bd14:	e5832000 	str	r2, [r3]
+a030bd18:	e3a03171 	mov	r3, #1073741852	; 0x4000001c
+a030bd1c:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bd20:	e3a02000 	mov	r2, #0	; 0x0
+a030bd24:	e5832000 	str	r2, [r3]
+a030bd28:	e3a03141 	mov	r3, #1073741840	; 0x40000010
+a030bd2c:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bd30:	e5933000 	ldr	r3, [r3]
+a030bd34:	e3530000 	cmp	r3, #0	; 0x0
+a030bd38:	0afffffa 	beq	a030bd28 <intelarm_timer_init+0x2c>
+a030bd3c:	e3a03101 	mov	r3, #1073741824	; 0x40000000
+a030bd40:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bd44:	e3a02000 	mov	r2, #0	; 0x0
+a030bd48:	e5832000 	str	r2, [r3]
+a030bd4c:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030bd50:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bd54:	e3a02001 	mov	r2, #1	; 0x1
+a030bd58:	e5832000 	str	r2, [r3]
+a030bd5c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bd60 <intelarm_timer_read>:
+a030bd60:	e1a0c00d 	mov	ip, sp
+a030bd64:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bd68:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bd6c:	e3a03141 	mov	r3, #1073741840	; 0x40000010
+a030bd70:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bd74:	e5933000 	ldr	r3, [r3]
+a030bd78:	e1a00003 	mov	r0, r3
+a030bd7c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bd80 <intelarm_timer_overflow>:
+a030bd80:	e1a0c00d 	mov	ip, sp
+a030bd84:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bd88:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bd8c:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030bd90:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bd94:	e5933000 	ldr	r3, [r3]
+a030bd98:	e2033001 	and	r3, r3, #1	; 0x1
+a030bd9c:	e1a00003 	mov	r0, r3
+a030bda0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bda4 <intelarm_timer_overflow_clear>:
+a030bda4:	e1a0c00d 	mov	ip, sp
+a030bda8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bdac:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bdb0:	e3a03151 	mov	r3, #1073741844	; 0x40000014
+a030bdb4:	e283360a 	add	r3, r3, #10485760	; 0xa00000
+a030bdb8:	e3a02001 	mov	r2, #1	; 0x1
+a030bdbc:	e5832000 	str	r2, [r3]
+a030bdc0:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+
+a030bdc4 <led_init>:
+a030bdc4:	e1a0c00d 	mov	ip, sp
+a030bdc8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bdcc:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bdd0:	e59f3038 	ldr	r3, [pc, #56]	; a030be10 <led_init+0x4c>
+a030bdd4:	e5933000 	ldr	r3, [r3]
+a030bdd8:	e3530000 	cmp	r3, #0	; 0x0
+a030bddc:	1a000000 	bne	a030bde4 <led_init+0x20>
+a030bde0:	ea000009 	b	a030be0c <led_init+0x48>
+a030bde4:	e59f3024 	ldr	r3, [pc, #36]	; a030be10 <led_init+0x4c>
+a030bde8:	e5933000 	ldr	r3, [r3]
+a030bdec:	e5933010 	ldr	r3, [r3, #16]
+a030bdf0:	e1a0e00f 	mov	lr, pc
+a030bdf4:	e1a0f003 	mov	pc, r3
+a030bdf8:	e59f3010 	ldr	r3, [pc, #16]	; a030be10 <led_init+0x4c>
+a030bdfc:	e5933000 	ldr	r3, [r3]
+a030be00:	e5933000 	ldr	r3, [r3]
+a030be04:	e1a0e00f 	mov	lr, pc
+a030be08:	e1a0f003 	mov	pc, r3
+a030be0c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030be10:	a0310400 	eorges	r0, r1, r0, lsl #8
+
+a030be14 <led_on>:
+a030be14:	e1a0c00d 	mov	ip, sp
+a030be18:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030be1c:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030be20:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030be24:	e59f3038 	ldr	r3, [pc, #56]	; a030be64 <led_on+0x50>
+a030be28:	e5933000 	ldr	r3, [r3]
+a030be2c:	e3530000 	cmp	r3, #0	; 0x0
+a030be30:	1a000002 	bne	a030be40 <led_on+0x2c>
+a030be34:	e3e03000 	mvn	r3, #0	; 0x0
+a030be38:	e50b3010 	str	r3, [fp, -#16]
+a030be3c:	ea000006 	b	a030be5c <led_on+0x48>
+a030be40:	e59f301c 	ldr	r3, [pc, #28]	; a030be64 <led_on+0x50>
+a030be44:	e5933000 	ldr	r3, [r3]
+a030be48:	e5933000 	ldr	r3, [r3]
+a030be4c:	e1a0e00f 	mov	lr, pc
+a030be50:	e1a0f003 	mov	pc, r3
+a030be54:	e3a03000 	mov	r3, #0	; 0x0
+a030be58:	e50b3010 	str	r3, [fp, -#16]
+a030be5c:	e51b0010 	ldr	r0, [fp, -#16]
+a030be60:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030be64:	a0310400 	eorges	r0, r1, r0, lsl #8
+
+a030be68 <led_off>:
+a030be68:	e1a0c00d 	mov	ip, sp
+a030be6c:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030be70:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030be74:	e24dd004 	sub	sp, sp, #4	; 0x4
+a030be78:	e59f3038 	ldr	r3, [pc, #56]	; a030beb8 <led_off+0x50>
+a030be7c:	e5933000 	ldr	r3, [r3]
+a030be80:	e3530000 	cmp	r3, #0	; 0x0
+a030be84:	1a000002 	bne	a030be94 <led_off+0x2c>
+a030be88:	e3e03000 	mvn	r3, #0	; 0x0
+a030be8c:	e50b3010 	str	r3, [fp, -#16]
+a030be90:	ea000006 	b	a030beb0 <led_off+0x48>
+a030be94:	e59f301c 	ldr	r3, [pc, #28]	; a030beb8 <led_off+0x50>
+a030be98:	e5933000 	ldr	r3, [r3]
+a030be9c:	e5933004 	ldr	r3, [r3, #4]
+a030bea0:	e1a0e00f 	mov	lr, pc
+a030bea4:	e1a0f003 	mov	pc, r3
+a030bea8:	e3a03000 	mov	r3, #0	; 0x0
+a030beac:	e50b3010 	str	r3, [fp, -#16]
+a030beb0:	e51b0010 	ldr	r0, [fp, -#16]
+a030beb4:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030beb8:	a0310400 	eorges	r0, r1, r0, lsl #8
+
+a030bebc <led_toggle>:
+a030bebc:	e1a0c00d 	mov	ip, sp
+a030bec0:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bec4:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bec8:	e59f3010 	ldr	r3, [pc, #16]	; a030bee0 <led_toggle+0x24>
+a030becc:	e5933000 	ldr	r3, [r3]
+a030bed0:	e5933008 	ldr	r3, [r3, #8]
+a030bed4:	e1a0e00f 	mov	lr, pc
+a030bed8:	e1a0f003 	mov	pc, r3
+a030bedc:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030bee0:	a0310400 	eorges	r0, r1, r0, lsl #8
+
+a030bee4 <led_lock>:
+a030bee4:	e1a0c00d 	mov	ip, sp
+a030bee8:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030beec:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bef0:	e59f3010 	ldr	r3, [pc, #16]	; a030bf08 <led_lock+0x24>
+a030bef4:	e5933000 	ldr	r3, [r3]
+a030bef8:	e593300c 	ldr	r3, [r3, #12]
+a030befc:	e1a0e00f 	mov	lr, pc
+a030bf00:	e1a0f003 	mov	pc, r3
+a030bf04:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030bf08:	a0310400 	eorges	r0, r1, r0, lsl #8
+
+a030bf0c <led_unlock>:
+a030bf0c:	e1a0c00d 	mov	ip, sp
+a030bf10:	e92dd800 	stmdb	sp!, {fp, ip, lr, pc}
+a030bf14:	e24cb004 	sub	fp, ip, #4	; 0x4
+a030bf18:	e59f3010 	ldr	r3, [pc, #16]	; a030bf30 <led_unlock+0x24>
+a030bf1c:	e5933000 	ldr	r3, [r3]
+a030bf20:	e5933010 	ldr	r3, [r3, #16]
+a030bf24:	e1a0e00f 	mov	lr, pc
+a030bf28:	e1a0f003 	mov	pc, r3
+a030bf2c:	e91ba800 	ldmdb	fp, {fp, sp, pc}
+a030bf30:	a0310400 	eorges	r0, r1, r0, lsl #8
+
+a030bf34 <__udivsi3>:
+a030bf34:	e3510000 	cmp	r1, #0	; 0x0
+a030bf38:	0a00001f 	beq	a030bfbc <Ldiv0>
+a030bf3c:	e3a03001 	mov	r3, #1	; 0x1
+a030bf40:	e3a02000 	mov	r2, #0	; 0x0
+a030bf44:	e1500001 	cmp	r0, r1
+a030bf48:	3a000019 	bcc	a030bfb4 <Lgot_result>
+
+a030bf4c <Loop1>:
+a030bf4c:	e3510201 	cmp	r1, #268435456	; 0x10000000
+a030bf50:	31510000 	cmpcc	r1, r0
+a030bf54:	31a01201 	movcc	r1, r1, lsl #4
+a030bf58:	31a03203 	movcc	r3, r3, lsl #4
+a030bf5c:	3afffffa 	bcc	a030bf4c <Loop1>
+
+a030bf60 <Lbignum>:
+a030bf60:	e3510102 	cmp	r1, #-2147483648	; 0x80000000
+a030bf64:	31510000 	cmpcc	r1, r0
+a030bf68:	31a01081 	movcc	r1, r1, lsl #1
+a030bf6c:	31a03083 	movcc	r3, r3, lsl #1
+a030bf70:	3afffffa 	bcc	a030bf60 <Lbignum>
+
+a030bf74 <Loop3>:
+a030bf74:	e1500001 	cmp	r0, r1
+a030bf78:	20400001 	subcs	r0, r0, r1
+a030bf7c:	21822003 	orrcs	r2, r2, r3
+a030bf80:	e15000a1 	cmp	r0, r1, lsr #1
+a030bf84:	204000a1 	subcs	r0, r0, r1, lsr #1
+a030bf88:	218220a3 	orrcs	r2, r2, r3, lsr #1
+a030bf8c:	e1500121 	cmp	r0, r1, lsr #2
+a030bf90:	20400121 	subcs	r0, r0, r1, lsr #2
+a030bf94:	21822123 	orrcs	r2, r2, r3, lsr #2
+a030bf98:	e15001a1 	cmp	r0, r1, lsr #3
+a030bf9c:	204001a1 	subcs	r0, r0, r1, lsr #3
+a030bfa0:	218221a3 	orrcs	r2, r2, r3, lsr #3
+a030bfa4:	e3500000 	cmp	r0, #0	; 0x0
+a030bfa8:	11b03223 	movnes	r3, r3, lsr #4
+a030bfac:	11a01221 	movne	r1, r1, lsr #4
+a030bfb0:	1affffef 	bne	a030bf74 <Loop3>
+
+a030bfb4 <Lgot_result>:
+a030bfb4:	e1a00002 	mov	r0, r2
+a030bfb8:	e1a0f00e 	mov	pc, lr
+
+a030bfbc <Ldiv0>:
+a030bfbc:	e52de004 	str	lr, [sp, -#4]!
+a030bfc0:	eb000031 	bl	a030c08c <__div0>
+a030bfc4:	e3a00000 	mov	r0, #0	; 0x0
+a030bfc8:	e8bd8000 	ldmia	sp!, {pc}
+
+a030bfcc <__umodsi3>:
+a030bfcc:	e3510000 	cmp	r1, #0	; 0x0
+a030bfd0:	0a000029 	beq	a030c07c <Ldiv0>
+a030bfd4:	e3510001 	cmp	r1, #1	; 0x1
+a030bfd8:	11500001 	cmpne	r0, r1
+a030bfdc:	03a00000 	moveq	r0, #0	; 0x0
+a030bfe0:	31a0f00e 	movcc	pc, lr
+a030bfe4:	e3a03001 	mov	r3, #1	; 0x1
+
+a030bfe8 <Loop1>:
+a030bfe8:	e3510201 	cmp	r1, #268435456	; 0x10000000
+a030bfec:	31510000 	cmpcc	r1, r0
+a030bff0:	31a01201 	movcc	r1, r1, lsl #4
+a030bff4:	31a03203 	movcc	r3, r3, lsl #4
+a030bff8:	3afffffa 	bcc	a030bfe8 <Loop1>
+
+a030bffc <Lbignum>:
+a030bffc:	e3510102 	cmp	r1, #-2147483648	; 0x80000000
+a030c000:	31510000 	cmpcc	r1, r0
+a030c004:	31a01081 	movcc	r1, r1, lsl #1
+a030c008:	31a03083 	movcc	r3, r3, lsl #1
+a030c00c:	3afffffa 	bcc	a030bffc <Lbignum>
+
+a030c010 <Loop3>:
+a030c010:	e3a02000 	mov	r2, #0	; 0x0
+a030c014:	e1500001 	cmp	r0, r1
+a030c018:	20400001 	subcs	r0, r0, r1
+a030c01c:	e15000a1 	cmp	r0, r1, lsr #1
+a030c020:	204000a1 	subcs	r0, r0, r1, lsr #1
+a030c024:	218220e3 	orrcs	r2, r2, r3, ror #1
+a030c028:	e1500121 	cmp	r0, r1, lsr #2
+a030c02c:	20400121 	subcs	r0, r0, r1, lsr #2
+a030c030:	21822163 	orrcs	r2, r2, r3, ror #2
+a030c034:	e15001a1 	cmp	r0, r1, lsr #3
+a030c038:	204001a1 	subcs	r0, r0, r1, lsr #3
+a030c03c:	218221e3 	orrcs	r2, r2, r3, ror #3
+a030c040:	e1a0c003 	mov	ip, r3
+a030c044:	e3500000 	cmp	r0, #0	; 0x0
+a030c048:	11b03223 	movnes	r3, r3, lsr #4
+a030c04c:	11a01221 	movne	r1, r1, lsr #4
+a030c050:	1affffee 	bne	a030c010 <Loop3>
+
+a030c054 <Lfixup_dividend>:
+a030c054:	e212220e 	ands	r2, r2, #-536870912	; 0xe0000000
+a030c058:	131c0007 	tstne	ip, #7	; 0x7
+a030c05c:	0a000005 	beq	a030c078 <Lgot_result>
+a030c060:	e11201ec 	tst	r2, ip, ror #3
+a030c064:	108001a1 	addne	r0, r0, r1, lsr #3
+a030c068:	e112016c 	tst	r2, ip, ror #2
+a030c06c:	10800121 	addne	r0, r0, r1, lsr #2
+a030c070:	e11200ec 	tst	r2, ip, ror #1
+a030c074:	108000a1 	addne	r0, r0, r1, lsr #1
+
+a030c078 <Lgot_result>:
+a030c078:	e1a0f00e 	mov	pc, lr
+
+a030c07c <Ldiv0>:
+a030c07c:	e52de004 	str	lr, [sp, -#4]!
+a030c080:	eb000001 	bl	a030c08c <__div0>
+a030c084:	e3a00000 	mov	r0, #0	; 0x0
+a030c088:	e8bd8000 	ldmia	sp!, {pc}
+
+a030c08c <__div0>:
+a030c08c:	e92d4002 	stmdb	sp!, {r1, lr}
+a030c090:	ef900014 	swi	0x00900014
+a030c094:	e3700ffa 	cmn	r0, #1000	; 0x3e8
+a030c098:	28bd8002 	ldmcsia	sp!, {r1, pc}
+a030c09c:	e3a01008 	mov	r1, #8	; 0x8
+a030c0a0:	ef900025 	swi	0x00900025
+a030c0a4:	e8bd8002 	ldmia	sp!, {r1, pc}
+Disassembly of section .glue_7:
+Disassembly of section .glue_7t:
+Disassembly of section .rodata:
+
+a030c0a8 <__rodata_start>:
+a030c0a8:	65736572 	ldrvsb	r6, [r3, -#1394]!
+a030c0ac:	00000074 	andeq	r0, r0, r4, ror r0
+a030c0b0:	6f626572 	swivs	0x00626572
+a030c0b4:	0000746f 	andeq	r7, r0, pc, ror #8
+a030c0b8:	6f676f62 	swivs	0x00676f62
+a030c0bc:	7370696d 	cmnvc	r0, #1785856	; 0x1b4000
+a030c0c0:	00000000 	andeq	r0, r0, r0
+a030c0c4:	6c6c6163 	stfvse	f6, [ip], -#396
+a030c0c8:	00000000 	andeq	r0, r0, r0
+a030c0cc:	62676863 	rsbvs	r6, r7, #6488064	; 0x630000
+a030c0d0:	00007469 	andeq	r7, r0, r9, ror #8
+a030c0d4:	6d6d7564 	cfstr64vs	mvdx7, [sp, -#400]!
+a030c0d8:	00000079 	andeq	r0, r0, r9, ror r0
+a030c0dc:	706d7564 	rsbvc	r7, sp, r4, ror #10
+a030c0e0:	00000000 	andeq	r0, r0, r0
+a030c0e4:	6335646d 	teqvs	r5, #1828716544	; 0x6d000000
+a030c0e8:	00006b68 	andeq	r6, r0, r8, ror #22
+a030c0ec:	636d656d 	cmnvs	sp, #457179136	; 0x1b400000
+a030c0f0:	00007970 	andeq	r7, r0, r0, ror r9
+a030c0f4:	656b6f70 	strvsb	r6, [fp, -#3952]!
+a030c0f8:	00000000 	andeq	r0, r0, r0
+a030c0fc:	6b656570 	blvs	a1c656c4 <__bss_end+0x19532c0>
+a030c100:	00000000 	andeq	r0, r0, r0
+a030c104:	776f6478 	undefined
+a030c108:	616f6c6e 	cmnvs	pc, lr, ror #24
+a030c10c:	00000064 	andeq	r0, r0, r4, rrx
+a030c110:	73616c46 	cmnvc	r1, #17920	; 0x4600
+a030c114:	616d2068 	cmnvs	sp, r8, rrx
+a030c118:	000a3a70 	andeq	r3, sl, r0, ror sl
+a030c11c:	000a6425 	andeq	r6, sl, r5, lsr #8
+a030c120:	696e490a 	stmvsdb	lr!, {r1, r3, r8, fp, lr}^
+a030c124:	6c616974 	stcvsl	9, cr6, [r1], -#464
+a030c128:	6e697a69 	fnmulsvs	s15, s18, s19
+a030c12c:	6c462067 	mcrrvs	0, 6, r2, r6, cr7
+a030c130:	0a687361 	beq	a1d28ebc <__bss_end+0x1a16ab8>
+a030c134:	00000000 	andeq	r0, r0, r0
+a030c138:	65646e75 	strvsb	r6, [r4, -#3701]!
+a030c13c:	656e6966 	strvsb	r6, [lr, -#2406]!
+a030c140:	6c662064 	stcvsl	0, cr2, [r6], -#400
+a030c144:	5f687361 	swipl	0x00687361
+a030c148:	63736564 	cmnvs	r3, #419430400	; 0x19000000
+a030c14c:	74706972 	ldrvcbt	r6, [r0], -#2418
+a030c150:	0a73726f 	beq	a1fe8b14 <__bss_end+0x1cd6710>
+a030c154:	00000000 	andeq	r0, r0, r0
+a030c158:	65646e75 	strvsb	r6, [r4, -#3701]!
+a030c15c:	656e6966 	strvsb	r6, [lr, -#2406]!
+a030c160:	6c662064 	stcvsl	0, cr2, [r6], -#400
+a030c164:	5f687361 	swipl	0x00687361
+a030c168:	76697264 	strvcbt	r7, [r9], -r4, ror #4
+a030c16c:	000a7265 	andeq	r7, sl, r5, ror #4
+a030c170:	76697264 	strvcbt	r7, [r9], -r4, ror #4
+a030c174:	64207265 	strvst	r7, [r0], -#613
+a030c178:	2073656f 	rsbcss	r6, r3, pc, ror #10
+a030c17c:	20746f6e 	rsbcss	r6, r4, lr, ror #30
+a030c180:	70707573 	rsbvcs	r7, r0, r3, ror r5
+a030c184:	2074726f 	rsbcss	r7, r4, pc, ror #4
+a030c188:	72657571 	rsbvc	r7, r5, #473956352	; 0x1c400000
+a030c18c:	65645f79 	strvsb	r5, [r4, -#3961]!
+a030c190:	69726373 	ldmvsdb	r2!, {r0, r1, r4, r5, r6, r8, r9, sp, lr}^
+a030c194:	726f7470 	rsbvc	r7, pc, #1879048192	; 0x70000000
+a030c198:	00000a73 	andeq	r0, r0, r3, ror sl
+a030c19c:	76697264 	strvcbt	r7, [r9], -r4, ror #4
+a030c1a0:	66207265 	strvst	r7, [r0], -r5, ror #4
+a030c1a4:	656c6961 	strvsb	r6, [ip, -#2401]!
+a030c1a8:	6f742064 	swivs	0x00742064
+a030c1ac:	65757120 	ldrvsb	r7, [r5, -#288]!
+a030c1b0:	66207972 	undefined
+a030c1b4:	6873616c 	ldmvsda	r3!, {r2, r3, r5, r6, r8, sp, lr}^
+a030c1b8:	726f6620 	rsbvc	r6, pc, #33554432	; 0x2000000
+a030c1bc:	73656420 	cmnvc	r5, #536870912	; 0x20000000
+a030c1c0:	70697263 	rsbvc	r7, r9, r3, ror #4
+a030c1c4:	73726f74 	cmnvc	r2, #464	; 0x1d0
+a030c1c8:	0000000a 	andeq	r0, r0, sl
+a030c1cc:	78206925 	stmvcda	r0!, {r0, r2, r5, r8, fp, sp, lr}
+a030c1d0:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c1d4:	2c783830 	ldccsl	8, cr3, [r8], -#192
+a030c1d8:	00000020 	andeq	r0, r0, r0, lsr #32
+a030c1dc:	20746f6e 	rsbcss	r6, r4, lr, ror #30
+a030c1e0:	00000000 	andeq	r0, r0, r0
+a030c1e4:	6b636f6c 	blvs	a1be7f9c <__bss_end+0x18d5b98>
+a030c1e8:	656c6261 	strvsb	r6, [ip, -#609]!
+a030c1ec:	0000000a 	andeq	r0, r0, sl
+a030c1f0:	20746f6e 	rsbcss	r6, r4, lr, ror #30
+a030c1f4:	756f6e65 	strvcb	r6, [pc, #-3685]!	; a030b397 <strncmp+0x9f>
+a030c1f8:	66206867 	strvst	r6, [r0], -r7, ror #16
+a030c1fc:	6873616c 	ldmvsda	r3!, {r2, r3, r5, r6, r8, sp, lr}^
+a030c200:	6f6c625f 	swivs	0x006c625f
+a030c204:	0a736b63 	beq	a1fe6f98 <__bss_end+0x1cd4b94>
+a030c208:	00000000 	andeq	r0, r0, r0
+a030c20c:	73617265 	cmnvc	r1, #1342177286	; 0x50000006
+a030c210:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030c214:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030c218:	28207838 	stmcsda	r0!, {r3, r4, r5, fp, ip, sp, lr}
+a030c21c:	20296425 	eorcs	r6, r9, r5, lsr #8
+a030c220:	64726f77 	ldrvsbt	r6, [r2], -#3959
+a030c224:	74612073 	strvcbt	r2, [r1], -#115
+a030c228:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c22c:	0a783830 	beq	a211a2f4 <__bss_end+0x1e07ef0>
+a030c230:	00000000 	andeq	r0, r0, r0
+a030c234:	6f6c6e75 	swivs	0x006c6e75
+a030c238:	6e696b63 	cdpvs	11, 6, cr6, cr9, cr3, {3}
+a030c23c:	69642067 	stmvsdb	r4!, {r0, r1, r2, r5, r6, sp}^
+a030c240:	20797472 	rsbcss	r7, r9, r2, ror r4
+a030c244:	636f6c62 	cmnvs	pc, #25088	; 0x6200
+a030c248:	7461206b 	strvcbt	r2, [r1], -#107
+a030c24c:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c250:	0a783830 	beq	a211a318 <__bss_end+0x1e07f14>
+a030c254:	00000000 	andeq	r0, r0, r0
+a030c258:	73617265 	cmnvc	r1, #1342177286	; 0x50000006
+a030c25c:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030c260:	74726964 	ldrvcbt	r6, [r2], -#2404
+a030c264:	6c622079 	stcvsl	0, cr2, [r2], -#484
+a030c268:	206b636f 	rsbcs	r6, fp, pc, ror #6
+a030c26c:	30207461 	eorcc	r7, r0, r1, ror #8
+a030c270:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c274:	00000a78 	andeq	r0, r0, r8, ror sl
+a030c278:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030c27c:	72652068 	rsbvc	r2, r5, #104	; 0x68
+a030c280:	20657361 	rsbcs	r7, r5, r1, ror #6
+a030c284:	6f727265 	swivs	0x00727265
+a030c288:	74612072 	strvcbt	r2, [r1], -#114
+a030c28c:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c290:	0a783830 	beq	a211a358 <__bss_end+0x1e07f54>
+a030c294:	00000000 	andeq	r0, r0, r0
+a030c298:	2023200a 	eorcs	r2, r3, sl
+a030c29c:	636f6c42 	cmnvs	pc, #16896	; 0x4200
+a030c2a0:	6620736b 	strvst	r7, [r0], -fp, ror #6
+a030c2a4:	646e756f 	strvsbt	r7, [lr], -#1391
+a030c2a8:	25203d20 	strcs	r3, [r0, -#3360]!
+a030c2ac:	2f000a64 	swics	0x00000a64
+a030c2b0:	007c5c2d 	rsbeqs	r5, ip, sp, lsr #24
+a030c2b4:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030c2b8:	676e6968 	strvsb	r6, [lr, -r8, ror #18]!
+a030c2bc:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c2c0:	20783830 	rsbcss	r3, r8, r0, lsr r8
+a030c2c4:	29642528 	stmcsdb	r4!, {r3, r5, r8, sl, sp}^
+a030c2c8:	726f7720 	rsbvc	r7, pc, #8388608	; 0x800000
+a030c2cc:	66207364 	strvst	r7, [r0], -r4, ror #6
+a030c2d0:	206d6f72 	rsbcs	r6, sp, r2, ror pc
+a030c2d4:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030c2d8:	74207838 	strvct	r7, [r0], -#2104
+a030c2dc:	7830206f 	ldmvcda	r0!, {r0, r1, r2, r3, r5, r6, sp}
+a030c2e0:	78383025 	ldmvcda	r8!, {r0, r2, r5, ip, sp}
+a030c2e4:	0000000a 	andeq	r0, r0, sl
+a030c2e8:	73617265 	cmnvc	r1, #1342177286	; 0x50000006
+a030c2ec:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030c2f0:	30207461 	eorcc	r7, r0, r1, ror #8
+a030c2f4:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c2f8:	2e2e2e78 	mcrcs	14, 1, r2, cr14, cr8, {3}
+a030c2fc:	00000000 	andeq	r0, r0, r0
+a030c300:	72726520 	rsbvcs	r6, r2, #134217728	; 0x8000000
+a030c304:	000a726f 	andeq	r7, sl, pc, ror #4
+a030c308:	61637320 	cmnvs	r3, r0, lsr #6
+a030c30c:	6e696e6e 	cdpvs	14, 6, cr6, cr9, cr14, {3}
+a030c310:	6f642067 	swivs	0x00642067
+a030c314:	2e2e6e77 	mcrcs	14, 1, r6, cr14, cr7, {3}
+a030c318:	0000002e 	andeq	r0, r0, lr, lsr #32
+a030c31c:	73657220 	cmnvc	r5, #2	; 0x2
+a030c320:	20656d75 	rsbcs	r6, r5, r5, ror sp
+a030c324:	74697277 	strvcbt	r7, [r9], -#631
+a030c328:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030c32c:	30207461 	eorcc	r7, r0, r1, ror #8
+a030c330:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c334:	00000a78 	andeq	r0, r0, r8, ror sl
+a030c338:	206f6f74 	rsbcs	r6, pc, r4, ror pc
+a030c33c:	796e616d 	stmvcdb	lr!, {r0, r2, r3, r5, r6, r8, sp, lr}^
+a030c340:	616c6620 	cmnvs	ip, r0, lsr #12
+a030c344:	65206873 	strvs	r6, [r0, -#2163]!
+a030c348:	726f7272 	rsbvc	r7, pc, #536870919	; 0x20000007
+a030c34c:	70202c73 	eorvc	r2, r0, r3, ror ip
+a030c350:	61626f72 	cmnvs	r2, r2, ror pc
+a030c354:	20796c62 	rsbcss	r6, r9, r2, ror #24
+a030c358:	64726168 	ldrvsbt	r6, [r2], -#360
+a030c35c:	65726177 	ldrvsb	r6, [r2, -#375]!
+a030c360:	72726520 	rsbvcs	r6, r2, #134217728	; 0x8000000
+a030c364:	000a726f 	andeq	r7, sl, pc, ror #4
+a030c368:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030c36c:	00000000 	andeq	r0, r0, r0
+a030c370:	61726170 	cmnvs	r2, r0, ror r1
+a030c374:	0000006d 	andeq	r0, r0, sp, rrx
+a030c378:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030c37c:	00006c65 	andeq	r6, r0, r5, ror #24
+a030c380:	646d6172 	strvsbt	r6, [sp], -#370
+a030c384:	006b7369 	rsbeq	r7, fp, r9, ror #6
+a030c388:	6e207325 	cdpvs	3, 2, cr7, cr0, cr5, {1}
+a030c38c:	6420746f 	strvst	r7, [r0], -#1135
+a030c390:	6c6e776f 	stcvsl	7, cr7, [lr], -#444
+a030c394:	6564616f 	strvsb	r6, [r4, -#367]!
+a030c398:	00000a64 	andeq	r0, r0, r4, ror #20
+a030c39c:	67616d69 	strvsb	r6, [r1, -r9, ror #26]!
+a030c3a0:	6f742065 	swivs	0x00742065
+a030c3a4:	616c206f 	cmnvs	ip, pc, rrx
+a030c3a8:	20656772 	rsbcs	r6, r5, r2, ror r7
+a030c3ac:	20726f66 	rsbcss	r6, r2, r6, ror #30
+a030c3b0:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030c3b4:	30203a68 	eorcc	r3, r0, r8, ror #20
+a030c3b8:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c3bc:	203e2078 	eorcss	r2, lr, r8, ror r0
+a030c3c0:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030c3c4:	000a7838 	andeq	r7, sl, r8, lsr r8
+a030c3c8:	69766153 	ldmvsdb	r6!, {r0, r1, r4, r6, r8, sp, lr}^
+a030c3cc:	2520676e 	strcs	r6, [r0, -#1902]!
+a030c3d0:	6f742073 	swivs	0x00742073
+a030c3d4:	616c6620 	cmnvs	ip, r0, lsr #12
+a030c3d8:	000a6873 	andeq	r6, sl, r3, ror r8
+a030c3dc:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030c3e0:	00000068 	andeq	r0, r0, r8, rrx
+a030c3e4:	6b636f6c 	blvs	a1be819c <__bss_end+0x18d5d98>
+a030c3e8:	00000000 	andeq	r0, r0, r0
+a030c3ec:	6f6c6e75 	swivs	0x006c6e75
+a030c3f0:	00006b63 	andeq	r6, r0, r3, ror #22
+a030c3f4:	73617265 	cmnvc	r1, #1342177286	; 0x50000006
+a030c3f8:	00000065 	andeq	r0, r0, r5, rrx
+a030c3fc:	6174530a 	cmnvs	r4, sl, lsl #6
+a030c400:	6e697472 	mcrvs	4, 3, r7, cr9, cr2, {3}
+a030c404:	656b2067 	strvsb	r2, [fp, -#103]!
+a030c408:	6c656e72 	stcvsl	14, cr6, [r5], -#456
+a030c40c:	2e2e2e20 	cdpcs	14, 2, cr2, cr14, cr0, {1}
+a030c410:	00000a0a 	andeq	r0, r0, sl, lsl #20
+a030c414:	78654e0a 	stmvcda	r5!, {r1, r3, r9, sl, fp, lr}^
+a030c418:	74732074 	ldrvcbt	r2, [r3], -#116
+a030c41c:	69207065 	stmvsdb	r0!, {r0, r2, r5, r6, ip, sp, lr}
+a030c420:	6f742073 	swivs	0x00742073
+a030c424:	61747320 	cmnvs	r4, r0, lsr #6
+a030c428:	74207472 	strvct	r7, [r0], -#1138
+a030c42c:	6b206568 	blvs	a0b259d4 <__bss_end+0x8135d0>
+a030c430:	656e7265 	strvsb	r7, [lr, -#613]!
+a030c434:	00000a6c 	andeq	r0, r0, ip, ror #20
+a030c438:	2c796548 	cfldr64cs	mvdx6, [r9], -#288
+a030c43c:	65687420 	strvsb	r7, [r8, -#1056]!
+a030c440:	72656b20 	rsbvc	r6, r5, #32768	; 0x8000
+a030c444:	206c656e 	rsbcs	r6, ip, lr, ror #10
+a030c448:	75746572 	ldrvcb	r6, [r4, -#1394]!
+a030c44c:	64656e72 	strvsbt	r6, [r5], -#3698
+a030c450:	68542021 	ldmvsda	r4, {r0, r5, sp}^
+a030c454:	73207369 	teqvc	r0, #-1543503871	; 0xa4000001
+a030c458:	6c756f68 	ldcvsl	15, cr6, [r5], -#416
+a030c45c:	6f6e2064 	swivs	0x006e2064
+a030c460:	61682074 	cmnvs	r8, r4, ror r0
+a030c464:	6e657070 	mcrvs	0, 3, r7, cr5, cr0, {3}
+a030c468:	00000a2e 	andeq	r0, r0, lr, lsr #20
+a030c46c:	746f6f62 	strvcbt	r6, [pc], #3938	; a030c474 <__text_end+0x3cc>
+a030c470:	00000000 	andeq	r0, r0, r0
+a030c474:	6e72654b 	cdpvs	5, 7, cr6, cr2, cr11, {2}
+a030c478:	40206c65 	eormi	r6, r0, r5, ror #24
+a030c47c:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c480:	20583830 	subcss	r3, r8, r0, lsr r8
+a030c484:	0a776f4e 	beq	a20e81c4 <__bss_end+0x1dd5dc0>
+a030c488:	00000000 	andeq	r0, r0, r0
+a030c48c:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030c490:	00006c65 	andeq	r6, r0, r5, ror #24
+a030c494:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030c498:	72657620 	rsbvc	r7, r5, #33554432	; 0x2000000
+a030c49c:	6e6f6973 	mcrvs	9, 3, r6, cr15, cr3, {3}
+a030c4a0:	302e3220 	eorcc	r3, lr, r0, lsr #4
+a030c4a4:	702d352e 	eorvc	r3, sp, lr, lsr #10
+a030c4a8:	20336572 	eorcss	r6, r3, r2, ror r5
+a030c4ac:	20726f66 	rsbcss	r6, r2, r6, ror #30
+a030c4b0:	65746e49 	ldrvsb	r6, [r4, -#3657]!
+a030c4b4:	4348206c 	cmpmi	r8, #108	; 0x6c
+a030c4b8:	42424444 	submi	r4, r2, #1140850688	; 0x44000000
+a030c4bc:	20304156 	eorcss	r4, r0, r6, asr r1
+a030c4c0:	69614d28 	stmvsdb	r1!, {r3, r5, r8, sl, fp, lr}^
+a030c4c4:	6f74736e 	swivs	0x0074736e
+a030c4c8:	0a29656e 	beq	a0d65a88 <__bss_end+0xa53684>
+a030c4cc:	00000000 	andeq	r0, r0, r0
+a030c4d0:	7265410a 	rsbvc	r4, r5, #-2147483646	; 0x80000002
+a030c4d4:	78696e6f 	stmvcda	r9!, {r0, r1, r2, r3, r5, r6, r9, sl, fp, sp, lr}^
+a030c4d8:	72655620 	rsbvc	r5, r5, #33554432	; 0x2000000
+a030c4dc:	6e6f6973 	mcrvs	9, 3, r6, cr15, cr3, {3}
+a030c4e0:	332e3120 	teqcc	lr, #8	; 0x8
+a030c4e4:	00000a0a 	andeq	r0, r0, sl, lsl #20
+a030c4e8:	6f437325 	swivs	0x00437325
+a030c4ec:	69727970 	ldmvsdb	r2!, {r4, r5, r6, r8, fp, ip, sp, lr}^
+a030c4f0:	20746867 	rsbcss	r6, r4, r7, ror #16
+a030c4f4:	20294328 	eorcs	r4, r9, r8, lsr #6
+a030c4f8:	39393931 	ldmccdb	r9!, {r0, r4, r5, r8, fp, ip, sp}
+a030c4fc:	30303220 	eorccs	r3, r0, r0, lsr #4
+a030c500:	30322030 	eorccs	r2, r2, r0, lsr r0
+a030c504:	32203130 	eorcc	r3, r0, #12	; 0xc
+a030c508:	20323030 	eorcss	r3, r2, r0, lsr r0
+a030c50c:	33303032 	teqcc	r0, #50	; 0x32
+a030c510:	6e614a20 	fmulsvs	s9, s2, s1
+a030c514:	7265442d 	rsbvc	r4, r5, #754974720	; 0x2d000000
+a030c518:	6142206b 	cmpvs	r2, fp, rrx
+a030c51c:	72656b6b 	rsbvc	r6, r5, #109568	; 0x1ac00
+a030c520:	646e6120 	strvsbt	r6, [lr], -#288
+a030c524:	69724520 	ldmvsdb	r2!, {r5, r8, sl, lr}^
+a030c528:	6f4d206b 	swivs	0x004d206b
+a030c52c:	000a7775 	andeq	r7, sl, r5, ror r7
+a030c530:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030c534:	6d6f6320 	stcvsl	3, cr6, [pc, -#128]!
+a030c538:	77207365 	strvc	r7, [r0, -r5, ror #6]!
+a030c53c:	20687469 	rsbcs	r7, r8, r9, ror #8
+a030c540:	4f534241 	swimi	0x00534241
+a030c544:	4554554c 	ldrmib	r5, [r4, -#1356]
+a030c548:	4e20594c 	cdpmi	9, 2, cr5, cr0, cr12, {2}
+a030c54c:	4157204f 	cmpmi	r7, pc, asr #32
+a030c550:	4e415252 	mcrmi	2, 2, r5, cr1, cr2, {2}
+a030c554:	203b5954 	eorcss	r5, fp, r4, asr r9
+a030c558:	64616572 	strvsbt	r6, [r1], -#1394
+a030c55c:	65687420 	strvsb	r7, [r8, -#1056]!
+a030c560:	554e4720 	strplb	r4, [lr, -#1824]
+a030c564:	4c504720 	mrrcmi	7, 2, r4, r0, cr0
+a030c568:	726f6620 	rsbvc	r6, pc, #33554432	; 0x2000000
+a030c56c:	74656420 	strvcbt	r6, [r5], -#1056
+a030c570:	736c6961 	cmnvc	ip, #1589248	; 0x184000
+a030c574:	00000a2e 	andeq	r0, r0, lr, lsr #20
+a030c578:	73696854 	cmnvc	r9, #5505024	; 0x540000
+a030c57c:	20736920 	rsbcss	r6, r3, r0, lsr #18
+a030c580:	65657266 	strvsb	r7, [r5, -#614]!
+a030c584:	666f7320 	strvsbt	r7, [pc], -r0, lsr #6
+a030c588:	72617774 	rsbvc	r7, r1, #30408704	; 0x1d00000
+a030c58c:	61202c65 	teqvs	r0, r5, ror #24
+a030c590:	7920646e 	stmvcdb	r0!, {r1, r2, r3, r5, r6, sl, sp, lr}
+a030c594:	6120756f 	teqvs	r0, pc, ror #10
+a030c598:	77206572 	undefined
+a030c59c:	6f636c65 	swivs	0x00636c65
+a030c5a0:	7420656d 	strvct	r6, [r0], -#1389
+a030c5a4:	6572206f 	ldrvsb	r2, [r2, -#111]!
+a030c5a8:	74736964 	ldrvcbt	r6, [r3], -#2404
+a030c5ac:	75626972 	strvcb	r6, [r2, -#2418]!
+a030c5b0:	69206574 	stmvsdb	r0!, {r2, r4, r5, r6, r8, sl, sp, lr}
+a030c5b4:	00000a74 	andeq	r0, r0, r4, ror sl
+a030c5b8:	65646e75 	strvsb	r6, [r4, -#3701]!
+a030c5bc:	65632072 	strvsb	r2, [r3, -#114]!
+a030c5c0:	69617472 	stmvsdb	r1!, {r1, r4, r5, r6, sl, ip, sp, lr}^
+a030c5c4:	6f63206e 	swivs	0x0063206e
+a030c5c8:	7469646e 	strvcbt	r6, [r9], -#1134
+a030c5cc:	736e6f69 	cmnvc	lr, #420	; 0x1a4
+a030c5d0:	6572203b 	ldrvsb	r2, [r2, -#59]!
+a030c5d4:	74206461 	strvct	r6, [r0], -#1121
+a030c5d8:	47206568 	strmi	r6, [r0, -r8, ror #10]!
+a030c5dc:	4720554e 	strmi	r5, [r0, -lr, asr #10]!
+a030c5e0:	66204c50 	undefined
+a030c5e4:	6420726f 	strvst	r7, [r0], -#623
+a030c5e8:	69617465 	stmvsdb	r1!, {r0, r2, r5, r6, sl, ip, sp, lr}^
+a030c5ec:	0a2e736c 	beq	a0ea93a4 <__bss_end+0xb96fa0>
+a030c5f0:	00000000 	andeq	r0, r0, r0
+a030c5f4:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030c5f8:	00000000 	andeq	r0, r0, r0
+a030c5fc:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030c600:	00006c65 	andeq	r6, r0, r5, ror #24
+a030c604:	646d6172 	strvsbt	r6, [sp], -#370
+a030c608:	006b7369 	rsbeq	r7, fp, r9, ror #6
+a030c60c:	6f747541 	swivs	0x00747541
+a030c610:	746f6f62 	strvcbt	r6, [pc], #3938	; a030c618 <__text_end+0x570>
+a030c614:	69252820 	stmvsdb	r5!, {r5, fp, sp}
+a030c618:	63657320 	cmnvs	r5, #-2147483648	; 0x80000000
+a030c61c:	73646e6f 	cmnvc	r4, #1776	; 0x6f0
+a030c620:	6e692029 	cdpvs	0, 6, cr2, cr9, cr9, {1}
+a030c624:	6f727020 	swivs	0x00727020
+a030c628:	73657267 	cmnvc	r5, #1879048198	; 0x70000006
+a030c62c:	70202c73 	eorvc	r2, r0, r3, ror ip
+a030c630:	73736572 	cmnvc	r3, #478150656	; 0x1c800000
+a030c634:	796e6120 	stmvcdb	lr!, {r5, r8, sp, lr}^
+a030c638:	79656b20 	stmvcdb	r5!, {r5, r8, r9, fp, sp, lr}^
+a030c63c:	206f7420 	rsbcs	r7, pc, r0, lsr #8
+a030c640:	706f7473 	rsbvc	r7, pc, r3, ror r4
+a030c644:	00000020 	andeq	r0, r0, r0, lsr #32
+a030c648:	746f6f62 	strvcbt	r6, [pc], #3938	; a030c650 <__text_end+0x5a8>
+a030c64c:	00000000 	andeq	r0, r0, r0
+a030c650:	7475410a 	ldrvcbt	r4, [r5], -#266
+a030c654:	6f6f626f 	swivs	0x006f626f
+a030c658:	62612074 	rsbvs	r2, r1, #116	; 0x74
+a030c65c:	6574726f 	ldrvsb	r7, [r4, -#623]!
+a030c660:	00000a64 	andeq	r0, r0, r4, ror #20
+a030c664:	65707954 	ldrvsb	r7, [r0, -#2388]!
+a030c668:	65682220 	strvsb	r2, [r8, -#544]!
+a030c66c:	2022706c 	eorcs	r7, r2, ip, rrx
+a030c670:	67206f74 	undefined
+a030c674:	61207465 	teqvs	r0, r5, ror #8
+a030c678:	73696c20 	cmnvc	r9, #8192	; 0x2000
+a030c67c:	666f2074 	undefined
+a030c680:	6d6f6320 	stcvsl	3, cr6, [pc, -#128]!
+a030c684:	646e616d 	strvsbt	r6, [lr], -#365
+a030c688:	00000a73 	andeq	r0, r0, r3, ror sl
+a030c68c:	6e776f44 	cdpvs	15, 7, cr6, cr7, cr4, {2}
+a030c690:	64616f6c 	strvsbt	r6, [r1], -#3948
+a030c694:	65707320 	ldrvsb	r7, [r0, -#800]!
+a030c698:	20206465 	eorcs	r6, r0, r5, ror #8
+a030c69c:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c6a0:	0000203a 	andeq	r2, r0, sl, lsr r0
+a030c6a4:	75616220 	strvcb	r6, [r1, -#544]!
+a030c6a8:	00000a64 	andeq	r0, r0, r4, ror #20
+a030c6ac:	6d726554 	cfldr64vs	mvdx6, [r2, -#336]!
+a030c6b0:	6c616e69 	stcvsl	14, cr6, [r1], -#420
+a030c6b4:	65707320 	ldrvsb	r7, [r0, -#800]!
+a030c6b8:	20206465 	eorcs	r6, r0, r5, ror #8
+a030c6bc:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c6c0:	0000203a 	andeq	r2, r0, sl, lsr r0
+a030c6c4:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030c6c8:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c6cc:	25783028 	ldrcsb	r3, [r8, -#40]!
+a030c6d0:	29783830 	ldmcsdb	r8!, {r4, r5, fp, ip, sp}^
+a030c6d4:	0000203a 	andeq	r2, r0, sl, lsr r0
+a030c6d8:	6d6f7266 	sfmvs	f7, 2, [pc, -#408]!
+a030c6dc:	616c6620 	cmnvs	ip, r0, lsr #12
+a030c6e0:	000a6873 	andeq	r6, sl, r3, ror r8
+a030c6e4:	6e776f64 	cdpvs	15, 7, cr6, cr7, cr4, {3}
+a030c6e8:	64616f6c 	strvsbt	r6, [r1], -#3948
+a030c6ec:	61206465 	teqvs	r0, r5, ror #8
+a030c6f0:	78302074 	ldmvcda	r0!, {r2, r4, r5, r6, sp}
+a030c6f4:	78383025 	ldmvcda	r8!, {r0, r2, r5, ip, sp}
+a030c6f8:	6925202c 	stmvsdb	r5!, {r2, r3, r5, sp}
+a030c6fc:	74796220 	ldrvcbt	r6, [r9], -#544
+a030c700:	000a7365 	andeq	r7, sl, r5, ror #6
+a030c704:	61726170 	cmnvs	r2, r0, ror r1
+a030c708:	2820206d 	stmcsda	r0!, {r0, r2, r3, r5, r6, sp}
+a030c70c:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030c710:	3a297838 	bcc	a0d6a7f8 <__bss_end+0xa583f4>
+a030c714:	00000020 	andeq	r0, r0, r0, lsr #32
+a030c718:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030c71c:	20206c65 	eorcs	r6, r0, r5, ror #24
+a030c720:	25783028 	ldrcsb	r3, [r8, -#40]!
+a030c724:	29783830 	ldmcsdb	r8!, {r4, r5, fp, ip, sp}^
+a030c728:	0000203a 	andeq	r2, r0, sl, lsr r0
+a030c72c:	646d6172 	strvsbt	r6, [sp], -#370
+a030c730:	206b7369 	rsbcs	r7, fp, r9, ror #6
+a030c734:	25783028 	ldrcsb	r3, [r8, -#40]!
+a030c738:	29783830 	ldmcsdb	r8!, {r4, r5, fp, ip, sp}^
+a030c73c:	0000203a 	andeq	r2, r0, sl, lsr r0
+a030c740:	74617473 	strvcbt	r7, [r1], -#1139
+a030c744:	00007375 	andeq	r7, r0, r5, ror r3
+a030c748:	6f6c6572 	swivs	0x006c6572
+a030c74c:	00006461 	andeq	r6, r0, r1, ror #8
+a030c750:	61726170 	cmnvs	r2, r0, ror r1
+a030c754:	0000006d 	andeq	r0, r0, sp, rrx
+a030c758:	6f6d654d 	swivs	0x006d654d
+a030c75c:	6d207972 	stcvs	9, cr7, [r0, -#456]!
+a030c760:	0a3a7061 	beq	a11a88ec <__bss_end+0xe964e8>
+a030c764:	00000000 	andeq	r0, r0, r0
+a030c768:	78302020 	ldmvcda	r0!, {r5, sp}
+a030c76c:	78383025 	ldmvcda	r8!, {r0, r2, r5, ip, sp}
+a030c770:	30204020 	eorcc	r4, r0, r0, lsr #32
+a030c774:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c778:	25282078 	strcs	r2, [r8, -#120]!
+a030c77c:	424d2064 	submi	r2, sp, #100	; 0x64
+a030c780:	00000a29 	andeq	r0, r0, r9, lsr #20
+a030c784:	6967616d 	stmvsdb	r7!, {r0, r2, r3, r5, r6, r8, sp, lr}^
+a030c788:	61662063 	cmnvs	r6, r3, rrx
+a030c78c:	64656c69 	strvsbt	r6, [r5], -#3177
+a030c790:	20746120 	rsbcss	r6, r4, r0, lsr #2
+a030c794:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030c798:	28207838 	stmcsda	r0!, {r3, r4, r5, fp, ip, sp, lr}
+a030c79c:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030c7a0:	21207838 	teqcs	r0, r8, lsr r8
+a030c7a4:	7830203d 	ldmvcda	r0!, {r0, r2, r3, r4, r5, sp}
+a030c7a8:	78383025 	ldmvcda	r8!, {r0, r2, r5, ip, sp}
+a030c7ac:	00000a29 	andeq	r0, r0, r9, lsr #20
+a030c7b0:	656d6d49 	strvsb	r6, [sp, -#3401]!
+a030c7b4:	74616964 	strvcbt	r6, [r1], -#2404
+a030c7b8:	20796c65 	rsbcss	r6, r9, r5, ror #24
+a030c7bc:	6e756f66 	cdpvs	15, 7, cr6, cr5, cr6, {3}
+a030c7c0:	6c662064 	stcvsl	0, cr2, [r6], -#400
+a030c7c4:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030c7c8:	74726170 	ldrvcbt	r6, [r2], -#368
+a030c7cc:	6f697469 	swivs	0x00697469
+a030c7d0:	6174206e 	cmnvs	r4, lr, rrx
+a030c7d4:	20656c62 	rsbcs	r6, r5, r2, ror #24
+a030c7d8:	30207461 	eorcc	r7, r0, r1, ror #8
+a030c7dc:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c7e0:	00000a78 	andeq	r0, r0, r8, ror sl
+a030c7e4:	72616553 	rsbvc	r6, r1, #348127232	; 0x14c00000
+a030c7e8:	6e696863 	cdpvs	8, 6, cr6, cr9, cr3, {3}
+a030c7ec:	6c662067 	stcvsl	0, cr2, [r6], -#412
+a030c7f0:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030c7f4:	74726170 	ldrvcbt	r6, [r2], -#368
+a030c7f8:	6f697469 	swivs	0x00697469
+a030c7fc:	6174206e 	cmnvs	r4, lr, rrx
+a030c800:	2e656c62 	cdpcs	12, 6, cr6, cr5, cr2, {3}
+a030c804:	0a202e2e 	beq	a0b180c4 <__bss_end+0x805cc0>
+a030c808:	00000000 	andeq	r0, r0, r0
+a030c80c:	73726966 	cmnvc	r2, #1671168	; 0x198000
+a030c810:	6c622074 	stcvsl	0, cr2, [r2], -#464
+a030c814:	206b636f 	rsbcs	r6, fp, pc, ror #6
+a030c818:	20746f6e 	rsbcss	r6, r4, lr, ror #30
+a030c81c:	6e756f66 	cdpvs	15, 7, cr6, cr5, cr6, {3}
+a030c820:	00000a64 	andeq	r0, r0, r4, ror #20
+a030c824:	74726150 	ldrvcbt	r6, [r2], -#336
+a030c828:	6f697469 	swivs	0x00697469
+a030c82c:	6174206e 	cmnvs	r4, lr, rrx
+a030c830:	20656c62 	rsbcs	r6, r5, r2, ror #24
+a030c834:	20726f66 	rsbcss	r6, r2, r6, ror #30
+a030c838:	6b206425 	blvs	a0b258d4 <__bss_end+0x8134d0>
+a030c83c:	6c662042 	stcvsl	0, cr2, [r6], -#264
+a030c840:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030c844:	78302040 	ldmvcda	r0!, {r6, sp}
+a030c848:	78383025 	ldmvcda	r8!, {r0, r2, r5, ip, sp}
+a030c84c:	00000a3a 	andeq	r0, r0, sl, lsr sl
+a030c850:	78302020 	ldmvcda	r0!, {r5, sp}
+a030c854:	78383025 	ldmvcda	r8!, {r0, r2, r5, ip, sp}
+a030c858:	30204020 	eorcc	r4, r0, r0, lsr #32
+a030c85c:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c860:	25282078 	strcs	r2, [r8, -#120]!
+a030c864:	426b2064 	rsbmi	r2, fp, #100	; 0x64
+a030c868:	27203a29 	strcs	r3, [r0, -r9, lsr #20]!
+a030c86c:	0a277325 	beq	a0ce9508 <__bss_end+0x9d7104>
+a030c870:	00000000 	andeq	r0, r0, r0
+a030c874:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c878:	746e6f63 	strvcbt	r6, [lr], -#3939
+a030c87c:	736e6961 	cmnvc	lr, #1589248	; 0x184000
+a030c880:	72617020 	rsbvc	r7, r1, #32	; 0x20
+a030c884:	74656d61 	strvcbt	r6, [r5], -#3425
+a030c888:	62207265 	eorvs	r7, r0, #1342177286	; 0x50000006
+a030c88c:	6b636f6c 	blvs	a1be8644 <__bss_end+0x18d6240>
+a030c890:	00000a73 	andeq	r0, r0, r3, ror sl
+a030c894:	6f747561 	swivs	0x00747561
+a030c898:	6974616d 	ldmvsdb	r4!, {r0, r2, r3, r5, r6, r8, sp, lr}^
+a030c89c:	6c6c6163 	stfvse	f6, [ip], -#396
+a030c8a0:	00002079 	andeq	r2, r0, r9, ror r0
+a030c8a4:	00000000 	andeq	r0, r0, r0
+a030c8a8:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c8ac:	6f6c7325 	swivs	0x006c7325
+a030c8b0:	61206461 	teqvs	r0, r1, ror #8
+a030c8b4:	78302074 	ldmvcda	r0!, {r2, r4, r5, r6, sp}
+a030c8b8:	78383025 	ldmvcda	r8!, {r0, r2, r5, ip, sp}
+a030c8bc:	0000000a 	andeq	r0, r0, sl
+a030c8c0:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c8c4:	72746e65 	rsbvcs	r6, r4, #1616	; 0x650
+a030c8c8:	6f702079 	swivs	0x00702079
+a030c8cc:	20746e69 	rsbcss	r6, r4, r9, ror #28
+a030c8d0:	30207461 	eorcc	r7, r0, r1, ror #8
+a030c8d4:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c8d8:	00000078 	andeq	r0, r0, r8, ror r0
+a030c8dc:	7561202c 	strvcb	r2, [r1, -#44]!
+a030c8e0:	616d6f74 	cmnvs	sp, r4, ror pc
+a030c8e4:	61636974 	cmnvs	r3, r4, ror r9
+a030c8e8:	20796c6c 	rsbcss	r6, r9, ip, ror #24
+a030c8ec:	63657865 	cmnvs	r5, #6619136	; 0x650000
+a030c8f0:	0a657475 	beq	a1c69acc <__bss_end+0x19576c8>
+a030c8f4:	00000000 	andeq	r0, r0, r0
+a030c8f8:	0000000a 	andeq	r0, r0, sl
+a030c8fc:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c900:	746e6f63 	strvcbt	r6, [lr], -#3939
+a030c904:	736e6961 	cmnvc	lr, #1589248	; 0x184000
+a030c908:	46464a20 	strmib	r4, [r6], -r0, lsr #20
+a030c90c:	000a3253 	andeq	r3, sl, r3, asr r2
+a030c910:	20202020 	eorcs	r2, r0, r0, lsr #32
+a030c914:	746e6f63 	strvcbt	r6, [lr], -#3939
+a030c918:	736e6961 	cmnvc	lr, #1589248	; 0x184000
+a030c91c:	61726320 	cmnvs	r2, r0, lsr #6
+a030c920:	0a73666d 	beq	a1fe62dc <__bss_end+0x1cd3ed8>
+a030c924:	00000000 	andeq	r0, r0, r0
+a030c928:	62617470 	rsbvs	r7, r1, #1879048192	; 0x70000000
+a030c92c:	6d20656c 	cfstr32vs	mvfx6, [r0, -#432]!
+a030c930:	63696761 	cmnvs	r9, #25427968	; 0x1840000
+a030c934:	69616620 	stmvsdb	r1!, {r5, r9, sl, sp, lr}^
+a030c938:	2064656c 	rsbcs	r6, r4, ip, ror #10
+a030c93c:	30207461 	eorcc	r7, r0, r1, ror #8
+a030c940:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c944:	00000a78 	andeq	r0, r0, r8, ror sl
+a030c948:	62617470 	rsbvs	r7, r1, #1879048192	; 0x70000000
+a030c94c:	3e2d656c 	cfsh64cc	mvdx6, mvdx13, #60
+a030c950:	7366666f 	cmnvc	r6, #116391936	; 0x6f00000
+a030c954:	3d207465 	cfstrscc	mvf7, [r0, -#404]!
+a030c958:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c95c:	0a583830 	beq	a191aa24 <__bss_end+0x1608620>
+a030c960:	00000000 	andeq	r0, r0, r0
+a030c964:	62617470 	rsbvs	r7, r1, #1879048192	; 0x70000000
+a030c968:	3e2d656c 	cfsh64cc	mvdx6, mvdx13, #60
+a030c96c:	657a6973 	ldrvsb	r6, [sl, -#2419]!
+a030c970:	30203d20 	eorcc	r3, r0, r0, lsr #26
+a030c974:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030c978:	00000a58 	andeq	r0, r0, r8, asr sl
+a030c97c:	62617470 	rsbvs	r7, r1, #1879048192	; 0x70000000
+a030c980:	6620656c 	strvst	r6, [r0], -ip, ror #10
+a030c984:	70757869 	rsbvcs	r7, r5, r9, ror #16
+a030c988:	756f6620 	strvcb	r6, [pc, #-1568]!	; a030c370 <__text_end+0x2c8>
+a030c98c:	6120646e 	teqvs	r0, lr, ror #8
+a030c990:	74696464 	strvcbt	r6, [r9], -#1124
+a030c994:	616e6f69 	cmnvs	lr, r9, ror #30
+a030c998:	6170206c 	cmnvs	r0, ip, rrx
+a030c99c:	20737472 	rsbcss	r7, r3, r2, ror r4
+a030c9a0:	65746661 	ldrvsb	r6, [r4, -#1633]!
+a030c9a4:	4c422072 	mcrrmi	0, 7, r2, r2, cr2
+a030c9a8:	505f424f 	subpls	r4, pc, pc, asr #4
+a030c9ac:	5f545241 	swipl	0x00545241
+a030c9b0:	5f5a4953 	swipl	0x005a4953
+a030c9b4:	4c4c5546 	mcrrmi	5, 4, r5, ip, cr6
+a030c9b8:	7a697320 	bvc	a1d69640 <__bss_end+0x1a5723c>
+a030c9bc:	00000a65 	andeq	r0, r0, r5, ror #20
+a030c9c0:	6e756f66 	cdpvs	15, 7, cr6, cr5, cr6, {3}
+a030c9c4:	65642064 	strvsb	r2, [r4, -#100]!
+a030c9c8:	6c756166 	ldfvse	f6, [r5], -#408
+a030c9cc:	61702074 	cmnvs	r0, r4, ror r0
+a030c9d0:	74697472 	strvcbt	r7, [r9], -#1138
+a030c9d4:	206e6f69 	rsbcs	r6, lr, r9, ror #30
+a030c9d8:	6c626174 	stfvse	f6, [r2], -#464
+a030c9dc:	74612065 	strvcbt	r2, [r1], -#101
+a030c9e0:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030c9e4:	0a783830 	beq	a211aaac <__bss_end+0x1e086a8>
+a030c9e8:	00000000 	andeq	r0, r0, r0
+a030c9ec:	6e756f66 	cdpvs	15, 7, cr6, cr5, cr6, {3}
+a030c9f0:	6c662064 	stcvsl	0, cr2, [r6], -#400
+a030c9f4:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030c9f8:	74726170 	ldrvcbt	r6, [r2], -#368
+a030c9fc:	6f697469 	swivs	0x00697469
+a030ca00:	6174206e 	cmnvs	r4, lr, rrx
+a030ca04:	20656c62 	rsbcs	r6, r5, r2, ror #24
+a030ca08:	30207461 	eorcc	r7, r0, r1, ror #8
+a030ca0c:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030ca10:	00000a78 	andeq	r0, r0, r8, ror sl
+a030ca14:	61766e69 	cmnvs	r6, r9, ror #28
+a030ca18:	2064696c 	rsbcs	r6, r4, ip, ror #18
+a030ca1c:	74726170 	ldrvcbt	r6, [r2], -#368
+a030ca20:	6f697469 	swivs	0x00697469
+a030ca24:	6174206e 	cmnvs	r4, lr, rrx
+a030ca28:	20656c62 	rsbcs	r6, r5, r2, ror #24
+a030ca2c:	6967616d 	stmvsdb	r7!, {r0, r2, r3, r5, r6, r8, sp, lr}^
+a030ca30:	00000a63 	andeq	r0, r0, r3, ror #20
+a030ca34:	6c756f63 	ldcvsl	15, cr6, [r5], -#396
+a030ca38:	6f6e2064 	swivs	0x006e2064
+a030ca3c:	69662074 	stmvsdb	r6!, {r2, r4, r5, r6, sp}^
+a030ca40:	70752078 	rsbvcs	r2, r5, r8, ror r0
+a030ca44:	72617020 	rsbvc	r7, r1, #32	; 0x20
+a030ca48:	69746974 	ldmvsdb	r4!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030ca4c:	74206e6f 	strvct	r6, [r0], -#3695
+a030ca50:	656c6261 	strvsb	r6, [ip, -#609]!
+a030ca54:	0000000a 	andeq	r0, r0, sl
+a030ca58:	72707470 	rsbvcs	r7, r0, #1879048192	; 0x70000000
+a030ca5c:	00746e69 	rsbeqs	r6, r4, r9, ror #28
+a030ca60:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030ca64:	746f6e20 	strvcbt	r6, [pc], #3616	; a030ca6c <__text_end+0x9c4>
+a030ca68:	776f6420 	strvcb	r6, [pc, -r0, lsr #8]!
+a030ca6c:	616f6c6e 	cmnvs	pc, lr, ror #24
+a030ca70:	0a646564 	beq	a1c26008 <__bss_end+0x1913c04>
+a030ca74:	00000000 	andeq	r0, r0, r0
+a030ca78:	74736552 	ldrvcbt	r6, [r3], -#1362
+a030ca7c:	69747261 	ldmvsdb	r4!, {r0, r5, r6, r9, ip, sp, lr}^
+a030ca80:	6220676e 	eorvs	r6, r0, #28835840	; 0x1b80000
+a030ca84:	20626f6c 	rsbcs	r6, r2, ip, ror #30
+a030ca88:	6d6f7266 	sfmvs	f7, 2, [pc, -#408]!
+a030ca8c:	4d415220 	sfmmi	f5, 2, [r1, -#128]
+a030ca90:	0a2e2e2e 	beq	a0e98350 <__bss_end+0xb85f4c>
+a030ca94:	0000000a 	andeq	r0, r0, sl
+a030ca98:	6c626572 	cfstr64vs	mvdx6, [r2], -#456
+a030ca9c:	0000626f 	andeq	r6, r0, pc, ror #4
+a030caa0:	0000002e 	andeq	r0, r0, lr, lsr #32
+a030caa4:	62616e55 	rsbvs	r6, r1, #1360	; 0x550
+a030caa8:	7420656c 	strvct	r6, [r0], -#1388
+a030caac:	6966206f 	stmvsdb	r6!, {r0, r1, r2, r3, r5, r6, sp}^
+a030cab0:	6b20646e 	blvs	a0b25c70 <__bss_end+0x81386c>
+a030cab4:	656e7265 	strvsb	r7, [lr, -#613]!
+a030cab8:	00000a6c 	andeq	r0, r0, ip, ror #20
+a030cabc:	64616f4c 	strvsbt	r6, [r1], -#3916
+a030cac0:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030cac4:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030cac8:	66206c65 	strvst	r6, [r0], -r5, ror #24
+a030cacc:	206d6f72 	rsbcs	r6, sp, r2, ror pc
+a030cad0:	74726170 	ldrvcbt	r6, [r2], -#368
+a030cad4:	6f697469 	swivs	0x00697469
+a030cad8:	7325206e 	teqvc	r5, #110	; 0x6e
+a030cadc:	73252820 	teqvc	r5, #2097152	; 0x200000
+a030cae0:	2e2e2029 	cdpcs	0, 2, cr2, cr14, cr9, {1}
+a030cae4:	0000002e 	andeq	r0, r0, lr, lsr #32
+a030cae8:	6f6f622f 	swivs	0x006f622f
+a030caec:	696c2f74 	stmvsdb	ip!, {r2, r4, r5, r6, r8, r9, sl, fp, sp}^
+a030caf0:	0078756e 	rsbeqs	r7, r8, lr, ror #10
+a030caf4:	6f727265 	swivs	0x00727265
+a030caf8:	6f6c2072 	swivs	0x006c2072
+a030cafc:	6e696461 	cdpvs	4, 6, cr6, cr9, cr1, {3}
+a030cb00:	656b2067 	strvsb	r2, [fp, -#103]!
+a030cb04:	6c656e72 	stcvsl	14, cr6, [r5], -#456
+a030cb08:	00000a21 	andeq	r0, r0, r1, lsr #20
+a030cb0c:	64616f6c 	strvsbt	r6, [r1], -#3948
+a030cb10:	30206465 	eorcc	r6, r0, r5, ror #8
+a030cb14:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030cb18:	25282078 	strcs	r2, [r8, -#120]!
+a030cb1c:	62202964 	eorvs	r2, r0, #1638400	; 0x190000
+a030cb20:	73657479 	cmnvc	r5, #2030043136	; 0x79000000
+a030cb24:	0000000a 	andeq	r0, r0, sl
+a030cb28:	616d497a 	cmnvs	sp, sl, ror r9
+a030cb2c:	00006567 	andeq	r6, r0, r7, ror #10
+a030cb30:	69616620 	stmvsdb	r1!, {r5, r9, sl, sp, lr}^
+a030cb34:	2064656c 	rsbcs	r6, r4, ip, ror #10
+a030cb38:	20726f66 	rsbcss	r6, r2, r6, ror #30
+a030cb3c:	72646461 	rsbvc	r6, r4, #1627389952	; 0x61000000
+a030cb40:	20737365 	rsbcss	r7, r3, r5, ror #6
+a030cb44:	00007830 	andeq	r7, r0, r0, lsr r8
+a030cb48:	74732020 	ldrvcbt	r2, [r3], -#32
+a030cb4c:	73757461 	cmnvc	r5, #1627389952	; 0x61000000
+a030cb50:	30203d20 	eorcc	r3, r0, r0, lsr #26
+a030cb54:	00000078 	andeq	r0, r0, r8, ror r0
+a030cb58:	207b2020 	rsbcss	r2, fp, r0, lsr #32
+a030cb5c:	656d6974 	strvsb	r6, [sp, -#2420]!
+a030cb60:	2074756f 	rsbcss	r7, r4, pc, ror #10
+a030cb64:	63746566 	cmnvs	r4, #427819008	; 0x19800000
+a030cb68:	676e6968 	strvsb	r6, [lr, -r8, ror #18]!
+a030cb6c:	61747320 	cmnvs	r4, r0, lsr #6
+a030cb70:	20737574 	rsbcss	r7, r3, r4, ror r5
+a030cb74:	0000007d 	andeq	r0, r0, sp, ror r0
+a030cb78:	207b2020 	rsbcss	r2, fp, r0, lsr #32
+a030cb7c:	00000000 	andeq	r0, r0, r0
+a030cb80:	54415453 	strplb	r5, [r1], -#1107
+a030cb84:	525f5355 	subpls	r5, pc, #1409286145	; 0x54000001
+a030cb88:	59444145 	stmpldb	r4, {r0, r2, r6, r8, lr}^
+a030cb8c:	00000020 	andeq	r0, r0, r0, lsr #32
+a030cb90:	54415453 	strplb	r5, [r1], -#1107
+a030cb94:	455f5355 	ldrmib	r5, [pc, #-853]	; a030c847 <__text_end+0x79f>
+a030cb98:	45534152 	ldrmib	r4, [r3, -#338]
+a030cb9c:	5355535f 	cmppl	r5, #2080374785	; 0x7c000001
+a030cba0:	00002050 	andeq	r2, r0, r0, asr r0
+a030cba4:	54415453 	strplb	r5, [r1], -#1107
+a030cba8:	455f5355 	ldrmib	r5, [pc, #-853]	; a030c85b <__text_end+0x7b3>
+a030cbac:	45534152 	ldrmib	r4, [r3, -#338]
+a030cbb0:	5252455f 	subpls	r4, r2, #398458880	; 0x17c00000
+a030cbb4:	00000020 	andeq	r0, r0, r0, lsr #32
+a030cbb8:	54415453 	strplb	r5, [r1], -#1107
+a030cbbc:	505f5355 	subpls	r5, pc, r5, asr r3
+a030cbc0:	455f4d47 	ldrmib	r4, [pc, #-3399]	; a030be81 <led_off+0x19>
+a030cbc4:	00205252 	eoreq	r5, r0, r2, asr r2
+a030cbc8:	54415453 	strplb	r5, [r1], -#1107
+a030cbcc:	565f5355 	undefined
+a030cbd0:	4f4c5050 	swimi	0x004c5050
+a030cbd4:	52455f57 	subpl	r5, r5, #348	; 0x15c
+a030cbd8:	00002052 	andeq	r2, r0, r2, asr r0
+a030cbdc:	54415453 	strplb	r5, [r1], -#1107
+a030cbe0:	505f5355 	subpls	r5, pc, r5, asr r3
+a030cbe4:	535f4d47 	cmppl	pc, #4544	; 0x11c0
+a030cbe8:	20505355 	subcss	r5, r0, r5, asr r3
+a030cbec:	00000000 	andeq	r0, r0, r0
+a030cbf0:	54415453 	strplb	r5, [r1], -#1107
+a030cbf4:	4c5f5355 	mrrcmi	3, 5, r5, pc, cr5
+a030cbf8:	454b434f 	strmib	r4, [fp, -#847]
+a030cbfc:	52455f44 	subpl	r5, r5, #272	; 0x110
+a030cc00:	00002052 	andeq	r2, r0, r2, asr r0
+a030cc04:	00000a0a 	andeq	r0, r0, sl, lsl #20
+a030cc08:	655f6f64 	ldrvsb	r6, [pc, #-3940]	; a030bcac <pxa_serial_read+0x5c>
+a030cc0c:	65736172 	ldrvsb	r6, [r3, -#370]!
+a030cc10:	00000000 	andeq	r0, r0, r0
+a030cc14:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030cc18:	6f6c5f68 	swivs	0x006c5f68
+a030cc1c:	625f6b63 	subvss	r6, pc, #101376	; 0x18c00
+a030cc20:	6b636f6c 	blvs	a1be89d8 <__bss_end+0x18d65d4>
+a030cc24:	746e695f 	strvcbt	r6, [lr], -#2399
+a030cc28:	36316c65 	ldrcct	r6, [r1], -r5, ror #24
+a030cc2c:	00000000 	andeq	r0, r0, r0
+a030cc30:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030cc34:	6e755f68 	cdpvs	15, 7, cr5, cr5, cr8, {3}
+a030cc38:	6b636f6c 	blvs	a1be89f0 <__bss_end+0x18d65ec>
+a030cc3c:	6f6c625f 	swivs	0x006c625f
+a030cc40:	695f6b63 	ldmvsdb	pc, {r0, r1, r5, r6, r8, r9, fp, sp, lr}^
+a030cc44:	6c65746e 	cfstrdvs	mvd7, [r5], -#440
+a030cc48:	00003631 	andeq	r3, r0, r1, lsr r6
+
+a030cc4c <mainstone_flash_descriptors>:
+a030cc4c:	00008000 	andeq	r8, r0, r0
+a030cc50:	0000001f 	andeq	r0, r0, pc, lsl r0
+a030cc54:	00000001 	andeq	r0, r0, r1
+a030cc58:	00001000 	andeq	r1, r0, r0
+a030cc5c:	00000008 	andeq	r0, r0, r8
+a030cc60:	00000001 	andeq	r0, r0, r1
+	...
+
+a030cc70 <Mainstone_default_partition_table>:
+a030cc70:	42445054 	submi	r5, r4, #84	; 0x54
+a030cc74:	0000003c 	andeq	r0, r0, ip, lsr r0
+a030cc78:	00000000 	andeq	r0, r0, r0
+a030cc7c:	00400000 	subeq	r0, r0, r0
+	...
+a030ccac:	42504531 	submis	r4, r0, #205520896	; 0xc400000
+a030ccb0:	0000003c 	andeq	r0, r0, ip, lsr r0
+a030ccb4:	00000000 	andeq	r0, r0, r0
+a030ccb8:	00040000 	andeq	r0, r4, r0
+a030ccbc:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+	...
+a030cce0:	a0200000 	eorge	r0, r0, r0
+a030cce4:	00000000 	andeq	r0, r0, r0
+a030cce8:	42504531 	submis	r4, r0, #205520896	; 0xc400000
+a030ccec:	0000003c 	andeq	r0, r0, ip, lsr r0
+a030ccf0:	00040000 	andeq	r0, r4, r0
+a030ccf4:	00000000 	andeq	r0, r0, r0
+a030ccf8:	61726170 	cmnvs	r2, r0, ror r1
+a030ccfc:	0000006d 	andeq	r0, r0, sp, rrx
+	...
+a030cd18:	00000001 	andeq	r0, r0, r1
+	...
+a030cd24:	42504531 	submis	r4, r0, #205520896	; 0xc400000
+a030cd28:	0000003c 	andeq	r0, r0, ip, lsr r0
+a030cd2c:	00040000 	andeq	r0, r4, r0
+a030cd30:	00200000 	eoreq	r0, r0, r0
+a030cd34:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030cd38:	00006c65 	andeq	r6, r0, r5, ror #24
+	...
+a030cd54:	00000012 	andeq	r0, r0, r2, lsl r0
+a030cd58:	a0008000 	andge	r8, r0, r0
+a030cd5c:	a0008000 	andge	r8, r0, r0
+a030cd60:	42504533 	submis	r4, r0, #213909504	; 0xcc00000
+	...
+a030cd9c:	69727766 	ldmvsdb	r2!, {r1, r2, r5, r6, r8, r9, sl, ip, sp, lr}^
+a030cda0:	00006574 	andeq	r6, r0, r4, ror r5
+a030cda4:	61726566 	cmnvs	r2, r6, ror #10
+a030cda8:	00006573 	andeq	r6, r0, r3, ror r5
+a030cdac:	206e7552 	rsbcs	r7, lr, r2, asr r5
+a030cdb0:	65646f4d 	strvsb	r6, [r4, -#3917]!
+a030cdb4:	6f6c6320 	swivs	0x006c6320
+a030cdb8:	203a6b63 	eorcss	r6, sl, r3, ror #22
+a030cdbc:	252e6425 	strcs	r6, [lr, -#1061]!
+a030cdc0:	4d643230 	sfmmi	f3, 2, [r4, -#192]!
+a030cdc4:	28207a48 	stmcsda	r0!, {r3, r6, r9, fp, ip, sp, lr}
+a030cdc8:	2964252a 	stmcsdb	r4!, {r1, r3, r5, r8, sl, sp}^
+a030cdcc:	0000000a 	andeq	r0, r0, sl
+a030cdd0:	00000000 	andeq	r0, r0, r0
+a030cdd4:	00006e69 	andeq	r6, r0, r9, ror #28
+a030cdd8:	62727554 	rsbvss	r7, r2, #352321536	; 0x15000000
+a030cddc:	6f4d206f 	swivs	0x004d206f
+a030cde0:	63206564 	teqvs	r0, #419430400	; 0x19000000
+a030cde4:	6b636f6c 	blvs	a1be8b9c <__bss_end+0x18d6798>
+a030cde8:	6425203a 	strvst	r2, [r5], -#58
+a030cdec:	3230252e 	eorccs	r2, r0, #192937984	; 0xb800000
+a030cdf0:	7a484d64 	bvc	a1520388 <__bss_end+0x120df84>
+a030cdf4:	252a2820 	strcs	r2, [sl, -#2080]!
+a030cdf8:	64252e64 	strvst	r2, [r5], -#3684
+a030cdfc:	7325202c 	teqvc	r5, #44	; 0x2c
+a030ce00:	69746361 	ldmvsdb	r4!, {r0, r5, r6, r8, r9, sp, lr}^
+a030ce04:	0a296576 	beq	a0d663e4 <__bss_end+0xa53fe0>
+a030ce08:	00000000 	andeq	r0, r0, r0
+a030ce0c:	6f6d654d 	swivs	0x006d654d
+a030ce10:	63207972 	teqvs	r0, #1867776	; 0x1c8000
+a030ce14:	6b636f6c 	blvs	a1be8bcc <__bss_end+0x18d67c8>
+a030ce18:	6425203a 	strvst	r2, [r5], -#58
+a030ce1c:	3230252e 	eorccs	r2, r0, #192937984	; 0xb800000
+a030ce20:	7a484d64 	bvc	a15203b8 <__bss_end+0x120dfb4>
+a030ce24:	6c412820 	mcrrvs	8, 2, r2, r1, cr0
+a030ce28:	64253d74 	strvst	r3, [r5], -#3444
+a030ce2c:	4453202c 	ldrmib	r2, [r3], -#44
+a030ce30:	5b4b4c43 	blpl	a15dff44 <__bss_end+0x12cdb40>
+a030ce34:	2f3d5d30 	swics	0x003d5d30
+a030ce38:	202c6425 	eorcs	r6, ip, r5, lsr #8
+a030ce3c:	4c434453 	mcrrmi	4, 5, r4, r3, cr3
+a030ce40:	5d315b4b 	fldmdbxpl	r1!, {d5-d41}
+a030ce44:	64252f3d 	strvst	r2, [r5], -#3901
+a030ce48:	00000a29 	andeq	r0, r0, r9, lsr #20
+a030ce4c:	74737953 	ldrvcbt	r7, [r3], -#2387
+a030ce50:	62206d65 	eorvs	r6, r0, #6464	; 0x1940
+a030ce54:	63207375 	teqvs	r0, #-738197503	; 0xd4000001
+a030ce58:	6b636f6c 	blvs	a1be8c10 <__bss_end+0x18d680c>
+a030ce5c:	6425203a 	strvst	r2, [r5], -#58
+a030ce60:	3230252e 	eorccs	r2, r0, #192937984	; 0xb800000
+a030ce64:	7a484d64 	bvc	a15203fc <__bss_end+0x120dff8>
+a030ce68:	00000a20 	andeq	r0, r0, r0, lsr #20
+a030ce6c:	636f6c63 	cmnvs	pc, #25344	; 0x6300
+a030ce70:	666e696b 	strvsbt	r6, [lr], -fp, ror #18
+a030ce74:	0000006f 	andeq	r0, r0, pc, rrx
+a030ce78:	6174530a 	cmnvs	r4, sl, lsl #6
+a030ce7c:	6e697472 	mcrvs	4, 3, r7, cr9, cr2, {3}
+a030ce80:	74612067 	strvcbt	r2, [r1], -#103
+a030ce84:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030ce88:	2e783830 	mrccs	8, 3, r3, cr8, cr0, {1}
+a030ce8c:	0a0a2e2e 	beq	a059874c <__bss_end+0x286348>
+a030ce90:	00000000 	andeq	r0, r0, r0
+a030ce94:	6e6f440a 	cdpvs	4, 6, cr4, cr15, cr10, {0}
+a030ce98:	000a2e65 	andeq	r2, sl, r5, ror #28
+a030ce9c:	00006f67 	andeq	r6, r0, r7, ror #30
+a030cea0:	0000631b 	andeq	r6, r0, fp, lsl r3
+a030cea4:	6f626552 	swivs	0x00626552
+a030cea8:	6e69746f 	cdpvs	4, 6, cr7, cr9, cr15, {3}
+a030ceac:	2e2e2e67 	cdpcs	14, 2, cr2, cr14, cr7, {3}
+a030ceb0:	00000a0a 	andeq	r0, r0, sl, lsl #20
+a030ceb4:	61746f54 	cmnvs	r4, r4, asr pc
+a030ceb8:	6974206c 	ldmvsdb	r4!, {r2, r3, r5, r6, sp}^
+a030cebc:	203a656d 	eorcss	r6, sl, sp, ror #10
+a030cec0:	736d7525 	cmnvc	sp, #155189248	; 0x9400000
+a030cec4:	0000000a 	andeq	r0, r0, sl
+a030cec8:	6f676f42 	swivs	0x00676f42
+a030cecc:	7370696d 	cmnvc	r0, #1785856	; 0x1b4000
+a030ced0:	7525203a 	strvc	r2, [r5, -#58]!
+a030ced4:	0000000a 	andeq	r0, r0, sl
+a030ced8:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030cedc:	00007838 	andeq	r7, r0, r8, lsr r8
+a030cee0:	3e2d2d20 	cdpcc	13, 2, cr2, cr13, cr0, {1}
+a030cee4:	25783020 	ldrcsb	r3, [r8, -#32]!
+a030cee8:	0a783830 	beq	a211afb0 <__bss_end+0x1e08bac>
+a030ceec:	00000000 	andeq	r0, r0, r0
+a030cef0:	76677261 	strvcbt	r7, [r7], -r1, ror #4
+a030cef4:	5d64255b 	cfstr64pl	mvdx2, [r4, -#364]!
+a030cef8:	27203d20 	strcs	r3, [r0, -r0, lsr #26]!
+a030cefc:	0a277325 	beq	a0ce9b98 <__bss_end+0x9d7794>
+a030cf00:	00000000 	andeq	r0, r0, r0
+a030cf04:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030cf08:	203a7838 	eorcss	r7, sl, r8, lsr r8
+a030cf0c:	00000000 	andeq	r0, r0, r0
+a030cf10:	30257830 	eorcc	r7, r5, r0, lsr r8
+a030cf14:	00207838 	eoreq	r7, r0, r8, lsr r8
+a030cf18:	77206425 	strvc	r6, [r0, -r5, lsr #8]!
+a030cf1c:	7364726f 	cmnvc	r4, #-268435450	; 0xf0000006
+a030cf20:	706f6320 	rsbvc	r6, pc, r0, lsr #6
+a030cf24:	2e646569 	cdpcs	5, 6, cr6, cr4, cr9, {3}
+a030cf28:	0000000a 	andeq	r0, r0, sl
+a030cf2c:	30206325 	eorcc	r6, r0, r5, lsr #6
+a030cf30:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030cf34:	00000a78 	andeq	r0, r0, r8, ror sl
+a030cf38:	74697753 	strvcbt	r7, [r9], -#1875
+a030cf3c:	6e696863 	cdpvs	8, 6, cr6, cr9, cr3, {3}
+a030cf40:	6f742067 	swivs	0x00742067
+a030cf44:	00000020 	andeq	r0, r0, r0, lsr #32
+a030cf48:	75616220 	strvcb	r6, [r1, -#544]!
+a030cf4c:	00000a64 	andeq	r0, r0, r4, ror #20
+a030cf50:	74697753 	strvcbt	r7, [r9], -#1875
+a030cf54:	79206863 	stmvcdb	r0!, {r0, r1, r5, r6, fp, sp, lr}
+a030cf58:	2072756f 	rsbcss	r7, r2, pc, ror #10
+a030cf5c:	6d726574 	cfldr64vs	mvdx6, [r2, -#464]!
+a030cf60:	6c616e69 	stcvsl	14, cr6, [r1], -#420
+a030cf64:	756d6520 	strvcb	r6, [sp, -#1312]!
+a030cf68:	6f74616c 	swivs	0x0074616c
+a030cf6c:	6f742072 	swivs	0x00742072
+a030cf70:	65687420 	strvsb	r7, [r8, -#1056]!
+a030cf74:	6d617320 	stcvsl	3, cr7, [r1, -#128]!
+a030cf78:	70732065 	rsbvcs	r2, r3, r5, rrx
+a030cf7c:	20646565 	rsbcs	r6, r4, r5, ror #10
+a030cf80:	0a646e61 	beq	a1c2890c <__bss_end+0x1916508>
+a030cf84:	00000000 	andeq	r0, r0, r0
+a030cf88:	72617473 	rsbvc	r7, r1, #1929379840	; 0x73000000
+a030cf8c:	65732074 	ldrvsb	r2, [r3, -#116]!
+a030cf90:	6e69646e 	cdpvs	4, 6, cr6, cr9, cr14, {3}
+a030cf94:	73752067 	cmnvc	r5, #103	; 0x67
+a030cf98:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030cf9c:	20656874 	rsbcs	r6, r5, r4, ror r8
+a030cfa0:	444f4d58 	strmib	r4, [pc], #3416	; a030cfa8 <Mainstone_default_partition_table+0x338>
+a030cfa4:	70204d45 	eorvc	r4, r0, r5, asr #26
+a030cfa8:	6f746f72 	swivs	0x00746f72
+a030cfac:	206c6f63 	rsbcs	r6, ip, r3, ror #30
+a030cfb0:	70657228 	rsbvc	r7, r5, r8, lsr #4
+a030cfb4:	65746165 	ldrvsb	r6, [r4, -#357]!
+a030cfb8:	585e2064 	ldmplda	lr, {r2, r5, r6, sp}^
+a030cfbc:	6f742029 	swivs	0x00742029
+a030cfc0:	69757120 	ldmvsdb	r5!, {r5, r8, ip, sp, lr}^
+a030cfc4:	000a2e74 	andeq	r2, sl, r4, ror lr
+a030cfc8:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030cfcc:	6c697720 	stcvsl	7, cr7, [r9], -#128
+a030cfd0:	7773206c 	ldrvcb	r2, [r3, -ip, rrx]!
+a030cfd4:	68637469 	stmvsda	r3!, {r0, r3, r5, r6, sl, ip, sp, lr}^
+a030cfd8:	63616220 	cmnvs	r1, #2	; 0x2
+a030cfdc:	6f74206b 	swivs	0x0074206b
+a030cfe0:	00000020 	andeq	r0, r0, r0, lsr #32
+a030cfe4:	75616220 	strvcb	r6, [r1, -#544]!
+a030cfe8:	66612064 	strvsbt	r2, [r1], -r4, rrx
+a030cfec:	20726574 	rsbcss	r6, r2, r4, ror r5
+a030cff0:	444f4d58 	strmib	r4, [pc], #3416	; a030cff8 <Mainstone_default_partition_table+0x388>
+a030cff4:	73204d45 	teqvc	r0, #4416	; 0x1140
+a030cff8:	65636375 	strvsb	r6, [r3, -#885]!
+a030cffc:	20736465 	rsbcss	r6, r3, r5, ror #8
+a030d000:	7420726f 	strvct	r7, [r0], -#623
+a030d004:	73656d69 	cmnvc	r5, #6720	; 0x1a40
+a030d008:	74756f20 	ldrvcbt	r6, [r5], -#3872
+a030d00c:	00000a2e 	andeq	r0, r0, lr, lsr #20
+a030d010:	72617453 	rsbvc	r7, r1, #1392508928	; 0x53000000
+a030d014:	65732074 	ldrvsb	r2, [r3, -#116]!
+a030d018:	6e69646e 	cdpvs	4, 6, cr6, cr9, cr14, {3}
+a030d01c:	73752067 	cmnvc	r5, #103	; 0x67
+a030d020:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030d024:	20656874 	rsbcs	r6, r5, r4, ror r8
+a030d028:	444f4d58 	strmib	r4, [pc], #3416	; a030d030 <Mainstone_default_partition_table+0x3c0>
+a030d02c:	70204d45 	eorvc	r4, r0, r5, asr #26
+a030d030:	6f746f72 	swivs	0x00746f72
+a030d034:	206c6f63 	rsbcs	r6, ip, r3, ror #30
+a030d038:	70657228 	rsbvc	r7, r5, r8, lsr #4
+a030d03c:	65746165 	ldrvsb	r6, [r4, -#357]!
+a030d040:	585e2064 	ldmplda	lr, {r2, r5, r6, sp}^
+a030d044:	206f7420 	rsbcs	r7, pc, r0, lsr #8
+a030d048:	74697571 	strvcbt	r7, [r9], -#1393
+a030d04c:	0a0a2e29 	beq	a05988f8 <__bss_end+0x2864f4>
+a030d050:	00000000 	andeq	r0, r0, r0
+a030d054:	00000a0a 	andeq	r0, r0, sl, lsl #20
+a030d058:	6c50280a 	mrrcvs	8, 0, r2, r0, cr10
+a030d05c:	65736165 	ldrvsb	r6, [r3, -#357]!
+a030d060:	69777320 	ldmvsdb	r7!, {r5, r8, r9, ip, sp, lr}^
+a030d064:	20686374 	rsbcs	r6, r8, r4, ror r3
+a030d068:	72756f79 	rsbvcs	r6, r5, #484	; 0x1e4
+a030d06c:	72657420 	rsbvc	r7, r5, #536870912	; 0x20000000
+a030d070:	616e696d 	cmnvs	lr, sp, ror #18
+a030d074:	6d65206c 	stcvsl	0, cr2, [r5, -#432]!
+a030d078:	74616c75 	strvcbt	r6, [r1], -#3189
+a030d07c:	6220726f 	eorvs	r7, r0, #-268435450	; 0xf0000006
+a030d080:	206b6361 	rsbcs	r6, fp, r1, ror #6
+a030d084:	00206f74 	eoreq	r6, r0, r4, ror pc
+a030d088:	75616220 	strvcb	r6, [r1, -#544]!
+a030d08c:	000a2964 	andeq	r2, sl, r4, ror #18
+a030d090:	65636552 	strvsb	r6, [r3, -#1362]!
+a030d094:	64657669 	strvsbt	r7, [r5], -#1641
+a030d098:	20692520 	rsbcs	r2, r9, r0, lsr #10
+a030d09c:	25783028 	ldrcsb	r3, [r8, -#40]!
+a030d0a0:	29783830 	ldmcsdb	r8!, {r4, r5, fp, ip, sp}^
+a030d0a4:	74796220 	ldrvcbt	r6, [r9], -#544
+a030d0a8:	00007365 	andeq	r7, r0, r5, ror #6
+a030d0ac:	30207461 	eorcc	r7, r0, r1, ror #8
+a030d0b0:	38302578 	ldmccda	r0!, {r3, r4, r5, r6, r8, sl, sp}
+a030d0b4:	00000078 	andeq	r0, r0, r8, ror r0
+a030d0b8:	0000000a 	andeq	r0, r0, sl
+a030d0bc:	706c6548 	rsbvc	r6, ip, r8, asr #10
+a030d0c0:	726f6620 	rsbvc	r6, pc, #33554432	; 0x2000000
+a030d0c4:	3a732520 	bcc	a1fd654c <__bss_end+0x1cc4148>
+a030d0c8:	73550a0a 	cmpvc	r5, #40960	; 0xa000
+a030d0cc:	3a656761 	bcc	a1c66e58 <__bss_end+0x1954a54>
+a030d0d0:	0a732520 	beq	a1fd6558 <__bss_end+0x1cc4154>
+a030d0d4:	00000000 	andeq	r0, r0, r0
+a030d0d8:	20656854 	rsbcs	r6, r5, r4, asr r8
+a030d0dc:	6c6c6f66 	stcvsl	15, cr6, [ip], -#408
+a030d0e0:	6e69776f 	cdpvs	7, 6, cr7, cr9, cr15, {3}
+a030d0e4:	6f632067 	swivs	0x00632067
+a030d0e8:	6e616d6d 	cdpvs	13, 6, cr6, cr1, cr13, {3}
+a030d0ec:	61207364 	teqvs	r0, r4, ror #6
+a030d0f0:	73206572 	teqvc	r0, #478150656	; 0x1c800000
+a030d0f4:	6f707075 	swivs	0x00707075
+a030d0f8:	64657472 	strvsbt	r7, [r5], -#1138
+a030d0fc:	00000a3a 	andeq	r0, r0, sl, lsr sl
+a030d100:	7325202a 	teqvc	r5, #42	; 0x2a
+a030d104:	0000000a 	andeq	r0, r0, sl
+a030d108:	20657355 	rsbcs	r7, r5, r5, asr r3
+a030d10c:	6c656822 	stcvsl	8, cr6, [r5], -#136
+a030d110:	6f632070 	swivs	0x00632070
+a030d114:	6e616d6d 	cdpvs	13, 6, cr6, cr1, cr13, {3}
+a030d118:	74202264 	strvct	r2, [r0], -#612
+a030d11c:	6567206f 	strvsb	r2, [r7, -#111]!
+a030d120:	65682074 	strvsb	r2, [r8, -#116]!
+a030d124:	6f20706c 	swivs	0x0020706c
+a030d128:	2061206e 	rsbcs	r2, r1, lr, rrx
+a030d12c:	63657073 	cmnvs	r5, #115	; 0x73
+a030d130:	63696669 	cmnvs	r9, #110100480	; 0x6900000
+a030d134:	6d6f6320 	stcvsl	3, cr6, [pc, -#128]!
+a030d138:	646e616d 	strvsbt	r6, [lr], -#365
+a030d13c:	0000000a 	andeq	r0, r0, sl
+a030d140:	706c6568 	rsbvc	r6, ip, r8, ror #10
+a030d144:	00000000 	andeq	r0, r0, r0
+a030d148:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030d14c:	0000203e 	andeq	r2, r0, lr, lsr r0
+a030d150:	00007325 	andeq	r7, r0, r5, lsr #6
+a030d154:	276e6163 	strcsb	r6, [lr, -r3, ror #2]!
+a030d158:	65722074 	ldrvsb	r2, [r2, -#116]!
+a030d15c:	63206461 	teqvs	r0, #1627389952	; 0x61000000
+a030d160:	616d6d6f 	cmnvs	sp, pc, ror #26
+a030d164:	0000646e 	andeq	r6, r0, lr, ror #8
+a030d168:	00082008 	andeq	r2, r8, r8
+a030d16c:	6b6e7528 	blvs	a1eaa614 <__bss_end+0x1b98210>
+a030d170:	6e776f6e 	cdpvs	15, 7, cr6, cr7, cr14, {3}
+a030d174:	00000029 	andeq	r0, r0, r9, lsr #32
+a030d178:	69256425 	stmvsdb	r5!, {r0, r2, r5, sl, sp, lr}
+a030d17c:	00000000 	andeq	r0, r0, r0
+a030d180:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030d184:	00000000 	andeq	r0, r0, r0
+a030d188:	61726170 	cmnvs	r2, r0, ror r1
+a030d18c:	0000006d 	andeq	r0, r0, sp, rrx
+a030d190:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030d194:	00006c65 	andeq	r6, r0, r5, ror #24
+a030d198:	646d6172 	strvsbt	r6, [sp], -#370
+a030d19c:	006b7369 	rsbeq	r7, fp, r9, ror #6
+a030d1a0:	64616f4c 	strvsbt	r6, [r1], -#3916
+a030d1a4:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030d1a8:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030d1ac:	6f726620 	swivs	0x00726620
+a030d1b0:	6c66206d 	stcvsl	0, cr2, [r6], -#436
+a030d1b4:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030d1b8:	00000000 	andeq	r0, r0, r0
+a030d1bc:	64616f4c 	strvsbt	r6, [r1], -#3916
+a030d1c0:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030d1c4:	61726170 	cmnvs	r2, r0, ror r1
+a030d1c8:	6574616d 	ldrvsb	r6, [r4, -#365]!
+a030d1cc:	6c622072 	stcvsl	0, cr2, [r2], -#456
+a030d1d0:	206b636f 	rsbcs	r6, fp, pc, ror #6
+a030d1d4:	6d6f7266 	sfmvs	f7, 2, [pc, -#408]!
+a030d1d8:	616c6620 	cmnvs	ip, r0, lsr #12
+a030d1dc:	00206873 	eoreq	r6, r0, r3, ror r8
+a030d1e0:	64616f4c 	strvsbt	r6, [r1], -#3916
+a030d1e4:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030d1e8:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030d1ec:	66206c65 	strvst	r6, [r0], -r5, ror #24
+a030d1f0:	206d6f72 	rsbcs	r6, sp, r2, ror pc
+a030d1f4:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030d1f8:	00002068 	andeq	r2, r0, r8, rrx
+a030d1fc:	64616f4c 	strvsbt	r6, [r1], -#3916
+a030d200:	20676e69 	rsbcs	r6, r7, r9, ror #28
+a030d204:	646d6172 	strvsbt	r6, [sp], -#370
+a030d208:	206b7369 	rsbcs	r7, fp, r9, ror #6
+a030d20c:	6d6f7266 	sfmvs	f7, 2, [pc, -#408]!
+a030d210:	616c6620 	cmnvs	ip, r0, lsr #12
+a030d214:	00206873 	eoreq	r6, r0, r3, ror r8
+a030d218:	6e6f6420 	cdpvs	4, 6, cr6, cr15, cr0, {1}
+a030d21c:	00000a65 	andeq	r0, r0, r5, ror #20
+a030d220:	30303231 	eorccs	r3, r0, r1, lsr r2
+a030d224:	00000000 	andeq	r0, r0, r0
+a030d228:	00326b31 	eoreqs	r6, r2, r1, lsr fp
+a030d22c:	30303639 	eorccs	r3, r0, r9, lsr r6
+a030d230:	00000000 	andeq	r0, r0, r0
+a030d234:	00366b39 	eoreqs	r6, r6, r9, lsr fp
+a030d238:	30323931 	eorccs	r3, r2, r1, lsr r9
+a030d23c:	00000030 	andeq	r0, r0, r0, lsr r0
+a030d240:	326b3931 	rsbcc	r3, fp, #802816	; 0xc4000
+a030d244:	00000000 	andeq	r0, r0, r0
+a030d248:	30343833 	eorccs	r3, r4, r3, lsr r8
+a030d24c:	00000030 	andeq	r0, r0, r0, lsr r0
+a030d250:	346b3833 	strccbt	r3, [fp], -#2099
+a030d254:	00000000 	andeq	r0, r0, r0
+a030d258:	30363735 	eorccs	r3, r6, r5, lsr r7
+a030d25c:	00000030 	andeq	r0, r0, r0, lsr r0
+a030d260:	366b3735 	undefined
+a030d264:	00000000 	andeq	r0, r0, r0
+a030d268:	32353131 	eorccs	r3, r5, #1073741836	; 0x4000000c
+a030d26c:	00003030 	andeq	r3, r0, r0, lsr r0
+a030d270:	6b353131 	blvs	a105973c <__bss_end+0xd47338>
+a030d274:	00000032 	andeq	r0, r0, r2, lsr r0
+a030d278:	34303332 	ldrcct	r3, [r0], -#818
+a030d27c:	00003030 	andeq	r3, r0, r0, lsr r0
+a030d280:	6b303332 	blvs	a0f19f50 <__bss_end+0xc07b4c>
+a030d284:	00000034 	andeq	r0, r0, r4, lsr r0
+a030d288:	6e776f44 	cdpvs	15, 7, cr6, cr7, cr4, {2}
+a030d28c:	64616f6c 	strvsbt	r6, [r1], -#3948
+a030d290:	65707320 	ldrvsb	r7, [r0, -#800]!
+a030d294:	73206465 	teqvc	r0, #1694498816	; 0x65000000
+a030d298:	74207465 	strvct	r7, [r0], -#1125
+a030d29c:	0000206f 	andeq	r2, r0, pc, rrx
+a030d2a0:	75616220 	strvcb	r6, [r1, -#544]!
+a030d2a4:	00000a64 	andeq	r0, r0, r4, ror #20
+a030d2a8:	65657073 	strvsb	r7, [r5, -#115]!
+a030d2ac:	00000064 	andeq	r0, r0, r4, rrx
+a030d2b0:	65206f6e 	strvs	r6, [r0, -#3950]!
+a030d2b4:	726f7272 	rsbvc	r7, pc, #536870919	; 0x20000007
+a030d2b8:	00000000 	andeq	r0, r0, r0
+a030d2bc:	61766e69 	cmnvs	r6, r9, ror #28
+a030d2c0:	2064696c 	rsbcs	r6, r4, ip, ror #18
+a030d2c4:	75677261 	strvcb	r7, [r7, -#609]!
+a030d2c8:	746e656d 	strvcbt	r6, [lr], -#1389
+a030d2cc:	00000000 	andeq	r0, r0, r0
+a030d2d0:	20746f6e 	rsbcss	r6, r4, lr, ror #30
+a030d2d4:	756f6e65 	strvcb	r6, [pc, #-3685]!	; a030c477 <__text_end+0x3cf>
+a030d2d8:	70206867 	eorvc	r6, r0, r7, ror #16
+a030d2dc:	6d617261 	sfmvs	f7, 2, [r1, -#388]!
+a030d2e0:	72657465 	rsbvc	r7, r5, #1694498816	; 0x65000000
+a030d2e4:	00000073 	andeq	r0, r0, r3, ror r0
+a030d2e8:	6967616d 	stmvsdb	r7!, {r0, r2, r3, r5, r6, r8, sp, lr}^
+a030d2ec:	61762063 	cmnvs	r6, r3, rrx
+a030d2f0:	2065756c 	rsbcs	r7, r5, ip, ror #10
+a030d2f4:	6c696166 	stfvse	f6, [r9], -#408
+a030d2f8:	00006465 	andeq	r6, r0, r5, ror #8
+a030d2fc:	61766e69 	cmnvs	r6, r9, ror #28
+a030d300:	2064696c 	rsbcs	r6, r4, ip, ror #18
+a030d304:	6d6d6f63 	stcvsl	15, cr6, [sp, -#396]!
+a030d308:	00646e61 	rsbeq	r6, r4, r1, ror #28
+a030d30c:	20746f6e 	rsbcss	r6, r4, lr, ror #30
+a030d310:	756e2061 	strvcb	r2, [lr, -#97]!
+a030d314:	7265626d 	rsbvc	r6, r5, #-805306362	; 0xd0000006
+a030d318:	00000000 	andeq	r0, r0, r0
+a030d31c:	67696c61 	strvsb	r6, [r9, -r1, ror #24]!
+a030d320:	6e656d6e 	cdpvs	13, 6, cr6, cr5, cr14, {3}
+a030d324:	72652074 	rsbvc	r2, r5, #116	; 0x74
+a030d328:	00726f72 	rsbeqs	r6, r2, r2, ror pc
+a030d32c:	2074756f 	rsbcss	r7, r4, pc, ror #10
+a030d330:	7220666f 	eorvc	r6, r0, #116391936	; 0x6f00000
+a030d334:	65676e61 	strvsb	r6, [r7, -#3681]!
+a030d338:	00000000 	andeq	r0, r0, r0
+a030d33c:	656d6974 	strvsb	r6, [sp, -#2420]!
+a030d340:	2074756f 	rsbcss	r7, r4, pc, ror #10
+a030d344:	65637865 	strvsb	r7, [r3, -#2149]!
+a030d348:	64656465 	strvsbt	r6, [r5], -#1125
+a030d34c:	00000000 	andeq	r0, r0, r0
+a030d350:	726f6873 	rsbvc	r6, pc, #7536640	; 0x730000
+a030d354:	69662074 	stmvsdb	r6!, {r2, r4, r5, r6, sp}^
+a030d358:	0000656c 	andeq	r6, r0, ip, ror #10
+a030d35c:	676e6f6c 	strvsb	r6, [lr, -ip, ror #30]!
+a030d360:	6c696620 	stcvsl	6, cr6, [r9], -#128
+a030d364:	00000065 	andeq	r0, r0, r5, rrx
+a030d368:	69626d61 	stmvsdb	r2!, {r0, r5, r6, r8, sl, fp, sp, lr}^
+a030d36c:	756f7567 	strvcb	r7, [pc, #-1383]!	; a030ce0d <Mainstone_default_partition_table+0x19d>
+a030d370:	6f632073 	swivs	0x00632073
+a030d374:	6e616d6d 	cdpvs	13, 6, cr6, cr1, cr13, {3}
+a030d378:	00000064 	andeq	r0, r0, r4, rrx
+a030d37c:	276e6163 	strcsb	r6, [lr, -r3, ror #2]!
+a030d380:	72652074 	rsbvc	r2, r5, #116	; 0x74
+a030d384:	20657361 	rsbcs	r7, r5, r1, ror #6
+a030d388:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030d38c:	6c622068 	stcvsl	0, cr2, [r2], -#416
+a030d390:	006b636f 	rsbeq	r6, fp, pc, ror #6
+a030d394:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030d398:	72702068 	rsbvcs	r2, r0, #104	; 0x68
+a030d39c:	6172676f 	cmnvs	r2, pc, ror #14
+a030d3a0:	7265206d 	rsbvc	r2, r5, #109	; 0x6d
+a030d3a4:	00726f72 	rsbeqs	r6, r2, r2, ror pc
+a030d3a8:	69726573 	ldmvsdb	r2!, {r0, r1, r4, r5, r6, r8, sl, sp, lr}^
+a030d3ac:	70206c61 	eorvc	r6, r0, r1, ror #24
+a030d3b0:	2074726f 	rsbcss	r7, r4, pc, ror #4
+a030d3b4:	6f727265 	swivs	0x00727265
+a030d3b8:	00000072 	andeq	r0, r0, r2, ror r0
+a030d3bc:	6e6b6e75 	mcrvs	14, 3, r6, cr11, cr5, {3}
+a030d3c0:	206e776f 	rsbcs	r7, lr, pc, ror #14
+a030d3c4:	6f727265 	swivs	0x00727265
+a030d3c8:	00000072 	andeq	r0, r0, r2, ror r0
+a030d3cc:	202a2a2a 	eorcs	r2, sl, sl, lsr #20
+a030d3d0:	00000000 	andeq	r0, r0, r0
+a030d3d4:	00007325 	andeq	r7, r0, r5, lsr #6
+a030d3d8:	73257325 	teqvc	r5, #-1811939328	; 0x94000000
+a030d3dc:	00000000 	andeq	r0, r0, r0
+a030d3e0:	7325203a 	teqvc	r5, #58	; 0x3a
+a030d3e4:	0000000a 	andeq	r0, r0, sl
+a030d3e8:	0000000a 	andeq	r0, r0, sl
+
+a030d3ec <fillbuf>:
+a030d3ec:	00000080 	andeq	r0, r0, r0, lsl #1
+	...
+a030d42c:	00006325 	andeq	r6, r0, r5, lsr #6
+a030d430:	33323130 	teqcc	r2, #12	; 0xc
+a030d434:	37363534 	undefined
+a030d438:	62613938 	rsbvs	r3, r1, #917504	; 0xe0000
+a030d43c:	66656463 	strvsbt	r6, [r5], -r3, ror #8
+a030d440:	6a696867 	bvs	a1d675e4 <__bss_end+0x1a551e0>
+a030d444:	6e6d6c6b 	cdpvs	12, 6, cr6, cr13, cr11, {3}
+a030d448:	7271706f 	rsbvcs	r7, r1, #111	; 0x6f
+a030d44c:	76757473 	undefined
+a030d450:	7a797877 	bvc	a216b634 <__bss_end+0x1e59230>
+a030d454:	00000000 	andeq	r0, r0, r0
+a030d458:	33323130 	teqcc	r2, #12	; 0xc
+a030d45c:	37363534 	undefined
+a030d460:	42413938 	submi	r3, r1, #917504	; 0xe0000
+a030d464:	46454443 	strmib	r4, [r5], -r3, asr #8
+a030d468:	4a494847 	bmi	a155f58c <__bss_end+0x124d188>
+a030d46c:	4e4d4c4b 	cdpmi	12, 4, cr4, cr13, cr11, {2}
+a030d470:	5251504f 	subpls	r5, r1, #79	; 0x4f
+a030d474:	56555453 	undefined
+a030d478:	5a595857 	bpl	a19635dc <__bss_end+0x16511d8>
+a030d47c:	00000000 	andeq	r0, r0, r0
+a030d480:	4c554e3c 	mrrcmi	14, 3, r4, r5, cr12
+a030d484:	00003e4c 	andeq	r3, r0, ip, asr #28
+
+a030d488 <baud_rates>:
+a030d488:	000004b0 	streqh	r0, [r0], -r0
+a030d48c:	00000960 	andeq	r0, r0, r0, ror #18
+a030d490:	000012c0 	andeq	r1, r0, r0, asr #5
+a030d494:	00002580 	andeq	r2, r0, r0, lsl #11
+a030d498:	00004b00 	andeq	r4, r0, r0, lsl #22
+a030d49c:	00009600 	andeq	r9, r0, r0, lsl #12
+a030d4a0:	0000e100 	andeq	lr, r0, r0, lsl #2
+a030d4a4:	0001c200 	andeq	ip, r1, r0, lsl #4
+a030d4a8:	00038400 	andeq	r8, r3, r0, lsl #8
+a030d4ac:	00007830 	andeq	r7, r0, r0, lsr r8
+a030d4b0:	0000002e 	andeq	r0, r0, lr, lsr #32
+a030d4b4:	4d584946 	ldcmil	9, cr4, [r8, -#280]
+a030d4b8:	61203a45 	teqvs	r0, r5, asr #20
+a030d4bc:	50206464 	eorpl	r6, r0, r4, ror #8
+a030d4c0:	322d4158 	eorcc	r4, sp, #22	; 0x16
+a030d4c4:	72203035 	eorvc	r3, r0, #53	; 0x35
+a030d4c8:	6f6f6265 	swivs	0x006f6265
+a030d4cc:	6f632074 	swivs	0x00632074
+a030d4d0:	68206564 	stmvsda	r0!, {r2, r5, r6, r8, sl, sp, lr}
+a030d4d4:	21657265 	cmncs	r5, r5, ror #4
+a030d4d8:	0000000a 	andeq	r0, r0, sl
+a030d4dc:	6e696f47 	cdpvs	15, 6, cr6, cr9, cr7, {2}
+a030d4e0:	6e692067 	cdpvs	0, 6, cr2, cr9, cr7, {3}
+a030d4e4:	65206f74 	strvs	r6, [r0, -#3956]!
+a030d4e8:	656c646e 	strvsb	r6, [ip, -#1134]!
+a030d4ec:	6c207373 	stcvs	3, cr7, [r0], -#460
+a030d4f0:	2c706f6f 	ldccsl	15, cr6, [r0], -#444
+a030d4f4:	73756a20 	cmnvc	r5, #131072	; 0x20000
+a030d4f8:	73752074 	cmnvc	r5, #116	; 0x74
+a030d4fc:	6f792065 	swivs	0x00792065
+a030d500:	72207275 	eorvc	r7, r0, #1342177287	; 0x50000007
+a030d504:	74657365 	strvcbt	r7, [r5], -#869
+a030d508:	74756220 	ldrvcbt	r6, [r5], -#544
+a030d50c:	2e6e6f74 	mcrcs	15, 3, r6, cr14, cr4, {3}
+a030d510:	000a2e2e 	andeq	r2, sl, lr, lsr #28
+Disassembly of section .data:
+
+a030d514 <__data_start>:
+a030d514:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030d518:	627b2068 	rsbvss	r2, fp, #104	; 0x68
+a030d51c:	7c626f6c 	stcvcl	15, cr6, [r2], -#432
+a030d520:	61726170 	cmnvs	r2, r0, ror r1
+a030d524:	656b7c6d 	strvsb	r7, [fp, -#3181]!
+a030d528:	6c656e72 	stcvsl	14, cr6, [r5], -#456
+a030d52c:	6d61727c 	sfmvs	f7, 2, [r1, -#496]!
+a030d530:	6b736964 	blvs	a1fe7ac8 <__bss_end+0x1cd56c4>
+a030d534:	705b207d 	subvcs	r2, fp, sp, ror r0
+a030d538:	5d747261 	lfmpl	f7, 2, [r4, -#388]!
+a030d53c:	6972570a 	ldmvsdb	r2!, {r1, r3, r8, r9, sl, ip, lr}^
+a030d540:	3c206574 	cfstr32cc	mvfx6, [r0], -#464
+a030d544:	75677261 	strvcb	r7, [r7, -#609]!
+a030d548:	746e656d 	strvcbt	r6, [lr], -#1389
+a030d54c:	6d69203e 	stcvsl	0, cr2, [r9, -#248]!
+a030d550:	20656761 	rsbcs	r6, r5, r1, ror #14
+a030d554:	66206f74 	undefined
+a030d558:	6873616c 	ldmvsda	r3!, {r2, r3, r5, r6, r8, sp, lr}^
+a030d55c:	69737520 	ldmvsdb	r3!, {r5, r8, sl, ip, sp, lr}^
+a030d560:	7020676e 	eorvc	r6, r0, lr, ror #14
+a030d564:	69747261 	ldmvsdb	r4!, {r0, r5, r6, r9, ip, sp, lr}^
+a030d568:	6e6f6974 	mcrvs	9, 3, r6, cr15, cr4, {3}
+a030d56c:	61703c20 	cmnvs	r0, r0, lsr #24
+a030d570:	2e3e7472 	mrccs	4, 1, r7, cr14, cr2, {3}
+a030d574:	20664920 	rsbcs	r4, r6, r0, lsr #18
+a030d578:	7261703c 	rsbvc	r7, r1, #60	; 0x3c
+a030d57c:	69203e74 	stmvsdb	r0!, {r2, r4, r5, r6, r9, sl, fp, ip, sp}
+a030d580:	6d6f2073 	stcvsl	0, cr2, [pc, -#460]!
+a030d584:	65747469 	ldrvsb	r7, [r4, -#1129]!
+a030d588:	73610a64 	cmnvc	r1, #409600	; 0x64000
+a030d58c:	656d7573 	strvsb	r7, [sp, -#1395]!
+a030d590:	61703c20 	cmnvs	r0, r0, lsr #24
+a030d594:	3d3e7472 	cfldrscc	mvf7, [lr, -#456]!
+a030d598:	72613c3d 	rsbvc	r3, r1, #15616	; 0x3d00
+a030d59c:	656d7567 	strvsb	r7, [sp, -#1383]!
+a030d5a0:	0a3e746e 	beq	a12aa760 <__bss_end+0xf9835c>
+a030d5a4:	00000000 	andeq	r0, r0, r0
+
+a030d5a8 <lockhelp>:
+a030d5a8:	6b636f6c 	blvs	a1be9360 <__bss_end+0x18d6f5c>
+a030d5ac:	72617020 	rsbvc	r7, r1, #32	; 0x20
+a030d5b0:	69746974 	ldmvsdb	r4!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030d5b4:	4c0a6e6f 	stcmi	14, cr6, [sl], -#444
+a030d5b8:	206b636f 	rsbcs	r6, fp, pc, ror #6
+a030d5bc:	7261703c 	rsbvc	r7, r1, #60	; 0x3c
+a030d5c0:	69746974 	ldmvsdb	r4!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030d5c4:	203e6e6f 	eorcss	r6, lr, pc, ror #28
+a030d5c8:	69676572 	stmvsdb	r7!, {r1, r4, r5, r6, r8, sl, sp, lr}^
+a030d5cc:	6f206e6f 	swivs	0x00206e6f
+a030d5d0:	6c662066 	stcvsl	0, cr2, [r6], -#408
+a030d5d4:	0a687361 	beq	a1d2a360 <__bss_end+0x1a17f5c>
+a030d5d8:	00000000 	andeq	r0, r0, r0
+
+a030d5dc <unlockhelp>:
+a030d5dc:	6f6c6e75 	swivs	0x006c6e75
+a030d5e0:	70206b63 	eorvc	r6, r0, r3, ror #22
+a030d5e4:	69747261 	ldmvsdb	r4!, {r0, r5, r6, r9, ip, sp, lr}^
+a030d5e8:	6e6f6974 	mcrvs	9, 3, r6, cr15, cr4, {3}
+a030d5ec:	6c6e550a 	cfstr64vs	mvdx5, [lr], -#40
+a030d5f0:	206b636f 	rsbcs	r6, fp, pc, ror #6
+a030d5f4:	7261703c 	rsbvc	r7, r1, #60	; 0x3c
+a030d5f8:	69746974 	ldmvsdb	r4!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030d5fc:	203e6e6f 	eorcss	r6, lr, pc, ror #28
+a030d600:	69676572 	stmvsdb	r7!, {r1, r4, r5, r6, r8, sl, sp, lr}^
+a030d604:	6f206e6f 	swivs	0x00206e6f
+a030d608:	6c662066 	stcvsl	0, cr2, [r6], -#408
+a030d60c:	0a687361 	beq	a1d2a398 <__bss_end+0x1a17f94>
+a030d610:	00000000 	andeq	r0, r0, r0
+
+a030d614 <erasehelp>:
+a030d614:	73617265 	cmnvc	r1, #1342177286	; 0x50000006
+a030d618:	61702065 	cmnvs	r0, r5, rrx
+a030d61c:	74697472 	strvcbt	r7, [r9], -#1138
+a030d620:	0a6e6f69 	beq	a1ea93cc <__bss_end+0x1b96fc8>
+a030d624:	73617245 	cmnvc	r1, #1342177284	; 0x50000004
+a030d628:	703c2065 	eorvcs	r2, ip, r5, rrx
+a030d62c:	69747261 	ldmvsdb	r4!, {r0, r5, r6, r9, ip, sp, lr}^
+a030d630:	6e6f6974 	mcrvs	9, 3, r6, cr15, cr4, {3}
+a030d634:	6572203e 	ldrvsb	r2, [r2, -#62]!
+a030d638:	6e6f6967 	cdpvs	9, 6, cr6, cr15, cr7, {3}
+a030d63c:	20666f20 	rsbcs	r6, r6, r0, lsr #30
+a030d640:	73616c66 	cmnvc	r1, #26112	; 0x6600
+a030d644:	00000a68 	andeq	r0, r0, r8, ror #20
+
+a030d648 <theKernel>:
+a030d648:	a0008000 	andge	r8, r0, r0
+
+a030d64c <boothelp>:
+a030d64c:	746f6f62 	strvcbt	r6, [pc], #3938	; a030d654 <boothelp+0x8>
+a030d650:	656b5b20 	strvsb	r5, [fp, -#2848]!
+a030d654:	6c656e72 	stcvsl	14, cr6, [r5], -#456
+a030d658:	74706f20 	ldrvcbt	r6, [r0], -#3872
+a030d65c:	736e6f69 	cmnvc	lr, #420	; 0x1a4
+a030d660:	6f420a5d 	swivs	0x00420a5d
+a030d664:	4c20746f 	cfstrsmi	mvf7, [r0], -#444
+a030d668:	78756e69 	ldmvcda	r5!, {r0, r3, r5, r6, r9, sl, fp, sp, lr}^
+a030d66c:	74697720 	strvcbt	r7, [r9], -#1824
+a030d670:	706f2068 	rsbvc	r2, pc, r8, rrx
+a030d674:	6e6f6974 	mcrvs	9, 3, r6, cr15, cr4, {3}
+a030d678:	6b206c61 	blvs	a0b28804 <__bss_end+0x816400>
+a030d67c:	656e7265 	strvsb	r7, [lr, -#613]!
+a030d680:	706f206c 	rsbvc	r2, pc, ip, rrx
+a030d684:	6e6f6974 	mcrvs	9, 3, r6, cr15, cr4, {3}
+a030d688:	00000a73 	andeq	r0, r0, r3, ror sl
+
+a030d68c <kernelhelp>:
+a030d68c:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030d690:	68206c65 	stmvsda	r0!, {r0, r2, r5, r6, sl, fp, sp, lr}
+a030d694:	615f7865 	cmpvs	pc, r5, ror #16
+a030d698:	430a7264 	tstmi	sl, #1073741830	; 0x40000006
+a030d69c:	676e6168 	strvsb	r6, [lr, -r8, ror #2]!
+a030d6a0:	68742065 	ldmvsda	r4!, {r0, r2, r5, r6, sp}^
+a030d6a4:	694c2065 	stmvsdb	ip, {r0, r2, r5, r6, sp}^
+a030d6a8:	2078756e 	rsbcss	r7, r8, lr, ror #10
+a030d6ac:	6e72656b 	cdpvs	5, 7, cr6, cr2, cr11, {3}
+a030d6b0:	62206c65 	eorvs	r6, r0, #25856	; 0x6500
+a030d6b4:	0a657361 	beq	a1c6a440 <__bss_end+0x195803c>
+a030d6b8:	00000000 	andeq	r0, r0, r0
+
+a030d6bc <version_str>:
+a030d6bc:	a030c494 	mlages	r0, r4, r4, ip
+
+a030d6c0 <statushelp>:
+a030d6c0:	74617473 	strvcbt	r7, [r1], -#1139
+a030d6c4:	440a7375 	strmi	r7, [sl], -#885
+a030d6c8:	6c707369 	ldcvsl	3, cr7, [r0], -#420
+a030d6cc:	63207961 	teqvs	r0, #1589248	; 0x184000
+a030d6d0:	65727275 	ldrvsb	r7, [r2, -#629]!
+a030d6d4:	7320746e 	teqvc	r0, #1845493760	; 0x6e000000
+a030d6d8:	75746174 	ldrvcb	r6, [r4, -#372]!
+a030d6dc:	00000a73 	andeq	r0, r0, r3, ror sl
+
+a030d6e0 <reloadhelp>:
+a030d6e0:	6f6c6572 	swivs	0x006c6572
+a030d6e4:	7b206461 	blvc	a0b26870 <__bss_end+0x81446c>
+a030d6e8:	626f6c62 	rsbvs	r6, pc, #25088	; 0x6200
+a030d6ec:	7261707c 	rsbvc	r7, r1, #124	; 0x7c
+a030d6f0:	6b7c6d61 	blvs	a2228c7c <__bss_end+0x1f16878>
+a030d6f4:	656e7265 	strvsb	r7, [lr, -#613]!
+a030d6f8:	61727c6c 	cmnvs	r2, ip, ror #24
+a030d6fc:	7369646d 	cmnvc	r9, #1828716544	; 0x6d000000
+a030d700:	520a7d6b 	andpl	r7, sl, #6848	; 0x1ac0
+a030d704:	616f6c65 	cmnvs	pc, r5, ror #24
+a030d708:	613c2064 	teqvs	ip, r4, rrx
+a030d70c:	6d756772 	ldcvsl	7, cr6, [r5, -#456]!
+a030d710:	3e746e65 	cdpcc	14, 7, cr6, cr4, cr5, {3}
+a030d714:	6f726620 	swivs	0x00726620
+a030d718:	6c66206d 	stcvsl	0, cr2, [r6], -#436
+a030d71c:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030d720:	52206f74 	eorpl	r6, r0, #464	; 0x1d0
+a030d724:	000a4d41 	andeq	r4, sl, r1, asr #26
+
+a030d728 <ptprint_help>:
+a030d728:	72707470 	rsbvcs	r7, r0, #1879048192	; 0x70000000
+a030d72c:	0a746e69 	beq	a20290d8 <__bss_end+0x1d16cd4>
+a030d730:	6e697270 	mcrvs	2, 3, r7, cr9, cr0, {3}
+a030d734:	6c662074 	stcvsl	0, cr2, [r6], -#464
+a030d738:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030d73c:	74726170 	ldrvcbt	r6, [r2], -#368
+a030d740:	6f697469 	swivs	0x00697469
+a030d744:	6174206e 	cmnvs	r4, lr, rrx
+a030d748:	0a656c62 	beq	a1c688d8 <__bss_end+0x19564d4>
+a030d74c:	00000000 	andeq	r0, r0, r0
+
+a030d750 <reblobhelp>:
+a030d750:	6c626572 	cfstr64vs	mvdx6, [r2], -#456
+a030d754:	520a626f 	andpl	r6, sl, #-268435450	; 0xf0000006
+a030d758:	61747365 	cmnvs	r4, r5, ror #6
+a030d75c:	62207472 	eorvs	r7, r0, #1912602624	; 0x72000000
+a030d760:	20626f6c 	rsbcs	r6, r2, ip, ror #30
+a030d764:	6d6f7266 	sfmvs	f7, 2, [pc, -#408]!
+a030d768:	4d415220 	sfmmi	f5, 2, [r1, -#128]
+a030d76c:	0000000a 	andeq	r0, r0, sl
+
+a030d770 <known_loaders>:
+a030d770:	a030d77c 	eorges	sp, r0, ip, ror r7
+a030d774:	00000000 	andeq	r0, r0, r0
+
+a030d778 <fodder_ram_base>:
+a030d778:	c0f00000 	rscgts	r0, r0, r0
+
+a030d77c <zImage_load>:
+a030d77c:	a0303be0 	eorges	r3, r0, r0, ror #23
+a030d780:	a0303c28 	eorges	r3, r0, r8, lsr #24
+a030d784:	a030cb28 	eorges	ip, r0, r8, lsr #22
+
+a030d788 <intel16_flash_driver>:
+a030d788:	a0304080 	eorges	r4, r0, r0, lsl #1
+a030d78c:	a0304120 	eorges	r4, r0, r0, lsr #2
+a030d790:	a03041c8 	eorges	r4, r0, r8, asr #3
+a030d794:	a0304270 	eorges	r4, r0, r0, ror r2
+a030d798:	a0304318 	eorges	r4, r0, r8, lsl r3
+	...
+a030d7a4:	a030438c 	eorges	r4, r0, ip, lsl #7
+
+a030d7a8 <flashwritehelp>:
+a030d7a8:	69727766 	ldmvsdb	r2!, {r1, r2, r5, r6, r8, r9, sl, ip, sp, lr}^
+a030d7ac:	73206574 	teqvc	r0, #486539264	; 0x1d000000
+a030d7b0:	64616372 	strvsbt	r6, [r1], -#882
+a030d7b4:	65642072 	strvsb	r2, [r4, -#114]!
+a030d7b8:	64617473 	strvsbt	r7, [r1], -#1139
+a030d7bc:	69732072 	ldmvsdb	r3!, {r1, r4, r5, r6, sp}^
+a030d7c0:	6228657a 	eorvs	r6, r8, #511705088	; 0x1e800000
+a030d7c4:	73657479 	cmnvc	r5, #2030043136	; 0x79000000
+a030d7c8:	6c660a29 	stcvsl	10, cr0, [r6], -#164
+a030d7cc:	20687361 	rsbcs	r7, r8, r1, ror #6
+a030d7d0:	656d2061 	strvsb	r2, [sp, -#97]!
+a030d7d4:	79726f6d 	ldmvcdb	r2!, {r0, r2, r3, r5, r6, r8, r9, sl, fp, sp, lr}^
+a030d7d8:	67657220 	strvsb	r7, [r5, -r0, lsr #4]!
+a030d7dc:	0a6e6f69 	beq	a1ea9588 <__bss_end+0x1b97184>
+a030d7e0:	00000000 	andeq	r0, r0, r0
+
+a030d7e4 <flasherasehelp>:
+a030d7e4:	61726566 	cmnvs	r2, r6, ror #10
+a030d7e8:	61206573 	teqvs	r0, r3, ror r5
+a030d7ec:	73207264 	teqvc	r0, #1073741830	; 0x40000006
+a030d7f0:	28657a69 	stmcsda	r5!, {r0, r3, r5, r6, r9, fp, ip, sp, lr}^
+a030d7f4:	65747962 	ldrvsb	r7, [r4, -#2402]!
+a030d7f8:	650a2973 	strvs	r2, [sl, -#2419]
+a030d7fc:	65736172 	ldrvsb	r6, [r3, -#370]!
+a030d800:	66206120 	strvst	r6, [r0], -r0, lsr #2
+a030d804:	6873616c 	ldmvsda	r3!, {r2, r3, r5, r6, r8, sp, lr}^
+a030d808:	67657220 	strvsb	r7, [r5, -r0, lsr #4]!
+a030d80c:	0a6e6f69 	beq	a1ea95b8 <__bss_end+0x1b971b4>
+a030d810:	00000000 	andeq	r0, r0, r0
+
+a030d814 <clockinfohelp>:
+a030d814:	636f6c63 	cmnvs	pc, #25344	; 0x6300
+a030d818:	666e696b 	strvsbt	r6, [lr], -fp, ror #18
+a030d81c:	72700a6f 	rsbvcs	r0, r0, #454656	; 0x6f000
+a030d820:	20746e69 	rsbcss	r6, r4, r9, ror #28
+a030d824:	2074756f 	rsbcss	r7, r4, pc, ror #10
+a030d828:	636f7270 	cmnvs	pc, #7	; 0x7
+a030d82c:	6f737365 	swivs	0x00737365
+a030d830:	6c632072 	stcvsl	0, cr2, [r3], -#456
+a030d834:	206b636f 	rsbcs	r6, fp, pc, ror #6
+a030d838:	6f666e69 	swivs	0x00666e69
+a030d83c:	74616d72 	strvcbt	r6, [r1], -#3442
+a030d840:	0a6e6f69 	beq	a1ea95ec <__bss_end+0x1b971e8>
+a030d844:	00000000 	andeq	r0, r0, r0
+
+a030d848 <gohelp>:
+a030d848:	61206f67 	teqvs	r0, r7, ror #30
+a030d84c:	65726464 	ldrvsb	r6, [r2, -#1124]!
+a030d850:	530a7373 	tstpl	sl, #-872415231	; 0xcc000001
+a030d854:	74726174 	ldrvcbt	r6, [r2], -#372
+a030d858:	65786520 	ldrvsb	r6, [r8, -#1312]!
+a030d85c:	69747563 	ldmvsdb	r4!, {r0, r1, r5, r6, r8, sl, ip, sp, lr}^
+a030d860:	61206e6f 	teqvs	r0, pc, ror #28
+a030d864:	61242074 	teqvs	r4, r4, ror r0
+a030d868:	65726464 	ldrvsb	r6, [r2, -#1124]!
+a030d86c:	000a7373 	andeq	r7, sl, r3, ror r3
+
+a030d870 <reset_help>:
+a030d870:	65736572 	ldrvsb	r6, [r3, -#1394]!
+a030d874:	65520a74 	ldrvsb	r0, [r2, -#2676]
+a030d878:	20746573 	rsbcss	r6, r4, r3, ror r5
+a030d87c:	6d726574 	cfldr64vs	mvdx6, [r2, -#464]!
+a030d880:	6c616e69 	stcvsl	14, cr6, [r1], -#420
+a030d884:	0000000a 	andeq	r0, r0, sl
+
+a030d888 <reboot_help>:
+a030d888:	6f626572 	swivs	0x00626572
+a030d88c:	520a746f 	andpl	r7, sl, #1862270976	; 0x6f000000
+a030d890:	6f6f6265 	swivs	0x006f6265
+a030d894:	79732074 	ldmvcdb	r3!, {r2, r4, r5, r6, sp}^
+a030d898:	6d657473 	cfstrdvs	mvd7, [r5, -#460]!
+a030d89c:	0000000a 	andeq	r0, r0, sl
+
+a030d8a0 <bogomips_help>:
+a030d8a0:	6f676f62 	swivs	0x00676f62
+a030d8a4:	7370696d 	cmnvc	r0, #1785856	; 0x1b4000
+a030d8a8:	676f620a 	strvsb	r6, [pc, -sl, lsl #4]!
+a030d8ac:	70696d6f 	rsbvc	r6, r9, pc, ror #26
+a030d8b0:	69672073 	stmvsdb	r7!, {r0, r1, r4, r5, r6, sp}^
+a030d8b4:	20736576 	rsbcss	r6, r3, r6, ror r5
+a030d8b8:	6f422061 	swivs	0x00422061
+a030d8bc:	2c737567 	cfldr64cs	mvdx7, [r3], -#412
+a030d8c0:	61654d20 	cmnvs	r5, r0, lsr #26
+a030d8c4:	676e696e 	strvsb	r6, [lr, -lr, ror #18]!
+a030d8c8:	7373656c 	cmnvc	r3, #452984832	; 0x1b000000
+a030d8cc:	6e49202c 	cdpvs	0, 4, cr2, cr9, cr12, {1}
+a030d8d0:	61636964 	cmnvs	r3, r4, ror #18
+a030d8d4:	6e6f6974 	mcrvs	9, 3, r6, cr15, cr4, {3}
+a030d8d8:	20666f20 	rsbcs	r6, r6, r0, lsr #30
+a030d8dc:	636f7250 	cmnvs	pc, #5	; 0x5
+a030d8e0:	6f737365 	swivs	0x00737365
+a030d8e4:	65500a72 	ldrvsb	r0, [r0, -#2674]
+a030d8e8:	726f6672 	rsbvc	r6, pc, #119537664	; 0x7200000
+a030d8ec:	636e616d 	cmnvs	lr, #1073741851	; 0x4000001b
+a030d8f0:	00000a65 	andeq	r0, r0, r5, ror #20
+
+a030d8f4 <call_help>:
+a030d8f4:	6c6c6163 	stfvse	f6, [ip], -#396
+a030d8f8:	64646120 	strvsbt	r6, [r4], -#288
+a030d8fc:	73736572 	cmnvc	r3, #478150656	; 0x1c800000
+a030d900:	72615b20 	rsbvc	r5, r1, #32768	; 0x8000
+a030d904:	5b203067 	blpl	a0b19aa8 <__bss_end+0x8076a4>
+a030d908:	31677261 	cmncc	r7, r1, ror #4
+a030d90c:	72615b20 	rsbvc	r5, r1, #32768	; 0x8000
+a030d910:	5b203267 	blpl	a0b1a2b4 <__bss_end+0x807eb0>
+a030d914:	33677261 	cmncc	r7, #268435462	; 0x10000006
+a030d918:	5d5d5d5d 	ldcpll	13, cr5, [sp, -#372]
+a030d91c:	6c61430a 	stcvsl	3, cr4, [r1], -#40
+a030d920:	7566206c 	strvcb	r2, [r6, -#108]!
+a030d924:	6974636e 	ldmvsdb	r4!, {r1, r2, r3, r5, r6, r8, r9, sp, lr}^
+a030d928:	61206e6f 	teqvs	r0, pc, ror #28
+a030d92c:	613c2074 	teqvs	ip, r4, ror r0
+a030d930:	65726464 	ldrvsb	r6, [r2, -#1124]!
+a030d934:	203e7373 	eorcss	r7, lr, r3, ror r3
+a030d938:	68746977 	ldmvsda	r4!, {r0, r1, r2, r4, r5, r6, r8, fp, sp, lr}^
+a030d93c:	74706f20 	ldrvcbt	r6, [r0], -#3872
+a030d940:	616e6f69 	cmnvs	lr, r9, ror #30
+a030d944:	7261206c 	rsbvc	r2, r1, #108	; 0x6c
+a030d948:	656d7567 	strvsb	r7, [sp, -#1383]!
+a030d94c:	0a73746e 	beq	a1feab0c <__bss_end+0x1cd8708>
+a030d950:	00000000 	andeq	r0, r0, r0
+
+a030d954 <chgbit_help>:
+a030d954:	62676863 	rsbvs	r6, r7, #6488064	; 0x630000
+a030d958:	61207469 	teqvs	r0, r9, ror #8
+a030d95c:	65726464 	ldrvsb	r6, [r2, -#1124]!
+a030d960:	76207373 	undefined
+a030d964:	65756c61 	ldrvsb	r6, [r5, -#3169]!
+a030d968:	6e617b20 	cdpvs	11, 6, cr7, cr1, cr0, {1}
+a030d96c:	726f7c64 	rsbvc	r7, pc, #25600	; 0x6400
+a030d970:	726f787c 	rsbvc	r7, pc, #8126464	; 0x7c0000
+a030d974:	7465737c 	strvcbt	r7, [r5], -#892
+a030d978:	656c637c 	strvsb	r6, [ip, -#892]!
+a030d97c:	0a7d7261 	beq	a226a308 <__bss_end+0x1f57f04>
+a030d980:	00000000 	andeq	r0, r0, r0
+
+a030d984 <dummy_help>:
+a030d984:	6d6d7564 	cfstr64vs	mvdx7, [sp, -#400]!
+a030d988:	75440a79 	strvcb	r0, [r4, -#2681]
+a030d98c:	20796d6d 	rsbcss	r6, r9, sp, ror #26
+a030d990:	6d6d6f63 	stcvsl	15, cr6, [sp, -#396]!
+a030d994:	20646e61 	rsbcs	r6, r4, r1, ror #28
+a030d998:	74616874 	strvcbt	r6, [r1], -#2164
+a030d99c:	6c6e6f20 	stcvsl	15, cr6, [lr], -#128
+a030d9a0:	68732079 	ldmvsda	r3!, {r0, r3, r4, r5, r6, sp}^
+a030d9a4:	2073776f 	rsbcss	r7, r3, pc, ror #14
+a030d9a8:	206c6c61 	rsbcs	r6, ip, r1, ror #24
+a030d9ac:	75677261 	strvcb	r7, [r7, -#609]!
+a030d9b0:	746e656d 	strvcbt	r6, [lr], -#1389
+a030d9b4:	6e612073 	mcrvs	0, 3, r2, cr1, cr3, {3}
+a030d9b8:	65722064 	ldrvsb	r2, [r2, -#100]!
+a030d9bc:	6e727574 	mrcvs	5, 3, r7, cr2, cr4, {3}
+a030d9c0:	00000a73 	andeq	r0, r0, r3, ror sl
+
+a030d9c4 <address.0>:
+a030d9c4:	00000000 	andeq	r0, r0, r0
+
+a030d9c8 <dump_help>:
+a030d9c8:	706d7564 	rsbvc	r7, sp, r4, ror #10
+a030d9cc:	64615b20 	strvsbt	r5, [r1], -#2848
+a030d9d0:	73657264 	cmnvc	r5, #1073741830	; 0x40000006
+a030d9d4:	655b2073 	ldrvsb	r2, [fp, -#115]
+a030d9d8:	6441646e 	strvsb	r6, [r1], -#1134
+a030d9dc:	73657264 	cmnvc	r5, #1073741830	; 0x40000006
+a030d9e0:	0a5d5d73 	beq	a1a64fb4 <__bss_end+0x1752bb0>
+a030d9e4:	00000000 	andeq	r0, r0, r0
+
+a030d9e8 <memcpy_help>:
+a030d9e8:	636d656d 	cmnvs	sp, #457179136	; 0x1b400000
+a030d9ec:	73207970 	teqvc	r0, #1835008	; 0x1c0000
+a030d9f0:	64206372 	strvst	r6, [r0], -#882
+a030d9f4:	6c207473 	cfstrsvs	mvf7, [r0], -#460
+a030d9f8:	630a6e65 	tstvs	sl, #1616	; 0x650
+a030d9fc:	2079706f 	rsbcss	r7, r9, pc, rrx
+a030da00:	206e656c 	rsbcs	r6, lr, ip, ror #10
+a030da04:	65747962 	ldrvsb	r7, [r4, -#2402]!
+a030da08:	72662073 	rsbvc	r2, r6, #115	; 0x73
+a030da0c:	73206d6f 	teqvc	r0, #7104	; 0x1bc0
+a030da10:	74206372 	strvct	r6, [r0], -#882
+a030da14:	7364206f 	cmnvc	r4, #111	; 0x6f
+a030da18:	00000a74 	andeq	r0, r0, r4, ror sl
+
+a030da1c <peek_help>:
+a030da1c:	6b656570 	blvs	a1c66fe4 <__bss_end+0x1954be0>
+a030da20:	64646120 	strvsbt	r6, [r4], -#288
+a030da24:	73736572 	cmnvc	r3, #478150656	; 0x1c800000
+a030da28:	7c625b20 	stcvcl	11, cr5, [r2], -#128
+a030da2c:	5d777c68 	ldcpll	12, cr7, [r7, -#416]!
+a030da30:	3d20620a 	sfmcc	f6, 4, [r0, -#40]!
+a030da34:	74796220 	ldrvcbt	r6, [r9], -#544
+a030da38:	68202c65 	stmvsda	r0!, {r0, r2, r5, r6, sl, fp, sp}
+a030da3c:	68203d20 	stmvsda	r0!, {r5, r8, sl, fp, ip, sp}
+a030da40:	20666c61 	rsbcs	r6, r6, r1, ror #24
+a030da44:	64726f77 	ldrvsbt	r6, [r2], -#3959
+a030da48:	2077202c 	rsbcss	r2, r7, ip, lsr #32
+a030da4c:	6f77203d 	swivs	0x0077203d
+a030da50:	28206472 	stmcsda	r0!, {r1, r4, r5, r6, sl, sp, lr}
+a030da54:	61666564 	cmnvs	r6, r4, ror #10
+a030da58:	20746c75 	rsbcss	r6, r4, r5, ror ip
+a030da5c:	77207369 	strvc	r7, [r0, -r9, ror #6]!
+a030da60:	00000a29 	andeq	r0, r0, r9, lsr #20
+
+a030da64 <poke_help>:
+a030da64:	656b6f70 	strvsb	r6, [fp, -#3952]!
+a030da68:	64646120 	strvsbt	r6, [r4], -#288
+a030da6c:	73736572 	cmnvc	r3, #478150656	; 0x1c800000
+a030da70:	6c617620 	stcvsl	6, cr7, [r1], -#128
+a030da74:	5b206575 	blpl	a0b27050 <__bss_end+0x814c4c>
+a030da78:	7c687c62 	stcvcl	12, cr7, [r8], -#392
+a030da7c:	620a5d77 	andvs	r5, sl, #7616	; 0x1dc0
+a030da80:	62203d20 	eorvs	r3, r0, #2048	; 0x800
+a030da84:	2c657479 	cfstrdcs	mvd7, [r5], -#484
+a030da88:	3d206820 	stccc	8, cr6, [r0, -#128]!
+a030da8c:	6c616820 	stcvsl	8, cr6, [r1], -#128
+a030da90:	6f772066 	swivs	0x00772066
+a030da94:	202c6472 	eorcs	r6, ip, r2, ror r4
+a030da98:	203d2077 	eorcss	r2, sp, r7, ror r0
+a030da9c:	64726f77 	ldrvsbt	r6, [r2], -#3959
+a030daa0:	65642820 	strvsb	r2, [r4, -#2080]!
+a030daa4:	6c756166 	ldfvse	f6, [r5], -#408
+a030daa8:	73692074 	cmnvc	r9, #116	; 0x74
+a030daac:	0a297720 	beq	a0d6b734 <__bss_end+0xa59330>
+a030dab0:	00000000 	andeq	r0, r0, r0
+
+a030dab4 <md5chk_help>:
+a030dab4:	6335646d 	teqvs	r5, #1828716544	; 0x6d000000
+a030dab8:	61206b68 	teqvs	r0, r8, ror #22
+a030dabc:	73657264 	cmnvc	r5, #1073741830	; 0x40000006
+a030dac0:	656c2073 	strvsb	r2, [ip, -#115]!
+a030dac4:	630a0a6e 	tstvs	sl, #450560	; 0x6e000
+a030dac8:	75636c61 	strvcb	r6, [r3, -#3169]!
+a030dacc:	6574616c 	ldrvsb	r6, [r4, -#364]!
+a030dad0:	35646d20 	strccb	r6, [r4, -#3360]!
+a030dad4:	73616820 	cmnvc	r1, #2097152	; 0x200000
+a030dad8:	61762068 	cmnvs	r6, r8, rrx
+a030dadc:	0a65756c 	beq	a1c6b094 <__bss_end+0x1958c90>
+a030dae0:	00000000 	andeq	r0, r0, r0
+
+a030dae4 <xdownload_help>:
+a030dae4:	776f6478 	undefined
+a030dae8:	616f6c6e 	cmnvs	pc, lr, ror #24
+a030daec:	627b2064 	rsbvss	r2, fp, #100	; 0x64
+a030daf0:	7c626f6c 	stcvcl	15, cr6, [r2], -#432
+a030daf4:	61726170 	cmnvs	r2, r0, ror r1
+a030daf8:	656b7c6d 	strvsb	r7, [fp, -#3181]!
+a030dafc:	6c656e72 	stcvsl	14, cr6, [r5], -#456
+a030db00:	6d61727c 	sfmvs	f7, 2, [r1, -#496]!
+a030db04:	6b736964 	blvs	a1fe809c <__bss_end+0x1cd5c98>
+a030db08:	6f440a7d 	swivs	0x00440a7d
+a030db0c:	6f6c6e77 	swivs	0x006c6e77
+a030db10:	3c206461 	cfstrscc	mvf6, [r0], -#388
+a030db14:	75677261 	strvcb	r7, [r7, -#609]!
+a030db18:	746e656d 	strvcbt	r6, [lr], -#1389
+a030db1c:	6d69203e 	stcvsl	0, cr2, [r9, -#248]!
+a030db20:	20656761 	rsbcs	r6, r5, r1, ror #14
+a030db24:	52206f74 	eorpl	r6, r0, #464	; 0x1d0
+a030db28:	75204d41 	strvc	r4, [r0, -#3393]!
+a030db2c:	676e6973 	undefined
+a030db30:	6f6d7820 	swivs	0x006d7820
+a030db34:	0a6d6564 	beq	a1e670cc <__bss_end+0x1b54cc8>
+a030db38:	00000000 	andeq	r0, r0, r0
+
+a030db3c <helphelp>:
+a030db3c:	706c6568 	rsbvc	r6, ip, r8, ror #10
+a030db40:	6f635b20 	swivs	0x00635b20
+a030db44:	6e616d6d 	cdpvs	13, 6, cr6, cr1, cr13, {3}
+a030db48:	470a5d64 	strmi	r5, [sl, -r4, ror #26]
+a030db4c:	68207465 	stmvsda	r0!, {r0, r2, r5, r6, sl, ip, sp, lr}
+a030db50:	20706c65 	rsbcss	r6, r0, r5, ror #24
+a030db54:	5b206e6f 	blpl	a0b29518 <__bss_end+0x817114>
+a030db58:	6d6d6f63 	stcvsl	15, cr6, [sp, -#396]!
+a030db5c:	5d646e61 	stcpll	14, cr6, [r4, -#388]!
+a030db60:	726f202c 	rsbvc	r2, pc, #44	; 0x2c
+a030db64:	6c206120 	stfvss	f6, [r0], -#128
+a030db68:	20747369 	rsbcss	r7, r4, r9, ror #6
+a030db6c:	7320666f 	teqvc	r0, #116391936	; 0x6f00000
+a030db70:	6f707075 	swivs	0x00707075
+a030db74:	64657472 	strvsbt	r7, [r5], -#1138
+a030db78:	6d6f6320 	stcvsl	3, cr6, [pc, -#128]!
+a030db7c:	646e616d 	strvsbt	r6, [lr], -#365
+a030db80:	66692073 	undefined
+a030db84:	63206120 	teqvs	r0, #8	; 0x8
+a030db88:	616d6d6f 	cmnvs	sp, pc, ror #26
+a030db8c:	6920646e 	stmvsdb	r0!, {r1, r2, r3, r5, r6, sl, sp, lr}
+a030db90:	6d6f2073 	stcvsl	0, cr2, [pc, -#460]!
+a030db94:	65747469 	ldrvsb	r7, [r4, -#1129]!
+a030db98:	000a2e64 	andeq	r2, sl, r4, ror #28
+
+a030db9c <speedhelp>:
+a030db9c:	65657073 	strvsb	r7, [r5, -#115]!
+a030dba0:	625b2064 	subvss	r2, fp, #100	; 0x64
+a030dba4:	72647561 	rsbvc	r7, r4, #406847488	; 0x18400000
+a030dba8:	5d657461 	cfstrdpl	mvd7, [r5, -#388]!
+a030dbac:	7465530a 	strvcbt	r5, [r5], -#778
+a030dbb0:	776f6420 	strvcb	r6, [pc, -r0, lsr #8]!
+a030dbb4:	616f6c6e 	cmnvs	pc, lr, ror #24
+a030dbb8:	70732064 	rsbvcs	r2, r3, r4, rrx
+a030dbbc:	2e646565 	cdpcs	5, 6, cr6, cr4, cr5, {3}
+a030dbc0:	6c615620 	stcvsl	6, cr5, [r1], -#128
+a030dbc4:	62206469 	eorvs	r6, r0, #1761607680	; 0x69000000
+a030dbc8:	72647561 	rsbvc	r7, r4, #406847488	; 0x18400000
+a030dbcc:	73657461 	cmnvc	r5, #1627389952	; 0x61000000
+a030dbd0:	65726120 	ldrvsb	r6, [r2, -#288]!
+a030dbd4:	32310a3a 	eorccs	r0, r1, #237568	; 0x3a000
+a030dbd8:	202c3030 	eorcs	r3, ip, r0, lsr r0
+a030dbdc:	30303639 	eorccs	r3, r0, r9, lsr r6
+a030dbe0:	3931202c 	ldmccdb	r1!, {r2, r3, r5, sp}
+a030dbe4:	2c303032 	ldccs	0, cr3, [r0], -#200
+a030dbe8:	34383320 	ldrcct	r3, [r8], -#800
+a030dbec:	202c3030 	eorcs	r3, ip, r0, lsr r0
+a030dbf0:	30363735 	eorccs	r3, r6, r5, lsr r7
+a030dbf4:	31202c30 	teqcc	r0, r0, lsr ip
+a030dbf8:	30323531 	eorccs	r3, r2, r1, lsr r5
+a030dbfc:	32202c30 	eorcc	r2, r0, #12288	; 0x3000
+a030dc00:	30343033 	eorccs	r3, r4, r3, lsr r0
+a030dc04:	200a2c30 	andcs	r2, sl, r0, lsr ip
+a030dc08:	2c326b31 	ldccs	11, cr6, [r2], -#196
+a030dc0c:	6b392020 	blvs	a1155c94 <__bss_end+0xe43890>
+a030dc10:	20202c36 	eorcs	r2, r0, r6, lsr ip
+a030dc14:	326b3931 	rsbcc	r3, fp, #802816	; 0xc4000
+a030dc18:	3320202c 	teqcc	r0, #44	; 0x2c
+a030dc1c:	2c346b38 	ldccs	11, cr6, [r4], -#224
+a030dc20:	37352020 	ldrcc	r2, [r5, -r0, lsr #32]!
+a030dc24:	202c366b 	eorcs	r3, ip, fp, ror #12
+a030dc28:	35313120 	ldrcc	r3, [r1, -#288]!
+a030dc2c:	202c326b 	eorcs	r3, ip, fp, ror #4
+a030dc30:	30333220 	eorccs	r3, r3, r0, lsr #4
+a030dc34:	000a346b 	andeq	r3, sl, fp, ror #8
+
+a030dc38 <error_strings>:
+a030dc38:	a030d2b0 	ldrgeh	sp, [r0], -r0
+a030dc3c:	a030d2bc 	ldrgeh	sp, [r0], -ip
+a030dc40:	a030d2d0 	ldrgesb	sp, [r0], -r0
+a030dc44:	a030d2e8 	eorges	sp, r0, r8, ror #5
+a030dc48:	a030d2fc 	ldrgesh	sp, [r0], -ip
+a030dc4c:	a030d30c 	eorges	sp, r0, ip, lsl #6
+a030dc50:	a030d31c 	eorges	sp, r0, ip, lsl r3
+a030dc54:	a030d32c 	eorges	sp, r0, ip, lsr #6
+a030dc58:	a030d33c 	eorges	sp, r0, ip, lsr r3
+a030dc5c:	a030d350 	eorges	sp, r0, r0, asr r3
+a030dc60:	a030d35c 	eorges	sp, r0, ip, asr r3
+a030dc64:	a030d368 	eorges	sp, r0, r8, ror #6
+a030dc68:	a030d37c 	eorges	sp, r0, ip, ror r3
+a030dc6c:	a030d394 	mlages	r0, r4, r3, sp
+a030dc70:	a030d3a8 	eorges	sp, r0, r8, lsr #7
+
+a030dc74 <unknown>:
+a030dc74:	a030d3bc 	ldrgeh	sp, [r0], -ip
+
+a030dc78 <errprefix>:
+a030dc78:	a030d3cc 	eorges	sp, r0, ip, asr #7
+
+a030dc7c <hwaddress>:
+a030dc7c:	05040302 	streq	r0, [r4, -#770]
+a030dc80:	00000706 	andeq	r0, r0, r6, lsl #14
+
+a030dc84 <pxa_reboot_driver>:
+a030dc84:	a030b9b0 	ldrgeh	fp, [r0], -r0
+
+a030dc88 <pxa_serial_driver>:
+a030dc88:	a030ba88 	eorges	fp, r0, r8, lsl #21
+a030dc8c:	a030bc50 	eorges	fp, r0, r0, asr ip
+a030dc90:	a030bcb0 	ldrgeh	fp, [r0], -r0
+a030dc94:	a030bbe8 	eorges	fp, r0, r8, ror #23
+a030dc98:	a030b9dc 	ldrgesb	fp, [r0], -ip
+a030dc9c:	a030ba54 	eorges	fp, r0, r4, asr sl
+
+a030dca0 <intelarm_timer_driver>:
+a030dca0:	a030bcfc 	ldrgesh	fp, [r0], -ip
+a030dca4:	a030bd60 	eorges	fp, r0, r0, ror #26
+a030dca8:	a030bd80 	eorges	fp, r0, r0, lsl #27
+a030dcac:	a030bda4 	eorges	fp, r0, r4, lsr #27
+a030dcb0:	00384000 	eoreqs	r4, r8, r0
+Disassembly of section .commandlist:
+
+a030dcb4 <__commandlist_start>:
+a030dcb4:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dcb8:	a030c0a8 	eorges	ip, r0, r8, lsr #1
+a030dcbc:	a030d870 	eorges	sp, r0, r0, ror r8
+a030dcc0:	a0305320 	eorges	r5, r0, r0, lsr #6
+a030dcc4:	00000000 	andeq	r0, r0, r0
+
+a030dcc8 <__command_reboot_cmd>:
+a030dcc8:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dccc:	a030c0b0 	ldrgeh	ip, [r0], -r0
+a030dcd0:	a030d888 	eorges	sp, r0, r8, lsl #17
+a030dcd4:	a030539c 	mlages	r0, ip, r3, r5
+a030dcd8:	00000000 	andeq	r0, r0, r0
+
+a030dcdc <__command_bogomips_cmd>:
+a030dcdc:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dce0:	a030c0b8 	ldrgeh	ip, [r0], -r8
+a030dce4:	a030d8a0 	eorges	sp, r0, r0, lsr #17
+a030dce8:	a03053d4 	ldrgesb	r5, [r0], -r4
+a030dcec:	00000000 	andeq	r0, r0, r0
+
+a030dcf0 <__command_call_cmd>:
+a030dcf0:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dcf4:	a030c0c4 	eorges	ip, r0, r4, asr #1
+a030dcf8:	a030d8f4 	ldrgesh	sp, [r0], -r4
+a030dcfc:	a03054d0 	ldrgesb	r5, [r0], -r0
+a030dd00:	00000000 	andeq	r0, r0, r0
+
+a030dd04 <__command_chgbit_cmd>:
+a030dd04:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd08:	a030c0cc 	eorges	ip, r0, ip, asr #1
+a030dd0c:	a030d954 	eorges	sp, r0, r4, asr r9
+a030dd10:	a03056d8 	ldrgesb	r5, [r0], -r8
+a030dd14:	00000000 	andeq	r0, r0, r0
+
+a030dd18 <__command_dummy_cmd>:
+a030dd18:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd1c:	a030c0d4 	ldrgesb	ip, [r0], -r4
+a030dd20:	a030d984 	eorges	sp, r0, r4, lsl #19
+a030dd24:	a03058ec 	eorges	r5, r0, ip, ror #17
+a030dd28:	00000000 	andeq	r0, r0, r0
+
+a030dd2c <__command_dump_cmd>:
+a030dd2c:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd30:	a030c0dc 	ldrgesb	ip, [r0], -ip
+a030dd34:	a030d9c8 	eorges	sp, r0, r8, asr #19
+a030dd38:	a0305960 	eorges	r5, r0, r0, ror #18
+a030dd3c:	00000000 	andeq	r0, r0, r0
+
+a030dd40 <__command_md5chk_cmd>:
+a030dd40:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd44:	a030c0e4 	eorges	ip, r0, r4, ror #1
+a030dd48:	a030dab4 	ldrgeh	sp, [r0], -r4
+a030dd4c:	a03060f0 	ldrgesh	r6, [r0], -r0
+a030dd50:	00000000 	andeq	r0, r0, r0
+
+a030dd54 <__command_memcpy_cmd>:
+a030dd54:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd58:	a030c0ec 	eorges	ip, r0, ip, ror #1
+a030dd5c:	a030d9e8 	eorges	sp, r0, r8, ror #19
+a030dd60:	a0305b94 	mlages	r0, r4, fp, r5
+a030dd64:	00000000 	andeq	r0, r0, r0
+
+a030dd68 <__command_poke_cmd>:
+a030dd68:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd6c:	a030c0f4 	ldrgesh	ip, [r0], -r4
+a030dd70:	a030da64 	eorges	sp, r0, r4, ror #20
+a030dd74:	a0305ef0 	ldrgesh	r5, [r0], -r0
+a030dd78:	00000000 	andeq	r0, r0, r0
+
+a030dd7c <__command_peek_cmd>:
+a030dd7c:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd80:	a030c0fc 	ldrgesh	ip, [r0], -ip
+a030dd84:	a030da1c 	eorges	sp, r0, ip, lsl sl
+a030dd88:	a0305d14 	eorges	r5, r0, r4, lsl sp
+a030dd8c:	00000000 	andeq	r0, r0, r0
+
+a030dd90 <__command_xdownload_cmd>:
+a030dd90:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dd94:	a030c104 	eorges	ip, r0, r4, lsl #2
+a030dd98:	a030dae4 	eorges	sp, r0, r4, ror #21
+a030dd9c:	a03061dc 	ldrgesb	r6, [r0], -ip
+a030dda0:	00000000 	andeq	r0, r0, r0
+
+a030dda4 <__command_Flash>:
+a030dda4:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dda8:	a030c3dc 	ldrgesb	ip, [r0], -ip
+a030ddac:	a030d514 	eorges	sp, r0, r4, lsl r5
+a030ddb0:	a0301634 	eorges	r1, r0, r4, lsr r6
+a030ddb4:	00000000 	andeq	r0, r0, r0
+
+a030ddb8 <__command_Lock>:
+a030ddb8:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030ddbc:	a030c3e4 	eorges	ip, r0, r4, ror #7
+a030ddc0:	a030d5a8 	eorges	sp, r0, r8, lsr #11
+a030ddc4:	a0301924 	eorges	r1, r0, r4, lsr #18
+a030ddc8:	00000000 	andeq	r0, r0, r0
+
+a030ddcc <__command_Unlock>:
+a030ddcc:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030ddd0:	a030c3ec 	eorges	ip, r0, ip, ror #7
+a030ddd4:	a030d5dc 	ldrgesb	sp, [r0], -ip
+a030ddd8:	a0301a48 	eorges	r1, r0, r8, asr #20
+a030dddc:	00000000 	andeq	r0, r0, r0
+
+a030dde0 <__command_Erase>:
+a030dde0:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dde4:	a030c3f4 	ldrgesh	ip, [r0], -r4
+a030dde8:	a030d614 	eorges	sp, r0, r4, lsl r6
+a030ddec:	a0301b6c 	eorges	r1, r0, ip, ror #22
+a030ddf0:	00000000 	andeq	r0, r0, r0
+
+a030ddf4 <__command_boot_linux>:
+a030ddf4:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030ddf8:	a030c46c 	eorges	ip, r0, ip, ror #8
+a030ddfc:	a030d64c 	eorges	sp, r0, ip, asr #12
+a030de00:	a0301ca8 	eorges	r1, r0, r8, lsr #25
+a030de04:	00000000 	andeq	r0, r0, r0
+
+a030de08 <__command_cmd_kernel>:
+a030de08:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de0c:	a030c48c 	eorges	ip, r0, ip, lsl #9
+a030de10:	a030d68c 	eorges	sp, r0, ip, lsl #13
+a030de14:	a0301d54 	eorges	r1, r0, r4, asr sp
+a030de18:	00000000 	andeq	r0, r0, r0
+
+a030de1c <__command_PrintStatus>:
+a030de1c:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de20:	a030c740 	eorges	ip, r0, r0, asr #14
+a030de24:	a030d6c0 	eorges	sp, r0, r0, asr #13
+a030de28:	a03025d8 	ldrgesb	r2, [r0], -r8
+a030de2c:	00000000 	andeq	r0, r0, r0
+
+a030de30 <__command_Reload>:
+a030de30:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de34:	a030c748 	eorges	ip, r0, r8, asr #14
+a030de38:	a030d6e0 	eorges	sp, r0, r0, ror #13
+a030de3c:	a030276c 	eorges	r2, r0, ip, ror #14
+a030de40:	00000000 	andeq	r0, r0, r0
+
+a030de44 <__command_ptprint>:
+a030de44:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de48:	a030ca58 	eorges	ip, r0, r8, asr sl
+a030de4c:	a030d728 	eorges	sp, r0, r8, lsr #14
+a030de50:	a030397c 	eorges	r3, r0, ip, ror r9
+a030de54:	00000000 	andeq	r0, r0, r0
+
+a030de58 <__command_reblob>:
+a030de58:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de5c:	a030ca98 	mlages	r0, r8, sl, ip
+a030de60:	a030d750 	eorges	sp, r0, r0, asr r7
+a030de64:	a03039ac 	eorges	r3, r0, ip, lsr #19
+a030de68:	00000000 	andeq	r0, r0, r0
+
+a030de6c <__command_cmd_flash_write>:
+a030de6c:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de70:	a030cd9c 	mlages	r0, ip, sp, ip
+a030de74:	a030d7a8 	eorges	sp, r0, r8, lsr #15
+a030de78:	a03046b4 	ldrgeh	r4, [r0], -r4
+a030de7c:	00000000 	andeq	r0, r0, r0
+
+a030de80 <__command_cmd_flash_erase>:
+a030de80:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de84:	a030cda4 	eorges	ip, r0, r4, lsr #27
+a030de88:	a030d7e4 	eorges	sp, r0, r4, ror #15
+a030de8c:	a03047dc 	ldrgesb	r4, [r0], -ip
+a030de90:	00000000 	andeq	r0, r0, r0
+
+a030de94 <__command_cmd_clock_info>:
+a030de94:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030de98:	a030ce6c 	eorges	ip, r0, ip, ror #28
+a030de9c:	a030d814 	eorges	sp, r0, r4, lsl r8
+a030dea0:	a03048bc 	ldrgeh	r4, [r0], -ip
+a030dea4:	00000000 	andeq	r0, r0, r0
+
+a030dea8 <__command_cmd_go>:
+a030dea8:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030deac:	a030ce9c 	mlages	r0, ip, lr, ip
+a030deb0:	a030d848 	eorges	sp, r0, r8, asr #16
+a030deb4:	a0304cc4 	eorges	r4, r0, r4, asr #25
+a030deb8:	00000000 	andeq	r0, r0, r0
+
+a030debc <__command_help>:
+a030debc:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030dec0:	a030d140 	eorges	sp, r0, r0, asr #2
+a030dec4:	a030db3c 	eorges	sp, r0, ip, lsr fp
+a030dec8:	a03067ec 	eorges	r6, r0, ip, ror #15
+a030decc:	00000000 	andeq	r0, r0, r0
+
+a030ded0 <__command_SetDownloadSpeed>:
+a030ded0:	436d6420 	cmnmi	sp, #536870912	; 0x20000000
+a030ded4:	a030d2a8 	eorges	sp, r0, r8, lsr #5
+a030ded8:	a030db9c 	mlages	r0, ip, fp, sp
+a030dedc:	a0306fcc 	eorges	r6, r0, ip, asr #31
+a030dee0:	00000000 	andeq	r0, r0, r0
+Disassembly of section .initlist:
+
+a030dee4 <__initlist_start>:
+a030dee4:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030dee8:	a03005b4 	ldrgeh	r0, [r0], -r4
+a030deec:	00000029 	andeq	r0, r0, r9, lsr #32
+
+a030def0 <__init_serial_default_init>:
+a030def0:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030def4:	a0301c90 	mlages	r0, r0, ip, r1
+a030def8:	0000000a 	andeq	r0, r0, sl
+
+a030defc <__init_enable_icache>:
+a030defc:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030df00:	a03076b4 	ldrgeh	r7, [r0], -r4
+a030df04:	0000000a 	andeq	r0, r0, sl
+
+a030df08 <__init_timer_init>:
+a030df08:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030df0c:	a030b6bc 	ldrgeh	fp, [r0], -ip
+a030df10:	0000001e 	andeq	r0, r0, lr, lsl r0
+
+a030df14 <__init_ptable_init>:
+a030df14:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030df18:	a03034e8 	eorges	r3, r0, r8, ror #9
+a030df1c:	0000002a 	andeq	r0, r0, sl, lsr #32
+
+a030df20 <__init_mainstone_init_hardware>:
+a030df20:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030df24:	a030461c 	eorges	r4, r0, ip, lsl r6
+a030df28:	00000000 	andeq	r0, r0, r0
+
+a030df2c <__init_init_commands>:
+a030df2c:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030df30:	a0306410 	eorges	r6, r0, r0, lsl r4
+a030df34:	00000028 	andeq	r0, r0, r8, lsr #32
+
+a030df38 <__init_ether_init>:
+a030df38:	496e6974 	stmmidb	lr!, {r2, r4, r5, r6, r8, fp, sp, lr}^
+a030df3c:	a0307490 	mlages	r0, r0, r4, r7
+a030df40:	0000001e 	andeq	r0, r0, lr, lsl r0
+Disassembly of section .exitlist:
+
+a030df44 <__exitlist_start>:
+a030df44:	45786974 	ldrmib	r6, [r8, -#2420]!
+a030df48:	a03076d0 	ldrgesb	r7, [r0], -r0
+a030df4c:	0000000a 	andeq	r0, r0, sl
+Disassembly of section .ptaglist:
+
+a030df50 <__ptagtable_begin>:
+a030df50:	32d27009 	sbcccs	r7, r2, #9	; 0x9
+a030df54:	a0302b8c 	eorges	r2, r0, ip, lsl #23
+
+a030df58 <__ptagtable_parse_ptag_ramdisk>:
+a030df58:	32d2700a 	sbcccs	r7, r2, #10	; 0xa
+a030df5c:	a0302bcc 	eorges	r2, r0, ip, asr #23
+
+a030df60 <__ptagtable_parse_ptag_bootdelay>:
+a030df60:	32d2700b 	sbcccs	r7, r2, #11	; 0xb
+a030df64:	a0302c04 	eorges	r2, r0, r4, lsl #24
+
+a030df68 <__ptagtable_parse_ptag_cmdline>:
+a030df68:	32d2700c 	sbcccs	r7, r2, #12	; 0xc
+a030df6c:	a0302c38 	eorges	r2, r0, r8, lsr ip
+
+a030df70 <__ptagtable_parse_ptag_baud>:
+a030df70:	32d2700d 	sbcccs	r7, r2, #13	; 0xd
+a030df74:	a0302c74 	eorges	r2, r0, r4, ror ip
+
+a030df78 <__ptagtable_parse_ptag_hwaddr>:
+a030df78:	32d2700f 	sbcccs	r7, r2, #15	; 0xf
+a030df7c:	a0302ca8 	eorges	r2, r0, r8, lsr #25
Index: build_tree/bootLoader/src/blob/shannon.c
diff -u build_tree/bootLoader/src/blob/shannon.c:1.1.1.1 build_tree/bootLoader/src/blob/shannon.c:1.1.1.2
--- build_tree/bootLoader/src/blob/shannon.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/shannon.c	Fri Nov  9 09:44:05 2007
@@ -19,26 +19,36 @@
  *
  */
 
-#ident "$Id: shannon.c,v 1.6 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: shannon.c,v 1.14 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/main.h>
 #include <blob/flash.h>
 #include <blob/init.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
-
-
-
+#include <blob/led.h>
+#include <blob/time.h>
 
 /* flash descriptor for SHANNON flash */
 /* 2x AMD *whatever* flash (4MB) */
-static flash_descriptor_t shannon_flash_descriptors[] =
+static const flash_descriptor_t shannon_flash_descriptors[] =
 {
+	
+	{ 
+		size: 2 * 16 * 1024,
+		num: 1,
+	},
 	{ 
 		size: 2 * 8 * 1024,
-		num: 8,
+		num: 2,
+	},
+	{ 
+		size: 2 * 32 * 1024,
+		num: 1,
 	},
 	{
 		size: 2 * 64 * 1024,
@@ -49,9 +59,6 @@
 	},
 };
 
-
-
-
 static void init_shannon_flash_driver(void)
 {
 	flash_descriptors = shannon_flash_descriptors;
@@ -60,13 +67,16 @@
 
 __initlist(init_shannon_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
 
-
-
-
 static void shannon_init_hardware(void)
 {
-	/* select serial driver */
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+
+	/* tweak blob config */
+	blob_status.boot_delay = 1;
 }
 
 __initlist(shannon_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/smdk2500.c
diff -u /dev/null build_tree/bootLoader/src/blob/smdk2500.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/smdk2500.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,152 @@
+/*
+ * smdk2500.c: smdk2500 specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003  Russ Dill (Russ.Dill@asu.edu)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: smdk2500.c,v 1.2 2003/09/04 18:34:25 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/led.h>
+#include <blob/time.h>
+#include <blob/partition.h>
+#include <blob/arch.h>
+#include <net/ether.h>
+
+
+/* flash descriptor for smdk2500 flash */
+/* 1x Am29LV160DB (2MB) */
+static const flash_descriptor_t smdk2500_flash_descriptors[] =
+{
+	{
+		size: 16 * 1024,
+		num: 1,
+		lockable: 1
+	},
+	{
+		size: 8 * 1024,
+		num: 2,
+		lockable: 1
+	},
+	{
+		size: 32 * 1024,
+		num: 1,
+		lockable: 1
+	},
+	{
+		size: 64 * 1024,
+		num: 31,
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+
+/* default partition table for the SMDK2500 */
+static const blob_partition_t smdk2500_default_partition_table[] = {
+	{
+		/* start of table */
+		magic:	BLOB_DEFAULT_PART_TABLE_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	0x00000000,	/* absolute base address */
+		size:	2 * 1024 * 1024 /* total size of the flash */
+	},
+	{
+		/* blob itself */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		BLOB_FLASH_BASE,
+		size:		BLOB_FLASH_LEN,
+		name:		"blob",
+		mem_base:	BLOB_RAM_BASE
+	},
+	{
+		/* parameter block */
+		magic:	BLOB_PART_VALID_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	PARAM_FLASH_BASE,
+		size:	PARAM_FLASH_LEN,
+		name:	"param",
+		flags:	BLOB_PART_FLAG_PTABLE
+	},
+	{
+		/* kernel */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset: 	KERNEL_FLASH_BASE,
+		size:		KERNEL_FLASH_LEN,
+		name:		"kernel",
+		flags:		BLOB_PART_FLAG_LOAD | 
+				BLOB_PART_FLAG_CRAMFS,
+		mem_base:	KERNEL_RAM_BASE,
+		entry_point:	KERNEL_RAM_BASE
+	},
+#if 0
+	{
+		/* ramdisk */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		RAMDISK_FLASH_BASE,
+		size:		RAMDISK_FLASH_LEN,
+		name:		"ramdisk",
+		flags:		BLOB_PART_FLAG_LOAD,
+		mem_base:	RAMDISK_RAM_BASE
+	},
+#endif
+	{
+		/* last entry */
+		magic:	BLOB_PART_LAST_MAGIC
+	}
+};
+
+
+static void smdk2500_init_hardware(void)
+{
+	/* setup flash stuff */
+	flash_descriptors = smdk2500_flash_descriptors;
+	flash_driver = &amd16_flash_driver;
+
+	/* the default partition table */
+	default_partition_table = smdk2500_default_partition_table;
+	
+	/* we don't know where the flash partition table will live, so
+	 * put the pointer at 0x0000000 and let the partition table
+	 * parser figure out.
+	 */
+	flash_partition_table = (blob_partition_t*)0x00000000;
+
+	/* select drivers */
+	reboot_driver = &s3c2500_reboot_driver;
+	serial_driver = &s3c2500_serial_driver;
+	led_driver = &s3c2500_gpio_led_driver;
+	timer_driver = &s3c2500_timer_driver;
+	ether_driver = &s3c2500_ether_driver;
+	ether_driver->name = "eth0";
+}
+
+__initlist(smdk2500_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/blob/stack.S
diff -u build_tree/bootLoader/src/blob/stack.S:1.1.1.1 build_tree/bootLoader/src/blob/stack.S:removed
--- build_tree/bootLoader/src/blob/stack.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/stack.S	Tue Jan  8 14:21:47 2008
@@ -1,33 +0,0 @@
-/*
- * stack.S: blob stack
- *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * $Id: stack.S,v 1.3 2001/11/04 23:16:58 erikm Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-.ident "$Id: stack.S,v 1.3 2001/11/04 23:16:58 erikm Exp $"
-
-#ifdef HAVE_CONFIG_H
-# include <blob/config.h>
-#endif
-
-
-.section ".stack"
-	/* 8kB stack should be enough */
-	.space	(8 * 1024)
Index: build_tree/bootLoader/src/blob/start-ld-script
diff -u build_tree/bootLoader/src/blob/start-ld-script:1.1.1.1 build_tree/bootLoader/src/blob/start-ld-script:1.1.1.2
--- build_tree/bootLoader/src/blob/start-ld-script:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/start-ld-script	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      ld-script
- * Version:       $Id: start-ld-script,v 1.1 2001/10/07 15:51:01 erikm Exp $
+ * Version:       $Id: start-ld-script,v 1.2 2003/02/10 23:07:06 erikm Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   ld (linker) script to make the blob bootlader.
@@ -18,7 +18,13 @@
 	. = 0x00000000;
 
 	. = ALIGN(4);
-	.text : { *(.text) }
+	.text : { *(.text)
+
+		__piggy_start = .;
+		blob-rest-piggy.o
+		. = ALIGN(8);
+		__piggy_end = .;
+	}
 
 	. = ALIGN(4);
 	.rodata : { *(.rodata) }
Index: build_tree/bootLoader/src/blob/start-pxa.S
diff -u /dev/null build_tree/bootLoader/src/blob/start-pxa.S:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/start-pxa.S	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,139 @@
+/*
+ * start-pxa: PXA (XScale) specific start code
+ *
+ * Copyright (C) 2002 Intel Corporation
+ * Written by Rusty Geldmacher (russell.r.geldmacher@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+
+.text
+
+/*
+ * We start by implementing *all* exception vectors
+ *
+ * Reset vector: this initialises the machine
+ * note here that this not yet taken sleep wakeup into account -- lets just
+ * get something to work first.
+ */
+
+.macro blink, count
+	mov		r3, \count
+	b		endless_blink
+.endm
+
+.globl reset
+reset:
+	/* First, mask **ALL** interrupts */
+	ldr		r0, =ICMR
+	mov		r1, #0x00
+	str		r1, [r0]
+
+real_reset:
+	bl		gpiosetup
+	bl		ledsetup
+	bl		memsetup
+	bl		normal_boot
+
+	blink	#1
+
+.globl undefined_instruction
+undefined_instruction:
+	blink	#2
+
+.globl software_interrupt
+software_interrupt:
+	blink	#3
+
+.globl prefetch_abort
+prefetch_abort:
+	blink	#4
+
+.globl data_abort
+data_abort:
+	blink	#5
+
+.globl not_used
+not_used:
+	blink	#6
+
+.globl irq
+irq:
+	blink	#7
+
+.globl fiq
+fiq:
+	blink	#8
+
+#define GPIO25_LED GPIO_bit(25)
+
+ledset:
+#ifdef CSIR_IMS
+	ldr		r1, =GPSR0
+	mov		r0, #GPIO25_LED
+	str		r0, [r1]
+#endif
+	mov		pc, lr
+
+ledclear:
+#ifdef CSIR_IMS
+	ldr		r1, =GPCR0
+	mov		r0, #GPIO25_LED
+	str		r0, [r1]
+#endif
+	mov		pc, lr
+
+ledsetup:
+	mov		r2, lr
+#ifdef CSIR_IMS
+	ldr		r1, =GPDR0
+	ldr		r0, [r1]
+	orr		r0, r0, #GPIO25_LED
+	str		r0, [r1]
+#endif
+	bl		ledclear
+	mov		pc, r2
+
+.macro wait, count
+	mov		r0, \count
+0:
+	subs	r0, r0, #1
+	bne		0b
+.endm
+
+ledflash:
+	mov		r2, lr
+	bl		ledset
+	wait	#0x400000
+	bl		ledclear
+	wait	#0x400000
+	mov		pc, r2
+
+endless_blink:
+	mov		r4, r3
+0:
+	bl		ledflash
+	subs	r4, r4, #1
+	bne		0b
+	wait	#0x2000000
+	b		endless_blink
+
Index: build_tree/bootLoader/src/blob/start-s3c2500.S
diff -u /dev/null build_tree/bootLoader/src/blob/start-s3c2500.S:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/start-s3c2500.S	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,183 @@
+/*
+ * start-s3c2500.S: Samsung s3c2500 specific start code
+ *
+ * Copyright (C) 1999 2000 2001 2002 Erik Mouw (J.A.K.Mouw@its.tudelft.nl) and
+ *                     Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl)
+ * Copyright (C) 2003 Russ Dill (Russ.Dill@asu.edu)
+ *
+ * $Id: start-s3c2500.S,v 1.1 2003/09/04 18:03:09 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+/*
+ * Documentation:
+ */
+
+.ident "$Id: start-s3c2500.S,v 1.1 2003/09/04 18:03:09 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+
+#define F_BIT	(1 << 6)
+#define	I_BIT	(1 << 7)
+
+.text
+
+cpu_speed:	.word	CPU_SPEED
+bus_speed:	.word	BUS_SPEED
+
+/* We start by implementing *all* exception vectors */
+
+
+/* Reset vector: this initialises the machine */
+.globl reset
+reset:
+	/* Disable interrupts */
+	mrs	r0, cpsr
+	orr	r0, r0, #I_BIT | F_BIT
+	msr	cpsr, r0
+
+	/* Enable "custom" clocks */
+	mov	r0, #ASIC_BASE
+	orr	r0, r0, #SYSCFG_BASEB
+
+	mov	r1, #CPLLREN | SPLLREN
+	str	r1, [r0]
+
+	/* Set CPU clock */
+	ldr	r1, cpu_speed
+	str	r1, [r0, #CPLL]
+
+	/* Set bus clock */
+	ldr	r1, bus_speed
+	str	r1, [r0, #SPLL]
+
+	/* init LED */
+	bl	ledinit
+
+	/* setup memory */
+	bl	memsetup
+
+	/* turn off the LED. if it stays off it is an indication that
+	 * we didn't make it into the C code */
+	bl	led_off
+
+	/* everything is said and done over here, call normal_boot in
+	 * the generic startup code to continue the boot procedure */
+	bl	normal_boot
+
+	/* oops, normal_boot returns, something went wrong. signal an
+	 * error to the user */
+	mov	r6, #2
+	b	endless_blink
+
+
+
+
+/* we could choose to handle all exceptions in a nice way, but the
+ * best is to treat them as errors because blob should not contain
+ * errors
+ */
+
+/* Undefined instruction exception */
+.globl undefined_instruction
+undefined_instruction:
+	mov	r6, #3
+	b	endless_blink
+
+
+
+
+/* SWI */
+.globl software_interrupt
+software_interrupt:
+	/* NOTE: This is NOT an error! If you think that blob should return
+	 * from software interrupts, you're plain WRONG. The source of the
+	 * problem is in the kernel: you should *disable* CONFIG_ANGELBOOT
+	 * simply because blob is not angel. -- Erik
+	 */
+	mov	r6, #4
+	b	endless_blink
+
+	
+	
+
+/* prefetch exception. shouldn't happen though we usually run with
+ * i-cache enabled */
+.globl prefetch_abort
+prefetch_abort:
+	mov	r6, #5
+	b	endless_blink
+
+
+
+
+/* data abort */
+.globl data_abort
+data_abort:
+	mov	r6, #6
+	b	endless_blink
+
+
+
+
+/* we *should* never reach this */
+.globl not_used
+not_used:
+	mov	r6, #7
+	b	endless_blink
+
+
+
+
+/* interrupt. we could handle this differently later if some kind of
+ * driver in blob wants to be interrupt driven. for the time being we
+ * treat it as an error.
+ */
+.globl irq
+irq:
+	mov	r6, #8
+	b	endless_blink
+
+
+
+
+/* FIQ. same as IRQ */
+.globl fiq
+fiq:
+	mov	r6, #9
+	b	endless_blink
+
+
+
+
+/* endless loop that blinks the LED. r6 contains the number of blinks */
+endless_blink:
+	bl	wait
+	mov	r0, r6
+	bl	led_blink
+	b	endless_blink
+		
+wait:
+	/* busy wait loop*/
+	mov	r5, #0x100000
+wait0:
+	subs	r5, r5, #1
+	bne	wait0
+	mov	pc, lr
Index: build_tree/bootLoader/src/blob/start-sa11x0.S
diff -u /dev/null build_tree/bootLoader/src/blob/start-sa11x0.S:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/start-sa11x0.S	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,235 @@
+/*
+ * start-sa11x0.S: StrongARM SA11x0 specific start code
+ *
+ * Copyright (C) 1999 2000 2001 2002 Erik Mouw (J.A.K.Mouw@its.tudelft.nl) and
+ *                     Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl)
+ *
+ * $Id: start-sa11x0.S,v 1.7 2003/08/07 19:31:01 abz Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+/*
+ * Documentation:
+ * [1] Intel Corporation, "Intel StrongARM SA-1100 Microprocessor
+ *     Developer's Manual", April 1999
+ * [2] Intel Corporation, "Intel StrongARM SA-1110 Microprocessor
+ *     Advanced Developer's manual, December 1999
+ */
+
+.ident "$Id: start-sa11x0.S,v 1.7 2003/08/07 19:31:01 abz Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+
+.text
+
+
+
+/* some defines to make life easier */
+/* Register addresses can be found in [1] Appendix A */
+IC_BASE:        .word   0x90050000
+#define ICMR    0x04
+	
+PWR_BASE:	.word	0x90020000
+#define PSSR	0x04
+#define PSPR	0x08
+#define PPCR	0x14
+#define POSR	0x1C
+	
+RST_BASE:	.word	0x90030000
+#define RCSR	0x04
+
+
+
+/* The initial CPU speed. Note that the SA11x0 CPUs can be safely overclocked:
+ * 190 MHz CPUs are able to run at 221 MHz, 133 MHz CPUs can do 190 Mhz.
+ */
+cpuspeed:	.word	CPU_SPEED
+
+
+
+
+/* We start by implementing *all* exception vectors */
+
+
+
+
+/* Reset vector: this initialises the machine */
+.globl reset
+reset:
+	/* First, mask **ALL** interrupts */
+	ldr	r0, IC_BASE
+	mov	r1, #0x00
+	str	r1, [r0, #ICMR]
+
+	/* switch CPU to correct speed */
+	ldr	r0, PWR_BASE
+	ldr	r1, cpuspeed
+	str	r1, [r0, #PPCR]
+
+	/* check if this is a wake-up from sleep */
+	ldr	r0, RST_BASE
+	ldr	r1, [r0, #RCSR]
+	and	r1, r1, #0x0f
+	tst	r1, #0x08	/* check the Sleep Mode Reset bit */
+	beq	real_reset	/* no, continue booting */
+
+	/* Wait for the oscillator to stabilize */
+	ldr	r0, PWR_BASE
+wait_for_OOK:
+	ldr	r1, [r0, #POSR]
+	tst	r1, #1		/* test Oscillator OK bit */
+	beq	wait_for_OOK
+
+	/* yes, a wake-up. clear RCSR by writing a 1 (see 9.6.2.1 from [1]) */
+	ldr	r0, RST_BASE
+	mov	r1, #0x08
+	str	r1, [r0, #RCSR]	;
+
+	/* setup memory */
+	bl	memsetup
+	
+	/* handle Power Manager Sleep Status Register (PSSR)
+	 * see 9.5.7.5 from [1]*/
+	ldr	r0, PWR_BASE
+	ldr r1, [r0, #PSSR]
+	/* clear PH bit, bring periperal pins out from sleep state */
+	orr r1, r1, #0x10
+	str r1, [r0, #PSSR]
+	
+	/* get the value from the PSPR and jump to it */
+	ldr	r0, PWR_BASE
+	ldr	r1, [r0, #PSPR]
+	mov	pc, r1
+
+	
+real_reset:
+	/* init LED */
+	bl	ledinit
+
+	/* setup memory */
+	bl	memsetup
+
+	/* turn off the LED. if it stays off it is an indication that
+	 * we didn't make it into the C code */
+	bl led_off
+
+	/* everything is said and done over here, call normal_boot in
+	 * the generic startup code to continue the boot procedure */
+	bl normal_boot
+
+	/* oops, normal_boot returns, something went wrong. signal an
+	 * error to the user */
+	mov	r6, #2
+	b	endless_blink
+
+
+
+
+/* we could choose to handle all exceptions in a nice way, but the
+ * best is to treat them as errors because blob should not contain
+ * errors
+ */
+
+/* Undefined instruction exception */
+.globl undefined_instruction
+undefined_instruction:
+	mov	r6, #3
+	b	endless_blink
+
+
+
+
+/* SWI */
+.globl software_interrupt
+software_interrupt:
+	/* NOTE: This is NOT an error! If you think that blob should return
+	 * from software interrupts, you're plain WRONG. The source of the
+	 * problem is in the kernel: you should *disable* CONFIG_ANGELBOOT
+	 * simply because blob is not angel. -- Erik
+	 */
+	mov	r6, #4
+	b	endless_blink
+
+	
+	
+
+/* prefetch exception. shouldn't happen though we usually run with
+ * i-cache enabled */
+.globl prefetch_abort
+prefetch_abort:
+	mov	r6, #5
+	b	endless_blink
+
+
+
+
+/* data abort */
+.globl data_abort
+data_abort:
+	mov	r6, #6
+	b	endless_blink
+
+
+
+
+/* we *should* never reach this */
+.globl not_used
+not_used:
+	mov	r6, #7
+	b	endless_blink
+
+
+
+
+/* interrupt. we could handle this differently later if some kind of
+ * driver in blob wants to be interrupt driven. for the time being we
+ * treat it as an error.
+ */
+.globl irq
+irq:
+	mov	r6, #8
+	b	endless_blink
+
+
+
+
+/* FIQ. same as IRQ */
+.globl fiq
+fiq:
+	mov	r6, #9
+	b	endless_blink
+
+
+
+
+/* endless loop that blinks the LED. r6 contains the number of blinks */
+endless_blink:
+	bl	wait
+	mov	r0, r6
+	bl	led_blink
+	b	endless_blink
+		
+wait:
+	/* busy wait loop*/
+	mov	r5, #0x1000000
+wait0:
+	subs	r5, r5, #1
+	bne	wait0
+	mov	pc, lr
Index: build_tree/bootLoader/src/blob/start.S
diff -u build_tree/bootLoader/src/blob/start.S:1.1.1.1 build_tree/bootLoader/src/blob/start.S:1.1.1.3
--- build_tree/bootLoader/src/blob/start.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/start.S	Fri Nov  9 10:37:08 2007
@@ -1,7 +1,7 @@
 /*
  * start.S: blob start code
  *
- * Copyright (C) 1999 2000 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl) and
+ * Copyright (C) 1999 2000 2001 2002 Erik Mouw (J.A.K.Mouw@its.tudelft.nl) and
  *                     Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl)
  *
  * This program is free software; you can redistribute it and/or modify
@@ -31,10 +31,10 @@
  * [2] S. Furber, "ARM System Architecture", Addison Wesley Longman
  *     Ltd., Essex, England, 1996.
  * [3] Intel Corporation, "Intel StrongARM SA-1110 Microprocessor
- *     Advanced Developer's manual, December 1999
+ *     Advanced Developer's manual", December 1999
  */
 
-.ident "$Id: start.S,v 1.6 2001/11/15 11:56:20 seletz Exp $"
+.ident "$Id: start.S,v 1.12 2003/08/06 22:55:41 abz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -46,7 +46,8 @@
 
 /* Jump vector table as in table 3.1 in [1] */
 .globl _start
-_start:	b	reset
+_start:
+	b	reset
 	b	undefined_instruction
 	b	software_interrupt
 	b	prefetch_abort
@@ -56,196 +57,62 @@
 	b	fiq
 
 
-
-
 /* some defines to make life easier */
-/* Register addresses can be found in [1] Appendix A */
-IC_BASE:        .word   0x90050000
-#define ICMR    0x04
-	
-PWR_BASE:	.word	0x90020000
-#define PSSR	0x04
-#define PSPR	0x08
-#define PPCR	0x14
-	
-RST_BASE:	.word	0x90030000
-#define RCSR	0x04
-
-/* main memory starts at 0xc0000000 */
 BLOB_START:	.word	BLOB_ABS_BASE_ADDR
+piggy_start:	.word	__piggy_start
+piggy_end:	.word	__piggy_end
+.align
 
-
-/* The initial CPU speed. Note that the SA11x0 CPUs can be safely overclocked:
- * 190 MHz CPUs are able to run at 221 MHz, 133 MHz CPUs can do 190 Mhz.
- */
-cpuspeed:	.word	CPU_SPEED
-
-
-
-/* the actual reset code */
-reset:
-	/* First, mask **ALL** interrupts */
-	ldr	r0, IC_BASE
-	mov	r1, #0x00
-	str	r1, [r0, #ICMR]
-
-	/* switch CPU to correct speed */
-	ldr	r0, PWR_BASE
-	ldr	r1, cpuspeed
-	str	r1, [r0, #PPCR]
-
-
-	/* init LED */
-	bl	ledinit
-
-	/* setup memory */
-	bl	memsetup
-
-	/* check if this is a wake-up from sleep */
-	ldr	r0, RST_BASE
-	ldr	r1, [r0, #RCSR]
-	and	r1, r1, #0x0f
-	teq	r1, #0x08
-	bne	normal_boot	/* no, continue booting */
-
-	/* yes, a wake-up. clear RCSR by writing a 1 (see 9.6.2.1 from [1]) */
-	mov	r1, #0x08
-	str	r1, [r0, #RCSR]	;
-
-	/* handle Power Manager Sleep Status Register (PSSR)
-	 * see 9.5.7.5 from [1]*/
-	ldr r1, [r0, #PSSR]
-	/* clear DH bit, brings out DRAM from self-refresh */
-	orr r1, r1, #0x08
-	/* clear PH bit, bring periperal pins out from sleep state */
-	orr r1, r1, #0x10
-	str r1, [r0, #PSSR]
-	
-	/* get the value from the PSPR and jump to it */
-	ldr	r0, PWR_BASE
-	ldr	r1, [r0, #PSPR]
-	mov	pc, r1
-
-
+.globl normal_boot
 normal_boot:
+
 	/* check the first 1MB of BLOB_START in increments of 4k */
-	mov	r7, #0x1000
-	mov	r6, r7, lsl #8	/* 4k << 2^8 = 1MB */
-	ldr	r5, BLOB_START
+	mov		r7, #0x1000
+	mov		r6, r7, lsl #8	/* 4KB << 8 = 1MB */
+	ldr		r5, BLOB_START
+
 
 mem_test_loop:
-	mov	r0, r5
-	bl	testram
-	teq	r0, #1
-	beq	badram
+	mov		r0, r5
+	bl		testram
+	teq		r0, #1
+	beq		endless_loop	/* oops, something went wrong :( */
 
-	add	r5, r5, r7
+	add		r5, r5, r7
 	subs	r6, r6, r7
-	bne	mem_test_loop
+	bne		mem_test_loop
 
 
 relocate:
-	adr	r0, _start
-
 	/* relocate the second stage loader */
-	add	r2, r0, #(64 * 1024)	/* blob maximum size is 64kB */
-	add	r0, r0, #0x400		/* skip first 1024 bytes */
+	adr	r1, _start
+
+	ldr	r0, piggy_start
+	add	r0, r0, r1
+	ldr	r2, piggy_end
+	add	r2, r2, r1
+
 	ldr	r1, BLOB_START
 
 	/* r0 = source address
 	 * r1 = target address
 	 * r2 = source end address
 	 */
+
 copy_loop:
 	ldmia	r0!, {r3-r10}
 	stmia	r1!, {r3-r10}
 	cmp	r0, r2
 	ble	copy_loop
 
-
-	/* turn off the LED. if it stays off it is an indication that
-	 * we didn't make it into the C code 
-	 */
-	bl led_off
-
-
 	/* blob is copied to ram, so jump to it */
 	ldr	r0, BLOB_START
 	mov	pc, r0
 
-
-badram:
-	mov	r6, #2
-	b	endless_blink
-
-	
-
-endless_blink:
-	bl	wait
-	mov	r0, r6
-	bl	led_blink
-	b	endless_blink
-		
-wait:
-	/* busy wait loop*/
-	mov	r5, #0x1000000
-wait0:
-	subs	r5, r5, #1
-	bne	wait0
-	mov	pc, lr
-
-	
-	
-	
-undefined_instruction:
-	mov	r6, #3
-	b	endless_blink
-
-
-
-
-software_interrupt:
-	/* NOTE: This is NOT an error! If you think that blob should return
-	 * from software interrupts, you're plain WRONG. The source of the
-	 * problem is in the kernel: you should *disable* CONFIG_ANGELBOOT
-	 * simply because blob is not angel. -- Erik
+endless_loop:
+	/* either the second stage loader returned, or we got here from
+	 * mem_test_loop. both is bad, and we really want to toggle a
+	 * GPIO line or so. for the time being we just do an endless
+	 * loop. FIXME! -- erik 
 	 */
-	mov	r6, #4
-	b	endless_blink
-
-
-
-
-
-prefetch_abort:
-	mov	r6, #5
-	b	endless_blink
-
-
-
-
-data_abort:
-	mov	r6, #6
-	b	endless_blink
-
-
-
-
-not_used:
-	/* we *should* never reach this */
-	mov	r6, #7
-	b	endless_blink
-
-
-
-
-irq:
-	mov	r6, #8
-	b	endless_blink
-
-
-
-
-fiq:
-	mov	r6, #9
-	b	endless_blink
+	b	endless_loop
Index: build_tree/bootLoader/src/blob/start.S.memcopy
diff -u /dev/null build_tree/bootLoader/src/blob/start.S.memcopy:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/start.S.memcopy	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,165 @@
+/*
+ * start.S: blob start code
+ *
+ * Copyright (C) 1999 2000 2001 2002 Erik Mouw (J.A.K.Mouw@its.tudelft.nl) and
+ *                     Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+/*
+ * This is the blob start code. The SA-1100 jumps to address 0x00000000
+ * after a reset. We put a single branch code at this position which jumps
+ * to a safe region to do the actual setup. All other vectors just point
+ * to an endless loop for the moment.
+ *
+ * Documentation:
+ * [1] Intel Corporation, "Intel StrongARM SA-1100 Microprocessor
+ *     Developer's Manual", April 1999
+ * [2] S. Furber, "ARM System Architecture", Addison Wesley Longman
+ *     Ltd., Essex, England, 1996.
+ * [3] Intel Corporation, "Intel StrongARM SA-1110 Microprocessor
+ *     Advanced Developer's manual", December 1999
+ */
+
+.ident "$Id: start.S,v 1.12 2003/08/06 22:55:41 abz Exp $"
+
+.include  "xlli/mainstone/xlli_Bulverde_defs.inc"                 @ Bulverde specific include file
+.include  "xlli/mainstone/xlli_Mainstone_defs.inc"                @ Mainstone specific include file
+
+
+#include <blob/config.h>
+
+#include <blob/arch.h>
+
+.text
+
+/* Jump vector table as in table 3.1 in [1] */
+.globl _start
+_start:
+	b	reset
+	b	undefined_instruction
+	b	software_interrupt
+	b	prefetch_abort
+	b	data_abort
+	b	not_used
+	b	irq
+	b	fiq
+
+/* some defines to make life easier */
+BLOB_START:	.word	BLOB_ABS_BASE_ADDR
+piggy_start:	.word	__piggy_start
+piggy_end:	.word	__piggy_end
+.align
+
+.globl normal_boot
+normal_boot:
+
+	/* relocate the second stage loader */
+
+/*	adr	r1, _start
+
+	ldr	r0, piggy_start
+	add	r0, r0, r1
+	ldr	r2, piggy_end
+	add	r2, r2, r1
+
+	ldr	r1, BLOB_START
+*/
+
+	/* r0 = source address
+	 * r1 = target address
+	 * r2 = source end address
+	 */
+
+/* copy_loop:
+	ldmia	r0!, {r3-r10}
+	stmia	r1!, {r3-r10}
+	cmp	r0, r2
+	ble	copy_loop
+
+*/
+
+/*  Copy Flash to SDRAM at 0xA0000000 */
+
+	mov		r1, #0
+	ldr		r3,	=piggy_end
+	ldr		r2, =BLOB_START
+here1:
+	ldr		r4,	[r1], #4
+	str		r4, [r2], #4
+	cmp		r1,	r3
+	bne		here1
+
+/* Output a character  'C' */
+	ldr	r0,	=STUART_PHYSICAL_BASE
+	ldr r2, =0x43
+	bl	xlli_PUTchar
+
+/* Verify the copy was OK  */
+
+	mov		r6, #0
+	ldr		r3,	=piggy_end
+	ldr		r7, =BLOB_START
+here2:
+	ldr		r4,	[r6], #4
+	ldr		r5, [r7], #4
+
+/* Output a character  'Q' */
+	ldr	r0,	=STUART_PHYSICAL_BASE
+	ldr r2, =0x51
+	bl	xlli_PUTchar
+	
+	cmp		r4,	r5
+	bne		mem_fail
+	cmp		r6,	r7
+	bne		here2
+
+/*	Didn't make is this far so comment out this
+bl		xlli_initPageTable */
+
+/* Output a character  'D' */
+	ldr	r0,	=STUART_PHYSICAL_BASE
+	ldr r2, =0x44
+	bl	xlli_PUTchar
+
+	/* blob is copied to ram, so jump to it */
+	ldr	r0, BLOB_START
+	mov	pc, r0
+
+
+mem_fail:
+
+/* Output a character  'F' */
+	ldr	r0,	=STUART_PHYSICAL_BASE
+	ldr r2, =0x46
+	bl	xlli_PUTchar
+spin:
+	b	spin
+
+
+endless_loop:
+	/* either the second stage loader returned, or we got here from
+	 * mem_test_loop. both is bad, and we really want to toggle a
+	 * GPIO line or so. for the time being we just do an endless
+	 * loop. FIXME! -- erik 
+	 */
+
+/* Output a character  'E' */
+	ldr	r0,	=STUART_PHYSICAL_BASE
+	ldr r2, =0x45
+	bl	xlli_PUTchar
+	b	spin
+
Index: build_tree/bootLoader/src/blob/strata.c
diff -u /dev/null build_tree/bootLoader/src/blob/strata.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/strata.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,765 @@
+/*
+ *  strata.c : Intel Strata Flash operations
+ *
+ *  Copyright (c) 2003, Intel Corporation (yu.tang@intel.com)
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License version 2 as
+ *  published by the Free Software Foundation.
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+
+#include <strata.h>
+
+#define REGION_SEL(blkadr, chip) ({ \
+	int __i; \
+	struct flash_region *__r = NULL; \
+	for (__i=0; __i<chip->region_num; __i++) { \
+		u32 __start, __end; \
+		__start = chip->regions[__i].offset + chip->base; \
+		__end = __start + chip->regions[__i].block_num * chip->regions[__i].block_size; \
+		if ( (blkadr >= __start) && (blkadr < __end)) { \
+			__r = chip->regions + __i; \
+			break; \
+		} \
+	} \
+	__r; \
+})
+
+/* J3 */
+#define J_32  { {0,  32, 64*1024}, }
+#define J_64  { {0,  64, 64*1024}, }
+#define J_128 { {0, 128, 64*1024}, }
+/* K18/K3 */
+#define K_64   { {0,  64, 64*1024}, }
+#define K_128  { {0, 128, 64*1024}, }
+#define K_256  { {0, 256, 64*1024}, }
+/* L18/L3, top/bottom */
+#define L_top_64      { {0,  63, 64 * 1024}, {0x3F0000,  4, 16 * 1024}, }
+#define L_top_128     { {0, 127, 64 * 1024}, {0x7F0000,  4, 16 * 1024}, }
+#define L_top_256     { {0, 255, 64 * 1024}, {0xFF0000,  4, 16 * 1024}, }
+#define L_bottom_64   { {0,   4, 16 * 1024}, {0x010000, 63, 64 * 1024}, }
+#define L_bottom_128  { {0,   4, 16 * 1024}, {0x010000,127, 64 * 1024}, }
+#define L_bottom_256  { {0,   4, 16 * 1024}, {0x010000,255, 64 * 1024}, }
+
+/* C3 */
+#define C_32  { {0,  31, 32*1024}, }
+
+
+static struct flash_chip chips_table[]=
+{
+	/* base, buswidth, id, type, region_num, regions */
+	{ 0, 0, 0x88C4, 16, STRATA_J3,  1, C_32  }, /* LC 32Mbit, Bottom */
+	{ 0, 0, 0x0016, 16, STRATA_J3,  1, J_32  }, /* J3, 32Mbit */
+	{ 0, 0, 0x0017, 16, STRATA_J3,  1, J_64  }, /* J3, 64Mbit */ 
+	{ 0, 0, 0x0018, 16, STRATA_J3,  1, J_128 }, /* J3, 128bit */
+	{ 0, 0, 0x8801, 32, STRATA_K3,  1, K_64 },  /* K3   64Mbit */
+	{ 0, 0, 0x8802, 32, STRATA_K3,  1, K_128}, /* K3  128Mbit */
+	{ 0, 0, 0x8803, 32, STRATA_K3,  1, K_256}, /* K3  256Mbit */
+	{ 0, 0, 0x8805, 32, STRATA_K18, 1, K_64},  /* K18  64Mbit */
+	{ 0, 0, 0x8806, 32, STRATA_K18, 1, K_128}, /* K18 128Mbit */
+	{ 0, 0, 0x8807, 32, STRATA_K18, 1, K_256}, /* K18 256Mbit */
+	{ 0, 0, 0x880B, 32, STRATA_L18, 2, L_top_64},  /* L18   64Mbit, Top */
+	{ 0, 0, 0x880C, 32, STRATA_L18, 2, L_top_128}, /* L18  128Mbit, Top */
+	{ 0, 0, 0x880D, 32, STRATA_L18, 2, L_top_256}, /* L18  256Mbit, Top */
+	{ 0, 0, 0x880E, 32, STRATA_L18, 2, L_bottom_64}, /* L18  64Mbit, Bottom */
+	{ 0, 0, 0x880F, 32, STRATA_L18, 2, L_bottom_128}, /* L18 128Mbit, Bottom */
+	{ 0, 0, 0x8810, 32, STRATA_L18, 2, L_bottom_256}, /* L18 256Mbit, Bottom */
+	{ 0, 0, 0x8811, 32, STRATA_L3,  2, L_top_64}, /* L3   64Mbit, Top */
+	{ 0, 0, 0x8812, 32, STRATA_L3,  2, L_top_128}, /* L3  128Mbit, Top */
+	{ 0, 0, 0x8813, 32, STRATA_L3,  2, L_top_256}, /* L3  256Mbit, Top */
+	{ 0, 0, 0x8814, 32, STRATA_L3,  2, L_bottom_64}, /* L3  64Mbit, Bottom */
+	{ 0, 0, 0x8815, 32, STRATA_L3,  2, L_bottom_128}, /* L3 128Mbit, Bottom */
+	{ 0, 0, 0x8816, 32, STRATA_L3,  2, L_bottom_256}  /* L3 256Mbit, Bottom */
+};
+
+static int unlock_block_32bit(u32 addr)
+{
+	volatile u32 *blkadr= (volatile u32*)addr;
+	u32 status;
+
+	/* clear status */
+	*blkadr = 0x00500050;
+
+	*blkadr = 0x00600060;
+	*blkadr = 0x00d000d0;
+
+	do {
+		status = *blkadr;
+	}while( (status & 0x00800080) != 0x00800080);
+
+	
+	if( status != 0x00800080) {
+		printf("%s: error code = 0x%08x\n", __FUNCTION__, (int)status);
+		return 1;
+	}
+
+	*blkadr = 0x00ff00ff;
+
+	return 0;
+}
+
+static int erase_block_32bit(u32 addr)
+{
+	volatile u32 *blkadr = (volatile u32*) addr;
+	u32 status;
+
+	/* clear status */
+	*blkadr = 0x00500050;
+
+	*blkadr = 0x00200020;
+	*blkadr = 0x00d000d0;
+
+	/* BUSY? */
+	do {
+		status = *blkadr;
+	}while( (status & 0x00800080) != 0x00800080 );
+
+	/* erase error? */
+	if( (status & 0x00200020) == 0x00200020) {
+		printf("%s: error code = 0x%08x\n", __FUNCTION__, (int)status);
+		return 1;
+	}
+
+	*blkadr = 0x00ff00ff;
+
+	return 0;
+}
+
+static int do_flash_probe_32bit(struct flash_chip *chip)
+{
+	volatile u32 *addr;
+	u32 code, id;
+
+	if (!chip) return -1;
+
+	addr = (volatile u32 *)chip->base;
+
+	*addr = 0x00980098;
+	code = *addr;
+	id = *(addr+1);
+	*addr = 0x00ff00ff;
+
+	chip->type = STRATA_UNKNOWN;
+	chip->id = id;
+
+	code &= 0xffff;
+	id &= 0xffff;
+
+	if(code == 0x89) {
+		int i,j; 
+		struct flash_chip *c;
+
+		for (i=0; i< (sizeof(chips_table)/sizeof(struct flash_chip)); i++) {
+			c = chips_table + i;
+			if ( id == c->id) {
+				chip->type = c->type;
+				chip->cache_size = c->cache_size * 4;
+				chip->region_num = c->region_num;
+
+				for (j=0; j < c->region_num; j++) {
+					chip->regions[j].offset = c->regions[j].offset * 4;
+					chip->regions[j].block_num = c->regions[j].block_num;
+					chip->regions[j].block_size = c->regions[j].block_size * 4;
+				}
+
+				break;
+			}
+		}
+	}
+				
+	return 0;
+}
+
+static int do_flash_erase_32bit(struct flash_chip *chip, u32 dest, u32 len)
+{
+	int blocks, ret;
+	u32 blkadr;
+	struct flash_region *r;
+
+	if (!chip) return -1;
+
+	/* unlocking */
+	blocks  = 0;
+	blkadr  = dest;
+	for(;;) {
+		/* J3 : unlock one for all, K3/K18/L3/L18 : unlock for each block */
+		if (chip->type == STRATA_J3) {
+			if (!blocks) unlock_block_32bit(blkadr);
+		}
+		else
+			unlock_block_32bit(blkadr);
+
+		r = REGION_SEL(blkadr, chip);
+		if (!r) return -1;
+		blkadr += r->block_size;
+
+		blocks ++;
+
+		if (blkadr >= (dest+len)) break;
+	}
+
+	printf("Erasing %d blocks at 0x%08x:", blocks, (int)dest);
+
+	/* erasing */
+	blkadr = dest;
+	for(;;) {
+		ret = erase_block_32bit(blkadr);
+		if (ret) return ret;
+
+		r = REGION_SEL(blkadr, chip);
+		if (!r)  return -1;
+		blkadr += r->block_size;
+
+		/* show progress */
+		printf(".");
+		if (blkadr >= (dest+len)) break;
+	}
+
+	printf("done\n");
+
+	return 0;
+}
+
+static int do_write_word_32bit(struct flash_chip *chip, u32 dest, u32 data) 
+{
+	volatile u32 *addr = (volatile u32*) dest;
+	u32 status;
+
+	if (!chip) return -1;
+
+	/* clear status */
+	*addr = 0x00500050;
+
+	/* program setup */
+	*addr= 0x00400040;
+
+	/* data */
+	*addr = data;
+
+	/* read status */
+	*addr = 0x00700070;
+
+	do{
+		status = *addr;
+	}while( (status & 0x00800080) != 0x00800080 );
+
+	/* program error? */
+	if( (status & 0x00100010) == 0x00100010) {
+		printf("%s : error code = 0x%08x\n", __FUNCTION__, (int)status);
+		return 1;
+	}
+
+	/* back to read-array */
+	*addr = 0x00ff00ff;
+	return 0;
+}
+
+static int do_write_buffer_32bit(struct flash_chip *chip, u32 dest, u8 *mem, u32 len)
+{
+	int cache_size, i;
+	u32 count,status;
+	u32 *data;
+	volatile u32 *blkadr, *start;
+
+	if (!chip) return -1;
+
+	/* Buffer write */
+	cache_size = chip->cache_size;
+
+	blkadr = (volatile u32*) dest;
+	start = blkadr;
+	data = (u32*) mem;
+
+	while( len > 0 ) {
+
+		if( len > cache_size) count = cache_size / 4;
+		else count = len / 4;
+
+		/* is buffer avaible? */
+		do {
+			/* issue write buffer command to block address */
+			*blkadr = 0x00e800e8;
+
+			/* read extended status register at block address */
+			status = *blkadr;
+
+		}while( (status & 0x00800080) != 0x00800080);
+
+
+		/* write word count - block address */
+		*blkadr = ((count-1) <<16) | (count-1);
+
+		/* write buffer data - start address */
+		for(i=0; i<count; i++) {
+			*start++ = *data++;
+		}
+
+		/* write confirm 0xD0 to block address */
+		*blkadr = 0x00d000d0;
+
+		do{
+			status = *blkadr;
+		}while( (status & 0x00800080) != 0x00800080 );
+
+		/* program error? */
+		if( (status & 0x00100010) == 0x00100010) {
+			printf("%s : error code = 0x%08x\n", __FUNCTION__, (int)status);
+			return 1;
+		}
+
+		len  -= (count << 2);
+
+	}
+
+	/* read-array mode */
+	*blkadr = 0x00ff00ff;
+
+	return 0;
+}
+
+static int do_flash_write_32bit(struct flash_chip *chip, u32 dest, u8 *mem, u32 len)
+{
+	int i, ret;
+	u32 *data;
+	u32 blkadr, writelen, left;
+	struct flash_region *r;
+
+	if (!chip) return -1;
+
+	/* Erase first */
+	ret = do_flash_erase_32bit(chip, dest, len);
+	if (ret) return ret;
+
+	printf("Flashing 0x%08x bytes at 0x%08x:", (int)len, (int)dest);
+
+	blkadr = dest;
+	left = len;
+	data = (u32*) mem;
+
+	while ( blkadr < (dest + len) ) {
+		r = REGION_SEL(blkadr, chip);
+		if (!r) return -1;
+		
+		writelen = (left > r->block_size) ? r->block_size : left;
+
+		if (chip->cache_size) 
+			ret = do_write_buffer_32bit(chip, blkadr, (u8*)data, writelen);
+		else {
+			for (i=0; i<writelen/4; i++) {
+				ret = do_write_word_32bit(chip, blkadr + i*4, data[i]);
+				if (ret) break;
+			}
+		}
+		if (ret) return ret;
+
+		data += writelen/4;
+		blkadr += r->block_size;
+		left -= writelen;
+
+		printf(".");
+	}
+
+	printf("done\n");
+
+	return 0;
+}
+
+static int unlock_block_16bit(u32 addr)
+{
+	volatile u16 *blkadr= (volatile u16*)addr;
+	u16 status;
+
+	/* clear status */
+	*blkadr = 0x0050;
+
+	*blkadr = 0x0060;
+	*blkadr = 0x00d0;
+
+	do {
+		status = *blkadr;
+	}while( (status & 0x0080) != 0x0080);
+
+	
+	if( status != 0x0080) {
+		printf("%s: error code = 0x%04x\n", __FUNCTION__, status);
+		return 1;
+	}
+
+	*blkadr = 0x00ff;
+
+	return 0;
+}
+
+static int erase_block_16bit(u32 addr)
+{
+	volatile u16 *blkadr = (volatile u16*) addr;
+	u16 status;
+
+	/* clear status */
+	*blkadr = 0x0050;
+
+	*blkadr = 0x0020;
+	*blkadr = 0x00d0;
+
+	/* BUSY? */
+	do {
+		status = *blkadr;
+	}while( (status & 0x0080) != 0x0080);
+
+	/* erase error? */
+	if( (status & 0x0020) == 0x0020) {
+		printf("%s: error code = 0x%04x\n", __FUNCTION__, status);
+		return 1;
+	}
+
+	*blkadr = 0x00ff;
+
+	return 0;
+}
+
+static int do_flash_erase_16bit(struct flash_chip *chip, u32 dest, u32 len)
+{
+	int blocks, ret;
+	u32 blkadr;
+	struct flash_region *r;
+
+	if (!chip) return -1;
+
+	/* unlocking */
+	blocks  = 0;
+	blkadr  = dest;
+	for(;;) {
+		/* J3 : unlock one for all, K3/K18/L3/L18 : unlock for each block*/
+		if (chip->type == STRATA_J3) {
+			if (!blocks) unlock_block_16bit(blkadr);
+		}
+	       	else
+			unlock_block_16bit(blkadr);
+
+		r = REGION_SEL(blkadr, chip);
+		if (!r)  return -1;
+
+		blkadr += r->block_size;
+		blocks ++;
+
+		if (blkadr >= (dest+len)) break;
+	}
+
+	printf("Erasing %d blocks at 0x%08x:", blocks, (int)dest);
+
+	/* erasing */
+	blkadr = dest;
+	for(;;) {
+		ret = erase_block_16bit(blkadr);
+		if (ret) return ret;
+		
+		r = REGION_SEL(blkadr, chip);
+		if (!r) return -1;
+
+		blkadr += r->block_size;
+		printf(".");
+
+		if (blkadr >= (dest+len)) break;
+	}
+
+	printf("done\n");
+
+	return 0;
+}
+
+static int do_write_word_16bit(struct flash_chip *chip, u32 dest, u16 data) 
+{
+	volatile u16 *addr = (volatile u16*) dest;
+	u16 status;
+
+	if (!chip) return -1;
+
+	/* clear status */
+	*addr = 0x0050;
+
+	/* program setup */
+	*addr= 0x0040;
+
+	/* data */
+	*addr = data;
+
+	/* read status */
+	*addr = 0x0070;
+
+	do{
+		status = *addr;
+	}while( (status & 0x0080) != 0x0080);
+
+	/* program error? */
+	if( (status & 0x0010) == 0x0010) {
+		printf("%s : error code = 0x%08x\n", __FUNCTION__, (int)status);
+		return 1;
+	}
+
+	*addr = 0x00ff;
+
+	return 0;
+}
+
+static int do_write_buffer_16bit(struct flash_chip *chip, u32 dest, u8* mem, u32 len)
+{
+	int cache_size, i;
+	u32 count;
+	u16 status;
+	u16 *data;
+	volatile u16 *blkadr, *start;
+
+	if (!chip) return -1;
+
+	/* Buffer write */
+	cache_size = chip->cache_size;
+
+	blkadr = (volatile u16*) dest;
+	start = blkadr;
+	data = (u16*) mem;
+
+	while( len > 0 ) {
+
+		if( len > cache_size) count = cache_size / 2;
+		else count = len / 2;
+
+		/* is buffer avaible? */
+		do {
+			/* issue write buffer command to block address */
+			*blkadr = 0x00e8;
+
+			/* read extended status register at block address */
+			status = *blkadr;
+
+		}while( (status & 0x0080) != 0x0080);
+
+
+		/* write word count - block address */
+		*blkadr = (count-1);
+
+		/* write buffer data - start address */
+		for(i=0; i<count; i++) {
+			*start++ = *data++;
+		}
+
+		/* write confirm 0xD0 to block address */
+		*blkadr = 0x00d0;
+
+		do{
+			status = *blkadr;
+		}while( (status & 0x0080) != 0x0080);
+
+		/* program error? */
+		if( (status & 0x0010) == 0x0010) {
+			printf("%s : error code = 0x%04x\n", __FUNCTION__, status);
+			return 1;
+		}
+
+		len  -= (count << 1);
+	}
+
+	/* read-array mode */
+	*blkadr = 0x00ff;
+
+	return 0;
+}
+
+static int do_flash_write_16bit(struct flash_chip *chip, u32 dest, u8 *mem, u32 len)
+{
+	int  i,ret;
+	u16 *data;
+	u32 blkadr, left, writelen;
+	struct flash_region *r;
+
+	if (!chip) return -1;
+
+	/* Erase first */
+	ret = do_flash_erase_16bit(chip, dest, len);
+	if (ret) return ret;
+
+	printf("Flashing 0x%08x bytes at 0x%08x:", (int)len, (int)dest);
+
+	blkadr = dest;
+	left = len;
+	data = (u16*) mem;
+
+	while ( blkadr < (dest + len) ) {
+		r = REGION_SEL(blkadr, chip);
+		if (!r) return -1;
+		
+		writelen = (left > r->block_size) ? r->block_size : left;
+
+		if (chip->cache_size) 
+			ret = do_write_buffer_16bit(chip, blkadr, (u8*)data, writelen);
+		else {
+			for (i=0; i<writelen/2; i++) {
+				ret = do_write_word_16bit(chip, blkadr + i*2, data[i]);
+				if (ret) break;
+			}
+		}
+		if (ret) return ret;
+
+		data += writelen/2;
+		blkadr += r->block_size;
+		left -= writelen;
+
+		printf(".");
+	}
+
+	printf("done\n");
+
+	return 0;
+}
+
+static int do_flash_probe_16bit(struct flash_chip *chip)
+{
+	volatile u16 *addr;
+	u16 code, id;
+
+	if (!chip) return -1;
+
+	addr = (volatile u16 *)chip->base;
+
+	*addr = 0x0098;
+	code = *addr;
+	id = *(addr+1);
+	*addr = 0x00ff;
+
+	chip->type = STRATA_UNKNOWN;
+	chip->id = id;
+
+	if(code == 0x89) {
+		int i,j; 
+		struct flash_chip *c;
+
+		for (i=0; i< (sizeof(chips_table)/sizeof(struct flash_chip)); i++) {
+			c = chips_table + i;
+			if ( id == c->id) {
+				chip->type = c->type;
+				chip->cache_size = c->cache_size * 2;
+				chip->region_num = c->region_num;
+
+				for (j=0; j < c->region_num; j++) {
+					chip->regions[j].offset = c->regions[j].offset * 2;
+					chip->regions[j].block_num = c->regions[j].block_num;
+					chip->regions[j].block_size = c->regions[j].block_size * 2;
+				}
+
+				break;
+			}
+		}
+	}
+
+	return 0;
+}
+
+/* program flash in blocks */
+int flash_write(struct flash_chip *chip, u32 dest, u8 *mem, u32 len)
+{
+	int err=0;
+	struct flash_region *r;
+
+	if (!chip) return -1;
+
+	/* sanity check */
+	if (chip->type == STRATA_UNKNOWN) {
+		printf("%s : unknown flash type %d { id=%08x }\n", __FUNCTION__, (int)chip->type,
+				(int)chip->id);
+		return -1;
+	}
+
+	r = REGION_SEL(dest, chip);
+	if (!r) return -1;
+
+	if (dest%r->block_size) {
+		printf("%s : Not align to region->block_size:0x%08x\n", __FUNCTION__,
+				(int)r->block_size);
+		return -1;
+	}
+
+	switch(chip->buswidth) {
+	case 2:
+		err = do_flash_write_16bit(chip, dest, mem, len);
+		break;
+	case 4:
+		err = do_flash_write_32bit(chip, dest, mem, len);
+		break;
+	default:
+		err = -1;
+		printf("flash_write: buswidth = %d is not supported\n", (int)chip->buswidth);
+		break;
+	}
+
+	return err;
+}
+
+/* erase flash in blocks */
+int flash_erase(struct flash_chip *chip, u32 dest, u32 len)
+{
+	int err=0;
+	struct flash_region *r;
+
+	if (!chip) return -1;
+
+	/* sanity check */
+	if (chip->type == STRATA_UNKNOWN) {
+		printf("%s : unknown flash type %d { id=%08x }\n", __FUNCTION__, (int)chip->type,
+				(int)chip->id);
+		return -1;
+	}
+
+	r = REGION_SEL(dest, chip);
+	if (!r) return -1;
+
+	if (dest%r->block_size) {
+		printf("%s : Not align to region->block_size:0x%08x\n", __FUNCTION__,
+				(int)r->block_size);
+		return -1;
+	}
+
+	switch(chip->buswidth) {
+	case 2:
+		err = do_flash_erase_16bit(chip, dest, len);
+		break;
+	case 4:
+		err = do_flash_erase_32bit(chip, dest, len);
+		break;
+	default:
+		err = -1;
+		printf("flash_write: buswidth = %d is not supported\n", (int)chip->buswidth);
+		break;
+	}
+
+	return err;
+
+}
+
+int flash_probe(struct flash_chip *chip)
+{
+	int err=0;
+
+	if (!chip) return -1;
+
+	switch(chip->buswidth) {
+	case 2:
+		err = do_flash_probe_16bit(chip);
+		break;
+	case 4:
+		err = do_flash_probe_32bit(chip);
+		break;
+	default:
+		err = -1;
+		printf("flash_write: buswidth = %d is not supported\n", (int)chip->buswidth);
+		break;
+	}
+
+	return err;
+}
Index: build_tree/bootLoader/src/blob/system3.c
diff -u build_tree/bootLoader/src/blob/system3.c:1.1.1.1 build_tree/bootLoader/src/blob/system3.c:1.1.1.2
--- build_tree/bootLoader/src/blob/system3.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/system3.c	Fri Nov  9 09:44:05 2007
@@ -2,7 +2,7 @@
  * system3.c: PT System3 specific stuff
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- * Copyright (C) 2001  Stefan Eletzhofer 
+ * Copyright (C) 2001,2002  Stefan Eletzhofer 
  *                               (stefan.eletzhofer@www.eletztrick.de)
  *
  * This program is free software; you can redistribute it and/or modify
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: system3.c,v 1.9 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: system3.c,v 1.35 2003/09/04 17:39:00 russd Exp $"
 
 /**********************************************************************
  * includes
@@ -36,22 +36,44 @@
 #include <blob/errno.h>
 #include <blob/error.h>
 #include <blob/util.h>
+#include <blob/reboot.h>
 #include <blob/serial.h>
 #include <blob/flash.h>
 #include <blob/init.h>
 #include <blob/command.h>
 #include <blob/uucodec.h>
-#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/partition.h>
+#include <blob/led.h>
+
+#include <blob/arch.h>
+#include <blob/proc/sa1111.h>
+
+#include <blob/generic_io.h>
+
+#include <blob/pcmcia.h>
+#include <blob/cf.h>
+#include <blob/ide.h>
+#include <blob/tar.h>
+#include <net/ether.h>
+#include <net/net.h>
 
 /**********************************************************************
  * defines
  */
-
-/* this will send a cold shiver through erik's spine ... */
-#define	ERR( x )		{ ret = x; goto DONE; }
-
 /* more readable IMHO */
-#define MEM( x )        (*((u32 *)x))
+#define MEM( x )        (*((u32 *)(x)))
+#define SET(reg,bit) ((reg) |= (1<<(bit)))
+#define RST(reg,bit) ((reg) &= ~(1<<(bit)))
+
+#define SYSTEM3_DEBUG 1
+
+#if SYSTEM3_DEBUG
+#	define DBG( x, args... )	if ( sys3_dbg>x ) printf( args )
+#else
+#	define DBG( x, args... )
+#endif
+
 
 /**********************************************************************
  * globals
@@ -63,9 +85,15 @@
  * module globals
  */
 
+#if SYSTEM3_DEBUG
+static int sys3_dbg = 1;
+#else
+static int sys3_dbg = 0;
+#endif
+
 /* flash descriptor for System3 flash. */
 /* System 3 uses 2xINTEL e28F640 Chips */
-static flash_descriptor_t system3_flash_descriptors[] =
+static const flash_descriptor_t system3_flash_descriptors[] =
 {
 	{
 		size: 2 * 128 * 1024,
@@ -77,176 +105,340 @@
 	},
 };
 
+/* default partition table for SYSTEM3
+
+System3 flash layout
+~~~~~~~~~~~~~~~~~~~~
+
+16Mb Flash
+256k erase size
+
+0x00000000 BLOB		256k
+0x00040000 CONFIG	256k
+0x00080000 KERNEL	1024k
+0x00180000 INITRD	1536k
+0x00300000 ROOT		6M
+0x00900000 DATA		7M
+0x01000000 total	16M
+
+Note:
+	- system3 partitions are named like the files they're flashed
+	  with. This is to keep updating easy: Just loop through all
+	  files that are on our update media and flash them on the partition
+	  named like the file.
+
+ */
+static const blob_partition_t system3_default_partition_table[] = {
+	{
+		/* start of table */
+		magic:	BLOB_DEFAULT_PART_TABLE_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	0x00000000,	/* absolute base address */
+		size:	0x02000000  /* total size of the flash */
+	},
+	{
+		/* blob itself */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		BLOB_FLASH_BASE,
+		size:		BLOB_FLASH_LEN,
+		name:		"blob",
+		mem_base:	BLOB_RAM_BASE
+	},
+	{
+		/* system config area */
+		magic:	BLOB_PART_VALID_MAGIC,
+		next:	sizeof(blob_partition_t),
+		offset:	CONFIG_FLASH_BASE,
+		size:	CONFIG_FLASH_LEN,
+		name:	"config.tar",
+		flags:	0
+	},
+	{
+		/* kernel */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset: 	KERNEL_FLASH_BASE,
+		size:		KERNEL_FLASH_LEN,
+		name:		"zImage",
+		flags:		BLOB_PART_FLAG_LOAD | BLOB_PART_FLAG_EXEC,
+		mem_base:	KERNEL_RAM_BASE,
+		entry_point:	KERNEL_RAM_BASE
+	},
+	{
+		/* ramdisk */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		RAMDISK_FLASH_BASE,
+		size:		RAMDISK_FLASH_LEN,
+		name:		"initrd.gz",
+		flags:		BLOB_PART_FLAG_LOAD,
+		mem_base:	RAMDISK_RAM_BASE
+	},
+	{
+		/* root (cramfs) */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		ROOTFS_FLASH_BASE,
+		size:		ROOTFS_FLASH_LEN,
+		name:		"cramfs",
+		flags:		BLOB_PART_FLAG_CRAMFS,
+	},
+	{
+		/* data (cramfs) */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		DATAFS_FLASH_BASE,
+		size:		DATAFS_FLASH_LEN,
+		name:		"data.img",
+		flags:		BLOB_PART_FLAG_CRAMFS,
+	},
+	{
+		/* xtended data (cramfs) */
+		magic:		BLOB_PART_VALID_MAGIC,
+		next:		sizeof(blob_partition_t),
+		offset:		XDATAFS_FLASH_BASE,
+		size:		XDATAFS_FLASH_LEN,
+		name:		"xdata.img",
+		flags:		BLOB_PART_FLAG_CRAMFS,
+	},
+	{
+		/* last entry */
+		magic:	BLOB_PART_LAST_MAGIC
+	}
+};
+
 /**********************************************************************
  * static functions
  */
+static char module_version[] = "$Id: system3.c,v 1.35 2003/09/04 17:39:00 russd Exp $";
+static void sa1111_init();
 
 /*********************************************************************
- * init_system3_flash
- *
- * AUTOR:	SELETZ
- * REVISED:
- *
- * inits system 3 flash driver
- *
+ * init_system3_flash - inits system 3 flash driver
  */
 static void init_system3_flash_driver(void)
 {
 	flash_descriptors = system3_flash_descriptors;
 	flash_driver = &intel32_flash_driver;
 }
-
 __initlist(init_system3_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
 
+/*********************************************************************
+ * system3_init_hardware - inits system 3 LL hardware stuff
+ */
+static void system3_init_hardware(void)
+{
+	/* init on-board CPLD */
+	MEM(SYSTEM3_CTRL_0) = 0x03;
+	MEM(SYSTEM3_CTRL_1) = 0x00;
+	MEM(SYSTEM3_CTRL_2) = 0x00;
+
+	/* initialize GPIO states */
+	GPDR = 0x0f35a7fc;
+	GPSR |= GPIO_GPIO15 | GPIO_GPIO20; /* 15: core fast, 20: SCL */
+	GPCR |= 0x070527fc;
+
+	/* activate SYSCLCK for keyboard controller */
+	RST( MEM(TUCR), 31 );
+	GAFR |= GPIO_32_768kHz;
+	GPDR |= GPIO_32_768kHz;
 
+	/* 3.6864 MHz SYSCLK */
+	TUCR = TUCR_3_6864MHz;
 
+	msleep( 1 );
 
-static void system3_init_hardware(void)
-{
-	/* select serial driver */
+	sa1111_init();
+	
+	/* set nSRST */
+	MEM(SYSTEM3_CTRL_1) = 0x04;
+
+	/* issue a short beep */
+	MEM(SYSTEM3_CTRL_1) = 0x14;
+	msleep( 50 );
+	MEM(SYSTEM3_CTRL_1) = 0x04;
+
+	/* tweak blob config */
+	blob_status.boot_delay = 1;
+
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
 	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	ether_driver = &smc9196_ether_driver;
+	timer_driver = &intelarm_timer_driver;
 }
-
 __initlist(system3_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
 
 
 
+/*****************************************************************
+ * sysver - print system version
+ */
+static int sysver_cmd( int argc, char *argv[] )
+{
+	printf( "version: '%s'\n", module_version );
+	switch ( PT_ID_BOARDID ) {
+		case PT_BOARD_ALPHA:
+			printf( "ALPHA Board" );
+			break;
+		case PT_BOARD_SYS3:
+			printf( "SYSTEM 3 Board" );
+			break;
+		case PT_BOARD_DAFIT:
+			printf( "DAFIT Board" );
+			break;
+		default:
+			printf( "UNKNOWN Board (ID 0x%X)", PT_ID_BOARDID );
+			break;
 
-/*********************************************************************
- * cmd_download_file
- *
- * AUTOR:		SELETZ
- * REVISED:
- *
- * Download a file to arbitary memory location
- *
+	}
+	printf( " revision 0x%02X.\n", PT_ID_REVISION ); 
+	return 0;
+}
+static char sysver_help[] = "print BLOB and system3 version number\n";
+__commandlist(sysver_cmd, "sysver", sysver_help);
+
+/**********************************************************************
+ * sys3dbg - set system3 debug level
  */
-int cmd_download_file( int argc, char *argv[] )
+int sys3dbg_cmd( int argc, char *argv[] )
 {
-	int		ret		= 0;
-	u32		dest	= 0L;
-	u32		len	= 0L;
+	extern int cf_dbg_set(int);
+	int ret;
+	u32 lvl;
 
-	if ( argc < 3 )				ERR( -EINVAL );
+	if ( argc < 2 ) return -EINVAL;
 
-	ret = strtou32( argv[1], &dest );
-	if ( ret < 0 )				ERR( -EINVAL );
+	ret = strtou32(argv[1], &lvl);
+	if ( ret < 0 ) return -EINVAL;
 
-	ret = strtou32( argv[2], &len );
-	if ( ret < 0 )				ERR( -EINVAL );
+	sys3_dbg = lvl;
 
-	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
-		SerialOutputString("Switching to download speed\n");
-		SerialOutputString("You have 60 seconds to switch your terminal emulator to the same speed and\n");
-		SerialOutputString("start downloading. After that " PACKAGE " will switch back to term speed.\n");
-	
-		serial_init(blob_status.downloadSpeed);
+#if defined(CONFIG_PCMCIA_SUPPORT)
+	if ( lvl>5 ) {
+		cf_dbg_set( 5 );
+		tar_dbg_set( 5 );
 	} else {
-		SerialOutputString("You have 60 seconds to start downloading.\n");
+		cf_dbg_set( 0 );
+		tar_dbg_set( 0 );
 	}
 
-	ret = UUDecode((char *)dest, len);
-	if ( ret == len ) {
-		SerialOutputString("Received ");
-		SerialOutputDec(ret);
-		SerialOutputString(" (0x");
-		SerialOutputHex(ret);
-		SerialOutputString(") bytes.\n");
-		ret = 0;
+	if ( lvl>10 ) {
+		io_dbg_set( 5 );
+		pcmcia_dbg_set( 5 );
 	} else {
-		SerialOutputString("error during uudecode\n");
-	}
-	
-	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
-		SerialOutputString("\n(Please switch your terminal emulator back to terminal speed\n");
-		serial_init(blob_status.terminalSpeed);
+		io_dbg_set( 0 );
+		pcmcia_dbg_set( 0 );
 	}
+#endif
 
-DONE:
-	return ret;
+	printf( "sys3dbg: debug level set to %d\n", sys3_dbg );
+	return 0;
 }
-static char downloadhelp[] = "dlfile destadr filelength\n"
-"download file to memory\n";
-__commandlist( cmd_download_file, "dlfile", downloadhelp );
+static char sys3dbg_help[] = "sys3dbg level\n";
+__commandlist(sys3dbg_cmd, "sys3dbg", sys3dbg_help);
 
-/*********************************************************************
- * cmd_flash_write
- *
- * AUTOR:	SELETZ
- * REVISED:
- *
- * Command wrapper for low-level flash write access
- *
+/*****************************************************************
+ * sa1111_init - initialize companion chip
  */
-static int cmd_flash_write( int argc, char *argv[] )
+static void sa1111_init()
 {
-	int ret = 0;
-	u32	src	= 0L;
-	u32	dest	= 0L;
-	u32	len	= 0L;
 
-	if ( argc < 4 )				ERR( -EINVAL );
+	if ( PT_ID_BOARDID == PT_BOARD_DAFIT )
+		return;
 
-	ret = strtou32( argv[1], &src );
-	if ( ret < 0 )				ERR( -EINVAL );
+	/*
+	 * First, set up the 3.6864MHz clock on GPIO 27 for the SA-1111:
+	 * (SA-1110 Developer's Manual, section 9.1.2.1)
+	 */
+	GAFR |= GPIO_32_768kHz;
+	GPDR |= GPIO_32_768kHz;
+	TUCR = TUCR_3_6864MHz;
+
+	/*
+	 * Turn VCO on, and disable PLL Bypass.
+	 */
+	SBI_SKCR &= ~SKCR_VCO_OFF;
+	SBI_SKCR |= SKCR_PLL_BYPASS | SKCR_OE_EN;
+
+	/*
+	 * Wait lock time.  SA1111 manual _doesn't_
+	 * specify a figure for this!  We choose 100us.
+	 */
+	msleep(1);
+
+	/*
+	 * Enable RCLK.  We also ensure that RDYEN is set.
+	 */
+	SBI_SKCR |= SKCR_RCLKEN | SKCR_RDYEN;
+
+	/*
+	 * Wait 14 RCLK cycles for the chip to finish coming out
+	 * of reset. (RCLK=24MHz).  This is 590ns.
+	 */
+	msleep(1);
+
+	/*
+	 * Ensure all clocks are initially off.
+	 */
+	SKPCR = 0;
+}
 
-	ret = strtou32( argv[2], &dest );
-	if ( ret < 0 )				ERR( -EINVAL );
+#if defined(CONFIG_PCMCIA_SUPPORT)
+/*****************************************************************
+ * pcmcia_init - initialize PCMCIA
+ */
+int pcmcia_init()
+{
+	printf( "PT Digital Board PCMCIA init\n" );
+	return 0;
+}
+#endif
 
-	ret = strtou32( argv[3], &len );
-	if ( ret < 0 )				ERR( -EINVAL );
 
-	if ( len & (0x3) ) {
-		len = (len>>2)  + 1;
-	} else {
-		len = len>>2;
-	}
 
-	_DBGU32( src );
-	_DBGU32( dest );
-	_DBGU32( len );
-
-	ret = flash_write_region( (u32 *)dest, (u32*)src, len );
-DONE:
-	return ret;
-}
-static char flashwritehelp[] = "fwrite srcadr destadr size(bytes)\n"
-"flash a memory region\n";
-__commandlist( cmd_flash_write, "fwrite", flashwritehelp );
 
-/*********************************************************************
- * cmd_flash_erase
- *
- * AUTOR:	SELETZ
- * REVISED:
- *
- * Command wrapper for low-level flash erasing
- *
+
+/*****************************************************************
+ * misc utility funcs
  */
-static int cmd_flash_erase( int argc, char *argv[] )
-{
-	int ret = 0;
-	u32	dest	= 0L;
-	u32	len	= 0L;
 
-	if ( argc < 3 )				ERR( -EINVAL );
+/*****************************************************************
+ * manually reference flash and download commands until they
+ * are in libblob.
+ */
+#if 1
+extern int fwrite_cmd(int argc, char *argv[]);
+extern char fwrite_help[];
+__commandlist(fwrite_cmd, "fwrite", fwrite_help);
+
+extern int ferase_cmd(int argc, char *argv[]);
+extern char ferase_help[];
+__commandlist(ferase_cmd, "ferase", ferase_help);
+#endif
 
-	ret = strtou32( argv[1], &dest );
-	if ( ret < 0 )				ERR( -EINVAL );
+extern int dlfile_cmd(int argc, char *argv[]);
+extern char dlfile_help[];
+__commandlist(dlfile_cmd, "dlfile", dlfile_help);
 
-	ret = strtou32( argv[2], &len );
-	if ( ret < 0 )				ERR( -EINVAL );
 
-	if ( len & (0x3) ) {
-		len = (len>>2)  + 1;
-	} else {
-		len = len>>2;
-	}
+/**********************************************************************
+ * system3 default partition table
+ */
+static void system3_set_partition_table(void)
+{
+	/* the default partition table */
+	default_partition_table = system3_default_partition_table;
+	
+	/* we don't know where the flash partition table will live, so
+	 * put the pointer at 0x0000000 and let the partition table
+	 * parser figure out.
+	 */
+	flash_partition_table = (blob_partition_t*)0x00000000;
+}
 
-	ret = flash_erase_region( (u32 *)dest, len );
-DONE:
-	return ret;
-}
-static char flasherasehelp[] = "ferase adr size(bytes)\n"
-"erase a flash region\n";
-__commandlist( cmd_flash_erase, "ferase", flasherasehelp );
+__initlist(system3_set_partition_table, INIT_LEVEL_OTHER_STUFF);
+/* FIXME: need to think if this is the correct init level, we might
+ * want to have this before the param list stuff starts running */
Index: build_tree/bootLoader/src/blob/testmem.S
diff -u build_tree/bootLoader/src/blob/testmem.S:1.1.1.1 build_tree/bootLoader/src/blob/testmem.S:1.1.1.3
--- build_tree/bootLoader/src/blob/testmem.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/testmem.S	Fri Nov  9 10:37:08 2007
@@ -9,9 +9,8 @@
  *
  *
  * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -24,7 +23,7 @@
  *
  */
 
-.ident "$Id: testmem.S,v 1.1 2001/10/07 15:51:01 erikm Exp $"
+.ident "$Id: testmem.S,v 1.2 2002/02/08 10:15:05 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -36,6 +35,7 @@
 	@ returns r0 = 0 - ram present, r0 = 1 - no ram
 	@ clobbers r1 - r4
 testram:
+
         ldmia   r0, {r1, r2}	@ store current value in r1 and r2
         mov	r3, #0x55	@ write 0x55 to first word
         mov     r4, #0xaa	@ 0xaa to second
Index: build_tree/bootLoader/src/blob/testmem2.S
diff -u build_tree/bootLoader/src/blob/testmem2.S:1.1.1.1 build_tree/bootLoader/src/blob/testmem2.S:1.1.1.2
--- build_tree/bootLoader/src/blob/testmem2.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/testmem2.S	Fri Nov  9 09:44:05 2007
@@ -8,9 +8,8 @@
  *
  *
  * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
  *
  * This program is distributed in the hope that it will be useful,
  * but WITHOUT ANY WARRANTY; without even the implied warranty of
@@ -23,7 +22,7 @@
  *
  */
 
-.ident "$Id: testmem2.S,v 1.2 2001/10/07 19:34:17 erikm Exp $"
+.ident "$Id: testmem2.S,v 1.3 2002/02/08 10:15:05 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
Index: build_tree/bootLoader/src/blob/trampoline.S
diff -u build_tree/bootLoader/src/blob/trampoline.S:1.1.1.1 build_tree/bootLoader/src/blob/trampoline.S:1.1.1.2
--- build_tree/bootLoader/src/blob/trampoline.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/trampoline.S	Fri Nov  9 10:37:08 2007
@@ -25,10 +25,16 @@
 # include <blob/config.h>
 #endif
 
+#include <blob/arch.h>
+.include  "xlli/mainstone/bbu_Bulverde_defs.inc"
+
 .text
 
+.align 
+
 .globl _trampoline
 _trampoline:
+
 	/* clear the BSS section */
 	ldr	r1, bss_start
 	ldr	r0, bss_end
@@ -46,13 +52,12 @@
 	/* setup the stack pointer */
 	ldr	r0, stack_end
 	sub	sp, r0, #4
-
+	
 	/* jump to C code */
-	bl	main
-	/* if main ever returns we just call it again */
-	b	_trampoline
-
+	b	main
 
 bss_start:	.word	__bss_start
 bss_end:	.word	__bss_end
 stack_end:	.word	__stack_end
+
+
Index: build_tree/bootLoader/src/blob/trizeps.c
diff -u /dev/null build_tree/bootLoader/src/blob/trizeps.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/trizeps.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,120 @@
+/*
+ * trizeps.c: Keith & Koep Trizeps specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@www.eletztrick.de)
+ * Copyright (C) 2002  Wolfgang Mller (wolfgang.mueller@dsa-ac.de)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: trizeps.c,v 1.4 2003/09/04 17:39:00 russd Exp $"
+
+/**********************************************************************
+ * includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/flash.h>
+#include <blob/init.h>
+#include <blob/command.h>
+#include <blob/uucodec.h>
+#include <blob/led.h>
+#include <blob/time.h>
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+/* more readable IMHO */
+#define MEM( x )        (*((u32 *)x))
+
+/**********************************************************************
+ * globals
+ */
+
+extern blob_status_t blob_status;
+
+/**********************************************************************
+ * module globals
+ */
+
+/* flash descriptor for Trizeps flash */
+/* Trizeps uses 1x Intel 28F256J3A strataflash (16MB) */
+static const flash_descriptor_t trizeps_flash_descriptors[] =
+{
+	{	/* http://developer.intel.com/design/flcomp/datashts/29066710.pdf */
+		size: 1 * 128 * 1024,	/* 1 chip, 128KB blocks */
+		num: 128,	 	/* 128 blocks */
+		lockable: 1
+	},
+	{
+		/* NULL block */
+	},
+};
+
+/**********************************************************************
+ * static functions
+ */
+
+static int trizeps_flash_enable_vpp(void)
+{
+	return 0;
+}
+
+static int trizeps_flash_disable_vpp(void)
+{
+	return 0;
+}
+
+static void init_trizeps_flash_driver(void)
+{
+	flash_descriptors = trizeps_flash_descriptors;
+
+	flash_driver = &intel16_flash_driver;
+
+	flash_driver->enable_vpp = trizeps_flash_enable_vpp;
+	flash_driver->disable_vpp = trizeps_flash_disable_vpp;
+}
+
+__initlist(init_trizeps_flash_driver, INIT_LEVEL_DRIVER_SELECTION);
+
+static void trizeps_init_hardware(void)
+{
+	/* select drivers */
+	reboot_driver = &sa11x0_reboot_driver;
+	serial_driver = &sa11x0_serial_driver;
+	led_driver = &sa11x0_gpio_led_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(trizeps_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
+/* eof */
Index: build_tree/bootLoader/src/blob/uucodec.c
diff -u build_tree/bootLoader/src/blob/uucodec.c:1.1.1.1 build_tree/bootLoader/src/blob/uucodec.c:1.1.1.2
--- build_tree/bootLoader/src/blob/uucodec.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/uucodec.c	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      uucodec.c
- * Version:       $Id: uucodec.c,v 1.3 2002/01/03 16:07:18 erikm Exp $
+ * Version:       $Id: uucodec.c,v 1.6 2003/09/03 01:33:15 russd Exp $
  * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
  * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
  * Description:   uu{en|de}code functiuonality for uploading of kernels 
@@ -31,7 +31,7 @@
  *
  */
 
-#ident "$Id: uucodec.c,v 1.3 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: uucodec.c,v 1.6 2003/09/03 01:33:15 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -80,11 +80,13 @@
 	char ch, *p;
 	int bytesWritten = 0, retries = 0;
 	char buf[INT_BUF_SIZE];
+	int err;
 
 	/* Search for header line. We don't care about the mode or filename */
 	retries = 0;
 	do {
-		SerialInputString(buf, sizeof(buf), 6);
+		if ((err = SerialInputString(buf, sizeof(buf), 6)) < 0)
+			return err;
 		TEST_MAX_RETRIES;		
 	} while (strncmp(buf, "begin ", 6) != 0);
 
@@ -93,9 +95,10 @@
 */
 	/* for each input line */
 	for (;;) {
-		if (SerialInputString(p = buf, sizeof(buf), 2) == 0) {
-			return -ETOOSHORT;
-		}
+		err = SerialInputString(p = buf, sizeof(buf), 2);
+		if (!err) return -ETOOSHORT;
+		if (err < 0) return err;
+
 		/* Status print to show where we are at right now */
 		if((linesReceived++ & 0x007F) == 0) {
 			serial_write('.');
@@ -145,10 +148,12 @@
 			}
 	}
 	serial_write('\n');
-	if (SerialInputString(p = buf, sizeof(buf), 2) == 0 || (strncmp(buf, "end", 3))) {
+	err = SerialInputString(p = buf, sizeof(buf), 2);
+	if (!err || (strncmp(buf, "end", 3))) {
 		/* no "end" line */
 		return -ETOOSHORT;
 	}
+	if (err < 0) return err;
 	return(bytesWritten);
 } /* UUDecode */
 
Index: build_tree/bootLoader/src/blob/xmodem.c
diff -u build_tree/bootLoader/src/blob/xmodem.c:1.1.1.1 build_tree/bootLoader/src/blob/xmodem.c:1.1.1.2
--- build_tree/bootLoader/src/blob/xmodem.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/blob/xmodem.c	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      xmodem.c
- * Version:       $Id: xmodem.c,v 1.2 2002/01/06 19:02:29 erikm Exp $
+ * Version:       $Id: xmodem.c,v 1.4 2002/02/17 15:41:54 erikm Exp $
  * Copyright:     Copyright (C) 2001, Hewlett-Packard Company
  * Author:        Christopher Hoover <ch@hpl.hp.com>
  * Description:   xmodem functionality for uploading of kernels 
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: xmodem.c,v 1.2 2002/01/06 19:02:29 erikm Exp $"
+#ident "$Id: xmodem.c,v 1.4 2002/02/17 15:41:54 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
Index: build_tree/bootLoader/src/blob/zImage.c
diff -u /dev/null build_tree/bootLoader/src/blob/zImage.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/zImage.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,69 @@
+/*-------------------------------------------------------------------------
+ * Filename:      zimage.c
+ * Version:       $Id: zImage.c,v 1.4 2002/04/27 07:32:40 timriker Exp $
+ * Copyright:     Copyright (C) 2001, Russ Dill
+ * Author:        Russ Dill <Russ.Dill@asu.edu>
+ * Description:   Module to load kernel straight from flash
+ *-----------------------------------------------------------------------*/
+/*
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: zImage.c,v 1.4 2002/04/27 07:32:40 timriker Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/load_kernel.h>
+#include <blob/main.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+
+
+#define ZIMAGE_MAGIC 0x016f2818
+
+static int zImage_check_magic(struct part_info *part)
+{
+	return ((u32 *) part->offset)[9] == ZIMAGE_MAGIC;
+}
+
+static u32 zImage_load_kernel(u32 *dest, struct part_info *part, char *filename)
+{
+	unsigned long size;
+	int i;
+
+	size = ((u32 *) part->offset)[11] - ((u32 *) part->offset)[10];
+
+	/* yes, it could be copied all at once, but I wanted to call 
+	 * ldr_update_progress */
+	for (i = 0; i <= size - 0x40000; i += 0x40000) {
+		ldr_update_progress();
+		memcpy((char *) dest + i, part->offset + i, 0x40000);
+	}
+	memcpy((char *) dest + i, part->offset + i, size - i);
+
+	return size;
+}
+
+struct kernel_loader zImage_load = {
+	check_magic: zImage_check_magic,
+	load_kernel: zImage_load_kernel,
+	name:	     "zImage"
+};
Index: build_tree/bootLoader/src/blob/xlli/Makefile
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/Makefile:1.3
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/Makefile	Fri Nov 16 16:37:12 2007
@@ -0,0 +1,462 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# src/blob/xlli/Makefile.  Generated from Makefile.in by configure.
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+
+
+# -*- makefile -*-
+###########################################################################
+###########################################################################
+srcdir = .
+top_srcdir = ../../..
+
+pkgdatadir = $(datadir)/blob
+pkglibdir = $(libdir)/blob
+pkgincludedir = $(includedir)/blob
+top_builddir = ../../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = /usr/bin/install -c
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = armv5l-unknown-linux-gnu
+subdir = src/blob/xlli
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run aclocal-1.8
+ALL_COMMANDS = reset reboot bogomips call chgbit dummy dump md5chk memcpy poke peek
+AMDEP_FALSE = #
+AMDEP_TRUE = 
+AMTAR = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run tar
+AR = armv5l-linux-ar
+AUTOCONF = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run autoconf
+AUTOHEADER = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run autoheader
+AUTOMAKE = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run automake-1.8
+AWK = gawk
+BLOB_CF_OBJS = 
+BLOB_CHKMEM_OBJS = 
+BLOB_CLOCK_OBJS = 
+BLOB_COMMANDS = reset reboot poke peek xdownload
+BLOB_CRAMFS_OBJS = 
+BLOB_FLASH_OBJS = intel16.o
+BLOB_GIO_OBJS = 
+BLOB_IDE_OBJS = 
+BLOB_JFFS2_OBJS = 
+BLOB_LED_DRIVER_OBJS = led-mmap.o
+BLOB_LED_STARTCODE = ledasm-mmap.o
+BLOB_MEMSETUP_OBJS = 
+BLOB_NETWORK_DRIVER_OBJS = ether-smc91x.o
+BLOB_NETWORK_OBJS = 
+BLOB_PCMCIA_OBJS = 
+BLOB_PLATFORM_OBJS = mainstone.o
+BLOB_REBOOT_DRIVER_OBJS = reboot-pxa.o
+BLOB_SERIAL_DRIVER_OBJS = serial-pxa.o
+BLOB_STARTCODE_OBJS = xlli/mainstone/libxlli.a
+BLOB_TARGET = mainstone
+BLOB_TIMER_DRIVER_OBJS = time-intelarm.o
+BLOB_USBSERIAL_OBJS = 
+BLOB_UUCODEC_OBJS = 
+BLOB_XMODEM_OBJS = xmodem.o
+BLOB_ZIMAGE_OBJS = 
+CC = armv5l-linux-gcc
+CCAS = armv5l-linux-gcc
+CCASFLAGS = -g -O2
+CCDEPMODE = depmode=gcc3
+CFLAGS = -I/tmp/zipit2/build_tree/linux/include
+CPPFLAGS = 
+CYGPATH_W = echo
+DEFS = -DHAVE_CONFIG_H
+DEPDIR = .deps
+DIAG_LCD_OBJS = lcd.o
+DIAG_PLATFORM_OBJS = mainstone.o
+ECHO_C = 
+ECHO_N = -n
+ECHO_T = 
+EXEEXT = 
+INSTALL_DATA = ${INSTALL} -m 644
+INSTALL_PROGRAM = ${INSTALL}
+INSTALL_SCRIPT = ${INSTALL}
+INSTALL_STRIP_PROGRAM = ${SHELL} $(install_sh) -c -s
+LD = armv5l-linux-ld
+LDFLAGS = 
+LIBOBJS = 
+LIBS = 
+LINUX_INCLUDE = /tmp/zipit2/build_tree/linux/include
+LN_S = ln -s
+LTLIBOBJS = 
+MAINT = #
+MAINTAINER_MODE_FALSE = 
+MAINTAINER_MODE_TRUE = #
+MAKEINFO = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run makeinfo
+OBJCOPY = armv5l-linux-objcopy
+OBJEXT = o
+OCFLAGS = -O binary -R .note -R .comment -S
+PACKAGE = blob
+PACKAGE_BUGREPORT = 
+PACKAGE_NAME = 
+PACKAGE_STRING = 
+PACKAGE_TARNAME = 
+PACKAGE_VERSION = 
+PATH_SEPARATOR = :
+RANLIB = armv5l-linux-ranlib
+SET_MAKE = 
+SHELL = /bin/sh
+STRIP = armv5l-linux-strip
+VERSION = 2.0.5-pre3
+ac_ct_CC = 
+ac_ct_RANLIB = 
+ac_ct_STRIP = 
+am__fastdepCC_FALSE = #
+am__fastdepCC_TRUE = 
+am__include = include
+am__leading_dot = .
+am__quote = 
+bindir = ${exec_prefix}/bin
+build = i686-pc-linux-gnu
+build_alias = 
+build_cpu = i686
+build_os = linux-gnu
+build_vendor = pc
+datadir = ${prefix}/share
+exec_prefix = ${prefix}
+host = armv5l-unknown-linux-gnu
+host_alias = armv5l-linux
+host_cpu = armv5l
+host_os = linux-gnu
+host_vendor = unknown
+includedir = ${prefix}/include
+infodir = ${prefix}/info
+install_sh = /tmp/zipit2/build_tree/bootLoader/tools/install-sh
+libdir = ${exec_prefix}/lib
+libexecdir = ${exec_prefix}/libexec
+localstatedir = ${prefix}/var
+mandir = ${prefix}/man
+mkdir_p = mkdir -p -- .
+oldincludedir = /usr/include
+prefix = /usr/local
+program_transform_name = s,x,x,
+sbindir = ${exec_prefix}/sbin
+sharedstatedir = ${prefix}/com
+sysconfdir = ${prefix}/etc
+target_alias = 
+SUBDIRS = mainstone
+CLEANFILES = ${srcdir}/*~
+all: all-recursive
+
+.SUFFIXES:
+$(srcdir)/Makefile.in: # $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/blob/xlli/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/blob/xlli/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: # $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): # $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
+
+# This directory's subdirectories are mostly independent; you can cd
+# into them and run `make' without going through this Makefile.
+# To change the values of `make' variables: instead of editing Makefiles,
+# (1) if the variable is set in `config.status', edit `config.status'
+#     (which will cause the Makefiles to be regenerated when you run `make');
+# (2) otherwise, pass the desired values on the `make' command line.
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
+	dot_seen=no; \
+	target=`echo $@ | sed s/-recursive//`; \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  echo "Making $$target in $$subdir"; \
+	  if test "$$subdir" = "."; then \
+	    dot_seen=yes; \
+	    local_target="$$target-am"; \
+	  else \
+	    local_target="$$target"; \
+	  fi; \
+	  (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
+	   || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
+	done; \
+	if test "$$dot_seen" = "no"; then \
+	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
+	fi; test -z "$$fail"
+
+mostlyclean-recursive clean-recursive distclean-recursive \
+maintainer-clean-recursive:
+	@set fnord $$MAKEFLAGS; amf=$$2; \
+	dot_seen=no; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
+	done; \
+	rev="$$rev ."; \
+	target=`echo $@ | sed s/-recursive//`; \
+	for subdir in $$rev; do \
+	  echo "Making $$target in $$subdir"; \
+	  if test "$$subdir" = "."; then \
+	    local_target="$$target-am"; \
+	  else \
+	    local_target="$$target"; \
+	  fi; \
+	  (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
+	   || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
+	done && test -z "$$fail"
+tags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
+	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
+	done; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  if test "$$subdir" = .; then :; else \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
+	    || exit 1; \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
+	      || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-recursive
+all-am: Makefile
+installdirs: installdirs-recursive
+installdirs-am:
+install: install-recursive
+install-exec: install-exec-recursive
+install-data: install-data-recursive
+uninstall: uninstall-recursive
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-recursive
+
+clean-am: clean-generic mostlyclean-am
+
+distclean: distclean-recursive
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
+
+dvi: dvi-recursive
+
+dvi-am:
+
+html: html-recursive
+
+info: info-recursive
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-recursive
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-info-am
+
+uninstall-info: uninstall-info-recursive
+
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
+	clean clean-generic clean-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-recursive distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-generic \
+	mostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/src/blob/xlli/Makefile.am
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/Makefile.am:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,16 @@
+# -*- makefile -*-
+###########################################################################
+## Filename:      Makefile.am
+## Version:       $Id: Makefile.am,v 1.16 2003/08/06 22:55:40 abz Exp $
+## Copyright:     Copyright (C) 1999, Erik Mouw
+## Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+## Description:   Makefile
+## Created at:    Tue Aug 17 17:25:56 1999
+## Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+## Modified at:   Tue Sep 28 23:33:26 1999
+###########################################################################
+
+SUBDIRS		= @BLOB_TARGET@
+
+
+CLEANFILES	= ${srcdir}/*~
Index: build_tree/bootLoader/src/blob/xlli/Makefile.in
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/Makefile.in:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/Makefile.in	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,462 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+# -*- makefile -*-
+###########################################################################
+###########################################################################
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+VPATH = @srcdir@
+pkgdatadir = $(datadir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+top_builddir = ../../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = @INSTALL@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = @host@
+subdir = src/blob/xlli
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
+AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
+BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
+CC = @CC@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
+LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
+MAKEINFO = @MAKEINFO@
+OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
+OCFLAGS = @OCFLAGS@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+SUBDIRS = @BLOB_TARGET@
+CLEANFILES = ${srcdir}/*~
+all: all-recursive
+
+.SUFFIXES:
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/blob/xlli/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/blob/xlli/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
+
+# This directory's subdirectories are mostly independent; you can cd
+# into them and run `make' without going through this Makefile.
+# To change the values of `make' variables: instead of editing Makefiles,
+# (1) if the variable is set in `config.status', edit `config.status'
+#     (which will cause the Makefiles to be regenerated when you run `make');
+# (2) otherwise, pass the desired values on the `make' command line.
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
+	dot_seen=no; \
+	target=`echo $@ | sed s/-recursive//`; \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  echo "Making $$target in $$subdir"; \
+	  if test "$$subdir" = "."; then \
+	    dot_seen=yes; \
+	    local_target="$$target-am"; \
+	  else \
+	    local_target="$$target"; \
+	  fi; \
+	  (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
+	   || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
+	done; \
+	if test "$$dot_seen" = "no"; then \
+	  $(MAKE) $(AM_MAKEFLAGS) "$$target-am" || exit 1; \
+	fi; test -z "$$fail"
+
+mostlyclean-recursive clean-recursive distclean-recursive \
+maintainer-clean-recursive:
+	@set fnord $$MAKEFLAGS; amf=$$2; \
+	dot_seen=no; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
+	done; \
+	rev="$$rev ."; \
+	target=`echo $@ | sed s/-recursive//`; \
+	for subdir in $$rev; do \
+	  echo "Making $$target in $$subdir"; \
+	  if test "$$subdir" = "."; then \
+	    local_target="$$target-am"; \
+	  else \
+	    local_target="$$target"; \
+	  fi; \
+	  (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) $$local_target) \
+	   || case "$$amf" in *=*) exit 1;; *k*) fail=yes;; *) exit 1;; esac; \
+	done && test -z "$$fail"
+tags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
+	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
+	done; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  if test "$$subdir" = .; then :; else \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
+	    || exit 1; \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
+	      || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-recursive
+all-am: Makefile
+installdirs: installdirs-recursive
+installdirs-am:
+install: install-recursive
+install-exec: install-exec-recursive
+install-data: install-data-recursive
+uninstall: uninstall-recursive
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-recursive
+
+clean-am: clean-generic mostlyclean-am
+
+distclean: distclean-recursive
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
+
+dvi: dvi-recursive
+
+dvi-am:
+
+html: html-recursive
+
+info: info-recursive
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-recursive
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-info-am
+
+uninstall-info: uninstall-info-recursive
+
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
+	clean clean-generic clean-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-recursive distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-generic \
+	mostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/src/blob/xlli/mainstone/Makefile
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/Makefile:1.3
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/Makefile	Fri Nov 16 16:37:12 2007
@@ -0,0 +1,430 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# src/blob/xlli/mainstone/Makefile.  Generated from Makefile.in by configure.
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+
+
+#
+# Makefile.am
+#
+# Copyright (C) 2004 Yu Tang(yu.tang@intel.com)
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+#
+
+SOURCES = $(libxlli_a_SOURCES)
+
+srcdir = .
+top_srcdir = ../../../..
+
+pkgdatadir = $(datadir)/blob
+pkglibdir = $(libdir)/blob
+pkgincludedir = $(includedir)/blob
+top_builddir = ../../../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = /usr/bin/install -c
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = armv5l-unknown-linux-gnu
+subdir = src/blob/xlli/mainstone
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+ARFLAGS = cru
+LIBRARIES = $(noinst_LIBRARIES)
+libxlli_a_AR = $(AR) $(ARFLAGS)
+libxlli_a_LIBADD =
+am_libxlli_a_OBJECTS = start.$(OBJEXT) xlli_LowLev_Init.$(OBJEXT)
+libxlli_a_OBJECTS = $(am_libxlli_a_OBJECTS)
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include/blob
+CCASCOMPILE = $(CCAS) $(AM_CCASFLAGS) $(CCASFLAGS)
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(libxlli_a_SOURCES)
+DIST_SOURCES = $(libxlli_a_SOURCES)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run aclocal-1.8
+ALL_COMMANDS = reset reboot bogomips call chgbit dummy dump md5chk memcpy poke peek
+AMDEP_FALSE = #
+AMDEP_TRUE = 
+AMTAR = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run tar
+AR = armv5l-linux-ar
+AUTOCONF = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run autoconf
+AUTOHEADER = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run autoheader
+AUTOMAKE = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run automake-1.8
+AWK = gawk
+BLOB_CF_OBJS = 
+BLOB_CHKMEM_OBJS = 
+BLOB_CLOCK_OBJS = 
+BLOB_COMMANDS = reset reboot poke peek xdownload
+BLOB_CRAMFS_OBJS = 
+BLOB_FLASH_OBJS = intel16.o
+BLOB_GIO_OBJS = 
+BLOB_IDE_OBJS = 
+BLOB_JFFS2_OBJS = 
+BLOB_LED_DRIVER_OBJS = led-mmap.o
+BLOB_LED_STARTCODE = ledasm-mmap.o
+BLOB_MEMSETUP_OBJS = 
+BLOB_NETWORK_DRIVER_OBJS = ether-smc91x.o
+BLOB_NETWORK_OBJS = 
+BLOB_PCMCIA_OBJS = 
+BLOB_PLATFORM_OBJS = mainstone.o
+BLOB_REBOOT_DRIVER_OBJS = reboot-pxa.o
+BLOB_SERIAL_DRIVER_OBJS = serial-pxa.o
+BLOB_STARTCODE_OBJS = xlli/mainstone/libxlli.a
+BLOB_TARGET = mainstone
+BLOB_TIMER_DRIVER_OBJS = time-intelarm.o
+BLOB_USBSERIAL_OBJS = 
+BLOB_UUCODEC_OBJS = 
+BLOB_XMODEM_OBJS = xmodem.o
+BLOB_ZIMAGE_OBJS = 
+CC = armv5l-linux-gcc
+CCAS = armv5l-linux-gcc
+CCASFLAGS = -g -O2
+CCDEPMODE = depmode=gcc3
+CFLAGS = -I/tmp/zipit2/build_tree/linux/include
+CPPFLAGS = 
+CYGPATH_W = echo
+DEFS = -DHAVE_CONFIG_H
+DEPDIR = .deps
+DIAG_LCD_OBJS = lcd.o
+DIAG_PLATFORM_OBJS = mainstone.o
+ECHO_C = 
+ECHO_N = -n
+ECHO_T = 
+EXEEXT = 
+INSTALL_DATA = ${INSTALL} -m 644
+INSTALL_PROGRAM = ${INSTALL}
+INSTALL_SCRIPT = ${INSTALL}
+INSTALL_STRIP_PROGRAM = ${SHELL} $(install_sh) -c -s
+LD = armv5l-linux-ld
+LDFLAGS = 
+LIBOBJS = 
+LIBS = 
+LINUX_INCLUDE = /tmp/zipit2/build_tree/linux/include
+LN_S = ln -s
+LTLIBOBJS = 
+MAINT = #
+MAINTAINER_MODE_FALSE = 
+MAINTAINER_MODE_TRUE = #
+MAKEINFO = ${SHELL} /tmp/zipit2/build_tree/bootLoader/tools/missing --run makeinfo
+OBJCOPY = armv5l-linux-objcopy
+OBJEXT = o
+OCFLAGS = -O binary -R .note -R .comment -S
+PACKAGE = blob
+PACKAGE_BUGREPORT = 
+PACKAGE_NAME = 
+PACKAGE_STRING = 
+PACKAGE_TARNAME = 
+PACKAGE_VERSION = 
+PATH_SEPARATOR = :
+RANLIB = armv5l-linux-ranlib
+SET_MAKE = 
+SHELL = /bin/sh
+STRIP = armv5l-linux-strip
+VERSION = 2.0.5-pre3
+ac_ct_CC = 
+ac_ct_RANLIB = 
+ac_ct_STRIP = 
+am__fastdepCC_FALSE = #
+am__fastdepCC_TRUE = 
+am__include = include
+am__leading_dot = .
+am__quote = 
+bindir = ${exec_prefix}/bin
+build = i686-pc-linux-gnu
+build_alias = 
+build_cpu = i686
+build_os = linux-gnu
+build_vendor = pc
+datadir = ${prefix}/share
+exec_prefix = ${prefix}
+host = armv5l-unknown-linux-gnu
+host_alias = armv5l-linux
+host_cpu = armv5l
+host_os = linux-gnu
+host_vendor = unknown
+includedir = ${prefix}/include
+infodir = ${prefix}/info
+install_sh = /tmp/zipit2/build_tree/bootLoader/tools/install-sh
+libdir = ${exec_prefix}/lib
+libexecdir = ${exec_prefix}/libexec
+localstatedir = ${prefix}/var
+mandir = ${prefix}/man
+mkdir_p = mkdir -p -- .
+oldincludedir = /usr/include
+prefix = /usr/local
+program_transform_name = s,x,x,
+sbindir = ${exec_prefix}/sbin
+sharedstatedir = ${prefix}/com
+sysconfdir = ${prefix}/etc
+target_alias = 
+noinst_LIBRARIES = libxlli.a
+libxlli_a_SOURCES = start.s xlli_LowLev_Init.s 
+libxlli_a_DEPENDENCIES = \
+	xlli_LowLev_mac.mac \
+	xlli_Bulverde_defs.inc \
+	xlli_Mainstone_defs.inc \
+	xlli_LowLev_Init.s \
+	start.s 
+
+CLEANFILES = ${srcdir}/*~
+DISTCLEANFILES = ${builddir}/.deps/*.P
+all: all-am
+
+.SUFFIXES:
+.SUFFIXES: .o .obj .s
+$(srcdir)/Makefile.in: # $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/blob/xlli/mainstone/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/blob/xlli/mainstone/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: # $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): # $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+clean-noinstLIBRARIES:
+	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
+libxlli.a: $(libxlli_a_OBJECTS) $(libxlli_a_DEPENDENCIES) 
+	-rm -f libxlli.a
+	$(libxlli_a_AR) libxlli.a $(libxlli_a_OBJECTS) $(libxlli_a_LIBADD)
+	$(RANLIB) libxlli.a
+
+mostlyclean-compile:
+	-rm -f *.$(OBJEXT)
+
+distclean-compile:
+	-rm -f *.tab.c
+
+.s.o:
+	$(CCASCOMPILE) -c $<
+
+.s.obj:
+	$(CCASCOMPILE) -c `$(CYGPATH_W) '$<'`
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(LIBRARIES)
+installdirs:
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic clean-noinstLIBRARIES mostlyclean-am
+
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	clean-noinstLIBRARIES ctags distclean distclean-compile \
+	distclean-generic distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-exec install-exec-am install-info \
+	install-info-am install-man install-strip installcheck \
+	installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/src/blob/xlli/mainstone/Makefile.am
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/Makefile.am:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,36 @@
+#
+# Makefile.am
+#
+# Copyright (C) 2004 Yu Tang(yu.tang@intel.com)
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+#
+
+noinst_LIBRARIES	= libxlli.a
+
+
+libxlli_a_SOURCES	= start.s xlli_LowLev_Init.s 
+
+libxlli_a_DEPENDENCIES	= \
+	xlli_LowLev_mac.mac \
+	xlli_Bulverde_defs.inc \
+	xlli_Mainstone_defs.inc \
+	xlli_LowLev_Init.s \
+	start.s 
+
+CLEANFILES	= ${srcdir}/*~
+
+
+DISTCLEANFILES	= ${builddir}/.deps/*.P
Index: build_tree/bootLoader/src/blob/xlli/mainstone/Makefile.in
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/Makefile.in:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/Makefile.in	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,430 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+#
+# Makefile.am
+#
+# Copyright (C) 2004 Yu Tang(yu.tang@intel.com)
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+#
+
+SOURCES = $(libxlli_a_SOURCES)
+
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+VPATH = @srcdir@
+pkgdatadir = $(datadir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+top_builddir = ../../../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = @INSTALL@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = @host@
+subdir = src/blob/xlli/mainstone
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+ARFLAGS = cru
+LIBRARIES = $(noinst_LIBRARIES)
+libxlli_a_AR = $(AR) $(ARFLAGS)
+libxlli_a_LIBADD =
+am_libxlli_a_OBJECTS = start.$(OBJEXT) xlli_LowLev_Init.$(OBJEXT)
+libxlli_a_OBJECTS = $(am_libxlli_a_OBJECTS)
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include/blob
+CCASCOMPILE = $(CCAS) $(AM_CCASFLAGS) $(CCASFLAGS)
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(libxlli_a_SOURCES)
+DIST_SOURCES = $(libxlli_a_SOURCES)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
+AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
+BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
+CC = @CC@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
+LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
+MAKEINFO = @MAKEINFO@
+OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
+OCFLAGS = @OCFLAGS@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+noinst_LIBRARIES = libxlli.a
+libxlli_a_SOURCES = start.s xlli_LowLev_Init.s 
+libxlli_a_DEPENDENCIES = \
+	xlli_LowLev_mac.mac \
+	xlli_Bulverde_defs.inc \
+	xlli_Mainstone_defs.inc \
+	xlli_LowLev_Init.s \
+	start.s 
+
+CLEANFILES = ${srcdir}/*~
+DISTCLEANFILES = ${builddir}/.deps/*.P
+all: all-am
+
+.SUFFIXES:
+.SUFFIXES: .o .obj .s
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/blob/xlli/mainstone/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/blob/xlli/mainstone/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+clean-noinstLIBRARIES:
+	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
+libxlli.a: $(libxlli_a_OBJECTS) $(libxlli_a_DEPENDENCIES) 
+	-rm -f libxlli.a
+	$(libxlli_a_AR) libxlli.a $(libxlli_a_OBJECTS) $(libxlli_a_LIBADD)
+	$(RANLIB) libxlli.a
+
+mostlyclean-compile:
+	-rm -f *.$(OBJEXT)
+
+distclean-compile:
+	-rm -f *.tab.c
+
+.s.o:
+	$(CCASCOMPILE) -c $<
+
+.s.obj:
+	$(CCASCOMPILE) -c `$(CYGPATH_W) '$<'`
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(LIBRARIES)
+installdirs:
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic clean-noinstLIBRARIES mostlyclean-am
+
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	clean-noinstLIBRARIES ctags distclean distclean-compile \
+	distclean-generic distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-exec install-exec-am install-info \
+	install-info-am install-man install-strip installcheck \
+	installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/src/blob/xlli/mainstone/bbu_Bulverde_defs.inc
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/bbu_Bulverde_defs.inc:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/bbu_Bulverde_defs.inc	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,188 @@
+@ 
+@ INTEL CONFIDENTIAL
+@ Copyright 2002-2003 Intel Corporation All Rights Reserved.
+@
+@ The source code contained or described herein and all documents
+@ related to the source code (Material) are owned by Intel Corporation
+@ or its suppliers or licensors.  Title to the Material remains with
+@ Intel Corporation or its suppliers and licensors. The Material contains
+@ trade secrets and proprietary and confidential information of Intel
+@ or its suppliers and licensors. The Material is protected by worldwide
+@ copyright and trade secret laws and treaty provisions. No part of the
+@ Material may be used, copied, reproduced, modified, published, uploaded,
+@ posted, transmitted, distributed, or disclosed in any way without Intel's
+@ prior express written permission.
+@
+@ No license under any patent, copyright, trade secret or other intellectual
+@ property right is granted to or conferred upon you by disclosure or
+@ delivery of the Materials, either expressly, by implication, inducement,
+@ estoppel or otherwise. Any license under such intellectual property rights
+@ must be express and approved by Intel in writing.
+@
+@
+@ Module Name:  .equ     Bulverde_defs.inc
+@
+@ Last Updated:  12-Mar-2004
+@
+@ Abstract:  
+@
+@        This include file contains definitions that are specific to the .equ   code
+@        and are not covered in the xlli definitions.
+@
+@
+
+@**********************************************************************************
+@ GPIO direction bit definitions
+@
+
+@
+@ I2C BUS INTERFACE UNIT base address and register offsets from the base address
+@ 
+
+.equ     I2C_PHYSICAL_BASE     ,     (0x40301680)
+
+.equ     I2C_IMBR_offset       ,     (0X00)     @ I2C Bus Monitor Register
+.equ     I2C_IDBR_offset       ,     (0X08)     @ I2C Data Buffer Register
+.equ     I2C_ICR_offset        ,     (0X10)     @ I2C Control Register
+.equ     I2C_ISR_offset        ,     (0X18)     @ I2C Status Register
+.equ     I2C_ISAR_offset       ,     (0X20)     @ I2C Slave Address Register
+.equ     I2C_ICCR_offset       ,     (0x28)     @ Clock Count Register
+
+.equ     ICR_IUE               ,     (0X0040)   @ ICR I2C Unit enable bit
+.equ     ICR_SCLE              ,     (0X0020)   @ ICR I2C SCL Enable bit
+.equ     ICR_TB                ,     (0X0008)   @ ICR Transfer Byte bit
+.equ     ICR_ACKNAK            ,     (0x0004)   @ ICR ACK bit
+.equ     ICR_STOP              ,     (0x0002)   @ ICR STOP bit
+.equ     ICR_START             ,     (0X0001)   @ ICR START bit
+
+.equ     ISR_IRF               ,     (0x0080)   @ ISR Receive full bit
+.equ     ISR_ITE               ,     (0x0040)   @ ISR Transmit empty bit
+.equ     PI2C_EN               ,     (0x0040)   @ Power I2C enable bit
+
+@
+@ UART base address and register offsets from the base address 
+@
+
+.equ     FFUART_PHYSICAL_BASE    ,    0x40100000   @ Full Featured UART base address
+.equ     BTUART_PHYSICAL_BASE    ,    0x40200000   @ BlueTooth UART base address
+.equ     STUART_PHYSICAL_BASE    ,    0x40700000   @ Standard UART base address
+
+.equ     UARBR_offset     ,     (0X0)   @ UART Receive Buffer Register offset
+.equ     UATHR_offset	 ,     (0X0)   @ UART Transmit Holding Register offset
+.equ     UAIER_offset	 ,     (0x4)   @ UART Interrupt Enable Register offset
+.equ     UAIIR_offset	 ,     (0x8)   @ UART Interrupt ID Register offset
+.equ     UAFCR_offset	 ,     (0x8)   @ UART FIFO Control Register offset
+.equ     UALCR_offset	 ,     (0xC)   @ UART Line Control Register offset
+.equ     UAMCR_offset	 ,     (0x10)  @ UART Modem Control Register offset
+.equ     UALSR_offset	 ,     (0x14)  @ UART Line Status Register offset
+.equ     UAMSR_offset	 ,     (0x18)  @ UART Modem Status Register offset
+.equ     UASPR_offset	 ,     (0x1C)  @ UART Scratch Pad Register offset
+.equ     UADLL_offset	 ,     (0x0)   @ UART Divisor Latch Register (low) offset
+.equ     UADLH_offset	 ,     (0X4)   @ UART Divisor Latch Register (high) offset
+.equ     UAISR_offset	 ,     (0x20)  @ UART Slow Infrared Selector Register offset
+
+@ Misc UART data 
+
+.equ     BAUD_4800    ,     (0xC0)      @ UART Divisor low bye setting for 4800 baud
+.equ     BAUD_9600    ,     (0x60)      @ UART Divisor low bye setting for 9600 baud
+.equ     BAUD_19200   ,     (0X30)      @ UART Divisor low bye setting for 19200 baud
+.equ     BAUD_38400   ,     (0x18)      @ UART Divisor low bye setting for 38400 baud
+.equ     BAUD_57600   ,     (0x10)      @ UART Divisor low bye setting for 57600 baud
+.equ     BAUD_115200  ,     (0X08)      @ UART Divisor low bye setting for 115200 baud
+
+@ UART BIT DEFINITIONS 
+
+.equ     TDRQ     ,     (0x20)   @ Transmit Data Request
+.equ     TEMT     ,     (0x40)   @ Transmitter Empty bit
+.equ     DR       ,     (0x01)   @ Data Ready bit
+.equ     DLAB	  ,     (0x80)   @ DLAB bit
+.equ     nBT_OFF  ,     (0x100)  @ BTUART Tranceiver Control Bit
+.equ     BTDTR    ,     (0x80)   @ BTUART Data Terminal Ready bit
+
+@
+@ SSP REGISTERS base address and register offsets from the base address
+@ 
+
+.equ     SSP1_PHYSICAL_BASE        ,     (0x41000000)
+.equ     SSP2_PHYSICAL_BASE        ,     (0x41700000)
+.equ     SSP3_PHYSICAL_BASE        ,     (0x41900000)
+
+.equ     SSCR0_offset      ,     (0x00)    @ SSP Control Register 0
+.equ     SSCR1_offset      ,     (0x04)    @ SSP Control Register 1
+.equ     SSSRx_offset      ,     (0x08)    @ SSP Status Register
+.equ     SSDRx_offset      ,     (0x10)    @ SSP Data Register
+.equ     SSTOx_offset      ,     (0x28)    @ SSP Time Out Register
+.equ     SSPSPx_offset     ,     (0x2C)    @ SSP Prograqmmable Sreial Protocol Register
+
+
+@
+@ I2S INTERFACE base address and register offsets from the base address
+@ 
+.equ     I2SUNIT_PHYSICAL_BASE     ,     (0x40400000)
+
+.equ     I2SUNIT_SACR0_offset    ,     (0X00)     @ SACR0 Control 1
+.equ     I2SUNIT_SACR1_offset    ,     (0X04)     @ SACR1 Control 2
+.equ     I2SUNIT_SASR0_offset    ,     (0X0C)     @ SASR0 Status
+.equ     I2SUNIT_SAIMR_offset    ,     (0X14)     @ Interrupt Mask
+.equ     I2SUNIT_SAICR_offset    ,     (0X18)     @ Interrupt Control
+.equ     I2SUNIT_SADIV_offset    ,     (0X60)     @ Clock Divisor
+.equ     I2SUNIT_SADR_offset     ,     (0X80)     @ Data Register 
+
+@
+@ LCD CONTROLLER base address and register offsets from the base address
+@
+.equ  bbu_LCD_PHYSICAL_BASE    ,       (0x44000000)
+
+.equ  bbu_LCCR0_offset         ,       (0X000)    @ LCD Control Register 0
+.equ  bbu_LCCR1_offset         ,       (0X004)    @ LCD Control Register 1
+.equ  bbu_LCCR2_offset         ,       (0X008)    @ LCD Control Register 2
+.equ  bbu_LCCR3_offset         ,       (0X00C)    @ LCD Control Register 3
+.equ  bbu_LCCR4_offset         ,       (0X010)    @ LCD Control Register 4
+.equ  bbu_LCCR5_offset         ,       (0X014)    @ LCD Control Register 5
+
+.equ  bbu_FBR0_offset          ,       (0x020)    @ LCD Frame Branch Register 0
+.equ  bbu_FBR1_offset          ,       (0x024)    @ LCD Frame Branch Register 1
+.equ  bbu_FBR2_offset          ,       (0x028)    @ LCD Frame Branch Register 2
+.equ  bbu_FBR3_offset          ,       (0x02C)    @ LCD Frame Branch Register 3
+.equ  bbu_FBR4_offset          ,       (0x030)    @ LCD Frame Branch Register 4
+.equ  bbu_FBR5_offset          ,       (0x110)    @ LCD Frame Branch Register 5
+.equ  bbu_FBR6_offset          ,       (0x114)    @ LCD Frame Branch Register 6
+
+.equ  bbu_OVL1C1_offset        ,       (0x050)    @ LCD Overlay 1 Control Register 1
+.equ  bbu_OVL1C2_offset        ,       (0x060)    @ LCD Overlay 1 Control Register 2
+.equ  bbu_LCSR0_offset         ,       (0x038)    @ LCD Control Status Register	0
+.equ  bbu_LCSR1_offset         ,       (0x034)    @ LCD Control Status Register	1
+.equ  bbu_CMDCR_offset         ,       (0x100)    @ LCD Command Control Register
+.equ  bbu_PRSR_offset          ,       (0x104)    @ LCD Panel Read Status Register
+
+.equ  bbu_FDADR0_offset        ,       (0x200)    @ DMA Channel 0 Frame Descriptor address register
+.equ  bbu_FDADR1_offset        ,       (0x210)    @ DMA Channel 1 Frame Descriptor address register
+.equ  bbu_FDADR6_offset        ,       (0x260)    @ DMA Channel 6 Frame Descriptor address register
+
+@
+@       DMA interface
+@
+.equ  bbu_DMA_PHYSICAL_BASE       ,       (0x40000000)
+
+.equ  bbu_DMA_DCSR0_offset     ,       (0X000)     @ DMA Control/Status Reg for channel 0
+.equ  bbu_DMA_DINT_offset      ,       (0X0F0)     @ DMA Interrupt Register
+.equ  bbu_DMA_DDADR0_offset    ,       (0X200)     @ DMA Descriptor Address Register channel 0
+.equ  bbu_DMA_DSADR0_offset    ,       (0X204)     @ DMA Source Address Register channel 0
+.equ  bbu_DMA_DTADR0_offset    ,       (0X208)     @ DMA Target Address Register channel 0
+.equ  bbu_DMA_DCMD0_offset     ,       (0X20C)     @ DMA Command Address Register channel 0
+
+.equ  bbu_DMA_DRCMR3_offset    ,      (0X010C)     @ DMA Request to Channel MAP - I2S Audio transmit request
+.equ  bbu_DMA_DRCMR12_offset   ,      (0X0130)     @ DMA Request to Channel MAP - AC97 Audio transmit request
+.equ  bbu_DMA_DRCMR68_offset   ,      (0X1110)     @ DMA Request to Channel MAP - cam receive 0
+
+@
+@ PULSE WIDTH MODULATOR (PWM) REGISTERS base address and register offsets from the base address
+@ 
+
+.equ  bbu_PWM0_PHYSICAL_BASE     ,         (0x40B00000)   @ PWM 0 base address
+.equ  bbu_PWM1_PHYSICAL_BASE     ,         (0x40C00000)   @ PWM 1 base address
+
+.equ  bbu_PWMCR0                 ,         (0x00)         @ PWM Control register 0 offset
+.equ  bbu_PWMDCR0                ,         (0X04)         @ PWM Duty Cycle register 0 offset
+.equ  bbu_PWMPCR0                ,         (0X08)         @ PWM Period Control Register 0 offset
+
Index: build_tree/bootLoader/src/blob/xlli/mainstone/bbu_Mainstone_defs.inc
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/bbu_Mainstone_defs.inc:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/bbu_Mainstone_defs.inc	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,174 @@
+@ 
+@ INTEL CONFIDENTIAL
+@ Copyright 2002-2004 Intel Corporation All Rights Reserved.
+@
+@ The source code contained or described herein and all documents
+@ related to the source code (Material) are owned by Intel Corporation
+@ or its suppliers or licensors.  Title to the Material remains with
+@ Intel Corporation or its suppliers and licensors. The Material contains
+@ trade secrets and proprietary and confidential information of Intel
+@ or its suppliers and licensors. The Material is protected by worldwide
+@ copyright and trade secret laws and treaty provisions. No part of the
+@ Material may be used, copied, reproduced, modified, published, uploaded,
+@ posted, transmitted, distributed, or disclosed in any way without Intel's
+@ prior express written permission.
+@
+@ No license under any patent, copyright, trade secret or other intellectual
+@ property right is granted to or conferred upon you by disclosure or
+@ delivery of the Materials, either expressly, by implication, inducement,
+@ estoppel or otherwise. Any license under such intellectual property rights
+@ must be express and approved by Intel in writing.
+@
+@
+@ Module Name:  .equ  bbu_Mainstone_defs.inc
+@
+@ Last Updated: 29-Jan-2004
+@
+@ Abstract:  
+@
+@       This include file contains platform definitions that are BBU specific and
+@       are not included in the xlli include file.
+@
+@*********************************************************************************
+@
+@       Page table information for BBU running out of SRAM
+@
+.equ    bbu_p_PageTable        ,       0x5C03C000       @ Base address for SRAM based Page Table
+.equ    bbu_s_PageTable        ,       0x00004000       @ Page Table size (4K words - 16 Kb)
+
+@   ***********************
+@   **                   **
+@   **  KEYPAD SETTINGS  **
+@   **                   **
+@   ***********************
+@
+.equ  bbu_KPREC_Count0      ,       (0x7F)       @ starting value for rotary encoder
+.equ  bbu_KPKDI             ,       (4)          @ Keypad debouce time in mS (needs to be low for encoder to work)
+@
+@       BBU status word setup
+@
+.equ  BBU_STAT_IMEM             ,       1<<0            @ SDRAM initialized
+.equ  BBU_STAT_MPTS             ,       1<<1            @ BBU running out of SDRAM
+.equ  BBU_STAT_IKEY             ,       1<<3            @ Keypad initalized
+.equ  BBU_STAT_KEYR             ,       1<<4            @ Keypad key or register dump select
+.equ  BBU_STAT_CPTS             ,       1<<5            @ BBU Moved to and running from SRAM
+.equ  BBU_STAT_CMDBUF           ,       1<<6            @ BBU Command Buffer Enable / Disable bit
+
+@
+@   ***************************************
+@   **                                   **
+@   **  DATA FOR CAMERA INTERFACE SETUP  **
+@   **                                   **
+@   ***************************************
+@
+.equ  bbu_CICR0_value       ,       (0x80000000)  @ Camera Inferface Control Register 0
+.equ  bbu_CICR1_value       ,       (0x0078010a)  @ Camera Inferface Control Register 1
+.equ  bbu_CICR2_value       ,       (0x00000000)  @ Camera Inferface Control Register 2
+.equ  bbu_CICR3_value       ,       (0x00000140)  @ Camera Inferface Control Register 3 (320 lines)
+.equ  bbu_CICR4_value       ,       (0x00880003)  @ Camera Inferface Control Register 4
+
+.equ  bbu_OVL1C1_value      ,       (0x0044F0EF)  @ LCD Camera overlay control register 1 value
+.equ  bbu_OVL1C2_value      ,       (0x000000EF)  @ LCD Camera overlay control register 2 value
+.equ  bbu_CAM_length        ,       (0x00096000)  @ 640 * 480 * 2 bytes per pixel
+
+@
+@   **************************
+@   **                      **
+@   **  DATA FOR LCD SETUP  **
+@   **                      **
+@   **************************
+@
+
+@
+@ Optrex F-51373GNC MODULE
+@
+
+.equ  bbu_LCD_LCCR0_value    ,       (0x01B00A78)   @
+.equ  bbu_LCD_LCCR3_value    ,       (0x04008000)   @
+.equ  bbu_LCD_LCCR4_value    ,       (0x0)
+.equ  bbu_LCD_LCCR5_value    ,       (0x0)
+@
+@   **  Values for Optrex 320x240 display  **
+@
+.equ  LCD_Width_2            ,        320
+.equ  LCD_Height_2           ,        240
+.equ  LCD_ExLines_2          ,          0
+.equ  LCD_Depth_2            ,         16         @ Color depth (bits per pixel)
+.equ  LCD_FrameSize_2        ,     153600         @ (ExLines + Width) * Height * (Depth/8)
+.equ  LCD_BLW_2              ,          1         @ Beginning of line pixel wait count
+.equ  LCD_ELW_2              ,         10         @ End of line pixel wait ount
+.equ  LCD_HSW_2              ,          2         @ Horz sync pulse width
+.equ  LCD_BFW_2              ,          1        @ Beginning of frame pixel wait count
+.equ  LCD_EFW_2              ,          1        @ End of frame pixel wait count
+.equ  LCD_VSW_2              ,          2         @ Vert sync pulse width
+.equ  LCD_PCD_2              ,         28         @ Pixel Clock Divisor
+.equ  LCD_PCP_2              ,          1         @ Pixel Clock Polarity
+
+@
+@ POWERTIP MODULE
+@
+
+@.equ  bbu_LCD_LCCR0_value    ,       (0x01B00A78)   @
+@.equ  bbu_LCD_LCCR3_value    ,       (0x04008000)   @
+@.equ  bbu_LCD_LCCR4_value    ,       (0x0)
+@.equ  bbu_LCD_LCCR5_value    ,       (0x0)
+@
+@   **  Values for Powertip 240 x 160 display  **
+@
+@LCD_Width_2            ,        240
+@LCD_Height_2           ,        160
+@LCD_ExLines_2          ,          0
+@LCD_Depth_2            ,         16         @ Color depth (bits per pixel)
+@LCD_FrameSize_2        ,      76800         @ (ExLines + Width) * Height * (Depth/8)
+@LCD_BLW_2              ,          1         @ Beginning of line pixel wait count
+@LCD_ELW_2              ,         10         @ End of line pixel wait ount
+@LCD_HSW_2              ,          2         @ Horz sync pulse width
+@LCD_BFW_2              ,          1        @ Beginning of frame pixel wait count
+@LCD_EFW_2              ,          1        @ End of frame pixel wait count
+@LCD_VSW_2              ,          2         @ Vert sync pulse width
+@LCD_PCD_2              ,         28         @ Pixel Clock Divisor
+@LCD_PCP_2              ,          1         @ Pixel Clock Polarity
+
+
+
+.equ  LCD_READ_STATUS_REG    ,     0X0 << 9
+.equ  LCD_READ_FRAME_BUFF    ,     0X0 << 9
+.equ  LCD_COMMAND_WRITE      ,     0X1 << 9
+.equ  LCD_DATA_WRITE         ,     0X1 << 9
+.equ  LCD_FRAME_DATA_WRITE   ,     0X2 << 9
+.equ  LCD_WAIT_FOR_VSYNC     ,     0X3 << 9
+.equ  LCD_INT_PROC           ,     0X5 << 9
+
+.equ  LCD_COMMAND            ,     0X0 << 8
+.equ  LCD_DATA               ,     0X1 << 8
+
+
+@
+@   ***************************************************
+@   **                                               **
+@   **  DATA FOR FRAME BUFFER AND LCD OVERLAY SETUP  **
+@   **                                               **
+@   ***************************************************
+@
+@   NOTE: This area is mapped a ways above the top of the BBU code. If BBU code
+@         grows to reach address 0x17F00 (about 98K bytes) These addresses will have to
+@         be pushed higher.
+@
+@
+.equ  bbu_LCD_CMD        ,     (0x17F00)   @ Address to use for LCD command buffer (256 bytes)
+.equ  bbu_LCD_FRAME      ,     (0x18000)   @ Address to use for LCD frame buffer in mapped SDRAM
+                                   @ (Set aside 0x96000 bytes for frame buffer - 640 x 480)
+.equ  bbu_LCD_OVR1       ,     (0xAE000)   @ Address to use for LCD overlay 1 in mapped SDRAM
+                                   @ (Set aside 0x96000 bytes for overlay 1 - 640 x 480)
+@
+@ GLOBAL VALUES USED BY BOARD BRING UP PROGRAM
+@
+
+.equ  bbu_BOOT_POST             ,       (0x00040000)    @ Boot address for POST
+
+.equ  bbu_stat_data             ,       (0x40F00008)    @ Address where bbu program status is stored
+
+.equ  bbu_XTAL                  ,       1300            @ Xtal frequency in MHz * 100
+
+.equ  bbu_command_buffer        ,       (0x5C03B000)       @ Base of command recall buffer (256 cmds)
+
Index: build_tree/bootLoader/src/blob/xlli/mainstone/blink.h
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/blink.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/blink.h	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,71 @@
+/* Aeronix code
+*
+* Blink the yellow LED forever
+*/
+
+/* Set GPIO High (turn off LED) */
+
+AER1:	ldr	   r7,	=0x25           @ GPIO 37 (decimal)
+        mov    r2,  r7,  LSR #5     @ R2 now contains the GPIO register (0-3)
+        and    r7,  r7,  #0x1F      @ R7 now contains the number of bits to shift left
+        mov    r3,  #1              @ Set bit 0 in r3
+        mov    r3,  r3,  LSL r7     @ R3 contains bit shifted to correct position
+@
+@       Do a write to update the GPIO clear register
+@
+        ldr    r1,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Get base addres for GPIO registers
+        cmp    r2,  #0                             @ Update GPCR0?
+        streq  r3,  [r1, #xlli_GPCR0_offset]       @ Yes - write GPCRO value
+        cmp    r2,  #1                             @ Update GPCR1?
+        streq  r3,  [r1, #xlli_GPCR1_offset]       @ Yes - write GPCR1 value
+        cmp    r2,  #2                             @ Update GPCR2?
+        streq  r3,  [r1, #xlli_GPCR2_offset]       @ Yes - write GPCR2 value
+        cmp    r2,  #3                             @ Update GPCR3?
+        streq  r3,  [r1, #xlli_GPCR3_offset]       @ Yes - write GPCR3 value
+
+@ Set up for 500 mS delay
+
+        mov     r1,     #500
+        ldr     r2,  =xlli_OSTREGS_PHYSICAL_BASE @ Load OS timer base address
+        ldr     r3,  =0xE66                      @ Load r3 with value to generate 1 ms delay
+        mul     r3,  r1,  r3                     @ Calculate the total number of clock ticks 	
+        ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch OS timer value
+        add     r3,  r3,  r1                     @ Calculate ending value
+17:     ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch OS timer value
+        cmp     r1,  r3                          @ compare to 1 ms count value
+        ble     17b                              @ loop until OS timer value goes past time out value
+
+/* Set GPIO Low (turn ON LED) */
+
+	    ldr	   r7,	=0x25           @ GPIO 37 (decimal)
+        mov    r2,  r7,  LSR #5     @ R2 now contains the GPIO register (0-3)
+        and    r7,  r7,  #0x1F      @ R7 now contains the number of bits to shift left
+        mov    r3,  #0              @ Clear bit 0 in r3
+        mov    r3,  r3,  LSL r7     @ R3 contains bit shifted to correct position
+@
+@       Do a write to update the GPIO clear register
+@
+        ldr    r1,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Get base addres for GPIO registers
+        cmp    r2,  #0                             @ Update GPCR0?
+        streq  r3,  [r1, #xlli_GPCR0_offset]       @ Yes - write GPCRO value
+        cmp    r2,  #1                             @ Update GPCR1?
+        streq  r3,  [r1, #xlli_GPCR1_offset]       @ Yes - write GPCR1 value
+        cmp    r2,  #2                             @ Update GPCR2?
+        streq  r3,  [r1, #xlli_GPCR2_offset]       @ Yes - write GPCR2 value
+        cmp    r2,  #3                             @ Update GPCR3?
+        streq  r3,  [r1, #xlli_GPCR3_offset]       @ Yes - write GPCR3 value
+
+@ Set up for 500 mS delay
+
+        mov     r1,     #500
+        ldr     r2,  =xlli_OSTREGS_PHYSICAL_BASE @ Load OS timer base address
+        ldr     r3,  =0xE66                      @ Load r3 with value to generate 1 ms delay
+        mul     r3,  r1,  r3                     @ Calculate the total number of clock ticks 	
+        ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch OS timer value
+        add     r3,  r3,  r1                     @ Calculate ending value
+18:      ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch OS timer value
+        cmp     r1,  r3                          @ compare to 1 ms count value
+        ble     18b                             @ loop until OS timer value goes past time out value
+
+/* Now repeat forever */
+		bl		AER1
\ No newline at end of file
Index: build_tree/bootLoader/src/blob/xlli/mainstone/start.s
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/start.s:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/start.s	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,249 @@
+/* Orderite  */
+/* Version 2.37
+ * start.s: Mainstone/Bulverde start code using XLLI
+ *
+ * Copyright (C) 2004 Intel Corporation (yu.tang@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+        .include  "xlli_Bulverde_defs.inc"                 @ PXA27x specific include file
+        .include  "xlli_Mainstone_defs.inc"                @ Mainstone specific include file
+        .include  "xlli_LowLev_mac.mac"                    @ Mainstone Macro definitions
+		.include  "bbu_Bulverde_defs.inc"
+		.include  "bbu_Mainstone_defs.inc"
+.text
+
+/*
+ * We start by implementing *all* exception vectors
+ *
+ * Reset vector: this initialises the machine
+ * note here that this not yet taken sleep wakeup into account -- lets just
+ * get something to work first.
+ */
+
+.globl reset
+reset:
+
+	/* Initialize GPIO */
+1:	bl 	xlli_GPIO_init
+
+/* Don't toggle WIFI PDn
+	ldr     r2,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Load the GPIO register block base address
+	mov     r1,  #0x0200						@ Take WIFI PDn low
+	str     r1,  [r2, #xlli_GPCR0_offset]       
+	
+	ldr     r2,  =xlli_OSTREGS_PHYSICAL_BASE @ Load OS timer base address
+	ldr     r3,  [r2, #xlli_OSCR0_offset]    @ Fetch starting value of OSCR0
+	add     r3,  r3,  #0x50000                 @ about 100ms
+	
+delay_100ms:  
+	ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch current OSCR0 value
+	cmp     r1,  r3                          @ Is the timer past the time out value?
+	bmi     delay_100ms                          @ No - Loop until it is
+	
+	ldr     r2,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Load the GPIO register block base address
+	mov     r1,  #0x0200						
+	str     r1,  [r2, #xlli_GPSR0_offset]       @ Take WIFI PDn high
+*/
+@
+@       Save the TI PMU address in the FFUART scratch pad register
+@
+        mov    r1,  #0x90                        @ Set PMU codec base address
+        ldr    r2,  =FFUART_PHYSICAL_BASE    @ Fetch base address of FFUART
+        str    r1,  [r2, #UASPR_offset]      @ Store I2C address in the scratch pad register
+@
+@ Enable active discharge on switching regulators
+@
+	mov	r4, #0x05			@ register to write
+	mov	r5, #0x47		@ data to write
+	bl	bbu_putPI2C
+
+
+@ Turn on the clock to the MMC/SD interface (this works)
+		ldr		r1, =MMC_STRPCL
+		mov		r2, #0x2
+		str		r2,	[r1]
+
+@ Now init the interface
+		ldr		r1, =MMC_CMDAT
+		mov		r2, #0xC0		@ Enable 1 bit data transfer and send 80 init clocks. Enable DMA
+		str		r2,	[r1]
+	
+
+ 
+@ Set the PLLs to max out the clock speeds
+
+        mov    r2,  #0x190                                  @ Set the core frequency to 312MHz and bus to 104MHz
+        ldr    r4,  =xlli_CLKREGS_PHYSICAL_BASE             @ Load clock registers base address
+        str    r2,  [r4, #xlli_CCCR_offset]                 @ Write to the clock config register
+        bl     xlli_freq_change                             @ Frequency change sequence & restart memory controller
+@
+@ Set the SDRAM clock to 1X bus clock
+@
+        ldr    r1,  =xlli_MEMORY_CONFIG_BASE    @ Clock registers base address
+		ldr	   r4,  =0x2011A01E
+        str    r4,  [r1,  #xlli_MDREFR_offset]  @ Write data to register (this sets the SDRAM clock to 104MHz)
+
+@
+@ Set the Turbo bit
+@
+
+		mov    r7, #0x1
+        mrc    p14, 0, r6, c6, c0, 0    @ Get data in CP14, Register 6
+        bic    r6,  r6,  #1             @ Clear Turbo bit
+        bic    r6,  r6,  #2             @ Make sure the frequency change bit is cleared
+        orr    r6,  r6,  r7             @ Update with value from user
+        mcr    p14, 0, r6, c6, c0, 0    @ Write data to CP14, Register 6
+
+
+	/* Initialize clocks 
+	bl 	xlli_clks_init    */
+
+	/* Initialize the STUART */
+	ldr	r0,	=STUART_PHYSICAL_BASE
+	ldr r2, =BAUD_115200
+
+	bl	xlli_UART_init
+
+	/* Initialize the FFUART - This is the Modem chip */
+	ldr	r0,	=FFUART_PHYSICAL_BASE
+	ldr r2, =BAUD_38400
+
+	bl	xlli_UART_init
+
+	/* Initialize the BTART -- This is the RF Dolphin chip */
+	ldr	r0,	=BTUART_PHYSICAL_BASE
+	ldr r2, =BAUD_19200
+
+	bl	xlli_UART_init
+
+	/* Intialize power manager and internal memory */
+	bl 	xlli_pwrmgr_init
+	bl 	xlli_IMpwr_init	
+
+	/* Initialize Memory Controller */
+	bl 	xlli_mem_init
+
+	/* Initialize Interrupt Controller */
+	bl 	xlli_intr_init
+
+	/* Intialize clocks when sleep reset */
+	tst 	r12, #0x1
+	blne 	xlli_clks_init_sleepReset
+
+	/* Initialize OS timer */
+	bl 	xlli_ost_init
+
+@
+@ JWK - check wakeup reason
+@
+        ldr    r2,  =xlli_PMRCREGS_PHYSICAL_BASE @ get base address of power mgr / reset control regs
+        
+		ldr    r4, [r2, #xlli_RCSR_offset]		@ read the Reset Controller Status Register
+		str    r4, [r2, #xlli_RCSR_offset]		@ reset the Reset Controller Status Register
+@
+@ JWK - if Watchdog, let it come up
+@
+        tst    r4, #xlli_RCSR_WDR
+        bne    allow_wakeup
+        
+@
+@ JWK - if Sleep Mode reset, issue a watchdog reset
+@
+        tst    r4, #xlli_RCSR_SMR
+        bne    issue_watchdog_reset
+@        bne    allow_wakeup
+        
+@		ldr    r4, [r2, #xlli_PSPR_offset]		@ read the Scratch pad register
+@        tst    r4, #3
+@        bne    allow_wakeup
+
+@
+@ JWK - else, go back to sleep
+@
+
+go_to_sleep:
+        
+        mov    r1, #7
+		mcr    p14, 0, r1, c7, c0, 0		@ go to Deep Sleep
+sleep:
+		b		sleep
+
+issue_watchdog_reset:
+/* Don't take WIFI_PDn low
+	ldr     r2,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Load the GPIO register block base address
+	mov     r1,  #0x0200						@ Take WIFI PDn low
+	str     r1,  [r2, #xlli_GPCR0_offset]       
+*/
+	ldr    r2,  =xlli_OSTREGS_PHYSICAL_BASE @ get base address for os timer registers
+	
+	mov		r1, #0x01							@ enable Watchdog match to generate reset
+	str		r1,  [r2, #xlli_OWER_offset]
+	
+	mov		r1, #0x08							@ Clear the Match Status for Watchdog
+	str		r1,  [r2, #xlli_OSSR_offset]
+
+	ldr		r1, [r2, #xlli_OSCR0_offset]
+	add		r1, r1, #0x50000					@ reset in 100 ms
+	str		r1, [r2, #xlli_OSMR3_offset]
+	
+	b sleep
+
+allow_wakeup:
+
+	ldr     r2,  =xlli_OSTREGS_PHYSICAL_BASE @ Load OS timer base address
+	ldr     r3,  [r2, #xlli_OSCR0_offset]    @ Fetch starting value of OSCR0
+	add     r3,  r3,  #0x50000                 @ about 100ms
+	
+delay_100ms:  
+	ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch current OSCR0 value
+	cmp     r1,  r3                          @ Is the timer past the time out value?
+	bmi     delay_100ms                          @ No - Loop until it is
+	
+	ldr     r2,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Load the GPIO register block base address
+	mov     r1,  #0x4200						
+	str     r1,  [r2, #xlli_GPSR0_offset]       @ Take WIFI PDn high
+
+	bl normal_boot
+
+.globl undefined_instruction
+undefined_instruction:
+nop
+
+.globl software_interrupt
+software_interrupt:
+
+
+.globl prefetch_abort
+prefetch_abort:
+nop
+
+.globl data_abort
+data_abort:
+nop
+
+.globl not_used
+not_used:
+nop
+
+.globl irq
+irq:
+nop
+
+.globl fiq
+fiq:
+nop
Index: build_tree/bootLoader/src/blob/xlli/mainstone/xlli_Bulverde_defs.inc
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/xlli_Bulverde_defs.inc:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/xlli_Bulverde_defs.inc	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,406 @@
+@*********************************************************************************
+@
+@        COPYRIGHT (c) 2002 - 2004 Intel Corporation
+@
+@   The information in this file is furnished for informational use only,
+@   is subject to change without notice, and should not be construed as
+@   a commitment by Intel Corporation. Intel Corporation assumes no
+@   responsibility or liability for any errors or inaccuracies that may appear
+@   in this document or any software that may be provided in association with
+@   this document.
+@
+@*********************************************************************************
+@
+@  FILENAME:       .equ     xlli_Bulverde_defs.inc (Core processor address definitions for PXA27x)
+@
+@ LAST MODIFIED:   5-Apr-2004
+@
+@******************************************************************************
+@
+@ Include file for PXA27x Processor based
+@ Cross Platform Low Level Initialization  (XLLI)
+@
+
+@
+@ GENERAL PURPOSE I/O (GPIO) base address and register offsets from the base address
+@
+
+.equ     xlli_GPIOREGS_PHYSICAL_BASE	 , 	0x40E00000
+
+@ GPIO register offsets from the base address
+
+.equ     xlli_GPLR0_offset    ,    (0x000)  @ GPIO Level registers
+.equ     xlli_GPLR1_offset    ,    (0x004)
+.equ     xlli_GPLR2_offset    ,    (0x008)
+.equ     xlli_GPLR3_offset    ,    (0x100)
+
+.equ     xlli_GPDR0_offset    ,    (0x00C)  @ GPIO Direction registers
+.equ     xlli_GPDR1_offset    ,    (0x010)
+.equ     xlli_GPDR2_offset    ,    (0x014)
+.equ     xlli_GPDR3_offset    ,    (0x10C)
+
+.equ     xlli_GPSR0_offset    ,    (0x018)  @ GPIO Set registers
+.equ     xlli_GPSR1_offset    ,    (0x01C)
+.equ     xlli_GPSR2_offset    ,    (0x020)
+.equ     xlli_GPSR3_offset    ,    (0x118)
+
+.equ     xlli_GPCR0_offset    ,    (0x024)  @ GPIO Clear registers
+.equ     xlli_GPCR1_offset    ,    (0x028)
+.equ     xlli_GPCR2_offset    ,    (0x02C)
+.equ     xlli_GPCR3_offset    ,    (0x124)
+
+.equ     xlli_GAFR0_L_offset  ,    (0x054)  @ GPIO Alternate function registers (Bits 15:0)
+.equ     xlli_GAFR0_U_offset  ,    (0x058)  @ Bits 31:16
+.equ     xlli_GAFR1_L_offset  ,    (0x05c)  @ Bits 47:32
+.equ     xlli_GAFR1_U_offset  ,    (0x060)  @ Bits 63:48
+.equ     xlli_GAFR2_L_offset  ,    (0x064)  @ Bits 79:64
+.equ     xlli_GAFR2_U_offset  ,    (0x068)  @ Bits 95:80
+.equ     xlli_GAFR3_L_offset  ,    (0x06C)  @ Bits 111:96
+.equ     xlli_GAFR3_U_offset  ,    (0x070)  @ Bits 127:112
+
+@
+@ POWER MANAGER base address and register offsets from the base address
+@
+
+.equ     xlli_PMRCREGS_PHYSICAL_BASE	 , 	0x40F00000 
+
+.equ     xlli_PMCR_offset        ,     (0x00)  @ Power Manager Control Register
+.equ     xlli_PSSR_offset        ,     (0x04)  @ Power Manager Sleep Status Register
+.equ     xlli_PSPR_offset        ,     (0x08)  @ Power Manager Scratch Pad Register
+.equ     xlli_PWER_offset        ,     (0x0C)  @ Power Manager Wake-up Enable Register
+.equ     xlli_PRER_offset        ,     (0x10)  @ Power Manager GPIO Rising-edge Detect Enable Register
+.equ     xlli_PFER_offset        ,     (0x14)  @ Power Manager GPIO Falling-edge Detect Enable Register
+.equ     xlli_PEDR_offset        ,     (0x18)  @ Power Manager GPIO Edge Detect Status Register
+.equ     xlli_PCFR_offset        ,     (0x1C)  @ Power Manager General Configuration Register
+.equ     xlli_PGSR0_offset       ,     (0x20)  @ Power Manager GPIO Sleep State Register for GP [31-0]
+.equ     xlli_PGSR1_offset       ,     (0x24)  @ Power Manager GPIO Sleep State Register for GP [63-32]
+.equ     xlli_PGSR2_offset       ,     (0x28)  @ Power Manager GPIO Sleep State Register for GP [95-64]
+.equ     xlli_PGSR3_offset       ,     (0x2C)  @ Power Manager GPIO Sleep State Register for GP [120-96]
+.equ     xlli_RCSR_offset        ,     (0x30)  @ Reset Controller Status Register
+.equ     xlli_PSLR_offset        ,     (0x34)  @ Power Manager Sleep Mode Config Register
+.equ     xlli_PSTR_offset        ,     (0x38)  @ Power Manager Standby Mode Config Register
+.equ     xlli_PSNR_offset        ,     (0x3C)  @ Power Manager Sense Moce Config Register
+.equ     xlli_PVCR_offset        ,     (0x40)  @ Power Manager Voltage Change Control Register
+.equ     xlli_PKWR_offset        ,     (0x50)  @ Power Manager Keyboard Wake-up Enable Register
+.equ     xlli_PKSR_offset        ,     (0x54)  @ Power Manager Keyboard Edge-Detect Status Register
+.equ     xlli_PI2DBR_offset      ,     (0x188) @ Power I2C Data Buffer Register
+.equ     xlli_PI2CR_offset       ,     (0x190) @ Power I2C Control Register
+.equ     xlli_PI2SR_offset       ,     (0x198) @ Power I2C Status Register
+.equ     xlli_PI2SAR_offset      ,     (0x1A0) @ Power I2C Slave Address Register
+
+@
+@ POWER MANAGER register bit masks 
+@
+.equ     xlli_PSSR_SSS           ,     (0x01)  @ Software Sleep Status
+.equ     xlli_PSSR_BFS           ,     (0x02)  @ Battery Fault Status
+.equ     xlli_PSSR_VFS           ,     (0x04)  @ VCC Fault Status
+.equ     xlli_PSSR_PH            ,     (0x10)  @ Peripheral Control Hold
+.equ     xlli_PSSR_RDH           ,     (0x20)  @ Read Disable Hold
+
+.equ     xlli_PCFR_OPDE          ,     (0x01)  @ Processor (13MHz) osc power-down enable
+.equ     xlli_PCFR_FP            ,     (0x02)  @ Float PCMCIA during sleep modes
+.equ     xlli_PCFR_FS            ,     (0x04)  @ Float Static Chip Selects
+.equ     xlli_PCFR_GPR_EN        ,     (0x10)  @ GPIO 1 performs GPIO reset
+.equ     xlli_PCFR_SYSEN_EN      ,     (0x20)  @ SYS_EN pin
+.equ     xlli_PCFR_PI2C_EN       ,     (0x40)  @
+.equ     xlli_PCFR_DC_EN         ,     (0x80)  @ Deep-Sleep Mode
+.equ     xlli_PCFR_FVC           ,     (0x400) @
+.equ     xlli_PCFR_L1_EN         ,     (0x800) @
+.equ     xlli_PCFR_GPROD         ,     (0x1000) @
+.equ     xlli_PCFR_PO            ,     (0x4000) @
+.equ     xlli_PCFR_RO            ,     (0x8000) @
+.equ     xlli_PCFR_USEDBITS,(xlli_PCFR_OPDE | xlli_PCFR_FP | xlli_PCFR_FS | xlli_PCFR_GPR_EN | xlli_PCFR_SYSEN_EN| xlli_PCFR_PI2C_EN | xlli_PCFR_DC_EN | xlli_PCFR_FVC | xlli_PCFR_L1_EN| xlli_PCFR_GPROD | xlli_PCFR_PO | xlli_PCFR_RO)
+.equ     xlli_PWER_WE0           ,     (0x01)          @ Wake-up Enable GPIO pin 0
+.equ     xlli_PWER_WE1           ,     (0x02)          @ Wake-up Enable GPIO pin 1
+.equ     xlli_PWER_WERTC         ,     (0x80000000)    @ RTC Standby, Wake-up Enable-
+
+@
+@ MEMORY CONTROLLER base address and register offsets from the base address 
+@
+
+.equ     xlli_MEMORY_CONFIG_BASE ,     0x48000000
+
+.equ     xlli_MDCNFG_offset      ,     (0x00)
+.equ     xlli_MDREFR_offset      ,     (0x04)
+.equ     xlli_MSC0_offset        ,     (0x08)
+.equ     xlli_MSC1_offset        ,     (0x0C)
+.equ     xlli_MSC2_offset        ,     (0x10)
+.equ     xlli_MECR_offset        ,     (0x14)
+.equ     xlli_SXLCR_offset       ,     (0x18)
+.equ     xlli_SXCNFG_offset      ,     (0x1C)
+.equ     xlli_FLYCNFG_offset     ,     (0x20)
+.equ     xlli_SXMRS_offset       ,     (0x24)                                       
+.equ     xlli_MCMEM0_offset      ,     (0x28)
+.equ     xlli_MCMEM1_offset      ,     (0x2C)
+.equ     xlli_MCATT0_offset      ,     (0x30)
+.equ     xlli_MCATT1_offset      ,     (0x34)
+.equ     xlli_MCIO0_offset       ,     (0x38)
+.equ     xlli_MCIO1_offset       ,     (0x3C)
+.equ     xlli_MDMRS_offset       ,     (0x40)
+.equ     xlli_BOOT_DEF_offset    ,     (0x44)
+.equ     xlli_ARB_CNTL_offset    ,     (0x48)
+.equ     xlli_BSCNTR0_offset     ,     (0x4C)
+.equ     xlli_BSCNTR1_offset     ,     (0x50)
+.equ     xlli_LCDBSCNTR_offset   ,     (0x54)
+.equ     xlli_MDMRSLP_offset     ,     (0x58)
+.equ     xlli_BSCNTR2_offset     ,     (0x5C)
+.equ     xlli_BSCNTR3_offset     ,     (0x60)
+
+@ Memory Controller bit defs
+
+.equ     xlli_MDREFR_K0DB4       ,     (0x20000000)    @ Sync Static Clock 0 divide by 4 control/status
+.equ     xlli_MDREFR_K2FREE      ,     (0x02000000)    @ Set to force SDCLK[2] to be free running
+.equ     xlli_MDREFR_K1FREE      ,     (0x01000000)    @ Set to force SDCLK[1] to be free running
+.equ     xlli_MDREFR_K0FREE      ,     (0x00800000)    @ Set to force SDCLK[0] to be free running
+.equ     xlli_MDREFR_SLFRSH      ,     (0x00400000)    @ Self Refresh Control Status bit
+.equ     xlli_MDREFR_APD         ,     (0x00100000)    @ Auto Power Down bit
+.equ     xlli_MDREFR_K2DB2       ,     (0x00080000)    @ SDRAM clock pin 2 divide by 2 control/status
+.equ     xlli_MDREFR_K1DB2       ,     (0x00020000)    @ SDRAM clock pin 1 divide by 2 control/status
+.equ     xlli_MDREFR_K1RUN       ,     (0x00010000)    @ SDRAM clock pin 1 run/control status
+.equ     xlli_MDREFR_E1PIN       ,     (0x00008000)    @ SDRAM clock Enable pin 1 level control/status
+.equ     xlli_MDREFR_K0DB2       ,     (0x00004000)    @ Sync Static Memory Clock divide by 2 control/status
+.equ     xlli_MDREFR_K0RUN       ,     (0x00002000)    @ Sync Static Memory Clock Pin 0
+.equ     xlli_MDREFR_E0PIN       ,     (0x00000100)    @ SDRAM clock enable pin 0 (Cotulla ONLY!!)
+
+.equ     xlli_MDCNFG_DE0         ,     (0x00000001)    @ SDRAM enable bit for partition 0
+.equ     xlli_MDCNFG_DE1         ,     (0x00000002)    @ SDRAM enable bit for partition 1
+.equ     xlli_MDCNFG_DE2         ,     (0x00010000)    @ SDRAM enable bit for partition 2
+.equ     xlli_MDCNFG_DE3         ,     (0x00020000)    @ SDRAM enable bit for partition 3
+.equ     xlli_MDCNFG_DWID0       ,     (0x00000004)    @ SDRAM bus width (clear = 32 bits, set = 16 bits)
+
+@
+@ INTERNAL MEMORY CONTROLLER base address and register offsets from the base address 
+@
+
+.equ     xlli_IMEMORY_CONFIG_BASE        ,     (0x58000000)
+
+.equ     xlli_IMPMCR_offset              ,     (0x00)  @ Internal Memory Power Manager Control Register
+.equ     xlli_IMPMSR_offset              ,     (0x08)  @ Internal Memory Power Management Status Register
+
+
+@
+@  SSUART settings
+@
+.equ     STUART_PHYSICAL_BASE    ,    0x40700000   @ Standard UART base address
+
+.equ     UARBR_offset     ,     (0X0)   @ UART Receive Buffer Register offset
+.equ     UATHR_offset	 ,     (0X0)   @ UART Transmit Holding Register offset
+.equ     UAIER_offset	 ,     (0x4)   @ UART Interrupt Enable Register offset
+.equ     UAIIR_offset	 ,     (0x8)   @ UART Interrupt ID Register offset
+.equ     UAFCR_offset	 ,     (0x8)   @ UART FIFO Control Register offset
+.equ     UALCR_offset	 ,     (0xC)   @ UART Line Control Register offset
+.equ     UAMCR_offset	 ,     (0x10)  @ UART Modem Control Register offset
+.equ     UALSR_offset	 ,     (0x14)  @ UART Line Status Register offset
+.equ     UAMSR_offset	 ,     (0x18)  @ UART Modem Status Register offset
+.equ     UASPR_offset	 ,     (0x1C)  @ UART Scratch Pad Register offset
+.equ     UADLL_offset	 ,     (0x0)   @ UART Divisor Latch Register (low) offset
+.equ     UADLH_offset	 ,     (0X4)   @ UART Divisor Latch Register (high) offset
+.equ     UAISR_offset	 ,     (0x20)  @ UART Slow Infrared Selector Register offset
+
+@ Misc UART data 
+
+.equ     BAUD_4800    ,     (0xC0)      @ UART Divisor low bye setting for 4800 baud
+.equ     BAUD_9600    ,     (0x60)      @ UART Divisor low bye setting for 9600 baud
+.equ     BAUD_19200   ,     (0X30)      @ UART Divisor low bye setting for 19200 baud
+.equ     BAUD_38400   ,     (0x18)      @ UART Divisor low bye setting for 38400 baud
+.equ     BAUD_57600   ,     (0x10)      @ UART Divisor low bye setting for 57600 baud
+.equ     BAUD_115200  ,     (0X08)      @ UART Divisor low bye setting for 115200 baud
+
+@ UART BIT DEFINITIONS 
+
+.equ     TDRQ     ,     (0x20)   @ Transmit Data Request
+.equ     TEMT     ,     (0x40)   @ Transmitter Empty bit
+.equ     DR       ,     (0x01)   @ Data Ready bit
+.equ     DLAB	  ,     (0x80)   @ DLAB bit
+.equ     nBT_OFF  ,     (0x100)  @ BTUART Tranceiver Control Bit
+.equ     BTDTR    ,     (0x80)   @ BTUART Data Terminal Ready bit
+
+
+@
+@ INTERRUPT CONTROLLER base address and register offsets from the base address
+@ 
+
+.equ     xlli_INTERREGS_PHYSICAL_BASE      ,     (0x40D00000)
+
+.equ     xlli_ICIP_offset        ,     (0x00)   @ Interrupt Controller IRQ Pending Register
+.equ     xlli_ICMR_offset        ,     (0x04)   @ Interrupt Controller Mask Register
+.equ     xlli_ICLR_offset        ,     (0x08)   @ Interrupt Controller Level Register
+.equ     xlli_ICFP_offset        ,     (0x0C)   @ Interrupt Controller FIQ pending Register
+.equ     xlli_ICPR_offset        ,     (0x10)   @ Interrupt Controller Pending Register
+.equ     xlli_ICCR_offset        ,     (0x14)   @ Interrupt Controller Control Register
+.equ     xlli_ICHP_offset        ,     (0x18)   @ Interrupt Controller Highest Priority Reg
+.equ     xlli_ICMR2_offset       ,     (0xA0)   @ Interrupt Controller Mask Register 2
+.equ     xlli_ICLR2_offset       ,     (0xA4)   @ Interrupt Controller Level Register 2
+.equ     xlli_ICCR2_offset       ,     (0xAC)   @ Interrupt Controller Control Register 2
+
+@
+@ CLOCK REGISTERS base address and register offsets from the base address
+@ 
+
+.equ     xlli_CLKREGS_PHYSICAL_BASE        ,     (0x41300000)
+
+.equ     xlli_CCCR_offset        ,     (0x00)  @ Core Clock Configuration Register
+.equ     xlli_CKEN_offset        ,     (0x04)  @ Clock-Enable Register
+.equ     xlli_OSCC_offset        ,     (0x08)  @ Oscillator Configuration Register
+.equ     xlli_CCSR_offset        ,     (0x0C)  @ Core Clock Status Register
+
+.equ     xlli_CCCR_A_Bit_Mask    ,     (0x1 << 25)     @ "A" bit is bit 25 in CCCR
+@
+@ OS TIMER REGISTERS base address and register offsets from the base address
+@ 
+
+.equ     xlli_OSTREGS_PHYSICAL_BASE        ,     (0x40A00000)
+
+.equ     xlli_OSMR0_offset       ,     (0x00)  @ OS Timer Match Register 0
+.equ     xlli_OSMR1_offset       ,     (0x04)  @ OS Timer Match Register 1
+.equ     xlli_OSMR2_offset       ,     (0x08)  @ OS Timer Match Register 2
+.equ     xlli_OSMR3_offset       ,     (0x0C)  @ OS Timer Match Register 3
+
+.equ     xlli_OSCR0_offset       ,     (0x10)  @ OS Timer Count Register 0
+.equ     xlli_OSSR_offset        ,     (0x14)  @ OS Timer Status Register
+.equ     xlli_OWER_offset        ,     (0x18)  @ OS Timer Watchdog Enable Register
+.equ     xlli_OIER_offset        ,     (0x1C)  @ OS Timer Interrupt Enable Register
+
+.equ     xlli_OSCR4_offset       ,     (0x40)  @ OS Timer Count Register 4
+.equ     xlli_OSCR5_offset       ,     (0x44)  @ OS Timer Count Register 5
+.equ     xlli_OSCR6_offset       ,     (0x48)  @ OS Timer Count Register 6
+.equ     xlli_OSCR7_offset       ,     (0x4C)  @ OS Timer Count Register 7
+.equ     xlli_OSCR8_offset       ,     (0x50)  @ OS Timer Count Register 8
+.equ     xlli_OSCR9_offset       ,     (0x54)  @ OS Timer Count Register 9
+.equ     xlli_OSCR10_offset      ,     (0x58)  @ OS Timer Count Register 10
+.equ     xlli_OSCR11_offset      ,     (0x5C)  @ OS Timer Count Register 11
+
+.equ     xlli_OSMR4_offset       ,     (0x80)  @ OS Timer Match Register 4
+.equ     xlli_OSMR5_offset       ,     (0x84)  @ OS Timer Match Register 5
+.equ     xlli_OSMR6_offset       ,     (0x88)  @ OS Timer Match Register 6
+.equ     xlli_OSMR7_offset       ,     (0x8C)  @ OS Timer Match Register 7
+.equ     xlli_OSMR8_offset       ,     (0x90)  @ OS Timer Match Register 8
+.equ     xlli_OSMR9_offset       ,     (0x94)  @ OS Timer Match Register 9
+.equ     xlli_OSMR10_offset      ,     (0x98)  @ OS Timer Match Register 10
+.equ     xlli_OSMR11_offset      ,     (0x9C)  @ OS Timer Match Register 11
+
+.equ     xlli_OMCR4_offset       ,     (0xC0)  @ OS Timer Match Control Register 4
+.equ     xlli_OMCR5_offset       ,     (0xC4)  @ OS Timer Match Control Register 5
+.equ     xlli_OMCR6_offset       ,     (0xC8)  @ OS Timer Match Control Register 6
+.equ     xlli_OMCR7_offset       ,     (0xCC)  @ OS Timer Match Control Register 7
+.equ     xlli_OMCR8_offset       ,     (0xD0)  @ OS Timer Match Control Register 8
+.equ     xlli_OMCR9_offset       ,     (0xD4)  @ OS Timer Match Control Register 9
+.equ     xlli_OMCR10_offset      ,     (0xD8)  @ OS Timer Match Control Register 10
+.equ     xlli_OMCR11_offset      ,     (0xDC)  @ OS Timer Match Control Register 11
+
+.equ     xlli_OSSR_ALL           ,     (0xFFF) @ Match register status "sticky bits"
+.equ     xlli_OIER_E1            ,     (0x002) @ Interrupt enable bit for match register #1
+
+@
+@ REAL TIME CLOCK (RTC) REGISTERS base address and register offsets from the base address
+@ 
+
+.equ     xlli_RTCREGS_PHYSICAL_BASE      ,     (0x04090000)
+
+.equ     xlli_RCNR_offset        ,     (0x00)  @ RTC Counter Register
+.equ     xlli_RTAR_offset        ,     (0x04)  @ RTC Alarm Register
+.equ     xlli_RTSR_offset        ,     (0x08)  @ RTC Status Register
+.equ     xlli_RTTR_offset        ,     (0x0C)  @ RTC Timer Trim Register
+.equ     xlli_RDCR_offset        ,     (0x10)  @ RTC Day Counter Register
+.equ     xlli_RYCR_offset        ,     (0x14)  @ RTC Year Counter Register 
+.equ     xlli_RDAR1_offset       ,     (0x18)  @ RTC Day Alarm Register 1
+.equ     xlli_RYAR1_offset       ,     (0x1C)  @ RTC Year Alarm Register 2
+.equ     xlli_RDAR2_offset       ,     (0x20)  @ RTC Day Alarm Register 2
+.equ     xlli_RYAR2_offset       ,     (0x24)  @ RTC Year Alarm Register 2
+.equ     xlli_SWCR_offset        ,     (0x28)  @ Stopwatch Counter Register
+.equ     xlli_SWAR1_offset       ,     (0x2C)  @ Stopwatch Alarm Register 1
+.equ     xlli_SWAR2_offset       ,     (0x30)  @ Stopwatch Alarm Register 2
+.equ     xlli_PICR_offset        ,     (0x34)  @ Periodic Interrupt Counter Register
+.equ     xlli_PIAR_offset        ,     (0x38)  @ Periodic Interrupt Alarm Register
+
+
+@ Interrupt Controller bit defs
+
+.equ     xlli_OSCC_OOK           ,     (0x01)  @ Oscillator OK bit
+.equ     xlli_OSCC_OON           ,     (0x02)  @ Timekeeping (32.768KHz) Osc bit
+.equ     xlli_OSCC_TOUT_EN       ,     (0x04)  @ Timekeeping Output enable
+.equ     xlli_OSCC_PIO_EN        ,     (0x08)  @ Processor Oscillator Output Enable
+
+@
+@ Coprocessor 15 data bits
+@ 
+
+.equ     xlli_control_icache  ,     (0x1000)  @ bit 12 -  i-cache bit
+.equ     xlli_control_btb     ,     (0x0800)  @ bit 11 -  btb bit
+.equ     xlli_control_r       ,     (0x0200)  @ Bit 9
+.equ     xlli_control_s       ,     (0x0100)  @ Bit 8
+.equ     xlli_control_dcache  ,     (0x0004)  @ Bit 2  -  d-cache bit
+.equ     xlli_control_mmu     ,     (0x0001)  @ Bit 0  -  MMU bit
+
+
+@
+@ CP 15 related settings
+@
+
+.equ     xlli_PID                   ,     (0x00)
+.equ     xlli_DACR                  ,     (0x01)
+.equ     xlli_CONTROL_DCACHE        ,     (0x04)
+.equ     xlli_CONTROL_MINIDATA_01   ,     (0x10)
+.equ     xlli_CONTROL_BTB           ,     (0x800)   @ Brach Target Buffer bit
+
+@
+@ register bit masks - RCSR
+@
+.equ     xlli_RCSR_HWR         ,     (0x01)
+.equ     xlli_RCSR_WDR         ,     (0x02)
+.equ     xlli_RCSR_SMR         ,     (0x04)
+.equ     xlli_RCSR_GPR         ,     (0x08)
+.equ     xlli_RCSR_ALL         ,     (0xF)
+
+
+@
+@  CPSR Processor constants
+
+.equ     xlli_CPSR_Mode_MASK   ,       (0x0000001F)
+.equ     xlli_CPSR_Mode_USR    ,       (0x10)
+.equ     xlli_CPSR_Mode_FIQ    ,       (0x11)
+.equ     xlli_CPSR_Mode_IRQ    ,       (0x12)
+.equ     xlli_CPSR_Mode_SVC    ,       (0x13)
+.equ     xlli_CPSR_Mode_ABT    ,       (0x17)
+.equ     xlli_CPSR_Mode_UND    ,       (0x1B)
+.equ     xlli_CPSR_Mode_SYS    ,       (0x1F)
+
+.equ     xlli_CPSR_I_Bit       ,       (0x80)
+.equ     xlli_CPSR_F_Bit       ,       (0x40)
+
+
+.equ     xlli_PWRMODE_SLEEP    ,       (0x00000003) @ Value for cp14: Reg7 to induce sleep.
+@     Bit settings
+@
+.equ     xlli_BIT_0      ,     0x00000001
+.equ     xlli_BIT_1      ,     0x00000002
+.equ     xlli_BIT_2      ,     0x00000004
+.equ     xlli_BIT_3      ,     0x00000008
+.equ     xlli_BIT_4      ,     0x00000010
+.equ     xlli_BIT_5      ,     0x00000020
+.equ     xlli_BIT_6      ,     0x00000040
+.equ     xlli_BIT_7      ,     0x00000080
+.equ     xlli_BIT_8      ,     0x00000100
+.equ     xlli_BIT_9      ,     0x00000200
+.equ     xlli_BIT_10     ,     0x00000400
+.equ     xlli_BIT_11     ,     0x00000800
+.equ     xlli_BIT_12     ,     0x00001000
+.equ     xlli_BIT_13     ,     0x00002000
+.equ     xlli_BIT_14     ,     0x00004000
+.equ     xlli_BIT_15     ,     0x00008000
+.equ     xlli_BIT_16     ,     0x00010000
+.equ     xlli_BIT_17     ,     0x00020000
+.equ     xlli_BIT_18     ,     0x00040000
+.equ     xlli_BIT_19     ,     0x00080000
+.equ     xlli_BIT_20     ,     0x00100000
+.equ     xlli_BIT_21     ,     0x00200000
+.equ     xlli_BIT_22     ,     0x00400000
+.equ     xlli_BIT_23     ,     0x00800000
+.equ     xlli_BIT_24     ,     0x01000000
+.equ     xlli_BIT_25     ,     0x02000000
+.equ     xlli_BIT_26     ,     0x04000000
+.equ     xlli_BIT_27     ,     0x08000000
+.equ     xlli_BIT_28     ,     0x10000000
+.equ     xlli_BIT_29     ,     0x20000000
+.equ     xlli_BIT_30     ,     0x40000000
+.equ     xlli_BIT_31     ,     0x80000000
Index: build_tree/bootLoader/src/blob/xlli/mainstone/xlli_LowLev_Init.s
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/xlli_LowLev_Init.s:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/xlli_LowLev_Init.s	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,3366 @@
+@----------------------------------------------------------------------------------------
+@
+@ Copyright (C) 2004, Intel Corporation
+@
+@ This software program is licensed subject to the GNU General Public License
+@ (GPL).Version 2,June 1991, available at http://www.fsf.org/copyleft/gpl.html
+@
+@*********************************************************************************
+@
+@  FILENAME:       xlli_LowLev_Init.s
+@
+@  PURPOSE:        Provides low Level init procedures written specifically for
+@                  the PXA27x/Mainstone II platform.
+@
+@  LAST MODIFIED:  4-Aug-2004
+@
+@******************************************************************************
+@
+@ The functions in this source code are using the branch with link instruction.
+@ Unless otherwise specified, no system stack is assumed and no registers are preserved.
+@
+@ NOTES:
+@
+@ The use of these subroutines and/or the order in which they are called is, for the most part,
+@ arbitrary and is left up to the user. Only a few subroutines must be called in a specific order.
+@ For example, it makes no sense to go to virtual mode before the MMU is initialized and
+@ the page table is set up.... and, in order to set up the page table, memory needs to be initialized
+@ first.
+@
+        .include  "xlli_Bulverde_defs.inc"                 @ PXA27x specific include file
+        .include  "xlli_Mainstone_defs.inc"                @ Mainstone specific include file
+        .include  "xlli_LowLev_mac.mac"                    @ Mainstone Macro definitions
+		.include  "bbu_Bulverde_defs.inc"
+
+
+        @NOT SUPPORTED: AREA    "|text|, CODE, READONLY, ALIGN=5"         @ Align =5 required for "ALIGN 32" feature to work.
+@
+@ List of Low Level Init functions in this source code include:
+@
+        .global xlli_read_SCR               @ Reads the SCR and LCDR virtural registers and places in SRAM
+        .global xlli_GPIO_init              @ Get SCR and LCDCR data and Initialize the GPIO ports
+        .global xlli_mem_init               @ Memory controller initialization
+        .global xlli_mem_restart            @ Restart memory controller
+        .global xlli_mem_Tmax               @ Sets maximum memory configuration values
+        .global xlli_mem_Topt               @ Sets optimal memory configuration values based on MemClk frequency
+        .global xlli_intr_init              @ Interrupt initialization (masks all interrupts)
+        .global xlli_freq_change            @ Frequency change sequence
+        .global xlli_clks_init              @ Initialize system clocks
+        .global xlli_clks_init_sleepReset   @ Initialize system clock after a sleep reset
+        .global xlli_ost_init               @ Initalize Operating System Timers
+        .global xlli_icache_enable          @ Enable I-Cache, D-Cache, and Branch Target Buffer
+        .global xlli_pwrmgr_init            @ Initialize the Power Manager
+        .global xlli_setPTB                 @ Set the Page Table Base address (used for sleep resets)
+        .global xlli_initPageTable          @ Initialize Page Table for MMU unit
+        .global xlli_MMU_init               @ Initialize the Memory Management Unit
+        .global xlli_goVirtual              @ Make the transition from physical address to virtual address
+        .global xlli_IMpwr_init             @ Initialize Internal Memory for use
+        .global GetSCR                      @ Returns System Configuration Register data to 'C' program caller
+        .global xlli_setClocks              @ Reads platform switchs and sets PXA27x frequencies
+        .global xlli_getFreq                @ Returns current system clock settings to 'C' program caller
+        .global xlli_setBufImpedance        @ Sets SCRAM buffer impedance (C callable)
+        .global xlli_setBufImp              @ Sets SCRAM buffer impedance (ROM callable)
+        .global xlli_enableSyncFlash        @ Sets flash memory into synchronous mode
+        .global xlli_disableSyncFlash       @ Sets flash memory into asynchronous mode
+        .global xlli_isMemBusWidth16Bit     @ Checks the BOOT_SEL bit to determine bus width
+        .global xlli_queryFlash             @ Queries the Flash CFI ID register
+        .global xlli_UART_init              @ Initialize UART
+		.global xlli_PUTchar			   @ Output a character to the UART
+		.global xlli_putstr				   @ Output string to UART
+		.global bbu_putPI2C                @ Send commands to PCF50606 using PI2C bus
+		.global Z2_init
+		.global bbu_getPI2C                @ read from PCF50606 using PI2C bus
+
+		.equ    xlli_PSLR_value ,  (0xCC400000)
+
+@********************************************************************************************
+@
+@ *********************************************************
+@ **********                                     **********
+@ ********** READ SYSTEM CONFIGURATION REGISTERS **********
+@ **********                                     **********
+@ *********************************************************
+@
+@ This subroutine will reconfigure the GPIO pins in order to read the SCR (system
+@ Configuration Register) and the LCDCR (LCD Configuration Register) and place this
+@ information into SRAM for use by other programs.
+@
+@ Once these virtural register have been read, the GPIOs are reconfigured to their
+@ previous state.
+@
+@ NOTES: Written for the PXA27x Processor on the Mainstone Development Platform.
+@
+@ This subroutine uses and DOES NOT PRESERVE registers r1, r2, r3, r4, r5, r6, r7, r8 and r9
+@
+
+xlli_read_SCR:   
+@
+@       Insure the RDH and PH bits on PXA27x must be clear to enable GPIO pins.
+@       They are sticky bits so they must be set to clear them.
+@
+        ldr     r4, =xlli_PMRCREGS_PHYSICAL_BASE
+        mov     r2, #(xlli_PSSR_PH | xlli_PSSR_RDH) @ Set the PH and RDH bits to enable all GPIOs
+        str     r2, [r4, #xlli_PSSR_offset]         @ Enable all GPIO lines
+
+
+@
+@       Get, and save the present GPIO settings for direction registers 0, 1 and 2
+@
+        ldr     r4,  =xlli_GPIOREGS_PHYSICAL_BASE  @ Get the GPIO registers base address
+        ldr     r5,  [r4, #xlli_GPDR1_offset]      @ Save direction values for GPIOs [63:32]
+        ldr     r6,  [r4, #xlli_GPDR2_offset]      @ Save direction values for GPIOs [95:64]
+        ldr     r7,  [r4, #xlli_GAFR1_U_offset]    @ Save alt function values for GPIOs [63:48]
+        ldr     r8,  [r4, #xlli_GAFR2_L_offset]    @ Save alt function values for GPIOs [79:64]
+        ldr     r9,  [r4, #xlli_GAFR2_U_offset]    @ Save alt function values for GPIOs [95:80]
+
+@
+@       Clear the bits of those GPIOs we need to read as inputs and write back to the GPIO
+@       direction registers. The alternate function bits also need to be cleared. For this
+@       particular code sequence "Magic Numbers" are used for the bit clear masks.
+@
+@       To cut down on the number of registers used we'll do GPDR1 and GPDR2 now and take care of
+@       GPDR0 (and it's alternate function bits) later. Because this code is usually run very early
+@       in the boot sequence (before SDRAM is brought up) the code assumes there is no stack to
+@       preserve the contents of the registers used.
+@
+        ldr     r2,  =0xFC000000                   @ Register clear mask for GPDR1
+        bic     r1,  r5,  r2                       @ Clear the bits we need to read in GPDR1
+        str     r1,  [r4, #xlli_GPDR1_offset]      @ Write direction values for GPIOs [63:32]
+
+        ldr     r2,  =0x00C02FFF                   @ Register clear mask for GPDR2
+        bic     r1,  r6,  r2                       @ Clear the bits we need to read in GPDR2
+        str     r1,  [r4, #xlli_GPDR2_offset]      @ Write direction values for GPIOs [95:64]
+@
+@       Clear the alternate function bits for the direction bits we need to look at.
+@
+        ldr     r2,  =0xFFF00000                   @ Register clear mask for GAFR1_U
+        bic     r1,  r7,  r2                       @ Clear the alt func for bits we need to read in GAFR1_U
+        str     r1,  [r4, #xlli_GAFR1_U_offset]    @ Write alt function values for GPIOs [63:48]
+
+        ldr     r2,  =0x0CFFFFFF                   @ Register clear mask for GAFR2_L
+        bic     r1,  r8,  r2                       @ Clear the alt func for bits we need to read in GAFR2_L
+        str     r1,  [r4, #xlli_GAFR2_L_offset]    @ Write alt function values for GPIOs [79:64]
+
+        ldr     r2,  =0x0000F000                   @ Register clear mask for GAFR2_U
+        bic     r1,  r9,  r2                       @ Clear the alt func for bits we need to read in GAFR2_U
+        str     r1,  [r4, #xlli_GAFR2_U_offset]    @ Write alt function values for GPIOs [95:80]
+
+        mov     r1,  #0x200
+xlli_1:  subs    r1,  r1,  #1                       @ Short delay required to allow the new GPIO...
+        bne     xlli_1                             @ ...settings to take effect
+@
+@       With the GPIO direction registers set, the Platform System Configuration Register is read
+@       from GPIO bits 73:58 and are stored in SRAM.
+@       This data is placed in the UPPER 16 BITS (31:16) of this register.
+@
+        ldr     r1,  [r4, #xlli_GPLR1_offset]      @ Get levels for GPIOs [63:32]
+        mov     r1,  r1,  LSR #10                  @ Move the data 10 bits to the right
+        ldr     r2,  [r4, #xlli_GPLR2_offset]      @ Get levels for GPIOs [95:64]
+        mov     r3,  r2                            @ Save a copy for future reference
+        mov     r2,  r2,  LSL #22                  @ Move the data 22 bits to the left
+        orr     r1,  r1,  r2                       @ This places GPIO data bits [73:58] into bits [31:16]
+        ldr     r2,  =0xFFFF0000                   @ Mask word
+        and     r1,  r1,  r2                       @ Make sure the bottom 16 bits are clear
+@
+@       Restore GPDR1, GPDR2, GAFR1_U, GAFR2_L and GAFR2_U to their original values
+@
+        str     r5,  [r4, #xlli_GPDR1_offset]      @ Restore direction values for GPIOs [63:32]
+        str     r6,  [r4, #xlli_GPDR2_offset]      @ Restore direction values for GPIOs [95:64]
+        str     r7,  [r4, #xlli_GAFR1_U_offset]    @ Restore alt function values for GPIOs [63:48]
+        str     r8,  [r4, #xlli_GAFR2_L_offset]    @ Restore alt function values for GPIOs [79:64]
+        str     r9,  [r4, #xlli_GAFR2_U_offset]    @ Restore alt function values for GPIOs [95:80]
+@
+@       Configure GPDR0, GAFR0_L and GAFR0_U to pick up four status bits we need from this word
+@       NOTE: The values in r1 and r4 must be preserved through this section of code.
+@
+        ldr     r5,  [r4, #xlli_GPDR0_offset]      @ Save direction values for GPIOs [31:0]
+        ldr     r6,  [r4, #xlli_GAFR0_L_offset]    @ Save alt function values for GPIOs [15:0]
+        ldr     r7,  [r4, #xlli_GAFR0_U_offset]    @ Save alt function values for GPIOs [31:16]
+
+        ldr     r2,  =0xC0084000                   @ Register clear mask for GPDR0
+        bic     r8,  r5,  r2                       @ Clear the bits we need to read in GPDR0
+        str     r8,  [r4, #xlli_GPDR0_offset]      @ Write direction values for GPIOs [31:0]
+@
+@       Clear the alternate function bits for the direction bits we need to look at.
+@
+        ldr     r2,  =0x30000000                   @ Register clear mask for GAFR0_L
+        bic     r8,  r6,  r2                       @ Clear the alt func for bits we need to read in GAFR0_L
+        str     r8,  [r4, #xlli_GAFR0_L_offset]    @ Write alt function values for GPIOs [15:0]
+
+        ldr     r2,  =0xF00000C0                   @ Register clear mask for GAFR0_U
+        bic     r8,  r7,  r2                       @ Clear the alt func for bits we need to read in GAFR0_U
+        str     r8,  [r4, #xlli_GAFR0_U_offset]    @ Write alt function values for GPIOs [31:16]
+
+        mov     r2,  #0x200
+xlli_2:  subs    r2,  r2,  #1                       @ Short delay required to allow the new GPIO...
+        bne     xlli_2                             @ ...settings to take effect
+@
+@       The data that makes up the LCDCR registar (GPIO bits 87, 86, 77, 75, 74, 19, and 14) are
+@       stored in bits 6:0 of the PSPR. The xlli code does not use this data - it is only placed
+@       into the PSPR to make the data accessable to other users who can then take the data and
+@       store it elsewhere or simply ignore it and write over it.
+@
+@       The SCR data is in the upper 16 bits of r1. Now the data for the LCDCR register needs
+@       to be assembled from data saved in r3 in addition to two bits to be read from GPIOs 31:0
+@       and this data needs to be ORed into r1 as well.
+@
+        and     r2,  r3,  #0x2000                  @ isolate bit 77
+        mov     r2,  r2,  LSR #9                                   @ Move to bit position #4
+
+        and     r8,  r3,  #0xC00                   @ Extract bits 75:74
+        mov     r8,  r8,  LSR #8                   @ Move GPIO bits 75:74 to bit position 3:2
+        orr     r2,  r2,  r8                       @ Save these two bits into r2
+
+        and     r8,  r3,  #0xC00000                @ Extract bits 87:86
+        mov     r8,  r8,  LSR #17                  @ Move GPIO bits 87:86 to bit position 6:5
+        orr     r2,  r2,  r8                       @ Save these two bits into r2
+
+        ldr     r3,  [r4, #xlli_GPLR0_offset]      @ Get levels for GPIOs [31:0]
+        mov     r3,  r3,  LSR #14                  @ Allign GPIO bit 14 with bit position 0
+        and     r8,  r3,  #0x1                     @ Extract this bit
+        orr     r2,  r2,  r8                       @ OR this bit into r2
+
+        mov     r3,  r3,  LSR #4                   @ move GPIO bit 19 into bit location 1
+        and     r8,  r3,  #0x2                     @ extract this bit
+        orr     r2,  r2,  r8                       @ OR this bit value into r2
+
+        mov     r3,  r3,  LSR #5                   @ move GPIO bits 31:30 into bit locations 8:7
+        and     r3,  r3,  #0x180                   @ isolate these bits
+        orr     r2,  r2,  r3                       @ OR this bit value into r2
+@
+@       Restore GPDR0, GAFR0_L and GAFR0_U to their original values
+@
+        str     r5,  [r4, #xlli_GPDR0_offset]      @ Restore direction values for GPIOs [31:0]
+        str     r6,  [r4, #xlli_GAFR0_L_offset]    @ Restore alt function values for GPIOs [15:0]
+        str     r7,  [r4, #xlli_GAFR0_U_offset]    @ Restore alt function values for GPIOs [31:16]
+@
+@       Now we need to read status from GPIOs 103, 104 and 113
+@
+@       Configure GPDR3, GAFR3_L and GAFR3_U to pick up three status bits we need from this word
+@       NOTE: The values in r1 and r4 must be preserved through this section of code.
+@
+        ldr     r5,  [r4, #xlli_GPDR3_offset]      @ Save direction values for GPIOs [127:96]
+        ldr     r6,  [r4, #xlli_GAFR3_L_offset]    @ Save alt function values for GPIOs [111:96]
+        ldr     r7,  [r4, #xlli_GAFR3_U_offset]    @ Save alt function values for GPIOs [127:112]
+
+        ldr     r9,  =0x00020180                   @ Register clear mask for GPDR3
+        bic     r8,  r5,  r9                       @ Clear the bits we need to read in GPDR3
+        str     r8,  [r4, #xlli_GPDR3_offset]      @ Write direction values for GPIOs [127:96]
+@
+@       Clear the alternate function bits for the direction bits we need to look at.
+@
+        ldr     r9,  =0x0003C000                   @ Register clear mask for GAFR3_L
+        bic     r8,  r6,  r9                       @ Clear the alt func for bits we need to read in GAFR3_L
+        str     r8,  [r4, #xlli_GAFR3_L_offset]    @ Write alt function values for GPIOs [111:96]
+
+        ldr     r9,  =0x0000000C                   @ Register clear mask for GAFR3_U
+        bic     r8,  r7,  r9                       @ Clear the alt func for bits we need to read in GAFR3_U
+        str     r8,  [r4, #xlli_GAFR3_U_offset]    @ Write alt function values for GPIOs [127:112]
+
+        mov     r9,  #0x200
+xlli_15: subs    r9,  r9,  #1                       @ Short delay required to allow the new GPIO...
+        bne     xlli_15                            @ ...settings to take effect
+
+        ldr     r3,  [r4, #xlli_GPLR3_offset]      @ Get levels for GPIOs [127:96]
+@
+@       Restore GPDR3, GAFR3_L and GAFR3_U to their original values
+@
+        str     r5,  [r4, #xlli_GPDR3_offset]      @ Restore direction values for GPIOs [127:96]
+        str     r6,  [r4, #xlli_GAFR3_L_offset]    @ Restore alt function values for GPIOs [111:96]
+        str     r7,  [r4, #xlli_GAFR3_U_offset]    @ Restore alt function values for GPIOs [127:112]
+
+        mov     r3,  r3,  LSL #2                   @ Move GPIO bits 103:104 to bit locations 11:10
+        and     r8,  r3,  #0xC00                   @ extract settings for bits 11:10
+        orr     r2,  r2,  r8                       @ Add in to value for system config word
+
+        mov     r3,  r3,  LSR #10                  @ Move GPIO bits 113 to bit location 9
+        and     r8,  r3,  #0x400                   @ extract setting for bit 9
+        orr     r2,  r2,  r8                       @ Add in to value for system config word
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr     r8, [r4, #xlli_GAFR3_U_offset]
+@
+@       r2 now contains the SCR2 register data in bits 11:0
+@       This value gets ORed with the SCR data in bits 31:16 of r1
+@
+        orr     r1,  r1,  r2                       @ Generate the data word to be stored
+@
+@       Update SRAM with the above data
+@
+        ldr     r4,  =xlli_SCR_data                @ Get SRAM address where data is to be stored
+        str     r1,  [r4]                          @ Write the contents to SRAM
+
+        mov     pc, lr                             @ Return to calling program
+
+        
+
+        .ltorg
+
+@*********************************************************************************************
+@
+@ *************************************
+@ **********                 **********
+@ ********** CONFIGURE GPIOs **********
+@ **********                 **********
+@ *************************************
+@
+@ This subroutine sets up the GPIO pins in accordance with the values contained in the platform include file.
+@
+@ NOTES: Written for the PXA27x Processor on the Mainstone Development Platform.
+@
+xlli_GPIO_init:   
+@
+@       Get GPIO registers base address and configure all GPIO lines.
+@
+        ldr     r0,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Load the GPIO register block base address
+
+        ldr     r1,  =xlli_GPSR0_value              @ Get the pin set values for GPSR0
+        str     r1,  [r0, #xlli_GPSR0_offset]       @ Write the R0 values
+
+        ldr     r2,  =xlli_GPSR1_value              @ Get the pin set values for GPSR1
+        str     r2,  [r0, #xlli_GPSR1_offset]       @ Write the R1 values
+
+        ldr     r1,  =xlli_GPSR2_value              @ Get the pin set values for GPSR2
+        str     r1,  [r0, #xlli_GPSR2_offset]       @ Write the R2 values
+
+        ldr     r2,  =xlli_GPSR3_value              @ Get the pin set values for GPSR3
+        str     r2,  [r0, #xlli_GPSR3_offset]       @ Write the R3 values
+
+        ldr     r1,  =xlli_GPCR0_value              @ Get the pin clear values for GPCR0
+        str     r1,  [r0, #xlli_GPCR0_offset]       @ Write the R0 values
+
+        ldr     r2,  =xlli_GPCR1_value              @ Get the pin clear values for GPCR1
+        str     r2,  [r0, #xlli_GPCR1_offset]       @ Write the R1 values
+
+        ldr     r1,  =xlli_GPCR2_value              @ Get the pin clear values for GPCR2
+        str     r1,  [r0, #xlli_GPCR2_offset]       @ Write the R2 values
+
+        ldr     r2,  =xlli_GPCR3_value              @ Get the pin clear values for GPCR3
+        str     r2,  [r0, #xlli_GPCR3_offset]       @ Write the R3 values
+
+        ldr     r1,  =xlli_GPDR0_value              @ Get the pin direction values for GPDR0
+        str     r1,  [r0, #xlli_GPDR0_offset]       @ Write the R0 values
+
+        ldr     r2,  =xlli_GPDR1_value              @ Get the pin direction values for GPDR1
+        str     r2,  [r0, #xlli_GPDR1_offset]       @ Write the R1 values
+
+        ldr     r1,  =xlli_GPDR2_value              @ Get the pin direction values for GPDR2
+        str     r1,  [r0, #xlli_GPDR2_offset]       @ Write the R2 values
+
+        ldr     r2,  =xlli_GPDR3_value              @ Get the pin direction values for GPDR3
+        str     r2,  [r0, #xlli_GPDR3_offset]       @ Write the R3 values
+
+        ldr     r1,  =xlli_GAFR0_L_value            @ Get the pin alt function values for GAFR0_L
+        str     r1,  [r0, #xlli_GAFR0_L_offset]     @ Write the R0_L values
+
+        ldr     r2,  =xlli_GAFR0_U_value            @ Get the pin alt function values for GAFR0_U
+        str     r2,  [r0, #xlli_GAFR0_U_offset]     @ Write the R0_U values
+
+        ldr     r1,  =xlli_GAFR1_L_value            @ Get the pin alt function values for GAFR1_L
+        str     r1,  [r0, #xlli_GAFR1_L_offset]     @ Write the R1_L values
+
+        ldr     r2,  =xlli_GAFR1_U_value            @ Get the pin alt function values for GAFR1_U
+        str     r2,  [r0, #xlli_GAFR1_U_offset]     @ Write the R1_U values
+
+        ldr     r1,  =xlli_GAFR2_L_value            @ Get the pin alt function values for GAFR2_L
+        str     r1,  [r0, #xlli_GAFR2_L_offset]     @ Write the R2_L values
+
+        ldr     r2,  =xlli_GAFR2_U_value            @ Get the pin alt function values for GAFR2_U
+        str     r2,  [r0, #xlli_GAFR2_U_offset]     @ Write the R2_U values
+
+        ldr     r1,  =xlli_GAFR3_L_value            @ Get the pin alt function values for GAFR3_L
+        str     r1,  [r0, #xlli_GAFR3_L_offset]     @ Write the R3_L values
+
+        ldr     r2,  =xlli_GAFR3_U_value            @ Get the pin alt function values for GAFR3_U
+        str     r2,  [r0, #xlli_GAFR3_U_offset]     @ Write the R3_U values
+
+@
+@       The RDH and PH bits on PXA27x must be set to enable updated GPIO pins.
+@       These are sticky bits.
+@
+        ldr     r0, =xlli_PMRCREGS_PHYSICAL_BASE
+        mov     r2, #(xlli_PSSR_PH | xlli_PSSR_RDH) @ Set the PH and RDH bits to enable all GPIOs
+        str     r2, [r0, #xlli_PSSR_offset]         @ Enable all GPIO lines
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr     r2, [r0, #xlli_PSSR_offset]
+
+        mov     pc, lr                              @ Return to calling program
+
+        
+
+        .ltorg
+
+@*******************************************************************************************
+@
+@ **************************************************
+@ **********                              **********
+@ ********** INITIALIZE MEMORY CONTROLLER **********
+@ **********                              **********
+@ **************************************************
+@
+@ The sequence below is based on the recommended memory initializing steps detailed
+@ in the PXA27x EAS, Volume I (Section 13.17, page 13-72)
+@
+
+xlli_mem_init:   
+
+@
+@ ***** STEP 1: *****
+@
+@ Delay 200 uS
+@
+        ldr     r2,  =xlli_OSTREGS_PHYSICAL_BASE @ Load OS timer base address
+        ldr     r3,  [r2, #xlli_OSCR0_offset]    @ Fetch starting value of OSCR0
+        add     r3,  r3,  #0x300                 @ Really 0x2E1 is about 200usec, so 0x300 should be plenty
+xlli_3:  ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch current OSCR0 value
+        cmp     r1,  r3                          @ Is the timer past the time out value?
+        bmi     xlli_3                           @ No - Loop until it is
+@
+@  STEP 1 - 1st bullet: Write MSC0, MSC1 and MSC2 (the order is not important)
+@  *******************
+@
+@       The value that is loaded for MSC0 depends on which FLASH memory was used to
+@       boot from as determined by the switch position of SW2 (SWAP FLASH) on the
+@       Mainstone board. To get the position of this switch, GPIO line #73 must be sensed.
+@
+        ldr     r4,  =xlli_GPIOREGS_PHYSICAL_BASE   @ Load the GPIO register block base address
+
+        ldr     r2,  [r4, #xlli_GPDR2_offset]       @ Read GPDR2 (direction register) data
+        ldr     r5,  [r4, #xlli_GAFR2_L_offset]     @ Read alt function register for GPIO #73
+        mov     r1,  r2                             @ Copy direction register data to r1
+        mov     r3,  r5                             @ Copy alt function register to r3
+        bic     r1,  r1,  #0x200                    @ Clear direction bit for GPIO #73
+        bic     r3,  r3,  #0xC0000                  @ Clear alt function bits for GPIO #73
+@JWK	str     r3,  [r4, #xlli_GAFR2_L_offset]     @ Write alt function register
+@JWK	str     r1,  [r4, #xlli_GPDR2_offset]       @ Write GPDR2 (direction register) data
+
+@
+@       It can take many cycles for the GPIO setting to take effect before the read can be
+@       issued. The delay is based on clock cycles rather than elaped time so a simple
+@       do-nothing loop will do the trick.
+@
+        mov     r1,  #0x600                         @ Init counter
+xlli_4:  subs    r1,  r1,  #1                        @ Decrement counter
+        bne     xlli_4                              @ Loop until zero
+
+@ 2-27-06 removed reference to GPIO #73 --pb
+        ldr   r1,  =xlli_MSC0_MS_value            @ Get MSC0 setting for Mainstone Flash
+
+@
+@       Finally - Write the memory control registers
+@
+        ldr     r4,  =xlli_MEMORY_CONFIG_BASE   @ Get memory controller base address
+
+        str     r1,  [r4, #xlli_MSC0_offset]    @ Write the value out
+        ldr     r1,  [r4, #xlli_MSC0_offset]    @ Read back to latch the data
+
+        ldr     r2,  =xlli_MSC1_value           @ Get MSC1 setting
+        str     r2,  [r4, #xlli_MSC1_offset]    @ Write the value out
+        ldr     r2,  [r4, #xlli_MSC1_offset]    @ Read back to latch the data
+
+        ldr     r1,  =xlli_MSC2_value           @ Get MSC2 setting
+        str     r1,  [r4, #xlli_MSC2_offset]    @ Write the value out
+        ldr     r1,  [r4, #xlli_MSC2_offset]    @ Read back to latch the data
+@
+@  STEP 1 - 2nd bullet: Write MECR, MCMEM0, MCMEM1, MCATT0, MCATT1, MCIO0, MCIO1 (order not important)
+@  *******************
+@
+        ldr     r2,  =xlli_MECR_value           @ write MECR
+        str     r2,  [r4, #xlli_MECR_offset]
+
+        ldr     r1,  =xlli_MCMEM0_value         @ write MCMEM0
+        str     r1,  [r4, #xlli_MCMEM0_offset]
+
+        ldr     r2,  =xlli_MCMEM1_value         @ write MCMEM1
+        str     r2,  [r4, #xlli_MCMEM1_offset]
+
+        ldr     r1,  =xlli_MCATT0_value         @ write MCATT0
+        str     r1,  [r4, #xlli_MCATT0_offset]
+
+        ldr     r2,  =xlli_MCATT1_value         @ write MCATT1
+        str     r2,  [r4, #xlli_MCATT1_offset]
+
+        ldr     r1,  =xlli_MCIO0_value          @ write MCIO0
+        str     r1,  [r4, #xlli_MCIO0_offset]
+
+        ldr     r2,  =xlli_MCIO1_value          @ write MCIO1
+        str     r2,  [r4, #xlli_MCIO1_offset]
+@
+@  STEP 1 - 3rd bullet: Write FLYCNFG
+@  *******************
+@
+        ldr     r1,  =xlli_FLYCNFG_value        @ write FLYCNFG
+        str     r1,  [r4, #xlli_FLYCNFG_offset]
+@
+
+@
+@  STEP 1 - 4th bullet: SKIPPED (used only when coming out of sleep)
+@  *******************
+@
+@     (If required, this would be a write to MDCNFG with enable bits deasserted.)
+
+@
+@  STEP 1 - 5th bullet: update MDREFR settings
+@  *******************
+@
+        ldr     r2,  [r4, #xlli_MDREFR_offset] @ Get reset state of MDREFR
+        mov     r2,  r2, lsr #0xC              @ Shift data 12 bits (0xC) to the right
+        mov     r2,  r2, lsl #0xC              @ and shift left 12 bits (Clears DRI field)
+                                               @ because left shifts fill bits with zeros.
+
+        ldr     r1,  =xlli_MDREFR_value        @ Fetch MDREFR value for this platform
+        mov     r1,  r1, lsl #0x14             @ use shifts to extract the DRI field using
+        mov     r1,  r1, lsr #0x14             @ same method as before but shifting 20 (0x14)
+                                               @ bits left, then right again.
+
+        orr     r2,  r2, r1                    @ insert the DRI field extracted above
+        str     r2,  [r4, #xlli_MDREFR_offset] @ write value with valid DRI to MDREFR
+
+        orr     r2,  r2, #xlli_MDREFR_K0RUN    @ Enable K0RUN
+        bic     r2,  r2, #xlli_MDREFR_K0DB2    @ Configure K0DB2
+        orr     r2,  r2, #xlli_MDREFR_K0DB4    @ Set K0DB4 = MemClk/4
+        bic     r2,  r2, #(xlli_MDREFR_K1FREE | xlli_MDREFR_K2FREE)  @ Clear free run clock bits
+
+        @orr     r2,  r2, #xlli_MDREFR_K0FREE   ; Set K0FREE (as per Mainstone spec...)
+
+        str     r2,  [r4, #xlli_MDREFR_offset] @ Write back MDREFR
+
+        @
+        @ Preserve MDREFR in r2
+        @
+
+@ ***** STEP 2 *****
+@
+@ For systems with Synchronous Flash
+@
+@       Note: Synchronous Flash is handled in a separate xlli Function
+@
+
+@
+@ ***** STEP 3 *****
+@
+@ Clear the free run clock bits to enable the use of SDCLK for memory timing
+@
+        bic     r2, r2, #(xlli_MDREFR_K2FREE | xlli_MDREFR_K1FREE | xlli_MDREFR_K0FREE)
+
+@
+@ set K1RUN if bank 0 installed
+@
+        orr     r2, r2, #xlli_MDREFR_K1RUN      @ Enable SDCLK[1]
+        bic     r2, r2, #xlli_MDREFR_K2DB2      @ Clear K2DB2
+        str     r2, [r4, #xlli_MDREFR_offset]   @ write updated MDREFR
+        ldr     r2, [r4, #xlli_MDREFR_offset]   @ read back
+
+        bic     r2, r2, #xlli_MDREFR_SLFRSH     @ Disable self refresh
+        str     r2, [r4, #xlli_MDREFR_offset]   @ write updated MDREFR
+        ldr     r2, [r4, #xlli_MDREFR_offset]   @ read back
+
+        orr     r2, r2, #xlli_MDREFR_E1PIN      @ Assert E1PIN to enable SDCKE[1]
+        str     r2, [r4, #xlli_MDREFR_offset]   @ write updated MDREFR (finished with value in r2)
+        ldr     r2, [r4, #xlli_MDREFR_offset]   @ read back
+
+        nop                                     @ Do not remove!
+        nop                                     @ Do not remove!
+@
+@ ***** STEP 4 *****
+@
+@ Appropriately configure, but don't enable, each SDRAM partition pair
+@
+        ldr     r1, =xlli_MDCNFG_value          @ Fetch platform value for MDCNFG
+
+        bic     r1, r1,  #(xlli_MDCNFG_DE0 | xlli_MDCNFG_DE1)   @ Disable all
+        bic     r1, r1,  #(xlli_MDCNFG_DE2 | xlli_MDCNFG_DE3)   @ SDRAM banks
+@
+@       Check for conditional def for 32 vs 16 bit bus width
+@
+        .ifdef xlli_SDRAM_WIDTH_16_BIT               @ Set bus width to 16 bits?
+        orr     r1, r1,  #xlli_MDCNFG_DWID0     @ Set banks 0/1 for 16 bit width
+        .else
+        bic     r1, r1,  #xlli_MDCNFG_DWID0     @ Set banks 0/1 for 32 bit width
+        .endif
+
+        orr     r1,     r1,     #xlli_BIT_11    @ This reserved bit should always be set
+        orr     r1,     r1,     #xlli_BIT_27    @ This reserved bit should always be set
+        str     r1, [r4, #xlli_MDCNFG_offset]   @ Write w/o enabling SDRAM banks
+
+@
+@ ***** STEP 5 *****  (Delay at least 200 uS)
+@
+        ldr     r2,  =xlli_OSTREGS_PHYSICAL_BASE @ Load OS timer base address
+        ldr     r3,  [r2, #xlli_OSCR0_offset]    @ Fetch starting value of OSCR0
+        add     r3,  r3,  #0x300                 @ Really 0x2E1 is about 200usec, so 0x300 should be plenty
+xlli_5:  ldr     r1,  [r2, #xlli_OSCR0_offset]    @ Fetch current OSCR0 value
+        cmp     r1,  r3                          @ Is the timer past the time out value?
+        bmi     xlli_5                           @ No - Loop until it is
+@
+@ ***** STEP 6 ***** (Make sure DCACHE is disabled)
+@
+        mrc     p15, 0, r2, c1, c0, 0           @ load r2 contents of register 1 in CP 15
+        bic     r2,  r2,  #xlli_CONTROL_DCACHE  @ Disable D-Cache
+        mcr     p15, 0, r2, c1, c0, 0           @ Write back to CP15
+@
+@ ***** STEP 7 *****
+@
+@ Access memory *not yet enabled* for CBR refresh cycles (8)
+@ - CBR is generated for all banks
+@
+        ldr     r1, =xlli_SDRAM_PHYSICAL_BASE
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+
+        str     r1, [r1]  @  Fix for erratum #116. Makes up for ineffective 1st mem access.
+                          @  This is being left in for PXA27x for the moment
+@
+@ ***** STEP 8 *****
+@
+@  Re-enable D-cache if desired (we don't)
+
+@
+@ ***** STEP 9 *****
+@
+@ Re-enable SDRAM partitions
+@
+        ldr     r2,  [r4, #xlli_MDCNFG_offset]   @ Fetch the current MDCNFG value
+        orr     r2,  r2,  #xlli_MDCNFG_DE0       @ Enable SDRAM bank 0
+        .ifdef xlli_SDRAM_SIZE_128_MB		 @ Eanble SDRAM bank 1?
+        orr     r2,  r2,  #xlli_MDCNFG_DE1       @ Enable SDRAM bank 1
+	.endif
+        str     r2,  [r4, #xlli_MDCNFG_offset]   @ Write back MDCNFG, enabling the SDRAM bank(s)
+@
+@ ***** STEP 10 *****
+@
+@ Write the MDMRS register to trigger an MRS command to all enabled banks of SDRAM.
+@
+@
+        ldr     r1,  =xlli_MDMRS_value           @ Fetch platform MDMRS value
+        str     r1,  [r4, #xlli_MDMRS_offset]    @ Write the MDMRS value back
+@
+@ ***** STEP 11 *****
+@
+@ In systems with SDRAM or Synchronous Flash, optionally enable auto-power-down by setting MDREFR:APD
+@
+        ldr     r3,  [r4, #xlli_MDREFR_offset]   @ Get MDREFR value
+        orr     r3,  r3,  #xlli_MDREFR_APD       @ enable auto power down
+        str     r3,  [r4, #xlli_MDREFR_offset]   @ Write value back
+
+
+        mov     pc,  lr                         @ return to calling routine
+
+        
+
+        .ltorg
+
+@********************************************************************************************
+@
+@ ***********************************************
+@ **********                           **********
+@ ********** RESTART MEMORY CONTROLLER **********
+@ **********                           **********
+@ ***********************************************
+@
+@ This command restarts the memory controller and should be called after a frequency change sequence
+@ or when memory controller settings have been changed (such as xlli_mem_Tmax and xlli_memTopt).
+@
+
+xlli_mem_restart:   
+
+        ldr     r4,  =xlli_MEMORY_CONFIG_BASE    @ Get memory controller base address
+        ldr     r2,  [r4, #xlli_MDREFR_offset]   @ Get MDREFR value
+        bic     r3,  r2, #xlli_MDREFR_E0PIN      @ Clear E0PIN to disable SDCKE[0]
+        bic     r3,  r3, #xlli_MDREFR_E1PIN      @ Clear E1PIN to disable SDCKE[1]
+        b       xlli_5A
+@
+@       The next line should start on a cache line boundary so we don't accidently hang the system
+@
+        .balign   32
+xlli_5A: str     r3,  [r4, #xlli_MDREFR_offset]   @ Write value back with E0PIN and E1PIN cleared
+        str     r2,  [r4, #xlli_MDREFR_offset]   @ Write value back with E0PIN and E1PIN set
+@
+@ Disable all SDRAM banks
+@
+        ldr     r1, [r4, #xlli_MDCNFG_offset]    @ Fetch platform value for MDCNFG
+        bic     r1, r1,  #(xlli_MDCNFG_DE0 | xlli_MDCNFG_DE1)   @ Disable all
+        bic     r1, r1,  #(xlli_MDCNFG_DE2 | xlli_MDCNFG_DE3)   @ SDRAM banks
+        str     r1, [r4, #xlli_MDCNFG_offset]   @ Write w/o enabling SDRAM banks
+@
+@ Access memory *not yet enabled* for CBR refresh cycles (8)
+@ - CBR is generated for all banks
+@
+        ldr     r1, =xlli_SDRAM_PHYSICAL_BASE
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+        str     r1, [r1]
+
+        str     r1, [r1]  @  Fix for erratum #116. Makes up for ineffective 1st mem access.
+                          @  This is being left in for PXA27x for the moment
+@
+@ Re-enable SDRAM partition(s)
+@
+        ldr     r2,  [r4, #xlli_MDCNFG_offset]   @ Fetch the current MDCNFG value
+        orr     r2,  r2,  #xlli_MDCNFG_DE0       @ Enable SDRAM bank 0
+        .ifdef xlli_SDRAM_SIZE_128_MB		 @ Eanble SDRAM bank 1?
+        orr     r2,  r2,  #xlli_MDCNFG_DE1       @ Enable SDRAM bank 1
+	.endif
+        str     r2,  [r4, #xlli_MDCNFG_offset]   @ Write back MDCNFG, enabling the SDRAM bank(s)
+@
+@ Write the MDMRS register to trigger an MRS command to all enabled banks of SDRAM.
+@
+@
+        ldr     r1,  [r4, #xlli_MDMRS_offset]    @ Fetch platform MDMRS value
+        str     r1,  [r4, #xlli_MDMRS_offset]    @ Write the MDMRS value back
+@
+        ldr     r3,  [r4, #xlli_MDREFR_offset]   @ Get MDREFR value
+        str     r3,  [r4, #xlli_MDREFR_offset]   @ Write value back
+
+        mov     pc,  lr                         @ return to calling routine
+        
+
+
+@********************************************************************************************
+@
+@ ********************************************************
+@ **********                                    **********
+@ ********** MAXIMIZE MEMORY CONTROLLER VALUES  **********
+@ **********                                    **********
+@ ********************************************************
+@
+@ NOTE: This function maximizes the timing values in the memory controller so the frequency change
+@       sequence can be done safely without the risk of a system hang. Once the frequency change
+@       sequence is complete, xlli__mem_Topt may be called to set the optimal timing values.
+@
+@       This function does not need to be called if the new MemClk frequency is going to be higher
+@       than the present MemClk frequency. However, the overhead of this function is minimal so
+@       it is suggested this function be called before any change frequency sequence.
+@
+@       r1, r2, and r3 are used and not preserved.
+@
+xlli_mem_Tmax:   
+
+        ldr     r1,  =xlli_MEMORY_CONFIG_BASE   @ Get memory controller base address
+        ldr     r3,  =0x7FF07FF0                @ Maximize bits for RDF, RDN and RRR
+@
+        ldr     r2,  [r1, #xlli_MSC0_offset]    @ Get MSC0 value
+        orr     r2,  r2,  r3                    @ Set all the RDF, RDN and RRR bits
+        str     r2,  [r1, #xlli_MSC0_offset]    @ Set the new MSC0 value
+        ldr     r2,  [r1, #xlli_MSC0_offset]    @ Read MSC0 value back to lock the values
+@
+        ldr     r2,  [r1, #xlli_MSC1_offset]    @ Get MSC1 value
+        orr     r2,  r2,  r3                    @ Set all the RDF, RDN and RRR bits
+        str     r2,  [r1, #xlli_MSC1_offset]    @ Set the new MSC1 value
+        ldr     r2,  [r1, #xlli_MSC1_offset]    @ Read MSC1 value back to lock the values
+@
+        ldr     r2,  [r1, #xlli_MSC2_offset]    @ Get MSC2 value
+        orr     r2,  r2,  r3                    @ Set all the RDF, RDN and RRR bits
+        str     r2,  [r1, #xlli_MSC2_offset]    @ Set the new MSC2 value
+        ldr     r2,  [r1, #xlli_MSC2_offset]    @ Read MSC2 value back to lock the values
+@
+        ldr     r3,  =0x03000300                @ Set up mask bits for DTC0 and DTC2
+        ldr     r2,  [r1, #xlli_MDCNFG_offset]  @ Get present MDCNFG value
+        orr     r2,  r2,  r3                    @ Clear the DTC0 and DTC2 bits
+        str     r2,  [r1, #xlli_MDCNFG_offset]  @ Write back the MDCNFG value
+@
+        ldr     r3,  =0xFFF                     @ Set up mask bits for DRI value
+        ldr     r2,  [r1, #xlli_MDREFR_offset]  @ Get present MDREFR value
+        bic     r2,  r2,  r3                    @ Clear all the DRI bits
+        orr     r2,  r2,  #0x13                 @ Set to lowest safe value
+        str     r2,  [r1, #xlli_MDREFR_offset]  @ Write back the MDREFR value
+
+        mov     pc,  lr                         @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ ***********************************************************
+@ **********                                       **********
+@ ********** SET OPTIMAL MEMORY CONTROLLER VALUES  **********
+@ **********                                       **********
+@ ***********************************************************
+@
+@ NOTE: This function sets the TIMING values in the memory controller to the optimum values based on
+@       the frequency of the MemClk. This function should be called AFTER the frequency change
+@       sequence is complete to get optimal performance out of the memory system.
+@
+@       If changing the core frequency to a value that increases the MemClk speed, it is strongly
+@       suggested that xlli_MSCx_max be called before the frequency change sequence. Once the
+@       frequency chage sequence is complete, this routine may be called to reset the optimal
+@       values for the memory system and the memory controller restarted.
+@
+@       r1 through r8 are used and not preserved.
+@
+xlli_mem_Topt:   
+
+        ldr     r1,  =xlli_CLKREGS_PHYSICAL_BASE  @ Get base address of clock registers
+        ldr     r2,  [r1, #xlli_CCSR_offset]      @ Get current clock status
+        and     r2,  r2,  #0x1F                   @ r2 now contains the CCSR L value
+
+        ldr     r3,  [r1, #xlli_CCCR_offset]      @ Get the current CCCR for the "A" bit
+        and     r3,  r3,  #xlli_CCCR_A_Bit_Mask
+        mov     r3,  r3,  LSR #0x19               @ Move down to bit position 0 to make comparison easy (LSL by 25)
+@
+@       Check for the "B" bit from CCCR (CP14,R6)
+@
+        mrc     p14, 0, r1, c6, c0, 0             @ Get data in CP14, Register 6
+        and     r1,  r1,  #0x8                    @ Grab just the "B" bit
+        mov     r1,  r1,  LSR #0x2                @ move it to bit position 1
+        orr     r9, r3, r1                        @ At this point r9 contains the A-bit at pos. 0 & B-bit at pos. 1
+
+        ldr     r1,  =xlli_MEMORY_CONFIG_BASE     @ Load r1 with memory controller base address
+@
+@       The MemClk speed is determined by the L, A and B values.
+@       Unfortunaly, the only practical way to do this is to rip through all the legal
+@       values and load a register when there is a match. Illegal values result in no change
+@
+        ldr     r3,  =0x7FF07FF0                @ Bit mask for RDF, RDN and RRR (MSC0)
+        ldr     r4,  [r1, #xlli_MSC0_offset]    @ Get present MSC0 value
+        bic     r4,  r4,  r3                    @ Clear the RDF, RDN and RRR bits
+
+        ldr     r5,  =0x03000300                @ DTC0, DTC2 bit mask (MDCNFG)
+        ldr     r6,  [r1, #xlli_MDCNFG_offset]  @ Get present MDCNFG value
+        bic     r6,  r6,  r5                    @ Clear DTC0, DTC2
+
+        ldr     r7,  =0xC0200FFF                @ DRI and RESERVED bit mask (MDREFR)
+        ldr     r8,  [r1, #xlli_MDREFR_offset]  @ Get present MDREFR value
+        bic     r8,  r8,  r7                    @ Clear DRI and RESERVED bits
+        ldr     r7,  = 0xFFF                    @ Reload r7 with worst-case DRI value for safety
+@
+@       r9 =  0x0:  A=0, B=0
+@             0x1:  A=1, B=0
+@             0x2:  A=0, B=1
+@             0x3:  A=1, B=1
+@
+        cmp     r9, #0x1                         @ A == 1, B == 0 ?
+        beq     xlli_A1B0_Table
+
+        cmp     r9, #0x3                         @ A == 1, B == 1 ?
+        beq     xlli_A1B1_Table
+
+@
+@       Else drop through to A=0, B=x table
+@
+xlli_A0Bx_Table:
+        cmp     r2,  #2              @ Is L=2?
+        ldreq   r3,  =xlli_MSC0_26   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_26
+        ldreq   r7,  =xlli_DRI_26
+        cmp     r2,  #3              @ Is L=3?
+        ldreq   r3,  =xlli_MSC0_39   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_39
+        ldreq   r7,  =xlli_DRI_39
+        cmp     r2,  #4              @ Is L=4?
+        ldreq   r3,  =xlli_MSC0_52   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_52
+        ldreq   r7,  =xlli_DRI_52
+        cmp     r2,  #5              @ Is L=5?
+        ldreq   r3,  =xlli_MSC0_65   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_65
+        ldreq   r7,  =xlli_DRI_65
+        cmp     r2,  #6              @ Is L=6?
+        ldreq   r3,  =xlli_MSC0_78   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_78
+        ldreq   r7,  =xlli_DRI_78
+        cmp     r2,  #7              @ Is L=7?
+        ldreq   r3,  =xlli_MSC0_91   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_91
+        ldreq   r7,  =xlli_DRI_91
+        cmp     r2,  #8              @ Is L=8?
+        ldreq   r3,  =xlli_MSC0_104  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_104
+        ldreq   r7,  =xlli_DRI_104
+        cmp     r2,  #9              @ Is L=9?
+        ldreq   r3,  =xlli_MSC0_117  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_117
+        ldreq   r7,  =xlli_DRI_117
+
+        cmp     r2,  #10             @ Is L=10?
+        ldreq   r3,  =xlli_MSC0_130  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_130
+        ldreq   r7,  =xlli_DRI_130
+        cmp     r2,  #11             @ Is L=11?
+        ldreq   r3,  =xlli_MSC0_71   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_71
+        ldreq   r7,  =xlli_DRI_71
+        cmp     r2,  #12             @ Is L=12?
+        ldreq   r3,  =xlli_MSC0_78   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_78
+        ldreq   r7,  =xlli_DRI_78
+        cmp     r2,  #13             @ Is L=13?
+        ldreq   r3,  =xlli_MSC0_84   @ Yes - load value
+        ldreq   r5,  =xlli_DTC_84
+        ldreq   r7,  =xlli_DRI_84
+        cmp     r2,  #14             @ Is L=14?
+        ldreq   r3,  =xlli_MSC0_91   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_91
+        ldreq   r7,  =xlli_DRI_91
+        cmp     r2,  #15             @ Is L=15?
+        ldreq   r3,  =xlli_MSC0_97   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_97
+        ldreq   r7,  =xlli_DRI_97
+
+        cmp     r2,  #16             @ Is L=16?
+        ldreq   r3,  =xlli_MSC0_104  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_104
+        ldreq   r7,  =xlli_DRI_104
+        cmp     r2,  #17             @ Is L=17?
+        ldreq   r3,  =xlli_MSC0_110  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_110
+        ldreq   r7,  =xlli_DRI_110
+        cmp     r2,  #18             @ Is L=18?
+        ldreq   r3,  =xlli_MSC0_117  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_117
+        ldreq   r7,  =xlli_DRI_117
+        cmp     r2,  #19             @ Is L=19?
+        ldreq   r3,  =xlli_MSC0_124  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_124
+        ldreq   r7,  =xlli_DRI_124
+        cmp     r2,  #20             @ Is L=20?
+        ldreq   r3,  =xlli_MSC0_130  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_130
+        ldreq   r7,  =xlli_DRI_130
+
+        cmp     r2,  #21             @ Is L=21?
+        ldreq   r3,  =xlli_MSC0_68  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_68
+        ldreq   r7,  =xlli_DRI_68
+        cmp     r2,  #22             @ Is L=22?
+        ldreq   r3,  =xlli_MSC0_71  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_71
+        ldreq   r7,  =xlli_DRI_71
+        cmp     r2,  #23             @ Is L=23?
+        ldreq   r3,  =xlli_MSC0_74  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_74
+        ldreq   r7,  =xlli_DRI_74
+        cmp     r2,  #24             @ Is L=24?
+        ldreq   r3,  =xlli_MSC0_78  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_78
+        ldreq   r7,  =xlli_DRI_78
+        cmp     r2,  #25             @ Is L=25?
+        ldreq   r3,  =xlli_MSC0_81  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_81
+        ldreq   r7,  =xlli_DRI_81
+
+        cmp     r2,  #26             @ Is L=26?
+        ldreq   r3,  =xlli_MSC0_84  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_84
+        ldreq   r7,  =xlli_DRI_84
+        cmp     r2,  #27             @ Is L=27?
+        ldreq   r3,  =xlli_MSC0_87  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_87
+        ldreq   r7,  =xlli_DRI_87
+        cmp     r2,  #28             @ Is L=28?
+        ldreq   r3,  =xlli_MSC0_91  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_91
+        ldreq   r7,  =xlli_DRI_91
+        cmp     r2,  #29             @ Is L=29?
+        ldreq   r3,  =xlli_MSC0_94   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_94
+        ldreq   r7,  =xlli_DRI_94
+        cmp     r2,  #30             @ Is L=30?
+        ldreq   r3,  =xlli_MSC0_97   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_97
+        ldreq   r7,  =xlli_DRI_97
+        cmp     r2,  #31             @ Is L=31?
+        ldreq   r3,  =xlli_MSC0_100  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_100
+        ldreq   r7,  =xlli_DRI_100
+
+        b XLLI_Done_MSC0_Opt_Update
+
+xlli_A1B0_Table:
+
+        cmp     r2,  #2              @ Is L=2?
+        ldreq   r3,  =xlli_MSC0_13   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_13
+        ldreq   r7,  =xlli_DRI_13
+        cmp     r2,  #3              @ Is L=3?
+        ldreq   r3,  =xlli_MSC0_19   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_19
+        ldreq   r7,  =xlli_DRI_19
+        cmp     r2,  #4              @ Is L=4?
+        ldreq   r3,  =xlli_MSC0_26   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_26
+        ldreq   r7,  =xlli_DRI_26
+        cmp     r2,  #5              @ Is L=5?
+        ldreq   r3,  =xlli_MSC0_32   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_32
+        ldreq   r7,  =xlli_DRI_32
+        cmp     r2,  #6              @ Is L=6?
+        ldreq   r3,  =xlli_MSC0_39   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_39
+        ldreq   r7,  =xlli_DRI_39
+        cmp     r2,  #7              @ Is L=7?
+        ldreq   r3,  =xlli_MSC0_45   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_45
+        ldreq   r7,  =xlli_DRI_45
+
+        cmp     r2,  #8              @ Is L=8?
+        ldreq   r3,  =xlli_MSC0_52  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_52
+        ldreq   r7,  =xlli_DRI_52
+        cmp     r2,  #9              @ Is L=9?
+        ldreq   r3,  =xlli_MSC0_58  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_58
+        ldreq   r7,  =xlli_DRI_58
+
+        cmp     r2,  #10             @ Is L=10?
+        ldreq   r3,  =xlli_MSC0_65  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_65
+        ldreq   r7,  =xlli_DRI_65
+@
+@       L11 - L20 ARE THE SAME for A0Bx
+@
+        cmp     r2,  #11             @ Is L=11?
+        ldreq   r3,  =xlli_MSC0_71   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_71
+        ldreq   r7,  =xlli_DRI_71
+        cmp     r2,  #12             @ Is L=12?
+        ldreq   r3,  =xlli_MSC0_78   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_78
+        ldreq   r7,  =xlli_DRI_78
+        cmp     r2,  #13             @ Is L=13?
+        ldreq   r3,  =xlli_MSC0_84   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_84
+        ldreq   r7,  =xlli_DRI_84
+        cmp     r2,  #14             @ Is L=14?
+        ldreq   r3,  =xlli_MSC0_91   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_91
+        ldreq   r7,  =xlli_DRI_91
+        cmp     r2,  #15             @ Is L=15?
+        ldreq   r3,  =xlli_MSC0_97   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_97
+        ldreq   r7,  =xlli_DRI_97
+        cmp     r2,  #16             @ Is L=16?
+        ldreq   r3,  =xlli_MSC0_104  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_104
+        ldreq   r7,  =xlli_DRI_104
+        cmp     r2,  #17             @ Is L=17?
+        ldreq   r3,  =xlli_MSC0_110  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_110
+        ldreq   r7,  =xlli_DRI_110
+        cmp     r2,  #18             @ Is L=18?
+        ldreq   r3,  =xlli_MSC0_117  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_117
+        ldreq   r7,  =xlli_DRI_117
+        cmp     r2,  #19             @ Is L=19?
+        ldreq   r3,  =xlli_MSC0_124  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_124
+        ldreq   r7,  =xlli_DRI_124
+        cmp     r2,  #20             @ Is L=20?
+        ldreq   r3,  =xlli_MSC0_130  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_130
+        ldreq   r7,  =xlli_DRI_130
+
+        cmp     r2,  #21             @ Is L=21?
+        ldreq   r3,  =xlli_MSC0_136  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_136
+        ldreq   r7,  =xlli_DRI_136
+        cmp     r2,  #22             @ Is L=22?
+        ldreq   r3,  =xlli_MSC0_143  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_143
+        ldreq   r7,  =xlli_DRI_143
+        cmp     r2,  #23             @ Is L=23?
+        ldreq   r3,  =xlli_MSC0_149  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_149
+        ldreq   r7,  =xlli_DRI_149
+        cmp     r2,  #24             @ Is L=24?
+        ldreq   r3,  =xlli_MSC0_156  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_156
+        ldreq   r7,  =xlli_DRI_156
+        cmp     r2,  #25             @ Is L=25?
+        ldreq   r3,  =xlli_MSC0_162  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_162
+        ldreq   r7,  =xlli_DRI_162
+
+        cmp     r2,  #26             @ Is L=26?
+        ldreq   r3,  =xlli_MSC0_169  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_169
+        ldreq   r7,  =xlli_DRI_169
+        cmp     r2,  #27             @ Is L=27?
+        ldreq   r3,  =xlli_MSC0_175  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_175
+        ldreq   r7,  =xlli_DRI_175
+        cmp     r2,  #28             @ Is L=28?
+        ldreq   r3,  =xlli_MSC0_182  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_182
+        ldreq   r7,  =xlli_DRI_182
+        cmp     r2,  #29             @ Is L=29?
+        ldreq   r3,  =xlli_MSC0_188   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_188
+        ldreq   r7,  =xlli_DRI_188
+        cmp     r2,  #30             @ Is L=30?
+        ldreq   r3,  =xlli_MSC0_195   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_195
+        ldreq   r7,  =xlli_DRI_195
+        cmp     r2,  #31             @ Is L=31?
+        ldreq   r3,  =xlli_MSC0_201  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_201
+        ldreq   r7,  =xlli_DRI_201
+
+        b XLLI_Done_MSC0_Opt_Update
+
+
+xlli_A1B1_Table:
+        cmp     r2,  #2              @ Is L=2?
+        ldreq   r3,  =xlli_MSC0_26   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_26
+        ldreq   r7,  =xlli_DRI_26
+        cmp     r2,  #3              @ Is L=3?
+        ldreq   r3,  =xlli_MSC0_39   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_39
+        ldreq   r7,  =xlli_DRI_39
+        cmp     r2,  #4              @ Is L=4?
+        ldreq   r3,  =xlli_MSC0_52   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_52
+        ldreq   r7,  =xlli_DRI_52
+        cmp     r2,  #5              @ Is L=5?
+        ldreq   r3,  =xlli_MSC0_65   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_65
+        ldreq   r7,  =xlli_DRI_65
+        cmp     r2,  #6              @ Is L=6?
+        ldreq   r3,  =xlli_MSC0_78   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_78
+        ldreq   r7,  =xlli_DRI_78
+        cmp     r2,  #7              @ Is L=7?
+        ldreq   r3,  =xlli_MSC0_91   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_91
+        ldreq   r7,  =xlli_DRI_91
+        cmp     r2,  #8              @ Is L=8?
+        ldreq   r3,  =xlli_MSC0_104  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_104
+        ldreq   r7,  =xlli_DRI_104
+        cmp     r2,  #9              @ Is L=9?
+        ldreq   r3,  =xlli_MSC0_117  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_117
+        ldreq   r7,  =xlli_DRI_117
+
+        cmp     r2,  #10             @ Is L=10?
+        ldreq   r3,  =xlli_MSC0_130  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_130
+        ldreq   r7,  =xlli_DRI_130
+        cmp     r2,  #11             @ Is L=11?
+        ldreq   r3,  =xlli_MSC0_143   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_143
+        ldreq   r7,  =xlli_DRI_143
+        cmp     r2,  #12             @ Is L=12?
+        ldreq   r3,  =xlli_MSC0_156   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_156
+        ldreq   r7,  =xlli_DRI_156
+        cmp     r2,  #13             @ Is L=13?
+        ldreq   r3,  =xlli_MSC0_169   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_169
+        ldreq   r7,  =xlli_DRI_169
+        cmp     r2,  #14             @ Is L=14?
+        ldreq   r3,  =xlli_MSC0_182   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_182
+        ldreq   r7,  =xlli_DRI_182
+        cmp     r2,  #15             @ Is L=15?
+        ldreq   r3,  =xlli_MSC0_195   @ Yes - load values
+        ldreq   r5,  =xlli_DTC_195
+        ldreq   r7,  =xlli_DRI_195
+
+        cmp     r2,  #16             @ Is L=16?
+        ldreq   r3,  =xlli_MSC0_208  @ Yes - load values
+        ldreq   r5,  =xlli_DTC_208
+        ldreq   r7,  =xlli_DRI_208
+
+XLLI_Done_MSC0_Opt_Update:
+
+@
+@       Update MSC0
+@
+        orr     r4,  r4,  r3                    @ Update the RDF, RDN and RRR bits
+        str     r4,  [r1, #xlli_MSC0_offset]    @ Set the new MSC0 value
+        ldr     r4,  [r1, #xlli_MSC0_offset]    @ Read MSC0 value back to lock the values
+
+@
+@       Update DRI bits
+@
+        orr     r8,  r8,  r7                    @ Update the DRI bits
+        str     r8,  [r1, #xlli_MDREFR_offset]  @ Set the new MDREFR value
+
+@
+@       Update DTC bits
+@
+        orr     r6,  r6,  r5                    @ Update DTC0 and DTC2 bits
+        str     r6,  [r1, #xlli_MDCNFG_offset]  @ Write back the MDCNFG value
+
+        mov     pc,  lr                         @ return to calling routine
+
+        
+
+        .ltorg
+
+@********************************************************************************************
+@
+@ ******************************************************
+@ **********                                  **********
+@ ********** INITIALIZE (MASK) ALL INTERRUPTS **********
+@ **********                                  **********
+@ ******************************************************
+@
+@ NOTE: On system reset, all interrupts should be cleared by hardware.
+@       This enforces disabling of all interrupts to HW boot default conditions.
+@
+xlli_intr_init:   
+
+        ldr     r4,  =xlli_INTERREGS_PHYSICAL_BASE  @ Load controller physical base address
+        ldr     r2,  =0x0                           @ zero out a work register
+        str     r2,  [r4, #xlli_ICMR_offset]        @ Mask all interrupts (clear mask register)
+        str     r2,  [r4, #xlli_ICMR2_offset]       @ Mask all interrupts (clear mask register) 2
+        str     r2,  [r4, #xlli_ICLR_offset]        @ Clear the interrupt level register
+        str     r2,  [r4, #xlli_ICLR2_offset]       @ Clear the interrupt level register 2
+        str     r2,  [r4, #xlli_ICCR_offset]        @ Clear Interrupt Control Register
+        str     r2,  [r4, #xlli_ICCR2_offset]       @ Clear Interrupt Control Register 2
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr     r2, [r4, #xlli_ICMR_offset]
+
+        mov     pc,  lr                             @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ **********************************************
+@ **********                          **********
+@ ********** INITIALIZE CLOCK MANAGER **********
+@ **********                          **********
+@ **********************************************
+@
+@ Disable the peripheral clocks, and set the core clock frequency
+@
+@ NOTE: The Change Frequency Sequence should be called after this function in order
+@       for the clock frequencies set in the CCCR register to take effect.
+@
+@       The code then spins on the oscillator OK bit until the oscilator is stable
+@       which can take as long as two seconds.
+@
+
+xlli_clks_init:   
+
+@ Turn Off ALL on-chip peripheral clocks for re-configuration
+@
+        ldr     r4,  =xlli_CLKREGS_PHYSICAL_BASE@ Load clock registers base address
+        ldr     r1,  =0x400000                  @ Forces memory clock to stay ON!!
+        ldr     r2,  =xlli_CKEN_value           @ Get any other bits required from the include file
+        orr     r1,  r1,  r2                    @ OR everything together
+        str     r1,  [r4, #xlli_CKEN_offset]    @ ... and write out to the clock enable register
+@
+@ Set Crystal: Memory Freq, Memory:RunMode Freq, RunMode, TurboMode Freq Multipliers,
+@ set RunMode & TurboMode to default frequency.
+@
+        ldr     r2,  =xlli_CCCR_value           @ Get CORE_CLK_DEFAULT value
+        str     r2,  [r4, #xlli_CCCR_offset]    @ Write to the clock config register
+@
+@ Enable the 32 KHz oscillator and set the 32KHz output enable bits
+@
+@JWK        mov     r1,  #(xlli_OSCC_OON | xlli_OSCC_TOUT_EN)
+        mov     r1,  #xlli_OSCC_OON
+        str     r1,  [r4, #xlli_OSCC_offset]    @ for RTC and Power Manager
+@
+@ Init Real Time Clock (RTC) registers
+@
+        ldr     r4,  =xlli_RTCREGS_PHYSICAL_BASE @ Load RTC registers base address
+        mov     r2,  #0                          @ Clear a work register
+        str     r2,  [r4, #xlli_RTSR_offset]     @ Clear RTC Status register
+        str     r2,  [r4, #xlli_RCNR_offset]     @ Clear RTC Counter Register
+        str     r2,  [r4, #xlli_RTAR_offset]     @ Clear RTC Alarm Register
+        str     r2,  [r4, #xlli_SWCR_offset]     @ Clear Stopwatch Counter Register
+        str     r2,  [r4, #xlli_SWAR1_offset]    @ Clear Stopwatch Alarm Register 1
+        str     r2,  [r4, #xlli_SWAR2_offset]    @ Clear Stopwatch Alarm Register 2
+        str     r2,  [r4, #xlli_PICR_offset]     @ Clear Periodic Counter Register
+        str     r2,  [r4, #xlli_PIAR_offset]     @ Clear Interrupt Alarm Register
+
+@
+@ Check the Oscillator OK (OOK) bit in clock register OSCC to insure the timekeeping oscillator
+@ is enabled and stable before returning to the calling program.
+@
+        ldr     r4,  =xlli_CLKREGS_PHYSICAL_BASE@ Load clock registers base address
+xlli_6:
+        ldr     r1,  [r4, #xlli_OSCC_offset]    @ Get the status of the OSCC register
+        ands    r1,  r1,  #xlli_OSCC_OOK        @ is the oscillator OK bit set?
+        beq     xlli_6                          @ Spin in this loop until the bit is set
+
+        mov     pc,  lr                 @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ ****************************************************************
+@ **********                                            **********
+@ ********** INITIALIZE CLOCK MANAGER (FROM SLEEP MODE) **********
+@ **********                                            **********
+@ ****************************************************************
+@
+@ Disable the peripheral clocks, and set the core clock frequency
+@
+@       The code then spins on the oscillator OK bit until the oscilator is stable
+@       which can take as long as two seconds.
+@
+
+xlli_clks_init_sleepReset:   
+
+@ Turn Off ALL on-chip peripheral clocks for re-configuration
+@
+        ldr     r4,  =xlli_CLKREGS_PHYSICAL_BASE@ Load clock registers base address
+        ldr     r1,  =0x400000                  @ Forces memory clock to stay ON!!
+        ldr     r2,  =xlli_CKEN_value           @ Get any other bits required from the include file
+        orr     r1,  r1,  r2                    @ OR everything together
+        str     r1,  [r4, #xlli_CKEN_offset]    @ ... and write out to the clock enable register
+@
+@ Set Crystal: Memory Freq, Memory:RunMode Freq, RunMode, TurboMode Freq Multipliers,
+@ set RunMode & TurboMode to default frequency.
+@
+        ldr     r2,  =xlli_CCCR_value           @ Get CORE_CLK_DEFAULT value
+        str     r2,  [r4, #xlli_CCCR_offset]    @ Write to the clock config register
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr     r2, [r4, #xlli_CCCR_offset]
+
+        mov     pc,  lr                                 @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ ***********************************************
+@ **********                           **********
+@ ********** FREQUENCY CHANGE SEQUENCE **********
+@ **********                           **********
+@ ***********************************************
+@
+@ This subroutine initiates the frequency change sequence and restarts the memory controller
+@
+
+xlli_freq_change:   
+
+        mrc     p14, 0, r2, c6, c0, 0       @ Get present status (preserve Turbo and Fast Bus bits)
+        orr     r2,  r2,  #2                @ Set the F bit
+        mcr     p14, 0, r2, c6, c0, 0       @ initiate the frequency change sequence - Wheeeeeeeee!
+@
+@       If the clock frequency is chaged, the MDREFR Register must be  rewritten, even
+@       if it's the same value. This will result in a refresh being performed and the
+@       refresh counter being reset to the reset interval. (Section 13.10.3, pg 13-17 of EAS)
+@
+        ldr     r4,  =xlli_MEMORY_CONFIG_BASE       @ Get memory controller base address
+        ldr     r1,  [r4, #xlli_MDREFR_offset]      @ Get the current state of MDREFR
+        str     r1,  [r4, #xlli_MDREFR_offset]      @ Re-write this value
+
+        mov     pc,  lr @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ ********************************************************
+@ **********                                    **********
+@ ********** INITIALIZE OPERATING SYSTEM TIMERS **********
+@ **********                                    **********
+@ ********************************************************
+@
+@ This code segment initializes the OST count registers to zero, clears the
+@ status bits in OSSR, and zeroes out the match registers.
+@
+@ After this function is called, the OS timers should be initalized to the
+@ same state as on HW reset.
+@
+@ The interrupt bit for match register 1 is set for use by timing macros.
+@
+
+xlli_ost_init:   
+
+        ldr    r2,  =xlli_OSTREGS_PHYSICAL_BASE @ get base address for os timer registers
+        mov    r3,  #0                          @ clear work register
+
+        str    r3,  [r2, #xlli_OSCR0_offset]    @ zero out OS Timer Count register
+        str    r3,  [r2, #xlli_OWER_offset]     @ zero out OS Timer Watchdog Match Enable Register
+        str    r3,  [r2, #xlli_OIER_offset]     @ zero out OS Timer Interrupt Enable register
+        str    r3,  [r2, #xlli_OSSR_offset]     @ zero out OS Timer Status register
+
+        str    r3,  [r2, #xlli_OMCR4_offset]    @ Zero out Match Control Registers
+        str    r3,  [r2, #xlli_OMCR5_offset]
+        str    r3,  [r2, #xlli_OMCR6_offset]
+        str    r3,  [r2, #xlli_OMCR7_offset]
+        str    r3,  [r2, #xlli_OMCR8_offset]
+        str    r3,  [r2, #xlli_OMCR9_offset]
+        str    r3,  [r2, #xlli_OMCR10_offset]
+        str    r3,  [r2, #xlli_OMCR11_offset]
+
+        str    r3,  [r2, #xlli_OSCR0_offset]    @ Zero out count register 0
+        str    r3,  [r2, #xlli_OSCR4_offset]    @ Zero out count register 4 - 11
+        str    r3,  [r2, #xlli_OSCR5_offset]
+        str    r3,  [r2, #xlli_OSCR6_offset]
+        str    r3,  [r2, #xlli_OSCR7_offset]
+        str    r3,  [r2, #xlli_OSCR8_offset]
+        str    r3,  [r2, #xlli_OSCR9_offset]
+        str    r3,  [r2, #xlli_OSCR10_offset]
+        str    r3,  [r2, #xlli_OSCR11_offset]
+
+        str    r3,  [r2, #xlli_OSMR0_offset]    @ zero-out all 12 match registers
+        str    r3,  [r2, #xlli_OSMR1_offset]
+        str    r3,  [r2, #xlli_OSMR2_offset]
+        str    r3,  [r2, #xlli_OSMR3_offset]
+        str    r3,  [r2, #xlli_OSMR4_offset]
+        str    r3,  [r2, #xlli_OSMR5_offset]
+        str    r3,  [r2, #xlli_OSMR6_offset]
+        str    r3,  [r2, #xlli_OSMR7_offset]
+        str    r3,  [r2, #xlli_OSMR8_offset]
+        str    r3,  [r2, #xlli_OSMR9_offset]
+        str    r3,  [r2, #xlli_OSMR10_offset]
+        str    r3,  [r2, #xlli_OSMR11_offset]
+
+        ldr    r1,  =xlli_OSSR_ALL              @ Clear the status bits - these are 'sticky' bits,
+        str    r1,  [r2, #xlli_OSSR_offset]     @ These bits are cleared by writing 1's to them
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr     r1, [r2, #xlli_OSSR_offset]
+
+        mov     pc,  lr                         @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ **********************************************************************
+@ **********                                                  **********
+@ ********** ENABLE I-CACHE, D-CACHE AND BRANCH TARGET BUFFER **********
+@ **********                                                  **********
+@ **********************************************************************
+@
+@ This code segment enables the Instruction Cache, Data Cache, and the Branch Target Buffer.
+@
+xlli_icache_enable:   
+
+        mrc    p15, 0, r2, c1, c0, 0            @ Get the contents of the ARM control register
+        mov    r2,  r2, LSL #18                 @ Upper 18-bits must be written as zero...
+        mov    r2,  r2, LSR #18                 @ ....clear them now
+
+        orr    r2,  r2, #xlli_control_icache    @ set the i-cache bit
+        orr    r2,  r2, #xlli_control_btb       @ set the btb bit
+        orr    r2,  r2, #xlli_control_dcache    @ set the d-cache bit
+
+        @ This code segment writes the contents of r2 into the ARM control register.
+        @ Note: you must either format the contents of w1 so that reserved bits
+        @       are written with the proper value, or get the getARMControl values and
+        @       modify the control bits you need.
+                @
+        @ make sure this is first instruction in a cache line
+
+        b      xlli_7
+        .balign  32
+xlli_7:
+        mcr    p15, 0, r2, c1, c0, 0
+
+        @ This code segment guarantees that previous writes to coprocessor 15 have
+        @ completed. Depending on what is being modified in cp15 (turning on
+        @ the mmu, for example), these instructions may need to be executed
+        @ from the icache.
+
+        mrc    p15, 0, r2, c1, c0, 0
+        mov    r2,  r2
+        sub    pc,  pc, #4
+
+        mov     pc,  lr                         @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ **************************************************
+@ **********                              **********
+@ ********** INITIALIZE the POWER MANAGER **********
+@ **********                              **********
+@ **************************************************
+@
+@ This code initializes the Power Manager
+@
+xlli_pwrmgr_init:   
+
+        ldr    r2,  =xlli_PMRCREGS_PHYSICAL_BASE @ get base address of power mgr / reset control regs
+
+@
+@ JWK - read the wakeup reason
+@
+		ldr	r4, [r2, #xlli_PEDR_offset]			@ read the Edge detect status register
+        str    r4,  [r2, #xlli_PSPR_offset]     @ save to the Scratch pad register
+		
+        mov    r1,  #0                          @ clear a work register
+        str    r1,  [r2, #xlli_PWER_offset]     @ Reset Power Manager Wake-up register
+        str    r1,  [r2, #xlli_PRER_offset]     @ Clear Power Manager Rising-Edge Detector Enables
+        str    r1,  [r2, #xlli_PFER_offset]     @ Clear Power Manager Falling-Edge Detector Enables
+        str    r4,  [r2, #xlli_PEDR_offset]     @ Clear Power Manager GPIO edge-Detect Status register
+        str    r1,  [r2, #xlli_PGSR0_offset]    @ Clear GPIO sleep state registers (GPIOs 31:0)
+        str    r1,  [r2, #xlli_PGSR1_offset]    @ Clear GPIO sleep state registers (GPIOs 63:32)
+        str    r1,  [r2, #xlli_PGSR2_offset]    @ Clear GPIO sleep state registers (GPIOs 95:64)
+        str    r1,  [r2, #xlli_PGSR3_offset]    @ Clear GPIO sleep state registers (GPIOs 118:96)
+        str    r1,  [r2, #xlli_PSTR_offset]     @ Reset Standby Configuration Register
+        str    r1,  [r2, #xlli_PVCR_offset]     @ Reset Power Manager Voltage Change Control Register
+        str    r1,  [r2, #xlli_PKWR_offset]     @ Clear Keyboard Wake-up Enable Register
+        str    r1,  [r2, #xlli_PKSR_offset]     @ Clear Keyboard Edge Detect Status Register
+        
+        ldr    r1, =xlli_PSLR_value
+        str    r1,  [r2, #xlli_PSLR_offset]
+        
+@
+@       Initialize the PCFR (Power Manager General Congiguration Manager)
+@       Assume PCFR is 'sane' - zeroed on power up
+@
+        ldr    r3,  =xlli_PMRCREGS_PHYSICAL_BASE
+        ldr    r1,  [r3, #xlli_PCFR_offset]
+        ldr    r2,  =xlli_PCFR_USEDBITS
+        and    r1,  r1,  r2                     @ clear unused bits
+        orr    r1,  r1, #xlli_PCFR_OPDE         @ enable 3.68Mhz power-down
+        orr    r1,  r1, #xlli_PCFR_SYSEN_EN     @ System power supply enable pin
+        str    r1,  [r3, #xlli_PCFR_offset]
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr     r1, [r3, #xlli_PCFR_offset]
+
+@
+@ JWK - configure the system to wake up on falling edge of GPIO 0
+@
+        ldr    r2,  =xlli_PMRCREGS_PHYSICAL_BASE @ get base address of power mgr / reset control regs
+        mov    r1,  #3                          
+        str    r1,  [r2, #xlli_PWER_offset]     @ Enable GPIO0/1 in the Power Manager Wake-up register
+        mov    r1,  #2                          
+        str    r1,  [r2, #xlli_PFER_offset]     @ Enable GPIO1 in the Power Manager Falling-Edge Detector Enables
+        mov    r1,  #1                          
+        str    r1,  [r2, #xlli_PRER_offset]     @ Enable GPIO0 in the Power Manager Rising-Edge Detector Enables
+
+	mov     pc,  lr                         @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ *****************************************
+@ **********                     **********
+@ ********** SET PAGE TABLE BASE **********
+@ **********                     **********
+@ *****************************************
+@
+@ Set page table base (used after a sleep reset)
+@
+xlli_setPTB:    
+
+        ldr    r1,  =xlli_p_PageTable @ Get address of Page Table base
+        mcr    p15, 0, r1, c2, c0, 0  @ Load Page Table base into CP 15
+
+        mov    pc,  lr                @ return to calling routine
+
+                
+
+@********************************************************************************************
+@
+@ ***************************************************************
+@ **********                                           **********
+@ ********** INITIALIZE PAGE TABLES FOR MEMORY MAPPING **********
+@ **********                                           **********
+@ ***************************************************************
+@
+@ Init the Page Table area of memory by writting zeros out to the table
+@
+
+xlli_initPageTable:   
+
+        ldr    r1,  =xlli_p_PageTable @ Get address of Page Table base
+        mcr    p15, 0, r1, c2, c0, 0 @ Load Page Table base into CP 15
+@
+@       zero-out the page table memory region
+@
+        mov    r2,  #xlli_s_PageTable @ get table size
+        mov    r3,  #0
+xlli_8:
+        subs   r2,  r2,  #4          @ Increment offset into table
+        str    r3,  [r1, r2]         @ Clear table entry
+        bne    xlli_8                @ Keep looping until done
+
+        mov    pc,  lr               @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ ***********************************************************
+@ **********                                       **********
+@ ********** INITIALIZE THE MEMORY MANAGEMENT UNIT **********
+@ **********                                       **********
+@ ***********************************************************
+@
+@       Initialize the memory management unit
+@
+
+xlli_MMU_init:      
+
+        @ set DACR
+        ldr    r1,  =xlli_DACR
+        mcr    p15, 0, r1, c3, c0, 0       @ Set DACR
+
+        ldr    r2,  =xlli_PID
+        mov    r2,  r2, LSR #25            @ Clear the lo-order 25 bits
+        mov    r2,  r2, LSL #25            @ (may be unnecessary)
+        mcr    p15, 0, r2, c13, c0, 0      @ Set PID
+
+        mrc    p15, 0, r1, c1, c0, 1       @ Get the current aux control settings
+
+@       extract the control bits such that reserved bits are 0, this will
+@       prep the bits for a subsequent write.
+
+        and    r1,  r1,  #0x33
+        orr    r1,  r1,  #xlli_CONTROL_MINIDATA_01 @ orr in the mini-data cache attributes
+
+        mcr    p15, 0, r1, c1, c0, 1       @ Write back the new settings
+
+@       invalidate and enable the BTB
+
+        mcr    p15, 0, r1, c7, c5, 6       @ invalidate the Branch Target Buffer
+@
+@       enable the BTB
+@
+        mrc    p15, 0, r1, c1, c0, 0
+        mov    r1,  r1, LSL #18            @ Upper 18 bits must be
+        mov    r1,  r1, LSR #18            @ written as zeros
+        orr    r1,  r1, #xlli_CONTROL_BTB  @ set the BTB bit
+
+        b     xlli_9                       @ 1st instruction on cache line
+        .balign 32
+xlli_9:
+        mcr    p15, 0, r1, c1, c0, 0       @ write the data back
+        mrc    p15, 0, r1, c2, c0, 0       @ Insure that the write completes
+        mov    r1,  r1                     @ before continuing
+        sub    pc,  pc,  #4
+
+        mov    pc,  lr                     @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ **************************************************************
+@ **********                                          **********
+@ ********** FIRE UP THE MMU - SWITCH TO VIRTUAL MODE **********
+@ **********                                          **********
+@ **************************************************************
+@
+@      Make the transistion from physical mode to virtual mode.
+@
+@      This subroutine assumes thaqt execution is from boot ROM and that
+@      the MMU is disabled when this subroutine is called.
+@
+@      NOTES:
+@
+@      1. The memory system must already be up and running.
+@      2. The page table must be initalized (zeroed out)
+@      3. The memory to be accessed must have their page table entries filled in.
+@      4. The MMU needs to be initialized first.
+@      5. When this subroutine returns to the caller, all addresses are virtual.
+@
+@      Typically this would be the last low level init subroutine to be run before
+@      control is turned over to an operating system.
+@
+
+xlli_goVirtual:  
+@
+@       (1) Temporarily overwrite page table entry that maps where we are now.
+@
+@       This code section effectivly makes the table entry where the program counter
+@       (pc) would point now and, the table entry where the new pc value will point,
+@       (after going to virtual addressing) result in the code pointing to the same
+@       physical address regardless of which pc value is used. This is to
+@       cover those cases where the pc is altered after the jump to virtual
+@       addresing. If the sections are idenity (flat) mapped, then the following
+@       code basicly rewrites a single table entery with a copy of itself. Once the
+@       pc has been altered to the virtual address, the original table entry for the
+@       address space we are now is is restored to its original value.
+@
+@       CAUTION: If the page table is mapped to virtual address different from the physical
+@       address, this code is likely to result in an exception to 0x10 (Data Abort) unless
+@       you modify the code in the section to take this into account.
+@
+        ldr   r1,  =xlli_p_PageTable       @ Get address of Page Table base
+
+        mov   r4,  pc,  LSR #(20)          @ Current execution location (divide by 1 Mb)
+        mov   r4,  r4,  LSL #(2)           @ Insure lower two bits are zero
+        add   r4,  r4,  r1                 @ Point to RAM page table entry for this address space
+        ldr   r3,  [r4]                    @ Save the existing table entry in r3
+@
+@       Do not alter r3 or r4 as we will need them later...
+@
+        ldr   r2,  =(xlli_v_xbBOOTROM >> (18))
+        add   r2,  r2,  r1                 @ Point to new (virtual) ROM page table entry
+        ldr   r1,  [r2]                    @ Get this (virtural address) table entry....
+@
+@       Overwrite RAM entry for current (physical address) table entry
+@
+        str   r1,  [r4]                    @ ....and place it in the current table entry.
+
+@       end-of-part (1)
+@ -------------------------------------------------
+@       (2) setup to enable the MMU
+@
+@       Generate (in r1) the virtual address the code will jump to once the
+@       transition has been made to virtual address mode.
+@
+        add   r1,  pc, #xlli_12 - (.+8)    @ Load address of xlli_12 into r1
+        add   r1,  r1,  #xlli_v_xbBOOTROM  @ add offset to virtual ROM address
+@
+@       Invalidate both TLBs
+@
+        mcr p15, 0, r2, c8, c7, 0          @ Invalidates both instruction and data TLBs
+@
+@       enable mmu
+@
+        mrc   p15, 0, r2, c1, c0, 0        @ Read current settings in control reg
+        mov   r2,  r2, LSL #18             @ Upper 18-bits must be written as zero,
+        mov   r2,  r2, LSR #18             @ ... clear them now.
+@
+@               Set ROM protection, Clear System protection, Set MMU bit
+@
+        orr   r2, r2, #xlli_control_r      @ set the ROM Protection bit
+        bic   r2, r2, #xlli_control_s      @ clear the System Protection bit
+        orr   r2, r2, #xlli_control_mmu    @ set the MMU bit
+@
+@       Write back the new value
+@
+        b      xlli_11                     @ make sure this is first instruction in a cache line
+        .balign  32
+xlli_11:
+        mcr    p15, 0, r2, c1, c0, 0       @ Go Virtual!
+        mrc    p15, 0, r2, c2, c0, 0       @ Insure that the write completes
+        mov    r2,  r2                     @ before continuing
+        sub    pc,  pc,  #4
+@
+@       invalidate both caches, btb
+@
+        mcr    p15, 0, r2, c7, c7, 0
+
+        mov    pc,  r1                     @ Load virtual address into the pc
+        nop                                @ nop instructions to "empty the pipeline"
+        nop
+        nop
+                nop
+        nop
+        nop
+xlli_12:
+        add   lr,  lr,  #xlli_v_xbBOOTROM  @ Update the link register return address
+
+@       end-of-part (2)
+@ -------------------------------------------------
+@       (3) restore the overwritten page table entry, flush all caches
+@       The following instruction assumes the page table is idenity mapped!
+@
+        str   r3,  [r4]                    @ This restores original page table entry
+@
+@       Invalidate both TLBs and caches
+@
+        mcr   p15, 0, r2, c8, c7, 0        @ Invalidates both instruction and data TLBs
+        mcr   p15, 0, r2, c7, c7, 0        @ invalidate both caches, BTB
+
+        nop                                @ Make sure the pipe is empty
+        nop
+        nop
+        nop
+        nop
+        nop
+@
+@       end-of-part (3)
+@       -------------------------------------------------
+@       set up cache memory for use
+@
+        mcr   p15, 0, r1, c7, c6, 0        @ Invalidates the D cache
+        mcr   p15, 0, r1, c8, c6, 0        @ Invalidates the data TLB
+
+        mrc    p15, 0, r2, c2, c0, 0       @ Insure that the write completes
+        mov    r2,  r2                     @ before continuing
+        sub    pc,  pc,  #4
+@
+@       invalidate the BTB
+@
+        mcr    p15, 0, r1, c7, c5, 6       @ invalidate the Branch Target Buffer
+@
+@       Enable ICache, DCache, BTB
+@
+        mrc   p15, 0, r2, c1, c0, 0        @ Read current settings in control reg
+        mov   r2,  r2, LSL #18             @ Upper 18-bits must be written as zero,
+        mov   r2,  r2, LSR #18             @ ... clear them now.
+
+        orr   r2, r2, #xlli_control_dcache @ set the DCache bit
+        orr   r2, r2, #xlli_control_icache @ set the ICache bit
+        orr   r2, r2, #xlli_control_btb
+@
+@       Write back the new value
+@
+        b      xlli_13                     @ make sure this is first instruction in a cache line
+        .balign  32
+xlli_13:
+        mcr    p15, 0, r2, c1, c0, 0
+        mrc    p15, 0, r2, c2, c0, 0       @ Insure that the write completes
+        mov    r2,  r2                     @ before continuing
+        sub    pc,  pc,  #4
+
+        mov    pc,  lr                     @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ ***************************************************************
+@ **********                                           **********
+@ ********** INITIALIZE INTERNAL MEMORY POWER REGISTER **********
+@ **********                                           **********
+@ ***************************************************************
+@
+@ Power up the internal memory for use (Default on system reset)
+@
+@ Note: This subroutine sets the internal memory to the hardware reset default state
+@       which is all memory in run mode with auto wake-up disabled and never going
+@       into standby mode.
+@
+
+xlli_IMpwr_init:      
+
+        ldr    r2,  =xlli_IMEMORY_CONFIG_BASE   @ get base address of IM Power Management control regs
+        mov    r1,  #0                          @ Set all memory to RUN mode and disable auto wakeup
+        str    r1,  [r2, #xlli_IMPMCR_offset]   @ Write the data to the control register
+
+        mov    pc,  lr                          @ return to calling routine
+
+        
+
+@********************************************************************************************
+@
+@ *******************************************************
+@ **********                                   **********
+@ ********** GET SYSTEM CONFIGURATION REGISTER **********
+@ **********                                   **********
+@ *******************************************************
+@
+@ This is a "C" program callable subroutine that returns the value stored in the
+@ last SRAM memory location - which presumably still contains the Mainstone
+@ system configuration data that was put there by the xlli_read_SCR subroutine.
+@
+@ Note: The system stack register must be set up before this subroutine is called.
+@
+
+GetSCR:  
+
+        stmfd   sp!, {r1, lr}                     @ Save r1 and link register on the stack
+        ldr     r1,  =xlli_SCR_data               @ Address where system config data is stored
+        ldr     r0,  [r1]                         @ Read the contents of SCR into r0
+        ldmfd   sp!, {r1, pc}                     @ Restore r1 and return to caller
+
+        
+
+@********************************************************************************************
+@
+@ ************************************************************
+@ **********                                        **********
+@ ********** SET SYSTEM CLOCKS FROM SWITCH SETTINGS **********
+@ **********                                        **********
+@ ************************************************************
+@
+@ This subroutine sets the PXA27x/Mainstone clocks based on the Mainstone platform switch settings
+@ NOTE: This subroutine just sets the bits according to switch settings. The user needs to call the
+@       change frequency sequence subroutine (xlli_freq_change) for the values to take effect.
+@
+xlli_setClocks:  
+@
+@       This code segment gets the platform hex switch settings and loads the appropriate N and L values into
+@       the CCCR register. Switch register Bits 15:11 and 7 are ignored by this code.
+@
+        ldr    r1,  =xlli_PLATFORM_REGISTERS             @ Get platform register base address
+        ldr    r2,  [r1, #xlli_PLATFORM_SWITCH_offset]   @ Load platform switch settings into r2
+        and    r3,  r2, #0x7F                            @ Get both HEX rotary values
+        mov    r3,  r3, LSL #2                           @ Multiply by 4 to get word offset
+        add    r1,  pc, #xlli_CLK_DATA - (.+8)           @ Load address of CLK_DATA into r1
+        add    r1,  r1,  r3                              @ Point to address that contains the CCCR data to be loaded
+        ldr    r5,  [r1]                                 @ load CCCR value into r5
+        ands   r3,  r2,  #0x80                           @ Is bit 7 set (to set the CCCR A bit)? - This is why we only
+                                                         @  need a table that goes through 7F (they're the same above it)
+        orrne  r5,  r5,  #0x2000000                      @ YES - set the A bit
+        ldr    r1,  =xlli_CLKREGS_PHYSICAL_BASE          @ Get clocks register base address
+        str    r5,  [r1, #xlli_CCCR_offset]              @ Load the new CCCR value
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr    r5, [r1, #xlli_CCCR_offset]
+
+@
+@       Check switch bit 9 for SDCLK setting (MemClk/2 or MemClock)
+@
+        ldr    r1,  =xlli_MEMORY_CONFIG_BASE     @ Clock registers base address
+        ldr    r6,  [r1,  #xlli_MDREFR_offset]   @ get present value
+        ands   r3,  r2,   #0x200                 @ Test switch bit 9 for "dot" or "no dot" position
+        bicne  r6,  r6,   #xlli_MDREFR_K1DB2     @ clear bit
+        orreq  r6,  r6,   #xlli_MDREFR_K1DB2     @ set bit so SDCLK = 1/2 MCEMCLK
+        str    r6,  [r1,  #xlli_MDREFR_offset]   @ Write data back to register
+@
+@       Check switch bit 8 for Fast/Normal bus speed.
+@       If hex switch setting is 0x5A - 0x7F or 0xDA and greater, the Fast Bus mode bit must
+@       be cleared.
+@       NOTE: Do not alter the contents of r5 which has the new CCCR value stored in it!
+@
+        mrc    p14, 0, r4, c6, c0, 0    @ Get data in CP14, Register 6
+        ands   r3,  r2,  #0x100         @ Test bit 8 for "dot" or "no dot"
+        biceq  r4,  r4,  #0X8           @ Clear Fast Bus speed bit
+        beq    xlli_14                  @ B=0, so jump over the part that check if it's save to set B=1
+        orrne  r4,  r4,  #0x8           @ Set Fast Bus speed bit
+
+@       At this point, B=1 so we need to compare against 0x5A through 0x7F and then against
+@       0xDA through 0xF7.  F8-FA are NECESSARY for A=1, N=3, B=1 is A LEGAL value, so must
+@       preserve.  Otherswise, we need to see if we've hit a point where the Fast Bus mode bit must be cleared
+@
+        and    r3,  r2,  #0x7F          @ Grab just the HEX rotary switch value
+
+@       If we blindly assume A=1 in this compare, we've taken care of most of the problem.  This reduces
+@       the amount of compares to 2, as we compare against 0x5A which will take care of the 0xDA case also
+        cmp    r3,  #0x5A               @ Compare to a hex switch setting of 0x5A (A=x, B=1)
+        ble    xlli_14                  @ Less than or Equal, jump over the next few instructions
+
+        and    r3,  r2,  #0xFF          @ Grab just the HEX rotary switch value AGAIN
+        cmp    r3,  #0xF7               @ We've hit the F8-FA, so jump to end
+        bgt    xlli_14
+
+@       Now clear the Fast Bus (B-bit) if we've hit this point
+        bic    r4,  r4,  #0x8           @ Clear Fast Bus speed bit if greater or equal to 0x5A
+
+xlli_14:
+@
+@       Check switch bit 10 for Turbo or non-Turbo mode.
+@
+        ands   r3,  r2,  #0x400         @ Test switch bit 10 for "dot" or "no dot" position
+        biceq  r4,  r4,  #1             @ Clear Turbo bit
+        orrne  r4,  r4,  #1             @ Set Turbo bit
+
+        bic    r4,  r4,  #0x2           @ Clear the F bit (so frequency change doesn't happen here)
+
+@       Now write the value back
+        mcr    p14, 0, r4, c6, c0, 0    @ Write data to CP14, Register 6
+
+@       At this point, although we've already set the MDREFR register based off of switch bit 9
+@       We need to chack the MDREFR register vs. the desired frequency.  If it's too high, we should
+@       halve or even quarter (for flash) if it's too hight to run properly.  This is being done here
+@       as it is the intent to call the frequency change sequency after this function.
+@       Values that need to halve or quarter MemClk (the rest can be left alone):
+@
+@           For A=0, B=0:
+@               K0DB2=1 (K1DB2 cleared) when L= 5-8 (0x15-0x30), 11-16 (0x3F-0x5A), 21-31 (0x67-0x7F)
+@               K0DB4=1 and K1DB2=1 when L= 9 (0x31-0x37), 10 (0x38-0x3E), 17-20 (0x5B-0x7F)
+@
+@           For A=0, B=1: *NOTE* (L17 and higher are illegal for B=1)
+@               K0DB2=1 (K1DB2 cleared) when L= 5-8 (0x15-0x30), 11-16 (0x3F-0x5A)
+@               K0DB4=1 and K1DB2=1 when L= 9 (0x31-0x37), 10 (0x38-0x3E)
+@
+@           For A=1, B=0:
+@               K0DB2=1 (K1DB2 cleared) when L= 9-16 (0xB1-0xDA)
+@               K0DB4=1 and K1DB2=1 when L= 17-31 (0xDB-0xFF)
+@
+@           For A=1, B=1: *NOTE* (L17 and higher are illegal for B=1)
+@               K0DB2=1 (K1DB2 cleared) when L= 5-8 (0x95-0xB0)
+@               K0DB4=1 and K1DB2=1 when L= 9-16 (0xB1-0xDA)
+@
+
+        mov     r3, r6  @ R6 from way above still contains the value we wrote to teh MDREFR register.
+
+@       Clear the KxDBx bits, so that way we can set it to what we want
+
+        ldr     r7,  =0x20084000                   @ KxDBx clear mask (leave K1DB2 from above)
+        bic     r3,  r3,  r7                       @ Clear the KxDBx bits
+
+@       At this point r5 = CCCR, R4 = B bit (CP14,R6). Pull out the relevant bits
+
+        and    r7,  r5,  #xlli_CCCR_A_Bit_Mask   @ R5 now has just the A bit
+        mov    r7,  r7,  LSR #25      @ move it down to the lowest bit (for easy comparison's sake)
+        and    r2,  r5,  #0x1F        @ Get the L value
+        and    r1,  r4,  #0x8         @ Get the B bit
+        mov    r1,  r1,  LSR #3       @ Move it down (that comparison thing...)
+
+        @ Now r0 = A-bit, r1 = B-bit, r2 = L-value
+
+        cmp    r7,  #0x0              @ A == 0?
+        bne    xlli_a_equ_1           @ Nope, A=1, jump to that area of code
+@
+@       A=0 at this point
+@
+        cmp    r1, #0x0               @ B == 0?
+        bne    xlli_a0_b_equ_1        @ Nope, A=0, B=1
+
+        @ A=0, B=0 at this point
+        cmp    r2,  #0x5              @ r2 < 5 ?
+        bcc    xlli_done_mdrefr_check @ L2-L4 need no MemClk division
+        cmp    r2,  #0x8              @ r2 <= 8 ?
+        bls    xlli_set_k0db2         @ L5-L8 need MemClk/2
+        cmp    r2,  #0xA              @ r2 <= 10?
+        bls    xlli_set_k0db4         @ L9-L10 need MemClk/4
+        cmp    r2,  #0x10             @ r2 <= 16?
+        bls    xlli_set_k0db2         @ L11-L16 need MemClk/2
+        cmp    r2,  #0x14             @ r2 <= 20?
+        bls    xlli_set_k0db4         @ L17-L20 need MemClk/4
+        bhi    xlli_set_k0db2         @ L21-L31 need MemClk/2
+
+xlli_a0_b_equ_1:
+@
+@       A=0, B=1
+@
+        cmp    r2,  #0x5              @ r2 < 5 ?
+        bcc    xlli_done_mdrefr_check @ L2-L4 need no MemClk division
+        cmp    r2,  #0x8              @ r2 <= 8 ?
+        bls    xlli_set_k0db2         @ L5-L8 need MemClk/2
+        cmp    r2,  #0xA              @ r2 <= 10?
+        bls    xlli_set_k0db4         @ L9-L10 need MemClk/4
+        bhi    xlli_set_k0db2         @ L11-L16 need MemClk/2 - We've already prevented L above 16 when B=1
+
+xlli_a_equ_1:
+@
+@       A=1, B=?
+@
+        cmp    r1, #0x0               @ B == 0?
+        bne    xlli_a1_b_equ_1        @ Nope, A=0, B=1
+@
+@       A=1, B=0 at this point
+@
+        cmp    r2,  #0x9              @ r2 < 9 ?
+        bcc    xlli_done_mdrefr_check @ L2-L8 need no MemClk division
+        cmp    r2,  #0x10              @ r2 <= 16 ?
+        bls    xlli_set_k0db2         @ L9-L16 need MemClk/2
+        bhi    xlli_set_k0db4         @ L17-L31 need MemClk/4
+
+xlli_a1_b_equ_1:
+@
+@       A=1, B=1
+@
+        cmp    r2,  #0x5              @ r2 < 5 ?
+        bcc    xlli_done_mdrefr_check @ L2-L4 need no MemClk division
+        cmp    r2,  #0x8              @ r2 <= 8 ?
+        bhi    xlli_set_k0db4         @ L9-L16 need MemClk/4
+@
+@       Just fall through to k0db2 for L5-8
+@
+@       NOTE:  Since the expected order is to call xlli_mem_Tmax before calling this function,
+@       simply set the KxDBx bits and move on (mem timings already maxed)
+@
+xlli_set_k0db2:
+@
+@       Set the K0DB2 bit, K1DB2 does not need to be set
+@
+        mov r2, #0x1
+        mov r2, r2, LSL #14  @ Set MDREFR bit 14 (K0DB2)
+        orr r3, r3, r2
+        b   xlli_done_mdrefr_check @skip over the MemClk/4 stuff
+
+xlli_set_k0db4:
+@
+@ Set the K0DB4 bit, K1DB2 must also be set (frequencies higher than 104MHz)
+@
+        ldr r2, =0x20020000  @ Set Bits 29 (K0DB4) & 17 (K1DB2)
+        orr r3, r3, r2
+@
+@       Now just fall through to setting the MDREFR back
+@
+xlli_done_mdrefr_check:
+@
+@ Write the MDREFR value back and move on.
+@
+        ldr     r7,  =xlli_MEMORY_CONFIG_BASE   @ Reload r0 with memory controller base address
+        str     r3,  [r7, #xlli_MDREFR_offset]  @ Set the new MDREFR value
+
+        mov     pc,  lr                 @ Return to calling routine
+@
+@ The following table is a lookup table for the values of L and N to be used depending on the hex switch
+@ setting on the Mainstone development platform. The values listed below are simply the values to be
+@ loaded directly into the CCCR register.  "xx" = Hex Switch setting, L = Core frequency, N = Turbo multiplier
+@
+xlli_CLK_DATA:
+        .balign 4
+        .word     0x102     @ "00" L=2, N=1
+        .balign 4
+        .word     0X182     @ "01" L=2, N=1.5
+        .balign 4
+        .word     0X202     @ "02" L=2, N=2
+        .balign 4
+        .word     0X282     @ "03" L=2, N=2.5
+        .balign 4
+        .word     0X302     @ "04" L=2, N=3
+        .balign 4
+        .word     0X382     @ "05" L=2, N=3.5
+        .balign 4
+        .word     0X402     @ "06" L=2, N=4
+
+        .balign 4
+        .word     0x103     @ "07" L=3, N=1
+        .balign 4
+        .word     0X183     @ "08" L=3, N=1.5
+        .balign 4
+        .word     0X203     @ "09" L=3, N=2
+        .balign 4
+        .word     0X283     @ "0A" L=3, N=2.5
+        .balign 4
+        .word     0X303     @ "0B" L=3, N=3
+        .balign 4
+        .word     0X383     @ "0C" L=3, N=3.5
+        .balign 4
+        .word     0X403     @ "0D" L=3, N=4
+
+        .balign 4
+        .word     0x104     @ "0E" L=4, N=1
+        .balign 4
+        .word     0X184     @ "0F" L=4, N=1.5
+        .balign 4
+        .word     0X204     @ "10" L=4, N=2
+        .balign 4
+        .word     0X284     @ "11" L=4, N=2.5
+        .balign 4
+        .word     0X304     @ "12" L=4, N=3
+        .balign 4
+        .word     0X384     @ "13" L=4, N=3.5
+        .balign 4
+        .word     0X404     @ "14" L=4, N=4
+
+        .balign 4
+        .word     0x105     @ "15" L=5, N=1
+        .balign 4
+        .word     0X185     @ "16" L=5, N=1.5
+        .balign 4
+        .word     0X205     @ "17" L=5, N=2
+        .balign 4
+        .word     0X285     @ "18" L=5, N=2.5
+        .balign 4
+        .word     0X305     @ "19" L=5, N=3
+        .balign 4
+        .word     0X385     @ "1A" L=5, N=3.5
+        .balign 4
+        .word     0X405     @ "1B" L=5, N=4
+
+        .balign 4
+        .word     0x106     @ "1C" L=6, N=1
+        .balign 4
+        .word     0X186     @ "1D" L=6, N=1.5
+        .balign 4
+        .word     0X206     @ "1E" L=6, N=2
+        .balign 4
+        .word     0X286     @ "1F" L=6, N=2.5
+        .balign 4
+        .word     0X306     @ "20" L=6, N=3
+        .balign 4
+        .word     0X386     @ "21" L=6, N=3.5
+        .balign 4
+        .word     0X406     @ "22" L=6, N=4
+
+        .balign 4
+        .word     0x107     @ "23" L=7, N=1
+        .balign 4
+        .word     0X187     @ "24" L=7, N=1.5
+        .balign 4
+        .word     0X207     @ "25" L=7, N=2
+        .balign 4
+        .word     0X287     @ "26" L=7, N=2.5
+        .balign 4
+        .word     0X307     @ "27" L=7, N=3
+        .balign 4
+        .word     0X387     @ "28" L=7, N=3.5
+        .balign 4
+        .word     0X407     @ "29" L=7, N=4
+
+        .balign 4
+        .word     0x108     @ "2A" L=8, N=1
+        .balign 4
+        .word     0X188     @ "2B" L=8, N=1.5
+        .balign 4
+        .word     0X208     @ "2C" L=8, N=2
+        .balign 4
+        .word     0X288     @ "2D" L=8, N=2.5
+        .balign 4
+        .word     0X308     @ "2E" L=8, N=3
+        .balign 4
+        .word     0X388     @ "2F" L=8, N=3.5
+        .balign 4
+        .word     0X408     @ "30" L=8, N=4
+
+        .balign 4
+        .word     0x109     @ "31" L=9, N=1
+        .balign 4
+        .word     0X189     @ "32" L=9, N=1.5
+        .balign 4
+        .word     0X209     @ "33" L=9, N=2
+        .balign 4
+        .word     0X289     @ "34" L=9, N=2.5
+        .balign 4
+        .word     0X309     @ "35" L=9, N=3
+        .balign 4
+        .word     0X389     @ "36" L=9, N=3.5
+        .balign 4
+        .word     0X409     @ "37" L=9, N=4
+
+        .balign 4
+        .word     0x10A     @ "38" L=10, N=1
+        .balign 4
+        .word     0X18A     @ "39" L=10, N=1.5
+        .balign 4
+        .word     0X20A     @ "3A" L=10, N=2
+        .balign 4
+        .word     0X28A     @ "3B" L=10, N=2.5
+        .balign 4
+        .word     0X30A     @ "3C" L=10, N=3
+        .balign 4
+        .word     0X38A     @ "3D" L=10, N=3.5
+        .balign 4
+        .word     0X40A     @ "3E" L=10, N=4
+
+        .balign 4
+        .word     0x10B     @ "3F" L=11, N=1
+        .balign 4
+        .word     0X18B     @ "40" L=11, N=1.5
+        .balign 4
+        .word     0X20B     @ "41" L=11, N=2
+        .balign 4
+        .word     0X28B     @ "42" L=11, N=2.5
+        .balign 4
+        .word     0X30B     @ "43" L=11, N=3
+        .balign 4
+        .word     0X38B     @ "44" L=11, N=3.5
+
+        .balign 4
+        .word     0x10C     @ "45" L=12, N=1
+        .balign 4
+        .word     0X18C     @ "46" L=12, N=1.5
+        .balign 4
+        .word     0X20C     @ "47" L=12, N=2
+        .balign 4
+        .word     0X28C     @ "48" L=12, N=2.5
+        .balign 4
+        .word     0X30C     @ "49" L=12, N=3
+
+        .balign 4
+        .word     0x10D     @ "4A" L=13, N=1
+        .balign 4
+        .word     0X18D     @ "4B" L=13, N=1.5
+        .balign 4
+        .word     0X20D     @ "4C" L=13, N=2
+        .balign 4
+        .word     0X28D     @ "4D" L=13, N=2.5
+        .balign 4
+        .word     0X30D     @ "4E" L=13, N=3
+
+        .balign 4
+        .word     0x10E     @ "4F" L=14, N=1
+        .balign 4
+        .word     0X18E     @ "50" L=14, N=1.5
+        .balign 4
+        .word     0X20E     @ "51" L=14, N=2
+        .balign 4
+        .word     0X28E     @ "52" L=14, N=2.5
+
+        .balign 4
+        .word     0x10F     @ "53" L=15, N=1
+        .balign 4
+        .word     0X18F     @ "54" L=15, N=1.5
+        .balign 4
+        .word     0X20F     @ "55" L=15, N=2
+        .balign 4
+        .word     0X28F     @ "56" L=15, N=2.5
+
+        .balign 4
+        .word     0x110     @ "57" L=16, N=1
+        .balign 4
+        .word     0X190     @ "58" L=16, N=1.5
+        .balign 4
+        .word     0X210     @ "59" L=16, N=2
+        .balign 4
+        .word     0X290     @ "5A" L=16, N=2.5
+
+        .balign 4
+        .word     0x111     @ "5B" L=17, N=1
+        .balign 4
+        .word     0x191     @ "5C" L=17, N=1.5
+        .balign 4
+        .word     0x211     @ "5D" L=17, N=2
+
+        .balign 4
+        .word     0x112     @ "5E" L=18, N=1
+        .balign 4
+        .word     0x192     @ "5F" L=18, N=1.5
+        .balign 4
+        .word     0x212     @ "60" L=18, N=2
+
+        .balign 4
+        .word     0x113     @ "61" L=19, N=1
+        .balign 4
+        .word     0x193     @ "62" L=19, N=1.5
+        .balign 4
+        .word     0x213     @ "63" L=19, N=2
+
+        .balign 4
+        .word     0x114     @ "64" L=20, N=1
+        .balign 4
+        .word     0x194     @ "65" L=20, N=1.5
+        .balign 4
+        .word     0x214     @ "66" L=20, N=2
+
+        .balign 4
+        .word     0x115     @ "67" L=21, N=1
+        .balign 4
+        .word     0x195     @ "68" L=21, N=1.5
+
+        .balign 4
+        .word     0x116     @ "69" L=22, N=1
+        .balign 4
+        .word     0x196     @ "6A" L=22, N=1.5
+
+        .balign 4
+        .word     0x117     @ "6B" L=23, N=1
+        .balign 4
+        .word     0x197     @ "6C" L=23, N=1.5
+
+        .balign 4
+        .word     0x118     @ "6D" L=24, N=1
+        .balign 4
+        .word     0x198     @ "6E" L=24, N=1.5
+
+        .balign 4
+        .word     0x119     @ "6F" L=25, N=1
+        .balign 4
+        .word     0x199     @ "70" L=25, N=1.5
+
+        .balign 4
+        .word     0x11A     @ "71" L=26, N=1
+        .balign 4
+        .word     0x19A     @ "72" L=26, N=1.5
+
+        .balign 4
+        .word     0x11B     @ "73" L=27, N=1
+
+        .balign 4
+        .word     0x11C     @ "74" L=28, N=1
+
+        .balign 4
+        .word     0x11D     @ "75" L=29, N=1
+
+        .balign 4
+        .word     0x11E     @ "76" L=30, N=1
+
+        .balign 4
+        .word     0x11F     @ "77" L=31, N=1
+
+        .balign 4
+        .word     0X30E     @ "78" L=14, N=3 for 546 MHz Turbo Mode
+
+        .balign 4
+        .word     0X30F     @ "79" L=15, N=3 for 585 MHz Turbo Mode
+
+        .balign 4
+        .word     0X310     @ "7A" L=16, N=3 for 624 MHz Turbo Mode
+
+        .balign 4
+        .word     0x11F     @ "7B" L=31, N=1 (same values as "77")
+        .balign 4
+        .word     0x11F     @ "7C" L=31, N=1 (same values as "77")
+        .balign 4
+        .word     0x11F     @ "7D" L=31, N=1 (same values as "77")
+        .balign 4
+        .word     0x11F     @ "7E" L=31, N=1 (same values as "77")
+        .balign 4
+        .word     0x11F     @ "7F" L=31, N=1 (same values as "77")
+@
+@       For the A bit = 1
+@       This table would be exactly the same as the above, only with the 'A' bit set,
+@       so don't bother reproducting it.
+@
+        
+
+@********************************************************************************************
+@
+@ **********************************************************
+@ **********                                      **********
+@ ********** GET SYSTEM CLOCKS FREQUENCY SETTINGS **********
+@ **********     ( C Program callable version)    **********
+@ **********************************************************
+@
+@ This subroutine returns all the data required to decode
+@ the frequencies of the system busses.
+@
+@ R4 returns the following:
+@
+@     bits 4:0 = CCSR value of the L bits
+@     bits 8:5 = CCSR value of the N bits
+@     bit    9 = CLKCFG value for the TURBO bit
+@     bit   10 = CLKCFG value for the B (Fast Bus) bit
+@     bit   11 = CCSR value for the A bit
+@     bit   12 = MDREFR value of K1DB2 bit
+@     bit   13 = MDREFR value of K0DB4 bit
+@     bit   14 = MDREFR value of K0DB2 bit
+@     bit   15 = CLKCFG value of HT bit
+@     bit   16 = PPDIS_S bit in the CCSR register
+@     bit   17 = CPDIS_S bit in the CCSR register
+@
+
+xlli_getFreq:  
+
+        stmfd   sp!, {r1, r2, lr}                 @ Save r1, r2 and link register on the stack
+
+        ldr     r1,  =xlli_CLKREGS_PHYSICAL_BASE  @ Address base for clock config registers
+        ldr     r0,  [r1, #xlli_CCSR_offset]      @ Read the contents of CCSR into r0
+        mov     r1,  r0                           @ and copy into r1
+        and     r0,  r0,  #0x1F                   @ Leave just the L bits in r0
+        and     r2,  r1,  #0x780                  @ Leave just the N bits in r2
+        mov     r2,  r2,  LSR #2                  @ Shift N bits right by 2 bits
+        orr     r0,  r0,  r2                      @ and load into r0
+        ands    r2,  r1, #xlli_BIT_30             @ Is the PPDIS_S bit set?
+        orrne   r0,  r0, #xlli_BIT_16             @ Yes - set bit 16 in R0
+        ands    r2,  r1, #xlli_BIT_31             @ Is the CPDIS_S bit set?
+        orrne   r0,  r0, #xlli_BIT_17             @ Yes - set bit 17 in R0
+
+        mrc     p14, 0, r2, c6, c0, 0             @ Get data in CP14, Register 6
+        ands    r1,  r2,  #xlli_BIT_0             @ Is the turbo bit set?
+        orrne   r0,  r0,  #xlli_BIT_9             @ Yes - set bit 9 in r0
+        ands    r1,  r2,  #xlli_BIT_3             @ Is the B bit set?
+        orrne   r0,  r0,  #xlli_BIT_10            @ Yes - set bit 10 in r0
+        ands    r1,  r2,  #xlli_BIT_2             @ is the HT bit set?
+        orrne   r0,  r0,  #xlli_BIT_15            @ Yes - set bit 15 in r0
+
+        ldr     r1,  =xlli_CLKREGS_PHYSICAL_BASE  @ Address base for clock config registers
+        ldr     r2,  [r1, #xlli_CCCR_offset]      @ Read the contents of CCCR into r2
+        ands    r1,  r2,  #0x2000000              @ Is the A bit set?
+        orrne   r0,  r0,  #xlli_BIT_11            @ Yes - set bit 11 in r0
+
+        ldr     r1,  =xlli_MEMORY_CONFIG_BASE     @ Get base address of memory registers
+        ldr     r2,  [r1, #xlli_MDREFR_offset]    @ Get contents of MDREFR register
+        ands    r1,  r2,  #xlli_MDREFR_K1DB2      @ Is the K1DB2 bit set?
+        orrne   r0,  r0,  #xlli_BIT_12            @ Yes - set bit 12 in r0
+        ands    r1,  r2,  #xlli_MDREFR_K0DB4      @ Is the K0DB4 bit set?
+        orrne   r0,  r0,  #xlli_BIT_13            @ Yes - set bit 13 in r0
+        ands    r1,  r2,  #xlli_MDREFR_K0DB2      @ Is the K0DB2 bit set?
+        orrne   r0,  r0,  #xlli_BIT_14            @ Yes - set bit 14 in r0
+
+        ldmfd   sp!, {r1, r2, pc}                 @ Restore r1, r2 and return to caller
+
+        
+
+@********************************************************************************************
+@
+@ ******************************************************
+@ **********                                  **********
+@ ********** SET SDRAM MEMORY BUFFER STRENGTH **********
+@ **********   ( C Program callable version)  **********
+@ ******************************************************
+@
+@ This subroutine is a "C" callable function that adjusts the buffer drive impedance for SDRAM
+@
+@ REQUIRED PARAMETER:
+@
+@       r0 = buffer strength (Range of 0x0 to 0xF)
+@
+@       Default value is 0x5 on system boot. A higher value results in a lower
+@       buffer impedance. This subroutine only changes buffer impedance that
+@       affect SDRAM. See Developer's Manual (Memory Controller) for more details.
+@
+
+xlli_setBufImpedance:  
+
+        stmfd   sp!, {r1, r2, lr}                 @ Save r1, r2 and link register on the stack
+        ldr     r1,  =xlli_MEMORY_CONFIG_BASE     @ Get memory controller base address
+@
+@       Duplicate the value in lowest nibble so it is duplicated in all 8 nibbels
+@
+        and     r0,  r0,  #0xF                    @ Isolate bits 3:0 of parameter
+        mov     r2,  r0,  LSL #4                  @ Shift 4 bits to the left
+        orr     r0,  r0,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r0,  r0,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r0,  r0,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r0,  r0,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r0,  r0,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r0,  r0,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r0,  r0,  r2                      @ Copy in next significant nibble
+@
+@       The 8 nibbles in r0 are now all the same value
+@
+        str     r0,  [r1, #xlli_BSCNTR3_offset]   @ Set buffer strength for address lines
+        str     r0,  [r1, #xlli_BSCNTR0_offset]   @ Set buffer strength for SDCLK
+        ldr     r2,  [r1, #xlli_BSCNTR1_offset]   @ Get buffer strength for BSCNTR1
+        and     r2,  r2,  #0xF0                   @ Preserve bits 7:4 in r2
+        bic     r0,  r0,  #0xF0                   @ Clear bits 7:4 in r0
+        orr     r2,  r0,  r2                      @ OR with the value from BSCNTR1
+        str     r2,  [r1, #xlli_BSCNTR1_offset]   @ Write buffer strength to BSCNTR1
+        str     r0,  [r1, #xlli_BSCNTR2_offset]   @ Write buffer strength to BSCNTR2
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr    r0, [r1, #xlli_BSCNTR2_offset]
+
+
+        ldmfd   sp!, {r1, r2, pc}                 @ Restore r1, r2 and return to caller
+
+        
+@********************************************************************************************
+@
+@ ******************************************************
+@ **********                                  **********
+@ ********** SET SDRAM MEMORY BUFFER STRENGTH **********
+@ **********       (ROM based version)        **********
+@ ******************************************************
+@
+@ This subroutine adjusts the buffer drive impedance for SDRAM
+@
+@ REQUIRED PARAMETER:
+@
+@       r3 = buffer strength (Range of 0x0 to 0xF)
+@
+@       Default value is 0x5 on system boot. A higher value results in a lower
+@       buffer impedance. This subroutine only changes buffer impedance that
+@       affect SDRAM. See Developer's Manual (Memory Controller) for more details.
+@
+
+xlli_setBufImp:  
+
+        ldr     r1,  =xlli_MEMORY_CONFIG_BASE     @ Get memory controller base address
+@
+@       Duplicate the value in lowest nibble so it is duplicated in all 8 nibbels
+@
+        and     r3,  r3,  #0xF                    @ Isolate bits 3:0 of parameter
+        mov     r2,  r3                           @ Copy into r2
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r2,  r3,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r2,  r3,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r2,  r3,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r2,  r3,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r2,  r3,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r2,  r3,  r2                      @ Copy in next significant nibble
+        mov     r2,  r2,  LSL #4                  @ Shift 4 bits to the left
+        orr     r2,  r3,  r2                      @ Copy in next significant nibble
+@
+@       The 8 nibbles in r2 are now all the same value
+@
+        str     r2,  [r1, #xlli_BSCNTR3_offset]   @ Set buffer strength for address lines
+        str     r2,  [r1, #xlli_BSCNTR0_offset]   @ Set buffer strength for SDCLK
+        ldr     r3,  [r1, #xlli_BSCNTR1_offset]   @ Get buffer strength for BSCNTR1
+        and     r3,  r3,  #0xF0                   @ Preserve bits 7:4 in r3
+        bic     r2,  r2,  #0xF0                   @ Clear bits 7:4 in r2
+        orr     r3,  r3,  r2                      @ OR with the value from BSCNTR1
+        str     r3,  [r1, #xlli_BSCNTR1_offset]   @ Write buffer strength to BSCNTR1
+        str     r2,  [r1, #xlli_BSCNTR2_offset]   @ Write buffer strength to BSCNTR2
+@
+@       Read back from APB to ensure our writes have completed before continuing
+@
+        ldr    r0, [r1, #xlli_BSCNTR2_offset]
+
+        mov     pc,  lr                           @ Return to calling routine
+
+        
+
+@*******************************************************************************
+@
+@ *************************************************
+@ **********                             **********
+@ ********** RETURN THE MEMORY BUS WIDTH **********
+@ **********                             **********
+@ *************************************************
+@
+@ This subroutine reads the Bootsel pin and returns if the Bus Width is 16 or 32 bits in width
+@
+@ REQUIRED PARAMETERS:
+@
+@       NONE
+@
+@ REGISTERS USED
+@
+@       R1 & R2 - none are preserved
+@
+@ RETURN REGISTER
+@
+@       R1 - returned the following (in keeping with the dev. manual, section 6.5.4):
+@               0 - Bus is in a 32-bit configuration
+@               1 - Bus is in a 16-bit configuration
+@
+xlli_isMemBusWidth16Bit:  
+
+        ldr     r1,     =xlli_MEMORY_CONFIG_BASE        @ Clock registers base address
+        ldr     r2,     [r1,  #xlli_BOOT_DEF_offset]    @ Get present value of the Boot_Sel register
+        and     r1,     r2,     #0x1                    @ We only care about the lowest bit, so hack off all others
+
+        mov     pc,  lr         @ Return to calling routine
+
+        
+
+
+@********************************************************************************************
+@
+@ ***************************************************
+@ **********                               **********
+@ ********** READ FLASH MEMORY ID FROM CFI **********
+@ **********                               **********
+@ ***************************************************
+@
+@ This subroutine reads the Intel StrataFlash(R) FLASH memory's CFI to retrieve the Flash ID
+@
+@ REQUIRED PARAMETERS:
+@
+@       NONE
+@
+@ REGISTERS USED
+@
+@       R1, R2, R3, R4, R5, R6, R7 - none are preserved
+@
+@ RETURN REGISTER
+@       R1 - returned containing the 'Flash ID'
+@
+@ Notes:
+@       Types of flash that XLLI can discover include:
+@
+@      TYPE      CODE RANGE
+@      ----   ----------------
+@       J3  =   0x16 -> 0x18
+@       K3  = 0x8801 -> 0x8803
+@       K18 = 0x8805 -> 0x8807
+@       L18 = 0x880E -> 0x8810
+@       L3  = 0x8812 -> 0x8815
+@
+
+xlli_queryFlash:  
+
+        mov     r7,     lr              @ Save off the Link Register so we can return to the right caller
+        bl      xlli_isMemBusWidth16Bit @ Find the bus width
+        mov     r6,     r1              @ Move the result up out of the way so we can re-use it further down
+@
+@       Load up the registers with the flash commands
+@
+        ldr     r4,     =xlli_FLASH_READQUERY_CMD       @ Set the flash into query mode command
+        ldr     r5,     =xlli_FLASH_READ_CMD            @ Set the flash back into 'Read Array' mode command
+
+        cmp     r6,     #0x1                            @ Compare return value - 1 indicates that it's a 16-bit bus
+        beq     xlli_Query_Invalidate                   @ If 16-bit, don't double up the registers, so jump to locked routines
+@
+@       Bus is 32-bits wide, so need to 'double' up the commands
+@       (Flash query command first)
+@
+        mov     r4,     r4,     LSL #16
+        orr     r4,     r4,     #xlli_FLASH_READQUERY_CMD
+@
+@       Flash Read array command next
+@
+        mov     r5,     r5,     LSL #16
+        orr     r5,     r5,     #xlli_FLASH_READ_CMD            @ Results in R3 = 0x00FF00FF
+
+xlli_Query_Invalidate:
+@
+@       Time to setup the locking code
+@
+        cmp     r6,     #0x1                                    @ Compare return value - 1 indicates that it's a 16-bit bus
+        addeq   r3,     pc,     #xlli_Query_16_Start-(.+8)      @ Start of code to lock into the ICache (16-bit version)
+        addne   r3,     pc,     #xlli_Query_32_Start-(.+8)      @ Start of code to lock into the ICache (32-bit version)
+        mvn     r1,     #31                                     @ Time to ensure that we're 32-byte.baligned
+        and     r3,     r3,     r1
+
+        addeq   r2,     pc,     #xlli_Query_16_End-(.+8)        @ End of code to lock into the ICache (16-bit version)
+        addne   r2,     pc,     #xlli_Query_32_End-(.+8)        @ End of code to lock into the ICache (32-bit version)
+        and     r2,     r2,     r1
+
+        mrc     p15, 0, r1, c1, c0, 0           @ read (0x78) cp15.1
+        orr     r1,     r1,     #0x1000         @ enable ICache
+        mcr     p15, 0, r1, c1, c0, 0           @ write it
+        xlli_cpWait  r1                         @ Now stall to ensure the write occured
+
+        mcr     p15, 0, r1, c9, c1, 1           @ unlock entire i$
+        mcr     p15, 0, r1 ,c7, c5, 0           @ flush i$ and BTB
+        xlli_cpWait  r1
+
+xlli_Query_LockLoop:
+        mcr     p15, 0, r3, c7, c5, 1           @ Invalidate i$ line (same as we are about to lock - CAN affect a locked line!)
+        mcr     p15, 0, r3, c9, c1, 0           @ lock line into icache, based on r3
+        cmp     r3,     r2                      @ are we done?
+        add     r3,     r3,     #32             @ increment to next cache-line
+        bne     xlli_Query_LockLoop
+        cmp     r6,     #0x1                    @ Compare return value - 1 indicates that it's a 16-bit bus
+        beq     xlli_Query_16_Start             @ Now jump to the Query code locked in the i-cache (16-bit version)
+        bne     xlli_Query_32_Start             @ Now jump to the Query code locked in the i-cache (32-bit version)
+
+    .balign 32                                    @ ensure is cache-line.baligned (i.e. 32 Bytes = 2^5)
+xlli_Query_16_Start:
+
+        @ Read Device Identifier to obtain RCR value (a 2 cycle operation)
+        mov     r3,     #0x0                    @ Boot Flash Base address
+        strh    r4,     [r3]                    @ Put the flash into Query Mode
+
+        mov     r3,     #0x2                    @ Read 2nd word: "Device Code" entry in Query Structure
+        ldrh    r6,     [r3]                    @ 2nd cycle; r8 now contains the device code on upper and lower halves of data bus.
+@
+@       NOTE: DO NOT TOUCH R6 AFTER THIS POINT AS IT HAS THE RETURN VALUE!
+@
+        mov     r3,     #0x0
+        strh    r5,     [r3]                    @ Put back into read array mode
+        ldrh    r5,     [r3]                    @ Create a data dependency stall to ensure the command was written
+        nop                                     @ Flush the pipeline
+        nop
+        nop
+        nop
+        b       xlli_Query_Cleanup              @ Jump to the clean-up code
+
+   .balign 32     @ padding
+xlli_Query_16_End:    nop
+
+    .balign 32                                    @ ensure is cache-line.baligned (i.e. 32 Bytes = 2^5)
+xlli_Query_32_Start:
+
+        @ Read Device Identifier to obtain RCR value (a 2 cycle operation)
+        mov     r3,     #0x0                    @ Boot Flash Base address
+        str     r4,     [r3]                    @ Put the flash into Query Mode
+
+        mov     r3,     #0x4                    @ Read 2nd word: "Device Code" entry in Query Structure
+        ldr     r6,     [r3]                    @ 2nd cycle; r8 now contains the device code on upper and lower halves of data bus.
+@
+@       NOTE: DO NOT TOUCH R6 AFTER THIS POINT AS IT HAS THE RETURN VALUE!
+@
+        mov     r3,     #0x0
+        str     r5,     [r3]                    @ Put back into read array mode
+        ldr     r5,     [r3]                    @ Create a data dependency stall to ensure the command was written
+        nop                                     @ Flush the pipeline
+        nop
+        nop
+        nop
+        b       xlli_Query_Cleanup              @ Jump to the clean-up code
+
+   .balign 32     @ padding
+xlli_Query_32_End:    nop
+@
+@       Now clean-up from all the cache locking
+@
+   .balign 32
+xlli_Query_Cleanup:
+
+        mcr     p15, 0, r2, c9, c1, 1   @ Unlock entire i$
+        mov     r2, #0x78
+        mcr     p15, 0, r2, c1, c0, 0   @ Disable i$ now that we are done with it
+        xlli_cpWait  r2
+
+        mcr     p15, 0, r2, c7, c5, 0   @ Flush i$ and BTB
+        xlli_cpWait  r2
+
+        mov     r1,     r6              @ Move the return value into R1 for the return
+
+        mov     pc,     r7              @ Return to calling routine - remember the 1st instruction in this f'n was to move the LR -> R7
+
+        
+
+
+@********************************************************************************************
+@
+@ ************************************************************
+@ **********                                        **********
+@ ********** SET FLASH MEMORY INTO SYNCHRONOUS MODE **********
+@ **********                                        **********
+@ ************************************************************
+@
+@ This subroutine sets Intel StrataFlash(R) FLASH memory into the synchronous mode of operation.
+@
+@ REQUIRED PARAMETERS:
+@
+@       NONE
+@
+@ REGISTERS USED
+@
+@       R1, R2, R3, R4, R5, R6, R7, R8, R9, R10, R11, R12 - none are preserved
+@
+xlli_enableSyncFlash:  
+@
+@       Prepare to write instructions to Intel StrataFlash for synchronous mode
+@
+@       The read Configurarion Register (RCR) in the flash memory defaults to 0xFFFF
+@       on power up (async read). The following code reconfigures the flash for
+@       synchronous burst reads as follows:
+@
+@       RCR[15]    = 0b0 (Synchronous Burst Mode)
+@       RCR[14]    = 0b0 (reserved)
+@       RCR[13:11] = 0b1000 (Latency Count = Code 4)
+@       RCR[10]    = 0b1 (Wait Polarity - not used)
+@       RCR[9]     = 0b0 (hold data for one clock)
+@       RCR[8]     = 0b1 (Wait delay = 1 - not used)
+@       RCR[7]     = 0b1 (linear burst sequence)
+@       RCR[6]     = 0b1 (Rising clock edge)
+@       RCR[5:4]   = 0b00 (reserved)
+@       RCR[3]     = 0b0 (Wrap - access wrap within selected burst length)
+@       RCR[2:0]   = 0b010 (Burst Length = 8 words)
+@
+@       Note:  K0RUN is enabled in the xlli_mem_init function
+
+        mov     r12, lr                                 @ Save off the Link Register so we can return to the right caller
+        bl      xlli_isMemBusWidth16Bit                 @ Find the bus width
+        mov     r11, r1                                 @ move the result up out of the way so we can re-use it further down
+                                                        @ R8 and higher are not touched in the following functin (this would be a good thing)
+        bl xlli_queryFlash                              @ R1 has the Flash ID - returned from xlli_queryFlash
+
+        ldr     r2, =0xffff
+        and     r1, r1, r2                              @ We only care about the lowest device, as they must be the same
+        ldr     r2, =xlli_J3_FlashID_Code
+        cmp     r1, r2                                  @ Is this J3 flash
+        ble     xlli_enableSync_Done                    @ No can do sync. flash on J3 so skip this routine
+
+        @ Now load up all the regsiters with their appropriate values
+
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        ldreq   r2,     =xlli_FLASH_RCR16_value         @ Value to set into flash RCR register for 16-bit
+        ldrne   r2,     =xlli_FLASH_RCR32_value         @ Value to set into flash RCR register for 32-bit
+        ldr     r7,     =xlli_SXCNFG_sync_value         @ SXCNFG value
+
+        ldr     r1,     =xlli_MEMORY_CONFIG_BASE        @ Memory config register base
+        mov     r3,     #xlli_FLASH_WRITE_CMD           @ Write to flash instruction
+        mov     r4,     #xlli_FLASH_WCONF_CMD           @ Write to flash confirm instruction
+        mov     r5,     #xlli_FLASH_READ_CMD            @ Load "read array" mode command
+        mov     r6,     #0x0                            @ Boot Flash Base address
+
+        @ Now one last check if we're 16 or 32-bit & jump to the appropriate code
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        beq     xlli_enableSync_Invalidate              @ if we're 16-bit, gotta skip over the block of 32-bit code
+
+        @ We're 32-bit, so need to 'double' up the commands
+
+        @ Flash Write command first
+        mov     r3,     r3, LSL #16
+        orr     r3,     r3, #xlli_FLASH_WRITE_CMD       @ Results in R3 = 0x00600060
+
+        @ Flash WConf command next
+        mov     r4,     r4, LSL #16
+        orr     r4,     r4, #xlli_FLASH_WCONF_CMD       @ Results in R3 = 0x00030003
+
+        @ Flash Read Array command
+        mov     r5,     r5, LSL #16
+        orr     r5,     r5, #xlli_FLASH_READ_CMD        @ Results in R3 = 0x00FF00FF
+
+        @ At this point, R1-7 are USED, so DO NOT TOUCH.  R8 can be reused, R9 & 10 are free also, R12 contains the proper Link return value
+
+xlli_enableSync_Invalidate:
+        @ Time to setup the locking code
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        addeq   r10, pc, #xlli_enableSync_16_Start-(.+8)
+        addne   r10, pc, #xlli_enableSync_32_Start-(.+8)
+        mvn     r8, #31                                 @ Time to ensure that we're 32-byte.baligned
+        and     r10, r10, r8
+
+        addeq   r9, pc, #xlli_enableSync_16_End-(.+8)
+        addne   r9, pc, #xlli_enableSync_32_End-(.+8)
+        and     r9, r9, r8
+
+        mrc     p15, 0, r8, c1, c0, 0                   @ read (0x78) cp15.1
+        orr     r8, r8, #0x1000                         @ enable ICache
+        mcr     p15, 0, r8, c1, c0, 0                   @ write it
+        xlli_cpWait r8                                  @ Now stall to ensure the write occured
+
+        mcr     p15, 0, r8, c9, c1, 1                   @ unlock entire i$
+        mcr     p15, 0, r8, c7, c5, 0                   @ flush i$ and BTB
+        xlli_cpWait r8
+
+xlli_enableSync_LockLoop:
+        mcr     p15, 0, r10, c7, c5, 1                  @ Invalidate i$ line (same as we are about to lock - CAN affect a locked line!)
+        mcr     p15, 0, r10, c9, c1, 0                  @ lock line into icache, based on r3
+        cmp     r10, r9                                 @ are we done?
+        add     r10, r10, #32                           @ increment to next cache-line
+        bne     xlli_enableSync_LockLoop
+
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        beq     xlli_enableSync_16_Start
+        bne     xlli_enableSync_32_Start                @ Now jump to the code locked in the i-cache
+
+
+   .balign 32                                             @ ensure is cache-line.baligned (i.e. 32 Bytes = 2^5)
+xlli_enableSync_16_Start:
+
+        @ Now program everything into the Flash and SXCNFG registers
+        str     r7,     [r1, #xlli_SXCNFG_offset]       @ Update PXA27x SXCNFG register
+        strh    r3,     [r2]                            @ Yes, the data is on the address bus!
+        strh    r4,     [r2]                            @ Confirm the write to the RCR
+        strh    r5,     [r6]                            @ Place flash back in read mode
+        ldrh    r5,     [r6]                            @ Create a data dependency stall to ensure the command was written
+        nop                                             @ Flush the pipeline
+        nop
+        nop
+        nop
+        b     xlli_enableSync_Cleanup                   @ Now jump to the clean-up code
+
+   .balign 32     @ padding
+xlli_enableSync_16_End:     nop
+
+   .balign 32                                             @ ensure is cache-line.baligned (i.e. 32 Bytes = 2^5)
+xlli_enableSync_32_Start:
+
+        @ Now program everything into the Flash and SXCNFG registers
+        str     r7,     [r1, #xlli_SXCNFG_offset]       @ Update PXA27x SXCNFG register
+        str     r3,     [r2]                            @ Yes, the data is on the address bus!
+        str     r4,     [r2]                            @ Confirm the write to the RCR
+        str     r5,     [r6]                            @ Place flash back in read mode
+        ldr     r5,     [r6]                            @ Create a data dependency stall to ensure the command was written
+        nop                                             @ Flush the pipeline
+        nop
+        nop
+        nop
+        b     xlli_enableSync_Cleanup                   @ Now jump to the clean-up code
+
+   .balign 32     @ padding
+xlli_enableSync_32_End:     nop
+
+        @ Now clean-up from all the cache locking
+
+        .balign 32
+xlli_enableSync_Cleanup:
+
+        mcr     p15, 0, r1, c9, c1, 1                   @ unlock entire i$
+        mov     r1, #0x78
+        mcr     p15, 0, r1, c1, c0, 0                   @ disable i$ now that we are done with it
+        xlli_cpWait  r1                                 @ Stall the pipeline
+
+        mcr     p15, 0, r1 ,c7, c5, 0                   @ flush i$ and BTB
+        xlli_cpWait r1
+
+xlli_enableSync_Done:
+        @ Return to caller
+        mov     pc,  r12                                 @ Return to calling routine - recall we moved LR->R9 as first instruction
+
+        
+
+@********************************************************************************************
+@
+@ **************************************************************
+@ **********                                          **********
+@ ********** DISABLES FLASH MEMORY'S SYNCHRONOUS MODE **********
+@ **********                                          **********
+@ **************************************************************
+@
+@ This subroutine sets Intel StrataFlash(R) FLASH memory into the asynchronous mode of operation.
+@
+@       ********** THIS IS AN INITAL RELEASE OF THE CODE - SUBJECT TO CHANGE!! **********
+@
+@ REQUIRED PARAMETERS:
+@
+@       NONE
+@
+@ REGISTERS USED
+@
+@       R1, R2, R3, R4, R5, R6, R7, R8, R9, R10, R11, R12 - none are preserved
+@
+xlli_disableSyncFlash:  
+
+        mov     r12, lr                                 @ Save off the Link Register so we can return to the right caller
+        bl xlli_isMemBusWidth16Bit                      @ Find the bus width
+        mov     r11, r1                                 @ move the result up out of the way so we can re-use it further down
+                                                        @ R8 and higher are not touched in the following functin (this would be a good thing)
+        bl xlli_queryFlash                              @ R1 has the Flash ID - returned from xlli_queryFlash
+
+        ldr     r2, =0xffff
+        and     r1, r1, r2                              @ We only care about the lowest device, as they must be the same
+        ldr     r2, =xlli_J3_FlashID_Code
+        cmp     r1, r2                                  @ Is this J3 flash
+        ble     xlli_disableSync_Done                   @ No can do sync. flash on J3 so skip this routine
+
+        @ Now load up all the regsiters with their appropriate values
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        ldreq   r2,     =xlli_FLASH_ASYNC_RCR16_value   @ Value to set into flash RCR register for 16-bit
+        ldrne   r2,     =xlli_FLASH_ASYNC_RCR32_value   @ Value to set into flash RCR register for 32-bit
+        ldr     r7,     =xlli_SXCNFG_async_value        @ SXCNFG value
+
+        ldr     r1,     =xlli_MEMORY_CONFIG_BASE        @ Memory config register base
+        mov     r3,     #xlli_FLASH_WRITE_CMD           @ Write to flash instruction
+        mov     r4,     #xlli_FLASH_WCONF_CMD           @ Write to flash confirm instruction
+        mov     r5,     #xlli_FLASH_READ_CMD            @ Load "read array" mode command
+        mov     r6,     #0x0                            @ Boot Flash Base address
+
+        @ Now one last check if we're 16 or 32-bit & jump to the appropriate code
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        beq     xlli_disableSync_Invalidate             @ if we're 16-bit, gotta skip over the block of 32-bit code
+
+        @ We're 32-bit, so need to 'double' up the commands
+
+        @ Flash Write command first
+        mov     r3,     r3, LSL #16
+        orr     r3,     r3, #xlli_FLASH_WRITE_CMD       @ Results in R3 = 0x00600060
+
+        @ Flash WConf command next
+        mov     r4,     r4, LSL #16
+        orr     r4,     r4, #xlli_FLASH_WCONF_CMD       @ Results in R3 = 0x00030003
+
+        @ Flash Read Array command
+        mov     r5,     r5, LSL #16
+        orr     r5,     r5, #xlli_FLASH_READ_CMD        @ Results in R3 = 0x00FF00FF
+
+        @ At this point, R1-7 are USED, so DO NOT TOUCH.  R8 can be reused, R9 & 10 are free also, R12 contains the proper Link return value
+
+xlli_disableSync_Invalidate:
+        @ Time to setup the locking code
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        addeq   r10, pc, #xlli_disableSync_16_Start-(.+8)
+        addne   r10, pc, #xlli_disableSync_32_Start-(.+8)
+        mvn     r8, #31                                 @ Time to ensure that we're 32-byte.baligned
+        and     r10, r10, r8
+
+        addeq   r9, pc, #xlli_disableSync_16_End-(.+8)
+        addne   r9, pc, #xlli_disableSync_32_End-(.+8)
+        and     r9, r9, r8
+
+        mrc     p15, 0, r8, c1, c0, 0                   @ read (0x78) cp15.1
+        orr     r8, r8, #0x1000                         @ enable ICache
+        mcr     p15, 0, r8, c1, c0, 0                   @ write it
+        xlli_cpWait r8                                  @ Now stall to ensure the write occured
+
+        mcr     p15, 0, r8, c9, c1, 1                   @ unlock entire i$
+        mcr     p15, 0, r8, c7, c5, 0                   @ flush i$ and BTB
+        xlli_cpWait r8
+
+xlli_disableSync_LockLoop:
+        mcr     p15, 0, r10, c7, c5, 1                  @ Invalidate i$ line (same as we are about to lock - CAN affect a locked line!)
+        mcr     p15, 0, r10, c9, c1, 0                  @ lock line into icache, based on r3
+        cmp     r10, r9                                 @ are we done?
+        add     r10, r10, #32                           @ increment to next cache-line
+        bne     xlli_disableSync_LockLoop
+        cmp     r11,     #0x1                           @ Compare return value - 1 indicates that it's a 16-bit bus
+        beq     xlli_disableSync_16_Start               @ Now jump to the code locked in the i-cache
+        bne     xlli_disableSync_32_Start               @ Now jump to the code locked in the i-cache
+
+
+   .balign 32                                             @ ensure is cache-line.baligned (i.e. 32 Bytes = 2^5)
+xlli_disableSync_16_Start:
+
+        @ Now program everything into the Flash and SXCNFG registers
+        str     r7,     [r1, #xlli_SXCNFG_offset]       @ Update PXA27x SXCNFG register
+        strh    r3,     [r2]                            @ Yes, the data is on the address bus!
+        strh    r4,     [r2]                            @ Confirm the write to the RCR
+        strh    r5,     [r6]                            @ Place flash back in read mode
+        ldrh    r5,     [r6]                            @ Create a data dependency stall to ensure the command was written
+        nop                                             @ Flush the pipeline
+        nop
+        nop
+        nop
+        b     xlli_disableSync_Cleanup                  @ Now jump to the clean-up code
+
+   .balign 32     @ padding
+xlli_disableSync_16_End:     nop
+
+
+   .balign 32                                             @ ensure is cache-line.baligned (i.e. 32 Bytes = 2^5)
+xlli_disableSync_32_Start:
+
+        @ Now program everything into the Flash and SXCNFG registers
+        str     r7,     [r1, #xlli_SXCNFG_offset]       @ Update PXA27x SXCNFG register
+        str     r3,     [r2]                            @ Yes, the data is on the address bus!
+        str     r4,     [r2]                            @ Confirm the write to the RCR
+        str     r5,     [r6]                            @ Place flash back in read mode
+        ldr     r5,     [r6]                            @ Create a data dependency stall to ensure the command was written
+        nop                                             @ Flush the pipeline
+        nop
+        nop
+        nop
+        b     xlli_disableSync_Cleanup                  @ Now jump to the clean-up code
+
+   .balign 32     @ padding
+xlli_disableSync_32_End:     nop
+
+        @ Now clean-up from all the cache locking
+
+        .balign 32
+xlli_disableSync_Cleanup:
+
+        mcr     p15, 0, r1, c9, c1, 1                   @ unlock entire i$
+        mov     r1, #0x78
+        mcr     p15, 0, r1, c1, c0, 0                   @ disable i$ now that we are done with it
+        xlli_cpWait  r1                                 @ Stall the pipeline
+
+        mcr     p15, 0, r1 ,c7, c5, 0                   @ flush i$ and BTB
+        xlli_cpWait r1
+
+xlli_disableSync_Done:
+        @ Return to caller
+        mov     pc,  r12                                 @ Return to calling routine - recall we moved LR->R9 as first instruction
+
+
+xlli_UART_init:
+
+        mov    r1,  #0x0                         @ Zero out a work register
+        str    r1,  [r0, #UAIER_offset]      @ Zero out Interrupt Enable Register
+        str    r1,  [r0, #UAFCR_offset]      @ Zero out FIFO Control Register
+        str    r1,  [r0, #UALCR_offset]      @ Zero out Line Control Register
+        str    r1,  [r0, #UAMCR_offset]      @ Zero out Modem Control Register
+        str    r1,  [r0, #UAISR_offset]      @ Zero out IR bit register
+        ldr    r1,  [r0, #UAMSR_offset]      @ Read MSR once to clear bits
+
+        mov    r1,  #0x83                        @ Set up divisor latch bit (DLAB), 8 bit character, no parity, 1 stop bit
+        str    r1,  [r0,  #UALCR_offset]     @ Set DLAB bit
+
+        str    r2,  [r0,  #UADLL_offset]     @ set baud rate
+        ldr    r1,  =0x0                         @ Insure high baud rate byte is zero
+        str    r1,  [r0,  #UADLH_offset]
+
+        ldr    r1,  [r0,  #UALCR_offset]     @ Get LCR values
+        bic    r1,  r1,   #DLAB              @ Clear DLAB bit
+        str    r1,  [r0,  #UALCR_offset]     @ Write the value back out
+        mov    r1,  #0x07                        @ This value will clear the TX and RX FIFOs
+        str    r1,  [r0,  #UAFCR_offset]     @ ... and enabale the FIFOs for use.
+
+        mov    r1,  #0x40                        @ set unit enable bit
+        str    r1,  [r0,  #UAIER_offset]     @ enable the UART
+
+		mov		pc,	lr
+        
+xlli_PUTchar:
+2:	ldr		r1,	[r0, #UALSR_offset]
+	ands	r1, r1,  #TDRQ
+	beq		2
+	strb	r2,	[r0,	#UATHR_offset]
+
+	mov		pc,	lr
+
+
+xlli_putstr:
+3:	mov		r13, lr
+	ldrb	r2, [r3], #1
+	cmp		r2, #0
+	beq		4
+	b		xlli_PUTchar
+	b		3
+4:	mov		pc, r13
+
+@
+@*********************************************************************************
+@
+@       ***************
+@       *             * 
+@       * bbu_getPI2C * Subroutine
+@       *             *
+@       ***************
+@
+@ This subroutine is used to read data from the Power I2C bus
+
+@
+@ PARAMETER PASSING:
+@
+@       r4 = address in target device where data is to be read from
+@       r5 = data read from the register pointed to by r4
+@
+@ RETURNED VALUE:
+@
+@       r8 = non zero if no I2C bus time out
+@       r8 = zero if I2C bus time out 
+@
+@ REGISTERS USED:
+@
+@       r1, r2, r3, r4, r5, r6, r8 are used and not preserved 
+@
+bbu_getPI2C:
+@
+@       Make sure the clock to the I2C unit is enabled
+@
+        ldr    r3,  =xlli_CLKREGS_PHYSICAL_BASE     @ Base address of clock unit
+        ldr    r2,  [r3, #xlli_CKEN_offset]         @ Get current setting of clock enable register
+        orr    r2,  r2,  #0x8000                    @ Set bit 15 in the clock enable word
+        str    r2,  [r3, #xlli_CKEN_offset]         @ Write the register back
+@
+@       Init the Power I2C controller for use
+@
+        ldr    r1,  =xlli_PMRCREGS_PHYSICAL_BASE    @ Load Power Manager controller base address
+        ldr    r3,  [r1, #xlli_PCFR_offset]         @ Get present Config register data
+        orr    r3,  r3,  #PI2C_EN               @ Enable power manager I2C bus
+        str    r3,  [r1, #xlli_PCFR_offset]         @ Write Config register data back
+
+        mov    r2,  #0                              @ Set host controller slave address
+        str    r2,  [r1, #xlli_PI2SAR_offset]       @ Set slave address register
+        str    r2,  [r1, #xlli_PI2CR_offset]        @ Clear interrupts in ICR
+        mov    r3,  #(ICR_IUE | ICR_SCLE)   @ Set IUE and SCLE bits
+        str    r3,  [r1, #xlli_PI2CR_offset]        @ Enable the I2C in ICR
+@
+@       Get the slave's address
+@
+        ldr    r6,  =FFUART_PHYSICAL_BASE       @ Fetch base address of the FFUART
+        ldr    r9,  [r6, #UASPR_offset]         @ Get contents of the scratch pad register
+        str    r9,  [r1, #xlli_PI2DBR_offset]       @ Load Data Buffer Register
+@
+@       Send 1st byte
+@
+        orr    r3,  r3,  #(ICR_TB | ICR_START)
+        str    r3,  [r1, #xlli_PI2CR_offset]              @ Set TB and START bits (in addition to IUE & SCLE)
+        mov    r8,  #0x80000                              @ Set up time out value
+
+p1:       ldr    r3,  [r1, #xlli_PI2SR_offset]              @ Get status register contents
+        subs   r8,  r8,  #1                               @ Decrement time out value
+        moveq  pc,  lr                                    @ Return if timed out
+        ands   r3,  r3,  #ISR_ITE                     @ Was the byte sent yet?
+        beq    p1                                        @ No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              @ Write the ITE bit to clear it (sticky)
+@
+@       Set up and then send 2nd byte (ADDRESS)
+@
+        str    r4,  [r1, #xlli_PI2DBR_offset]             @ Set register address in the IDBR
+        mov    r3,  #(ICR_TB | ICR_IUE | ICR_SCLE | ICR_STOP)
+        str    r3,  [r1, #xlli_PI2CR_offset]              @ Set TB bit to start transfer
+        mov    r8,  #0x80000                              @ Set up time out value
+
+p2:       ldr    r3,  [r1, #xlli_PI2SR_offset]              @ Get status register contents
+        subs   r8,  r8,  #1                               @ Decrement time out value
+        moveq  pc,  lr                                    @ Return if timed out
+        ands   r3,  r3,  #ISR_ITE                     @ Was the byte sent yet?
+        beq    p2                                        @ No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              @ Write the ITE bit to clear it (sticky)
+@
+@       Set up and then send 3rd byte - Slave read address
+@
+        orr    r9,  r9,  #1                               @ Turn the address into a slave address
+        str    r9,  [r1, #xlli_PI2DBR_offset]             @ Load Data Buffer Register
+        mov    r3,  #(ICR_TB | ICR_IUE | ICR_SCLE | ICR_START)
+        str    r3,  [r1, #xlli_PI2CR_offset]              @ Set TB bit to start transfer
+
+p3:       ldr    r3,  [r1, #xlli_PI2SR_offset]              @ Get status register contents
+        ands   r3,  r3,  #ISR_ITE                     @ Was the byte sent yet?
+        beq    p3                                        @ No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              @ Write the ITE & IRF bits to clear them (sticky)
+@
+@       Send STOP signal
+@
+        mov    r3,  #(ICR_TB | ICR_IUE | ICR_SCLE | ICR_STOP | ICR_ACKNAK)
+        str    r3,  [r1, #xlli_PI2CR_offset]             @ Set TB bit to start transfer
+        mov    r8,  #0x80000                             @ Set up time out value
+@
+@       Set up and then receive data byte (seems to hang in the following loop * 24-Oct-03)
+@
+p5:       ldr    r3,  [r1, #xlli_PI2SR_offset]        @ Get status register contents
+        subs   r8,  r8,  #1                         @ Decrement time out counter
+        addeq  r8,  r8,  #1                         @ Increment back to 1 if timed out
+        moveq  pc,  lr                              @ and return to caller
+        ands   r3,  r3,  #ISR_IRF               @ Was the byte received yet?
+        beq    p5                                  @ no - keep looping
+        str    r3,  [r1, #xlli_PI2SR_offset]        @ Write the IRF bit to clear it (sticky)
+
+        ldr    r5,  [r1, #xlli_PI2DBR_offset]       @ Fetch data byte from the IDBR
+        mov    pc,  lr                              @ Return to caller
+
+        .ltorg
+
+@
+@*********************************************************************************
+@
+@       ***************
+@       *             * 
+@       * putPI2C * Subroutine
+@       *             *
+@       ***************
+@
+@ This subroutine is used to write data to the PI2C bus
+
+@
+@ PARAMETER PASSING:
+@
+@       r4 = address in target device where data is to be sent
+@       r5 = data to be loaded into the register pointed to by r4
+@
+@ RETURNED VALUE:
+@
+@       r8 = non zero if no I2C bus time out
+@       r8 = zero if I2C bus time out 
+@
+bbu_putPI2C:
+@
+@       Make sure the clock to the I2C unit is enabled
+@
+        ldr    r3,  =xlli_CLKREGS_PHYSICAL_BASE     @ Base address of clock unit
+        ldr    r2,  [r3, #xlli_CKEN_offset]         @ Get current setting of clock enable register
+        orr    r2,  r2,  #0x8000                    @ Set bit 15 in the clock enable word
+        str    r2,  [r3, #xlli_CKEN_offset]         @ Write the register back
+@
+@       Init the Power I2C controller for use
+@
+        ldr    r1,  =xlli_PMRCREGS_PHYSICAL_BASE    @ Load Power Manager controller base address
+        ldr    r3,  [r1, #xlli_PCFR_offset]         @ Get present Config register data
+        orr    r3,  r3,  #0x40                      @ Enable power manager I2C
+        str    r3,  [r1, #xlli_PCFR_offset]         @ Write Config register data back
+
+        mov    r2,  #0                              @ Set host controller slave address
+        str    r2,  [r1, #xlli_PI2SAR_offset]       @ Set slave address register
+        str    r2,  [r1, #xlli_PI2CR_offset]        @ Clear interrupts in ICR
+        mov    r3,  #(ICR_IUE | ICR_SCLE)   @ Set IUE and SCLE bits
+        str    r3,  [r1, #xlli_PI2CR_offset]        @ Enable the I2C in ICR
+@
+@       Get the slave's address
+@
+        ldr    r8,  =FFUART_PHYSICAL_BASE       @ Fetch base address of FFUART
+        ldr    r9,  [r8, #UASPR_offset]         @ Get contents of the scratch pad register
+        str    r9,  [r1, #xlli_PI2DBR_offset]       @ Load Data Buffer Register
+@
+@       Send 1st byte
+@
+        orr    r3,  r3,  #(ICR_TB | ICR_START)
+        str    r3,  [r1, #xlli_PI2CR_offset]              @ Set TB and START bits (in addition to IUE & SCLE)
+
+h1:       ldr    r3,  [r1, #xlli_PI2SR_offset]              @ Get status register contents
+        ands   r3,  r3,  #ISR_ITE                     @ Was the byte sent yet?
+        beq    h1                                        @ No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              @ Write the ITE bit to clear it (sticky)
+@
+@       Set up and then send 2nd byte (ADDRESS)
+@
+        str    r4,  [r1, #xlli_PI2DBR_offset]             @ Set register address in the IDBR
+        mov    r3,  #(ICR_TB | ICR_IUE | ICR_SCLE)
+        str    r3,  [r1, #xlli_PI2CR_offset]              @ Set TB bit to start transfer
+        mov    r8,  #0X80000                              @ Set up time out value
+
+h2:       ldr    r3,  [r1, #xlli_PI2SR_offset]              @ Get status register contents
+        subs   r8,  r8,  #1                               @ Decrement time out value
+        moveq  pc,  lr                                    @ Return if there was a time out
+        ands   r3,  r3,  #ISR_ITE                     @ Was the byte sent yet?
+        beq    h2                                        @ No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              @ Write the ITE bit to clear it (sticky)
+@
+@       Set up and then send 3rd byte (DATA) and STOP signal
+@
+        str    r5,  [r1, #xlli_PI2DBR_offset]             @ Set data byte into the IDBR
+        mov    r3,  #(ICR_TB | ICR_IUE | ICR_SCLE | ICR_STOP)
+        str    r3,  [r1, #xlli_PI2CR_offset]              @ Set TB bit to start transfer
+
+h3:       ldr    r3,  [r1, #xlli_PI2SR_offset]              @ Get status register contents
+        ands   r3,  r3,  #ISR_ITE                     @ Was the byte sent yet?
+        beq    h3                                        @ No - still being transmitted
+        str    r3,  [r1, #xlli_PI2SR_offset]              @ Write the ITE bit to clear it (sticky)
+
+        mov    pc,  lr                              @ Return to caller
+
+		.ltorg
+
+
+@ 
+@ Aeronix, Inc. 
+@ 2005
+@ Setup for Z2 board
+@ Version 1
+@
+Z2_init:
+
+
+		mov		pc,	lr
+
+    
+@********************************************************************************************
+@********************************************************************************************
+        
+
+
+
Index: build_tree/bootLoader/src/blob/xlli/mainstone/xlli_LowLev_mac.mac
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/xlli_LowLev_mac.mac:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/xlli_LowLev_mac.mac	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,203 @@
+@*********************************************************************************
+@
+@ Copyright (C) 2004, Intel Corporation
+@
+@ This software program is licensed subject to the GNU General Public License
+@ (GPL).Version 2,June 1991, available at http://www.fsf.org/copyleft/gpl.html
+@
+@*********************************************************************************
+@
+@                                 xlli_LowLev_mac.mac
+@                          MainStone Platform Low Level Macros
+@
+@ Copyright (c) 2002 by Intel Corp. Hudson MA
+@
+@ List of macros in this file:
+@
+@
+@ xlli_mapSECTIONS   (Macro) Generates page table entries for MMU
+@
+@*********************************************************************************
+
+
+
+
+@*********************************************************************************
+@      This macro will map a region using 1MB sections
+@      Notes:
+@             1)You must call xlli_initPageTable before this macro is valid.
+@             2) This version of the macro is used when NAMED values are passed to the macro
+
+    .macro    xlli_mapSECTIONS  w1,w2,w3,w4,size,virtual,physical,access,Level1tab
+
+@       $size      = size of region to be mapped
+@       $virtual   = starting virtual address of region
+@       $physical  = starting physical address of region
+@       $access    = access bits for this region
+@       $tabl      = physical (base) address of page tables
+@       $Level1tab = offset from page table base to level 1 entries
+
+        @ get the page table base address from cp15
+
+        mrc     p15, 0, \w4, c2, c0, 0
+        mov     \w4, \w4, LSR #14                         @ Clear the low order 14 bits because cp15...
+        mov     \w4, \w4, LSL #14                         @ ...read of these bits are unpredictable
+
+        ldr     \w3,  =\size                              @ get size of bank
+        cmp     \w3,  #0
+        beq     2                                       @ if size=0, skip
+
+        ldr     \w2,  =\Level1tab + (\virtual:SHR:(20-2)) @ generate table index
+
+        add     \w2,  \w2,   \w4                          @ offset into page table
+        mov     \w3,  \w3,   LSR #20                      @ no. of 1MB segments
+
+        ldr     \w1,  =(\physical + \access)              @ create table entry
+1:
+        str     \w1,  [\w2], #4                           @ store table entry and increment
+        add     \w1,  \w1,   #xlli_MemSize_1Mb            @ add section number field
+        subs    \w3,  \w3,   #1                           @ decrement loop count
+        bne     1
+2:
+
+    .endm
+@*********************************************************************************
+@
+@ **************************************************
+@ **********                              **********
+@ ********** xlli_mapSECTIONS_Var         **********
+@ **********                              **********
+@ **************************************************
+@
+@      This macro will map a region using 1MB sections
+@      Notes:
+@             1)You must call xlli_initPageTable before this macro is valid.
+@             2) This version of the macro is used when REGISTER values are passed to the macro
+
+    .macro    xlli_mapSECTIONS_Var  w1,w2,w3,w4,size,virtual,physical,access,Level1tab
+
+@       $size      = size of region to be mapped
+@       $virtual   = starting virtual address of region
+@       $physical  = starting physical address of region
+@       $access    = access bits for this region
+@       $tabl      = physical (base) address of page tables
+@       $Level1tab = offset from page table base to level 1 entries
+
+        @ get the page table base address from cp15
+
+        mrc     p15, 0, \w4, c2, c0, 0
+        mov     \w4, \w4, LSR #14                @ Clear the low order 14 bits because cp15...
+        mov     \w4, \w4, LSL #14                @ ...read of these bits are unpredictable
+
+        mov     \w3,  \size                      @ get size of bank
+        cmp     \w3,  #0
+        beq     2                              @ if size=0, skip
+
+                mov             \w2,  \virtual, LSR #(20-2)
+                add             \w2,  \w2, #\Level1tab           @ generate table index
+
+        add     \w2,  \w2,   \w4                 @ offset into page table
+        mov     \w3,  \w3,   LSR #20             @ no. of 1MB segments
+
+                add             \w1,  \physical, \access         @ create table entry
+1:
+        str     \w1,  [\w2], #4                  @ store table entry and increment
+        add     \w1,  \w1,   #xlli_MemSize_1Mb   @ add section number field
+        subs    \w3,  \w3,   #1                  @ decrement loop count
+        bne     1
+2:
+
+    .endm
+@*********************************************************************************
+@
+@ **************************************************
+@ **********                              **********
+@ **********         xlli_cpWait          **********
+@ **********                              **********
+@ **************************************************
+@
+@      This macro will arbitrarily read CP15 to create a stall in the pipeline.
+@
+@  Notes:
+@       $Rd      = temporary register to use
+@
+    .macro    xlli_cpWait  Rd
+
+        MRC     P15, 0, \Rd, C2, C0, 0       @ arbitrary read of CP15
+        MOV     \Rd, \Rd                     @ wait for it (foward dependency)
+        SUB     PC, PC, #4                   @ branch to next instruction
+
+    .endm
+
+@*********************************************************************************
+@
+@ **************************************************
+@ **********                              **********
+@ **********        xlli_retCCSR_L_Val    **********
+@ **********                              **********
+@ **************************************************
+@
+@      This macro will read the CCSR's L value and return it in the designated register
+@
+@  Notes:
+@      $Base should contain the base address of the CCSR (virtual or phy)
+@
+    .macro    xlli_retCCSR_L_Val retval,Base,gp1
+
+        @ read CCCR's value
+        ldr     \retval, [\Base, #xlli_CCSR_offset]
+
+        @ mask out irrelevant bits
+        ldr     \gp1, =0x1F
+        and     \retval, \retval, \gp1
+
+    .endm
+
+@*********************************************************************************
+@
+@ **************************************************
+@ **********                              **********
+@ **********       xlli_retCCSR_2N_Val    **********
+@ **********                              **********
+@ **************************************************
+@
+@      This macro will read the CCSR and return the 2N value in $retval
+@
+@  Notes:
+@      $Base should contain the base address of the CCSR (virtual or phy)
+@
+    .macro    xlli_retCCSR_2N_Val retval,Base,gp1
+
+        @ read CCCR's value
+        ldr     \retval, [\Base, #xlli_CCSR_offset]
+
+        @ mask out irrelevant bits
+        ldr     \gp1, =0x780
+        and     \retval, \retval, \gp1
+        mov     \retval, \retval LSR #7
+
+    .endm
+
+@*********************************************************************************
+@
+@ **************************************************
+@ **********                              **********
+@ **********          xlli_SetLEDs        **********
+@ **********                              **********
+@ **************************************************
+@
+@      This macro will dump $ValueReg out to the Mainstone's HEX LEDS
+@      via the FPGA for the MAINSTONE PLATFORM ONLY!
+@
+@  Notes:
+@      None
+@
+   .macro   xlli_SetLEDs ValueReg,tmpreg
+        ldr     \tmpreg,    =0x08000000                 @ FPGA PHYS BASE
+        str     \ValueReg,  [\tmpreg, #0x10]            @ LED register offset
+    .endm
+
+@*********************************************************************************
+@*********************************************************************************
+    
+
Index: build_tree/bootLoader/src/blob/xlli/mainstone/xlli_Mainstone_defs.inc
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/xlli_Mainstone_defs.inc:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/xlli_Mainstone_defs.inc	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,403 @@
+@*********************************************************************************
+@
+@        COPYRIGHT (c) 2002 - 2004 Intel Corporation
+@
+@   The information in this file is furnished for informational use only,
+@   is subject to change without notice, and should not be construed as
+@   a commitment by Intel Corporation. Intel Corporation assumes no
+@   responsibility or liability for any errors or inaccuracies that may appear
+@   in this document or any software that may be provided in association with
+@   this document.
+@
+@*********************************************************************************
+@
+@  FILENAME:       .equ    xlli_Mainstone_defs.inc (Platform specific addresses and
+@                  defalut values for Mainstone II platform bring up)
+@                  NOTE: - This file has a def to configure xlli for MCP and non-MCP processors
+@
+@ LAST MODIFIED:   4-Aug-2004
+@
+@******************************************************************************
+@
+@
+@ Include file for Mainstone II specific Cross Platform Low Level Initialization (XLLI)
+@
+.equ    xlli_SDRAM_SIZE_32_MB   ,     0       @ Uncomment for 32 Mb of SDRAM
+.equ    xlli_FLASH_WIDTH_16_BIT ,     0       @ Uncomment for 16-bit FLASH bus
+.equ    xlli_C0_BULVERDE        ,     0       @ Uncomment for PXA27x step C0
+.equ	xlli_MCP,0
+
+@
+@ PLATFORM REGISTERS base address and register offsets from the base address
+@
+.equ    xlli_PLATFORM_REGISTERS              ,    0x08000000
+
+.equ    xlli_PLATFORM_HEXLED_DATA_offset     ,    0x10   @ Hex LED Data Register
+.equ    xlli_PLATFORM_LED_CONTROL_offset     ,    0x40   @ LED Control Register
+.equ    xlli_PLATFORM_SWITCH_offset          ,    0x60   @ General Purpose Switch Register
+.equ    xlli_PLATFORM_MISC_WRITE1_offset     ,    0x80   @ Misc Write Register 1
+.equ    xlli_PLATFORM_MISC_WRITE2_offset     ,    0x84   @ Misc Write Register 2
+.equ    xlli_PLATFORM_MISC_READ1_offset      ,    0x90   @ Misc Read Register 1
+.equ    xlli_PLATFORM_INTERR_ME_offset       ,    0xC0   @ Platform Interrupt Mask/Enable Register 1
+.equ    xlli_PLATFORM_INTERR_SC_offset       ,    0xD0   @ Platform Interrupt Set/Clear Register 1
+.equ    xlli_PLATFORM_PCMCIA0_SC_offset      ,    0xE0   @ PCMCIA Socket 0 Status/Control Register
+.equ    xlli_PLATFORM_PCMCIA1_SC_offset      ,    0xE4   @ PCMCIA Socket 1 Status/Control Register
+
+@
+@ Platform specific bits
+@
+.equ    xlli_SYS_RESET                       ,    0x01   @ System reset bit
+
+@
+@ platform GPIO pin settings for Zipit2
+@
+.equ    xlli_GPSR0_value          ,   (0x06080000)   @ Set registers
+.equ    xlli_GPSR1_value          ,   (0x007F0000)
+.equ    xlli_GPSR2_value          ,   (0x03020000)   @ 3/10/06 PB Power up with LCD power disabled
+.equ    xlli_GPSR3_value          ,   (0x00000180)   @ 2/24/06 PB Changed from 0388 to 0188 to enable A-BUF
+
+.equ    xlli_GPCR0_value          ,   (0x0)          @ Clear registers
+.equ    xlli_GPCR1_value          ,   (0x0)	
+.equ    xlli_GPCR2_value          ,   (0x0)
+.equ    xlli_GPCR3_value          ,   (0x0)
+
+.equ    xlli_GRER0_value          ,   (0x0)          @ Rising Edge Detect
+.equ    xlli_GRER1_value          ,   (0x0)
+.equ    xlli_GRER2_value          ,   (0x0)
+.equ    xlli_GRER3_value          ,   (0x0)
+
+.equ    xlli_GFER0_value          ,   (0x0)          @ Falling Edge Detect
+.equ    xlli_GFER1_value          ,   (0x0)
+.equ    xlli_GFER2_value          ,   (0x0)
+.equ    xlli_GFER3_value          ,   (0x0)
+
+.equ    xlli_GPLR0_value          ,   (0x0)          @ Pin Level Registers
+.equ    xlli_GPLR1_value          ,   (0x0)
+.equ    xlli_GPLR2_value          ,   (0x0)
+.equ    xlli_GPLR3_value          ,   (0x0)
+
+.equ    xlli_GEDR0_value          ,   (0x0)          @ Edge Detect Status
+.equ    xlli_GEDR1_value          ,   (0x0)
+.equ    xlli_GEDR2_value          ,   (0x0)
+.equ    xlli_GEDR3_value          ,   (0x0)
+
+.equ    xlli_GPDR0_value          ,   (0xDAFCEE00)   @
+.equ    xlli_GPDR1_value          ,   (0xFFA3AAAB)   @ 
+.equ    xlli_GPDR2_value          ,   (0x8FE1FFFF)
+.equ    xlli_GPDR3_value          ,   (0x001B1F8A)
+
+.equ    xlli_GAFR0_L_value ,  (0x02000140)   
+@.equ    xlli_GAFR0_L_value ,  (0x02800140)   
+.equ    xlli_GAFR0_U_value ,  (0x59188000)   
+.equ    xlli_GAFR1_L_value ,  (0x63900002)
+.equ    xlli_GAFR1_U_value ,  (0xAAA03950)
+.equ    xlli_GAFR2_L_value ,  (0x0AAAAAAA)
+.equ    xlli_GAFR2_U_value ,  (0x29000308)
+.equ    xlli_GAFR3_L_value ,  (0x54000000)
+.equ    xlli_GAFR3_U_value ,  (0x000000D5)
+
+@
+@ MEMORY CONTROLLER SETTINGS FOR MAINSTONE
+@
+
+.equ    xlli_MDREFR_value  ,   (0x0000001E)	   @ Refresh info (Bits 11:0 define refresh rate)
+.equ    xlli_MSC0_DC_value ,   (0x7FF07FFA)     @ PXA27x Card Flash value (MCP version)
+ 
+@ AERONIX Define new setting below
+.equ    xlli_MSC0_MS_value ,   (0x2FFC38F8)     @ 0x2FFC sets CS1# for VLIO timings (CS8900), 0x38F8 is for Flash
+												
+@ See page 6-64 of Developers Manual
+.equ    xlli_MSC1_value    ,   (0x0000CCD1)	  @ 
+.equ    xlli_MSC2_value    ,   (0x0000B884)	  @ 
+.equ    xlli_MECR_value    ,   (0x00000001)     @ Expansion memory -- 
+.equ    xlli_MCMEM0_value  ,   (0x00014307)	  @ PC Card memory -- 
+.equ    xlli_MCMEM1_value  ,   (0x00014307)	  @ PC Card memory -- 
+.equ    xlli_MCATT0_value  ,   (0x0001C787)	  @ PC Card memory -- 
+.equ    xlli_MCATT1_value  ,   (0x0001C787)	  @ PC Card memory -- 
+.equ    xlli_MCIO0_value   ,   (0x0001430F)	  @ PC Card memory -- 
+.equ    xlli_MCIO1_value   ,   (0x0001430F)	  @ PC Card memory -- 
+.equ    xlli_FLYCNFG_value ,   (0x00010001)     @ Fly-by-DMA -- ?????
+@ .equ    xlli_MDMRSLP_value ,   (0x00000000)     @ Low power enable for SDRAM (was 0000C008)   
+.equ    xlli_MDMRSLP_value ,   (0x0000C008)     @ Low power enable for SDRAM   
+.equ    xlli_SXCNFG_value  ,   (0x40044004)     @ Default value at boot up. Synchronous static memory.
+
+
+@
+@ Optimal values for MSCO for various MemClk frequencies are listed below
+@ These values are for L18 async flash
+@
+ 
+.equ    xlli_MSC0_13       ,   (0x11101110)
+.equ    xlli_MSC0_19       ,   (0x11101110)
+.equ    xlli_MSC0_26       ,   (0x11201120)   @ 26 MHz setting
+.equ    xlli_MSC0_32       ,   (0x11201120)
+.equ    xlli_MSC0_39       ,   (0x11301130)   @ 39 MHz setting
+.equ    xlli_MSC0_45       ,   (0x11301130)
+.equ    xlli_MSC0_52       ,   (0x11401140)   @ 52 MHz setting
+.equ    xlli_MSC0_58       ,   (0x11401140)
+.equ    xlli_MSC0_65       ,   (0x11501150)   @ 65 MHz setting
+.equ    xlli_MSC0_68       ,   (0x11501150)
+.equ    xlli_MSC0_71       ,   (0x11501150)   @ 71.5 MHz setting
+.equ    xlli_MSC0_74       ,   (0x11601160)
+.equ    xlli_MSC0_78       ,   (0x12601260)   @ 78 MHz setting
+.equ    xlli_MSC0_81       ,   (0x12601260)
+.equ    xlli_MSC0_84       ,   (0x12601260)   @ 84.5 MHz setting
+.equ    xlli_MSC0_87       ,   (0x12701270)
+.equ    xlli_MSC0_91       ,   (0x12701270)   @ 91 MHz setting
+.equ    xlli_MSC0_94       ,   (0x12701270)   @ 94.2 MHz setting
+.equ    xlli_MSC0_97       ,   (0x12701270)   @ 97.5 MHz setting
+.equ    xlli_MSC0_100      ,   (0x12801280)   @ 100.7 MHz setting
+.equ    xlli_MSC0_104      ,   (0x12801280)   @ 104 MHz setting
+.equ    xlli_MSC0_110      ,   (0x12901290)
+.equ    xlli_MSC0_117      ,   (0x13901390)   @ 117 MHz setting
+.equ    xlli_MSC0_124      ,   (0x13A013A0)
+.equ    xlli_MSC0_130      ,   (0x13A013A0)   @ 130 MHz setting
+.equ    xlli_MSC0_136      ,   (0x13B013B0)
+.equ    xlli_MSC0_143      ,   (0x13B013B0)
+.equ    xlli_MSC0_149      ,   (0x13C013C0)
+.equ    xlli_MSC0_156      ,   (0x14C014C0)
+.equ    xlli_MSC0_162      ,   (0x14C014C0)
+.equ    xlli_MSC0_169      ,   (0x14C014C0)
+.equ    xlli_MSC0_175      ,   (0x14C014C0)
+.equ    xlli_MSC0_182      ,   (0x14C014C0)
+.equ    xlli_MSC0_188      ,   (0x14C014C0)
+.equ    xlli_MSC0_195      ,   (0x15C015C0)
+.equ    xlli_MSC0_201      ,   (0x15D015D0)
+.equ    xlli_MSC0_208      ,   (0x15D015D0)
+
+ 
+@ Set values for SDRAM
+
+.equ    xlli_DTC_13        ,   (0x00000000)   @ 13 MHz setting
+.equ    xlli_DTC_19        ,   (0x00000000)   @ 19 MHz setting
+.equ    xlli_DTC_26        ,   (0x00000000)   @ 26 MHz setting
+.equ    xlli_DTC_32        ,   (0x00000000)   @ 32 MHz setting
+.equ    xlli_DTC_39        ,   (0x00000000)   @ 39 MHz setting
+.equ    xlli_DTC_45        ,   (0x00000000)   @ 45 MHz setting
+.equ    xlli_DTC_52        ,   (0x00000000)   @ 52 MHz setting
+.equ    xlli_DTC_58        ,   (0x01000100)   @ 58 MHz setting
+.equ    xlli_DTC_65        ,   (0x01000100)   @ 65 MHz setting
+.equ    xlli_DTC_68        ,   (0x01000100)   @ 68 MHz setting
+.equ    xlli_DTC_71        ,   (0x01000100)   @ 71 MHz setting
+.equ    xlli_DTC_74        ,   (0x01000100)   @ 74 MHz setting
+.equ    xlli_DTC_78        ,   (0x01000100)   @ 78 MHz setting
+.equ    xlli_DTC_81        ,   (0x01000100)   @ 81 MHz setting
+.equ    xlli_DTC_84        ,   (0x01000100)   @ 84 MHz setting
+.equ    xlli_DTC_87        ,   (0x01000100)   @ 87 MHz setting
+.equ    xlli_DTC_91        ,   (0x02000200)   @ 91 MHz setting
+.equ    xlli_DTC_94        ,   (0x02000200)   @ 94 MHz setting
+.equ    xlli_DTC_97        ,   (0x02000200)   @ 97 MHz setting
+.equ    xlli_DTC_100       ,   (0x02000200)   @ 100 MHz setting
+.equ    xlli_DTC_104       ,   (0x02000200)   @ 104 MHz setting
+.equ    xlli_DTC_110       ,   (0x01000100)   @ 110 MHz setting - SDCLK Halved
+.equ    xlli_DTC_117       ,   (0x01000100)   @ 117 MHz setting - SDCLK Halved
+.equ    xlli_DTC_124       ,   (0x01000100)   @ 124 MHz setting - SDCLK Halved
+.equ    xlli_DTC_130       ,   (0x01000100)   @ 130 MHz setting - SDCLK Halved
+.equ    xlli_DTC_136       ,   (0x01000100)   @ 136 MHz setting - SDCLK Halved
+.equ    xlli_DTC_143       ,   (0x01000100)   @ 143 MHz setting - SDCLK Halved
+.equ    xlli_DTC_149       ,   (0x01000100)   @ 149 MHz setting - SDCLK Halved
+.equ    xlli_DTC_156       ,   (0x01000100)   @ 156 MHz setting - SDCLK Halved
+.equ    xlli_DTC_162       ,   (0x01000100)   @ 162 MHz setting - SDCLK Halved
+.equ    xlli_DTC_169       ,   (0x01000100)   @ 169 MHz setting - SDCLK Halved
+.equ    xlli_DTC_175       ,   (0x01000100)   @ 175 MHz setting - SDCLK Halved
+.equ    xlli_DTC_182       ,   (0x02000200)   @ 182 MHz setting - SDCLK Halved - Close to edge, so bump up
+.equ    xlli_DTC_188       ,   (0x02000200)   @ 188 MHz setting - SDCLK Halved - Close to edge, so bump up
+.equ    xlli_DTC_195       ,   (0x02000200)   @ 195 MHz setting - SDCLK Halved - Close to edge, so bump up
+.equ    xlli_DTC_201       ,   (0x02000200)   @ 201 MHz setting - SDCLK Halved - Close to edge, so bump up
+.equ    xlli_DTC_208       ,   (0x02000200)   @ 208 MHz setting - SDCLK Halved - Close to edge, so bump up
+@
+@       Optimal values for DRI settings for various MemClk settings (MDREFR)
+@
+.equ    xlli_DRI_13        ,   (0x002)   @ 13 MHz setting
+.equ    xlli_DRI_19        ,   (0x003)
+.equ    xlli_DRI_26        ,   (0x005)   @ 26 MHz setting
+.equ    xlli_DRI_32        ,   (0x006)
+.equ    xlli_DRI_39        ,   (0x008)   @ 39 MHz setting
+.equ    xlli_DRI_45        ,   (0x00A)
+.equ    xlli_DRI_52        ,   (0x00B)   @ 52 MHz setting
+.equ    xlli_DRI_58        ,   (0x00D)
+.equ    xlli_DRI_65        ,   (0x00E)   @ 65 MHz setting
+.equ    xlli_DRI_68        ,   (0x00F)
+.equ    xlli_DRI_71        ,   (0x010)   @ 71 MHz setting
+.equ    xlli_DRI_74        ,   (0x011)
+.equ    xlli_DRI_78        ,   (0x012)   @ 78 MHz setting
+.equ    xlli_DRI_81        ,   (0x012)
+.equ    xlli_DRI_84        ,   (0x013)   @ 84 MHz setting
+.equ    xlli_DRI_87        ,   (0x014)
+.equ    xlli_DRI_91        ,   (0x015)   @ 91 MHz setting
+.equ    xlli_DRI_94        ,   (0x016)   @ 94 MHz setting
+.equ    xlli_DRI_97        ,   (0x016)   @ 97 MHz setting
+.equ    xlli_DRI_100       ,   (0x017)   @ 100 MHz setting
+.equ    xlli_DRI_104       ,   (0x018)   @ 104 MHz setting
+.equ    xlli_DRI_110       ,   (0x01A)
+.equ    xlli_DRI_117       ,   (0x01B)   @ 117 MHz setting
+.equ    xlli_DRI_124       ,   (0x01D)
+.equ    xlli_DRI_130       ,   (0x01E)   @ 130 MHz setting
+.equ    xlli_DRI_136       ,   (0x020)
+.equ    xlli_DRI_143       ,   (0x021)
+.equ    xlli_DRI_149       ,   (0x023)
+.equ    xlli_DRI_156       ,   (0x025)
+.equ    xlli_DRI_162       ,   (0x026)
+.equ    xlli_DRI_169       ,   (0x028)   @ 169 MHz setting
+.equ    xlli_DRI_175       ,   (0x029)
+.equ    xlli_DRI_182       ,   (0x02B)
+.equ    xlli_DRI_188       ,   (0x02D)
+.equ    xlli_DRI_195       ,   (0x02E)
+.equ    xlli_DRI_201       ,   (0x030)
+.equ    xlli_DRI_208       ,   (0x031)   @ 208 MHz setting
+
+ 
+@
+@       SDRAM Settings
+@
+
+.equ    xlli_MDCNFG_value  ,   (0x00000BA9)   @ SDRAM Config Reg (Non-MCP Version) AERONIX -- was AC9
+.equ    xlli_MDMRS_value   ,   (0x00000000)   @ SDRAM Mode Reg Set Config Reg
+
+@
+@ MEMORY PHYSICAL BASE ADDRESS(S)
+@
+
+.equ    xlli_SRAM_PHYSICAL_BASE      ,       (0X5C000000)  @ Physical base address for SRAM
+.equ    xlli_SDRAM_PHYSICAL_BASE     ,       (0xA0000000)  @ Physical base address for SDRAM
+
+@
+@ CORE, SYSTEM BUS, MEMORY BUS Default frequency setting for Mainstone
+@
+.equ    xlli_CCCR_value      ,     (0x00000107)  @ PXA27x (HW reset value to start)
+@
+@ Clock Enable Register (CKEN) setting
+@
+
+@ Aeronix: Updated via 2.33 to enable MMC clock
+
+.equ    xlli_CKEN_value      ,     (0x00D1D2E3)  @ Data to be set into the clock enable register
+  
+@ 0000 0000 1101 0001 1101 0010 1110 0011
+
+@ 0,1 PWM's enabled *
+@ 2 AC'97 coded 
+@ 3 SSP2 unit 
+
+@ 4 SSP3 unit 
+@ 5 STUART (Terminal and Scan engine) 
+@ 6 FFUART (Modem) *
+@ 7 BTUART (RF)  *
+
+@ 8 I2S Unit (codec)
+@ 9 OS timers *
+@ 10 USB Host
+@ 11 USB Client                                
+
+@ 12 enables MMC Controller *
+@ 13 -- IR port
+@ 14 I2C enable *
+@ 15 Power I2C enable *
+
+@ 16 LCD Controller *
+@ 17 MSL Interface
+@ 18 USIM interface
+@ 19 Keypad
+
+@ 20 Internal Memory Enable *
+@ 21 Memory Stick
+@ 22 Memory Controller *
+@ 23 SSP1 Unit (BGW200) *
+
+@ 24 Capture (camera) interface
+
+@ Aeronix: 7/14/06 -- MMC/SD setup
+.equ MMC_STRPCL	, 0x41100000  @ Control to start and stop MMC clock 
+.equ MMC_STAT	, 0x41100004  @ MMC Status Register (read only) 
+.equ MMC_CLKRT	, 0x41100008  @ MMC clock rate 
+.equ MMC_SPI	, 0x4110000c  @ SPI mode control bits 
+.equ MMC_CMDAT	, 0x41100010  @ Command/response/data sequence control 
+
+
+@
+@ Address where system configuration data is stored
+@
+.equ    xlli_SCR_data           ,     0x5C03FFFC      @ Address of system config data
+
+@
+@ Misc constants
+@
+.equ    xlli_MemSize_1Mb        ,     0x00100000
+.equ    xlli_p_PageTable        ,     0xA1FFC000      @ Base address for memory Page Table (MCP version)
+.equ    xlli_s_PageTable        ,     0x00004000      @ Page Table size (4K words - 16 Kb)
+
+.equ    xlli_FLASH_WRITE_CMD            ,     0x0060  @ Code for writing to flash
+.equ    xlli_FLASH_WCONF_CMD            ,     0x0003  @ Code to confirm write to flash
+.equ    xlli_FLASH_READ_CMD             ,     0x00FF  @ Code to place flash in read mode
+.equ    xlli_FLASH_READQUERY_CMD        ,     0x0098  @ Code to place flash in a 'query CFI' mode
+
+@
+@ Note 1:  For the current L3/L18 flash, it has a maximium frequency of 52MHz.  In addition, the SXCNFG.LC value is based on the
+@          SDClk presented to the flash, not the MEMClk as with most other Memory Controller settings, a bit odd, but so be it.
+@
+@ Note 2:  We have just optimized these values for 52MHz SDClk to the Flash part.  The OEM could optimize this for other SDClk values,
+@          but as there are so many, and the predominant Intel supported frequencies put the flash part into 52MHz operation, it
+@          made more sense to focus on the code, as each OEM will decide how best to run/optimize their platform.
+@
+@ Explaination of RCR value:
+@
+@       Read Mode       = 0x0 = Sync. Mode
+@       Latency Count   = 0x5
+@       Wait Polarity   = 0x0 = Wait active low
+@       Data Hold       = 0x0 = Hold for 1 clock
+@       Wait Delay      = 0x1 = Wait de-asserted 1 dcycle before valid data
+@       Burst Sequence  = 0x1 = Linear
+@       Clock Edge      = 0x1 = Rising
+@       Burst Wrap      = 0x0 = wrap
+@       Burst length    = 0x3 = 16 word burst
+@
+@       Note on Burst Length:  Spacial locality suggests that having a burst of 16 will give better results than that of 8, however,
+@               be aware that 8 words is a cache line, so it may be more beneficial to revert to a burst length of 8 words per
+@               burst as opposed to 16 words per burst
+@
+.equ    xlli_FLASH_RCR16_value  ,     0x25C3<<1       @ Value to set flash into sync mode - optimal RC.LC value for 52MHz flash is 5
+.equ    xlli_FLASH_RCR32_value  ,     0x25C3<<2       @ Value to set flash into sync mode - optimal RC.LC value for 52MHz flash is 5
+
+@
+@ Value below is simply to align with the settings put in for the flash RCR value
+@
+.equ    xlli_SXCNFG_sync_value  ,     0x7011          @ SXCNFG value for sync flash operation - optimal SXCNFG.LC value for 52MHz flash is 4
+
+@
+@ Values to put the flash back into Asynchronous mode
+@
+.equ    xlli_FLASH_ASYNC_RCR16_value    ,     0xA5C2<<1       @ Value to set flash into sync mode - optimal RC.LC value for 52MHz flash is 5
+.equ    xlli_FLASH_ASYNC_RCR32_value    ,     0xA5C2<<2       @ Value to set flash into sync mode - optimal RC.LC value for 52MHz flash is 5
+.equ    xlli_SXCNFG_async_value         ,     0x7010          @ SXCNFG value for sync flash operation - optimal SXCNFG.LC value for 52MHz flash is 4
+
+
+@
+@       Types of flash that XLLI can discover include:
+@
+@      TYPE     CODE RANGE
+@      ----   ----------------
+@       J3  =   0x16 -> 0x18
+@       K3  = 0x8801 -> 0x8803
+@       K18 = 0x8805 -> 0x8807
+@       L18 = 0x880E -> 0x8810
+@       L3  = 0x8812 -> 0x8815
+@	C3  = 0x88C4
+@   P30 = 0X8817
+@
+.equ    xlli_J3_FlashID_Code    ,     0x0018  @ return value of J3 in parallel mode
+.equ    xlli_K3_FlashID_Code    ,     0x8803  @ use the upper (so can compare as <=
+.equ    xlli_K18_FlashID_Code   ,     0x8807  @ use the upper (so can compare as <=
+.equ    xlli_L18_FlashID_Code   ,     0x8810  @ use the upper (so can compare as <=
+.equ    xlli_L3_FlashID_Code    ,     0x8815  @ use the upper (so can compare as <=
+.equ    xlli_C3_FlashID_Code    ,     0x88C4  @ use the upper (so can compare as <=
+.equ    xlli_p30_FlashID_Code    ,     0x8817  @ use the upper (so can compare as <=
+
+@
+@       Special conditional required for Power On SelfTest (POST) build
+@
+    .ifdef POST_BUILD
+.equ    xlli_v_xbBOOTROM        ,     0x00000000      @ Required for POST
+    .else
+.equ    xlli_v_xbBOOTROM        ,     0x00000000      @ Everything else
+    .endif
+
Index: build_tree/bootLoader/src/blob/xlli/mainstone/z2.inc
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/z2.inc:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/z2.inc	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,83 @@
+@ 
+@ Aeronix, Inc. 
+@ 2005
+@ Setup for Z2 board
+@ Version 1
+@
+        .include  "xlli_Bulverde_defs.inc"                 @ PXA27x specific include file
+        .include  "xlli_Mainstone_defs.inc"                @ Mainstone specific include file
+        .include  "xlli_LowLev_mac.mac"                    @ Mainstone Macro definitions
+		.include  "bbu_Bulverde_defs.inc"
+
+		.global Z2_init
+
+Z2_init:
+
+@
+@ AERONIX Set the LCD voltage to 3.0V (PCF50606 reg 0x23=0xF5)
+@
+@       Save the PCF50606 address in the FFUART scratch pad register
+@
+        mov    r1,  #0x10                        @ Set PMU codec base address
+        ldr    r2,  =FFUART_PHYSICAL_BASE    @ Fetch base address of FFUART
+        str    r1,  [r2, #UASPR_offset]      @ Store I2C address in the scratch pad register
+
+        mov    r4,  #0x23           @ I2C register address
+        mov    r5,  #0xF5           @ Data to be set to this register
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Set CV limit to 4.2V
+@
+		mov		r4,	#0x2B
+		mov		r5,	#0x3A
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Kickstart charge cycle
+@
+		mov		r4,	#0x29
+		mov		r5,	#0x0F
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Clear the watchdog timer (...so the charger doesnt time out)
+@
+		mov		r4,	#0x2A
+		mov		r5,	#0x00
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Now set the VMEM output to 3.30 because it does not seem to regulate well with default values
+@
+ 	    mov    r4,  #0x22			@ DCUDC2 register
+ 	    mov	   r5,	#0x21			@ Set 1A current limit and force PWM mode
+        bl     bbu_putPI2C         @ Send the data
+
+@
+@ Disable power OK monitoring on regulators
+@
+ 	    mov    r4,  #0x19			@ PWROK register
+ 	    mov	   r5,	#0xFF			@ Mask all regulators
+        bl     bbu_putPI2C         @ Send the data
+
+@ Set the PLLs to max out the clock speeds
+
+        mov    r2,  #0x190                                  @ Set the core frequency to 312MHz and bus to 104MHz
+        ldr    r4,  =xlli_CLKREGS_PHYSICAL_BASE             @ Load clock registers base address
+        str    r2,  [r4, #xlli_CCCR_offset]                 @ Write to the clock config register
+        bl     xlli_freq_change                             @ Frequency change sequence & restart memory controller
+@
+@ Set the SDRAM clock to 1X bus clock
+@
+        ldr    r1,  =xlli_MEMORY_CONFIG_BASE    @ Clock registers base address
+		ldr	   r4,  =0x2011A01E
+        str    r4,  [r1,  #xlli_MDREFR_offset]  @ Write data to register (this sets the SDRAM clock to 104MHz)
+ 
+@
+@ Set the Turbo bit
+@
+		mov    r7, #0x1
+        mrc    p14, 0, r6, c6, c0, 0    @ Get data in CP14, Register 6
+        bic    r6,  r6,  #1             @ Clear Turbo bit
+        bic    r6,  r6,  #2             @ Make sure the frequency change bit is cleared
+        orr    r6,  r6,  r7             @ Update with value from user
+        mcr    p14, 0, r6, c6, c0, 0    @ Write data to CP14, Register 6
+
+		mov		pc,	lr
\ No newline at end of file
Index: build_tree/bootLoader/src/blob/xlli/mainstone/z2.s
diff -u /dev/null build_tree/bootLoader/src/blob/xlli/mainstone/z2.s:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/blob/xlli/mainstone/z2.s	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,83 @@
+@ 
+@ Aeronix, Inc. 
+@ 2005
+@ Setup for Z2 board
+@ Version 1
+@
+        .include  "xlli_Bulverde_defs.inc"                 @ PXA27x specific include file
+        .include  "xlli_Mainstone_defs.inc"                @ Mainstone specific include file
+        .include  "xlli_LowLev_mac.mac"                    @ Mainstone Macro definitions
+		.include  "bbu_Bulverde_defs.inc"
+
+.global Z2_init
+
+Z2_init:
+
+@
+@ AERONIX Set the LCD voltage to 3.0V (PCF50606 reg 0x23=0xF5)
+@
+@       Save the PCF50606 address in the FFUART scratch pad register
+@
+        mov    r1,  #0x10                        @ Set PMU codec base address
+        ldr    r2,  =FFUART_PHYSICAL_BASE    @ Fetch base address of FFUART
+        str    r1,  [r2, #UASPR_offset]      @ Store I2C address in the scratch pad register
+
+        mov    r4,  #0x23           @ I2C register address
+        mov    r5,  #0xF5           @ Data to be set to this register
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Set CV limit to 4.2V
+@
+		mov		r4,	#0x2B
+		mov		r5,	#0x3A
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Kickstart charge cycle
+@
+		mov		r4,	#0x29
+		mov		r5,	#0x0F
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Clear the watchdog timer (...so the charger doesnt time out)
+@
+		mov		r4,	#0x2A
+		mov		r5,	#0x00
+        bl     bbu_putPI2C          @ Send the data
+@
+@ Now set the VMEM output to 3.30 because it does not seem to regulate well with default values
+@
+ 	    mov    r4,  #0x22			@ DCUDC2 register
+ 	    mov	   r5,	#0x21			@ Set 1A current limit and force PWM mode
+        bl     bbu_putPI2C         @ Send the data
+
+@
+@ Disable power OK monitoring on regulators
+@
+ 	    mov    r4,  #0x19			@ PWROK register
+ 	    mov	   r5,	#0xFF			@ Mask all regulators
+        bl     bbu_putPI2C         @ Send the data
+
+@ Set the PLLs to max out the clock speeds
+
+        mov    r2,  #0x190                                  @ Set the core frequency to 312MHz and bus to 104MHz
+        ldr    r4,  =xlli_CLKREGS_PHYSICAL_BASE             @ Load clock registers base address
+        str    r2,  [r4, #xlli_CCCR_offset]                 @ Write to the clock config register
+        bl     xlli_freq_change                             @ Frequency change sequence & restart memory controller
+@
+@ Set the SDRAM clock to 1X bus clock
+@
+        ldr    r1,  =xlli_MEMORY_CONFIG_BASE    @ Clock registers base address
+		ldr	   r4,  =0x2011A01E
+        str    r4,  [r1,  #xlli_MDREFR_offset]  @ Write data to register (this sets the SDRAM clock to 104MHz)
+ 
+@
+@ Set the Turbo bit
+@
+		mov    r7, #0x1
+        mrc    p14, 0, r6, c6, c0, 0    @ Get data in CP14, Register 6
+        bic    r6,  r6,  #1             @ Clear Turbo bit
+        bic    r6,  r6,  #2             @ Make sure the frequency change bit is cleared
+        orr    r6,  r6,  r7             @ Update with value from user
+        mcr    p14, 0, r6, c6, c0, 0    @ Write data to CP14, Register 6
+
+		mov		pc,	lr
Index: build_tree/bootLoader/src/commands/.cvsignore
diff -u /dev/null build_tree/bootLoader/src/commands/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,5 @@
+Makefile.in
+Makefile
+blob*
+*.o
+.deps
Index: build_tree/bootLoader/src/commands/Makefile.am
diff -u /dev/null build_tree/bootLoader/src/commands/Makefile.am:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,65 @@
+# -*- makefile -*-
+#
+# Makefile.am
+#
+# Copyright (C) 2002 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+#
+# $Id: Makefile.am,v 1.13 2003/09/04 17:50:35 russd Exp $
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+
+noinst_LIBRARIES	= \
+	libcommands.a
+
+libcommands_a_SOURCES	= \
+	terminal.c \
+	reboot.c \
+	arp.c \
+	autoip.c \
+	bogomips.c \
+	call.c \
+	changebit.c \
+	download.c \
+	dummy.c \
+	dump.c \
+	dlfile.c \
+	ferase.c \
+	fwrite.c \
+	memcpy.c \
+	peek.c \
+	poke.c \
+	md5chk.c \
+	setip.c \
+	sysupd.c \
+	tdownload.c \
+	tftp.c \
+	xdownload.c \
+	usb_serial_download.c
+
+
+INCLUDES		= \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include
+
+
+EXTRA_DIST	= \
+	make_commands.sh
+
+
+CLEANFILES	= ${srcdir}/*~
+
+
+DISTCLEANFILES	= ${builddir}/.deps/*.P
Index: build_tree/bootLoader/src/commands/Makefile.in
diff -u /dev/null build_tree/bootLoader/src/commands/Makefile.in:1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -0,0 +1,515 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+# -*- makefile -*-
+#
+# Makefile.am
+#
+# Copyright (C) 2002 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+#
+# $Id: Makefile.am,v 1.13 2003/09/04 17:50:35 russd Exp $
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+SOURCES = $(libcommands_a_SOURCES)
+
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+VPATH = @srcdir@
+pkgdatadir = $(datadir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+top_builddir = ../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = @INSTALL@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = @host@
+subdir = src/commands
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+ARFLAGS = cru
+LIBRARIES = $(noinst_LIBRARIES)
+libcommands_a_AR = $(AR) $(ARFLAGS)
+libcommands_a_LIBADD =
+am_libcommands_a_OBJECTS = terminal.$(OBJEXT) reboot.$(OBJEXT) \
+	arp.$(OBJEXT) autoip.$(OBJEXT) bogomips.$(OBJEXT) \
+	call.$(OBJEXT) changebit.$(OBJEXT) download.$(OBJEXT) \
+	dummy.$(OBJEXT) dump.$(OBJEXT) dlfile.$(OBJEXT) \
+	ferase.$(OBJEXT) fwrite.$(OBJEXT) memcpy.$(OBJEXT) \
+	peek.$(OBJEXT) poke.$(OBJEXT) md5chk.$(OBJEXT) setip.$(OBJEXT) \
+	sysupd.$(OBJEXT) tdownload.$(OBJEXT) tftp.$(OBJEXT) \
+	xdownload.$(OBJEXT) usb_serial_download.$(OBJEXT)
+libcommands_a_OBJECTS = $(am_libcommands_a_OBJECTS)
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include/blob
+depcomp = $(SHELL) $(top_srcdir)/tools/depcomp
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/arp.Po ./$(DEPDIR)/autoip.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/bogomips.Po ./$(DEPDIR)/call.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/changebit.Po ./$(DEPDIR)/dlfile.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/download.Po ./$(DEPDIR)/dummy.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/dump.Po ./$(DEPDIR)/ferase.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/fwrite.Po ./$(DEPDIR)/md5chk.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/memcpy.Po ./$(DEPDIR)/peek.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/poke.Po ./$(DEPDIR)/reboot.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/setip.Po ./$(DEPDIR)/sysupd.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/tdownload.Po ./$(DEPDIR)/terminal.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/tftp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/usb_serial_download.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/xdownload.Po
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(libcommands_a_SOURCES)
+DIST_SOURCES = $(libcommands_a_SOURCES)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
+AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
+BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
+CC = @CC@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
+LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
+MAKEINFO = @MAKEINFO@
+OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
+OCFLAGS = @OCFLAGS@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+noinst_LIBRARIES = \
+	libcommands.a
+
+libcommands_a_SOURCES = \
+	terminal.c \
+	reboot.c \
+	arp.c \
+	autoip.c \
+	bogomips.c \
+	call.c \
+	changebit.c \
+	download.c \
+	dummy.c \
+	dump.c \
+	dlfile.c \
+	ferase.c \
+	fwrite.c \
+	memcpy.c \
+	peek.c \
+	poke.c \
+	md5chk.c \
+	setip.c \
+	sysupd.c \
+	tdownload.c \
+	tftp.c \
+	xdownload.c \
+	usb_serial_download.c
+
+INCLUDES = \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include
+
+EXTRA_DIST = \
+	make_commands.sh
+
+CLEANFILES = ${srcdir}/*~
+DISTCLEANFILES = ${builddir}/.deps/*.P
+all: all-am
+
+.SUFFIXES:
+.SUFFIXES: .c .o .obj
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/commands/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/commands/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+clean-noinstLIBRARIES:
+	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
+libcommands.a: $(libcommands_a_OBJECTS) $(libcommands_a_DEPENDENCIES) 
+	-rm -f libcommands.a
+	$(libcommands_a_AR) libcommands.a $(libcommands_a_OBJECTS) $(libcommands_a_LIBADD)
+	$(RANLIB) libcommands.a
+
+mostlyclean-compile:
+	-rm -f *.$(OBJEXT)
+
+distclean-compile:
+	-rm -f *.tab.c
+
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/arp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/autoip.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/bogomips.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/call.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/changebit.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dlfile.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dummy.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/dump.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ferase.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/fwrite.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/md5chk.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memcpy.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/peek.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/poke.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reboot.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/setip.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/sysupd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/tdownload.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/terminal.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/tftp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/usb_serial_download.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/xdownload.Po@am__quote@
+
+.c.o:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c `$(CYGPATH_W) '$<'`
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(LIBRARIES)
+installdirs:
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-generic clean-noinstLIBRARIES mostlyclean-am
+
+distclean: distclean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	clean-noinstLIBRARIES ctags distclean distclean-compile \
+	distclean-generic distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-exec install-exec-am install-info \
+	install-info-am install-man install-strip installcheck \
+	installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/src/commands/arp.c
diff -u /dev/null build_tree/bootLoader/src/commands/arp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/arp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,50 @@
+/*
+ * arp.c: ARP command
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001,2002  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@www.eletztrick.de)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: arp.c,v 1.1 2003/09/04 01:10:23 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/command.h>
+#include <net/ether.h>
+#include <net/net.h>
+
+int arp_cmd(int argc, char *argv[])
+{
+	int ret = 0;
+	extern int do_arp( u8 *, u8 *);
+	u8 servereth[6];
+
+	ret = do_arp( servereth, serveripaddress );
+
+	printf( "%s: got eth addr %02x:%02x:%02x:%02x:%02x:%02x\n", __FUNCTION__,
+			servereth[0], servereth[1], servereth[2], servereth[3], servereth[4],
+			servereth[5] );
+
+	return 0;
+}
+char arp_help[] = "arp test command. No args.\n";;
+
Index: build_tree/bootLoader/src/commands/autoip.c
diff -u /dev/null build_tree/bootLoader/src/commands/autoip.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/autoip.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,49 @@
+/*
+ * autoip.c: Bootp command
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001,2002  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@www.eletztrick.de)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: autoip.c,v 1.1 2003/09/04 01:10:23 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/command.h>
+#include <net/ether.h>
+#include <net/net.h>
+
+int autoip_cmd(int argc, char *argv[])
+{
+	int ret = 0;
+	char *file;
+	extern char *do_bootp(void);
+
+	file = do_bootp();
+	
+	if ( file )
+		printf( "TFTP File: '%s'\n", file );
+
+	return 0;
+}
+char autoip_help[] = "Grab an address via bootp. No args.\n";;
+
Index: build_tree/bootLoader/src/commands/bogomips.c
diff -u /dev/null build_tree/bootLoader/src/commands/bogomips.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/bogomips.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,53 @@
+/*
+ * bogomips.c: Give a meaningless value that is somewhat
+ * indicative to processor speed.
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Copyright (C) 2003  Russ Dill <Russ.Dill@asu.edu>
+ *
+ * $Id: bogomips.c,v 1.1 2003/09/04 17:42:09 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: bogomips.c,v 1.1 2003/09/04 17:42:09 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/util.h>
+#include <blob/time.h>
+#include <blob/command.h>
+
+
+int bogomips_cmd(int argc, char *argv[])
+{
+	int i;
+	u32 start = timer_read();
+	u32 total;
+
+	for (i = 0; i < 100000; i++);
+	total = timer_read() - start;
+	printf("Total time: %ums\n", total * 1000 / timer_tps());
+	printf("Bogomips: %u\n", timer_tps() * 50 / total);
+
+	return 0;
+}
+
+char bogomips_help[] = "bogomips\n"
+"bogomips gives a Bogus, Meaningless, Indication of Processor\n"
+"Performance\n";
Index: build_tree/bootLoader/src/commands/call.c
diff -u /dev/null build_tree/bootLoader/src/commands/call.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/call.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,106 @@
+/*
+ * debug.c: Debugging command functions
+ *
+ * Copyright (C) 2001 Christopher Hoover <ch@hpl.hp.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: call.c,v 1.2 2002/02/17 20:01:31 erikm Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/serial.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+
+/*********************************************************************
+ * Call
+ *
+ * AUTHOR:		Christopher Hoover <ch@hpl.hp.com>
+ * REVISED:		seletz
+ *
+ * Jumps to an arbitrary address.
+ *
+ */
+int call_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32 adr, a = 0, b = 0, c = 0, d = 0;
+	int (*called_fn)(u32, u32, u32, u32);
+
+	if ( argc < 2  || argc > 6 )
+		ERR( -EINVAL );
+
+	ret = strtou32( argv[1], &adr );
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	if ( argc >= 3 ) {
+		ret = strtou32( argv[2], &a );
+		if ( ret < 0 )
+			ERR( -EINVAL );
+	}
+	if ( argc >= 4 ) {
+		ret = strtou32( argv[2], &b );
+		if ( ret < 0 )
+			ERR( -EINVAL );
+	}
+	if ( argc >= 5 ) {
+		ret = strtou32( argv[2], &c );
+		if ( ret < 0 )
+			ERR( -EINVAL );
+	}
+	if ( argc >= 6) {
+		ret = strtou32( argv[2], &d );
+		if ( ret < 0 )
+			ERR( -EINVAL );
+	}
+
+	dprintf( "calling function at 0x%08x ...\n", adr );
+	serial_flush_output();
+
+	called_fn = (int (*)(u32, u32, u32, u32))adr;
+
+	ret = called_fn(a, b, c, d);
+	
+	dprintf("return value: %d == 0x%04x\n", ret, ret);
+
+	ret = 0;
+
+DONE:
+	return ret;
+}
+
+char call_help[] = "call address [arg0 [arg1 [arg2 [arg3]]]]\n"
+"Call function at <address> with optional arguments\n";
Index: build_tree/bootLoader/src/commands/changebit.c
diff -u /dev/null build_tree/bootLoader/src/commands/changebit.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/changebit.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,104 @@
+/*
+ * debug.c: Debugging command functions
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: changebit.c,v 1.3 2003/04/03 14:40:51 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+#define MEM( x )        (*((u32 *)x))
+
+/*********************************************************************
+ * ChangeBit
+ *
+ * AUTOR:		SELETZ
+ * REVISED:
+ *
+ * Modifies bits of an given memory location
+ *
+ */
+int chgbit_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32 adr, value;
+
+	if ( argc < 4 )
+		ERR( -EINVAL );
+
+	ret = strtou32( argv[1], &adr );
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	ret = strtou32( argv[2], &value );
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	/* check memory alignment */
+	if(adr &= 0x03)
+		ERR(-EALIGN);
+
+	printf("0x%08x", MEM( adr ) );
+
+	switch ( argv[3][0] & (~0x20) ) {
+		case 'A':
+			MEM( adr ) &= value;
+			break;
+		case 'S':
+		case 'O':
+			MEM( adr ) |= value;
+			break;
+		case 'X':
+			MEM( adr ) ^= value;
+			break;
+		case 'C':
+			MEM( adr ) &= ~value;
+			break;
+		default:
+			ERR( -EINVAL );
+			break;
+	}
+
+	printf( " --> 0x%08x\n", MEM( adr ) );
+
+	ret = 0;
+
+DONE:
+	return ret;
+}
+
+char chgbit_help[] = "chgbit address value {and|or|xor|set|clear}\n";
Index: build_tree/bootLoader/src/commands/dlfile.c
diff -u /dev/null build_tree/bootLoader/src/commands/dlfile.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/dlfile.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,135 @@
+/*
+ * dlfile.c: command wrapper for xmodem/uuencode download to
+ *			 arbitary memory loc
+ *
+ * Copyright (C) 2002 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: dlfile.c,v 1.3 2003/04/03 14:40:55 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/uucodec.h>
+#include <blob/xmodem.h>
+#include <blob/md5.h>
+#include <blob/md5support.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+extern blob_status_t blob_status;
+
+/*********************************************************************
+ * dlfile
+ *
+ * AUTOR:	Stefan Eletzhofer
+ * REVISED:
+ *
+ * download a file to a memory location. Does also print a md5
+ * checksum of the downloaded data.
+ *
+ */
+int dlfile_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32 address, len;
+	u32 digest[4];
+
+	if ( argc < 3 )
+		ERR( -EINVAL );
+
+	ret = strtou32(argv[1], &address);
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	ret = strtou32(argv[2], &len);
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	dprintf("adr=0x%08x, len=0x%08x\n", address, len );
+
+#if defined(CONFIG_XMODEM_SUPPORT)
+	printf( "XMODEM download\n" );
+#else
+	printf( "UUENCODE download\n" );
+#endif
+
+	/* switch terminal speed if necessary */
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		SerialOutputString( "Switch to download speed, please.\n" );
+		SerialOutputString("You have 60 seconds to start downloading.\n");
+	
+		serial_init(blob_status.downloadSpeed);
+	} else {
+		SerialOutputString("You have 60 seconds to start downloading.\n");
+	}
+
+	/* download the data */
+#if defined(CONFIG_XMODEM_SUPPORT)
+	ret = XModemReceive( (char *)address, len );
+#else
+	ret = UUDecode((char *)address, len);
+#endif
+
+	if ( ret == len ) {
+		SerialOutputString("Received ");
+		SerialOutputDec(ret);
+		SerialOutputString(" (0x");
+		SerialOutputHex(ret);
+		SerialOutputString(") bytes.\n");
+		ret = 0;
+	} else {
+		SerialOutputString("error during download\n");
+	}
+
+
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		SerialOutputString("\n(Please switch your terminal emulator back to terminal speed\n");
+		serial_init(blob_status.terminalSpeed);
+	}
+
+	/* do a md5 sum of the downloaded data */
+	md5_buffer( (const char *)address, len, digest );
+	SerialOutputString("md5 checksum: ");
+	print_md5_digest(digest);
+	serial_write( '\n' );
+
+
+	ret = 0;
+DONE:
+	return ret;
+}
+
+char dlfile_help[] = "dlfile destination_address len\n\ndownload a file to memory\n";
Index: build_tree/bootLoader/src/commands/download.c
diff -u /dev/null build_tree/bootLoader/src/commands/download.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/download.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,124 @@
+/*-------------------------------------------------------------------------
+ * Filename:      download.c
+ * Version:       $Id: download.c,v 1.1 2003/09/04 17:47:00 russd Exp $
+ * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
+ * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
+ * Description:   xmodem download command
+ * Created at:    Mon Aug 23 20:00:00 1999
+ * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Modified at:   Sat Mar 25 14:31:16 2000
+ *-----------------------------------------------------------------------*/
+/*
+ * download.c: uucodec download command
+ *
+ * Copyright (C) 1999 2000 2001
+ *   Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl) and
+ *   Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: download.c,v 1.1 2003/09/04 17:47:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/download.h>
+#include <blob/command.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/md5.h>
+#include <blob/md5support.h>
+#include <blob/serial.h>
+#include <blob/uucodec.h>
+#include <blob/partition.h>
+
+
+int download_cmd(int argc, char *argv[])
+{
+	u32 startAddress;
+	int bufLen;
+	int *numRead;
+	int retval;
+	u32 *digest;
+
+	if(argc < 2)
+		return -ENOPARAMS;
+
+	retval = set_download_parameters(argv[1], &startAddress,
+					 &bufLen, &numRead, &digest);
+	if (retval < 0)
+		return 0;
+
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		printf("Switching to ");
+		PrintSerialSpeed(blob_status.downloadSpeed);
+		printf(" baud\n");
+
+		printf("You have 60 seconds to switch your terminal emulator to the same speed and\n");
+		printf("start downloading. After that " PACKAGE " will switch back to ");
+		PrintSerialSpeed(blob_status.terminalSpeed);
+		printf(" baud.\n");
+	
+		serial_init(blob_status.downloadSpeed);
+	} else {
+		printf("You have 60 seconds to start downloading.\n");
+	}
+
+	*numRead = UUDecode((char *)startAddress, bufLen);
+	
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		printf("\n(Please switch your terminal emulator back to ");
+		PrintSerialSpeed(blob_status.terminalSpeed);
+		printf(" baud)\n");
+	}
+
+	if(*numRead < 0) {
+
+		/* something went wrong */
+		retval = *numRead;
+		
+		/* reload the correct memory */
+		do_reload(argv[1]);
+
+		serial_init(blob_status.terminalSpeed);
+		return retval;
+	}
+
+	do_md5sum((u32 *)startAddress, *numRead, digest);
+
+	printf("Received %i (0x%08x) bytes", *numRead, *numRead);
+#ifdef BLOB_DEBUG
+	printf("at 0x%08x", (unsigned int)startAddress);
+#ifdef CONFIG_MD5_SUPPORT
+	printf(", MD5: ");
+	print_md5_digest(digest);
+#endif
+#endif
+	printf("\n");
+
+
+	serial_init(blob_status.terminalSpeed);
+
+	return 0;
+}
+
+static char download_help[] = "download {blob|param|kernel|ramdisk}\n"
+"Download <argument> image to RAM using uuencode\n";
+
+
+
Index: build_tree/bootLoader/src/commands/dummy.c
diff -u /dev/null build_tree/bootLoader/src/commands/dummy.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/dummy.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,55 @@
+/*
+ * dummy.c: Dummy command that only shows how things work
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ *
+ * $Id: dummy.c,v 1.2 2002/02/17 20:01:31 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: dummy.c,v 1.2 2002/02/17 20:01:31 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/util.h>
+
+
+
+
+int dummy_cmd(int argc, char *argv[])
+{
+	int i;
+
+	for(i = 0; i < argc; i++)
+		printf("argv[%d] = '%s'\n", i, argv[i]);
+
+	return 0;
+}
+
+char dummy_help[] = "dummy\n"
+"Dummy command that only shows all arguments and returns\n";
+
+
+/*
+ * To use this command, just add this line somewhere in the
+ * application (src/blob/commands, for example):
+ *
+ *   __commandlist(dummy_cmd, "dummy", dummy_help);
+ *
+ */
Index: build_tree/bootLoader/src/commands/dump.c
diff -u /dev/null build_tree/bootLoader/src/commands/dump.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/dump.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,104 @@
+/*
+ * dump.c: hexdump command
+ *
+ * Copyright (C) 2001 Tim Riker <tim@rikers.org>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: dump.c,v 1.3 2002/04/26 18:14:01 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/serial.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+/*********************************************************************
+ * dump
+ *
+ * AUTHOR: Tim Riker
+ * REVISED: seletz
+ *
+ * dumps memory
+ *
+ */
+int dump_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	static u32 address = 0L;
+	u32 endaddress, tmpaddress, value;
+
+	if ( argc < 1 )
+		ERR( -EINVAL );
+
+	if ( argc > 1 ) {
+		ret = strtou32(argv[1], &address);
+		if ( ret < 0 )
+			ERR( -EINVAL );
+	}
+
+	if ( argc == 3 ) {
+		ret = strtou32(argv[2], &endaddress);
+		if ( ret < 0 )
+			ERR( -EINVAL );
+	} else
+		endaddress = address + 0x80;
+
+
+	/* check alignment of address and endaddress */
+	if((address & 0x03) || (endaddress & 0x03))
+		ERR(-EALIGN);
+
+	/* print it */
+	for ( ; address < endaddress; address += 0x10) {
+		printf( "0x%08x: ", address );
+		for (tmpaddress = address; tmpaddress < address + 0x10; tmpaddress += 4) {
+			value = (*((u32 *)tmpaddress));
+			printf( "0x%08x ", value );
+		}
+		for (tmpaddress = address; tmpaddress < address + 0x10; tmpaddress++) {
+			value = (*((u8 *)tmpaddress)) & 0xff;
+			if ((value >= ' ') && (value <= '~'))
+				serial_write(value);
+			else
+				serial_write('.');
+		}
+		serial_write('\n');
+	}
+
+	ret = 0;
+
+DONE:
+	return ret;
+}
+
+char dump_help[] = "dump [address [endAddress]]\n";
Index: build_tree/bootLoader/src/commands/ferase.c
diff -u /dev/null build_tree/bootLoader/src/commands/ferase.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/ferase.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,85 @@
+/*
+ * ferase.c: command wrapper for erasing arbitary flash
+ *			regions
+ *
+ * Copyright (C) 2002 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: ferase.c,v 1.3 2003/04/03 14:40:55 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/flash.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+
+/*********************************************************************
+ * ferase_cmd
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash erase
+ *
+ */
+int ferase_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 3 )				ERR( -EINVAL );
+
+	ret = strtou32( argv[1], &dest );
+	if ( ret < 0 )				ERR( -EINVAL );
+
+	ret = strtou32( argv[2], &len );
+	if ( ret < 0 )				ERR( -EINVAL );
+
+	if ( len & (0x3) ) {
+		len = (len>>2)  + 1;
+	} else {
+		len = len>>2;
+	}
+
+	printf( "start=0x%08x, len=0x%08x words\n", dest, len );
+
+	ret = flash_erase_region( (u32 *)dest, len );
+DONE:
+	return ret;
+}
+char ferase_help[] = "ferase destadr size(bytes)\n"
+"flash a memory region\n";
Index: build_tree/bootLoader/src/commands/fwrite.c
diff -u /dev/null build_tree/bootLoader/src/commands/fwrite.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/fwrite.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,87 @@
+/*
+ * fwrite.c: command wrapper for writing arbitary flash
+ *			regions
+ *
+ * Copyright (C) 2002 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: fwrite.c,v 1.2 2003/04/03 14:40:56 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/flash.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+
+/*********************************************************************
+ * fwrite_cmd
+ *
+ * AUTOR:	SELETZ
+ * REVISED:
+ *
+ * Command wrapper for low-level flash write access
+ *
+ */
+int fwrite_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32	src	= 0L;
+	u32	dest	= 0L;
+	u32	len	= 0L;
+
+	if ( argc < 4 )				ERR( -EINVAL );
+
+	ret = strtou32( argv[1], &src );
+	if ( ret < 0 )				ERR( -EINVAL );
+
+	ret = strtou32( argv[2], &dest );
+	if ( ret < 0 )				ERR( -EINVAL );
+
+	ret = strtou32( argv[3], &len );
+	if ( ret < 0 )				ERR( -EINVAL );
+
+	if ( len & (0x3) ) {
+		len = (len>>2)  + 1;
+	} else {
+		len = len>>2;
+	}
+
+	ret = flash_write_region( (u32 *)dest, (u32*)src, len );
+DONE:
+	return ret;
+}
+char fwrite_help[] = "fwrite srcadr destadr size(bytes)\n"
+"flash a memory region\n";
Index: build_tree/bootLoader/src/commands/make_commands.sh
diff -u /dev/null build_tree/bootLoader/src/commands/make_commands.sh:1.5
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/make_commands.sh	Thu Nov 15 10:25:51 2007
@@ -0,0 +1,47 @@
+#! /bin/sh
+#
+# make_commands.sh: generate commandlist code
+#
+# Copyright (C) 2002 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+#
+# $Id: make_commands.sh,v 1.1 2002/02/17 20:01:31 erikm Exp $
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+
+cat <<EOF
+/*
+ * WARNING:
+ * This file was generated by make_commands.sh. All changes to this file
+ * will be automatically overwritten once you rerun make_commands.sh. Do
+ * not try to check this file into CVS: generated files do not belong in
+ * CVS repositories.
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/command.h>
+
+EOF
+
+for i in $* ; do 
+    cat <<EOF
+extern int ${i}_cmd(int argc, char *argv[]);
+extern char ${i}_help[];
+__commandlist(${i}_cmd, "${i}", ${i}_help);
+
+EOF
+done
Index: build_tree/bootLoader/src/commands/md5chk.c
diff -u /dev/null build_tree/bootLoader/src/commands/md5chk.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/md5chk.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,90 @@
+/*
+ * md5chk.c: command wrapper for md5 checks
+ *
+ * Copyright (C) 2002 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: md5chk.c,v 1.4 2003/04/03 14:40:57 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+
+#include <blob/md5.h>
+#include <blob/md5support.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+
+/*********************************************************************
+ * md5chk
+ *
+ * AUTOR:	Stefan Eletzhofer
+ * REVISED:
+ *
+ * calculate md5 hash of a memory region
+ *
+ */
+int md5chk_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32 address, len;
+	u32 digest[4];
+
+	if ( argc < 3 )
+		ERR( -EINVAL );
+
+	ret = strtou32(argv[1], &address);
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	ret = strtou32(argv[2], &len);
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	dprintf("adr=0x%08x, len=0x%08x\n",
+		address, len );
+
+	md5_buffer( (const char *)address, len, digest );
+
+	print_md5_digest(digest);
+	serial_write( '\n' );
+
+
+	ret = 0;
+DONE:
+	return ret;
+}
+
+char md5chk_help[] = "md5chk adress len\n\ncalculate md5 hash value\n";
Index: build_tree/bootLoader/src/commands/memcpy.c
diff -u /dev/null build_tree/bootLoader/src/commands/memcpy.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/memcpy.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,103 @@
+/*
+ * memcpy.c: copy memory command
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: memcpy.c,v 1.3 2003/04/03 14:40:57 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+
+/**********************************************************************
+ * prototypes
+ */
+
+/*********************************************************************
+ * CmdMemcpy
+ *
+ * AUTOR:		SELETZ
+ * REVISED:
+ *
+ * Command wrapper for memcpy utility function.
+ *
+ */
+int memcpy_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32 src, dest, len;
+
+	if ( argc < 4 )
+		ERR( -EINVAL );
+
+	ret = strtou32( argv[1], &src );
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	ret = strtou32( argv[2], &dest );
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	ret = strtou32( argv[3], &len );
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	/* check alignment of src and dest */
+	if((src & 0x03) || (dest & 0x03))
+		ERR(-EALIGN);
+
+	/* counted in words */
+	if ( len & 0x00000003 ) {
+		len = ( len >> 2 ) + 1;
+	} else {
+		len = len >> 2;
+	}
+
+	dprintf("src=0x%08x, dest=0x%08x, %d words\n", src, dest, len );
+
+	MyMemCpy( (u32 *)dest, (const u32 *)src, len);
+
+	printf("%d words copied.\n", len );
+
+	ret = 0;
+
+DONE:
+	return ret;
+}
+
+char memcpy_help[] = "memcpy src dst len\n"
+"copy len bytes from src to dst\n";
Index: build_tree/bootLoader/src/commands/peek.c
diff -u /dev/null build_tree/bootLoader/src/commands/peek.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/peek.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,128 @@
+/*
+ * debug.c: Debugging command functions
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: peek.c,v 1.3 2003/04/03 14:40:58 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+/*********************************************************************
+ * Peek
+ *
+ * AUTHOR:	Stefan Eletzhofer
+ * REVISED:
+ *
+ * Peeks values from memory
+ *
+ */
+int peek_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32 address, value;
+	char type = 'w';
+
+	if ( argc < 2 )
+		ERR( -EINVAL );
+
+	ret = strtou32(argv[1], &address);
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	if ( argc >= 2 )
+		type = argv[2][0];
+	
+
+	dprintf("adr=0x%08x, type=%c\n", address, type);
+
+	/* check memory alignment */
+	switch(type | 0x20) {
+	case 'b':
+		/* bytes don't have alignment restrictions */
+		break;
+
+	case 'h':
+		/* half word accesses should be aligned on half words */
+		if(address & 0x01)
+			ERR(-EALIGN);
+
+		break;
+
+	case 'w':
+		/* word accesses should be aligned on word boundaries */
+		if(address & 0x03)
+			ERR(-EALIGN);
+		
+		break;
+
+	default:
+		/* hmm, invalid type */
+		ERR( -EINVAL );
+		break;
+	}
+
+	/* read value from memory */
+	switch( type | 0x20 ) {
+	case 'b':
+		value = (*((u8 *)address)) & 0xff;
+		break;
+
+	case 'h':
+		value = (*((u16 *)address))& 0xffff;
+		break;
+
+	case 'w':
+		value = (*((u32 *)address));
+		break;
+
+	default:
+		/* this should not happen */
+		ERR(-EINVAL);
+		break;
+	}
+
+	printf("%c 0x%08x\n", type, value );
+
+	ret = 0;
+
+DONE:
+	return ret;
+}
+
+char peek_help[] = "peek address [b|h|w]\n"
+"b = byte, h = half word, w = word (default is w)\n";
Index: build_tree/bootLoader/src/commands/poke.c
diff -u /dev/null build_tree/bootLoader/src/commands/poke.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/poke.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,131 @@
+/*
+ * poke.c: poke command
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: poke.c,v 1.3 2003/04/03 14:40:58 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+
+/*********************************************************************
+ * Poke
+ *
+ * AUTOR:	Stefan Eletzhofer
+ * REVISED:
+ *
+ * Poke values to memory
+ *
+ */
+int poke_cmd( int argc, char *argv[] )
+{
+	int ret = 0;
+	u32 address, value;
+	char type = 'w';
+
+	if ( argc < 3 )
+		ERR( -EINVAL );
+
+	ret = strtou32(argv[1], &address);
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	ret = strtou32(argv[2], &value);
+	if ( ret < 0 )
+		ERR( -EINVAL );
+
+	if ( argc >= 3 )
+		type = argv[3][0];
+
+	dprintf("adr=0x%08x, val=0x%08x, type=%c\n",
+		address, value, type );
+
+	/* check memory alignment */
+	switch(type | 0x20) {
+	case 'b':
+		/* bytes don't have alignment restrictions */
+		break;
+
+	case 'h':
+		/* half word accesses should be aligned on half words */
+		if(address & 0x01)
+			ERR(-EALIGN);
+
+		break;
+
+	case 'w':
+		/* word accesses should be aligned on word boundaries */
+		if(address & 0x03)
+			ERR(-EALIGN);
+		
+		break;
+
+	default:
+		/* hmm, invalid type */
+		ERR( -EINVAL );
+		break;
+	}
+
+	/* write the value to memory */
+	switch( type | 0x20 ) {
+	case 'b':
+		*((u8 *)address) = (u8)(value & 0xff);
+		break;
+
+	case 'h':
+		*((u16 *)address) = (u16)(value & 0xffff);
+		break;
+
+	case 'w':
+		*((u32 *)address) = value;
+		break;
+
+	default:
+		/* this should not happen */
+		ERR( -EINVAL );
+		break;
+	}
+
+	ret = 0;
+
+DONE:
+	return ret;
+}
+
+char poke_help[] = "poke address value [b|h|w]\n"
+"b = byte, h = half word, w = word (default is w)\n";
Index: build_tree/bootLoader/src/commands/reboot.c
diff -u /dev/null build_tree/bootLoader/src/commands/reboot.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/reboot.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,49 @@
+/*
+ * reboot.c: Reboot board
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: reboot.c,v 1.3 2003/02/11 00:02:48 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: reboot.c,v 1.3 2003/02/11 00:02:48 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/serial.h>
+#include <blob/reboot.h>
+#include <blob/util.h>
+
+
+
+
+int reboot_cmd(int argc, char *argv[])
+{
+	printf("Rebooting...\n\n");
+	serial_flush_output();
+	
+	reboot_system();
+
+	/* never reached, but anyway... */
+	return 0;
+}
+
+char reboot_help[] = "reboot\n"
+"Reboot system\n";
Index: build_tree/bootLoader/src/commands/setip.c
diff -u /dev/null build_tree/bootLoader/src/commands/setip.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/setip.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,121 @@
+/*
+ * setip.c: set client/server IP
+ *
+ * Client and server IP are used for TFTP downloads.
+ *
+ * Copyright (C) 2003 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: setip.c,v 1.3 2003/08/21 00:28:03 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#if defined( CONFIG_NETWORK_SUPPORT ) 
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+#include <net/net.h>
+
+/**********************************************************************
+ * defines
+ */
+#undef SETIP_DEBUG
+#ifdef SETIP_DEBUG
+static int dbg = 1;
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... )
+#endif
+
+/**********************************************************************
+ * command
+ */
+int setip_cmd( int argc, char *argv[] )
+{
+	u8 *ip;
+	char *ptr, *num;
+	int i, fini;
+
+	if ( argc < 3 ) {
+		printf("Our server IP : %d.%d.%d.%d \n",
+			serveripaddress[0], serveripaddress[1], 
+			serveripaddress[2], serveripaddress[3] );
+		printf("Our client IP : %d.%d.%d.%d \n",
+			clientipaddress[0], clientipaddress[1], 
+			clientipaddress[2], clientipaddress[3] );
+		return 0;
+	}
+
+	switch ( argv[1][0] ) {
+		case 'c':
+		case 'C':
+			ip = clientipaddress;
+			break;
+		case 's':
+		case 'S':
+			ip = serveripaddress;
+			break;
+		default:
+			return -EINVAL;
+			break;
+	}
+
+	num = ptr = argv[2];
+	fini=0;
+	for ( i=0; i<4 || !fini; i++ ) {
+		u32 n;
+
+		while ( *ptr != '\0' && *ptr != '.' )
+			ptr++;
+
+		if ( *ptr == '\0' )
+			fini = 1;
+
+		*ptr = 0;
+
+		strtou32( num, &n );
+		ip[i]=n;
+
+		num = ++ptr;
+	}
+
+	if ( fini && i<4 ) {
+		printf( "error parsing ip.\n" );
+		return -EINVAL;
+	}
+
+	printf( "Set IP to %d.%d.%d.%d\n",
+			ip[0], ip[1], ip[2], ip[3] );
+
+	return 0;
+}
+char setip_help[] = "setip command. Set IP addresses for tftp.\n"
+"usage: setip {client|server} ip\n"
+"\tip in usual dotted-quad format please.\n";;
+
+#endif
+
Index: build_tree/bootLoader/src/commands/sysupd.c
diff -u /dev/null build_tree/bootLoader/src/commands/sysupd.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/sysupd.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,182 @@
+/*
+ * sysupd.c: system update from CF/RAM card
+ *
+ * Update a board's firmware from a tar file located on a CF memory
+ * card or in RAM.
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: sysupd.c,v 1.4 2003/08/21 12:48:05 seletz Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#if defined( CONFIG_GIO_SUPPORT ) 
+
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+#include <blob/generic_io.h>
+
+#include <blob/pcmcia.h>
+#include <blob/cf.h>
+#include <blob/ide.h>
+#include <blob/tar.h>
+
+/* FIXME: make this arch indep. */
+/* these are the default images */
+static char *update_files[] = {
+	"blob",
+	"config.tar",
+	"zImage",
+	"initrd.gz",
+	"cramfs",
+	"data.img",
+	"xdata.img"
+};
+
+
+/**********************************************************************
+ * defines
+ */
+#undef SYSUPD_DEBUG
+#ifdef SYSUPD_DEBUG
+static int dbg = 1;
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... )
+#endif
+
+/**********************************************************************
+ * sysupd - update complete system. Flashes
+ * 			blob, config, kernel, initrd and cramfs images.
+ */
+
+/* update_umage - Read image "image" from TAR io driver and flash it
+ * into a BLOB partition
+ */
+int update_image( char *image )
+{
+	int ret;
+
+	if ( !image )
+		return -EINVAL;
+
+	/* select tar file */
+	ret = io_configure( "TAR", image );
+	if ( ret ) {
+		printf( "sysupd: can't find image '%s'. Skipping.\n", image );
+		return -EINVAL;
+	}
+
+	/* select partition */
+	ret = io_configure( "BLOB_PART", image );
+	if ( ret ) {
+		printf( "sysupd: can't find flash partition '%s'. Skipping.\n", image );
+		return -EINVAL;
+	}
+
+#if !defined(SYSUPD_DUMMY_COPY)
+	/* flash tha image, man! */
+	ret = io_copy( "BLOB_PART", "TAR", 0 );
+	if ( ret ) {
+		/* ouch! */
+		printf( "sysupd: error updating image %s (%d).\n", image, ret );
+		return ret;
+	}
+#else
+	DBG( 1, "%s: io_copy( BLOB_PART, TAR, 0 )\n", __FUNCTION__ );
+#endif
+
+	return 0;
+}
+
+int sysupd_cmd( int argc, char *argv[] )
+{
+	int ret;
+	char **images = NULL;
+	int nimages = sizeof(update_files)/sizeof(char *);
+	int i=0;
+	char *source = "CF";
+
+	argv++;
+
+	/* source io param */
+	if ( argc>1 ) {
+		source = *argv;
+		argv++;
+		argc--;
+	}
+	
+	/* image list */
+	if ( argc>1 ) {
+		nimages = argc -1;
+		images = &argv[0];
+	} else {
+		images = update_files;
+	}
+
+	/* configure CF card if CF is source */
+	if ( strncmp( source, "CF", 2 ) == 0 ) {
+		/* CF card is on slot 1 */
+		ret = io_configure( "CF", (void *)1 );
+		if ( ret ) {
+			printf( "io_configure() error %d\n", ret );
+			return -EINVAL;
+		}
+	}
+
+	/* write chain: --->blob partition->flash */
+	ret = io_chain_driver( "BLOB_PART", "FLASH" );
+	if ( ret ) {
+		DBG( 1, "%s: io_chain_driver() = %d.", __FUNCTION__, ret );
+		return ret;
+	}
+
+	/* read chain: <---TAR<--source(CF or RAM) */
+	ret = io_chain_driver( "TAR", source );
+	if ( ret ) {
+		DBG( 1, "%s: io_chain_driver( TAR, %s ) = %d.", __FUNCTION__, source, ret );
+		return ret;
+	}
+
+	/* update all images in list */
+	for ( i=0; i<nimages; i++ ) {
+		DBG( 1, "images[%d]=%s\n", i, images[i] );
+		ret = update_image( images[i] );
+		if ( ret == 0 ) 
+			printf( "sysupd: flashed image '%s'\n", images[i] );
+		DBG( 1, "i=%d\n", i );
+	}
+
+	return 0;
+}
+char sysupd_help[] = "sysupd [CF|RAM] [image [image]...]\n\nUpdate board firmware from CF card or RAM.\n"
+	"You have to have a update CF card inserted (for CF updates) _or_ uploaded a\n"
+	"update image to ram.";
+
+#endif
+
Index: build_tree/bootLoader/src/commands/tdownload.c
diff -u /dev/null build_tree/bootLoader/src/commands/tdownload.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/tdownload.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,91 @@
+/*
+ * tdownload.c: tftp download command (ala download and xdownload)
+ *
+ * Copyright (C) 2003 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ * Copyright (C) 2003 Russ Dill <Russ.Dill@asu.edu>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: tdownload.c,v 1.1 2003/09/04 17:47:00 russd Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/download.h>
+#include <blob/util.h>
+
+#include <net/net.h>
+
+extern int do_tftp(char *file, unsigned long addr, unsigned long *size);
+
+/**********************************************************************
+ * defines
+ */
+#undef TFTP_DEBUG
+#ifdef TFTP_DEBUG
+static int dbg = 1;
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... )
+#endif
+
+/**********************************************************************
+ * command
+ */
+int tdownload_cmd(int argc, char *argv[])
+{
+	int ret = 0;
+	int size = 0;
+	char *tftp_file;
+	u32 base, *digest;
+	int *numread;
+
+	if (argc < 2) argv[1] = "blob";
+	if (argc > 2) tftp_file = argv[2];	
+	else tftp_file = argv[1];
+
+	ret = set_download_parameters(argv[1], &base,
+		&size, &numread, &digest);
+	if (ret < 0) return 0;
+
+	ret = do_tftp(tftp_file, base, (unsigned long *) &size);
+	if (ret < 0) {
+		do_reload(argv[1]);
+		return -EINVAL;
+	}
+	*numread = size;
+	do_md5sum((u32 *)base, size, digest);
+
+	printf( "%s: file '%s' loaded via tftp to address 0x%08x.\n",
+			__FUNCTION__, tftp_file, base);
+	return 0;
+}
+char tdownload_help[] = "tdownload command.\n"
+"usage: tdownload {blob|param|kernel|ramdisk} [filename]\n"
+"\tdownloads file over TFTP to RAM.\n"
+"\tUse setip or bootp to set client and server IP addresses\n";
+
+
Index: build_tree/bootLoader/src/commands/terminal.c
diff -u /dev/null build_tree/bootLoader/src/commands/terminal.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/terminal.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,59 @@
+/*
+ * terminal.c: terminal reset functions
+ *
+ * Copyright (C) 1999 2000 2001 2002  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: terminal.c,v 1.1 2002/02/17 19:54:47 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: terminal.c,v 1.1 2002/02/17 19:54:47 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/serial.h>
+#include <blob/util.h>
+
+
+
+int reset_cmd(int argc, char *argv[])
+{
+	int i;
+
+	serial_flush_output();
+
+	printf("c");
+
+	serial_flush_output();
+
+	for(i = 0; i < 100; i++)
+		serial_write('\n');
+
+	serial_flush_output();
+
+	printf("c");
+
+	serial_flush_output();
+	serial_flush_input();
+
+	return 0;
+}
+
+char reset_help[] = "reset\n"
+"Reset terminal\n";
Index: build_tree/bootLoader/src/commands/tftp.c
diff -u /dev/null build_tree/bootLoader/src/commands/tftp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/tftp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,106 @@
+/*
+ * tftp.c: tftp download command
+ *
+ * Copyright (C) 2003 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: tftp.c,v 1.5 2003/09/04 01:10:23 russd Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <blob/types.h>
+#include <blob/util.h>
+
+#include <net/net.h>
+
+
+#if !defined( TFTP_RAM_START ) 
+# warning "Please define TFTP_RAM_START for your arch!, tftp command inoperable"
+#define TFTP_RAM_START 0xdeadbeef
+#endif
+
+/**********************************************************************
+ * defines
+ */
+#undef TFTP_DEBUG
+#ifdef TFTP_DEBUG
+static int dbg = 1;
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... )
+#endif
+
+/*********************************************************************
+ * usage
+ */
+char tftp_help[] = "tftp command.\n"
+"usage: tftp filename [--kernel | --ramdisk]\n"
+"\tdownloads file over TFTP to RAM.\n"
+"\tUse setip to set client and server IP addresses\n";
+
+/**********************************************************************
+ * command
+ */
+int tftp_cmd(int argc, char *argv[])
+{
+	int ret = 0;
+	extern int do_tftp(char *file, unsigned long addr, unsigned long *size);
+	unsigned long addr = TFTP_RAM_START;
+	unsigned long size = 0;
+	char *tftp_file = "update.tar";
+
+	if (TFTP_RAM_START == 0xdeadbeff) return -EINVAL;
+
+	if ( argc>1 ) {
+		tftp_file = argv[1];
+
+		/* options */
+		if ( argc>2 ) {
+			if ( !strncmp("--kernel", argv[2], 8) )
+				addr = KERNEL_RAM_BASE;
+			else if ( !strncmp("--ramdisk", argv[2], 9) )
+				addr = RAMDISK_RAM_BASE;
+			else {
+				printf("TFTP: unknown option '%s'", argv[2]);
+			}
+		}
+	} else {
+		printf("%s", tftp_help);
+		return 0;
+	}
+
+	ret = do_tftp( tftp_file, addr , &size );
+	if ( ret ) {
+		return -EINVAL;
+	}
+
+	printf( "%s: file '%s' loaded via tftp to address 0x%08x.\n",
+			__FUNCTION__, tftp_file, addr );
+	return 0;
+}
+
+
Index: build_tree/bootLoader/src/commands/usb_serial_download.c
diff -u /dev/null build_tree/bootLoader/src/commands/usb_serial_download.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/usb_serial_download.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,193 @@
+/*
+ * usb_serial_download.c: serial over usb download command
+ *
+ * Copyright (c) 2004, Intel Corporation (alek.du@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: usb_serial_download.c,v 1.6 2004/09/07 02:44:16 bvd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/download.h>
+#include <blob/command.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/md5.h>
+#include <blob/md5support.h>
+#include <blob/serial_usb.h>
+#include <blob/partition.h>
+
+#ifdef CONFIG_MD5_SUPPORT
+#define MD5TAG	"md5:\r"
+#define MD5SIZE	16
+#endif
+
+#define STARTAG "start"
+#define ENDTAG "end\r"
+#define EXITAG "exit"
+#define ACKTAG "ACK\r"
+#define NAKTAG "NAK\r"
+#define COMMANDSIZE 64
+
+#define strsizeof(x) (sizeof(x)-1)
+
+/* receive a image file to dedicated memory address
+    support md5 check now, if you send image as this
+    |data of packet1|16 bytes md5 digest|md5:\r|
+    |data of packet2|16 bytes md5 digest|md5:\r| 
+    			...
+    |data of packetn|16 bytes md5 digest|md5:\r|
+			....
+*/
+
+int UsbSerialReceive(char *addr,int len)
+{
+	int size,total=0;// for image size 
+	int lastsize=0;// for progress bar				
+	int packsize=0;//current packsize
+	char command[COMMANDSIZE+1];// keep received command
+	int comlen=0;// current command len
+
+	while(1){
+		comlen=0;
+		while(comlen<COMMANDSIZE){
+			size=usb_serial_read(command+comlen,COMMANDSIZE-comlen);
+			if (size){
+				comlen+=size;
+				command[comlen]='\0';
+				if (command[comlen-1]=='\r'){
+					comlen--;
+					command[comlen]='\0';
+					break;
+				}
+				else printf("%s",command+comlen-size);
+			}
+		}
+		printf("\ncurrent command:(%s)\n",command);	
+		
+		if (comlen==strsizeof(STARTAG) && !strncmp(command,STARTAG, strsizeof(STARTAG))){
+			usb_serial_write(ACKTAG,strsizeof(ACKTAG));
+			printf("start to receive binary images\n");
+			printf("please send 'end\\r' as finish tag\n");//fix me: hope no end\\r in image file
+			total=lastsize=packsize=0;
+			while (total+packsize<len){
+#ifdef CONFIG_MD5_SUPPORT				
+				u32 md5_count[MD5SIZE/4];
+#endif				
+				size=usb_serial_read(addr+total+packsize,len-(total+packsize));
+				if (size){
+					packsize+=size;
+					if (packsize-lastsize>=65535)
+						lastsize=packsize,printf(".");
+					if (*(addr+total+packsize-1)=='\r'){
+#ifdef CONFIG_MD5_SUPPORT						
+						if (packsize>=MD5SIZE+strsizeof(MD5TAG)&& !strncmp(addr+total+packsize-strsizeof(MD5TAG),MD5TAG,strsizeof(MD5TAG))){
+							printf("*");
+							md5_buffer(addr+total,packsize-(MD5SIZE+strsizeof(MD5TAG)),md5_count);//md5
+							if (!memcmp(addr+total+packsize-(MD5SIZE+strsizeof(MD5TAG)),md5_count,MD5SIZE)){//md5 right
+								total+=packsize-(MD5SIZE+strsizeof(MD5TAG));													
+								usb_serial_write(ACKTAG,strsizeof(ACKTAG));
+							}
+							else {
+								printf("x");
+								usb_serial_write(NAKTAG,strsizeof(NAKTAG));
+							}
+							packsize=lastsize=0;
+						}
+						else 
+#endif							
+						if (packsize>=strsizeof(ENDTAG)&& !strncmp(addr+total+packsize-strsizeof(ENDTAG),ENDTAG,strsizeof(ENDTAG))){
+							total+=packsize-strsizeof(ENDTAG);//last packet no MD5? or all data just in one packet and without md5
+							usb_serial_write(ACKTAG,strsizeof(ACKTAG));
+							break;
+						}
+					}
+				}
+			}
+			printf("end tag received, total (%d) bytes got\n",total);
+		}		
+		else if (comlen==strsizeof(EXITAG) && !strncmp(command,EXITAG, strsizeof(EXITAG))){
+			usb_serial_write(ACKTAG,strsizeof(ACKTAG));
+			printf("exit tag received, total (%d) bytes got finially\n",total);
+			break;
+		}
+		else {
+			usb_serial_write(NAKTAG,strsizeof(NAKTAG));
+			printf("Unknown command.\n");
+		}
+	}
+	return total;
+}
+
+int udownload_cmd(int argc, char *argv[])
+{
+	u32 startAddress;
+	int bufLen;
+	int *numRead;
+	int retval;
+	u32 *digest;
+	static int firstin=1;
+	
+	if(argc < 2)
+		return -ENOPARAMS;
+
+	retval = set_download_parameters(argv[1], &startAddress,
+					 &bufLen, &numRead, &digest);
+	if (retval < 0)
+		return 0;
+
+	printf("Entering serial over usb commandline... \n");
+	printf("App protocol:\n"
+		"APP                     BLOB\n"
+		"start\\r   -------->            \n"
+		"               <--------ACK\\r \n"
+		"binary image ------->        \n"
+		"end\\r  --------->             \n"
+		"               <--------ACK\\r \n"
+		"exit\\t ---------->            \n"
+		"               <--------ACK\\r \n"
+		"\n"
+		"\n"
+		"App first send start\\r to request to start transfer image \n"
+		"after receive \"ACK\\r\" from BLOB then app send binary image.\n"
+		"App send end\\r to indicate end of image.\n"
+		"Also BLOB will send \"ACK\\r\" to App.\n"
+		"App send exit\\r to leave udownload. \n");
+
+	if (firstin){
+		usb_serial_init();
+		firstin=0;
+	}
+	//max 16M
+	bufLen=0x1000000;
+#ifdef CONFIG_MD5_SUPPORT
+	bufLen+=MD5SIZE+strsizeof(MD5TAG);
+#endif
+	*numRead = UsbSerialReceive((char *) startAddress, bufLen);
+
+	printf("Received %i (0x%08x) bytes ", *numRead, *numRead);
+	printf("at 0x%08x\n", (unsigned int)startAddress);
+	return 0;
+}
+
+char udownload_help[] = "udownload {blob|param|kernel|ramdisk}\n"
+"Download <argument> image to RAM using serial over usb\n";
+
+
Index: build_tree/bootLoader/src/commands/xdownload.c
diff -u /dev/null build_tree/bootLoader/src/commands/xdownload.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/commands/xdownload.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,127 @@
+/*-------------------------------------------------------------------------
+ * Filename:      xdownload.c
+ * Version:       $Id: xdownload.c,v 1.1 2003/09/04 17:47:00 russd Exp $
+ * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
+ * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
+ * Description:   xmodem download command
+ * Created at:    Mon Aug 23 20:00:00 1999
+ * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Modified at:   Sat Mar 25 14:31:16 2000
+ *-----------------------------------------------------------------------*/
+/*
+ * xmodem.c: xmodem download command
+ *
+ * Copyright (C) 1999 2000 2001
+ *   Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl) and
+ *   Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: xdownload.c,v 1.1 2003/09/04 17:47:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/download.h>
+#include <blob/command.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/md5.h>
+#include <blob/md5support.h>
+#include <blob/serial.h>
+#include <blob/xmodem.h>
+#include <blob/partition.h>
+
+
+int xdownload_cmd(int argc, char *argv[])
+{
+	u32 startAddress;
+	int bufLen;
+	int *numRead;
+	int retval;
+	u32 *digest;
+
+	if(argc < 2)
+		return -ENOPARAMS;
+
+	retval = set_download_parameters(argv[1], &startAddress,
+					 &bufLen, &numRead, &digest);
+	if (retval < 0)
+		return 0;
+
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		printf("Switching to ");
+		PrintSerialSpeed(blob_status.downloadSpeed);
+		printf(" baud\n");
+
+		printf("Switch your terminal emulator to the same speed and\n");
+		printf("start sending using the XMODEM protocol (repeated ^X) to quit.\n");
+		printf(PACKAGE " will switch back to ");
+		PrintSerialSpeed(blob_status.terminalSpeed);
+		printf(" baud after XMODEM succeeds or times out.\n");
+	
+		serial_init(blob_status.downloadSpeed);
+	} else {
+		printf("Start sending using the XMODEM protocol (repeated ^X to quit).\n\n");
+	}
+
+	*numRead = XModemReceive((char *) startAddress, bufLen);
+
+	/* There is a race condition somewhere...  We need this delay */
+	/* else the report is not printed out. TomW 4/30/2002 */
+	msleep(100);
+
+	printf("\n\n");
+	serial_flush_output();
+	
+	if (blob_status.terminalSpeed != blob_status.downloadSpeed) {
+		printf("\n(Please switch your terminal emulator back to ");
+		PrintSerialSpeed(blob_status.terminalSpeed);
+		printf(" baud)\n");
+	}
+	
+	if(*numRead < 0) {
+		/* something went wrong */
+		retval = *numRead;
+		
+		/* reload the correct memory */
+		do_reload(argv[1]);
+
+		serial_init(blob_status.terminalSpeed);
+		return retval;
+	}
+
+	do_md5sum((u32 *)startAddress, *numRead, digest);
+
+	printf("Received %i (0x%08x) bytes", *numRead, *numRead);
+	printf("at 0x%08x", (unsigned int)startAddress);
+#ifdef CONFIG_MD5_SUPPORT
+	printf(", MD5: ");
+	print_md5_digest(digest);
+#endif
+	printf("\n");
+
+
+	serial_init(blob_status.terminalSpeed);
+
+	return 0;
+}
+
+char xdownload_help[] = "xdownload {blob|param|kernel|ramdisk}\n"
+"Download <argument> image to RAM using xmodem\n";
+
Index: build_tree/bootLoader/src/diag/.cvsignore
diff -u /dev/null build_tree/bootLoader/src/diag/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,8 @@
+Makefile.in
+Makefile
+commands.c
+diag
+diag-elf32
+*.o
+.deps
+*.map
Index: build_tree/bootLoader/src/diag/Makefile.am
diff -u build_tree/bootLoader/src/diag/Makefile.am:1.1.1.1 build_tree/bootLoader/src/diag/Makefile.am:1.1.1.2
--- build_tree/bootLoader/src/diag/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -4,7 +4,7 @@
 #
 # Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
 #
-# $Id: Makefile.am,v 1.7 2002/01/07 17:04:02 seletz Exp $
+# $Id: Makefile.am,v 1.23 2003/09/04 18:10:42 russd Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -27,65 +27,93 @@
 	diag
 
 
-INCLUDES		+= \
+INCLUDES		= \
 	-I${top_builddir}/include \
 	-I${top_srcdir}/include
 
 
+# ---- Built sources -------------------------------------------------
+
+BUILT_SOURCES = \
+	commands.c
+
+commands.c:
+	${top_srcdir}/src/commands/make_commands.sh @ALL_COMMANDS@ > $@
+
+
+# ---- diag ----------------------------------------------------------
+
 # WARNING: start.S *must* be the first file, otherwise the target will
 # be linked in the wrong order!
 diag_elf32_SOURCES	= \
 	start.S \
-	stack.S \
 	command_hist.c \
 	commands.c \
+	getcommand.c \
 	initcalls.c \
 	regs-sa11x0.c \
 	main.c
 
 EXTRA_diag_elf32_SOURCES		= \
 	lcd.c \
+	accelent_sa.c \
 	assabet.c \
 	badge4.c \
 	brutus.c \
+	cep.c \
 	clart.c \
+	frodo.c \
+	hackkit.c \
 	h3600.c \
 	idr.c \
 	jornada720.c \
 	lart.c \
+	lubbock.c \
+	miniprint.c \
 	nesa.c \
 	pleb.c \
+	ramses.c \
 	shannon.c \
-	system3.c
+	smdk2500.c \
+	system3.c \
+	trizeps.c \
+	pxa_idp.c \
+	csir_ims.c
 
 diag_elf32_DEPENDENCIES	= \
-	@LCD@ \
-	@DIAG_PLATFORM_OBJ@ \
+	@DIAG_LCD_OBJS@ \
+	@DIAG_PLATFORM_OBJS@ \
+	${top_builddir}/src/commands/libcommands.a \
+	${top_builddir}/src/lib/libblob.a \
 	ld-script
 
-diag_elf32_LDFLAGS	+= \
-	-Wl,-T,${srcdir}/ld-script
+diag_elf32_LDFLAGS	= \
+	-Wl,-T,${srcdir}/ld-script \
+	-Wl,-Map,diag-elf32.map
 
 
-diag_elf32_LDADD	+= \
-	@LCD@ \
-	@DIAG_PLATFORM_OBJ@ \
-	-L${top_builddir}/src/lib -lblob \
+diag_elf32_LDADD	= \
+	@DIAG_LCD_OBJS@ \
+	@DIAG_PLATFORM_OBJS@ \
+	-L${top_builddir}/src/commands -L${top_builddir}/src/lib \
+	-lcommands -lblob \
 	-lgcc
 
 
 diag_SOURCES		=
 
 
-diag: diag-elf32
+diag$(EXEEXT): diag-elf32
 	$(OBJCOPY) $(OCFLAGS) $< $@
 
 
+# ---- Automake administrativia --------------------------------------
+
 EXTRA_DIST	= \
 	ld-script
 
 
-CLEANFILES	= ${srcdir}/*~
+CLEANFILES	= ${srcdir}/*~ *.map commands.c
 
 
 DISTCLEANFILES	= ${builddir}/.deps/*.P
Index: build_tree/bootLoader/src/diag/Makefile.in
diff -u build_tree/bootLoader/src/diag/Makefile.in:1.1.1.1 build_tree/bootLoader/src/diag/Makefile.in:1.2
--- build_tree/bootLoader/src/diag/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,13 +12,15 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 #
 # Makefile.am
 #
 # Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
 #
-# $Id: Makefile.am,v 1.7 2002/01/07 17:04:02 seletz Exp $
+# $Id: Makefile.am,v 1.23 2003/09/04 18:10:42 russd Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -33,339 +37,567 @@
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 #
 
-
-SHELL = @SHELL@
+SOURCES = $(diag_SOURCES) $(diag_elf32_SOURCES) $(EXTRA_diag_elf32_SOURCES)
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ../..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+bin_PROGRAMS = diag-elf32$(EXEEXT) diag$(EXEEXT)
+subdir = src/diag
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+am__installdirs = "$(DESTDIR)$(bindir)"
+binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
+PROGRAMS = $(bin_PROGRAMS)
+am_diag_OBJECTS =
+diag_OBJECTS = $(am_diag_OBJECTS)
+diag_LDADD = $(LDADD)
+am_diag_elf32_OBJECTS = start.$(OBJEXT) command_hist.$(OBJEXT) \
+	commands.$(OBJEXT) getcommand.$(OBJEXT) initcalls.$(OBJEXT) \
+	regs-sa11x0.$(OBJEXT) main.$(OBJEXT)
+diag_elf32_OBJECTS = $(am_diag_elf32_OBJECTS)
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include/blob
+depcomp = $(SHELL) $(top_srcdir)/tools/depcomp
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/accelent_sa.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/assabet.Po ./$(DEPDIR)/badge4.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/brutus.Po ./$(DEPDIR)/cep.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/clart.Po ./$(DEPDIR)/command_hist.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/commands.Po ./$(DEPDIR)/csir_ims.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/frodo.Po ./$(DEPDIR)/getcommand.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/h3600.Po ./$(DEPDIR)/hackkit.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/idr.Po ./$(DEPDIR)/initcalls.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/jornada720.Po ./$(DEPDIR)/lart.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/lcd.Po ./$(DEPDIR)/lubbock.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/main.Po ./$(DEPDIR)/miniprint.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/nesa.Po ./$(DEPDIR)/pleb.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/pxa_idp.Po ./$(DEPDIR)/ramses.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/regs-sa11x0.Po ./$(DEPDIR)/shannon.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/smdk2500.Po ./$(DEPDIR)/system3.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/trizeps.Po
+CCASCOMPILE = $(CCAS) $(AM_CCASFLAGS) $(CCASFLAGS)
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(diag_SOURCES) $(diag_elf32_SOURCES) \
+	$(EXTRA_diag_elf32_SOURCES)
+DIST_SOURCES = $(diag_SOURCES) $(diag_elf32_SOURCES) \
+	$(EXTRA_diag_elf32_SOURCES)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+INCLUDES = \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include
 
-bin_PROGRAMS =  	diag-elf32 	diag
 
+# ---- Built sources -------------------------------------------------
+BUILT_SOURCES = \
+	commands.c
 
-INCLUDES =  	-I${top_builddir}/include 	-I${top_srcdir}/include
 
+# ---- diag ----------------------------------------------------------
 
 # WARNING: start.S *must* be the first file, otherwise the target will
 # be linked in the wrong order!
-diag_elf32_SOURCES =  	start.S 	stack.S 	command_hist.c 	commands.c 	initcalls.c 	regs-sa11x0.c 	main.c
-
-
-EXTRA_diag_elf32_SOURCES =  	lcd.c 	assabet.c 	badge4.c 	brutus.c 	clart.c 	h3600.c 	idr.c 	jornada720.c 	lart.c 	nesa.c 	pleb.c 	shannon.c 	system3.c
-
-
-diag_elf32_DEPENDENCIES =  	@LCD@ 	@DIAG_PLATFORM_OBJ@ 	ld-script
-
-
-diag_elf32_LDFLAGS =  	-Wl,-T,${srcdir}/ld-script
-
-
-diag_elf32_LDADD =  	@LCD@ 	@DIAG_PLATFORM_OBJ@ 	-L${top_builddir}/src/lib -lblob 	-lgcc
-
+diag_elf32_SOURCES = \
+	start.S \
+	command_hist.c \
+	commands.c \
+	getcommand.c \
+	initcalls.c \
+	regs-sa11x0.c \
+	main.c
+
+EXTRA_diag_elf32_SOURCES = \
+	lcd.c \
+	accelent_sa.c \
+	assabet.c \
+	badge4.c \
+	brutus.c \
+	cep.c \
+	clart.c \
+	frodo.c \
+	hackkit.c \
+	h3600.c \
+	idr.c \
+	jornada720.c \
+	lart.c \
+	lubbock.c \
+	miniprint.c \
+	nesa.c \
+	pleb.c \
+	ramses.c \
+	shannon.c \
+	smdk2500.c \
+	system3.c \
+	trizeps.c \
+	pxa_idp.c \
+	csir_ims.c
+
+diag_elf32_DEPENDENCIES = \
+	@DIAG_LCD_OBJS@ \
+	@DIAG_PLATFORM_OBJS@ \
+	${top_builddir}/src/commands/libcommands.a \
+	${top_builddir}/src/lib/libblob.a \
+	ld-script
+
+diag_elf32_LDFLAGS = \
+	-Wl,-T,${srcdir}/ld-script \
+	-Wl,-Map,diag-elf32.map
+
+diag_elf32_LDADD = \
+	@DIAG_LCD_OBJS@ \
+	@DIAG_PLATFORM_OBJS@ \
+	-L${top_builddir}/src/commands -L${top_builddir}/src/lib \
+	-lcommands -lblob \
+	-lgcc
 
 diag_SOURCES = 
 
-EXTRA_DIST =  	ld-script
-
-
-CLEANFILES = ${srcdir}/*~
+# ---- Automake administrativia --------------------------------------
+EXTRA_DIST = \
+	ld-script
 
+CLEANFILES = ${srcdir}/*~ *.map commands.c
 DISTCLEANFILES = ${builddir}/.deps/*.P
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-PROGRAMS =  $(bin_PROGRAMS)
-
-
-DEFS = @DEFS@ -I. -I$(srcdir) -I../../include/blob
-CPPFLAGS = @CPPFLAGS@
-LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
-diag_elf32_OBJECTS =  start.o stack.o command_hist.o commands.o \
-initcalls.o regs-sa11x0.o main.o
-diag_OBJECTS = 
-diag_LDADD = $(LDADD)
-diag_DEPENDENCIES = 
-diag_LDFLAGS = 
-CFLAGS = @CFLAGS@
-COMPILE = $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
-CCLD = $(CC)
-LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(LDFLAGS) -o $@
-DIST_COMMON =  Makefile.am Makefile.in
-
+all: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) all-am
 
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-SOURCES = $(diag_elf32_SOURCES) $(EXTRA_diag_elf32_SOURCES) $(diag_SOURCES)
-OBJECTS = $(diag_elf32_OBJECTS) $(diag_OBJECTS)
-
-all: all-redirect
 .SUFFIXES:
-.SUFFIXES: .S .c .o .s
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps src/diag/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
-
-mostlyclean-binPROGRAMS:
-
-clean-binPROGRAMS:
-	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
-
-distclean-binPROGRAMS:
-
-maintainer-clean-binPROGRAMS:
-
+.SUFFIXES: .S .c .o .obj
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/diag/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/diag/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	$(mkinstalldirs) $(DESTDIR)$(bindir)
+	test -z "$(bindir)" || $(mkdir_p) "$(DESTDIR)$(bindir)"
 	@list='$(bin_PROGRAMS)'; for p in $$list; do \
-	  if test -f $$p; then \
-	    echo "  $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`"; \
-	     $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`; \
+	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
+	  if test -f $$p \
+	  ; then \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) '$$p' '$(DESTDIR)$(bindir)/$$f'"; \
+	   $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) "$$p" "$(DESTDIR)$(bindir)/$$f" || exit 1; \
 	  else :; fi; \
 	done
 
 uninstall-binPROGRAMS:
 	@$(NORMAL_UNINSTALL)
-	list='$(bin_PROGRAMS)'; for p in $$list; do \
-	  rm -f $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`; \
+	@list='$(bin_PROGRAMS)'; for p in $$list; do \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  echo " rm -f '$(DESTDIR)$(bindir)/$$f'"; \
+	  rm -f "$(DESTDIR)$(bindir)/$$f"; \
 	done
 
-.c.o:
-	$(COMPILE) -c $<
-
-.s.o:
-	$(COMPILE) -c $<
-
-.S.o:
-	$(COMPILE) -c $<
+clean-binPROGRAMS:
+	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
+diag-elf32$(EXEEXT): $(diag_elf32_OBJECTS) $(diag_elf32_DEPENDENCIES) 
+	@rm -f diag-elf32$(EXEEXT)
+	$(LINK) $(diag_elf32_LDFLAGS) $(diag_elf32_OBJECTS) $(diag_elf32_LDADD) $(LIBS)
 
 mostlyclean-compile:
-	-rm -f *.o core *.core
-
-clean-compile:
+	-rm -f *.$(OBJEXT)
 
 distclean-compile:
 	-rm -f *.tab.c
 
-maintainer-clean-compile:
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/accelent_sa.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/assabet.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/badge4.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/brutus.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cep.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/clart.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/command_hist.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/commands.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/csir_ims.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/frodo.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/getcommand.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/h3600.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/hackkit.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/idr.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/initcalls.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/jornada720.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lart.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lcd.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/lubbock.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/main.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/miniprint.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/nesa.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pleb.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pxa_idp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ramses.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/regs-sa11x0.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/shannon.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/smdk2500.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/system3.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/trizeps.Po@am__quote@
 
-diag-elf32: $(diag_elf32_OBJECTS) $(diag_elf32_DEPENDENCIES)
-	@rm -f diag-elf32
-	$(LINK) $(diag_elf32_LDFLAGS) $(diag_elf32_OBJECTS) $(diag_elf32_LDADD) $(LIBS)
+.S.o:
+	$(CCASCOMPILE) -c $<
 
-tags: TAGS
+.S.obj:
+	$(CCASCOMPILE) -c `$(CYGPATH_W) '$<'`
 
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+.c.o:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c `$(CYGPATH_W) '$<'`
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
+	mkid -fID $$unique
+tags: TAGS
 
-TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = src/diag
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-command_hist.o: command_hist.c ../../include/blob/config.h \
-	../../include/blob/command.h ../../include/blob/types.h \
-	../../include/blob/command_hist.h ../../include/blob/errno.h \
-	../../include/blob/init.h ../../include/blob/util.h
-commands.o: commands.c ../../include/blob/config.h \
-	../../include/blob/command.h ../../include/blob/types.h \
-	../../include/blob/command_hist.h ../../include/blob/error.h \
-	../../include/blob/reboot.h ../../include/blob/serial.h \
-	../../include/blob/terminal.h ../../include/blob/time.h \
-	../../include/blob/util.h
-initcalls.o: initcalls.c ../../include/blob/config.h \
-	../../include/blob/init.h ../../include/blob/types.h \
-	../../include/blob/icache.h ../../include/blob/led.h \
-	../../include/blob/serial.h ../../include/blob/time.h
-lart.o: lart.c ../../include/blob/config.h ../../include/blob/init.h \
-	../../include/blob/types.h ../../include/blob/serial.h
-main.o: main.c ../../include/blob/config.h ../../include/blob/command.h \
-	../../include/blob/types.h ../../include/blob/error.h \
-	../../include/blob/init.h ../../include/blob/serial.h
-regs-sa11x0.o: regs-sa11x0.c ../../include/blob/config.h \
-	../../include/blob/types.h ../../include/blob/errno.h \
-	../../include/blob/util.h ../../include/blob/command.h \
-	../../include/blob/init.h ../../include/blob/serial.h \
-	../../include/blob/time.h ../../include/blob/sa1100.h
-
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
-check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am: install-binPROGRAMS
+check: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) check-am
+all-am: Makefile $(PROGRAMS)
+installdirs:
+	for dir in "$(DESTDIR)$(bindir)"; do \
+	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
+	done
+install: $(BUILT_SOURCES)
+	$(MAKE) $(AM_MAKEFLAGS) install-am
 install-exec: install-exec-am
-
-install-data-am:
 install-data: install-data-am
+uninstall: uninstall-am
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am: uninstall-binPROGRAMS
-uninstall: uninstall-am
-all-am: Makefile $(PROGRAMS)
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-	$(mkinstalldirs)  $(DESTDIR)$(bindir)
-
 
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-binPROGRAMS mostlyclean-compile \
-		mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+	-test -z "$(BUILT_SOURCES)" || rm -f $(BUILT_SOURCES)
+clean: clean-am
 
-mostlyclean: mostlyclean-am
+clean-am: clean-binPROGRAMS clean-generic mostlyclean-am
 
-clean-am:  clean-binPROGRAMS clean-compile clean-tags clean-generic \
-		mostlyclean-am
+distclean: distclean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
 
-clean: clean-am
+dvi: dvi-am
 
-distclean-am:  distclean-binPROGRAMS distclean-compile distclean-tags \
-		distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-am
+html: html-am
 
-maintainer-clean-am:  maintainer-clean-binPROGRAMS \
-		maintainer-clean-compile maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am: install-binPROGRAMS
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
 
-.PHONY: mostlyclean-binPROGRAMS distclean-binPROGRAMS clean-binPROGRAMS \
-maintainer-clean-binPROGRAMS uninstall-binPROGRAMS install-binPROGRAMS \
-mostlyclean-compile distclean-compile clean-compile \
-maintainer-clean-compile tags mostlyclean-tags distclean-tags \
-clean-tags maintainer-clean-tags distdir info-am info dvi-am dvi check \
-check-am installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+mostlyclean: mostlyclean-am
 
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
 
-diag: diag-elf32
-	$(OBJCOPY) $(OCFLAGS) $< $@
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
 
+uninstall-am: uninstall-binPROGRAMS uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-binPROGRAMS \
+	clean-generic ctags distclean distclean-compile \
+	distclean-generic distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-binPROGRAMS \
+	install-data install-data-am install-exec install-exec-am \
+	install-info install-info-am install-man install-strip \
+	installcheck installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-binPROGRAMS uninstall-info-am
+
+
+commands.c:
+	${top_srcdir}/src/commands/make_commands.sh @ALL_COMMANDS@ > $@
+
+diag$(EXEEXT): diag-elf32
+	$(OBJCOPY) $(OCFLAGS) $< $@
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
 .NOEXPORT:
Index: build_tree/bootLoader/src/diag/accelent_sa.c
diff -u /dev/null build_tree/bootLoader/src/diag/accelent_sa.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/accelent_sa.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,58 @@
+/**********************************************************************
+ * accelent_sa.c
+ *
+ * Implements several POST routines for Accelent IDP platform
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
+ * Copyright (c) 2002 Holger Schurig <h.schurig@mn-logistik.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ident "$Id: accelent_sa.c,v 1.4 2003/09/04 17:39:00 russd Exp $"
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/arch.h>
+
+
+
+#define MEM(adr)	(*((u32*)adr))
+#define SET(reg,bit)	((reg) |= (1<<(bit)))
+#define CLR(reg,bit)	((reg) &= ~(1<<(bit)))
+
+
+
+
+static void accelent_sa_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(accelent_sa_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/assabet.c
diff -u build_tree/bootLoader/src/diag/assabet.c:1.1.1.1 build_tree/bootLoader/src/diag/assabet.c:1.1.1.2
--- build_tree/bootLoader/src/diag/assabet.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/assabet.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: assabet.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: assabet.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: assabet.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: assabet.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(assabet_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/badge4.c
diff -u build_tree/bootLoader/src/diag/badge4.c:1.1.1.1 build_tree/bootLoader/src/diag/badge4.c:1.1.1.2
--- build_tree/bootLoader/src/diag/badge4.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/badge4.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: badge4.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: badge4.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: badge4.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: badge4.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(badge4_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/brutus.c
diff -u build_tree/bootLoader/src/diag/brutus.c:1.1.1.1 build_tree/bootLoader/src/diag/brutus.c:1.1.1.2
--- build_tree/bootLoader/src/diag/brutus.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/brutus.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: brutus.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: brutus.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: brutus.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: brutus.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(brutus_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/cep.c
diff -u /dev/null build_tree/bootLoader/src/diag/cep.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/cep.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,44 @@
+/*
+ * cep.c: Cep specific stuff
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ *
+ * $Id: cep.c,v 1.2 2003/09/04 17:39:00 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: cep.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+
+
+
+
+static void cep_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(cep_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/clart.c
diff -u build_tree/bootLoader/src/diag/clart.c:1.1.1.1 build_tree/bootLoader/src/diag/clart.c:1.1.1.2
--- build_tree/bootLoader/src/diag/clart.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/clart.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: clart.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: clart.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: clart.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: clart.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(clart_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/command_hist.c
diff -u build_tree/bootLoader/src/diag/command_hist.c:1.1.1.1 build_tree/bootLoader/src/diag/command_hist.c:1.1.1.2
--- build_tree/bootLoader/src/diag/command_hist.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/command_hist.c	Fri Nov  9 09:44:05 2007
@@ -5,7 +5,7 @@
  *
  *	Implements a simple command history
  *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -23,7 +23,7 @@
  *
  */
 
-#ident "$Id: command_hist.c,v 1.2 2001/12/19 20:00:15 erikm Exp $"
+#ident "$Id: command_hist.c,v 1.3 2002/02/11 16:53:16 seletz Exp $"
 
 /**********************************************************************
  * Includes
Index: build_tree/bootLoader/src/diag/commands.c
diff -u build_tree/bootLoader/src/diag/commands.c:1.1.1.1 build_tree/bootLoader/src/diag/commands.c:removed
--- build_tree/bootLoader/src/diag/commands.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/commands.c	Tue Jan  8 14:21:47 2008
@@ -1,145 +0,0 @@
-/*
- * commands.c: commands for diag
- *
- * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- *
- * $Id: commands.c,v 1.5 2002/01/03 16:07:18 erikm Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-#ident "$Id: commands.c,v 1.5 2002/01/03 16:07:18 erikm Exp $"
-
-#ifdef HAVE_CONFIG_H
-# include <blob/config.h>
-#endif
-
-
-#include <blob/command.h>
-#include <blob/command_hist.h>
-#include <blob/error.h>
-#include <blob/reboot.h>
-#include <blob/serial.h>
-#include <blob/terminal.h>
-#include <blob/time.h>
-#include <blob/util.h>
-
-
-
-
-__commandlist(reset_terminal, "reset", resethelp);
-__commandlist(reboot, "reboot", reboothelp);
-
-
-
-
-/* more or less like SerialInputString(), but with echo and backspace  */
-/* unlike the version in libblob, this version has a command history */
-int GetCommand(char *command, int len, int timeout)
-{
-	u32 startTime, currentTime;
-	int c;
-	int i;
-	int numRead;
-	int maxRead = len - 1;
-
-	TimerClearOverflow();
-
-	startTime = TimerGetTime();
-
-	cmdhist_reset();
-
-	for(numRead = 0, i = 0; numRead < maxRead;) {
-		/* try to get a byte from the serial port */
-		while(serial_poll() != 0) {
-			currentTime = TimerGetTime();
-
-			/* check timeout value */
-			if((currentTime - startTime) > 
-			   (timeout * TICKS_PER_SECOND)) {
-				/* timeout */
-				command[i++] = '\0';
-				cmdhist_push( command );
-				return(numRead);
-			}
-		}
-
-		c = serial_read();
-
-		/* check for errors */
-		if(c < 0) {
-			command[i++] = '\0';
-			serial_write('\n');
-			printerror(c, "can't read command");
-			return c;
-		}
-
-		if((c == '\r') || (c == '\n')) {
-			command[i++] = '\0';
-
-			/* print newline */
-			serial_write('\n');
-			cmdhist_push( command );
-			return(numRead);
-		} else if(c == '\b') { /* FIXME: is this backspace? */
-			if(i > 0) {
-				i--;
-				numRead--;
-				/* cursor one position back. */
-				SerialOutputString("\b \b");
-			}
-		} else if ( c == CMDHIST_KEY_UP ) {
-			char *cmd = NULL;
-			/* get cmd from history */
-			if ( cmdhist_next( &cmd ) != 0 )
-				continue;
-
-			/* clear line */
-			while ( numRead-- ) {
-				SerialOutputString("\b \b");
-			}
-
-			/* display it */
-			SerialOutputString(cmd);
-			i = numRead = strlen( cmd );
-			strncpy( command, cmd, MAX_COMMANDLINE_LENGTH );
-		} else if ( c == CMDHIST_KEY_DN ) {
-			char *cmd = NULL;
-			/* get cmd from history */
-			if ( cmdhist_prev( &cmd ) != 0 )
-				continue;
-
-			/* clear line */
-			while ( numRead-- ) {
-				SerialOutputString("\b \b");
-			}
-
-			/* display it */
-			SerialOutputString(cmd);
-			i = numRead = strlen( cmd );
-			strncpy( command, cmd, MAX_COMMANDLINE_LENGTH );
-		} else {
-			command[i++] = c;
-			numRead++;
-
-			/* print character */
-			serial_write(c);
-		}
-	}
-
-	cmdhist_push( command );
-	return(numRead);
-}
Index: build_tree/bootLoader/src/diag/csir_ims.c
diff -u /dev/null build_tree/bootLoader/src/diag/csir_ims.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/csir_ims.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,22 @@
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/arch.h>
+
+static void csir_ims_init_hardware(void)
+{
+	serial_driver = &pxa_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(csir_ims_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
Index: build_tree/bootLoader/src/diag/frodo.c
diff -u /dev/null build_tree/bootLoader/src/diag/frodo.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/frodo.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,44 @@
+/*
+ * frodo.c: FRODO specific stuff
+ *
+ * Copyright (C) 2002  Abraham van der Merwe <abraham@2d3d.co.za>
+ *
+ * $Id: frodo.c,v 1.2 2003/09/04 17:39:00 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: frodo.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+
+
+
+
+static void frodo_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(frodo_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/getcommand.c
diff -u /dev/null build_tree/bootLoader/src/diag/getcommand.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/getcommand.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,137 @@
+/*
+ * getcommand.c: commands for diag
+ *
+ * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ *
+ * $Id: getcommand.c,v 1.2 2003/09/04 17:39:00 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: getcommand.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+
+#include <blob/command.h>
+#include <blob/command_hist.h>
+#include <blob/error.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/util.h>
+
+
+
+
+/* more or less like SerialInputString(), but with echo and backspace  */
+/* unlike the version in libblob, this version has a command history */
+int GetCommand(char *command, int len, int timeout)
+{
+	u32 startTime, currentTime;
+	int c;
+	int i;
+	int numRead;
+	int maxRead = len - 1;
+
+	timer_overflow_clear();
+
+	startTime = timer_read();
+
+	cmdhist_reset();
+
+	for(numRead = 0, i = 0; numRead < maxRead;) {
+		/* try to get a byte from the serial port */
+		while(serial_poll() != 0) {
+			currentTime = timer_read();
+
+			/* check timeout value */
+			if((currentTime - startTime) > 
+			   (timeout * timer_tps())) {
+				/* timeout */
+				command[i++] = '\0';
+				cmdhist_push( command );
+				return(numRead);
+			}
+		}
+
+		c = serial_read();
+
+		/* check for errors */
+		if(c < 0) {
+			command[i++] = '\0';
+			serial_write('\n');
+			printerror(c, "can't read command");
+			return c;
+		}
+
+		if((c == '\r') || (c == '\n')) {
+			command[i++] = '\0';
+
+			/* print newline */
+			serial_write('\n');
+			cmdhist_push( command );
+			return(numRead);
+		} else if(c == '\b') { /* FIXME: is this backspace? */
+			if(i > 0) {
+				i--;
+				numRead--;
+				/* cursor one position back. */
+				SerialOutputString("\b \b");
+			}
+		} else if ( c == CMDHIST_KEY_UP ) {
+			char *cmd = NULL;
+			/* get cmd from history */
+			if ( cmdhist_next( &cmd ) != 0 )
+				continue;
+
+			/* clear line */
+			while ( numRead-- ) {
+				SerialOutputString("\b \b");
+			}
+
+			/* display it */
+			SerialOutputString(cmd);
+			i = numRead = strlen( cmd );
+			strncpy( command, cmd, MAX_COMMANDLINE_LENGTH );
+		} else if ( c == CMDHIST_KEY_DN ) {
+			char *cmd = NULL;
+			/* get cmd from history */
+			if ( cmdhist_prev( &cmd ) != 0 )
+				continue;
+
+			/* clear line */
+			while ( numRead-- ) {
+				SerialOutputString("\b \b");
+			}
+
+			/* display it */
+			SerialOutputString(cmd);
+			i = numRead = strlen( cmd );
+			strncpy( command, cmd, MAX_COMMANDLINE_LENGTH );
+		} else {
+			command[i++] = c;
+			numRead++;
+
+			/* print character */
+			serial_write(c);
+		}
+	}
+
+	cmdhist_push( command );
+	return(numRead);
+}
Index: build_tree/bootLoader/src/diag/h3600.c
diff -u build_tree/bootLoader/src/diag/h3600.c:1.1.1.1 build_tree/bootLoader/src/diag/h3600.c:1.1.1.2
--- build_tree/bootLoader/src/diag/h3600.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/h3600.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: h3600.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: h3600.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: h3600.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: h3600.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(h3600_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/hackkit.c
diff -u /dev/null build_tree/bootLoader/src/diag/hackkit.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/hackkit.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,83 @@
+/*
+ * hackkit.c: PT System3 specific stuff
+ *
+ * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001,2002  Stefan Eletzhofer 
+ *                               (stefan.eletzhofer@www.eletztrick.de)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: hackkit.c,v 1.3 2003/09/04 17:39:00 russd Exp $"
+
+/**********************************************************************
+ * includes
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/main.h>
+#include <blob/arch.h>
+#include <blob/serial.h>
+#include <blob/init.h>
+#include <blob/arch.h>
+#include <blob/time.h>
+
+/**********************************************************************
+ * defines
+ */
+
+/* this will send a cold shiver through erik's spine ... */
+#define	ERR( x )		{ ret = x; goto DONE; }
+
+/* more readable IMHO */
+#define MEM( x )        (*((u32 *)(x)))
+#define SET(reg,bit) ((reg) |= (1<<(bit)))
+#define RST(reg,bit) ((reg) &= ~(1<<(bit)))
+
+#define HKIT_DEBUG 1
+
+/**********************************************************************
+ * globals
+ */
+
+/**********************************************************************
+ * module globals
+ */
+static char module_version[] = "$Id: hackkit.c,v 1.3 2003/09/04 17:39:00 russd Exp $";
+
+#if HKIT_DEBUG
+static int hkit_dbg = 1;
+#else
+static int hkit_dbg = 0;
+#endif
+
+/**********************************************************************
+ * static functions
+ */
+
+/*********************************************************************
+ * hackkit_init_hardware - inits system 3 LL hardware stuff
+ */
+static void hackkit_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+__initlist(hackkit_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/idr.c
diff -u build_tree/bootLoader/src/diag/idr.c:1.1.1.1 build_tree/bootLoader/src/diag/idr.c:1.1.1.2
--- build_tree/bootLoader/src/diag/idr.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/idr.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: idr.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: idr.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: idr.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: idr.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(idr_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/initcalls.c
diff -u build_tree/bootLoader/src/diag/initcalls.c:1.1.1.1 build_tree/bootLoader/src/diag/initcalls.c:1.1.1.2
--- build_tree/bootLoader/src/diag/initcalls.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/initcalls.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: initcalls.c,v 1.3 2002/01/03 16:07:18 erikm Exp $
+ * $Id: initcalls.c,v 1.4 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: initcalls.c,v 1.3 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: initcalls.c,v 1.4 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -49,7 +49,7 @@
 __initlist(serial_default_init,	INIT_LEVEL_INITIAL_HARDWARE);
 __initlist(enable_icache,	INIT_LEVEL_INITIAL_HARDWARE);
 __initlist(led_init,		INIT_LEVEL_INITIAL_HARDWARE);
-__initlist(TimerInit,		INIT_LEVEL_OTHER_HARDWARE);
+__initlist(timer_init,		INIT_LEVEL_OTHER_HARDWARE);
 
 
 
Index: build_tree/bootLoader/src/diag/jornada720.c
diff -u build_tree/bootLoader/src/diag/jornada720.c:1.1.1.1 build_tree/bootLoader/src/diag/jornada720.c:1.1.1.2
--- build_tree/bootLoader/src/diag/jornada720.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/jornada720.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: jornada720.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: jornada720.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: jornada720.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: jornada720.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(jornada720_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/lart.c
diff -u build_tree/bootLoader/src/diag/lart.c:1.1.1.1 build_tree/bootLoader/src/diag/lart.c:1.1.1.2
--- build_tree/bootLoader/src/diag/lart.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/lart.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: lart.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: lart.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: lart.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: lart.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(lart_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/lcd.c
diff -u build_tree/bootLoader/src/diag/lcd.c:1.1.1.1 build_tree/bootLoader/src/diag/lcd.c:1.1.1.2
--- build_tree/bootLoader/src/diag/lcd.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/lcd.c	Fri Nov  9 09:44:05 2007
@@ -1,11 +1,11 @@
 /**********************************************************************
  * lcd.c
  *
- * AUTOR:	SELETZ
- *
  * Generic lcd framework
  *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Copyright (C) 2001,2002 Stefan Eletzhofer
+ *							<stefan.eletzhofer@www.eletztrick.de>
+ * Copyright (C) 2002 Urs Kaufmann <u_kaufmann@bluewin.ch>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -34,7 +34,7 @@
 #include <blob/util.h>
 #include <blob/command.h>
 #include <blob/serial.h>
-#include <blob/sa1100.h>
+#include <blob/arch.h>
 
 #include <blob/lcd.h>
 
@@ -53,6 +53,10 @@
 	SerialOutputHex( val ); \
 	serial_write( '\n' );
 
+#ifdef MINIPRINT
+# define LCD_GRADIENT
+#endif
+
 /**********************************************************************
  * program globals
  */
@@ -133,15 +137,20 @@
 
 int WEAK_SYM lcd_palette_setup( void )
 {
-	int n;
+	unsigned int n;
 
+#ifdef LCD_GRADIENT
+	for ( n = 0 ; n < 256 ; n++ ) {
+		lcd_palette_set(n, 0x1000+(n<<4) );
+	}
+#else
 	for ( n = 0 ; n < 128 ; n++ ) {
 		lcd_palette_set(n, 0x1FFF );
 	}
 	for ( n = 128 ; n < 256 ; n++ ) {
 		lcd_palette_set(n, 0x1000 );
 	}
-
+#endif
 	return 0;
 }
 
@@ -155,6 +164,52 @@
 	return 0;
 }
 
+int WEAK_SYM lcd_fill (int color)
+{
+  int i = 0;
+
+  if (color>0xFF)return -EINVAL;
+
+  color += (color<<8) + (color<<16) + (color<<24);
+  for(; i<(LCD_COLS*LCD_ROWS/4);i++)
+    lcd_vram[i] = color;
+
+  return 0;
+}
+
+int WEAK_SYM lcd_set_pixel (unsigned int x, unsigned int y, unsigned int color)
+{
+
+#ifdef LCD_REVERSE
+  x = LCD_COLS - 1 - x;
+  y = LCD_ROWS - 1 - y;
+#endif
+
+  if ((color>0xFF)||(y>=LCD_ROWS)||(x>=LCD_COLS))  return -EINVAL;
+
+  switch(x%4)
+  {
+    case 0:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0xFFFFFF00)|color;
+	  break;
+    case 1:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0xFFFF00FF)|(color<<8);
+	  break;
+    case 2:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0xFF00FFFF)|(color<<16);
+	  break;
+    case 3:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0x00FFFFFF)|(color<<24);
+	  break;
+  }
+
+  return 0;
+}
+
 /**********************************************************************
  * Statische Funktionen
  */
@@ -214,7 +269,14 @@
 	if ( ret != 0 )		return ret;
 	SerialOutputString( "done\n" );
 
-
+#ifdef LCD_GRADIENT
+	/* Gradient (bastel-code weil fixe aufloesung) */
+	SerialOutputString( "LCD: Gradient test pattern ..." );
+	lcd_fill(0x00);
+        for ( y=0; y<240; y++ )
+          	for ( x=0; x<320; x++ )
+           		lcd_set_pixel(x,y,(x/20)+((y/15)*16));
+#else
 	/* vertical lines */
 	SerialOutputString( "LCD: vertical lines test pattern ..." );
 	for ( y=0; y<LCD_ROWS; y++ ) {
@@ -226,7 +288,7 @@
 			}
 		}
 	}
-
+#endif
 	SerialOutputString( "done\n" );
 
 	SerialOutputString( "LCD: press any key to proceed\n" );
Index: build_tree/bootLoader/src/diag/ld-script
diff -u build_tree/bootLoader/src/diag/ld-script:1.1.1.1 build_tree/bootLoader/src/diag/ld-script:1.1.1.2
--- build_tree/bootLoader/src/diag/ld-script:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/ld-script	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      ld-script
- * Version:       $Id: ld-script,v 1.2 2001/10/28 22:14:20 erikm Exp $
+ * Version:       $Id: ld-script,v 1.3 2002/02/07 23:59:37 erikm Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   ld (linker) script to make diag.
@@ -55,11 +55,15 @@
 	.bss : {
 		__bss_start = .;
 		/* first the real BSS data */
-		*(.bss) 
+		*(.bss)
+		*(COMMON)
 
 		/* and next the stack */
 		. = ALIGN(4);
-		*(.stack)
+
+		/* allocate an 8kB stack */		
+		. = . + 8 * 1024;
+
 		__stack_end = .;
 		__bss_end = .;
 	}
Index: build_tree/bootLoader/src/diag/lubbock.c
diff -u /dev/null build_tree/bootLoader/src/diag/lubbock.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/lubbock.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,41 @@
+/*
+ * lubbock.c: Lubbock specific stuff
+ *
+ * Copyright (C) 2002  Intel Corporation
+ * Written by Rusty Geldmacher (russell.r.geldmacher@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+
+
+
+
+static void assabet_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(assabet_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/main.c
diff -u build_tree/bootLoader/src/diag/main.c:1.1.1.1 build_tree/bootLoader/src/diag/main.c:1.1.1.2
--- build_tree/bootLoader/src/diag/main.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/main.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: main.c,v 1.4 2002/01/03 16:07:18 erikm Exp $
+ * $Id: main.c,v 1.6 2002/12/03 16:41:47 seletz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: main.c,v 1.4 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: main.c,v 1.6 2002/12/03 16:41:47 seletz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -44,9 +44,12 @@
 	/* call subsystems */
 	init_subsystems();
 
-#ifdef H3600
+#if defined(H3600) || defined(HKIT)
 	serial_init(baud_115200); /* DEBUG */
 #endif
+#ifdef TRIZEPS
+	serial_init(baud_38400); /* DEBUG */
+#endif
 
 	SerialOutputString("\ndiag version " VERSION " for " BOARD_NAME "\n"
 			   "Copyright (C) 2001 "
Index: build_tree/bootLoader/src/diag/mainstone.c
diff -u /dev/null build_tree/bootLoader/src/diag/mainstone.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/mainstone.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,40 @@
+/*
+ * mainstone.c: Mainstone specific stuff
+ *
+ * Copyright (C) 2002  Intel Corporation (yu.tang@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+
+
+
+
+static void mainstone_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &pxa_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(mainstone_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/miniprint.c
diff -u /dev/null build_tree/bootLoader/src/diag/miniprint.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/miniprint.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,44 @@
+/*
+ * miniprint.c: MINIPRINT specific stuff
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Modified for miniprint by Urs Kaufmann
+ * $Id: miniprint.c,v 1.2 2003/09/04 17:39:00 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: miniprint.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+
+
+
+
+static void miniprint_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(miniprint_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/nesa.c
diff -u build_tree/bootLoader/src/diag/nesa.c:1.1.1.1 build_tree/bootLoader/src/diag/nesa.c:1.1.1.2
--- build_tree/bootLoader/src/diag/nesa.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/nesa.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: nesa.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: nesa.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: nesa.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: nesa.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(nesa_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/pleb.c
diff -u build_tree/bootLoader/src/diag/pleb.c:1.1.1.1 build_tree/bootLoader/src/diag/pleb.c:1.1.1.2
--- build_tree/bootLoader/src/diag/pleb.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/pleb.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: pleb.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: pleb.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: pleb.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: pleb.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(pleb_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/pxa_idp.c
diff -u /dev/null build_tree/bootLoader/src/diag/pxa_idp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/pxa_idp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,53 @@
+/**********************************************************************
+ * accelent_sa.c
+ *
+ * Implements several POST routines for Accelent PXA-IDP platform
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
+ * Copyright (c) 2002 Jeff Sutherland <jeffs@accelent.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/arch.h>
+
+#define MEM(adr)	(*((u32*)adr))
+#define SET(reg,bit)	((reg) |= (1<<(bit)))
+#define CLR(reg,bit)	((reg) &= ~(1<<(bit)))
+
+
+static void pxa_idp_init_hardware(void)
+{
+	/* select serial driver */
+	// also have to set up all gpio's here as well
+	serial_driver = &pxa_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(pxa_idp_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/ramses.c
diff -u /dev/null build_tree/bootLoader/src/diag/ramses.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/ramses.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,54 @@
+/**********************************************************************
+ * ramses.c
+ *
+ * Implements several POST routines for M&N Ramses MN-CI
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
+ * Copyright (c) 2002 Jeff Sutherland <jeffs@accelent.com>
+ * Copyright (c) 2003 Holger Schurig <h.schurig@mn-logistik.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/arch.h>
+
+#define MEM(adr)	(*((u32*)adr))
+#define SET(reg,bit)	((reg) |= (1<<(bit)))
+#define CLR(reg,bit)	((reg) &= ~(1<<(bit)))
+
+
+static void ramses_init_hardware(void)
+{
+	/* select serial driver */
+	// also have to set up all gpio's here as well
+	serial_driver = &pxa_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(ramses_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/regs-pxa.c
diff -u /dev/null build_tree/bootLoader/src/diag/regs-pxa.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/regs-pxa.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,268 @@
+/*
+ * regs-sa11x0.c: command to nicely debug register contents
+ *
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
+ * Copyright (C) 2002 Jeff Sutherland <jeffs@accelent.com>
+ *
+ * $Id: regs-pxa.c,v 1.1 2002/08/14 21:06:24 jeffs Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+/**********************************************************************
+ * includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+#include <blob/arch.h>
+
+/**********************************************************************
+ * defines
+ */
+#define MEM(adr)	(*((u32*)adr))
+#define SET(reg,bit)	((reg) |= (1<<(bit)))
+#define CLR(reg,bit)	((reg) &= ~(1<<(bit)))
+
+/**********************************************************************
+ * types
+ */
+
+/* a type to hold register infos */
+typedef struct _reg {
+	char *name;	/* reg name */
+	u32 adr;	/* reg address */
+	char *desc;	/* description */
+} register_t;
+
+/* a set of registers */
+typedef struct _reg_set {
+	char *name;			/* name of register set */
+	register_t *set;	/* register set */
+} reg_set_t;
+
+/**********************************************************************
+ * module globals
+ */
+
+/* NOTE: the following register definitions are directly taken from
+ *    linux/include/asm-arm/arch-sa1100/SA-1100.h
+ * and should therefore be correct.*/
+
+/* Serial IF */
+static register_t	regs_uart[] = {
+	{ "Ser0UDCCR", 	(0x80000000),   " Ser. port 0 UDC Control Reg. " },
+	{ "Ser0UDCAR", 	(0x80000004),   " Ser. port 0 UDC Address Reg. " },
+	{ "Ser0UDCOMP", 	(0x80000008),   " Ser. port 0 UDC Output Maximum Packet size reg. " },
+	{ "Ser0UDCIMP", 	(0x8000000C),   " Ser. port 0 UDC Input Maximum Packet size reg. " },
+	{ "Ser0UDCCS0", 	(0x80000010),   " Ser. port 0 UDC Control/Status reg. end-point 0 " },
+	{ "Ser0UDCCS1", 	(0x80000014),   " Ser. port 0 UDC Control/Status reg. end-point 1 (output) " },
+	{ "Ser0UDCCS2", 	(0x80000018),   " Ser. port 0 UDC Control/Status reg. end-point 2 (input) " },
+	{ "Ser0UDCD0", 	(0x8000001C),   " Ser. port 0 UDC Data reg. end-point 0 " },
+	{ "Ser0UDCWC", 	(0x80000020),   " Ser. port 0 UDC Write Count reg. end-point 0 " },
+	{ "Ser0UDCDR"// MSC0 (nCS0, nCS1) is for Flash
+// MSC1 (nCS2, nCS3) is for ?, SA1111
+// MSC2 (nCS4, nCS5) is for ExtBus, LCD
+#define MSC0_VALUE	0x6c616c60
+, 	(0x80000028),   " Ser. port 0 UDC Data Reg. " },
+	{ "Ser0UDCSR", 	(0x80000030),   " Ser. port 0 UDC Status Reg. " },
+	{ "_UTCR01", 	(0x80010000 + ((1) - 1)*0x00020000),  " UART Control Reg. 0 [1..3] " },
+	{ "_UTCR02", 	(0x80010000 + ((2) - 1)*0x00020000),  " UART Control Reg. 0 [1..3] " },
+	{ "_UTCR03", 	(0x80010000 + ((3) - 1)*0x00020000),  " UART Control Reg. 0 [1..3] " },
+	{ "_UTCR11", 	(0x80010004 + ((1) - 1)*0x00020000),  " UART Control Reg. 1 [1..3] " },
+	{ "_UTCR22", 	(0x80010008 + ((2) - 1)*0x00020000),  " UART Control Reg. 2 [1..3] " },
+	{ "_UTCR33", 	(0x8001000C + ((3) - 1)*0x00020000),  " UART Control Reg. 3 [1..3] " },
+	{ "_UTCR42", 	(0x80010010 + ((2) - 1)*0x00020000),  " UART Control Reg. 4 [2] " },
+	{ "_UTDR1", 	(0x80010014 + ((1) - 1)*0x00020000),  " UART Data Reg. [1..3] " },
+	{ "_UTDR2", 	(0x80010014 + ((2) - 1)*0x00020000),  " UART Data Reg. [1..3] " },
+	{ "_UTDR3", 	(0x80010014 + ((3) - 1)*0x00020000),  " UART Data Reg. [1..3] " },
+	{ "_UTSR01", 	(0x8001001C + ((1) - 1)*0x00020000),  " UART Status Reg. 0 [1..3] " },
+	{ "_UTSR02", 	(0x8001001C + ((2) - 1)*0x00020000),  " UART Status Reg. 0 [1..3] " },
+	{ "_UTSR03", 	(0x8001001C + ((3) - 1)*0x00020000),  " UART Status Reg. 0 [1..3] " },
+	{ "_UTSR11", 	(0x80010020 + ((1) - 1)*0x00020000),  " UART Status Reg. 1 [1..3] " },
+	{ "_UTSR12", 	(0x80010020 + ((2) - 1)*0x00020000),  " UART Status Reg. 1 [1..3] " },
+	{ "_UTSR13", 	(0x80010020 + ((3) - 1)*0x00020000),  " UART Status Reg. 1 [1..3] " },
+	{ "Ser1SDCR0", 	(0x80020060),   " Ser. port 1 SDLC Control Reg. 0 " },
+	{ "Ser1SDCR1", 	(0x80020064),   " Ser. port 1 SDLC Control Reg. 1 " },
+	{ "Ser1SDCR2", 	(0x80020068),   " Ser. port 1 SDLC Control Reg. 2 " },
+	{ "Ser1SDCR3", 	(0x8002006C),   " Ser. port 1 SDLC Control Reg. 3 " },
+	{ "Ser1SDCR4", 	(0x80020070),   " Ser. port 1 SDLC Control Reg. 4 " },
+	{ "Ser1SDDR", 	(0x80020078),   " Ser. port 1 SDLC Data Reg.      " },
+	{ "Ser1SDSR0", 	(0x80020080),   " Ser. port 1 SDLC Status Reg. 0  " },
+	{ "Ser1SDSR1", 	(0x80020084),   " Ser. port 1 SDLC Status Reg. 1  " },
+	{ "Ser2HSCR0", 	(0x80040060),   " Ser. port 2 HSSP Control Reg. 0 " },
+	{ "Ser2HSCR1", 	(0x80040064),   " Ser. port 2 HSSP Control Reg. 1 " },
+	{ "Ser2HSDR", 	(0x8004006C),   " Ser. port 2 HSSP Data Reg.      " },
+	{ "Ser2HSSR0", 	(0x80040074),   " Ser. port 2 HSSP Status Reg. 0  " },
+	{ "Ser2HSSR1", 	(0x80040078),   " Ser. port 2 HSSP Status Reg. 1  " },
+	{ "Ser2HSCR2", 	(0x90060028),   " Ser. port 2 HSSP Control Reg. 2 " },
+	{ "Ser4MCCR0", 	(0x80060000),   " Ser. port 4 MCP Control Reg. 0 " },
+	{ "Ser4MCDR0", 	(0x80060008),   " Ser. port 4 MCP Data Reg. 0 (audio) " },
+	{ "Ser4MCDR1", 	(0x8006000C),   " Ser. port 4 MCP Data Reg. 1 (telecom) " },
+	{ "Ser4MCDR2", 	(0x80060010),   " Ser. port 4 MCP Data Reg. 2 (CODEC reg.) " },
+	{ "Ser4MCSR", 	(0x80060018),   " Ser. port 4 MCP Status Reg. " },
+	{ "Ser4MCCR1", 	(0x90060030),   " Ser. port 4 MCP Control Reg. 1 " },
+	{ "Ser4SSCR0", 	(0x80070060),   " Ser. port 4 SSP Control Reg. 0 " },
+	{ "Ser4SSCR1", 	(0x80070064),   " Ser. port 4 SSP Control Reg. 1 " },
+	{ "Ser4SSDR", 	(0x8007006C),   " Ser. port 4 SSP Data Reg. " },
+	{ "Ser4SSSR", 	(0x80070074),   " Ser. port 4 SSP Status Reg. " },
+	{ NULL,	0 }
+};
+/* Timer */
+static register_t	regs_timer[] = {
+	{ "OSMR0",   		(0x90000000),   " OS timer Match Reg. 0 " },
+	{ "OSMR1",   		(0x90000004),   " OS timer Match Reg. 1 " },
+	{ "OSMR2",   		(0x90000008),   " OS timer Match Reg. 2 " },
+	{ "OSMR3",   		(0x9000000c),   " OS timer Match Reg. 3 " },
+	{ "OSCR",    	(0x90000010),   " OS timer Counter Reg. " },
+	{ "OSSR",    	(0x90000014),  " OS timer Status Reg. " },
+	{ "OWER",    	(0x90000018),  " OS timer Watch-dog Enable Reg. " },
+	{ "OIER",    	(0x9000001C),  " OS timer Interrupt Enable Reg. " },
+	{ NULL,	0 }
+};
+/* RTC and Power Mgmt */
+static register_t	regs_rtc[] = {
+	{ "RTAR", 		(0x90010000),   " RTC Alarm Reg. " },
+	{ "RCNR", 		(0x90010004),   " RTC CouNt Reg. " },
+	{ "RTTR", 		(0x90010008),   " RTC Trim Reg. " },
+	{ "RTSR", 		(0x90010010),   " RTC Status Reg. " },
+	{ "PMCR", 		(0x90020000),   " PM Control Reg. " },
+	{ "PSSR", 		(0x90020004),   " PM Sleep Status Reg. " },
+	{ "PSPR", 		(0x90020008),   " PM Scratch-Pad Reg. " },
+	{ "PWER", 		(0x9002000C),   " PM Wake-up Enable Reg. " },
+	{ "PCFR", 		(0x90020010),   " PM general ConFiguration Reg. " },
+	{ "PPCR", 		(0x90020014),   " PM PLL Configuration Reg. " },
+	{ "PGSR", 		(0x90020018),   " PM GPIO Sleep state Reg. " },
+	{ "POSR", 		(0x9002001C),   " PM Oscillator Status Reg. " },
+	{ "RSRR", 		(0x90030000),   " RC Software Reset Reg. " },
+	{ "RCSR", 		(0x90030004),   " RC Status Reg. " },
+	{ "TUCR", 		(0x90030008),   " Test Unit Control Reg. " },
+	{ NULL,	0 }
+};
+/* GPIO / IRQ */
+static register_t	regs_gpio[] = {
+	{ "GPLR", 		(0x90040000),   " GPIO Pin Level Reg.             " },
+	{ "GPDR", 		(0x90040004),   " GPIO Pin Direction Reg.         " },
+	{ "GPSR", 		(0x90040008),   " GPIO Pin output Set Reg.        " },
+	{ "GPCR", 		(0x9004000C),   " GPIO Pin output Clear Reg.      " },
+	{ "GRER", 		(0x90040010),   " GPIO Rising-Edge detect Reg.    " },
+	{ "GFER", 		(0x90040014),   " GPIO Falling-Edge detect Reg.   " },
+	{ "GEDR", 		(0x90040018),   " GPIO Edge Detect status Reg.    " },
+	{ "GAFR", 		(0x9004001C),   " GPIO Alternate Function Reg.    " },
+	{ "ICIP", 		(0x90050000),   " IC IRQ Pending reg.             " },
+	{ "ICMR", 		(0x90050004),   " IC Mask Reg.                    " },
+	{ "ICLR", 		(0x90050008),   " IC Level Reg.                   " },
+	{ "ICCR", 		(0x9005000C),   " IC Control Reg.                 " },
+	{ "ICFP", 		(0x90050010),   " IC FIQ Pending reg.             " },
+	{ "ICPR", 		(0x90050020),   " IC Pending Reg.                 " },
+	{ "PPDR", 		(0x90060000),   " PPC Pin Direction Reg.          " },
+	{ "PPSR", 		(0x90060004),   " PPC Pin State Reg.              " },
+	{ "PPAR", 		(0x90060008),   " PPC Pin Assignment Reg.         " },
+	{ "PSDR", 		(0x9006000C),   " PPC Sleep-mode pin Direction Reg. " },
+	{ "PPFR", 		(0x90060010),   " PPC Pin Flag Reg.               " },
+	{ NULL,	0 }
+};
+/* MEMORY */
+static register_t	regs_memory[] = {
+	{ "MDCNFG", 		(0xA0000000),   "  DRAM CoNFiGuration reg. " },
+	{ "MDCAS0", 		(0xA0000004),   " DRAM CAS shift reg. 0 " },
+	{ "MDCAS1", 		(0xA0000008),   " DRAM CAS shift reg. 1 " },
+	{ "MDCAS2", 		(0xA000000c),   " DRAM CAS shift reg. 2 " },
+	{ "MSC0", 		(0xa0000010),   " Static memory Control reg. 0 " },
+	{ "MSC1", 		(0xa0000014),   " Static memory Control reg. 1 " },
+	{ "MSC2", 		(0xa000002c),   " Static memory Control reg. 2, not contiguous   " },
+	{ "MECR", 		(0xA0000018),   "  Expansion memory bus (PCMCIA) Configuration Reg.             " },
+	{ "MDREFR", 		(0xA000001C), " (SA1110 only) DRAM Refresh Control Register" },
+	{ NULL,	0 }
+};
+/* LCD */
+static register_t	regs_lcd[] = {
+	{ "LCCR0", 		(0xB0100000),   " LCD Control Reg. 0 " },
+	{ "LCSR", 		(0xB0100004),   " LCD Status Reg. " },
+	{ "DBAR1", 		(0xB0100010),   " LCD DMA Base Address Reg. channel 1 " },
+	{ "DCAR1", 		(0xB0100014),   " LCD DMA Current Address Reg. channel 1 " },
+	{ "DBAR2", 		(0xB0100018),   " LCD DMA Base Address Reg.  channel 2 " },
+	{ "DCAR2", 		(0xB010001C),   " LCD DMA Current Address Reg. channel 2 " },
+	{ "LCCR1", 		(0xB0100020),   " LCD Control Reg. 1 " },
+	{ "LCCR2", 		(0xB0100024),   " LCD Control Reg. 2 " },
+	{ "LCCR3", 		(0xB0100028),   " LCD Control Reg. 3 " },
+	{ NULL,	0 }
+};
+
+/* TODO: add SA1111 companion chip registers */
+
+/* finally the available register sets */
+static reg_set_t reg_sets[] = {
+	{ "uart", regs_uart },
+	{ "timer", regs_timer },
+	{ "rtc", regs_rtc },
+	{ "gpio", regs_gpio },
+	{ "memory", regs_memory },
+	{ "lcd", regs_lcd },
+	{ NULL, NULL }
+};
+
+/**********************************************************************/
+/**********************************************************************/
+/**********************************************************************/
+
+/**********************************************************************
+ *  regs_show()
+ *
+ *	AUTHOR: seletz
+ *	REVISED:
+ *
+ *	Display register contents
+ *
+ */
+static int regs_show( int argc, char *argv[] )
+{
+	int i = 0;
+	int set = 0;
+	register_t *registers = NULL;
+
+	/* TODO: allow user to select a specific register set to
+	 * print instead of simply print all sets. */
+
+	set = 0;
+	while ( reg_sets[set].name ) {
+		i = 0;
+		registers = reg_sets[set].set;
+		printf( "%s\n", reg_sets[set].name );
+		printf( "--------------------------------\n" );
+		while ( registers && registers[i].name ) {
+			printf( "%s= 0x%08x %s\n", registers[i].name, MEM( registers[i].adr ),
+				registers[i].desc?registers[i].desc:"" );
+			i++;
+		}
+		set++;
+		serial_write( '\n' );
+	}
+
+	return 0;
+}
+
+static char regshelp[] = "print register info\n";
+
+__commandlist(regs_show, "regs", regshelp);
Index: build_tree/bootLoader/src/diag/regs-sa11x0.c
diff -u build_tree/bootLoader/src/diag/regs-sa11x0.c:1.1.1.1 build_tree/bootLoader/src/diag/regs-sa11x0.c:1.1.1.2
--- build_tree/bootLoader/src/diag/regs-sa11x0.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/regs-sa11x0.c	Fri Nov  9 09:44:05 2007
@@ -1,9 +1,9 @@
 /*
  * regs-sa11x0.c: command to nicely debug register contents
  *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
  *
- * $Id: regs-sa11x0.c,v 1.3 2002/01/07 17:35:06 erikm Exp $
+ * $Id: regs-sa11x0.c,v 1.6 2003/08/06 22:55:41 abz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: regs-sa11x0.c,v 1.3 2002/01/07 17:35:06 erikm Exp $"
+#ident "$Id: regs-sa11x0.c,v 1.6 2003/08/06 22:55:41 abz Exp $"
 
 /**********************************************************************
  * includes
@@ -37,7 +37,7 @@
 #include <blob/init.h>
 #include <blob/serial.h>
 #include <blob/time.h>
-#include <blob/sa1100.h>
+#include <blob/arch.h>
 
 /**********************************************************************
  * defines
@@ -224,6 +224,15 @@
 /**********************************************************************/
 /**********************************************************************/
 
+/**********************************************************************
+ *  regs_show()
+ *
+ *	AUTHOR: seletz
+ *	REVISED:
+ *
+ *	Display register contents
+ *
+ */
 static int regs_show( int argc, char *argv[] )
 {
 	int i = 0;
@@ -237,17 +246,11 @@
 	while ( reg_sets[set].name ) {
 		i = 0;
 		registers = reg_sets[set].set;
-		SerialOutputString( reg_sets[set].name );
-		serial_write( '\n' );
-		SerialOutputString( "--------------------------------\n" );
+		printf( "%s\n", reg_sets[set].name );
+		printf( "--------------------------------\n" );
 		while ( registers && registers[i].name ) {
-			SerialOutputString( registers[i].name );
-			SerialOutputString( "= 0x" );
-			SerialOutputHex( MEM( registers[i].adr ) );
-			if ( registers[i].desc ) {
-				SerialOutputString( registers[i].desc );
-			}
-			serial_write( '\n' );
+			printf( "%s= 0x%08x %s\n", registers[i].name, MEM( registers[i].adr ),
+				registers[i].desc?registers[i].desc:"" );
 			i++;
 		}
 		set++;
@@ -256,5 +259,7 @@
 
 	return 0;
 }
+
 static char regshelp[] = "print register info\n";
+
 __commandlist(regs_show, "regs", regshelp);
Index: build_tree/bootLoader/src/diag/shannon.c
diff -u build_tree/bootLoader/src/diag/shannon.c:1.1.1.1 build_tree/bootLoader/src/diag/shannon.c:1.1.1.2
--- build_tree/bootLoader/src/diag/shannon.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/shannon.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  *
- * $Id: shannon.c,v 1.1 2002/01/03 16:07:18 erikm Exp $
+ * $Id: shannon.c,v 1.2 2003/09/04 17:39:00 russd Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: shannon.c,v 1.1 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: shannon.c,v 1.2 2003/09/04 17:39:00 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,6 +29,7 @@
 
 #include <blob/init.h>
 #include <blob/serial.h>
+#include <blob/time.h>
 
 
 
@@ -37,6 +38,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(shannon_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/smdk2500.c
diff -u /dev/null build_tree/bootLoader/src/diag/smdk2500.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/smdk2500.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,45 @@
+/*
+ * smdk2500.c: Samsung s3c25000 evaluation board specific stuff
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Copyright (C) 2003  Russ Dill <Russ.Dill@asu.edu>
+ *
+ * $Id: smdk2500.c,v 1.1 2003/09/04 18:10:42 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: smdk2500.c,v 1.1 2003/09/04 18:10:42 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/serial.h>
+#include <blob/time.h>
+
+
+
+
+static void s3c2500_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &s3c2500_serial_driver;
+	timer_driver = &s3c2500_timer_driver;
+}
+
+__initlist(s3c2500_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/stack.S
diff -u build_tree/bootLoader/src/diag/stack.S:1.1.1.1 build_tree/bootLoader/src/diag/stack.S:removed
--- build_tree/bootLoader/src/diag/stack.S:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/stack.S	Tue Jan  8 14:21:47 2008
@@ -1,33 +0,0 @@
-/*
- * stack.S: diag stack
- *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * $Id: stack.S,v 1.1 2001/10/28 22:14:20 erikm Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-.ident "$Id: stack.S,v 1.1 2001/10/28 22:14:20 erikm Exp $"
-
-#ifdef HAVE_CONFIG_H
-# include <blob/config.h>
-#endif
-
-
-.section ".stack"
-	/* 8kB stack should be enough */
-	.space	(8 * 1024)
Index: build_tree/bootLoader/src/diag/system3.c
diff -u build_tree/bootLoader/src/diag/system3.c:1.1.1.1 build_tree/bootLoader/src/diag/system3.c:1.1.1.2
--- build_tree/bootLoader/src/diag/system3.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/diag/system3.c	Fri Nov  9 09:44:05 2007
@@ -5,7 +5,7 @@
  *
  * Implements several POST routines for PT System 3 platform
  *
- * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.net>
+ * Copyright (C) 2001 Stefan Eletzhofer <stefan.eletzhofer@www.eletztrick.de>
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -22,7 +22,7 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  */
 
-#ident "$Id: system3.c,v 1.8 2002/01/07 19:36:15 seletz Exp $"
+#ident "$Id: system3.c,v 1.13 2003/09/04 17:39:00 russd Exp $"
 
 /**********************************************************************
  * Includes
@@ -38,8 +38,8 @@
 #include <blob/init.h>
 #include <blob/serial.h>
 #include <blob/time.h>
-#include <blob/sa1100.h>
-#include <blob/sa1111.h>
+#include <blob/arch.h>
+#include <blob/proc/sa1111.h>
 
 #include <blob/lcd.h>
 
@@ -50,10 +50,6 @@
 #define SET(reg,bit)	((reg) |= (1<<(bit)))
 #define CLR(reg,bit)	((reg) &= ~(1<<(bit)))
 
-/* Optimization barrier */
-/* The "volatile" is due to gcc bugs */
-#define barrier() __asm__ __volatile__("": : :"memory")
-
 #define	CPLD_BASE	(0x10000000)
 #define	CPLD_ID		(CPLD_BASE + 0x00)
 #define	CPLD_IRQ	(CPLD_BASE + 0x24)
@@ -132,6 +128,7 @@
 {
 	/* select serial driver */
 	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
 }
 
 __initlist(system3_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
Index: build_tree/bootLoader/src/diag/trizeps.c
diff -u /dev/null build_tree/bootLoader/src/diag/trizeps.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/diag/trizeps.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,59 @@
+/*
+ * trizeps.c: Keith & Koep Trizeps specific stuff
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ *
+ * $Id: trizeps.c,v 1.4 2003/09/04 17:39:00 russd Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: trizeps.c,v 1.4 2003/09/04 17:39:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+
+#include <blob/init.h>
+#include <blob/serial.h>
+
+#include <blob/time.h>
+// #include <blob/arch.h>
+// #include <blob/proc/sa1111.h>
+
+// #include <blob/lcd.h>
+
+
+#define MEM(adr)	(*((u32*)adr))
+#define SET(reg,bit)	((reg) |= (1<<(bit)))
+#define CLR(reg,bit)	((reg) &= ~(1<<(bit)))
+
+
+static void trizeps_init_hardware(void)
+{
+	/* select serial driver */
+	serial_driver = &sa11x0_serial_driver;
+	timer_driver = &intelarm_timer_driver;
+}
+
+__initlist(trizeps_init_hardware, INIT_LEVEL_DRIVER_SELECTION);
+
+/* eof */
Index: build_tree/bootLoader/src/lib/.cvsignore
diff -u /dev/null build_tree/bootLoader/src/lib/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,5 @@
+Makefile.in
+Makefile
+*.o
+*.a
+.deps
Index: build_tree/bootLoader/src/lib/Makefile.am
diff -u build_tree/bootLoader/src/lib/Makefile.am:1.1.1.1 build_tree/bootLoader/src/lib/Makefile.am:1.1.1.3
--- build_tree/bootLoader/src/lib/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/Makefile.am	Fri Nov  9 10:37:08 2007
@@ -4,7 +4,7 @@
 #
 # Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
 #
-# $Id: Makefile.am,v 1.9 2002/01/06 18:59:40 erikm Exp $
+# $Id: Makefile.am,v 1.33 2003/09/04 18:03:09 russd Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -27,26 +27,95 @@
 
 libblob_a_SOURCES	= \
 	command.c \
+	crc32.c \
+	download.c \
 	error.c \
+	ether.c \
 	icache.c \
 	init.c \
 	led.c \
 	md5.c \
 	md5support.c \
+	memcmp.c \
 	memcpy.c \
+	memset.c \
+	mini_inflate.c \
+	printf.c \
 	reboot.c \
 	serial.c \
-	serial-sa11x0.c \
-	strncpy.c \
+	serial_usb.c \
 	strlen.c \
 	strncmp.c \
+	strncpy.c \
 	strtou32.c \
-	terminal.c \
 	time.c \
 	util.c
 
+EXTRA_libblob_a_SOURCES = \
+	ether-s3c2500.c \
+	ether-smc9196.c \
+	led-mmap.c \
+	led-s3c2500.c \
+	led-sa11x0.c \
+	reboot-pxa.c \
+	reboot-s3c2500.c \
+	reboot-sa11x0.c \
+	serial-pxa.c \
+	serial-s3c2500.c \
+	serial-sa11x0.c \
+	serial-bvdusb.c \
+	time-intelarm.c \
+	time-s3c2500.c \
+	time-null.c \
+	arp.c \
+	bootp.c \
+	tftp.c \
+	ip_bits.c\
+	ide.c \
+	pcmcia.c \
+	cf.c \
+	generic_io.c \
+	gio_part_blob.c \
+	gio_ram.c \
+	gio_flash.c \
+	i2c-gpio.c \
+	i2c.c \
+	tar.c \
+        pxa-bb-spi.c \
+		pxa-lcd.c
+
+
+libblob_a_DEPENDENCIES = \
+	@BLOB_REBOOT_DRIVER_OBJS@ \
+	@BLOB_SERIAL_DRIVER_OBJS@ \
+	@BLOB_TIMER_DRIVER_OBJS@ \
+	@BLOB_LED_DRIVER_OBJS@ \
+	@BLOB_NETWORK_OBJS@ \
+	@BLOB_NETWORK_DRIVER_OBJS@ \
+	@BLOB_USBSERIAL_OBJS@ \
+	@BLOB_PCMCIA_OBJS@ \
+	@BLOB_IDE_OBJS@ \
+	@BLOB_CF_OBJS@ \
+	@BLOB_GIO_OBJS@ \
+        @BLOB_SPI_OBJS@ \
+		@BLOB_LCD_OBJS@
+
+libblob_a_LIBADD = \
+	@BLOB_REBOOT_DRIVER_OBJS@ \
+	@BLOB_SERIAL_DRIVER_OBJS@ \
+	@BLOB_TIMER_DRIVER_OBJS@ \
+	@BLOB_LED_DRIVER_OBJS@ \
+	@BLOB_NETWORK_OBJS@ \
+	@BLOB_NETWORK_DRIVER_OBJS@ \
+	@BLOB_USBSERIAL_OBJS@ \
+	@BLOB_PCMCIA_OBJS@ \
+	@BLOB_IDE_OBJS@ \
+	@BLOB_CF_OBJS@ \
+	@BLOB_GIO_OBJS@ \
+        @BLOB_SPI_OBJS@ \
+		@BLOB_LCD_OBJS@
 
-INCLUDES		+= \
+INCLUDES		= \
 	-I${top_builddir}/include \
 	-I${top_srcdir}/include
 
Index: build_tree/bootLoader/src/lib/Makefile.in
diff -u build_tree/bootLoader/src/lib/Makefile.in:1.1.1.1 build_tree/bootLoader/src/lib/Makefile.in:1.2
--- build_tree/bootLoader/src/lib/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,13 +12,15 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 #
 # Makefile.am
 #
 # Copyright (C) 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
 #
-# $Id: Makefile.am,v 1.9 2002/01/06 18:59:40 erikm Exp $
+# $Id: Makefile.am,v 1.33 2003/09/04 18:03:09 russd Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -33,326 +37,587 @@
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
 #
 
-
-SHELL = @SHELL@
+SOURCES = $(libblob_a_SOURCES) $(EXTRA_libblob_a_SOURCES)
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ../..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = src/lib
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+ARFLAGS = cru
+LIBRARIES = $(noinst_LIBRARIES)
+libblob_a_AR = $(AR) $(ARFLAGS)
+am_libblob_a_OBJECTS = command.$(OBJEXT) crc32.$(OBJEXT) \
+	download.$(OBJEXT) error.$(OBJEXT) ether.$(OBJEXT) \
+	icache.$(OBJEXT) init.$(OBJEXT) led.$(OBJEXT) md5.$(OBJEXT) \
+	md5support.$(OBJEXT) memcmp.$(OBJEXT) memcpy.$(OBJEXT) \
+	memset.$(OBJEXT) mini_inflate.$(OBJEXT) printf.$(OBJEXT) \
+	reboot.$(OBJEXT) serial.$(OBJEXT) serial_usb.$(OBJEXT) \
+	strlen.$(OBJEXT) strncmp.$(OBJEXT) strncpy.$(OBJEXT) \
+	strtou32.$(OBJEXT) time.$(OBJEXT) util.$(OBJEXT)
+libblob_a_OBJECTS = $(am_libblob_a_OBJECTS)
+DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)/include/blob
+depcomp = $(SHELL) $(top_srcdir)/tools/depcomp
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/arp.Po ./$(DEPDIR)/bootp.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/cf.Po ./$(DEPDIR)/command.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/crc32.Po ./$(DEPDIR)/download.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/error.Po ./$(DEPDIR)/ether-s3c2500.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ether-smc9196.Po ./$(DEPDIR)/ether.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/generic_io.Po ./$(DEPDIR)/gio_flash.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/gio_part_blob.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/gio_ram.Po ./$(DEPDIR)/i2c-gpio.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/i2c.Po ./$(DEPDIR)/icache.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ide.Po ./$(DEPDIR)/init.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/ip_bits.Po ./$(DEPDIR)/led-mmap.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/led-s3c2500.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/led-sa11x0.Po ./$(DEPDIR)/led.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/md5.Po ./$(DEPDIR)/md5support.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/memcmp.Po ./$(DEPDIR)/memcpy.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/memset.Po ./$(DEPDIR)/mini_inflate.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/pcmcia.Po ./$(DEPDIR)/printf.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/reboot-pxa.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/reboot-s3c2500.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/reboot-sa11x0.Po ./$(DEPDIR)/reboot.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/serial-bvdusb.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/serial-pxa.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/serial-s3c2500.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/serial-sa11x0.Po ./$(DEPDIR)/serial.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/serial_usb.Po ./$(DEPDIR)/strlen.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/strncmp.Po ./$(DEPDIR)/strncpy.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/strtou32.Po ./$(DEPDIR)/tar.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/tftp.Po ./$(DEPDIR)/time-intelarm.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/time-null.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/time-s3c2500.Po ./$(DEPDIR)/time.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/util.Po
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(libblob_a_SOURCES) $(EXTRA_libblob_a_SOURCES)
+DIST_SOURCES = $(libblob_a_SOURCES) $(EXTRA_libblob_a_SOURCES)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-noinst_LIBRARIES =  	libblob.a
-
-
-libblob_a_SOURCES =  	command.c 	error.c 	icache.c 	init.c 	led.c 	md5.c 	md5support.c 	memcpy.c 	reboot.c 	serial.c 	serial-sa11x0.c 	strncpy.c 	strlen.c 	strncmp.c 	strtou32.c 	terminal.c 	time.c 	util.c
-
-
-INCLUDES =  	-I${top_builddir}/include 	-I${top_srcdir}/include
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+noinst_LIBRARIES = \
+	libblob.a
+
+libblob_a_SOURCES = \
+	command.c \
+	crc32.c \
+	download.c \
+	error.c \
+	ether.c \
+	icache.c \
+	init.c \
+	led.c \
+	md5.c \
+	md5support.c \
+	memcmp.c \
+	memcpy.c \
+	memset.c \
+	mini_inflate.c \
+	printf.c \
+	reboot.c \
+	serial.c \
+	serial_usb.c \
+	strlen.c \
+	strncmp.c \
+	strncpy.c \
+	strtou32.c \
+	time.c \
+	util.c
+
+EXTRA_libblob_a_SOURCES = \
+	ether-s3c2500.c \
+	ether-smc9196.c \
+	led-mmap.c \
+	led-s3c2500.c \
+	led-sa11x0.c \
+	reboot-pxa.c \
+	reboot-s3c2500.c \
+	reboot-sa11x0.c \
+	serial-pxa.c \
+	serial-s3c2500.c \
+	serial-sa11x0.c \
+	serial-bvdusb.c \
+	time-intelarm.c \
+	time-s3c2500.c \
+	time-null.c \
+	arp.c \
+	bootp.c \
+	tftp.c \
+	ip_bits.c\
+	ide.c \
+	pcmcia.c \
+	cf.c \
+	generic_io.c \
+	gio_part_blob.c \
+	gio_ram.c \
+	gio_flash.c \
+	i2c-gpio.c \
+	i2c.c \
+	tar.c \
+    pxa-bb-spi.c \
+	pxa-lcd.c
+
+libblob_a_DEPENDENCIES = \
+	@BLOB_REBOOT_DRIVER_OBJS@ \
+	@BLOB_SERIAL_DRIVER_OBJS@ \
+	@BLOB_TIMER_DRIVER_OBJS@ \
+	@BLOB_LED_DRIVER_OBJS@ \
+	@BLOB_NETWORK_OBJS@ \
+	@BLOB_NETWORK_DRIVER_OBJS@ \
+	@BLOB_USBSERIAL_OBJS@ \
+	@BLOB_PCMCIA_OBJS@ \
+	@BLOB_IDE_OBJS@ \
+	@BLOB_CF_OBJS@ \
+	@BLOB_GIO_OBJS@ \
+        @BLOB_SPI_OBJS@ \
+		@BLOB_LCD_OBJS@
+
+libblob_a_LIBADD = \
+	@BLOB_REBOOT_DRIVER_OBJS@ \
+	@BLOB_SERIAL_DRIVER_OBJS@ \
+	@BLOB_TIMER_DRIVER_OBJS@ \
+	@BLOB_LED_DRIVER_OBJS@ \
+	@BLOB_NETWORK_OBJS@ \
+	@BLOB_NETWORK_DRIVER_OBJS@ \
+	@BLOB_USBSERIAL_OBJS@ \
+	@BLOB_PCMCIA_OBJS@ \
+	@BLOB_IDE_OBJS@ \
+	@BLOB_CF_OBJS@ \
+	@BLOB_GIO_OBJS@ \
+        @BLOB_SPI_OBJS@ \
+		@BLOB_LCD_OBJS@
+
+INCLUDES = \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include
 
 CLEANFILES = ${srcdir}/*~
-
 DISTCLEANFILES = ${builddir}/.deps/*.P
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-LIBRARIES =  $(noinst_LIBRARIES)
-
+all: all-am
 
-DEFS = @DEFS@ -I. -I$(srcdir) -I../../include/blob
-CPPFLAGS = @CPPFLAGS@
-LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
-libblob_a_LIBADD = 
-libblob_a_OBJECTS =  command.o error.o icache.o init.o led.o md5.o \
-md5support.o memcpy.o reboot.o serial.o serial-sa11x0.o strncpy.o \
-strlen.o strncmp.o strtou32.o terminal.o time.o util.o
-CFLAGS = @CFLAGS@
-COMPILE = $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
-CCLD = $(CC)
-LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(LDFLAGS) -o $@
-DIST_COMMON =  Makefile.am Makefile.in
-
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-SOURCES = $(libblob_a_SOURCES)
-OBJECTS = $(libblob_a_OBJECTS)
-
-all: all-redirect
 .SUFFIXES:
-.SUFFIXES: .S .c .o .s
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps src/lib/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
-
-mostlyclean-noinstLIBRARIES:
+.SUFFIXES: .c .o .obj
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  src/lib/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  src/lib/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 
 clean-noinstLIBRARIES:
 	-test -z "$(noinst_LIBRARIES)" || rm -f $(noinst_LIBRARIES)
-
-distclean-noinstLIBRARIES:
-
-maintainer-clean-noinstLIBRARIES:
-
-.c.o:
-	$(COMPILE) -c $<
-
-.s.o:
-	$(COMPILE) -c $<
-
-.S.o:
-	$(COMPILE) -c $<
+libblob.a: $(libblob_a_OBJECTS) $(libblob_a_DEPENDENCIES) 
+	-rm -f libblob.a
+	$(libblob_a_AR) libblob.a $(libblob_a_OBJECTS) $(libblob_a_LIBADD)
+	$(RANLIB) libblob.a
 
 mostlyclean-compile:
-	-rm -f *.o core *.core
-
-clean-compile:
+	-rm -f *.$(OBJEXT)
 
 distclean-compile:
 	-rm -f *.tab.c
 
-maintainer-clean-compile:
-
-libblob.a: $(libblob_a_OBJECTS) $(libblob_a_DEPENDENCIES)
-	-rm -f libblob.a
-	$(AR) cru libblob.a $(libblob_a_OBJECTS) $(libblob_a_LIBADD)
-	$(RANLIB) libblob.a
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/arp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/bootp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/cf.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/command.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/crc32.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/download.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/error.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ether-s3c2500.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ether-smc9196.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ether.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/generic_io.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/gio_flash.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/gio_part_blob.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/gio_ram.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/i2c-gpio.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/i2c.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/icache.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ide.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/init.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/ip_bits.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/led-mmap.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/led-s3c2500.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/led-sa11x0.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/led.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/md5.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/md5support.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memcmp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memcpy.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/memset.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mini_inflate.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/pcmcia.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/printf.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reboot-pxa.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reboot-s3c2500.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reboot-sa11x0.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/reboot.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/serial-bvdusb.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/serial-pxa.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/serial-s3c2500.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/serial-sa11x0.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/serial.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/serial_usb.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/strlen.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/strncmp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/strncpy.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/strtou32.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/tar.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/tftp.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/time-intelarm.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/time-null.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/time-s3c2500.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/time.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/util.Po@am__quote@
 
+.c.o:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c `$(CYGPATH_W) '$<'`
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
 tags: TAGS
 
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
-
-TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = src/lib
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-command.o: command.c ../../include/blob/config.h \
-	../../include/blob/command.h ../../include/blob/types.h \
-	../../include/blob/errno.h ../../include/blob/error.h \
-	../../include/blob/init.h ../../include/blob/serial.h \
-	../../include/blob/time.h ../../include/blob/util.h
-error.o: error.c ../../include/blob/config.h ../../include/blob/errno.h \
-	../../include/blob/error.h ../../include/blob/serial.h \
-	../../include/blob/types.h
-icache.o: icache.c ../../include/blob/config.h \
-	../../include/blob/icache.h ../../include/blob/types.h
-init.o: init.c ../../include/blob/config.h ../../include/blob/errno.h \
-	../../include/blob/error.h ../../include/blob/init.h \
-	../../include/blob/types.h ../../include/blob/serial.h
-led.o: led.c ../../include/blob/config.h ../../include/blob/arch.h \
-	../../include/blob/arch/lart.h ../../include/blob/led.h \
-	../../include/blob/sa1100.h ../../include/blob/init.h \
-	../../include/blob/types.h
-md5.o: md5.c ../../include/blob/config.h ../../include/blob/md5.h \
-	../../include/blob/types.h ../../include/blob/util.h
-md5support.o: md5support.c ../../include/blob/config.h \
-	../../include/blob/md5support.h ../../include/blob/types.h \
-	../../include/blob/serial.h
-memcpy.o: memcpy.c ../../include/blob/config.h ../../include/blob/util.h \
-	../../include/blob/types.h
-reboot.o: reboot.c ../../include/blob/config.h \
-	../../include/blob/serial.h ../../include/blob/types.h \
-	../../include/blob/sa1100.h
-serial-sa11x0.o: serial-sa11x0.c ../../include/blob/config.h \
-	../../include/blob/arch.h ../../include/blob/arch/lart.h \
-	../../include/blob/errno.h ../../include/blob/sa1100.h \
-	../../include/blob/serial.h ../../include/blob/types.h
-serial.o: serial.c ../../include/blob/config.h ../../include/blob/arch.h \
-	../../include/blob/arch/lart.h ../../include/blob/errno.h \
-	../../include/blob/led.h ../../include/blob/sa1100.h \
-	../../include/blob/serial.h ../../include/blob/types.h \
-	../../include/blob/time.h
-strlen.o: strlen.c ../../include/blob/config.h ../../include/blob/util.h \
-	../../include/blob/types.h
-strncmp.o: strncmp.c ../../include/blob/config.h \
-	../../include/blob/util.h ../../include/blob/types.h
-strncpy.o: strncpy.c ../../include/blob/config.h \
-	../../include/blob/util.h ../../include/blob/types.h
-strtou32.o: strtou32.c ../../include/blob/config.h \
-	../../include/blob/types.h ../../include/blob/util.h
-terminal.o: terminal.c ../../include/blob/config.h \
-	../../include/blob/serial.h ../../include/blob/types.h \
-	../../include/blob/terminal.h
-time.o: time.c ../../include/blob/config.h ../../include/blob/init.h \
-	../../include/blob/types.h ../../include/blob/led.h \
-	../../include/blob/sa1100.h ../../include/blob/time.h
-util.o: util.c ../../include/blob/config.h ../../include/blob/types.h \
-	../../include/blob/util.h ../../include/blob/serial.h
-
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
 check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am:
+all-am: Makefile $(LIBRARIES)
+installdirs:
+install: install-am
 install-exec: install-exec-am
-
-install-data-am:
 install-data: install-data-am
+uninstall: uninstall-am
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am:
-uninstall: uninstall-am
-all-am: Makefile $(LIBRARIES)
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-
 
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 	-test -z "$(DISTCLEANFILES)" || rm -f $(DISTCLEANFILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-noinstLIBRARIES mostlyclean-compile \
-		mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
 
-mostlyclean: mostlyclean-am
+clean-am: clean-generic clean-noinstLIBRARIES mostlyclean-am
 
-clean-am:  clean-noinstLIBRARIES clean-compile clean-tags clean-generic \
-		mostlyclean-am
+distclean: distclean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
 
-clean: clean-am
+dvi: dvi-am
 
-distclean-am:  distclean-noinstLIBRARIES distclean-compile \
-		distclean-tags distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-am
+html: html-am
 
-maintainer-clean-am:  maintainer-clean-noinstLIBRARIES \
-		maintainer-clean-compile maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
 
-.PHONY: mostlyclean-noinstLIBRARIES distclean-noinstLIBRARIES \
-clean-noinstLIBRARIES maintainer-clean-noinstLIBRARIES \
-mostlyclean-compile distclean-compile clean-compile \
-maintainer-clean-compile tags mostlyclean-tags distclean-tags \
-clean-tags maintainer-clean-tags distdir info-am info dvi-am dvi check \
-check-am installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+uninstall-am: uninstall-info-am
 
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
+	clean-noinstLIBRARIES ctags distclean distclean-compile \
+	distclean-generic distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-data \
+	install-data-am install-exec install-exec-am install-info \
+	install-info-am install-man install-strip installcheck \
+	installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/src/lib/arp.c
diff -u /dev/null build_tree/bootLoader/src/lib/arp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/arp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,153 @@
+/*
+ *  arp.c
+ *
+ *  Copyright 1996-2001 Russell King
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+//#include "init.h"
+#include <blob/util.h>
+#include <blob/serial.h>
+#include <net/net.h>
+#include <net/ether.h>
+#include <net/arp.h>
+
+#undef ARP_DEBUG
+#ifdef ARP_DEBUG
+static int dbg = 1;
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... ) ;
+#endif
+
+static const unsigned char arp_txpacket[] =
+	{					/* destination address			*/
+						/* source address			*/
+	 0x08, 0x06,				/* proto				*/
+	 /* arp */
+	 0x00, 0x01,				/* hardware format: ethernet		*/
+	 0x08, 0x00,				/* protocol format: ip			*/
+	 0x06,					/* hardware length			*/
+	 0x04,					/* protocol length			*/
+	 0x00, 0x01				/* arp request				*/
+	};
+
+static unsigned char arp_tx[64];
+static unsigned char arp_rx[64];
+
+int arp_rcv (unsigned char *thwaddress)
+{
+	unsigned int size;
+
+	size = ether_rcv (arp_rx, sizeof(arp_rx));
+	if (!size)
+		return 0;
+
+	if (!memeq (arp_rx + 12, arp_tx + 12, 9))
+		return 0;			/* not valid reply			*/
+
+	if (arp_rx[21] != 2)
+		return 0;			/* reply				*/
+
+	if (!memeq (arp_rx + 28, arp_tx + 38, 4))
+		return 0;			/* target ip address			*/
+
+	memcpy (thwaddress, arp_rx + 22, 6);
+	return 1;
+}
+
+int do_arp(unsigned char *thwaddress, unsigned char *tipaddress)
+{
+	int i;
+	unsigned char *p = arp_tx;
+	int retry = 8;
+
+	memzero (p, sizeof (arp_tx));
+	memset  (p, 0xff, 6);
+	memcpy  (p + 12, arp_txpacket, sizeof (arp_txpacket));
+	memcpy  (p + 22, hwaddress, 6);
+	memcpy  (p + 28, clientipaddress, 4);
+	memcpy  (p + 38, tipaddress, 4);
+
+	do {
+		ether_snd (arp_tx, sizeof(arp_tx));
+
+		for (i = 0; i < 0x00040000; i++) {
+			if (arp_rcv (thwaddress))
+				return 0;
+		}
+	} while (--retry);
+
+	return -1;
+}
+
+int do_arp_reply(unsigned char *rx_pkt, unsigned int size)
+{
+	struct ether_hdr *eth_request = (struct ether_hdr *)rx_pkt;
+	struct arp_packet *request = (struct arp_packet *)(rx_pkt+sizeof(struct ether_hdr));
+	u8 bcast[6] = { [0 ... 5] 0xff };
+	struct arp_packet reply = {
+		.hw_type = HTON( 0x0001 ),
+		.proto_type = HTON( 0x0800 ),
+		.hw_len = 6,
+		.proto_len = 4,
+		.opcode = HTON( 0x0002 )
+	};
+	struct ether_hdr eth_reply;
+
+	DBG( 1, "%s: ETH: %02x:%02x:%02x:%02x:%02x:%02x"
+			" %02x:%02x:%02x:%02x:%02x:%02x proto 0x%04x\n", __FUNCTION__,
+			eth_request->dest[0], eth_request->dest[1], eth_request->dest[2],
+			eth_request->dest[3], eth_request->dest[4], eth_request->dest[5],
+			eth_request->src[0], eth_request->src[1], eth_request->src[2],
+			eth_request->src[3], eth_request->src[4], eth_request->src[5],
+			HTON( eth_request->proto ));
+
+
+	/* is it for us or broadcast? */
+	if ( !memeq( eth_request->dest, hwaddress, 6 ) && !memeq( eth_request->dest, bcast, 6 ))
+		return -1;
+
+	DBG( 1, "%s: opcode 0x%04x\n", __FUNCTION__, HTON( request->opcode ) );
+
+	/* is it an arp request? */
+	if ( request->opcode != HTON( 0x0001 ) )
+		return -1;
+
+	DBG( 1, "%s: got an arp request from IP %d.%d.%d.%d requesting %d.%d.%d.%d\n", __FUNCTION__,
+			request->sender.ip[0],
+			request->sender.ip[1],
+			request->sender.ip[2],
+			request->sender.ip[3],
+			request->target.ip[0],
+			request->target.ip[1],
+			request->target.ip[2],
+			request->target.ip[3]
+			);
+
+	/* requesting our IP ? */
+	if ( !memeq( request->target.ip, clientipaddress, 4 ))
+		return -1;
+
+	DBG( 1, "%s: arp request for our IP\n", __FUNCTION__ );
+
+	/* ethernet header */
+	eth_reply.proto = HTON( 0x0806 );	/* ARP */
+	memcpy( eth_reply.dest, eth_request->src, 6 );
+	memcpy( eth_reply.src, hwaddress, 6 );
+
+	/* arp reply */
+	memcpy(reply.sender.hw, hwaddress, 6);
+	memcpy(reply.sender.ip, clientipaddress, 4);
+	memcpy(reply.target.hw, request->sender.hw, 6);
+	memcpy(reply.target.ip, request->sender.ip, 4);
+
+	memzero(arp_tx, sizeof(arp_tx));
+	memcpy(arp_tx, &eth_reply, sizeof(struct ether_hdr));
+	memcpy(arp_tx + sizeof(struct ether_hdr), &reply, sizeof(struct arp_packet));
+
+	ether_snd(arp_tx, sizeof(arp_tx));
+	return 0;
+}
Index: build_tree/bootLoader/src/lib/bootp.c
diff -u /dev/null build_tree/bootLoader/src/lib/bootp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/bootp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,121 @@
+/*
+ *  bootp.c
+ *
+ *  Copyright 1996-2001 Russell King
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+#include <blob/util.h>
+#include <blob/serial.h>
+#include <net/net.h>
+#include <net/ip_bits.h>
+
+static const unsigned char bootp_txpacket[] =
+	{					/* destination - broadcast		*/
+						/*+source address			*/
+	 					/* protocol - ip			*/
+	 /* IP (14) */
+	 0x45, 0x00, 0x01, 0x48,		/* ver/ihl, TOS, length			*/
+	 0x00, 0x00,				/*+id					*/
+	 0x00, 0x00, 0x40, 0x11,		/* frag off, ttl, proto			*/
+	 0x00, 0x00,				/*+checksum				*/
+	 0x00, 0x00, 0x00, 0x00,		/* source address (unknown)		*/
+	 0xff, 0xff, 0xff, 0xff,		/* destination address (broadcast)	*/
+	 /* UDP (34) */
+	 0x00, 0x44,				/* source port				*/
+	 0x00, 0x43,				/* destination port			*/
+	 0x01, 0x34,				/* length (inc header)			*/
+	 0x00, 0x00,				/*+checksum				*/
+	 /* BOOTP (42) */
+	 0x01,					/* Bootp REQUEST			*/
+	 0x01,					/* Hardware type - ethernet		*/
+	 0x06,					/* Hardware address length		*/
+#if 0
+	 0x00,					/* HOPS ???				*/
+	 0x00, 0x00, 0x00, 0x00,		/*+random ID				*/
+	 0x00, 0x00, 0x00, 0x00,		/*+time					*/
+	 0x00, 0x00, 0x00, 0x00,		/* Client IP				*/
+	 0x00, 0x00, 0x00, 0x00,		/* Your IP				*/
+	 0x00, 0x00, 0x00, 0x00,		/* Server IP				*/
+	 0x00, 0x00, 0x00, 0x00,		/* Gateway IP				*/
+	 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,	/*+Hardware address we're asking for	*/
+#endif
+	};
+
+
+static unsigned int bootp_xid = 0xd1030000;	/* bootp_xid is net byte order */
+static unsigned long zero = 0;
+static unsigned char bootp_tx[42 + 300];
+static unsigned char bootp_rx[42 + 400];
+
+unsigned char clientipaddress[4];
+unsigned char serveripaddress[4];
+unsigned char tftpfilename[128];
+
+int bootp_rcv (void)
+{
+	unsigned int bootp_off, bootp_sz;
+	unsigned char *bootp;
+	int i;
+
+	if ((bootp_off = ipbits_rcv (bootp_rx, 360, &bootp_sz, 0x43, 0x44)) == 0)
+		return 0;
+
+	bootp = bootp_rx + bootp_off;
+
+	if (bootp[0] != 2 || bootp[1] != 1 || bootp[2] != 6)
+		return 0;			/* not reply or wrong hardware type (error?) */
+
+	if (!memeq (bootp + 4, &bootp_xid, 4))
+		return 0;			/* wrong xid */
+
+	if (!memeq (bootp + 12, &zero, 4))
+		return 0;			/* not our client IP (error?) */
+
+	if (!memeq (bootp + 28, hwaddress, 6))
+		return 0;			/* not our hardware address (error?) */
+
+	memcpy (clientipaddress, bootp + 16, 4);	/* grab our & server ip addresses */
+	memcpy (serveripaddress, bootp + 20, 4);
+
+	for (i = 0; i < 127; i++)
+		if ((tftpfilename[i] = bootp[108 + i]) == 0)
+			break;
+	tftpfilename[i] = '\0';
+
+	printip ("\nOur IP   : ", clientipaddress);
+	printip ("\nServer IP: ", serveripaddress);
+	printascii ("\nTFTP file: ");
+	printascii (tftpfilename);
+	printascii ("\n");
+	return 1;
+}
+
+char *do_bootp (void)
+{
+	unsigned int request_time = 0;
+	unsigned int packet_length;
+	int i;
+
+	memzero (bootp_tx, sizeof (bootp_tx));
+	memcpy (bootp_tx + 14, bootp_txpacket, sizeof (bootp_txpacket));
+	memset (bootp_tx + OFF_ETHER, 0xff, 6);
+	memcpy (bootp_tx + OFF_BOOTP + 28, hwaddress, 6);
+	memcpy (bootp_tx + OFF_BOOTP + 4, &bootp_xid, 4);
+	packet_length = (bootp_tx[OFF_UDP + 4] << 8) + bootp_tx[OFF_UDP + 5];
+	printascii ("Sending bootp request");
+
+	do {
+		printch ('.');
+		bootp_tx[OFF_BOOTP + 8] = request_time >> 8;
+		bootp_tx[OFF_BOOTP + 9] = request_time;
+		request_time ++;
+		ipbits_tx (bootp_tx, packet_length);
+
+		for (i = 0; i < 0x00030000; i++)
+			if (bootp_rcv())
+				return tftpfilename;
+	} while (1);
+}
Index: build_tree/bootLoader/src/lib/cf.c
diff -u /dev/null build_tree/bootLoader/src/lib/cf.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/cf.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,364 @@
+/**********************************************************************
+ * cf.c: compact flash IDE access
+ *
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: cf.c,v 1.5 2002/05/10 15:41:16 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/time.h>
+#include <blob/command.h>
+
+#include <blob/init.h>
+#include <blob/generic_io.h>
+#include <blob/pcmcia.h>
+#include <blob/ide.h>
+#include <blob/cf.h>
+
+/**********************************************************************
+ * defines
+ */
+#define CF_DEBUG 1
+
+/* define this to activate module test cmd */
+#define CF_TEST_MODULE 0
+
+#if CF_DEBUG
+#	define DBG( x, args... )	if ( cf_dbg>x ) printf( args );
+#else
+#	define DBG( x, args... )	
+#endif
+
+/**********************************************************************
+ * module globals
+ */
+#if CF_DEBUG
+static int cf_dbg = 1;
+#else
+static int cf_dbg = 0;
+#endif
+
+static char module_version[] = "$Id: cf.c,v 1.5 2002/05/10 15:41:16 seletz Exp $";
+
+/* static atm. Do we need more than one CF card? */
+static int	cf_slot = 1;
+static u32	cf_slot_base = 0L;
+static u32	cf_slot_attr = 0L;
+static ide_drive_t	drive;
+
+/**********************************************************************
+ * static functions
+ */
+static int cf_io_conf( io_driver_t *io, void *conf );
+static int cf_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+static int cf_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+
+/**********************************************************************/
+/**********************************************************************/
+/**********************************************************************/
+
+/* set debug level */
+void cf_dbg_set( int lvl )
+{
+	cf_dbg = lvl;
+}
+
+/*****************************************************************
+ * cf_init - initialize CF card plugged in slot <slot>
+ */
+int cf_init( int slot )
+{
+	int ret = 0;
+	u16 cfg_reg;
+	u8	cfgvalue;
+	u8	value;
+
+	DBG( 1, "%s: %s\n", __FUNCTION__, module_version );
+
+	ret = pcmcia_init();
+	if ( ret != 0 )
+		return -EINVAL;
+
+	if ( cf_dbg > 10 ) {
+		pcmcia_dbg_set( 5 );
+		ide_dbg_set( 5 );
+	}
+
+	ret = pcmcia_slot_detect( slot );
+	if ( !ret )
+		return -EINVAL;
+
+	printf( "cf: slot %d detected\n", slot );
+
+	ret = pcmcia_slot_enable( slot );
+	if ( ret )
+		return -EINVAL;
+
+	ret = pcmcia_slot_address_get( slot, &cf_slot_base, &cf_slot_attr );
+	if ( ret )
+		return -EINVAL;
+
+	ret = pcmcia_slot_reset( slot );
+	if ( ret )
+		return -EINVAL;
+
+	ret = pcmcia_cis_parse( slot );
+	if ( ret )
+		return -EINVAL;
+
+	ret = pcmcia_slot_cfg_reg_get( slot, &cfg_reg );
+	if ( ret )
+		return -EINVAL;
+	DBG( 2, "cf: slot %d config register: 0x%03x\n", slot, cfg_reg );
+
+	pcmcia_slot_attr_read( slot, CF_REG_CFG, &cfgvalue );
+	DBG( 2, "slot %d config register: 0x%02x = 0x%02x\n", slot, CF_REG_CFG, cfgvalue );
+
+	pcmcia_slot_attr_read( slot, CF_REG_CFGSTAT, &value );
+	DBG( 2, "slot %d config status register: 0x%02x = 0x%02x\n", slot, CF_REG_CFGSTAT, value );
+
+	/* reset CF card */
+	pcmcia_slot_attr_write( slot, CF_REG_CFG, cfgvalue | CF_CFG_SRST );
+	msleep(1);
+	pcmcia_slot_attr_write( slot, CF_REG_CFG, cfgvalue & (~CF_CFG_SRST) );
+	pcmcia_slot_attr_read( slot, CF_REG_CFG, &cfgvalue );
+	DBG( 2, "slot %d config register: 0x%02x = 0x%02x\n", slot, CF_REG_CFG, cfgvalue );
+
+
+	/* configure for true ide mode */
+	pcmcia_slot_attr_write( slot, CF_REG_CFG, cfgvalue | CF_CFG_IO_IDE0 );
+	pcmcia_slot_attr_read( slot, CF_REG_CFG, &cfgvalue );
+	DBG( 2, "slot %d config register: 0x%02x = 0x%02x\n", slot, CF_REG_CFG, cfgvalue );
+
+	pcmcia_slot_attr_read( slot, CF_REG_CFGSTAT, &value );
+	DBG( 2, "slot %d config status register: 0x%02x = 0x%02x\n", slot, CF_REG_CFGSTAT, value );
+
+	DBG( 2, "slot %d enabled\n", slot );
+
+	ret = ide_init( &drive, (u32)cf_slot_base );
+	if ( ret )
+		return -EINVAL;
+
+	ret = ide_reset( &drive );
+
+	ret = ide_identify_drive( &drive );
+	if ( ret )
+		return -EINVAL;
+
+	ret = ide_setfeature( &drive, IDE_FEAT_8BITON, 0 );
+	if ( ret )
+		return -EINVAL;
+
+	ret = ide_setfeature( &drive, IDE_FEAT_IOMODE, IDE_IOM_PIO );
+	if ( ret )
+		return -EINVAL;
+
+	ret = ide_status_dump( &drive );
+	if ( ret )
+		return -EINVAL;
+
+	return 0;
+}
+
+/**********************************************************************
+ * CF io driver
+ * - maps "adresses" to blocks of IDE_BLOCK_SIZE bytes. Reads
+ * whole blocks, but copies only requested data.
+ */
+void cf_default_io_init( void )
+{
+	int ret;
+	static io_driver_t cf_def_io;
+
+	cf_dbg_set( 0 );
+	
+	/* init default cf drv */
+	ret = cf_io_init( &cf_def_io );
+	if ( ret ) return;
+
+	ret = io_register( &cf_def_io, "CF" );
+	if ( ret ) return;
+
+}
+__initlist(cf_default_io_init, INIT_LEVEL_OTHER_STUFF + 2);
+
+int cf_io_init( io_driver_t *io )
+{
+	DBG( 5, "%s: io=%p\n", __FUNCTION__, io );
+
+	io->conf = cf_io_conf;
+	io->read = cf_io_read;
+	io->write = cf_io_write;
+	io->private_data = (void *)NULL;
+
+	/* filled by configure */
+	io->io_size = 0;
+	
+	/* filled for us by io_chain() */
+	io->child_io = NULL;
+
+	return 0;
+}
+
+int cf_io_conf( io_driver_t *io, void *conf )
+{
+	int ret;
+
+	DBG( 5, "%s: io=%p, conf=%p\n", __FUNCTION__,
+	  io, conf );
+
+	if ( !io || !conf )
+		return -EINVAL;
+
+	cf_slot = (int)conf;
+	DBG( 5, "%s: cf_slot=%d\n", __FUNCTION__, cf_slot );
+
+	ret = cf_init( cf_slot );
+	if ( ret )
+		return -EINVAL;
+
+	io->private_data = (void *)cf_slot;
+
+	/* FIXME: is this ok? How to calculate the correct size? */
+	io->io_size = (drive.driveid.vendor1 | (drive.driveid.vendor0 << 16)) * IDE_BLOCK_SIZE;
+	DBG( 1, "%s: io_size=%d\n", __FUNCTION__, io_get_size( io ) );
+
+	return 0;
+}
+
+static int cf_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	int ret = 0;
+	static unsigned char buffer[IDE_BLOCK_SIZE];
+	u32 start_block;
+	u16	start_off;
+	int block, to_copy;
+
+	if ( !dest )
+		return -EINVAL;
+
+	/* starting block number */
+	start_block = (u32)src/IDE_BLOCK_SIZE;
+
+	/* start offset (in-block-offset)*/
+	start_off = (u32)src - start_block*IDE_BLOCK_SIZE;
+
+	DBG( 1, "%s: start_block=%d, start_off=%d, src=%p, dest=%p, amount=%d\n",
+			__FUNCTION__, start_block, start_off, src, dest, amount );
+
+	block = start_block;
+	while ( amount > 0 ) {
+		/* read block into buffer */
+		//ret = hd_read_mapped( &drive, block, buffer );
+		ret = hd_read_lba( &drive, block, buffer );
+		if ( ret != 0 )
+			return -EINVAL;
+
+		if ( cf_dbg>5 ) {
+			ret = ide_status_dump( &drive );
+			if ( ret )
+				return -EINVAL;
+		}
+
+		if ( start_off ) {
+			to_copy = IDE_BLOCK_SIZE - start_off;
+		} else {
+			to_copy = IDE_BLOCK_SIZE;
+			
+		}
+
+		if ( amount < to_copy ) {
+			to_copy = amount;
+		}
+
+		DBG( 15, "%s: block=%d, to_copy=%d, amount=%d\n",
+				__FUNCTION__, block, to_copy, amount );
+
+		/* copy data */
+		memcpy( dest, buffer + start_off, to_copy );
+
+		if ( start_off ) {
+			start_off=0;
+		}
+
+		dest += to_copy;
+		amount -= to_copy;
+		block += 1;
+	}
+
+	return 0;
+}
+
+static int cf_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	return -EINVAL;
+}
+
+
+/**********************************************************************
+ * Module test
+ */
+#if defined(CF_TEST_MODULE)
+int cf_test_module( int argc, char *argv[] )
+{
+	int ret;
+	static io_driver_t cf_def_io;
+	char buffer[1024];
+
+	/* this is a debug command. be verbose. */
+	cf_dbg_set( 100 );
+	
+	/* init default cf drv */
+	ret = cf_io_init( &cf_def_io );
+	if ( ret ) {
+		DBG( 1, "%s: cf_io_init: %d\n", __FUNCTION__, ret );
+		return ret;
+	}
+
+	ret = io_register( &cf_def_io, "CF" );
+	if ( ret ) {
+		DBG( 1, "%s: cf_io_register: %d\n", __FUNCTION__, ret );
+		return ret;
+	}
+
+	ret = io_configure( "CF", (void *)1 );
+	if ( ret ) {
+		DBG( 1, "%s: cf_io_configure: %d\n", __FUNCTION__, ret );
+		return ret;
+	}
+
+	ret = io_read( buffer, (unsigned char *)256, 512, &cf_def_io );
+	if ( ret ) {
+		DBG( 1, "%s: io_read: %d\n", __FUNCTION__, ret );
+		return ret;
+	}
+
+	return 0;
+}
+char cf_help[] = "cf test function\n";
+#endif
Index: build_tree/bootLoader/src/lib/command.c
diff -u build_tree/bootLoader/src/lib/command.c:1.1.1.1 build_tree/bootLoader/src/lib/command.c:1.1.1.2
--- build_tree/bootLoader/src/lib/command.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/command.c	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      command.c
- * Version:       $Id: command.c,v 1.9 2002/01/03 16:07:18 erikm Exp $
+ * Version:       $Id: command.c,v 1.14 2003/09/04 17:39:01 russd Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   Command line functions for blob
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: command.c,v 1.9 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: command.c,v 1.14 2003/09/04 17:39:01 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -37,6 +37,7 @@
 
 
 #include <blob/command.h>
+#include <blob/debug.h>
 #include <blob/errno.h>
 #include <blob/error.h>
 #include <blob/init.h>
@@ -124,14 +125,8 @@
 	*argc = i;
 
 #ifdef BLOB_DEBUG
-	for(i = 0; i < *argc; i++) {
-		printerrprefix();
-		SerialOutputString("argv[");
-		SerialOutputDec(i);
-		SerialOutputString("] = ");
-		SerialOutputString(argv[i]);
-		serial_write('\n');
-	}
+	for(i = 0; i < *argc; i++)
+		dprintf("argv[%i] = %s\n", i, argv[i]);
 #endif
 }
 
@@ -149,12 +144,9 @@
 
 	for(cmd = commands; cmd != NULL; cmd = cmd->next) {
 		if(cmd->magic != COMMAND_MAGIC) {
-#ifdef BLOB_DEBUG
-			printerrprefix();
-			SerialOutputString(__FUNCTION__ "(): Address = 0x");
-			SerialOutputHex((u32)cmd);
-			serial_write('\n');
-#endif
+			deprintf("command magic failed at 0x%08x\n",
+				 (unsigned int)cmd);
+
 			return -EMAGIC;
 		}
 
@@ -199,12 +191,8 @@
 	/* single command, go for it */
 	for(cmd = commands; cmd != NULL; cmd = cmd->next) {
 		if(cmd->magic != COMMAND_MAGIC) {
-#ifdef BLOB_DEBUG
-			printerrprefix();
-			SerialOutputString(__FUNCTION__ "(): Address = 0x");
-			SerialOutputHex((u32)cmd);
-			serial_write('\n');
-#endif
+			deprintf("command magic failed at 0x%08x\n",
+				 (unsigned int)cmd);
 			
 			return -EMAGIC;
 		}
@@ -231,10 +219,8 @@
 		for(cmd = commands; cmd != NULL; cmd = cmd->next) {
 			if(strncmp(cmd->name, argv[1], 
 				   MAX_COMMANDLINE_LENGTH) == 0) {
-				SerialOutputString("Help for '");
-				SerialOutputString(argv[1]);
-				SerialOutputString("':\n\nUsage: ");
-				SerialOutputString(cmd->help);
+				printf("Help for %s:\n\nUsage: %s\n",
+				       argv[1], cmd->help);
 				return 0;
 			}
 		}
@@ -242,14 +228,12 @@
 		return -EINVAL;
 	}
 
-	SerialOutputString("The following commands are supported:");
+	printf("The following commands are supported:\n");
 
-	for(cmd = commands; cmd != NULL; cmd = cmd->next) {
-		SerialOutputString("\n* ");
-		SerialOutputString(cmd->name);
-	}
+	for(cmd = commands; cmd != NULL; cmd = cmd->next)
+		printf("* %s\n", cmd->name);
 
-	SerialOutputString("\nUse \"help command\" to get help on a specific command\n");
+	printf("Use \"help command\" to get help on a specific command\n");
 
 	return 0;
 }
@@ -267,9 +251,9 @@
 void DisplayPrompt(char *prompt)
 {
 	if(prompt == NULL) {
-		SerialOutputString(PACKAGE "> ");
+		printf(PACKAGE "> ");
 	} else {
-		SerialOutputString(prompt);
+		printf("%s", prompt);
 	}
 }
 
@@ -285,18 +269,17 @@
 	int numRead;
 	int maxRead = len - 1;
 	
-	TimerClearOverflow();
-
-	startTime = TimerGetTime();
-
+	timer_overflow_clear();
+	startTime = timer_read();
+	
 	for(numRead = 0, i = 0; numRead < maxRead;) {
 		/* try to get a byte from the serial port */
-		while(serial_poll() != 0) {
-			currentTime = TimerGetTime();
+		while(serial_poll() == 0) {
+			currentTime = timer_read();
 
 			/* check timeout value */
 			if((currentTime - startTime) > 
-			   (timeout * TICKS_PER_SECOND)) {
+			   (timeout * timer_tps())) {
 				/* timeout */
 				command[i++] = '\0';
 				return(numRead);
@@ -319,12 +302,12 @@
 			/* print newline */
 			serial_write('\n');
 			return(numRead);
-		} else if(c == '\b') { /* FIXME: is this backspace? */
+		} else if((c == '\b') || (c == 0x7f)) {
 			if(i > 0) {
 				i--;
 				numRead--;
 				/* cursor one position back. */
-				SerialOutputString("\b \b");
+				printf("\b \b");
 			}
 		} else {
 			command[i++] = c;
Index: build_tree/bootLoader/src/lib/crc32.c
diff -u /dev/null build_tree/bootLoader/src/lib/crc32.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/crc32.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,239 @@
+/*
+ * crc32.c: calculate CRC32
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl> and
+ *                     Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
+ *   based on linux/drivers/net/am79c961a.c
+ * Copyright (C) 1995-2001 Russell King <rmk@arm.linux.org.uk>
+ *
+ * $Id: crc32.c,v 1.3 2002/01/21 13:13:33 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+/*
+ * There are many ways to calculate a CRC32. The most common is the
+ * table lookup variant by Gary S. Brown:
+ *  
+ * const u32 crc32_table[256] = {
+ *	0x00000000L, 0x77073096L, 0xee0e612cL, 0x990951baL, 0x076dc419L,
+ *	0x706af48fL, 0xe963a535L, 0x9e6495a3L, 0x0edb8832L, 0x79dcb8a4L,
+ *	0xe0d5e91eL, 0x97d2d988L, 0x09b64c2bL, 0x7eb17cbdL, 0xe7b82d07L,
+ *	0x90bf1d91L, 0x1db71064L, 0x6ab020f2L, 0xf3b97148L, 0x84be41deL,
+ *	0x1adad47dL, 0x6ddde4ebL, 0xf4d4b551L, 0x83d385c7L, 0x136c9856L,
+ *	0x646ba8c0L, 0xfd62f97aL, 0x8a65c9ecL, 0x14015c4fL, 0x63066cd9L,
+ *	0xfa0f3d63L, 0x8d080df5L, 0x3b6e20c8L, 0x4c69105eL, 0xd56041e4L,
+ *	0xa2677172L, 0x3c03e4d1L, 0x4b04d447L, 0xd20d85fdL, 0xa50ab56bL,
+ *	0x35b5a8faL, 0x42b2986cL, 0xdbbbc9d6L, 0xacbcf940L, 0x32d86ce3L,
+ *	0x45df5c75L, 0xdcd60dcfL, 0xabd13d59L, 0x26d930acL, 0x51de003aL,
+ *	0xc8d75180L, 0xbfd06116L, 0x21b4f4b5L, 0x56b3c423L, 0xcfba9599L,
+ *	0xb8bda50fL, 0x2802b89eL, 0x5f058808L, 0xc60cd9b2L, 0xb10be924L,
+ *	0x2f6f7c87L, 0x58684c11L, 0xc1611dabL, 0xb6662d3dL, 0x76dc4190L,
+ *	0x01db7106L, 0x98d220bcL, 0xefd5102aL, 0x71b18589L, 0x06b6b51fL,
+ *	0x9fbfe4a5L, 0xe8b8d433L, 0x7807c9a2L, 0x0f00f934L, 0x9609a88eL,
+ *	0xe10e9818L, 0x7f6a0dbbL, 0x086d3d2dL, 0x91646c97L, 0xe6635c01L,
+ *	0x6b6b51f4L, 0x1c6c6162L, 0x856530d8L, 0xf262004eL, 0x6c0695edL,
+ *	0x1b01a57bL, 0x8208f4c1L, 0xf50fc457L, 0x65b0d9c6L, 0x12b7e950L,
+ *	0x8bbeb8eaL, 0xfcb9887cL, 0x62dd1ddfL, 0x15da2d49L, 0x8cd37cf3L,
+ *	0xfbd44c65L, 0x4db26158L, 0x3ab551ceL, 0xa3bc0074L, 0xd4bb30e2L,
+ *	0x4adfa541L, 0x3dd895d7L, 0xa4d1c46dL, 0xd3d6f4fbL, 0x4369e96aL,
+ *	0x346ed9fcL, 0xad678846L, 0xda60b8d0L, 0x44042d73L, 0x33031de5L,
+ *	0xaa0a4c5fL, 0xdd0d7cc9L, 0x5005713cL, 0x270241aaL, 0xbe0b1010L,
+ *	0xc90c2086L, 0x5768b525L, 0x206f85b3L, 0xb966d409L, 0xce61e49fL,
+ *	0x5edef90eL, 0x29d9c998L, 0xb0d09822L, 0xc7d7a8b4L, 0x59b33d17L,
+ *	0x2eb40d81L, 0xb7bd5c3bL, 0xc0ba6cadL, 0xedb88320L, 0x9abfb3b6L,
+ *	0x03b6e20cL, 0x74b1d29aL, 0xead54739L, 0x9dd277afL, 0x04db2615L,
+ *	0x73dc1683L, 0xe3630b12L, 0x94643b84L, 0x0d6d6a3eL, 0x7a6a5aa8L,
+ *	0xe40ecf0bL, 0x9309ff9dL, 0x0a00ae27L, 0x7d079eb1L, 0xf00f9344L,
+ *	0x8708a3d2L, 0x1e01f268L, 0x6906c2feL, 0xf762575dL, 0x806567cbL,
+ *	0x196c3671L, 0x6e6b06e7L, 0xfed41b76L, 0x89d32be0L, 0x10da7a5aL,
+ *	0x67dd4accL, 0xf9b9df6fL, 0x8ebeeff9L, 0x17b7be43L, 0x60b08ed5L,
+ *	0xd6d6a3e8L, 0xa1d1937eL, 0x38d8c2c4L, 0x4fdff252L, 0xd1bb67f1L,
+ *	0xa6bc5767L, 0x3fb506ddL, 0x48b2364bL, 0xd80d2bdaL, 0xaf0a1b4cL,
+ *	0x36034af6L, 0x41047a60L, 0xdf60efc3L, 0xa867df55L, 0x316e8eefL,
+ *	0x4669be79L, 0xcb61b38cL, 0xbc66831aL, 0x256fd2a0L, 0x5268e236L,
+ *	0xcc0c7795L, 0xbb0b4703L, 0x220216b9L, 0x5505262fL, 0xc5ba3bbeL,
+ *	0xb2bd0b28L, 0x2bb45a92L, 0x5cb36a04L, 0xc2d7ffa7L, 0xb5d0cf31L,
+ *	0x2cd99e8bL, 0x5bdeae1dL, 0x9b64c2b0L, 0xec63f226L, 0x756aa39cL,
+ *	0x026d930aL, 0x9c0906a9L, 0xeb0e363fL, 0x72076785L, 0x05005713L,
+ *	0x95bf4a82L, 0xe2b87a14L, 0x7bb12baeL, 0x0cb61b38L, 0x92d28e9bL,
+ *	0xe5d5be0dL, 0x7cdcefb7L, 0x0bdbdf21L, 0x86d3d2d4L, 0xf1d4e242L,
+ *	0x68ddb3f8L, 0x1fda836eL, 0x81be16cdL, 0xf6b9265bL, 0x6fb077e1L,
+ *	0x18b74777L, 0x88085ae6L, 0xff0f6a70L, 0x66063bcaL, 0x11010b5cL,
+ *	0x8f659effL, 0xf862ae69L, 0x616bffd3L, 0x166ccf45L, 0xa00ae278L,
+ *	0xd70dd2eeL, 0x4e048354L, 0x3903b3c2L, 0xa7672661L, 0xd06016f7L,
+ *	0x4969474dL, 0x3e6e77dbL, 0xaed16a4aL, 0xd9d65adcL, 0x40df0b66L,
+ *	0x37d83bf0L, 0xa9bcae53L, 0xdebb9ec5L, 0x47b2cf7fL, 0x30b5ffe9L,
+ *	0xbdbdf21cL, 0xcabac28aL, 0x53b39330L, 0x24b4a3a6L, 0xbad03605L,
+ *	0xcdd70693L, 0x54de5729L, 0x23d967bfL, 0xb3667a2eL, 0xc4614ab8L,
+ *	0x5d681b02L, 0x2a6f2b94L, 0xb40bbe37L, 0xc30c8ea1L, 0x5a05df1bL,
+ *	0x2d02ef8dL
+ * };
+ *
+ * u32 crc32_tbl(u32 val, const void *ss, int len)
+ * {
+ *	const unsigned char *s = ss;
+ *
+ *        while (--len >= 0)
+ *                val = crc32_table[(val ^ *s++) & 0xff] ^ (val >> 8);
+ *
+ *        return val;
+ * }
+ *
+ * The performance of this function on a StrongARM SA-1100 running at
+ * 221MHz with i-cache enabled and d-cache disabled is 1.29 s on a 3MB
+ * data block.  The lookup table makes this function quite large (1068
+ * bytes), which is not what we want in blob.
+ *
+ * To get the code size smaller, we can take advantage of the fact
+ * that we run with i-cache enabled and d-cache disabled and compute
+ * the CRC on the fly. This function is by Russell King:
+ *
+ * static inline u32 update_crc(u32 crc, u8 byte)
+ * {
+ *	int i;
+ *	u32 polynome = POLYNOME;
+ *
+ *	for (i = 8; i != 0; i--) {
+ *		byte ^= crc & 1;
+ *		crc >>= 1;
+ *
+ *		if (byte & 1)
+ *			crc ^= polynome;
+ *
+ *		byte >>= 1;
+ *	}
+ *
+ *	return crc;
+ * }
+ *
+ * u32 crc32(u32 val, const void *data, int len)
+ * {
+ *	u32 crc = val;
+ *	u8 *tmp = (u8 *)data;
+ *
+ *	while(len--)
+ *		crc = update_crc(crc, *tmp++);
+ *
+ *	return crc;
+ * }
+ *
+ * The function is a lot smaller: only 84 bytes, but unfortunately it
+ * is three times as slow on our benchmark: 3.13 seconds.
+ *
+ * Jan-Derk Bakker suggested to rewrite update_crc() like this:
+ *
+ * static inline u32 update_crc(u32 crc, u8 byte)
+ * {
+ *	int i;
+ *	u32 polynome = POLYNOME;
+ *
+ * 	crc ^= byte;
+ *
+ * 	for (i = 8; i != 0; i--) {
+ * 	    if(crc & 1) {
+ * 	        crc >>= 1;
+ * 	        crc ^= polynome;
+ * 	    }
+ * 	    else
+ * 	        crc >>= 1;
+ * 	}
+ *
+ *	return crc;
+ * }
+ *
+ * The compiler generates a very tight inner loop for this:
+ *
+ * c020354:	tst     r0, #1  ; 0x1
+ *		eorne   r0, lr, r0, lsr #1
+ *		moveq   r0, r0, lsr #1
+ *		subs    r12, r12, #1    ; 0x1
+ *		bne     c020354
+ *
+ * Which really pays off: code size is 68 bytes and it scores 2.25 s
+ * on the benchmark.
+ *
+ * Unfortunately it is still slower than the table lookup variant, and
+ * some analysis shows that the for() loop is the culprit: the
+ * subtract costs 1 clock cycle, and the conditional branch another
+ * three, so we waste 32 cycles for each CRC byte in the loop.
+ *
+ * To get the code faster, we do loop unrolling by hand (like the
+ * function is right now). The code size almost doubles (124 bytes),
+ * but the speed almost halves: 1.23 s on the benchmark. Not a bad
+ * result at all: faster than the table implementation at only 12% of
+ * the size.
+ *
+ */
+
+#ident "$Id: crc32.c,v 1.3 2002/01/21 13:13:33 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+
+
+
+
+#define POLYNOME	(0xedb88320)
+
+
+
+
+/* calculate CRC32 on len bytes pointed by data. the usual
+ * initialisation is to put 0xffffffff in val, but by supplying a
+ * previous CRC value into it it can be used to calculate the CRC on
+ * streams of data 
+ */
+u32 crc32(u32 crc, const void *data, int len)
+{
+	u8 *tmp = (u8 *)data;
+	u32 polynome = POLYNOME;
+	/* The above might look stupid, but it is a cludge to get
+	 * better code. With the -Os flag, the compiler Moves the
+	 * POLYNOME into the .rodata segment and reloads it on every
+	 * run. This kinda defeats the purpose of doing CRC32 without
+	 * a lookup table. By moving the polynome explicitly out of
+	 * the loop, the compiler will allocate a register for it
+	 * making the resulting code faster. JDB commented that the
+	 * CSE module of GCC is broken, but it works perfectly well
+	 * with -O2. It's just that memory size is more important than
+	 * speed with -Os. -- Erik
+	 */
+
+#define DO_CRC \
+	if(crc & 1) { \
+		crc >>= 1; \
+		crc ^= polynome; \
+	} else { \
+		crc >>= 1; \
+	}
+
+	while(len--) {
+		crc ^= *tmp++;
+
+		DO_CRC;
+		DO_CRC;
+		DO_CRC;
+		DO_CRC;
+		DO_CRC;
+		DO_CRC;
+		DO_CRC;
+		DO_CRC;
+	}
+
+	return crc;
+}
Index: build_tree/bootLoader/src/lib/download.c
diff -u /dev/null build_tree/bootLoader/src/lib/download.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/download.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,217 @@
+/*-------------------------------------------------------------------------
+ * Filename:      download.c
+ * Version:       $Id: download.c,v 1.1 2003/09/04 17:47:00 russd Exp $
+ * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
+ * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
+ * Description:   download helper stuff
+ * Created at:    Mon Aug 23 20:00:00 1999
+ * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Modified at:   Sat Mar 25 14:31:16 2000
+ *-----------------------------------------------------------------------*/
+/*
+ * download.c: download helper stuff
+ *
+ * Copyright (C) 1999 2000 2001
+ *   Jan-Derk Bakker (J.D.Bakker@its.tudelft.nl) and
+ *   Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: download.c,v 1.1 2003/09/04 17:47:00 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/error.h>
+#include <blob/md5.h>
+#include <blob/md5support.h>
+#include <blob/serial.h>
+#include <blob/download.h>
+#include <blob/command.h>
+
+
+void PrintSerialSpeed(serial_baud_t speed)
+{
+	if (speed >= baud_COUNT) printf("(unknown)");
+	else printf("%d%i", speed, baud_rates[speed]);
+}
+
+
+int set_download_parameters(char *name, u32 *startAddress, 
+				    int *bufLen, int **numRead,
+				   u32 **digest)
+{
+	/* Use of _FLASH_LEN here is WRONG.  This should be
+	   the size of the ram buffer */
+	if(strncmp(name, "blob", 5) == 0) {
+		/* download blob */
+		*startAddress = BLOB_RAM_BASE;
+		*bufLen = BLOB_FLASH_LEN;
+		*numRead = &blob_status.blobSize;
+		*digest = blob_status.blob_md5_digest;
+		blob_status.blobType = fromDownload;
+	} else if(strncmp(name, "param", 6) == 0) {
+		/* download param */
+		*startAddress = PARAM_RAM_BASE;
+		*bufLen = PARAM_FLASH_LEN;
+		*numRead = &blob_status.paramSize;
+		*digest = blob_status.param_md5_digest;
+		blob_status.paramType = fromDownload;
+	} else if(strncmp(name, "kernel", 7) == 0) {
+		/* download kernel */
+		*startAddress = KERNEL_RAM_BASE;
+		*bufLen = KERNEL_FLASH_LEN;
+		*numRead = &blob_status.kernelSize;
+		*digest = blob_status.kernel_md5_digest;
+		blob_status.kernelType = fromDownload;
+	} else if(strncmp(name, "ramdisk", 8) == 0) {
+		/* download ramdisk */
+		*startAddress = RAMDISK_RAM_BASE;
+		*bufLen = RAMDISK_FLASH_LEN;
+		*numRead = &blob_status.ramdiskSize;
+		*digest = blob_status.ramdisk_md5_digest;
+		blob_status.ramdiskType = fromDownload;
+	} else {
+		printerror(-EINVAL, name);
+		return -EINVAL;
+	}
+
+	return 0;
+}
+
+
+int do_reload(char *what)
+{
+	u32 *dst = 0;
+	u32 *src = 0;
+	int numWords;
+
+	if(strncmp(what, "blob", 5) == 0) {
+		dst = (u32 *)BLOB_RAM_BASE;
+		src = (u32 *)BLOB_FLASH_BASE;
+		numWords = BLOB_FLASH_LEN / 4;
+		blob_status.blobSize = 0;	
+		blob_status.blobType = fromFlash;
+		printf("Loading blob from flash ");
+#ifdef PARAM_FLASH_BASE
+	} else if(strncmp(what, "param", 6) == 0) {
+		dst = (u32 *)PARAM_RAM_BASE;
+		src = (u32 *)PARAM_FLASH_BASE;
+		numWords = PARAM_FLASH_LEN / 4;
+		blob_status.paramSize = 0;
+		blob_status.paramType = fromFlash;
+		printf("Loading paramater block from flash ");
+#endif
+	} else if(strncmp(what, "kernel", 7) == 0) {
+
+
+#if defined(CONFIG_CRAMFS_SUPPORT) || defined(CONFIG_ZIMAGE_SUPPORT) || defined(CONFIG_JFFS2_SUPPORT)
+		return load_kernel(&blob_status);
+#else
+
+		dst = (u32 *)KERNEL_RAM_BASE;
+		src = (u32 *)KERNEL_FLASH_BASE;
+		numWords = KERNEL_FLASH_LEN / 4;
+		blob_status.kernelSize = 0;
+		blob_status.kernelType = fromFlash;
+		printf("Loading kernel from flash ");
+ 
+#endif
+
+#ifdef RAMDISK_FLASH_BASE
+	} else if(strncmp(what, "ramdisk", 8) == 0) {
+		dst = (u32 *)RAMDISK_RAM_BASE;
+		src = (u32 *)RAMDISK_FLASH_BASE;
+		numWords = RAMDISK_FLASH_LEN / 4;
+		blob_status.ramdiskSize = 0;
+		blob_status.ramdiskType = fromFlash;
+		printf("Loading ramdisk from flash ");
+#endif
+	} else {
+		printerror(EINVAL, what);
+		return 0;
+	}
+
+	MyMemCpy(dst, src, numWords);
+	printf(" done\n");
+
+	return 0;
+}
+
+
+void do_md5sum(u32 *addr, size_t len, u32 *digest)
+{
+#ifdef CONFIG_MD5_SUPPORT
+	md5_buffer((const char *)addr, len, digest);
+#endif
+}
+
+
+int SetDownloadSpeed(int argc, char *argv[])
+{
+	if(argc < 2)
+		return -ENOPARAMS;
+
+	if(strncmp(argv[1], "1200", 5) == 0) {
+		blob_status.downloadSpeed = baud_1200;
+	} else if(strncmp(argv[1], "1k2", 4) == 0) {
+		blob_status.downloadSpeed = baud_1200;
+	} else if(strncmp(argv[1], "9600", 5) == 0) {
+		blob_status.downloadSpeed = baud_9600;
+	} else if(strncmp(argv[1], "9k6", 4) == 0) {
+		blob_status.downloadSpeed = baud_9600;
+	} else if(strncmp(argv[1], "19200", 6) == 0) {
+		blob_status.downloadSpeed = baud_19200;
+	} else if(strncmp(argv[1], "19k2", 5) == 0) {
+		blob_status.downloadSpeed = baud_19200;
+	} else if(strncmp(argv[1], "38400", 7) == 0) {
+		blob_status.downloadSpeed = baud_38400;
+	} else if(strncmp(argv[1], "38k4", 5) == 0) {
+		blob_status.downloadSpeed = baud_38400;
+	} else if(strncmp(argv[1], "57600", 6) == 0) {
+		blob_status.downloadSpeed = baud_57600;
+	} else if(strncmp(argv[1], "57k6", 5) == 0) {
+		blob_status.downloadSpeed = baud_57600;
+	} else if(strncmp(argv[1], "115200", 7) == 0) {
+		blob_status.downloadSpeed = baud_115200;
+	} else if(strncmp(argv[1], "115k2", 6) == 0) {
+		blob_status.downloadSpeed = baud_115200;
+	} else if(strncmp(argv[1], "230400", 7) == 0) {
+		blob_status.downloadSpeed = baud_230400;
+	} else if(strncmp(argv[1], "230k4", 6) == 0) {
+		blob_status.downloadSpeed = baud_230400;
+	} else {
+		return -EINVAL;
+	}
+
+	printf("Download speed set to ");
+	PrintSerialSpeed(blob_status.downloadSpeed);
+	printf(" baud\n");
+
+	return 0;
+}
+
+static char speedhelp[] = "speed [baudrate]\n"
+"Set download speed. Valid baudrates are:\n"
+"1200, 9600, 19200, 38400, 57600, 115200, 230400,\n"
+" 1k2,  9k6,  19k2,  38k4,  57k6,  115k2,  230k4\n";
+
+__commandlist(SetDownloadSpeed, "speed", speedhelp);
+
Index: build_tree/bootLoader/src/lib/error.c
diff -u build_tree/bootLoader/src/lib/error.c:1.1.1.1 build_tree/bootLoader/src/lib/error.c:1.1.1.2
--- build_tree/bootLoader/src/lib/error.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/error.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: error.c,v 1.6 2002/01/03 16:07:18 erikm Exp $
+ * $Id: error.c,v 1.7 2002/02/08 12:55:16 erikm Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: error.c,v 1.6 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: error.c,v 1.7 2002/02/08 12:55:16 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -29,8 +29,8 @@
 
 #include <blob/errno.h>
 #include <blob/error.h>
-#include <blob/serial.h>
 #include <blob/types.h>
+#include <blob/util.h>
 
 
 static char *error_strings[] = {
@@ -73,19 +73,16 @@
 
 void printerrprefix(void)
 {
-	SerialOutputString(errprefix);
+	printf("%s", errprefix);
 }
 
 
 void printerror(int errnum, char *s)
 {
-	printerrprefix();
-	SerialOutputString(strerror(errnum));
+	printf("%s%s", errprefix, strerror(errnum));
 
-	if(s != NULL) {
-		SerialOutputString(": ");
-		SerialOutputString(s);
-	}
-
-	serial_write('\n');
+	if(s != NULL)
+		printf(": %s\n", s);
+	else
+		printf("\n");
 }
Index: build_tree/bootLoader/src/lib/ether-bvdusb.c
diff -u /dev/null build_tree/bootLoader/src/lib/ether-bvdusb.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ether-bvdusb.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,242 @@
+/*
+ *  ether-pxausb.c : "eth-over-usb" driver for BLOB
+ *
+ *  Copyright (c) 2003, Intel Corporation (yu.tang@intel.com)
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License version 2 as
+ *  published by the Free Software Foundation.
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/types.h>
+#include <blob/time.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/init.h>
+#include <net/ether.h>
+#include <net/net.h>
+
+#include <pxa_usb.h>
+
+static int usb_rsize=64;
+static int usb_wsize=64;
+
+/* cable connection : defined in bvd_usb_ctl.c */
+extern int usb_connected;
+
+/* receive buffer management */
+static u8  rx_buf[1024];
+static int  rx_size = 0;
+static int  rx_done = 0 ;
+
+/* transmit buffer management */
+static int tx_done = 0 ;
+
+#define ETHERNET_VENDOR_ID 0x8086
+#define ETHERNET_PRODUCT_ID 0x7d3
+
+static void usb_eth_tx_callback(int flag, int size)
+{
+	tx_done = 1;
+}
+
+static void usb_eth_rx_callback(int flag, int size)
+{
+	int left;
+
+	if( flag != 0 ) return;
+
+	if (rx_done) { 
+		/* drop */
+		rx_done = 0;
+		rx_size = 0;
+	}
+
+	rx_size += size;
+
+	/* end-of-packet? */
+	if(size == usb_rsize) {
+		left = sizeof(rx_buf) - rx_size;
+		if (!left) 
+			goto done;
+
+		ep2_recv(rx_buf+rx_size, (left<usb_rsize)?left:usb_rsize, usb_eth_rx_callback);
+		return;
+	}
+
+done:
+	rx_done = 1;
+
+	/* setup to receive */
+	ep2_recv(rx_buf, sizeof(rx_buf), usb_eth_rx_callback);
+
+	return;
+}
+
+void usb_driver_reset(void)
+{
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();
+	config_desc_t *cfg;
+	intf_desc_t *intf;
+	ep_desc_t *ep;
+
+	/* setup device descriptor */
+	pdesc->dev.idVendor	= ETHERNET_VENDOR_ID;
+	pdesc->dev.idProduct    = ETHERNET_PRODUCT_ID;
+	pdesc->dev.bNumConfigurations = 1;
+
+	cfg = (config_desc_t*) (pdesc->cdb);
+
+	cfg->bLength             = sizeof( config_desc_t );
+	cfg->bDescriptorType     = USB_DESC_CONFIG;
+	cfg->wTotalLength        = make_word_c( sizeof(config_desc_t) +
+						   sizeof(intf_desc_t) * 1+
+						   sizeof(ep_desc_t) * 2);
+	cfg->bNumInterfaces      = 1;
+	cfg->bConfigurationValue = 1;
+	cfg->iConfiguration      = 0;
+	cfg->bmAttributes        = USB_CONFIG_BUSPOWERED;
+	cfg->MaxPower            = USB_POWER( 500 );
+
+	intf = (intf_desc_t *) ( cfg + 1);
+	intf->bLength            = sizeof( intf_desc_t );
+	intf->bDescriptorType    = USB_DESC_INTERFACE;
+	intf->bInterfaceNumber   = 0; 
+	intf->bAlternateSetting  = 0;
+	intf->bNumEndpoints      = 2;
+	intf->bInterfaceClass    = 0xFF; 
+	intf->bInterfaceSubClass = 0;
+	intf->bInterfaceProtocol = 0;
+	intf->iInterface         = 0;
+
+	ep = (ep_desc_t *) (intf + 1);
+	ep[0].bLength             = sizeof( ep_desc_t );
+	ep[0].bDescriptorType     = USB_DESC_ENDPOINT;
+	ep[0].bEndpointAddress    = USB_EP_ADDRESS( 1, USB_IN );
+	ep[0].bmAttributes        = USB_EP_BULK;
+	ep[0].wMaxPacketSize      = make_word( 64 );
+	ep[0].bInterval           = 0;
+
+	ep[1].bLength             = sizeof( ep_desc_t );
+	ep[1].bDescriptorType     = USB_DESC_ENDPOINT;
+	ep[1].bEndpointAddress    = USB_EP_ADDRESS( 2, USB_OUT );
+	ep[1].bmAttributes        = USB_EP_BULK;
+	ep[1].wMaxPacketSize      = make_word( 64 );
+	ep[1].bInterval           = 0;
+
+	/* reset buffer */
+	rx_done = 0;
+	rx_size = 0;
+
+	/* setup to receive */
+	ep2_recv(rx_buf, sizeof(rx_buf), usb_eth_rx_callback);
+}
+
+static int check_usb_connection(void)
+{
+	int cnt;
+
+	if (usb_connected) return 0;
+
+	/* waiting util connected */
+	printf("***** Plug-in USB cable & config usbdnet now ****** \n");
+	
+	while (!usb_connected) {
+		if ( ICPR & 0x800 ) 
+			udc_int_hndlr(0x11, 0);
+	}
+
+	while ( cnt < 0x1000) {
+		if ( ICPR & 0x800 ) {
+			udc_int_hndlr(0x11, 0);
+			cnt = 0;
+		}
+		cnt ++;
+	}
+
+	return 0;
+}
+
+static int usb_eth_init(u32 base)
+{
+	usb_connected = 0;
+
+	/* initialize PXA USB controller */
+	pxa_usb_open("usb-eth");
+	pxa_usb_start();
+
+	return 0;
+}
+
+static int usb_eth_rx(char *inbuf, int size)
+{
+	int i=0;
+
+	check_usb_connection();
+
+	for ( i=0; i<0x1000 && !rx_done; i++) {
+		if ( ICPR & 0x800 ) {
+			udc_int_hndlr(0x11, 0);
+			i=0;
+		}
+	}
+
+	if (size > rx_size) 
+		size = rx_size;
+
+	memcpy(inbuf, rx_buf, size);
+
+	rx_done = 0;
+	rx_size = 0;
+
+	return size;
+}
+
+static int usb_eth_tx(char *outbuf, int size) 
+{
+	int tx_size = size;
+
+	check_usb_connection();
+
+	if ( 0 == (size % usb_wsize) ) 
+		size ++;
+
+	tx_done = 0;
+
+	ep1_send(outbuf, size, usb_eth_tx_callback);
+
+	while (!tx_done) {
+		if ( ICPR & 0x800 ) 
+			udc_int_hndlr(0x11, 0);
+	}
+	
+	return tx_size;
+}
+
+static int usb_eth_set_addr( u8 hw_addr[6] )
+{
+	memcpy(hwaddress, hw_addr, 6);
+	return 0;
+}
+
+static int usb_eth_get_addr( u8 hw_addr[6] )
+{
+	memcpy(hw_addr, hwaddress, 6);
+	return 0;
+}
+
+/* export ethernet driver */
+ether_driver_t bvdusb_ether_driver = {
+	init:		usb_eth_init,
+	rcv:		usb_eth_rx,
+	snd:		usb_eth_tx,
+	set_addr:	usb_eth_set_addr,
+	get_addr:	usb_eth_get_addr,
+	base:		0,
+	name:		"usb-eth"
+};
Index: build_tree/bootLoader/src/lib/ether-pxausb.c
diff -u /dev/null build_tree/bootLoader/src/lib/ether-pxausb.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ether-pxausb.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,265 @@
+/*
+ *  ether-pxausb.c : "eth-over-usb" driver for BLOB
+ *
+ *  Copyright (c) 2003, Intel Corporation (yu.tang@intel.com)
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the GNU General Public License version 2 as
+ *  published by the Free Software Foundation.
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/types.h>
+#include <blob/time.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/init.h>
+#include <net/ether.h>
+#include <net/net.h>
+
+#include <pxa_usb.h>
+
+static int usb_rsize=64;
+static int usb_wsize=64;
+
+/* cable connection */
+static int usb_connected = 0;
+
+/* receive buffer management */
+static u8  rx_buf[1024];
+static int  rx_size = 0;
+static int  rx_done = 0 ;
+
+/* transmit buffer management */
+static int tx_done = 0 ;
+
+#define ETHERNET_VENDOR_ID 0x8086
+#define ETHERNET_PRODUCT_ID 0x7d3
+
+static void usb_eth_tx_callback(int flag, int size)
+{
+	tx_done = 1;
+}
+
+static void usb_eth_rx_callback(int flag, int size)
+{
+	int left;
+
+	if( flag != 0 ) return;
+
+	if (rx_done) { 
+		/* drop */
+		rx_done = 0;
+		rx_size = 0;
+	}
+
+	rx_size += size;
+
+	/* end-of-packet? */
+	if(size == usb_rsize) {
+		left = sizeof(rx_buf) - rx_size;
+		if (!left) 
+			goto done;
+
+		ep2_recv(rx_buf+rx_size, (left<usb_rsize)?left:usb_rsize, usb_eth_rx_callback);
+		return;
+	}
+
+done:
+	rx_done = 1;
+
+	/* setup to receive */
+	ep2_recv(rx_buf, sizeof(rx_buf), usb_eth_rx_callback);
+
+	return;
+}
+
+void usb_driver_reset(void)
+{
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();
+	config_desc_t *cfg;
+	intf_desc_t *intf;
+	ep_desc_t *ep;
+
+	/* setup device descriptor */
+	pdesc->dev.idVendor	= ETHERNET_VENDOR_ID;
+	pdesc->dev.idProduct    = ETHERNET_PRODUCT_ID;
+	pdesc->dev.bNumConfigurations = 1;
+
+	cfg = (config_desc_t*) (pdesc->cdb);
+
+	cfg->bLength             = sizeof( config_desc_t );
+	cfg->bDescriptorType     = USB_DESC_CONFIG;
+	cfg->wTotalLength        = make_word_c( sizeof(config_desc_t) +
+						   sizeof(intf_desc_t) * 1+
+						   sizeof(ep_desc_t) * 2);
+	cfg->bNumInterfaces      = 1;
+	cfg->bConfigurationValue = 1;
+	cfg->iConfiguration      = 0;
+	cfg->bmAttributes        = USB_CONFIG_BUSPOWERED;
+	cfg->MaxPower            = USB_POWER( 500 );
+
+	intf = (intf_desc_t *) ( cfg + 1);
+	intf->bLength            = sizeof( intf_desc_t );
+	intf->bDescriptorType    = USB_DESC_INTERFACE;
+	intf->bInterfaceNumber   = 0; 
+	intf->bAlternateSetting  = 0;
+	intf->bNumEndpoints      = 2;
+	intf->bInterfaceClass    = 0xFF; 
+	intf->bInterfaceSubClass = 0;
+	intf->bInterfaceProtocol = 0;
+	intf->iInterface         = 0;
+
+	ep = (ep_desc_t *) (intf + 1);
+	ep[0].bLength             = sizeof( ep_desc_t );
+	ep[0].bDescriptorType     = USB_DESC_ENDPOINT;
+	ep[0].bEndpointAddress    = USB_EP_ADDRESS( 1, USB_IN );
+	ep[0].bmAttributes        = USB_EP_BULK;
+	ep[0].wMaxPacketSize      = make_word( 64 );
+	ep[0].bInterval           = 0;
+
+	ep[1].bLength             = sizeof( ep_desc_t );
+	ep[1].bDescriptorType     = USB_DESC_ENDPOINT;
+	ep[1].bEndpointAddress    = USB_EP_ADDRESS( 2, USB_OUT );
+	ep[1].bmAttributes        = USB_EP_BULK;
+	ep[1].wMaxPacketSize      = make_word( 64 );
+	ep[1].bInterval           = 0;
+
+	/* reset buffer */
+	rx_done = 0;
+	rx_size = 0;
+
+	/* setup to receive */
+	ep2_recv(rx_buf, sizeof(rx_buf), usb_eth_rx_callback);
+}
+
+static int check_usb_connection(void)
+{
+	int start, current, tps;
+
+	if (usb_connected) return 0;
+
+	/* waiting util connected */
+	printf("***\n");
+	printf("1. plug-out/plug-in USB cable \n");
+	printf("2. set IP \"%d.%d.%d.%d\" to usbdnet on HOST   \n", 
+			serveripaddress[0], serveripaddress[1], 
+			serveripaddress[2], serveripaddress[3]);
+	printf("3. press CTRL+X to continue when ready.");
+
+	tps = timer_tps();
+	start = timer_read();
+	while (!usb_connected) {
+		if ( ICPR & 0x800 ) 
+			udc_int_hndlr(0x11, 0);
+
+		while (serial_poll()) {
+			if (0x18 == serial_read()) 
+				usb_connected = 1;
+		}
+
+		current = timer_read();
+		if((current - start) > tps) {
+			printf(".");
+			start = current;
+		}
+	}
+
+	printf("connected\n");
+	printf("***\n");
+	return 0;
+}
+
+static int usb_eth_init(u32 base)
+{
+	usb_connected = 0;
+
+	/* set default ip address */
+	clientipaddress[0] = 192;
+	clientipaddress[1] = 168;
+	clientipaddress[2] = 1;
+	clientipaddress[3] = 101;
+
+	serveripaddress[0] = 192;
+	serveripaddress[1] = 168;
+	serveripaddress[2] = 1;
+	serveripaddress[3] = 100;
+
+	/* initialize PXA USB controller */
+	pxa_usb_open("usb-eth");
+	pxa_usb_start();
+
+	return 0;
+}
+
+static int usb_eth_rx(char *inbuf, int size)
+{
+	int i=0;
+
+	check_usb_connection();
+
+	for ( i=0; i<0x1000 && !rx_done; i++) {
+		if ( ICPR & 0x800 ) {
+			udc_int_hndlr(0x11, 0);
+			i=0;
+		}
+	}
+
+	if (size > rx_size) 
+		size = rx_size;
+
+	memcpy(inbuf, rx_buf, size);
+
+	rx_done = 0;
+	rx_size = 0;
+
+	return size;
+}
+
+static int usb_eth_tx(char *outbuf, int size) 
+{
+	int tx_size = size;
+
+	check_usb_connection();
+
+	if ( 0 == (size % usb_wsize) ) 
+		size ++;
+
+	tx_done = 0;
+
+	ep1_send(outbuf, size, usb_eth_tx_callback);
+
+	while (!tx_done) {
+		if ( ICPR & 0x800 ) 
+			udc_int_hndlr(0x11, 0);
+	}
+	
+	return tx_size;
+}
+
+static int usb_eth_set_addr( u8 hw_addr[6] )
+{
+	memcpy(hwaddress, hw_addr, 6);
+	return 0;
+}
+
+static int usb_eth_get_addr( u8 hw_addr[6] )
+{
+	memcpy(hw_addr, hwaddress, 6);
+	return 0;
+}
+
+/* export ethernet driver */
+ether_driver_t pxausb_ether_driver = {
+	init:		usb_eth_init,
+	rcv:		usb_eth_rx,
+	snd:		usb_eth_tx,
+	set_addr:	usb_eth_set_addr,
+	get_addr:	usb_eth_get_addr,
+	base:		0,
+	name:		"usb-eth"
+};
Index: build_tree/bootLoader/src/lib/ether-s3c2500.c
diff -u /dev/null build_tree/bootLoader/src/lib/ether-s3c2500.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ether-s3c2500.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,312 @@
+/*
+ * ether-s3c2500.c: Low-level ethernet polling functions
+ *
+ * Copyright (c) 2003  Russ Dill <Russ.Dill@asu.edu>
+ *
+ * smc9194.c was used as a skeleton for this file
+ * Original Author:
+ * 	Erik Stahlman				( erik@vt.edu )
+ * contributors:
+ *      Arnaldo Carvalho de Melo <acme@conectiva.com.br>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#include <util.h>
+#include <time.h>
+#include <errno.h>
+#include <serial.h>
+#include <command.h>
+#include <net/s3c2500.h>
+#include <net/ether.h>
+
+#undef SE_DEBUG
+
+#ifdef SE_DEBUG
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... ) ;
+#endif
+
+/* 
+ * Because this is being done with polling, and packets can really
+ * pile up, especially little packets on big networks, make a ring
+ * of 16 little buffers (maybe more later). Packets under 160 will
+ * fit in one, larger packets will fit across multiple buffers.
+ * This way, we are much less likely to miss out precious tftp
+ * packets
+ */
+
+#define MAX_FRAME (6 + 6 + 2 + 1500 + 22)
+#define PKT_SIZE 160
+#define NFRAMESB 4
+#define NFRAMES (1 << NFRAMESB)
+
+struct buffer_t tx_buffer, rx_buffer[NFRAMES];
+
+/* rx buffers */
+u8 pkts[NFRAMES][PKT_SIZE];
+
+static int dbg = 0;
+static u32 s3c2500_ether_chip_base = 0;
+
+/* the current rx descriptor that the ethernet chip is about to or
+ * currently filling */
+static int curr_desc;
+
+/* Write out a word */
+static inline void se_outw(u32 addr, u32 data)
+{
+	*((volatile u32 *) addr) = data;
+}
+
+/* Read in a word */
+static inline u32 se_inw(u32 addr)
+{
+	return *((volatile u32 *) addr);
+}
+
+/* Set bits in a register */
+static inline void se_bset(u32 addr, u32 bit)
+{
+	se_outw(addr, se_inw(addr) | bit);
+}
+
+
+/* retreive the address from the CAM */
+static int s3c2500_ether_get_addr(u8 dev_addr[6])
+{
+	u32 base;
+
+	if (!(base = s3c2500_ether_chip_base))
+		return -EINVAL;
+
+	memcpy(dev_addr, (u8 *) (base + CAM), 6);
+	DBG(1, "%s: got eth addr %02x:%02x:%02x:%02x:%02x:%02x\n", __FUNCTION__,
+			dev_addr[0], dev_addr[1], dev_addr[2], dev_addr[3], dev_addr[4],
+			dev_addr[5]);
+
+	return 0;
+}
+
+
+/* Write a hardware address to the CAM */
+static int s3c2500_ether_set_addr(u8 dev_addr[6])
+{
+	u32 base;
+
+	if (!(base = s3c2500_ether_chip_base))
+		return -EINVAL;
+
+	memcpy((u8 *) (base + CAM), dev_addr, 6);
+	DBG(1, "%s: set eth addr to %02x:%02x:%02x:%02x:%02x:%02x\n", __FUNCTION__,
+			dev_addr[0], dev_addr[1], dev_addr[2], dev_addr[3], dev_addr[4],
+			dev_addr[5]);
+	return 0;
+}
+
+
+/* Receive a (one) packet up to length bytes, otherwise, discard */
+static int s3c2500_ether_rcv(u8 *data, int length)
+{
+	u32 stat, len, base, pos, desc, copy_len;
+	int ret = 0, i;
+	u8 *copy_base;
+
+	if (!(base = s3c2500_ether_chip_base))
+		return -EINVAL;
+
+	i = curr_desc;
+
+	/* do we own it yet? */
+	if (rx_buffer[i].desc & BDMA_owner) return 0;
+
+	/* Read/clear stat */
+	stat = se_inw(base + BMRXSTAT);
+	se_outw(base + BMRXSTAT, 0);
+
+	/* do we have a packet? */
+	if (!(rx_buffer[i].desc & BRxDone)) return 0;
+
+	pos = 0;
+	len = rx_buffer[i].desc & 0xffff;
+	len -= 4; /* Strip the FCS */
+
+	do {
+		desc = rx_buffer[i].desc;
+
+		/* only do the copying if it will fit */
+		if (len <= length) {
+			copy_base = rx_buffer[i].ptr;
+			if (desc & DescEOF) copy_len = len - pos;
+			else copy_len = PKT_SIZE;
+			if (!pos) {
+				copy_base += 2;
+				copy_len -= 2;
+			}
+			memcpy(data + pos, copy_base, copy_len);
+			pos += copy_len;
+		}
+		i = (i + 1) % NFRAMES;
+	} while (!(desc & DescEOF));
+
+	/* Reenable used (or discarded) for reception */
+	do {
+		rx_buffer[curr_desc++].desc = BDMA_owner;
+		if (curr_desc >= NFRAMES) curr_desc = 0;
+	} while (i != curr_desc);
+
+	/* Make sure transmission is still enabled */
+	se_bset(base + BDMARXCON, BRxEn);
+	se_bset(base + MACRXCON, MRxEn);
+
+	return (len <= length) ? len : 0;
+}
+
+
+/* Send a packet of length bytes (wait on completion) */
+static int s3c2500_ether_snd(u8 *data, int length)
+{
+	u32 base;
+
+	if (!(base = s3c2500_ether_chip_base))
+		return -EINVAL;
+
+	memcpy(data + 6, hwaddress, 6);
+
+	if (length > 1514) {
+		printf("%s: Too big packet error.\n", __FUNCTION__);
+		return -1;
+	}
+
+	/* wait for the descriptor to free up */
+	while (tx_buffer.desc & BDMA_owner);
+
+	/* Setup the descriptor */
+	tx_buffer.ptr = (u8 *) data;
+	tx_buffer.desc = length | ((((u32) data) % 4) << 16) | BDMA_owner;
+
+	/* Make sure everything is ready to go */
+	se_bset(base + BDMATXCON, BTxEn);
+	se_bset(base + MACTXCON, MTxEn);
+
+	/* Wait and see if it goes out */
+	while (!(se_inw(base + BMTXSTAT) & TxComp));
+	
+	/* reset the stats */
+	se_outw(base + BMTXSTAT, 0x0);
+
+	/* give it back */
+	tx_buffer.desc = 0;
+
+	return 0;
+}
+
+
+/* Reset everything */
+static void s3c2500_ether_reset(u32 base)
+{
+	int i;
+	/* Clear out all the registers left by an improper reset
+	 * (see ethernet errata) or a simple jump to 0x0 */
+	for (i = BDMATXCON; i <= BDMARXLEN; i += 4)
+		se_outw(base + i, 0);
+	for (i = MACCON; i < STACON; i += 4)
+		se_outw(base + i, 0);
+	se_outw(base + STACON, 0x00006000);
+	se_outw(base + CAMEN, 0);
+	se_outw(base + MISSCNT, 0);
+	for (i = CAM; i < CAM + 0x80; i += 4)
+		se_outw(base + i, 0);
+
+	/* Reset the TX and RX block */
+	se_outw(base + BDMATXCON, BTxRS);
+	se_outw(base + BDMARXCON, BRxRS);
+
+	/* Reset the MII */
+	se_outw(base + MACCON, MReset);
+
+	DBG(1, "%s: reset done\n", __FUNCTION__);
+}
+
+
+/* Enable everything */
+static void s3c2500_ether_enable(u32 base)
+{
+	int i;
+	/* Set the MAC to full duplex */
+	se_outw(base + MACCON, MACFD);
+
+	/* give it the size of our receive buffer */
+	se_outw(base + BDMARXLEN, PKT_SIZE | MAX_FRAME << 16);
+
+	/* point the chip to our buffers */
+	se_outw(base + BDMATXDPTR, (u32) &tx_buffer);
+	se_outw(base + BDMARXDPTR, (u32) &rx_buffer);
+	
+	/* setup our buffer descriptors */
+	tx_buffer.ptr = 0;
+	tx_buffer.desc = 0;
+	for (i = 0; i < NFRAMES; i++) {
+		rx_buffer[i].ptr = (u8 *) pkts[i];
+		rx_buffer[i].desc = BDMA_owner;
+	}
+	curr_desc = 0;
+	
+	/* put an address in the CAM */
+	s3c2500_ether_set_addr(hwaddress);
+
+	/* Enable reception of our CAM */
+	se_outw(base + CAMEN, 1);
+
+	/* Enable reception modes (MAC matching) */
+	se_outw(base + CAMCON, MBroad | MCompEn | MStation);
+
+	/* setup BDMA and enable reception/transmition */
+	se_outw(base + BDMATXCON, 0x6 << BTxMSL);
+	se_outw(base + MACTXCON, MTxEn);
+
+	se_outw(base + BDMARXCON, BRxEn | (0x2 << BRxMSL) | 
+				  (NFRAMESB << BRxNBD));
+	se_outw(base + MACRXCON, MRxEn);
+
+	DBG(1, "%s: chip enabled.\n", __FUNCTION__);
+}
+
+
+static int s3c2500_ether_init(u32 base)
+{
+
+	DBG(1, "%s(%08x)\n", __FUNCTION__, base);
+
+	s3c2500_ether_chip_base = base;
+
+	s3c2500_ether_reset(base);
+	s3c2500_ether_enable(base);
+
+	return 0;
+}
+
+
+/* export ethernet driver */
+ether_driver_t s3c2500_ether_driver = {
+	init:		s3c2500_ether_init,
+	rcv:		s3c2500_ether_rcv,
+	snd:		s3c2500_ether_snd,
+	get_addr:	s3c2500_ether_get_addr,
+	set_addr:	s3c2500_ether_set_addr,
+	base:		0xF00A0000,
+};
Index: build_tree/bootLoader/src/lib/ether-smc9196.c
diff -u /dev/null build_tree/bootLoader/src/lib/ether-smc9196.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ether-smc9196.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,748 @@
+/*
+ * ether-smc9196.c: Low-level ethernet polling functions
+ *
+ * Most of this code was taken from linux/drivers/net/smc9194.c
+ * Original Author:
+ * 	Erik Stahlman				( erik@vt.edu )
+ * contributors:
+ *      Arnaldo Carvalho de Melo <acme@conectiva.com.br>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#include <blob/util.h>
+#include <blob/time.h>
+#include <blob/errno.h>
+#include <blob/serial.h>
+#include <blob/command.h>
+#include <net/ether.h>
+#include <net/smc9196.h>
+
+/**********************************************************************
+ * defines
+ */
+#undef SMC_DEBUG
+
+#ifdef SMC_DEBUG
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... ) ;
+#endif
+
+#define SMC_BASE (0x18000000)
+#define SMC_SELECT_BANK( base, x ) smc_outw( x, base, BANK_SELECT )
+#define SMC_DELAY() msleep(1);
+#define SMC_SET_INT(base, x)					\
+	{						\
+		smc_outb((x), base, INT_MASK);	\
+	}
+/* this enables an interrupt in the interrupt mask register */
+#define SMC_ENABLE_INT(x)				\
+	{						\
+		u8 mask;				\
+		mask = smc_inb(ioaddr, INT_MASK);	\
+		mask |= (x);				\
+		smc_outb(mask, ioaddr, INT_MASK);	\
+	}
+#define SMC_INTERRUPT_MASK   (IM_EPH_INT | IM_RX_OVRN_INT | IM_RCV_INT) 
+
+/* Duplex, half or full. */
+#define DUPLEX_HALF		0x00
+#define DUPLEX_FULL		0x01
+
+/* Which connector port. */
+#define PORT_TP			0x00
+#define PORT_AUI		0x01
+
+/**********************************************************************
+ * module globals
+ */
+static int dbg = 1;
+static u32 smc_chip_base = 0;
+static u8 pkt[1024];
+
+/**********************************************************************
+ * smc memory access functions
+ */
+static inline u8 smc_inb( u32 base, int reg )
+{
+	return *((volatile u8 *)(base+reg*4));
+}
+
+static inline void smc_ins( u32 ioaddr, int reg, u8 *dest, u16 size )
+{
+	while( size-- )
+		*dest++ = smc_inb( ioaddr, reg );
+}
+
+static inline unsigned short smc_inw(unsigned base, int r)
+{
+	unsigned char b1, b2;
+	msleep(1);
+	b1 = smc_inb(base, r);
+	msleep(1);
+	b2 = smc_inb(base, r+1);
+	return (b2 << 8) | b1;
+}
+
+static inline void smc_outb( u8 val, u32 base, int r )
+{
+	*((volatile u8 *)(base+r*4)) = val;
+}
+
+static inline void smc_outw( u16 val, u32 base, int r )
+{
+	smc_outb(val&0xff, base, r);
+	smc_outb(val>>8, base, r+1);
+}
+
+static inline void smc_outl( u32 val, u32 base, int r )
+{
+	smc_outb(val, base, r);
+	smc_outb(val>>8, base, r+1);
+	smc_outb(val>>16, base, r+2);
+	smc_outb(val>>24, base, r+3);
+}
+
+static inline void smc_outs( u32 ioaddr, int reg, u8 *dest, u16 size )
+{
+	while( size-- )
+		smc_outb( *dest++, ioaddr, reg );
+}
+
+static void hexdump( u8 *address, size_t len )
+{
+	u8 *endaddress = address + len, *start=address;
+	u8 *tmpaddress;
+	u8 value;
+
+	/* print it */
+	for ( ; address < endaddress; address += 0x10) {
+		printf( "0x%08x: ", address-start );
+		for (tmpaddress = address; tmpaddress < address + 0x10; tmpaddress += 1) {
+			value = *tmpaddress;
+			printf( "%02x ", value );
+		}
+		for (tmpaddress = address; tmpaddress < address + 0x10; tmpaddress++) {
+			value = *tmpaddress;
+			if ((value >= ' ') && (value <= '~'))
+				serial_write(value);
+			else
+				serial_write('.');
+		}
+		serial_write('\n');
+	}
+}
+
+/**********************************************************************
+ * static functions
+ */
+static int smc_probe_chip( u32 base )
+{
+	u16 bank;
+
+	bank = smc_inw( base, BANK_SELECT );
+	if ( (bank & 0xff00) != 0x3300 ) {
+		DBG( 1, "%s: probe 1 failed\n", __FUNCTION__ );
+		return -EINVAL;
+	}
+
+	smc_outw( 0, base, BANK_SELECT );
+	bank = smc_inw( base, BANK_SELECT );
+	if ( (bank & 0xff00) != 0x3300 ) {
+		DBG( 1, "%s: probe 2 failed\n", __FUNCTION__ );
+		return -EINVAL;
+	}
+
+	DBG( 1, "%s: probe done\n", __FUNCTION__ );
+	return 0;
+}
+
+static int smc_hw_reset( u32 base )
+{
+	u8 ecor, ecsr;
+	u32 addr = base | ( 1<<25 ); /* ATTRIBUTE SPACE */
+
+	/*
+	 * Reset the device.  We must disable IRQs around this.
+	 */
+	ecor = smc_inb(addr, ECOR) & ~ECOR_RESET;
+	smc_outb(ecor | ECOR_RESET, addr, ECOR);
+	msleep(1);
+
+	/*
+	 * The device will ignore all writes to the enable bit while
+	 * reset is asserted, even if the reset bit is cleared in the
+	 * same write.  Must clear reset first, then enable the device.
+	 */
+	smc_outb(ecor, addr, ECOR);
+	smc_outb(ecor | ECOR_ENABLE, addr, ECOR);
+
+	/*
+	 * Force byte mode.
+	 */
+	ecsr = smc_inb(addr, ECSR);
+	smc_outb( ecsr | ECSR_IOIS8, addr, ECSR);
+
+	DBG( 1, "%s: reset done\n", __FUNCTION__ );
+	return 0;
+}
+
+/*
+ . Function: smc_reset(struct net_device *dev)
+ . Purpose:
+ .  	This sets the SMC91xx chip to its normal state, hopefully from whatever
+ . 	mess that any other DOS driver has put it in.
+ .
+ . Maybe I should reset more registers to defaults in here?  SOFTRESET  should
+ . do that for me.
+ .
+ . Method:
+ .	1.  send a SOFT RESET
+ .	2.  wait for it to finish
+ .	3.  enable autorelease mode
+ .	4.  reset the memory management unit
+ .	5.  clear all interrupts
+ .
+*/
+static void smc_reset(u32 ioaddr)
+{
+	/* This resets the registers mostly to defaults, but doesn't
+	   affect EEPROM.  That seems unnecessary */
+	SMC_SELECT_BANK( ioaddr, 0);
+	smc_outw(RCR_SOFTRESET, ioaddr, RCR);
+
+	/* this should pause enough for the chip to be happy */
+	SMC_DELAY();
+
+	/* Set the transmit and receive configuration registers to
+	   default values */
+	smc_outw(RCR_CLEAR, ioaddr, RCR);
+	smc_outw(TCR_CLEAR, ioaddr, TCR);
+
+	/* set the control register to automatically
+	   release successfully transmitted packets, to make the best
+	   use out of our limited memory */
+	SMC_SELECT_BANK( ioaddr, 1);
+	smc_outw(smc_inw(ioaddr, CONTROL) | CTL_AUTO_RELEASE, ioaddr, CONTROL);
+
+	/* Reset the MMU */
+	SMC_SELECT_BANK( ioaddr, 2);
+	smc_outw(MC_RESET, ioaddr, MMU_CMD);
+
+	/* Note:  It doesn't seem that waiting for the MMU busy is needed here,
+	   but this is a place where future chipsets _COULD_ break.  Be wary
+ 	   of issuing another MMU command right after this */
+	SMC_SET_INT( ioaddr, 0);
+
+	DBG( 1, "%s: sw reset done.\n", __FUNCTION__ );
+}
+
+/*
+ * This is responsible for setting the chip appropriately
+ * for the interface type.  This should only be called while
+ * the interface is up and running.
+ */
+static void smc_set_port(int port, int duplex, u32 ioaddr )
+{
+	u16 val;
+
+	SMC_SELECT_BANK( ioaddr, 1);
+	val = smc_inw(ioaddr, CONFIG);
+	switch (port) {
+	case PORT_TP:
+		DBG( 1, "%s: select TP\n", __FUNCTION__ );
+		val &= ~CFG_AUI_SELECT;
+		break;
+
+	case PORT_AUI:
+		DBG( 1, "%s: select AUI\n", __FUNCTION__ );
+		val |= CFG_AUI_SELECT;
+		break;
+	}
+	smc_outw(val, ioaddr, CONFIG);
+
+	SMC_SELECT_BANK( ioaddr, 0);
+	val = smc_inw(ioaddr, TCR);
+	switch (duplex) {
+	case DUPLEX_HALF:
+		DBG( 1, "%s: select half duplex\n", __FUNCTION__ );
+		val &= ~TCR_FDSE;
+		break;
+
+	case DUPLEX_FULL:
+		DBG( 1, "%s: select full duplex\n", __FUNCTION__ );
+		val |= TCR_FDSE;
+		break;
+	}
+	smc_outw(val, ioaddr, TCR);
+}
+
+static int smc_get_ethaddr( u32 ioaddr, u8 dev_addr[6] )
+{
+	int i;
+
+	SMC_SELECT_BANK( ioaddr, 1);
+	for ( i=0; i<6; i+=2 ) {
+		u16	address;
+
+		address = smc_inw(ioaddr, ADDR0 + i);
+		dev_addr[i + 1] = address >> 8;
+		dev_addr[i] = address & 0xFF;
+	}
+
+	DBG( 1, "%s: got eth addr %02x:%02x:%02x:%02x:%02x:%02x\n", __FUNCTION__,
+			dev_addr[0], dev_addr[1], dev_addr[2], dev_addr[3], dev_addr[4],
+			dev_addr[5] );
+
+	return 0;
+}
+
+static int smc_set_ethaddr( u32 ioaddr, u8 dev_addr[6] )
+{
+	int i;
+
+	SMC_SELECT_BANK( ioaddr, 1);
+	for ( i=0; i<6; i+=2 ) {
+		u16	address;
+
+		address = dev_addr[i+1]<<8 | dev_addr[i];
+
+		smc_outw(address, ioaddr, ADDR0 + i);
+	}
+
+	DBG( 1, "%s: set eth addr to %02x:%02x:%02x:%02x:%02x:%02x\n", __FUNCTION__,
+			dev_addr[0], dev_addr[1], dev_addr[2], dev_addr[3], dev_addr[4],
+			dev_addr[5] );
+	return 0;
+}
+
+/*
+ . Function: smc_enable
+ . Purpose: let the chip talk to the outside work
+ . Method:
+ .	1.  Enable the transmitter
+ .	2.  Enable the receiver
+ .	3.  Enable interrupts
+*/
+static void smc_enable(u32 ioaddr)
+{
+	SMC_SELECT_BANK( ioaddr, 0);
+	/* see the header file for options in TCR/RCR NORMAL*/
+	smc_outw(TCR_NORMAL, ioaddr, TCR);
+	smc_outw(RCR_NORMAL, ioaddr, RCR);
+
+	/* now, enable interrupts */
+	SMC_SELECT_BANK( ioaddr, 2);
+	SMC_SET_INT( ioaddr, SMC_INTERRUPT_MASK);
+	//SMC_SET_INT( ioaddr, 0);
+	DBG( 1, "%s: chip enabled.\n", __FUNCTION__ );
+}
+
+/*-------------------------------------------------------------
+ .
+ . smc_rcv - receive a packet from the card
+ .
+ . There is (at least) a packet waiting to be read from
+ . chip-memory.
+ .
+ . o Read the status
+ . o If an error, record it
+ . o otherwise, read in the packet
+ --------------------------------------------------------------
+*/
+static int smc_rcv( u32 ioaddr, u8 *data, u16 size )
+{
+	int ret = 0;
+	int	packet_number;
+	u16	status;
+	u16	packet_length;
+
+	/* assume bank 2 */
+
+	packet_number = smc_inw(ioaddr, FIFO_PORTS);
+
+	if (packet_number & FP_RXEMPTY) {
+		/* we got called , but nothing was on the FIFO */
+		DBG( 2, "%s: WARNING: smc_rcv with nothing on FIFO.\n",
+			__FUNCTION__);
+		/* don't need to restore anything */
+		ret = -1;
+		goto done;
+	}
+
+	/*  start reading from the start of the packet */
+	smc_outw(PTR_READ | PTR_RCV | PTR_AUTOINC, ioaddr, POINTER);
+
+	/* First two words are status and packet_length */
+	status 		= smc_inw(ioaddr, DATA_1);
+	packet_length 	= smc_inw(ioaddr, DATA_1);
+
+	packet_length &= 0x07ff;  /* mask off top bits */
+
+	DBG( 5, "RCV: STATUS %4x LENGTH %4x\n", status, packet_length);
+	/*
+	 . the packet length contains 3 extra words :
+	 . status, length, and an extra word with an odd byte .
+	*/
+	packet_length -= 6;
+
+	if (status & RS_ERRORS) {
+		/* error ... */
+		printf( "%s: RCV error\n", __FUNCTION__ );
+		ret =  -1;
+		goto done;
+	}
+	/* do stuff to make a new packet */
+
+	/* read one extra byte */
+	if (status & RS_ODDFRAME)
+		packet_length++;
+
+	/*
+	 ! This should work without alignment, but it could be
+	 ! in the worse case
+	*/
+
+	if ( packet_length > size ) {
+		printf( "%s: packet (%d) too large for buffer (%d).\n", __FUNCTION__,
+				packet_length, size );
+		ret = -1;
+		goto done;
+	}
+
+	smc_ins(ioaddr, DATA_1, data, packet_length);
+	//print_packet(data, packet_length);
+	
+
+	ret = packet_length;
+done:
+	/*  error or good, tell the card to get rid of this packet */
+	smc_outw(MC_RELEASE, ioaddr, MMU_CMD);
+	return ret;
+}
+
+/*
+ . Function:  smc_hardware_send_packet(struct net_device *)
+ . Purpose:
+ .	This sends the actual packet to the SMC9xxx chip.
+ .
+ . Algorithm:
+ . 	First, see if a saved_skb is available.
+ .		(this should NOT be called if there is no 'saved_skb'
+ .	Now, find the packet number that the chip allocated
+ .	Point the data pointers at it in memory
+ .	Set the length word in the chip's memory
+ .	Dump the packet to chip memory
+ .	Check if a last byte is needed (odd length packet)
+ .		if so, set the control flag right
+ . 	Tell the card to send it
+ .	Enable the transmit interrupt, so I know if it failed
+ . 	Free the kernel data if I actually sent it.
+*/
+static void smc_hardware_send_packet( u32 ioaddr, u8 *buf, u16 length )
+{
+	u16 lastword;
+	u8 packet_no;
+
+	DBG( 5, "%s( %p, %p, %d)\n", __FUNCTION__,
+			(void *)ioaddr, (void *)buf, length );
+
+	/* If I get here, I _know_ there is a packet slot waiting for me */
+	packet_no = smc_inb(ioaddr, PNR_ARR + 1);
+	if (packet_no & 0x80) {
+		printf("%s: Memory allocation failed.\n", __FUNCTION__ );
+		return;
+	}
+
+	DBG( 5, "packet_no=%d\n", packet_no );
+
+	/* we have a packet address, so tell the card to use it */
+	smc_outb(packet_no, ioaddr, PNR_ARR);
+
+	/* point to the beginning of the packet */
+	smc_outw(PTR_AUTOINC, ioaddr, POINTER);
+
+ 	DBG( 5, "%s: Trying to xmit packet of length %d\n",
+		__FUNCTION__, length);
+
+	//print_packet(buf, length);
+
+	/* send the packet length (+6 for status, length and ctl byte)
+ 	   and the status word (set to zeros) */
+	smc_outl((length + 6) << 16, ioaddr, DATA_1);
+
+	/* send the actual data
+	 . I _think_ it's faster to send the longs first, and then
+	 . mop up by sending the last word.  It depends heavily
+ 	 . on alignment, at least on the 486.  Maybe it would be
+ 	 . a good idea to check which is optimal?  But that could take
+	 . almost as much time as is saved?
+	*/
+	smc_outs(ioaddr, DATA_1, buf, length);
+
+	/* Send the last byte, if there is one.   */
+	if ((length & 1) == 0)
+		lastword = 0;
+	else
+		lastword = 0x2000 | buf[length - 1];
+	smc_outw(lastword, ioaddr, DATA_1);
+
+	/* enable the interrupts */
+	SMC_ENABLE_INT(IM_TX_INT | IM_TX_EMPTY_INT);
+
+	/* and let the chipset deal with it */
+	smc_outw(MC_ENQUEUE, ioaddr, MMU_CMD);
+
+	DBG( 5, "%s: Sent packet of length %d\n", __FUNCTION__, length);
+	return;
+}
+
+/*
+ . Function: smc_wait_to_send_packet(struct sk_buff * skb, struct net_device *)
+ . Purpose:
+ .    Attempt to allocate memory for a packet, if chip-memory is not
+ .    available, then tell the card to generate an interrupt when it
+ .    is available.
+ .
+ . Algorithm:
+ .
+ . o	if the saved_skb is not currently null, then drop this packet
+ .	on the floor.  This should never happen, because of TBUSY.
+ . o	if the saved_skb is null, then replace it with the current packet,
+ . o	See if I can sending it now.
+ . o 	(NO): Enable interrupts and let the interrupt handler deal with it.
+ . o	(YES):Send it now.
+*/
+static int smc_send(u32 ioaddr, u8 *data, u16 length )
+{
+	unsigned short numPages;
+	u16	time_out;
+
+	DBG( 5, "%s( %p, %p, %d)\n", __FUNCTION__,
+			(void *)ioaddr, (void *)data, length );
+
+	/*
+	** The MMU wants the number of pages to be the number of 256 bytes
+	** 'pages', minus 1 (since a packet can't ever have 0 pages :))
+	**
+	** Pkt size for allocating is data length +6 (for additional status words,
+	** length and ctl!) If odd size last byte is included in this header.
+	*/
+	numPages = ((length & 0xfffe) + 6) / 256;
+	DBG( 5, "numPages=%d\n", numPages );
+
+	if (numPages > 7) {
+		printf("%s: Far too big packet error.\n", __FUNCTION__);
+		return -1;
+	}
+
+	/* now, try to allocate the memory */
+	SMC_SELECT_BANK( ioaddr, 2);
+	smc_outw(MC_ALLOC | numPages, ioaddr, MMU_CMD);
+
+	time_out = 10;
+	do {
+		u16	status;
+
+		status = smc_inb(ioaddr, INTERRUPT);
+		DBG( 5, "status=%d\n", status );
+		if (status & IM_ALLOC_INT) {
+			/* acknowledge the interrupt */
+			smc_outb(IM_ALLOC_INT, ioaddr, INTERRUPT);
+			break;
+		}
+		//msleep(1);
+ 	} while (-- time_out);
+
+ 	if (!time_out) {
+		printf("%s: memory allocation time out.\n", __FUNCTION__ );
+		return -1;
+ 	}
+
+	/* or YES! I can send the packet now.. */
+	smc_hardware_send_packet(ioaddr, data, length );
+	return 0;
+}
+
+
+/**********************************************************************
+ * test command
+ */
+static int smctest( int argc, char *argv[] )
+{
+	u32 base = SMC_BASE;
+	u8 hw_addr_set[6] = { 2,3,4,5,6,7 };
+	//u8 hw_addr_set[6] = { 0x00, 0x50, 0x7f, 0x01, 0xcf, 0x0f };
+	u8 hw_addr[6];
+	u8 serverip[4] = { 192, 168, 1, 1 };
+	u8 clientip[4] = { 192, 168, 1, 191 };
+	int i;
+	static const unsigned char arp_txpacket[] =
+	{					/* destination address			*/
+		/* source address			*/
+		0x08, 0x06,				/* proto				*/
+		/* arp */
+		0x00, 0x01,				/* hardware format: ethernet		*/
+		0x08, 0x00,				/* protocol format: ip			*/
+		0x06,					/* hardware length			*/
+		0x04,					/* protocol length			*/
+		0x00, 0x01				/* arp request				*/
+	};
+	static unsigned char arp_tx[64];
+	unsigned char *p = arp_tx;
+
+	if (smc_init(base))
+		return -EINVAL;
+
+	set_ethaddr( hw_addr_set );
+	get_ethaddr( hw_addr );
+
+	printf( "eth hw addr %02x:%02x:%02x:%02x:%02x:%02x\n",
+			hw_addr[0], hw_addr[1], hw_addr[2], 
+			hw_addr[3], hw_addr[4], hw_addr[5] );
+
+	memset (p, 0, sizeof (arp_tx));
+	memset  (p, 0xff, 6);
+	memcpy  (p + 12, arp_txpacket, sizeof (arp_txpacket));
+	memcpy  (p + 22, hw_addr, 6);
+	memcpy  (p + 28, clientip, 4);
+	memcpy  (p + 38, serverip, 4);
+
+	i=1024;
+	while (i-- ) {
+		//msleep( 100 );
+		if (!(i & (~0xf )))
+			printf( "." );
+		writeether( p, 60 );
+	}
+
+	i=1024;
+	while (i-- ) {
+		int pkt_size;
+
+		pkt_size = readether( pkt, 1024 );
+		if ( pkt_size > 0 ) {
+			printf( "[%02d]", pkt_size );
+		} else {
+			printf( "." );
+		}
+	}
+	printf( "\n" );
+
+	return 0;
+}
+static char smctesthelp[] = "test smc 91c96 ethernet chip\n";
+__commandlist(smctest, "smctest", smctesthelp);
+
+/**********************************************************************
+ * exported functions
+ */
+
+static int smc_init(u32 base)
+{
+	DBG( 1, "%s(%08x)\n", __FUNCTION__, base );
+	smc_hw_reset(base);
+
+	if ( smc_probe_chip(base) )
+		return -EINVAL;
+
+	smc_reset(base);
+	smc_enable(base);
+	smc_set_port( PORT_TP, DUPLEX_HALF, base );
+	smc_set_ethaddr( base, hwaddress );
+
+	smc_chip_base = base;
+	return 0;
+}
+
+static int writeether( u8 *buf, int size )
+{
+	if ( !smc_chip_base )
+		return -EINVAL;
+
+	memcpy( buf+6, hwaddress, 6 );
+
+//#ifdef SMC_DEBUG
+#if 0
+		printf( "%s: tx packet (%d bytes):\n", __FUNCTION__, size );
+		hexdump( buf, size );
+#endif
+
+	return smc_send( smc_chip_base, buf, size );
+}
+
+static int readether( u8 *buf, int size )
+{
+	int ret = 0;
+	u8 status;
+	u8 mask = 0xff;
+
+	if ( !smc_chip_base ) {
+		ret = -EINVAL;
+		goto done;
+	}
+
+	mask = smc_inb(smc_chip_base, INT_MASK);
+	/* clear all interrupts */
+	SMC_SET_INT( smc_chip_base, 0);
+
+	/* read the status flag, and mask it */
+	status = smc_inb(smc_chip_base, INTERRUPT) & mask;
+	if (!status) {
+		ret = 0;
+	} else if ( status & IM_RCV_INT ) { 
+		ret = smc_rcv( smc_chip_base, buf, size );
+//#ifdef SMC_DEBUG
+#if 0
+		printf( "%s: rx packet (%d bytes):\n", __FUNCTION__, size );
+		hexdump( buf, size>0x80?0x80:size );
+#endif
+	}
+
+	/* restore state register */
+	SMC_SELECT_BANK( smc_chip_base, 2);
+	SMC_SET_INT(smc_chip_base, mask);
+done:
+	return ret;
+}
+
+static int set_ethaddr( u8 hw_addr[6] )
+{
+	if ( !smc_chip_base )
+		return -EINVAL;
+
+	return smc_set_ethaddr( smc_chip_base, hw_addr );
+}
+static int get_ethaddr( u8 hw_addr[6] )
+{
+	if ( !smc_chip_base )
+		return -EINVAL;
+
+	return smc_get_ethaddr( smc_chip_base, hw_addr );
+}
+
+/* export ethernet driver */
+ether_driver_t smc9196_ether_driver = {
+	init:		smc_init,
+	rcv:		readether,
+	snd:		writeether,
+	set_addr:	set_ethaddr,
+	get_addr:	get_ethaddr,
+	base:		SMC_BASE,
+};
+
+
Index: build_tree/bootLoader/src/lib/ether-smc91x.c
diff -u /dev/null build_tree/bootLoader/src/lib/ether-smc91x.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ether-smc91x.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,1089 @@
+/*------------------------------------------------------------------------
+ . ether-smc91x.c
+ . This is a driver for SMSC's 91C9x/91C1xx single-chip Ethernet devices.
+ .
+ . Copyright (C) 1996 by Erik Stahlman
+ . Copyright (C) 2001 Standard Microsystems Corporation
+ .	Developed by Simple Network Magic Corporation
+ . Copyright (C) 2003 Monta Vista Software, Inc.
+ .	Unified SMC91x driver by Nicolas Pitre
+ .
+ . This program is free software; you can redistribute it and/or modify
+ . it under the terms of the GNU General Public License as published by
+ . the Free Software Foundation; either version 2 of the License, or
+ . (at your option) any later version.
+ .
+ . This program is distributed in the hope that it will be useful,
+ . but WITHOUT ANY WARRANTY; without even the implied warranty of
+ . MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ . GNU General Public License for more details.
+ .
+ . You should have received a copy of the GNU General Public License
+ . along with this program; if not, write to the Free Software
+ . Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ .
+ . Arguments:
+ . 	io	= for the base address
+ .	irq	= for the IRQ
+ .	nowait	= 0 for normal wait states, 1 eliminates additional wait states
+ .
+ . original author:
+ . 	Erik Stahlman <erik@vt.edu>
+ .
+ . hardware multicast code:
+ .    Peter Cammaert <pc@denkart.be>
+ .
+ . contributors:
+ . 	Daris A Nevil <dnevil@snmc.com>
+ .      Nicolas Pitre <nico@cam.org>
+ .
+ . History:
+ .   08/20/00  Arnaldo Melo       fix kfree(skb) in smc_hardware_send_packet
+ .   12/15/00  Christian Jullien  fix "Warning: kfree_skb on hard IRQ"
+ .   03/16/01  Daris A Nevil      modified smc9194.c for use with LAN91C111
+ .   08/22/01  Scott Anderson     merge changes from smc9194 to smc91111
+ .   08/21/01  Pramod B Bhardwaj  added support for RevB of LAN91C111
+ .   12/20/01  Jeff Sutherland    initial port to Xscale PXA with DMA support
+ .   04/07/03  Nicolas Pitre      unified SMC91x driver, killed irq races,
+ .                                more bus abstraction, big cleanup, etc.
+ .   09/07/03  Yu Tang		  ported to BLOB from Linux.
+ ----------------------------------------------------------------------------*/
+
+#ifdef HAVE_CONFIG_H
+#include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/util.h>
+#include <blob/time.h>
+#include <blob/errno.h>
+#include <blob/serial.h>
+#include <blob/command.h>
+#include <net/ether.h>
+#include <net/net.h>
+#include <net/smc91x.h>
+
+
+/***************************************************************************
+ * defines
+ */
+#undef SMC_DEBUG
+
+#ifdef SMC_DEBUG
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... ) ;
+#endif
+
+/*------------------------------------------------------------------------
+ .
+ . The internal workings of the driver.  If you are changing anything
+ . here with the SMC stuff, you should have the datasheet and know
+ . what you are doing.
+ .
+ -------------------------------------------------------------------------*/
+#define CARDNAME "LAN91x"
+
+// Use power-down feature of the chip
+#define POWER_DOWN		1
+
+/*
+ . Wait time for memory to be free.  This probably shouldn't be
+ . tuned that much, as waiting for this means nothing else happens
+ . in the system
+*/
+#define MEMORY_WAIT_TIME	16
+
+/*
+ . This selects whether TX packets are sent one by one to the SMC91x internal
+ . memory ans throttled until transmission completes.  This may prevent
+ . RX overruns a litle by keeping much of the memory free for RX packets
+ . but to the expense of reduced TX throughput and increased IRQ overhead.
+ . Note this is not a cure for a too slow data bus or too high IRQ latency.
+ */
+#define THROTTLE_TX_PKTS	0
+
+/**********************************************************************
+ * Local 
+ */
+static int smc_chip_base = 0;
+static int dbg = 1;
+
+#if SMC_DEBUG
+static void HEXDUMP(u8 *buf, int length)
+{
+	int i;
+	int remainder;
+	int lines;
+
+	lines = length / 16;
+	remainder = length % 16;
+
+	for (i = 0; i < lines ; i ++) {
+		int cur;
+		for (cur = 0; cur < 8; cur++) {
+			u8 a, b;
+			a = *buf++;
+			b = *buf++;
+			printf("%02x%02x ", a, b);
+		}
+		printf("\n");
+	}
+	for (i = 0; i < remainder/2 ; i++) {
+		u8 a, b;
+		a = *buf++;
+		b = *buf++;
+		printf("%02x%02x ", a, b );
+	}
+	printf("\n");
+}
+#else
+#define HEXDUMP(x...)  do { } while(0)
+#endif
+
+/* this enables an interrupt in the interrupt mask register */
+#define SMC_ENABLE_INT(x) do {						\
+	unsigned long flags;						\
+	unsigned char mask;						\
+	mask = SMC_GET_INT_MASK();					\
+	mask |= (x);							\
+	SMC_SET_INT_MASK(mask);						\
+} while (0)
+
+/* this disables an interrupt from the interrupt mask register */
+#define SMC_DISABLE_INT(x) do {						\
+	unsigned long flags;						\
+	unsigned char mask;						\
+	mask = SMC_GET_INT_MASK();					\
+	mask &= ~(x);							\
+	SMC_SET_INT_MASK(mask);						\
+} while (0)
+
+/* wait while MMU is busy */
+#define SMC_WAIT_MMU_BUSY() do {					\
+	if (SMC_GET_MMU_CMD() & MC_BUSY) {				\
+		long timeout = 0x1000;					\
+		while (SMC_GET_MMU_CMD() & MC_BUSY) {			\
+			timeout --;					\
+			if (!timeout) {					\
+				printf("%s: timeout %s line %d\n",	\
+					CARDNAME, __FILE__, __LINE__);	\
+				break;					\
+			}						\
+		}							\
+	}								\
+} while (0)
+
+/**********************************************************************
+ * Core routines
+ */
+
+/* this does a soft reset on the device */
+static void smc_reset(u32 ioaddr)
+{
+	DBG(2, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	/* This resets the registers mostly to defaults, but doesn't
+	   affect EEPROM.  That seems unnecessary */
+	SMC_SELECT_BANK( 0 );
+	SMC_SET_RCR( RCR_SOFTRST );
+
+	/* Setup the Configuration Register */
+	/* This is necessary because the CONFIG_REG is not affected */
+	/* by a soft reset */
+	SMC_SELECT_BANK( 1 );
+	SMC_SET_CONFIG( CONFIG_DEFAULT );
+
+	/* Setup for fast accesses if requested */
+	/* If the card/system can't handle it then there will */
+	/* be no recovery except for a hard reset or power cycle */
+	SMC_SET_CONFIG( SMC_GET_CONFIG() | CONFIG_NO_WAIT );
+
+#ifdef POWER_DOWN
+	/* Release from possible power-down state */
+	/* Configuration register is not affected by Soft Reset */
+	SMC_SELECT_BANK( 1 );
+	SMC_SET_CONFIG( SMC_GET_CONFIG() | CONFIG_EPH_POWER_EN );
+#endif
+
+	/* this should pause enough for the chip to be happy */
+	msleep(1);
+
+	/* Disable transmit and receive functionality */
+	SMC_SELECT_BANK( 0 );
+	SMC_SET_RCR( RCR_CLEAR );
+	SMC_SET_TCR( TCR_CLEAR );
+
+	/* set the control register to automatically
+	   release successfully transmitted packets, to make the best
+	   use out of our limited memory */
+	SMC_SELECT_BANK( 1 );
+#if ! THROTTLE_TX_PKTS
+	SMC_SET_CTL( SMC_GET_CTL() | CTL_AUTO_RELEASE );
+#else
+	SMC_SET_CTL( SMC_GET_CTL() & ~CTL_AUTO_RELEASE );
+#endif
+
+	/* Disable all interrupts */
+	SMC_SELECT_BANK( 2 );
+	SMC_SET_INT_MASK( 0 );
+
+	/* Reset the MMU */
+	SMC_SET_MMU_CMD( MC_RESET );
+	SMC_WAIT_MMU_BUSY();
+}
+
+/* Enable Interrupts, Receive, and Transmit */
+static void smc_enable(u32 ioaddr)
+{
+	int mask;
+
+	DBG(2, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	/* see the header file for options in TCR/RCR DEFAULT*/
+	SMC_SELECT_BANK( 0 );
+	SMC_SET_TCR( TCR_DEFAULT);
+	SMC_SET_RCR( RCR_DEFAULT);
+
+	/* now, enable interrupts */
+	mask = IM_EPH_INT|IM_RX_OVRN_INT|IM_RCV_INT;
+	SMC_SELECT_BANK( 2 );
+	SMC_SET_INT_MASK( mask );
+}
+
+/* this puts the device in an inactive state */
+static void smc_shutdown(unsigned long ioaddr)
+{
+	DBG(2, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	/* no more interrupts for me */
+	SMC_SELECT_BANK( 2 );
+	SMC_SET_INT_MASK( 0 );
+
+	/* and tell the card to stay away from that nasty outside world */
+	SMC_SELECT_BANK( 0 );
+	SMC_SET_RCR( RCR_CLEAR );
+	SMC_SET_TCR( TCR_CLEAR );
+
+#ifdef POWER_DOWN
+	/* finally, shut the chip down */
+	SMC_SELECT_BANK( 1 );
+	SMC_SET_CONFIG( SMC_GET_CONFIG() & ~CONFIG_EPH_POWER_EN );
+#endif
+}
+
+/* This is the procedure to handle the receipt of a packet. */
+static inline int smc_rcv(u32 ioaddr, u8 *data, u16 size)
+{
+	unsigned int packet_number, status, packet_len;
+	int ret = 0;
+
+	DBG(3, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	packet_number = SMC_GET_RXFIFO();
+	if (packet_number & RXFIFO_REMPTY) {
+		DBG(1, "%s: smc_rcv with nothing on FIFO.\n", CARDNAME);
+		return;
+	}
+
+	/* read from start of packet */
+	SMC_SET_PTR( PTR_READ | PTR_RCV | PTR_AUTOINC );
+
+	/* First two words are status and packet length */
+	SMC_GET_PKT_HDR(status, packet_len);
+	packet_len &= 0x07ff;  /* mask off top bits */
+	DBG(2, "%s: RX PNR 0x%x STATUS 0x%04x LENGTH 0x%04x (%d)\n",
+		CARDNAME, packet_number, status,
+		packet_len, packet_len);
+
+	if (status & RS_ERRORS) {
+		printf(" %s : RCV error\n", __FUNCTION__);
+		ret = -1;
+		goto done;
+	}
+
+	if (status & RS_ODDFRAME)
+		packet_len ++;
+
+	packet_len -= 6;
+
+	SMC_PULL_DATA(data, packet_len);
+
+	HEXDUMP(data, packet_len);
+
+	ret = packet_len;
+done:
+	SMC_WAIT_MMU_BUSY();
+	SMC_SET_MMU_CMD( MC_RELEASE );
+
+	return ret;
+}
+
+/*
+ * This is called to actually send a packet to the chip.
+ * Returns non-zero when successful.
+ */
+static void smc_hardware_send_packet( u32 ioaddr , u8 *data , int size)
+{
+	unsigned int packet_no, len;
+	unsigned char *buf;
+
+	DBG(3, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	packet_no = SMC_GET_AR();
+	if (packet_no & AR_FAILED) {
+		printf("%s: Memory allocation failed.\n", CARDNAME);
+		return;
+	}
+
+	/* point to the beginning of the packet */
+	SMC_SET_PN( packet_no );
+	SMC_SET_PTR( PTR_AUTOINC );
+
+	buf = data;
+	len = size;
+	DBG(2, "%s: TX PNR 0x%x lENGTH 0x%04x (%d) BUF 0x%p\n",
+		CARDNAME, packet_no, len, len, buf);
+
+	HEXDUMP(buf, len);
+
+	/*
+	 * Send the packet length ( +6 for status words, length, and ctl.
+	 * The card will pad to 64 bytes with zeroes if packet is too small.
+	 */
+	SMC_PUT_PKT_HDR(0, len + 6);
+
+	/* send the actual data */
+	SMC_PUSH_DATA(buf, len & ~1);
+
+	/* Send final ctl word with the last byte if there is one */
+	SMC_outw( ((len & 1) ? (0x2000 | buf[len-1]) : 0), ioaddr, DATA_REG );
+
+	/* and let the chipset deal with it */
+	SMC_SET_MMU_CMD( MC_ENQUEUE );
+}
+
+/*
+ . Since I am not sure if I will have enough room in the chip's ram
+ . to store the packet, I call this routine which either sends it
+ . now, or set the card to generates an interrupt when ready
+ . for the packet.
+ */
+static int
+smc_send( u32 ioaddr, u8 *data, int size )
+{
+	unsigned int numPages, poll_count, status, saved_bank;
+	int try = 3;
+
+	DBG(3, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	/*
+	** The MMU wants the number of pages to be the number of 256 bytes
+	** 'pages', minus 1 ( since a packet can't ever have 0 pages :) )
+	**
+	** The 91C111 ignores the size bits, but the code is left intact
+	** for backwards and future compatibility.
+	**
+	** Pkt size for allocating is data length +6 (for additional status
+	** words, length and ctl!)
+	**
+	** If odd size then last byte is included in ctl word.
+	*/
+	numPages = ((size & ~1) + (6 - 1)) >> 8;
+	if (numPages > 7) {
+		printf("%s: Far too big packet error.\n", CARDNAME);
+		return 0;
+	}
+
+	/* now, try to allocate the memory */
+	saved_bank = SMC_CURRENT_BANK();
+again:
+	SMC_SELECT_BANK( 2 );
+	SMC_SET_MMU_CMD( MC_ALLOC | numPages );
+
+	/*
+	 * Poll the chip for a short amount of time in case the
+	 * allocation succeeds quickly.
+	 */
+	poll_count = MEMORY_WAIT_TIME;
+	do {
+		status = SMC_GET_INT();
+		if (status & IM_ALLOC_INT) {
+			SMC_ACK_INT( IM_ALLOC_INT );
+  			break;
+		}
+   	} while (--poll_count);
+
+ 	if (!poll_count) {
+		if (!try) {
+			printf("%s: memory allocation time out.\n", __FUNCTION__ );
+			return -1;
+		}
+
+		try --;
+		/* Reset the MMU */
+		SMC_SELECT_BANK( 2 );
+		SMC_SET_MMU_CMD( MC_RESET );
+		SMC_WAIT_MMU_BUSY();
+
+		goto again;
+ 	}
+
+	SMC_ENABLE_INT(IM_TX_INT | IM_TX_EMPTY_INT);
+	smc_hardware_send_packet( ioaddr, data, size );
+
+	/* waiting for transmit done */
+	while ( !((status = SMC_GET_INT()) & (IM_TX_INT|IM_TX_EMPTY_INT)));
+
+	if (status & IM_TX_INT) 
+		SMC_ACK_INT(IM_TX_INT);
+	if (status & IM_TX_EMPTY_INT) 
+		SMC_ACK_INT(IM_TX_EMPTY_INT);
+
+	SMC_SELECT_BANK( saved_bank );
+
+	return 0;
+}
+
+/**********************************************************************
+ * PHY Control and Configuration
+ */
+
+/*------------------------------------------------------------
+ . Debugging function for viewing MII Management serial bitstream
+ .-------------------------------------------------------------*/
+#if SMC_DEBUG 
+static void
+PRINT_MII_STREAM(u8 *bits, int size)
+{
+	int i;
+
+	printf("BIT#:");
+	for (i = 0; i < size; ++i)
+		printf("%d", i%10);
+
+	printf("\nMDOE:");
+	for (i = 0; i < size; ++i) {
+		if (bits[i] & MII_MDOE)
+			printf("1");
+		else
+			printf("0");
+	}
+
+	printf("\nMDO :");
+	for (i = 0; i < size; ++i) {
+		if (bits[i] & MII_MDO)
+			printf("1");
+		else
+			printf("0");
+	}
+
+	printf("\nMDI :");
+	for (i = 0; i < size; ++i) {
+		if (bits[i] & MII_MDI)
+			printf("1");
+		else
+			printf("0");
+	}
+
+	printf("\n");
+}
+#else
+#define PRINT_MII_STREAM(x...)
+#endif
+
+/*------------------------------------------------------------
+ . Reads a register from the MII Management serial interface
+ .-------------------------------------------------------------*/
+static int
+smc_read_phy_register(unsigned long ioaddr, int phyaddr, int phyreg)
+{
+	int oldBank;
+	int i, mask, mii_reg;
+	u8 bits[64];
+	int input_idx, phydata;
+	int clk_idx = 0;
+
+	// 32 consecutive ones on MDO to establish sync
+	for (i = 0; i < 32; ++i)
+		bits[clk_idx++] = MII_MDOE | MII_MDO;
+
+	// Start code <01>
+	bits[clk_idx++] = MII_MDOE;
+	bits[clk_idx++] = MII_MDOE | MII_MDO;
+
+	// Read command <10>
+	bits[clk_idx++] = MII_MDOE | MII_MDO;
+	bits[clk_idx++] = MII_MDOE;
+
+	// Output the PHY address, msb first
+	mask = 0x10;
+	for (i = 0; i < 5; ++i) {
+		if (phyaddr & mask)
+			bits[clk_idx++] = MII_MDOE | MII_MDO;
+		else
+			bits[clk_idx++] = MII_MDOE;
+
+		// Shift to next lowest bit
+		mask >>= 1;
+	}
+
+	// Output the phy register number, msb first
+	mask = 0x10;
+	for (i = 0; i < 5; ++i) {
+		if (phyreg & mask)
+			bits[clk_idx++] = MII_MDOE | MII_MDO;
+		else
+			bits[clk_idx++] = MII_MDOE;
+
+		// Shift to next lowest bit
+		mask >>= 1;
+	}
+
+	// Tristate and turnaround (2 bit times)
+	bits[clk_idx++] = 0;
+	//bits[clk_idx++] = 0;
+
+	// Input starts at this bit time
+	input_idx = clk_idx;
+
+	// Will input 16 bits
+	for (i = 0; i < 16; ++i)
+		bits[clk_idx++] = 0;
+
+	// Final clock bit
+	bits[clk_idx++] = 0;
+
+	// Save the current bank
+	oldBank = SMC_CURRENT_BANK();
+
+	// Select bank 3
+	SMC_SELECT_BANK( 3 );
+
+	// Get the current MII register value
+	mii_reg = SMC_GET_MII();
+
+	// Turn off all MII Interface bits
+	mii_reg &= ~(MII_MDOE|MII_MCLK|MII_MDI|MII_MDO);
+
+	// Clock all 64 cycles
+	for (i = 0; i < sizeof bits; ++i) {
+		// Clock Low - output data
+		SMC_SET_MII( mii_reg | bits[i] );
+		msleep(1);
+
+		// Clock Hi - input data
+		SMC_SET_MII( mii_reg | bits[i] | MII_MCLK );
+		msleep(1);
+		bits[i] |= SMC_GET_MII() & MII_MDI;
+	}
+
+	// Return to idle state
+	// Set clock to low, data to low, and output tristated
+	SMC_SET_MII( mii_reg );
+	msleep(1);
+
+	// Restore original bank select
+	SMC_SELECT_BANK( oldBank );
+
+	// Recover input data
+	phydata = 0;
+	for (i = 0; i < 16; ++i) {
+		phydata <<= 1;
+
+		if (bits[input_idx++] & MII_MDI)
+			phydata |= 0x0001;
+	}
+
+	DBG(3, "%s: phyaddr=0x%x, phyreg=0x%x, phydata=0x%x\n",
+		__FUNCTION__, phyaddr, phyreg, phydata);
+	PRINT_MII_STREAM(bits, sizeof(bits));
+
+	return phydata;
+}
+
+/*------------------------------------------------------------
+ . Writes a register to the MII Management serial interface
+ .-------------------------------------------------------------*/
+static void
+smc_write_phy_register( unsigned long ioaddr, int phyaddr,
+			int phyreg, int phydata )
+{
+	int oldBank;
+	int i, mask, mii_reg;
+	u8 bits[65];
+	int clk_idx = 0;
+
+	// 32 consecutive ones on MDO to establish sync
+	for (i = 0; i < 32; ++i)
+		bits[clk_idx++] = MII_MDOE | MII_MDO;
+
+	// Start code <01>
+	bits[clk_idx++] = MII_MDOE;
+	bits[clk_idx++] = MII_MDOE | MII_MDO;
+
+	// Write command <01>
+	bits[clk_idx++] = MII_MDOE;
+	bits[clk_idx++] = MII_MDOE | MII_MDO;
+
+	// Output the PHY address, msb first
+	mask = 0x10;
+	for (i = 0; i < 5; ++i) {
+		if (phyaddr & mask)
+			bits[clk_idx++] = MII_MDOE | MII_MDO;
+		else
+			bits[clk_idx++] = MII_MDOE;
+
+		// Shift to next lowest bit
+		mask >>= 1;
+	}
+
+	// Output the phy register number, msb first
+	mask = 0x10;
+	for (i = 0; i < 5; ++i) {
+		if (phyreg & mask)
+			bits[clk_idx++] = MII_MDOE | MII_MDO;
+		else
+			bits[clk_idx++] = MII_MDOE;
+
+		// Shift to next lowest bit
+		mask >>= 1;
+	}
+
+	// Tristate and turnaround (2 bit times)
+	bits[clk_idx++] = 0;
+	bits[clk_idx++] = 0;
+
+	// Write out 16 bits of data, msb first
+	mask = 0x8000;
+	for (i = 0; i < 16; ++i) {
+		if (phydata & mask)
+			bits[clk_idx++] = MII_MDOE | MII_MDO;
+		else
+			bits[clk_idx++] = MII_MDOE;
+
+		// Shift to next lowest bit
+		mask >>= 1;
+	}
+
+	// Final clock bit (tristate)
+	bits[clk_idx++] = 0;
+
+	// Save the current bank
+	oldBank = SMC_CURRENT_BANK();
+
+	// Select bank 3
+	SMC_SELECT_BANK( 3 );
+
+	// Get the current MII register value
+	mii_reg = SMC_GET_MII();
+
+	// Turn off all MII Interface bits
+	mii_reg &= ~(MII_MDOE|MII_MCLK|MII_MDI|MII_MDO);
+
+	// Clock all cycles
+	for (i = 0; i < sizeof bits; ++i) {
+		// Clock Low - output data
+		SMC_SET_MII( mii_reg | bits[i] );
+		msleep(1);
+
+		// Clock Hi - input data
+		SMC_SET_MII( mii_reg | bits[i] | MII_MCLK );
+		msleep(1);
+		bits[i] |= SMC_GET_MII() & MII_MDI;
+	}
+
+	// Return to idle state
+	// Set clock to low, data to low, and output tristated
+	SMC_SET_MII( mii_reg );
+	msleep(1);
+
+	// Restore original bank select
+	SMC_SELECT_BANK( oldBank );
+
+	DBG(3, "%s: phyaddr=0x%x, phyreg=0x%x, phydata=0x%x\n",
+		__FUNCTION__, phyaddr, phyreg, phydata);
+	PRINT_MII_STREAM(bits, sizeof(bits));
+}
+
+
+/*------------------------------------------------------------
+ . Finds and reports the PHY address
+ .-------------------------------------------------------------*/
+static int smc_detect_phy(u32 ioaddr, u32 *pphyaddr)
+{
+	int phy_id1, phy_id2;
+	int phyaddr;
+	int found = 0;
+
+	DBG(2, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	// Scan all 32 PHY addresses if necessary
+	for (phyaddr = 0; phyaddr < 32; ++phyaddr) {
+		// Read the PHY identifiers
+		phy_id1 = smc_read_phy_register(ioaddr, phyaddr, PHY_ID1_REG);
+		phy_id2 = smc_read_phy_register(ioaddr, phyaddr, PHY_ID2_REG);
+
+		DBG(3, "%s: phy_id1=0x%x, phy_id2=0x%x\n",
+			CARDNAME, phy_id1, phy_id2);
+
+		// Make sure it is a valid identifier
+		if ((phy_id2 > 0x0000) && (phy_id2 < 0xffff) &&
+		    (phy_id1 > 0x0000) && (phy_id1 < 0xffff)) {
+			if ((phy_id1 != 0x8000) && (phy_id2 != 0x8000)) {
+				// Save the PHY's address
+				*pphyaddr = phyaddr;
+				found = 1;
+				break;
+			}
+		}
+	}
+
+	if (!found) {
+		DBG(1, "%s: No PHY found\n", CARDNAME);
+		return(0);
+	}
+
+	// Set the PHY type
+	if ( (phy_id1 == 0x0016) && ((phy_id2 & 0xFFF0) == 0xF840 ) ) {
+		DBG(1, "%s: PHY=LAN83C183 (LAN91C111 Internal)\n", CARDNAME);
+	}
+
+	if ( (phy_id1 == 0x0282) && ((phy_id2 & 0xFFF0) == 0x1C50) ) {
+		DBG(1, "%s: PHY=LAN83C180\n", CARDNAME);
+	}
+
+	return 1;
+}
+
+/*------------------------------------------------------------
+ . Configures the specified PHY through the MII management interface
+ . using Autonegotiation.
+ . Calls smc_phy_fixed() if the user has requested a certain config.
+ .-------------------------------------------------------------*/
+static void
+smc_phy_configure(u32 ioaddr)
+{
+	int timeout;
+	int phyaddr;
+	int my_phy_caps; // My PHY capabilities
+	int my_ad_caps; // My Advertised capabilities
+	int status;
+	int failed = 0;
+	int rpc_cur_mode = RPC_DEFAULT;
+
+	DBG(3, "%s:smc_program_phy()\n", CARDNAME);
+
+	// Set the blocking flag
+	//lp->autoneg_active = 1;
+
+	// Find the address and type of our phy
+	if (!smc_detect_phy(ioaddr, &phyaddr))
+		goto smc_phy_configure_exit;
+
+	// Reset the PHY, setting all other bits to zero
+	smc_write_phy_register(ioaddr, phyaddr, PHY_CNTL_REG, PHY_CNTL_RST);
+
+	// Wait for the reset to complete, or time out
+	timeout = 6; // Wait up to 3 seconds
+	while (timeout--) {
+		if (!(smc_read_phy_register(ioaddr, phyaddr, PHY_CNTL_REG)
+		    & PHY_CNTL_RST))
+			// reset complete
+			break;
+		msleep(500); // wait 500 millisecs
+	}
+
+	if (timeout < 1) {
+		printf("%s: PHY reset timed out\n", CARDNAME);
+		goto smc_phy_configure_exit;
+	}
+
+	// Read PHY Register 18, Status Output
+	//lp->lastPhy18 = smc_read_phy_register(ioaddr, phyaddr, PHY_INT_REG);
+
+	// Enable PHY Interrupts (for register 18)
+	// Interrupts listed here are disabled
+	smc_write_phy_register(ioaddr, phyaddr, PHY_MASK_REG,
+		PHY_INT_LOSSSYNC | PHY_INT_CWRD | PHY_INT_SSD |
+		PHY_INT_ESD | PHY_INT_RPOL | PHY_INT_JAB |
+		PHY_INT_SPDDET | PHY_INT_DPLXDET);
+
+	/* Configure the Receive/Phy Control register */
+	SMC_SELECT_BANK( 0 );
+	SMC_SET_RPC( rpc_cur_mode );
+
+	// Copy our capabilities from PHY_STAT_REG to PHY_AD_REG
+	my_phy_caps = smc_read_phy_register(ioaddr, phyaddr, PHY_STAT_REG);
+	my_ad_caps  = PHY_AD_CSMA; // I am CSMA capable
+
+	if (my_phy_caps & PHY_STAT_CAP_T4)
+		my_ad_caps |= PHY_AD_T4;
+
+	if (my_phy_caps & PHY_STAT_CAP_TXF)
+		my_ad_caps |= PHY_AD_TX_FDX;
+
+	if (my_phy_caps & PHY_STAT_CAP_TXH)
+		my_ad_caps |= PHY_AD_TX_HDX;
+
+	if (my_phy_caps & PHY_STAT_CAP_TF)
+		my_ad_caps |= PHY_AD_10_FDX;
+
+	if (my_phy_caps & PHY_STAT_CAP_TH)
+		my_ad_caps |= PHY_AD_10_HDX;
+
+	// Disable capabilities not selected by our user
+	//if (lp->ctl_rspeed != 100)
+	//	my_ad_caps &= ~(PHY_AD_T4|PHY_AD_TX_FDX|PHY_AD_TX_HDX);
+
+	//if (!lp->ctl_rfduplx)
+	//	my_ad_caps &= ~(PHY_AD_TX_FDX|PHY_AD_10_FDX);
+
+	// Update our Auto-Neg Advertisement Register
+	smc_write_phy_register(ioaddr, phyaddr, PHY_AD_REG, my_ad_caps);
+
+	// Read the register back.  Without this, it appears that when
+	// auto-negotiation is restarted, sometimes it isn't ready and
+	// the link does not come up.
+	status = smc_read_phy_register(ioaddr, phyaddr, PHY_AD_REG);
+
+	DBG(2, "%s: phy caps=%x\n", CARDNAME, my_phy_caps);
+	DBG(2, "%s: phy advertised caps=%x\n", CARDNAME, my_ad_caps);
+
+	// Restart auto-negotiation process in order to advertise my caps
+	smc_write_phy_register( ioaddr, phyaddr, PHY_CNTL_REG,
+		PHY_CNTL_ANEG_EN | PHY_CNTL_ANEG_RST );
+
+	// Wait for the auto-negotiation to complete.  This may take from
+	// 2 to 3 seconds.
+	// Wait for the reset to complete, or time out
+	timeout = 20; // Wait up to 10 seconds
+	while (timeout--) {
+		status = smc_read_phy_register(ioaddr, phyaddr, PHY_STAT_REG);
+		if (status & PHY_STAT_ANEG_ACK)
+			// auto-negotiate complete
+			break;
+
+		msleep(500); // wait 500 millisecs
+
+		// Restart auto-negotiation if remote fault
+		if (status & PHY_STAT_REM_FLT) {
+			DBG(1, "%s: PHY remote fault detected\n", CARDNAME);
+
+			// Restart auto-negotiation
+			DBG(1, "%s: PHY restarting auto-negotiation\n",
+				CARDNAME);
+			smc_write_phy_register( ioaddr, phyaddr, PHY_CNTL_REG,
+				PHY_CNTL_ANEG_EN | PHY_CNTL_ANEG_RST |
+				PHY_CNTL_SPEED | PHY_CNTL_DPLX);
+		}
+	}
+
+	if (timeout < 1) {
+		DBG(1, "%s: PHY auto-negotiate timed out\n", CARDNAME);
+		failed = 1;
+	}
+
+	// Fail if we detected an auto-negotiate remote fault
+	if (status & PHY_STAT_REM_FLT) {
+		DBG(1, "%s: PHY remote fault detected\n", CARDNAME);
+		failed = 1;
+	}
+
+	// Re-Configure the Receive/Phy Control register
+	SMC_SET_RPC( rpc_cur_mode );
+
+smc_phy_configure_exit:
+	// Exit auto-negotiation
+	return;
+}
+
+/*----------------------------------------------------------------------
+ . Function: smc_probe( unsigned long ioaddr )
+ .
+ . Purpose:
+ .	Tests to see if a given ioaddr points to an SMC91x chip.
+ .	Returns a 0 on success
+ .
+ . Algorithm:
+ .	(1) see if the high byte of BANK_SELECT is 0x33
+ . 	(2) compare the ioaddr with the base register's address
+ .	(3) see if I recognize the chip ID in the appropriate register
+ .
+ .---------------------------------------------------------------------
+ */
+/*---------------------------------------------------------------
+ . Here I do typical initialization tasks.
+ .
+ . o  Initialize the structure if needed
+ . o  print out my vanity message if not done so already
+ . o  print out what type of hardware is detected
+ . o  print out the ethernet address
+ . o  find the IRQ
+ . o  set up my private data
+ . o  configure the dev structure with my subroutines
+ . o  actually GRAB the irq.
+ . o  GRAB the region
+ .-----------------------------------------------------------------
+*/
+static int smc_probe(u32 ioaddr)
+{
+	unsigned int val;
+
+	DBG(2, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	/* First, see if the high byte is 0x33 */
+	val = SMC_CURRENT_BANK();
+	DBG(2, "%s: bank signature probe returned 0x%04x\n", CARDNAME, val);
+	if ( (val & 0xFF00) != 0x3300 )
+		return -1;
+
+	/* The above MIGHT indicate a device, but I need to write to further
+ 	 	test this.  */
+	SMC_SELECT_BANK(0);
+	val = SMC_CURRENT_BANK();
+	if ( (val & 0xFF00 ) != 0x3300 ) 
+		return -1;
+
+	/* Get the MAC address */
+	SMC_SELECT_BANK( 1 );
+	SMC_GET_MAC_ADDR(hwaddress);
+
+	/* now, reset the chip, and put it into a known state */
+	smc_reset( ioaddr );
+
+	return 0;
+}
+
+static int 
+smc_hw_reset(u32 ioaddr)
+{
+#if defined(LUBBOCK)
+	{
+		volatile int *attaddr = (int*)(ioaddr + 1<<25);
+		long flags;
+
+		/* first reset, then enable the device. Sequence is critical */
+		attaddr[ECOR] |= ECOR_RESET;
+		msleep(1);
+		attaddr[ECOR] &= ~ECOR_RESET;
+		attaddr[ECOR] |= ECOR_ENABLE;
+
+		/* force 16-bit mode */
+		attaddr[ECSR] &= ~ECSR_IOIS8;
+		msleep(1);
+	}
+#endif
+	return 0;
+}
+
+/**********************************************************************
+ * ethernet driver interfaces
+ */
+static int 
+smc_init(u32 ioaddr)
+{
+	int err=0;
+	u8  version;
+
+	DBG(2, "%s: %s\n", CARDNAME, __FUNCTION__);
+
+	err = smc_hw_reset(ioaddr);
+	if (err)
+		return err;
+
+	err = smc_probe(ioaddr);
+	if (err) 
+		return err;
+
+	SMC_SELECT_BANK(3);
+	version = SMC_GET_REV() & 0xff;
+
+	/* reset the hardware */
+	smc_reset(ioaddr);
+	smc_enable(ioaddr);
+
+	SMC_SELECT_BANK( 1 );
+	SMC_SET_MAC_ADDR(hwaddress);
+
+	smc_chip_base = ioaddr;
+
+	if (version > 0x70) 
+		smc_phy_configure(ioaddr);
+
+	return err;
+}
+
+static int readether( u8 *buf, int size )
+{
+	int ret = 0;
+	u8  status, mask = 0xff;
+	u16 saved_bank;
+	u32 ioaddr = smc_chip_base;
+
+	if ( !smc_chip_base ) 
+		return -EINVAL;
+
+	saved_bank = SMC_CURRENT_BANK();
+
+	SMC_SELECT_BANK(2);
+	mask = SMC_GET_INT_MASK();
+	/* clear all interrupts */
+	SMC_SET_INT_MASK(0);
+
+	/* read the status flag, and mask it */
+	status = SMC_GET_INT() & mask;
+
+	if (!status) {
+		ret = 0;
+	} 
+	else if ( status & IM_RCV_INT ) { 
+		ret = smc_rcv( smc_chip_base, buf, size );
+	}
+
+	SMC_SET_INT_MASK(mask);
+	SMC_SELECT_BANK(saved_bank);
+
+	return ret;
+}
+
+static int writeether( u8 *buf, int size )
+{
+	if ( !smc_chip_base )
+		return -EINVAL;
+
+	memcpy( buf+6, hwaddress, 6 );
+
+	return smc_send( smc_chip_base, buf, size);
+}
+
+static int get_ethaddr( u8 dev_addr[6] )
+{
+	u32 ioaddr = smc_chip_base;
+
+	if (!ioaddr) return -EINVAL;
+	SMC_GET_MAC_ADDR(dev_addr);
+	return 0;
+}
+
+static int set_ethaddr( u8 dev_addr[6] )
+{
+	u32 ioaddr = smc_chip_base;
+
+	if (!ioaddr) return -EINVAL;
+
+	SMC_SET_MAC_ADDR(dev_addr);
+	return 0;
+}
+
+/**********************************************************************
+ * export ethernet driver 
+ */
+ether_driver_t smc91x_ether_driver = {
+	init:		smc_init,
+	rcv:		readether,
+	snd:		writeether,
+	set_addr:	set_ethaddr,
+	get_addr:	get_ethaddr,
+	base:		SMC_BASE,
+};
Index: build_tree/bootLoader/src/lib/ether.c
diff -u /dev/null build_tree/bootLoader/src/lib/ether.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ether.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,102 @@
+/*-------------------------------------------------------------------------
+ * Filename:      ether.c
+ * Version:       $Id: ether.c,v 1.4 2003/09/04 18:55:53 russd Exp $
+ * Copyright:     Copyright (C) 1999, Erik Mouw
+ * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Description:   Serial utilities for blob
+ * Created at:    Tue Aug 24 20:25:00 1999
+ * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ *                Abraham van der Merwe <abraham@2d3d.co.za>
+ *		  Russ Dill <Russ.Dill@asu.edu>
+ *-----------------------------------------------------------------------*/
+/*
+ * ether.c: Ethernet interfacing for blob
+ *
+ * Copyright (C) 1999 2000 2001 Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2003 Russ Dill (Russ.Dill@asu.edu)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: ether.c,v 1.4 2003/09/04 18:55:53 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/debug.h>
+#include <net/ether.h>
+#include <blob/init.h>
+
+ether_driver_t *ether_driver;
+u8 hwaddress[6] = {2, 3, 4, 5, 6, 7};
+
+/* initialise an ethernet interface with the given base address. Return 
+ * zero success, or a negative error number on failure
+ */
+
+void ether_init(void)
+{
+	if(ether_driver == NULL) {
+		deprintf("No ethernet driver defined in arch "
+			 "specific file\n");
+		return;
+	}
+
+	if (ether_driver->init(ether_driver->base) < 0)
+		deprintf("Ethernet driver failed to init\n");
+}
+
+__initlist(ether_init, INIT_LEVEL_OTHER_HARDWARE);
+
+int ether_rcv(u8 *data, int size)
+{
+	if (!ether_driver) return -EINVAL;
+	return ether_driver->rcv(data, size);
+}
+
+
+int ether_snd(u8 *data, int size)
+{
+	if (!ether_driver) return -EINVAL;
+	return ether_driver->snd(data, size);
+}
+
+
+int ether_get_addr(u8 hw_addr[6])
+{
+	if (!ether_driver) return -EINVAL;
+	return ether_driver->get_addr(hw_addr);
+}
+
+
+int ether_set_addr(u8 hw_addr[6])
+{
+	if (!ether_driver) return -EINVAL;
+	memcpy(hwaddress, hw_addr, 6);
+	return ether_driver->set_addr(hw_addr);
+}
+
+
+char *ether_get_name(void)
+{
+	if (!ether_driver) return -EINVAL;
+	return ether_driver->name;
+}
+
Index: build_tree/bootLoader/src/lib/ext2fs.c
diff -u /dev/null build_tree/bootLoader/src/lib/ext2fs.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ext2fs.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,665 @@
+/*
+ * disk.c
+ *
+ * read extfs file system root dir, locate image and load it into memory
+ *
+ *  this is a very large hack which assumes:
+ *  - ms-dos partion table
+ *  - linux partition is #1 partition 
+ *  - bootable image is at /zImage or /boot/zImage
+ *  - ramdisk image is at /ramdisk.gz or /boot/ramdisk.gz
+ *
+ * Copyright (C) 2001, Brad Parker (brad@heeltoe.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/serial.h>
+
+#define _SIZE_T				/* don't use the one in the kernel's types.h */
+#include <linux/ext2_fs.h>
+
+char buf1[512], buf2[512];
+
+char sb_block_buf[EXT2_MAX_BLOCK_SIZE];
+char inode_block_buf[EXT2_MAX_BLOCK_SIZE];
+char dir_block_buf[EXT2_MAX_BLOCK_SIZE];
+char ind_block_buf[EXT2_MAX_BLOCK_SIZE];
+char ind2_block_buf[EXT2_MAX_BLOCK_SIZE];
+char block1[EXT2_MAX_BLOCK_SIZE];
+char block2[EXT2_MAX_BLOCK_SIZE];
+
+extern int verbose;
+
+extern int  hd_read_mapped(int sector_num, char *buffer);
+
+char tohex(char b)
+{
+    b = b & 0xf;
+    if (b < 10) return '0' + b;
+    return 'a' + (b - 10);
+}
+
+void dumpmem(char *ptr, int len)
+{
+    char line[80], chars[80], *p, b, *c, *end;
+    int j;
+
+    end = ptr + len;
+    while (ptr < end) {
+        SerialOutputHex((int)ptr);
+	p = line;
+	c = chars;
+
+	*p++ = ' ';
+	for (j = 0; j < 16; j++) {
+	    b = *ptr++;
+	    *p++ = tohex(b >> 4);
+	    *p++ = tohex(b);
+	    *p++ = ' ';
+	    *c++ = ' ' <= b && b <= '~' ? b : '.';
+	}
+	*p = 0;
+	SerialOutputString(line);
+	*c = 0;
+	SerialOutputString(chars);
+	serial_write('\n');
+    }
+}
+
+#ifdef TEST
+char disk[1024*1024*8];
+
+int read_buffer(int sectornum, char *buf)
+{
+  char *ptr = disk + sectornum * 512;
+  if (ptr > disk+sizeof(disk)) {
+    printf("read past eod!\n");
+    while (1);
+    return -1;
+  }
+  memcpy(buf, ptr, 512);
+  return 0;
+}
+#else
+int read_buffer(int sectornum, char *buf)
+{
+    return hd_read_mapped(sectornum, buf);
+}
+#endif
+
+void debug(char *msg)
+{
+  printf("%s\n", msg);
+}
+
+int le32_p(u8 *p)
+{
+  int n;
+
+  n = (p[3] << 24) | (p[2] << 16) | (p[1] << 8) | p[0];
+  return n;
+}
+
+/* ms-dos disk partition structure */
+struct part_ent {
+  u8 p_boot;
+  u8 p_start[3];
+  u8 p_type;
+  u8 p_end[3];
+  u8 p_start_sector[4];
+  u8 p_size_sectors[4];
+};
+
+static unsigned int start, size;
+static unsigned int base;
+struct ext2_group_desc group_desc[32];
+unsigned int boot_inode_num=0;
+unsigned int our_inode_num=0;
+
+unsigned int e2fs_block_size;
+unsigned int e2fs_sectors_per_block;
+
+void set_ext2fs_block_size(int bytes)
+{
+  e2fs_block_size = bytes;
+  e2fs_sectors_per_block = bytes / 512;
+
+  if (verbose > 1) {
+      printf("set_ext2fs_block_size(bytes=%d) sectors_per_block %d\n",
+	     bytes, e2fs_sectors_per_block);
+  }
+}
+
+/* read ext2fs 4k block */
+int read_block(int blocknum, char *buf)
+{
+  unsigned int abs_blocknum = base + blocknum*e2fs_sectors_per_block;
+  int i;
+
+  if (verbose > 2)
+      printf("read_block(%d) base %d, abs %d\n", blocknum, base, abs_blocknum);
+
+  for (i = 0; i < e2fs_sectors_per_block; i++) {
+    if (read_buffer(abs_blocknum, buf) != 0) {
+	return -1;
+    }
+    abs_blocknum++;
+    buf += 512;
+  }
+  return 0;
+}
+
+/* check master boot record; locate parition info */
+int check_mbr()
+{
+  struct part_ent *p;
+  int h, s, c;
+
+  if( verbose > 0)
+      printf("check MBR...\n");
+
+  if (read_buffer(0, buf1)) {
+    debug("mbr read error");
+    return -1;
+  }
+
+  if ((u8)buf1[510] != 0x55 || (u8)buf1[511] != 0xaa) {
+    debug("bad mbr signature");
+    if (verbose > 1) dumpmem(buf1, sizeof(buf1));
+    return -1;
+  }
+
+  /* XXX 1st partition must be linux */
+
+  p = (struct part_ent *)&buf1[0x1be];
+
+  if (p->p_type != 0x83) {
+    debug("part #1 not linux");
+    return -1;
+  }
+
+  h = p->p_start[0];
+  s = p->p_start[1] & 0x3f;
+  c = ((p->p_start[1] & 0xc0) << 2) + p->p_start[2];
+
+  if( verbose > 0)
+      printf("found linux partition\n");
+
+  start = le32_p(p->p_start_sector);
+  size = le32_p(p->p_size_sectors);
+
+  if (verbose > 1) {
+      printf("partition @ h=%d,s=%d,c=%d\n", h, s, c);
+      printf("start %d, size %d\n", start, size);
+  }
+
+  return 0;
+}
+
+/*
+ * read ext2fs inode
+ * require group descriptors to be in memory
+ */
+int read_inode(struct ext2_super_block *sb, int ino, struct ext2_inode *ibuf)
+{
+  u32 group, offset, block, block_nr;
+
+  group = (ino - 1) / EXT2_INODES_PER_GROUP(sb);
+  offset = ((ino - 1) % EXT2_INODES_PER_GROUP(sb)) * EXT2_INODE_SIZE(sb);
+  block = offset >> EXT2_BLOCK_SIZE_BITS(sb);
+
+  if (!group_desc[(unsigned)group].bg_inode_table) {
+    if( verbose > 0) {
+	printf("inode %d; group %d, offset %d, block %d; no group descriptor\n",
+	       ino, group, offset, block);
+    }
+    return -1;
+  }
+
+  block_nr = group_desc[(unsigned)group].bg_inode_table + block;
+
+  offset &= (EXT2_BLOCK_SIZE(sb) - 1);
+
+  if (verbose > 1) {
+      printf("inode %d; group %d, offset %d, block %d, block_nr %d\n",
+	     ino, group, offset, block, block_nr);
+
+      printf("inodes/group %d, inode size %d\n",
+	     EXT2_INODES_PER_GROUP(sb), EXT2_INODE_SIZE(sb));
+  }
+
+  /* read entire block and copy inode out */
+  if (read_block(block_nr, inode_block_buf))
+      return -1;
+
+  memcpy((char *)ibuf, inode_block_buf + offset, 128);
+
+  return 0;
+}
+
+int load_indirect_block(int iblock_num, char **pptr, u32 *poffset)
+{
+  int i;
+  u8 *p;
+  u32 bn;
+  char *ptr;
+  u32 offset;
+
+  ptr = *pptr;
+  offset = *poffset;
+
+  if (verbose > 1)
+    printf("indirect block %d\n", iblock_num);
+
+  if (read_block(iblock_num, ind_block_buf)) {
+    debug("read indirect block error");
+    return -1;
+  }
+
+  p = ind_block_buf;
+  for (i = 0; i < e2fs_block_size/4; i++) {
+    bn = le32_p(p);
+    p += 4;
+
+    if (bn == 0)
+      break;
+
+#if 0 // FIXME
+    if (verbose > 2)
+	printf("file block # %d (0x%x)\n", bn, bn);
+    else
+      if( verbose > 0)
+	  printf("%d        \r", offset);
+#endif // 0 FIXME 
+
+    switch( verbose) {
+	case 0:
+	    if( bn % 100 == 0)
+		serial_write( '.');
+	    break;
+	case 1:
+	    printf("%d        \r", offset);
+	    break;
+	default:
+	    printf("file block # %d (0x%x)\n", bn, bn);
+	    break;
+    }
+
+    if (read_block(bn, ptr)) {
+      debug("read file block error");
+      return -1;
+    }
+
+    ptr += e2fs_sectors_per_block*512;
+    offset += e2fs_sectors_per_block*512;
+  }
+
+  *pptr = ptr;
+  *poffset = offset;
+
+  return 0;
+}
+
+int load_file_inode(struct ext2_super_block *sb, unsigned int inode_num, char *ptr)
+{
+    struct ext2_inode file_inode, *inode;
+    u32 offset;
+    int i;
+
+    if (read_inode(sb, inode_num, &file_inode)) {
+      debug("read file inode error");
+      return -1;
+    }
+
+    inode = &file_inode;
+    offset = 0;
+
+    if (verbose > 1) {
+      printf("file inode:\n");
+      printf("mode %o\n", inode->i_mode);
+      printf("flags %x\n", inode->i_flags);
+      printf("size %x\n", inode->i_size);
+      printf("blocks %x (max %d)\n", inode->i_blocks, EXT2_N_BLOCKS);
+    }
+
+    for (i = 0; i < EXT2_NDIR_BLOCKS; i++) {
+      if (verbose > 1)
+	printf("block[%d] %d (0%x)\n",
+	       i, inode->i_block[i], inode->i_block[i]);
+	else
+	    if( verbose > 0)
+		printf("%d        \r", offset);
+	    else
+		if( inode->i_block[i] % 100 == 0)
+		    serial_write( '.');
+
+	if (inode->i_block[i] == 0)
+	    break;
+
+	if (read_block(inode->i_block[i], ptr)) {
+	    debug("read file block error");
+	    return -1;
+	}
+
+	ptr += e2fs_sectors_per_block*512;
+	offset += e2fs_sectors_per_block*512;
+    }
+
+    if (inode->i_block[EXT2_NDIR_BLOCKS]) {
+      if (verbose > 2)
+	printf("1 indirect block %d\n",
+	       inode->i_block[EXT2_NDIR_BLOCKS]);
+
+      if (load_indirect_block(inode->i_block[EXT2_NDIR_BLOCKS],
+			      &ptr, &offset))
+	return -1;
+    }
+
+    if (inode->i_block[EXT2_NDIR_BLOCKS+1]) {
+      int i;
+      u8 *p;
+      u32 bn;
+
+      if (verbose > 2)
+	printf("2 indirect block %d\n",
+	       inode->i_block[EXT2_NDIR_BLOCKS+1]);
+
+      if (read_block(inode->i_block[EXT2_NDIR_BLOCKS+1], ind2_block_buf))
+	{
+	  debug("read 2nd indirect block error");
+	  return -1;
+	}
+
+      p = ind2_block_buf;
+      for (i = 0; i < e2fs_block_size/4; i++) {
+	bn = le32_p(p);
+	p += 4;
+
+	if (bn == 0)
+	  break;
+
+	if (verbose > 2) printf("ind block # %d (0x%x)\n", bn, bn);
+
+	if (load_indirect_block(bn, &ptr, &offset))
+	  return -1;
+      }
+    }
+
+#if 0
+    if (inode->i_block[EXT2_NDIR_BLOCKS+2]) {
+	    printf("3 indirect inode %d\n",
+		   inode->i_block[EXT2_NDIR_BLOCKS+2]);
+
+	    if(read_block(inode->i_block[EXT2_NDIR_BLOCKS+2], &ind_block_buf))
+	    {
+		debug("read 3rd indirect block error");
+		return -1;
+	    }
+    }
+#endif
+
+    if( verbose > 0)
+	printf("done! offset %d (0x%x)\n", offset, offset);
+    else
+	serial_write( '\n');
+
+    return inode->i_size;			// success: return file size
+}
+
+/*
+ * read file "fileName" into RAM location ramBase
+ */
+int load_root_image(char *fileName, void *ramBase)
+{
+    struct ext2_super_block *sb;
+    struct ext2_inode root_inode, boot_inode, *inode;
+    struct ext2_group_desc *bg;
+    struct ext2_dir_entry_2 *de;
+    int sb_block, group_block, group_desc_count, desc_blocks;
+    int i;
+    u32 offset;
+    int	retval=0;
+
+    /* read super block */
+
+    base = start;
+    sb_block = 1;
+    group_block = sb_block + 1;
+
+    if( verbose > 0)
+	printf("reading super block...\n");
+
+    set_ext2fs_block_size(1024);
+
+#if 0
+    {
+      int abn;
+
+      abn = base;
+      for (i = 0; i < 8; i++) {
+	printf("abn %d\n", abn);
+	if (read_buffer(abn, sb_block_buf) != 0)
+	  break;
+	dumpmem(sb_block_buf, 64);
+	abn++;
+      }
+    }
+#endif
+
+    if (read_block(sb_block, sb_block_buf)) {
+	debug("find_root read error");
+	return -1;
+    }
+
+    sb = (struct ext2_super_block *)sb_block_buf;
+
+    if (verbose > 1) printf("sb magic %x\n", sb->s_magic);
+    if (sb->s_magic != EXT2_SUPER_MAGIC) {
+	debug("sb magic number wrong");
+	return -1;
+    }
+
+    if (verbose > 1) {
+	printf("block size %d\n", EXT2_BLOCK_SIZE(sb));
+	printf("blocks per group %d\n", sb->s_blocks_per_group);
+	printf("block # of sb %d\n", sb->s_block_group_nr);
+	printf("first data block %d\n", sb->s_first_data_block);
+	printf("inodes / group %d\n", EXT2_INODES_PER_GROUP(sb));
+    }
+
+    group_desc_count = (sb->s_blocks_count -
+			sb->s_first_data_block +
+			EXT2_BLOCKS_PER_GROUP(sb) - 1)
+	/ EXT2_BLOCKS_PER_GROUP(sb);
+
+    desc_blocks = (group_desc_count +
+		   EXT2_DESC_PER_BLOCK(sb) - 1)
+	/ EXT2_DESC_PER_BLOCK(sb);
+
+    if (verbose > 1) 
+	printf("group_block %d, group_desc_count %d, desc_blocks %d\n",
+	       group_block, group_desc_count, desc_blocks);
+
+    /* set block size */
+    set_ext2fs_block_size(EXT2_BLOCK_SIZE(sb));
+
+    //this is wrong and a hack; why?
+    if (EXT2_BLOCK_SIZE(sb) == 4096)
+      group_block = 1;
+
+    /* read group descriptors */
+    if (read_block(group_block, block2)) {
+	debug("read group desc error");
+	return -1;
+    }
+
+    if (verbose > 4) {
+      dumpmem(block2, sizeof(block2));
+    }
+
+    bg = (struct ext2_group_desc *)block2;
+    for (i = 0; i < group_desc_count; i++) {
+	group_desc[i] = bg[i];
+	if (verbose > 1) {
+	    printf("block group %d\n", i);
+	    printf("dirs %d\n", bg[i].bg_used_dirs_count);
+	}
+    }
+
+//    set_ext2fs_block_size(EXT2_BLOCK_SIZE(sb));
+
+    /* read root inode */
+
+    if (read_inode(sb, EXT2_ROOT_INO, &root_inode)) {
+	debug("read initial inode error");
+	return -1;
+    }
+
+    inode = &root_inode;
+
+    if (verbose > 1) {
+	printf("mode %o\n", inode->i_mode);
+	printf("flags %x\n", inode->i_flags);
+	printf("size %x\n", inode->i_size);
+	printf("blocks %x (max %d)\n", inode->i_blocks, EXT2_N_BLOCKS);
+	printf("block[0] %x\n", inode->i_block[0]);
+	printf("block[1] %x\n", inode->i_block[1]);
+	printf("\n");
+    }
+
+    if (read_block(inode->i_block[0], dir_block_buf)) {
+	debug("read root inode dir block error");
+	return -1;
+    }
+
+    if (verbose > 1) printf("scanning root dir\n");
+
+    offset = 0;
+    while (offset < 4096) {
+	char name[256];
+
+	de = (struct ext2_dir_entry_2 *)(dir_block_buf + offset);
+
+	if (verbose > 1)
+	    printf("offset 0x%x, len 0x%x\n", offset, de->rec_len);
+
+	strncpy(name, de->name, de->name_len);
+	name[de->name_len] = 0;
+	offset += de->rec_len;
+
+	if (verbose > 1) {
+	    printf("inode %d, type %d, name '%s'\n",
+		   de->inode, de->file_type, name);
+	    printf("rec_len %d (%x), b %d\n", de->rec_len, de->rec_len, offset);
+	}
+
+	if (/* FIXME de->file_type == 2 && */ strncmp(name, "boot", 5) == 0) {
+	    if( verbose > 0) printf("found /boot dir\n");
+	    if (verbose > 1) printf("/boot dir inode %d\n", de->inode);
+	    boot_inode_num = de->inode;
+	    break;
+	}
+
+	// FIXME de->file_type == 0 for me 8-(
+
+	if (/* FIXME de->file_type == 1 && */ strncmp(name, fileName, sizeof(name)) == 0) {
+	    if( verbose > 0) printf("found /%s\n", fileName);
+	    if (verbose > 1) printf("/%s inode %d\n", fileName, de->inode);
+	    our_inode_num = de->inode;
+	    break;
+	}
+    }
+
+    if (boot_inode_num) {
+
+	if (verbose > 1) printf("scanning /boot dir\n");
+
+	if (read_inode(sb, boot_inode_num, &boot_inode)) {
+	    debug("read boot inode error");
+	    return -1;
+	}
+
+	inode = &boot_inode;
+
+	if (verbose > 1) {
+	    printf("mode %o\n", inode->i_mode);
+	    printf("flags %x\n", inode->i_flags);
+	    printf("size %x\n", inode->i_size);
+	    printf("blocks %x\n", inode->i_blocks);
+	    printf("block[0] %x\n", inode->i_block[0]);
+	    printf("block[1] %x\n", inode->i_block[1]);
+	}
+
+	if (read_block(inode->i_block[0], dir_block_buf)) {
+	    debug("read boot inode dir block error");
+	    return -1;
+	}
+
+	our_inode_num = 0;
+
+	offset = 0;
+	while (offset < 4096) {
+	    char name[256];
+	    de = (struct ext2_dir_entry_2 *)(dir_block_buf + offset);
+	    strncpy(name, de->name, de->name_len);
+	    name[de->name_len] = 0;
+	    offset += de->rec_len;
+
+	    if (verbose > 1) {
+		printf("inode %d, type %d, name '%s'\n",
+		       de->inode, de->file_type, name);
+		printf("rec_len %d (%x), b %d\n",
+		       de->rec_len, de->rec_len, offset);
+	    }
+
+	    if (/* FIXME de->file_type == 1 && */ strncmp(name, fileName, sizeof(name)) == 0) {
+		printf("found /boot/%s\n", fileName);
+		our_inode_num = de->inode;
+	    }
+	    
+	    if (our_inode_num)
+                break;
+	}
+    }
+
+    if (our_inode_num) {
+  	if( verbose > 0) printf("reading %s:\n", fileName);
+	if( (retval=load_file_inode(sb, our_inode_num, ramBase)) < 0)
+	    return -1;
+    }
+
+    return retval;			// success: return file size
+}
+
+#ifdef TEST
+main()
+{
+  int fd;
+  fd = open("/tmp/disk", 0);
+  read(fd, disk, sizeof(disk));
+  close(fd);
+
+  check_mbr();
+  find_root();
+}
+#endif
Index: build_tree/bootLoader/src/lib/generic_io.c
diff -u /dev/null build_tree/bootLoader/src/lib/generic_io.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/generic_io.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,314 @@
+/**********************************************************************
+ * generic_io.c
+ *
+ * generic io abstraction
+ *
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: generic_io.c,v 1.9 2003/08/21 12:47:10 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/time.h>
+#include <blob/serial.h>
+#include <blob/arch.h>
+#include <blob/init.h>
+
+#include <blob/generic_io.h>
+
+/**********************************************************************
+ * Defines / Makros
+ */
+
+#define IO_DEBUG 1
+#undef IO_QUIET
+
+#if IO_DEBUG
+#	define DBG( x, args... )	if ( io_dbg>x ) printf( args )
+#	define DBGIO( x, io )		if ( io_dbg>x ) printf( "%s: " \
+			"%s(%p)={ c=%p, r=%p, w=%p,\n\tp=%p, sz=%d, ch=%p,\n\tn='%s' }\n", \
+			__FUNCTION__, #io, io, io->conf, io->read, io->write, \
+			io->private_data, io->io_size, io->child_io, io->name );
+#else
+#	define DBG( x, args... )
+#	define DBGIO( x, io )
+#endif
+
+#define ERR( x )	do { ret = x; goto DONE; } while (0)
+
+
+/**********************************************************************
+ * Typen
+ */
+
+/**********************************************************************
+ * Programmglobale Variable
+ */
+
+/**********************************************************************
+ * Modulglobale Variable
+ */
+static char *module_version = "$Id: generic_io.c,v 1.9 2003/08/21 12:47:10 seletz Exp $";
+
+#ifdef	IO_DEBUG
+static int io_dbg = 1;
+#else
+static int io_dbg = 0;
+#endif
+
+static io_driver_t *drivers[IO_MAX_DRIVER];
+
+
+/**********************************************************************
+ * Prototypen
+ */
+
+/**********************************************************************
+ * Exported functions
+ */
+
+void io_dbg_set( int lvl )
+{
+	io_dbg = lvl;
+}
+
+void io_init( void )
+{
+	int i;
+
+	for ( i=0; i<IO_MAX_DRIVER;i++)
+		drivers[i] = NULL;
+
+	return;
+}
+__initlist(io_init, INIT_LEVEL_OTHER_STUFF + 1);
+
+int io_register( io_driver_t *io, char *name )
+{
+	int i;
+
+	if ( !io || !name )
+		return -EINVAL;
+
+	for ( i=0; i<IO_MAX_DRIVER;i++) {
+		if (!drivers[i])
+			break;
+	}
+	if ( i==IO_MAX_DRIVER)
+		return -EINVAL;
+
+	drivers[i]=io;
+	strncpy( io->name, name, IO_NAME_LEN );
+
+	DBG( 1, "%s: driver '%s' registered #%d.\n", __FUNCTION__,
+			name, i );
+
+	return 0;
+}
+
+int io_configure( char *io_name, void *conf_data )
+{
+	io_driver_t *io;
+
+	DBG( 1, "%s: io_name=%p, conf_data=%p\n", __FUNCTION__,
+			io_name, conf_data );
+
+	if ( !io_name )
+		return -EINVAL;
+
+	io = io_get_byname( io_name );
+	if ( !io )
+		return -EINVAL;
+
+	DBGIO( 5, io );
+
+	if (io->conf )
+		return io->conf( io, conf_data );
+
+	return 0;
+}
+
+io_driver_t *io_get_byname( char *name )
+{
+	int i;
+
+	if ( !name )
+		return NULL;
+
+	for ( i=0; i<IO_MAX_DRIVER;i++) {
+		if (drivers[i]) {
+			if ( strncmp( io_get_name( drivers[i] ), name, IO_NAME_LEN ) == 0 )
+				return drivers[i];
+		}
+	}
+
+	return NULL;
+}
+
+int io_chain_driver( char *parent, char *new_child )
+{
+	io_driver_t *p, *c;
+
+	if ( !parent || !new_child )
+		return -EINVAL;
+
+	p = io_get_byname( parent );
+	if ( !p )
+		return -EINVAL;
+
+	DBGIO( 5, p );
+
+	c = io_get_byname( new_child );
+	if ( !c )
+		return -EINVAL;
+
+	DBGIO( 5, c );
+
+	DBG( 1, "%s: chained Parent '%s' -> child '%s'.\n", __FUNCTION__,
+			io_get_name( p ), io_get_name( c ) );
+
+	p->child_io = c;
+
+	return 0;
+}
+
+int io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *rd )
+{
+	DBG( 1, "%s: dest=%p, src=%p, amount=%d, io_name=%p\n", __FUNCTION__,
+			dest, src, amount, rd );
+
+	if ( !rd || !rd->read )
+		return -EINVAL;
+
+	DBGIO( 5, rd );
+
+	/* check bounds */
+	if ( (rd->io_size - (size_t)src) < amount ) {
+		DBG( 1, "%s: out of bounds!\n", __FUNCTION__ );
+		return -ERANGE;
+	}
+
+	return rd->read( dest, src, amount, rd );
+}
+
+int io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *rd )
+{
+
+	DBG( 1, "%s: dest=%p, src=%p, amount=%d, io_name=%p\n", __FUNCTION__,
+			dest, src, amount, rd );
+
+	if ( !rd || !rd->write  )
+		return -EINVAL;
+
+	DBGIO( 5, rd );
+
+	/* check bounds */
+	if ( (rd->io_size - (size_t)dest) < amount ) {
+		DBG( 1, "%s: out of bounds!\n", __FUNCTION__ );
+		return -ERANGE;
+	}
+
+	return rd->write( dest, src, amount, rd );
+}
+
+int io_copy( char *dest_name, char *src_name, size_t amount )
+{
+	static unsigned char buffer[512];
+	int ret = 0;
+	int blocks, block, to_copy;
+	unsigned char *adr = NULL;
+	io_driver_t *dest, *src;
+
+	DBG( 1, "%s: dest_name=%p, src_name=%p, amount=%d\n", __FUNCTION__,
+			dest_name, src_name, amount  );
+
+	if ( !src_name || !dest_name )
+		ERR( -EINVAL );
+
+	src = io_get_byname( src_name );
+	if ( !src )
+		ERR( -EINVAL );
+
+	dest = io_get_byname( dest_name );
+	if ( !dest )
+		ERR( -EINVAL );
+
+	DBGIO( 5, src );
+	DBGIO( 5, dest );
+
+	if ( amount == 0 ) {
+		amount = io_get_size( src );
+	}
+
+	if ( amount > io_get_size( dest ) ) {
+		printf( "\n\nio_copy: src size (%d) > dest space (%d)!\n\n",
+				amount, io_get_size( dest ) );
+		ERR( -ETOOLONG );
+	}
+
+	blocks = amount / 512 + (amount%512?1:0);
+	DBG( 1, "%s: %d blocks (%d bytes) to copy.\n", __FUNCTION__,
+			blocks, amount );
+
+	for ( block=0; block<blocks; block++ ) {
+		if ( amount > 512 ) {
+			to_copy = 512;
+		} else {
+			to_copy = amount;
+		}
+#if !defined(IO_QUIET)
+		printf( "%s: block %d/%d (%d bytes to go)      \r", __FUNCTION__, block+1, blocks, amount );
+#endif
+
+		/* read from source */
+		ret = io_read( buffer, adr, to_copy, src );
+		if ( ret ) {
+			DBG( 1, "\n%s: read failed at block %d (adr %p).\n",
+					__FUNCTION__, block, adr );
+			ERR( -EINVAL );
+		}
+
+		/* write to dest */
+		ret = io_write( adr, buffer, to_copy, dest );
+		if ( ret ) {
+			DBG( 1, "\n%s: write failed at block %d (adr %p).\n",
+					__FUNCTION__, block, adr );
+			ERR( -EINVAL );
+		}
+
+		amount -= to_copy;
+		adr += to_copy;
+	}
+
+	ret = 0;
+DONE:
+#if !defined(IO_QUIET)
+	printf("\n");
+#endif
+	return ret;
+}
Index: build_tree/bootLoader/src/lib/gio_flash.c
diff -u /dev/null build_tree/bootLoader/src/lib/gio_flash.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/gio_flash.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,181 @@
+/**********************************************************************
+ * GIO flash "driver"
+ *
+ * Copyright (C) 2003, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: gio_flash.c,v 1.1 2003/04/03 14:32:50 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+
+#include <blob/init.h>
+#include <blob/flash.h>
+#include <blob/generic_io.h>
+
+/**********************************************************************
+ * defines
+ */
+#define DEBUG 0
+
+#if DEBUG
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args );
+#else
+#	define DBG( x, args... )	
+#endif
+
+/**********************************************************************
+ * module globals
+ */
+#if DEBUG
+static int dbg = 1;
+#else
+static int dbg = 0;
+#endif
+
+static char module_version[] = "$Id: gio_flash.c,v 1.1 2003/04/03 14:32:50 seletz Exp $";
+
+/**********************************************************************
+ * static functions
+ */
+
+/**********************************************************************
+ * flash io driver
+ */
+int flash_io_init( io_driver_t *io );
+static int flash_io_conf( io_driver_t * io, void *conf );
+static int flash_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+static int flash_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+
+/* initialize driver struct */
+int flash_io_init( io_driver_t *io )
+{
+	if ( !io )
+		return -EINVAL;
+
+	io->private_data = NULL;
+	io->io_size = 0;
+	io->conf = flash_io_conf;
+	io->read = flash_io_read;
+	io->write = flash_io_write;
+	io->child_io = NULL;
+
+	return 0;
+}
+
+/* configure: select a base offset within the flash */
+static int flash_io_conf( io_driver_t * io, void *conf )
+{
+	u32 offset;
+
+	if ( !io )
+		return -EINVAL;
+
+	offset = (u32)conf;
+
+	io->io_size = flash_get_size();
+
+	if ( offset > io->io_size )
+		return -ERANGE;
+	
+	io->private_data=(void *)offset;
+
+	return 0;
+}
+
+static int flash_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	u32 offset;
+
+	DBG( 5, "%s: dest=%p, src=%p, amount=%d, io=%p\n", __FUNCTION__, 
+			dest, src, amount, io );
+
+	if ( !io || !dest )
+		return -EINVAL;
+
+
+	offset = (u32)io->private_data;
+
+	DBG( 5, "%s: using offset %x.\n", __FUNCTION__, offset );
+
+	memcpy( dest, (unsigned char *)(offset + (u32)src), amount );
+
+	return 0;
+}
+
+/* flash write: only on word boundaries! */
+static int flash_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	u32 offset;
+	u32 adr;
+
+	DBG( 5, "%s: dest=%p, src=%p, amount=%d, io=%p\n", __FUNCTION__, 
+			dest, src, amount, io );
+
+	if ( !io || !src )
+		return -EINVAL;
+
+
+	offset = (u32)io->private_data;
+	DBG( 5, "%s: using offset %x.\n", __FUNCTION__, offset );
+
+	adr = (u32)dest + offset;
+
+	/* check alignment */
+	if ( adr%4 ) {
+		printf( "%s: misaligned destination address (%x).\n",
+				__FUNCTION__, adr );
+		return -EALIGN;
+	}
+	if ( amount%4 ) {
+		printf( "%s: warning: misaligned amount to write (%d).\n",
+				__FUNCTION__, amount );
+	}
+
+	DBG( 5, "%s: adr=0x%08x, nwords=%d.\n", __FUNCTION__,
+			adr, amount/4 + (amount%4?1:0));
+
+	return flash_write_region( (u32 *)adr, (u32*)src, amount/4 + (amount%4?1:0));
+}
+
+/* register flash io driver */
+void init_flash_io( void )
+{
+	int ret;
+	static io_driver_t io_flash;
+	
+	ret = flash_io_init( &io_flash );
+	if ( ret ) return ;
+
+	ret = io_register( &io_flash, "FLASH" ); 
+	if ( ret ) return;
+
+	ret = io_configure( "FLASH", 0 );
+	if ( ret ) return;
+
+	return;
+}
Index: build_tree/bootLoader/src/lib/gio_part_blob.c
diff -u /dev/null build_tree/bootLoader/src/lib/gio_part_blob.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/gio_part_blob.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,187 @@
+/**********************************************************************
+ * blob partition reading for GIO
+ *
+ * Copyright (C) 2003, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: gio_part_blob.c,v 1.1 2003/04/03 14:32:50 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+
+#include <blob/init.h>
+#include <blob/partition.h>
+#include <blob/generic_io.h>
+
+/**********************************************************************
+ * defines
+ */
+#define DEBUG 0
+
+#if DEBUG
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args );
+#else
+#	define DBG( x, args... )	
+#endif
+
+/**********************************************************************
+ * module globals
+ */
+#if DEBUG
+static int dbg = 1;
+#else
+static int dbg = 0;
+#endif
+
+static char module_version[] = "$Id: gio_part_blob.c,v 1.1 2003/04/03 14:32:50 seletz Exp $";
+
+/**********************************************************************
+ * static functions
+ */
+
+/**********************************************************************
+ * blob partition io driver
+ *
+ * - default blob partition is registered as a default io driver
+ * - the configure call "selects" a partition by it's name.
+ *   (just like the tar io driver)
+ */
+static int part_io_init( io_driver_t *io );
+static int part_io_conf( io_driver_t * io, void *conf );
+static int part_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+static int part_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+
+/* initialize driver struct */
+static int part_io_init( io_driver_t *io )
+{
+	if ( !io )
+		return -EINVAL;
+
+	io->private_data = NULL;
+	io->io_size = 0;
+	io->conf = part_io_conf;
+	io->read = part_io_read;
+	io->write = part_io_write;
+	io->child_io = NULL;
+
+	return 0;
+}
+
+/* configure: select a partition by name */
+static int part_io_conf( io_driver_t * io, void *conf )
+{
+	char *name;
+	const blob_partition_t *part;
+
+	if ( !io || !conf )
+		return -EINVAL;
+
+	name = (char *)conf;
+	if ( !name )
+		return -EINVAL;
+
+	part = pt_find_by_name( name );
+	if ( !part )
+		return -EINVAL;
+
+	DBG( 1, "%s: found partition '%s': offset=%x, size=%x, flags=%x\n", __FUNCTION__,
+			part->name, part->offset, part->size, part->flags );
+
+
+	io->io_size=part->size;
+	io->private_data=(void*)part;
+
+	return 0;
+}
+
+static int part_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	blob_partition_t *part;
+	io_driver_t *child;
+
+	DBG( 1, "%s: dest=%p, src=%p, amount=%d, io=%p\n", __FUNCTION__, 
+			dest, src, amount, io );
+
+	if ( !io || !dest )
+		return -EINVAL;
+
+	child = io_get_child( io );
+	if ( !child )
+		return -EINVAL;
+
+	part = (blob_partition_t *)io->private_data;
+	if ( !part )
+		return -EINVAL;
+
+	DBG( 1, "%s: using partition '%s'.\n", __FUNCTION__, part->name );
+	DBG( 1, "%s: dest=%p, src=%p(=%p), amount=%d, io=%p\n", __FUNCTION__, 
+			dest, src, (void*)(src + part->offset), amount, io );
+
+	/* defer reading to our child */
+	return io_read(dest, (void *)((u32)src + part->offset), amount, child);
+}
+
+static int part_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	blob_partition_t *part;
+	io_driver_t *child;
+
+
+	if ( !io || !src )
+		return -EINVAL;
+
+	child = io_get_child( io );
+	if ( !child )
+		return -EINVAL;
+
+	part = (blob_partition_t *)io->private_data;
+	if ( !part )
+		return -EINVAL;
+
+	DBG( 1, "%s: using partition '%s'.\n", __FUNCTION__, part->name );
+	DBG( 1, "%s: dest=%p(=%p), src=%p, amount=%d, io=%p\n", __FUNCTION__, 
+			dest, (void*)(dest + part->offset), src, amount, io );
+
+	/* defer writing to our child */
+	return io_write((void *)((u32)dest + part->offset), src, amount, child);
+}
+
+
+/* register default blob partition io driver */
+void init_part_io( void )
+{
+	int ret;
+	static io_driver_t io_part;
+	
+	ret = part_io_init( &io_part );
+	if ( ret ) return ;
+
+	ret = io_register( &io_part, "BLOB_PART" ); 
+	if ( ret ) return;
+
+	return;
+}
Index: build_tree/bootLoader/src/lib/gio_ram.c
diff -u /dev/null build_tree/bootLoader/src/lib/gio_ram.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/gio_ram.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,179 @@
+/**********************************************************************
+ * GIO ram "driver"
+ *
+ * Copyright (C) 2003, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: gio_ram.c,v 1.1 2003/04/03 14:32:50 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+
+#include <blob/init.h>
+#include <blob/generic_io.h>
+
+/**********************************************************************
+ * defines
+ */
+#define DEBUG 0
+
+#if DEBUG
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args );
+#else
+#	define DBG( x, args... )	
+#endif
+
+#if !defined( RAM_START ) || !defined( RAM_SIZE )
+#	error "define RAM_START and RAM_SIZE for your platform"
+#endif
+
+/**********************************************************************
+ * module globals
+ */
+#if DEBUG
+static int dbg = 1;
+#else
+static int dbg = 0;
+#endif
+
+static char module_version[] = "$Id: gio_ram.c,v 1.1 2003/04/03 14:32:50 seletz Exp $";
+
+/**********************************************************************
+ * static functions
+ */
+static int ram_io_conf( io_driver_t * io, void *conf );
+static int ram_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+static int ram_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+
+/**********************************************************************
+ *  A simple RAM driver
+ *  - io driver for RAM access
+ */
+int ram_io_init( io_driver_t *io, ram_io_t *ram )
+{
+	if ( !io || !ram )
+		return -EINVAL;
+
+	io->private_data = (void *)ram;
+	io->io_size = ram->len - ram->pos;
+	io->conf = ram_io_conf;
+	io->read = ram_io_read;
+	io->write = ram_io_write;
+	io->child_io = NULL;
+
+	return 0;
+}
+
+static int ram_io_conf( io_driver_t * io, void *conf )
+{
+	ram_io_t *ram;
+
+	if ( !io || !conf )
+		return -EINVAL;
+
+	ram = (ram_io_t*)io->private_data;
+	if ( !ram )
+		return -EINVAL;
+
+	if ( (u32)conf >= ram->len )
+		return -EINVAL;
+
+	ram->pos = (u32)conf;
+
+	io->io_size = ram->len - (u32)ram->pos;
+
+	return 0;
+}
+
+static int ram_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	u32 offset;
+	ram_io_t *ram;
+
+	DBG( 1, "%s: dest=%p, src=%p, amount=%d, io=%p\n", __FUNCTION__, 
+			dest, src, amount, io );
+
+	if ( !io || !dest )
+		return -EINVAL;
+
+	ram = (ram_io_t*)io->private_data;
+	if ( !ram )
+		return -EINVAL;
+
+	offset = ram->start + (u32)ram->pos;
+	
+	DBG( 1, "%s: dest=%p, src=%p(=%p), amount=%d, io=%p\n", __FUNCTION__, 
+			dest, src, (void*)(src +offset), amount, io );
+
+	memcpy( dest, (void *)(offset + (u32)src), amount);
+
+	return 0;
+}
+
+static int ram_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	u32 offset;
+	ram_io_t *ram;
+
+
+	if ( !io || !src )
+		return -EINVAL;
+
+	ram = (ram_io_t*)io->private_data;
+	if ( !ram )
+		return -EINVAL;
+
+	offset = ram->start + (u32)ram->pos;
+
+	DBG( 1, "%s: dest=%p(=%p), src=%p, amount=%d, io=%p\n", __FUNCTION__, 
+			dest, (void*)(dest +offset), src, amount, io );
+
+	memcpy((void *)(offset + (u32)dest), src, amount);
+	
+	return 0;
+}
+
+/**********************************************************************
+ *  init ram pools
+ */
+void init_ram_io( void )
+{
+	int ret;
+	static ram_io_t		ram0;
+	static io_driver_t	io_ram0;
+
+	ram0.start=RAM_START;
+	ram0.len=RAM_SIZE;
+	ram0.pos=0;
+
+	ret = ram_io_init( &io_ram0, &ram0 );
+	if ( ret ) return;
+
+	ret = io_register( &io_ram0, "RAM" ); 
+	if ( ret ) return;
+}
Index: build_tree/bootLoader/src/lib/i2c-gpio.c
diff -u /dev/null build_tree/bootLoader/src/lib/i2c-gpio.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/i2c-gpio.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,146 @@
+/*
+ * i2c-gpio.c: i2c on a pair of GPIO pins
+ *
+ * Copyright (C) 2001 Hewlett-Packard Comapny
+ * Written by Christopher Hoover <ch@hpl.hp.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: i2c-gpio.c,v 1.4 2003/08/06 22:55:41 abz Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/i2c.h>
+#include <blob/i2c-gpio.h>
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+
+#ifdef DEBUG
+#define DPRINTF(...) do { printf(__VA_ARGS__); } while (0)
+#else
+#define DPRINTF(...) do { } while (0)
+#endif
+
+////////////////////////////////////////////////////////////////////////
+
+static inline int set_scl(struct i2c_bus *bus, unsigned sense) {
+	return (bus->set_scl)(bus, sense);
+}
+static inline int set_sda(struct i2c_bus *bus, unsigned sense) {
+	return (bus->set_sda)(bus, sense);
+}
+static inline int get_scl(struct i2c_bus *bus) {
+	return (bus->get_scl)(bus);
+}
+static inline int get_sda(struct i2c_bus *bus) {
+	return (bus->get_sda)(bus);
+}
+
+////////////////////////////////////////////////////////////////////////
+
+static inline void delay(const struct i2c_bus *bus) 
+{
+	struct i2c_bus_gpio_private *private =
+		(struct i2c_bus_gpio_private *) bus->private;
+
+	/* ### use msleep?  no, it may not be around early enough */
+	volatile int i;
+	for (i = 0; i < private->delay; i++)
+		;
+}
+
+int init_bus_gpio(struct i2c_bus *bus)
+{
+	struct i2c_bus_gpio_private *private =
+		(struct i2c_bus_gpio_private *) bus->private;
+
+	GAFR &= ~(private->sda_gpio | private->scl_gpio);
+	GPDR &= ~(private->sda_gpio | private->scl_gpio);
+	GPCR = (private->sda_gpio | private->scl_gpio);
+
+	set_sda_gpio(bus, 1);
+	set_scl_gpio(bus, 1);
+
+	delay(bus);
+	delay(bus);
+
+	return 0;
+}
+
+int set_sda_gpio(struct i2c_bus *bus, unsigned sense)
+{
+	struct i2c_bus_gpio_private *private =
+		(struct i2c_bus_gpio_private *) bus->private;
+
+	if (sense)
+		/* float high */
+		GPDR &= ~(private->sda_gpio);
+	else
+		/* pull low */
+		GPDR |= (private->sda_gpio);
+
+	delay(bus);
+
+	return 0;
+}
+
+int get_sda_gpio(struct i2c_bus *bus)
+{
+	struct i2c_bus_gpio_private *private =
+		(struct i2c_bus_gpio_private *) bus->private;
+
+	return (GPLR & (private->sda_gpio)) ? 1 : 0;
+}
+
+int set_scl_gpio(struct i2c_bus *bus, unsigned sense)
+{
+	struct i2c_bus_gpio_private *private =
+		(struct i2c_bus_gpio_private *) bus->private;
+
+	if (sense) {
+		int i = 0;
+
+		/* float high */
+		GPDR &= ~(private->scl_gpio);
+
+		while (!get_scl(bus)) {
+			if (i++ > 10) {
+				DPRINTF(__FUNCTION__ ": scl did not go high\n");
+				return -ETIMEOUT;
+			}
+			delay(bus);
+		}
+	} else
+		/* pull low */
+		GPDR |= (private->scl_gpio);
+
+	delay(bus);
+
+	return 0;
+}
+
+int get_scl_gpio(struct i2c_bus *bus)
+{
+	struct i2c_bus_gpio_private *private =
+		(struct i2c_bus_gpio_private *) bus->private;
+
+	return (GPLR & (private->scl_gpio)) ? 1 : 0;
+}
+
Index: build_tree/bootLoader/src/lib/i2c.c
diff -u /dev/null build_tree/bootLoader/src/lib/i2c.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/i2c.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,365 @@
+/*
+ * i2c.c: generic i2c bus support
+ *
+ * Copyright (C) 2001 Hewlett-Packard Comapny
+ * Written by Christopher Hoover <ch@hpl.hp.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: i2c.c,v 1.5 2003/08/06 22:55:41 abz Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/i2c.h>
+#include <blob/util.h>
+#include <blob/errno.h>
+
+#ifdef DEBUG
+#define DPRINTF(...) do { printf(__VA_ARGS__); } while (0)
+#else
+#define DPRINTF(...) do { } while (0)
+#endif
+
+////////////////////////////////////////////////////////////////////////
+
+static inline int set_scl(struct i2c_bus *bus, unsigned sense) {
+	return (bus->set_scl)(bus, sense);
+}
+static inline int set_sda(struct i2c_bus *bus, unsigned sense) {
+	return (bus->set_sda)(bus, sense);
+}
+static inline int get_scl(struct i2c_bus *bus) {
+	return (bus->get_scl)(bus);
+}
+static inline int get_sda(struct i2c_bus *bus) {
+	return (bus->get_sda)(bus);
+}
+
+////////////////////////////////////////////////////////////////////////
+
+int i2c_start(struct i2c_bus *bus)
+{
+	/* high to low transition on SDA while SCL is high */
+	set_scl(bus, 1);
+	set_sda(bus, 1);
+	set_sda(bus, 0);
+	set_scl(bus, 0);
+	set_sda(bus, 1);
+
+	return 0;
+}
+
+int i2c_stop(struct i2c_bus *bus)
+{
+	/* low to high transition on SDA while SCL is high */
+	set_sda(bus, 0);
+	set_scl(bus, 1);
+	set_sda(bus, 1);
+
+	return 0;
+}
+
+int i2c_init(struct i2c_bus *bus)
+{
+	int rc, i;
+
+	DPRINTF("initializing i2c driver\n");
+	rc = (bus->init_bus)(bus);
+	if (rc < 0)
+		return rc;
+
+	DPRINTF("resetting i2c bus");
+	for (i = 0; i < 15; i++)
+		(void) i2c_stop(bus);
+
+	DPRINTF("testing i2c bus");
+	DPRINTF("[0] scl: %d, sda: %d\n", get_scl(bus), get_sda(bus));
+	if ((get_scl(bus) != 1) || (get_sda(bus) != 1)) {
+		printf("bus seems to be busy\n");
+		goto fail;
+	}
+
+	set_sda(bus, 0);
+	DPRINTF("[1] scl: %d, sda: %d\n", get_scl(bus), get_sda(bus));
+	if (get_sda(bus) != 0) {
+		printf("sda stuck high\n");
+		goto fail;
+	}
+	if (get_scl(bus) == 0) {
+		printf("scl unexpectedly low while pulling SDA low\n");
+		goto fail;
+	}
+
+	set_sda(bus, 1);
+	DPRINTF("[2] scl: %d, sda: %d\n", get_scl(bus), get_sda(bus));
+	if (get_sda(bus) == 0) {
+		printf("sda stuck low\n");
+		goto fail;
+	}
+	if (get_scl(bus) == 0) {
+		printf("scl unexpectedly low while SDA high\n");
+		goto fail;
+	}
+
+	set_scl(bus, 0);
+	DPRINTF("[3] scl: %d, sda: %d\n", get_scl(bus), get_sda(bus));
+	if (get_scl(bus) != 0) {
+		printf("scl stuck high\n");
+		goto fail;
+	}
+	if (get_sda(bus) == 0) {
+		printf("sda unexpected low while pulling scl low\n");
+		goto fail;
+	}
+
+	set_scl(bus, 1);
+	DPRINTF("[4] scl: %d, sda: %d\n", get_scl(bus), get_sda(bus));
+	if (get_scl(bus) == 0) {
+		printf("scl stuck low\n");
+		goto fail;
+	}
+	if (get_sda(bus) == 0) {
+		printf("sda unexpected low while scl high\n");
+		goto fail;
+	}
+
+	DPRINTF("test passed\n");
+
+	return 0;
+
+ fail:
+	/* float the lines */
+	set_scl(bus, 1);
+	set_sda(bus, 1);
+	return -EINVAL;
+}
+
+int i2c_send_ack(struct i2c_bus *bus) 
+{
+	set_sda(bus, 0);
+	set_scl(bus, 1);
+	set_scl(bus, 0);
+	set_sda(bus, 1);
+
+	return 0;
+}
+
+int i2c_get_ack(struct i2c_bus *bus) 
+{
+	unsigned bit;
+
+	set_sda(bus, 1);
+	set_scl(bus, 1);
+
+	bit = get_sda(bus);
+	if (bit)
+		printf("%s: did not get ack\n",__FUNCTION__);
+
+	set_scl(bus, 0);
+
+	/* zero is winning */
+	return bit;
+}
+
+int i2c_get_ack_quietly(struct i2c_bus *bus) 
+{
+	unsigned bit;
+
+	set_sda(bus, 1);
+	set_scl(bus, 1);
+
+	bit = get_sda(bus);
+
+	set_scl(bus, 0);
+
+	/* zero is winning */
+	return bit;
+}
+
+int i2c_write_byte(struct i2c_bus *bus, u8 byte) 
+{
+	int i;
+
+	for (i = 7; i >= 0; i--) {
+		unsigned bit = byte & (1<<i);
+		
+		set_sda(bus, bit);
+		set_scl(bus, 1);
+		set_scl(bus, 0);
+	}
+	set_sda(bus, 1);
+
+	return 0;
+}
+
+int i2c_read_byte(struct i2c_bus *bus) 
+{
+	int i;
+	u8 value = 0;
+
+	set_sda(bus, 1);
+
+	for (i = 0; i < 8; i++) {
+		unsigned bit;
+
+		set_scl(bus, 1);
+
+		bit = get_sda(bus);
+		value = (value << 1) | bit;
+
+		set_scl(bus, 0);
+	}
+
+	return value;
+}
+
+#define READ_ADDR(x)  (((x) << 1) | 1)
+#define WRITE_ADDR(x) ((x) << 1)
+
+#define i2c_get_ack_or_bail(bus) \
+  do { \
+	int rc = i2c_get_ack(bus); \
+	if (rc != 0) { i2c_stop(bus); i2c_stop(bus); return rc; } \
+  } while (0)
+
+int i2c_read_device_byte(struct i2c_bus *bus, u8 devAddr)
+{
+	u8 val;
+
+	i2c_start(bus);
+	i2c_write_byte(bus, READ_ADDR(devAddr));
+	i2c_get_ack_or_bail(bus);
+	val = i2c_read_byte(bus);
+	i2c_stop(bus);
+
+	return val;
+}
+
+int i2c_read_device_byte_at(struct i2c_bus *bus, u8 devAddr, u8 startAddr)
+{
+	i2c_start(bus);
+	i2c_write_byte(bus, WRITE_ADDR(devAddr));
+	i2c_get_ack_or_bail(bus);
+	i2c_write_byte(bus, startAddr);
+	i2c_get_ack_or_bail(bus);
+
+	return i2c_read_device_byte(bus, devAddr);
+}
+
+int i2c_read_device_bytes(struct i2c_bus *bus, 
+			   u8 devAddr, u8 startAddr,
+			   u8 *buf, unsigned long n)
+{
+	i2c_start(bus);
+	i2c_write_byte(bus, WRITE_ADDR(devAddr));
+	i2c_get_ack_or_bail(bus);
+	i2c_write_byte(bus, startAddr);
+	i2c_get_ack_or_bail(bus);
+	i2c_start(bus);
+	i2c_write_byte(bus, READ_ADDR(devAddr));
+	i2c_get_ack_or_bail(bus);
+
+	for (; n > 0; n--) {
+		u8 val = i2c_read_byte(bus);
+		*buf++ = val;
+		if (n)
+			i2c_send_ack(bus);
+	}
+
+	i2c_stop(bus);
+
+	return 0;
+}
+
+int i2c_write_device_byte_at(struct i2c_bus *bus, u8 devAddr, 
+			     u8 val, u8 startAddr)
+{
+	i2c_start(bus);
+	i2c_write_byte(bus, WRITE_ADDR(devAddr));
+	i2c_get_ack_or_bail(bus);
+	i2c_write_byte(bus, startAddr);
+	i2c_get_ack_or_bail(bus);
+	i2c_write_byte(bus, val);
+	i2c_get_ack_or_bail(bus);
+	i2c_stop(bus);
+
+	return 0;
+}
+
+int i2c_write_device_bytes_at(struct i2c_bus *bus, 
+			       u8 devAddr, u8 startAddr,
+			       const u8 *buf, unsigned long n)
+{
+	i2c_start(bus);
+	i2c_write_byte(bus, WRITE_ADDR(devAddr));
+	i2c_get_ack_or_bail(bus);
+	i2c_write_byte(bus, startAddr);
+	i2c_get_ack_or_bail(bus);
+
+	for (; n > 0; n--) {
+		u8 val = *buf++;
+		i2c_write_byte(bus, val);
+		
+		i2c_get_ack_or_bail(bus);
+	}
+
+	i2c_stop(bus);
+
+	return 0;
+}
+
+int i2c_probe(struct i2c_bus *bus, u8 devAddr)
+{
+	int ack;
+
+	i2c_start(bus);
+	i2c_write_byte(bus, READ_ADDR(devAddr));
+	ack = i2c_get_ack_quietly(bus);
+	i2c_stop(bus);
+
+	/* 0 == device present */
+	return ack;
+}
+
+int i2c_scan(struct i2c_bus *bus, u8 map[256])
+{
+	int i;
+
+	DPRINTF("scanning bus ");
+	for (i = 0; i < 0xff; i += 1) {
+		unsigned ack;
+
+		i2c_start(bus);
+
+		i2c_write_byte(bus, i);
+		ack = i2c_get_ack_quietly(bus);
+		i2c_stop(bus);
+
+		if (ack == 0) {
+			DPRINTF("(%02x)", i);
+			map[i] = 1;
+		} else {
+			DPRINTF(".");
+			map[i] = 0;
+		}
+	}
+	DPRINTF("\ndone\n");
+
+	return 0;
+}
Index: build_tree/bootLoader/src/lib/icache.c
diff -u build_tree/bootLoader/src/lib/icache.c:1.1.1.1 build_tree/bootLoader/src/lib/icache.c:1.1.1.2
--- build_tree/bootLoader/src/lib/icache.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/icache.c	Fri Nov  9 09:44:05 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Russ Dill <Russ.Dill@asu.edu>
  *
- * $Id: icache.c,v 1.3 2001/10/07 20:16:57 erikm Exp $
+ * $Id: icache.c,v 1.4 2003/08/06 22:55:41 abz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,7 +21,7 @@
  *
  */
 
-#ident "$Id: icache.c,v 1.3 2001/10/07 20:16:57 erikm Exp $"
+#ident "$Id: icache.c,v 1.4 2003/08/06 22:55:41 abz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -30,7 +30,7 @@
 #include <blob/icache.h>
 #include <blob/types.h>
 
-
+#include<blob/util.h>
 
 void enable_icache(void)
 {
Index: build_tree/bootLoader/src/lib/ide.c
diff -u /dev/null build_tree/bootLoader/src/lib/ide.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ide.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,598 @@
+/**********************************************************************
+ * ide.c
+ *
+ * Basic ide drive framework. Based on Brad Parkers work.
+ *
+ * Copyright (C) 2001, Brad Parker (brad@heeltoe.com)
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: ide.c,v 1.7 2002/05/10 15:33:39 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/time.h>
+#include <blob/serial.h>
+#include <blob/arch.h>
+#include <blob/ide.h>
+
+/**********************************************************************
+ * Defines / Makros
+ */
+#define WEAK_SYM __attribute__ (( weak ))
+
+#define IDE_DEBUG 1
+
+#ifdef IDE_DEBUG
+#	define DBG( x, args... )	if ( ide_dbg>x ) printf( args );
+#else
+#	define DBG( x, args... )	
+#endif
+
+#define IDE_DELAY 10
+
+/**********************************************************************
+ * Typen
+ */
+
+/**********************************************************************
+ * Programmglobale Variable
+ */
+
+/**********************************************************************
+ * Modulglobale Variable
+ */
+static char *version = "$Id: ide.c,v 1.7 2002/05/10 15:33:39 seletz Exp $";
+
+#ifdef	IDE_DEBUG
+static int ide_dbg = 1;
+#else
+static int ide_dbg = 0;
+#endif
+
+
+/**********************************************************************
+ * Prototypen
+ */
+static int hd_identify(volatile u8 *port, volatile u8 *reg, char *buffer);
+static int hd_recal(volatile u8 *port);
+static int hd_busy_wait(volatile u8 *port);
+static void ide_fixstring (u8 *s, const int bytecount, const int byteswap);
+
+/**********************************************************************
+ * Exported functions
+ */
+
+void ide_dbg_set( int level )
+{
+	ide_dbg = level;
+}
+
+/**********************************************************************
+ * ide_init
+ *
+ * - Initialize ide drive struct
+ * - calculatees and sets HD_PORT and HD_REG_RORT from a base address
+ */
+int ide_init( ide_drive_t *drive, u32 base_addr )
+{
+	if ( !base_addr )
+		return -1;
+
+	if ( !drive )
+		return -1;
+
+	DBG( 1, "ide: %s\n", version );
+
+	drive->ide_port = (u8 *)(base_addr + HD_PORT);
+	drive->ide_reg = (u8 *)(base_addr + HD_REG_PORT);
+	drive->last_status = 0;
+
+	DBG( 1, "%s: ide_port=%p\n", __FUNCTION__, drive->ide_port );
+	DBG( 1, "%s: ide_reg=%p\n", __FUNCTION__, drive->ide_reg );
+
+	return 0;
+}
+
+/**********************************************************************
+ * ide_status_dump
+ *
+ * - Dump IDE ports
+ */
+int ide_status_dump( ide_drive_t *drive )
+{
+	u8 status;
+
+	if ( !drive || !drive->ide_port )
+		return -1;
+
+
+	status = drive->ide_port[7];
+	printf( "ide: status[%s %s %s %s %s %s %s %s]\n",
+			status&BUSY			?"BSY":"   ",
+			status&READY		?"RDY":"   ",
+			status&WRITE_FAULT	?"DF ":"   ",
+			status&SEEKOK		?"DSC":"   ",
+			status&DATA_REQ		?"DRQ":"   ",
+			status&CORRECTED	?"COR":"   ",
+			status&REV_INDEX	?"IDX":"   ",
+			status&ERROR		?"ERR":"   " 
+		  );
+
+	return 0;
+}
+
+/**********************************************************************
+ * ide_reset
+ *
+ * - reset ide controller
+ *
+ * FIXME: resolve those magic numbers
+ */
+int ide_reset( ide_drive_t *drive )
+{
+	volatile u8 *port = NULL;
+	volatile u8 *reg = NULL;
+
+	if ( !drive || !drive->ide_port )
+		return -1;
+
+	port = drive->ide_port;
+	reg = drive->ide_reg;
+
+#if 1
+	/* reset hd controller */
+	reg[0] = 0x06;
+	barrier();
+	msleep(IDE_DELAY);
+	reg[0] = 0x02;
+	barrier();
+	msleep(IDE_DELAY);
+#else
+	msleep(5*IDE_DELAY);
+#endif
+
+	port[1] = 0;
+	port[2] = 0;
+	port[3] = 0;
+	port[4] = 0;
+	port[5] = 0;
+	port[6] = 0xa0;
+	barrier();
+	msleep(IDE_DELAY);
+
+	return 0;
+}
+
+/**********************************************************************
+ * ide_identify_drive
+ *
+ * - Try to identify hd
+ * - Stores hd_driveid struct in ide drive struct
+ * - gets sectors per track and heads of disk
+ */
+int ide_identify_drive( ide_drive_t *drive )
+{
+	struct hd_driveid *id;
+	volatile u8 *port = NULL;
+	volatile u8 *reg = NULL;
+	static char id_buffer[IDE_BLOCK_SIZE];
+
+	if ( !drive || !drive->ide_port )
+		return -1;
+
+	port = drive->ide_port;
+	reg = drive->ide_reg;
+
+	if (hd_identify(port, reg, id_buffer)) {
+		return -1;
+	}
+
+	id = (struct hd_driveid *)id_buffer;
+
+	ide_fixstring (id->model, sizeof(id->model), 1);
+
+	printf("ide: model: '%s'\n", id->model);
+	printf("ide: CHS:   %d/%d/%d\n", id->cyls, id->heads, id->sectors);
+	printf("ide: lba_capacity %d (total %d bytes)\n", id->lba_capacity, id->lba_capacity*IDE_BLOCK_SIZE);
+
+	if (id->sectors && id->heads) {
+		drive->disk_sectors_per_track = id->sectors;
+		drive->disk_heads = id->heads;
+	} else {
+		drive->disk_sectors_per_track = 0;
+		drive->disk_heads = 0;
+	}
+
+	drive->driveid = *id;
+
+	return 0;
+}
+
+/**********************************************************************
+ * ide_setfeature
+ *
+ * - set features
+ *
+ */
+int ide_setfeature( ide_drive_t *drive, unsigned char opcode, unsigned char param )
+{
+	volatile u8 *port = NULL;
+	volatile u8 *reg = NULL;
+
+	if ( !drive || !drive->ide_port )
+		return -1;
+
+	port = drive->ide_port;
+	reg = drive->ide_reg;
+
+	DBG( 1, "%s: HDC_SETFEATURE( 0x%02x, 0x%02x )\n", __FUNCTION__,
+			opcode, param );
+
+	port[1] = opcode;
+	port[2] = param;
+	port[3] = 0;
+	port[4] = 0;
+	port[5] = 0;
+	port[6] = 0;
+	port[7] = HDC_SETFEATURE;
+
+	hd_busy_wait(port);
+
+	return 0;
+}
+
+/**********************************************************************
+ * hd_read
+ *
+ * - read head/sector/cyl of drive to a buffer. Reads 1 block (512 bytes) of
+ * data.
+ */
+int hd_read( ide_drive_t *drive, int head, int sector, int cyl, char *buffer)
+{
+	int i, hd_drive, hd_cyl, hd_head, hd_sector;
+	u8 status, hd_cmd[8];
+	volatile u8 *port = NULL;
+	volatile u8 *reg = NULL;
+
+	if ( !drive || !drive->ide_port )
+		return -1;
+
+	port = drive->ide_port;
+	reg = drive->ide_reg;
+
+	hd_drive = 0;
+	hd_cyl = cyl;
+	hd_head = head;
+	hd_sector = sector;
+
+	hd_cmd[1] = 0;
+	hd_cmd[2] = 1;			/* # sectors */
+	hd_cmd[3] = hd_sector;		/* starting sector */
+	hd_cmd[4] = cyl & 0xff;		/* cylinder low byte */
+	hd_cmd[5] = (cyl >> 8) & 0xff;	/* cylinder hi byte */
+	hd_cmd[6] = (hd_drive << 4) | (hd_head & 0x0f) | 0xa0;
+
+	DBG( 2, "%s: h=%d s=%d c=%d\n", __FUNCTION__, hd_head, hd_sector,
+			hd_cyl);
+
+#if 0
+	if (hd_head > 7) {
+		//	hd_control |= 0x08;
+		//	reg[0] = hd_control;
+		//	hd_control &= 0xf7;
+		reg[0] = 0x08;
+	}
+#endif
+
+	/* --- */
+	hd_busy_wait(port);
+
+	for (i = 1; i < 7; i++) {
+		port[i] = hd_cmd[i];
+		barrier();
+	}
+
+	port[7] = HDC_READ;
+	barrier();
+
+	hd_busy_wait(port);
+
+	for (i = 0; i < IDE_BLOCK_SIZE; i++) {
+		buffer[i] = port[0];
+		barrier();
+	}
+
+	drive->last_status = status = port[7];
+
+	if (status & ERROR) {
+		printf("read status: %2x\n", status);
+
+		printf("h=%d s=%d c=%d\n", hd_head, hd_sector, hd_cyl);
+		for (i = 1; i < 7; i++) {
+			printf("set reg[%d] %2x\n", i, hd_cmd[i]);
+		}
+	}
+
+	if (status & ERROR)
+		return -1;
+
+	return 0;
+}
+
+/**********************************************************************
+ * hd_read_lba
+ * - read using LBA mode
+ */
+int hd_read_lba( ide_drive_t *drive, u32 lba, char *buffer)
+{
+	int i, hd_drive;
+	u8 status, hd_cmd[8];
+	volatile u8 *port = NULL;
+	volatile u8 *reg = NULL;
+
+	if ( !drive || !drive->ide_port )
+		return -1;
+
+	port = drive->ide_port;
+	reg = drive->ide_reg;
+
+	lba &= 0x0fffffff;
+
+	hd_drive = 0;
+
+	hd_cmd[1] = 0;
+	hd_cmd[2] = 1;			/* # sectors */
+	hd_cmd[3] = lba&0xff;
+	hd_cmd[4] = (lba>>8)&0xff;
+	hd_cmd[5] = (lba>>16)&0xff;
+	hd_cmd[6] = (lba>>24)&0xff;
+	hd_cmd[6] |= ((hd_drive&1) << 4) | 0xe0;
+
+	hd_busy_wait(port);
+
+	for (i = 1; i < 7; i++) {
+		port[i] = hd_cmd[i];
+		barrier();
+	}
+
+	port[7] = HDC_READ;
+	barrier();
+
+	hd_busy_wait(port);
+
+	for (i = 0; i < IDE_BLOCK_SIZE; i++) {
+		buffer[i] = port[0];
+		barrier();
+	}
+
+	drive->last_status = status = port[7];
+
+	if (status & ERROR) {
+		printf("hd_read_lba: read status: %2x\n", status);
+
+		printf("hd_read_lba: lba=%08x\n", lba&0x0fffffff );
+		for (i = 1; i < 7; i++) {
+			printf("hd_cmd[%d] %2x\n", i, hd_cmd[i]);
+		}
+	}
+
+	if (status & ERROR)
+		return -1;
+
+	return 0;
+}
+
+/**********************************************************************
+ * hd_read_mapped
+ *
+ * - reads 512 bytes from sector <sector_num> from drive <drive>
+ * - <sector_num> gets mapped to CHS, then hd_read() is called.
+ */
+int hd_read_mapped( ide_drive_t *drive, int sector_num, char *buffer)
+{
+	int head, sector, cyl;
+
+	if ( !drive || !drive->ide_port )
+		return -1;
+
+	DBG( 2, "%s: sector_num=%d, buffer=%p\n", __FUNCTION__,
+				sector_num, buffer);
+
+#if 0
+	sector = (sector_num % disk_sectors_per_track) + 1;
+	sector_num /= disk_sectors_per_track;
+
+	head = sector_num % disk_heads;
+	sector_num /= disk_heads;
+
+	cyl = sector_num;
+#endif
+
+	hd_map_sector( drive, sector_num, &head, &sector, &cyl );
+
+	return hd_read( drive, head, sector, cyl, buffer);
+}
+
+/**********************************************************************
+ * hd_map_sector
+ *
+ * - map continguous sector numbers to CHS values of <drive>
+ */
+int hd_map_sector( ide_drive_t *drive, int sector, int *head, int *sec, int *cyl )
+{
+	int _cyl, _head, _sec;
+
+	if ( !drive )
+		return -1;
+
+	_sec = (sector % drive->disk_sectors_per_track) + 1;
+	sector /= drive->disk_sectors_per_track;
+
+	_head = sector % drive->disk_heads;
+	sector /= drive->disk_heads;
+
+	_cyl = sector;
+
+	DBG( 1, "%s: => (h:%d, s:%d, c:%d)\n", __FUNCTION__, _head, _sec, _cyl );
+
+	if ( head ) *head = _head;
+	if ( sec ) *sec = _sec;
+	if ( cyl ) *cyl = _cyl;
+
+	return 0;
+}
+/**********************************************************************
+ * Statische Funktionen
+ */
+
+/**********************************************************************
+ * hd_identify
+ *
+ * - performs HDC_IDENTIFY command and reads result to buffer
+ */
+static int hd_identify(volatile u8 *port, volatile u8 *reg, char *buffer)
+{
+	int i;
+	unsigned char status;
+
+	hd_busy_wait(port);
+
+	port[1] = 0;
+	port[2] = 1;
+	port[3] = 0;
+	port[4] = 0;
+	port[5] = 0;
+	port[6] = 0xa0;
+	port[7] = HDC_IDENTIFY;
+	barrier();
+
+	hd_busy_wait(port);
+
+	for (i = 0; i < IDE_BLOCK_SIZE; i++) {
+		barrier();
+		buffer[i] = port[0];
+	}
+
+	status = port[7];
+	DBG( 1, "%s: status=0x%02x\n", __FUNCTION__, status );
+
+	if (status & ERROR) {
+		printf("ide: identify status: %2x\n", status);
+		return -1;
+	}
+
+	return 0;
+}
+
+static int hd_recal(volatile u8 *port)
+{
+	int i, hd_drive, hd_head, sector;
+	u8 hd_cmd[8];
+
+	hd_drive = 0;
+	sector = 0;
+	hd_head = sector & 0xffff;
+
+	hd_cmd[1] = 0;
+	hd_cmd[2] = 1;			/* # sectors */
+	hd_cmd[3] = 0;
+	hd_cmd[4] = 0;
+	hd_cmd[5] = 0;
+	hd_cmd[6] = (hd_drive << 4) | (hd_head & 0x0f) | 0xa0;
+
+	hd_busy_wait(port);
+
+	for (i = 1; i < 7; i++) {
+		hd_busy_wait(port);
+		port[i] = hd_cmd[i];
+		barrier();
+	}
+
+	port[7] = HDC_RECAL;
+	barrier();
+
+	if (hd_busy_wait(port))
+		return -1;
+
+	return 0;
+}
+
+static int hd_busy_wait(volatile u8 *port)
+{
+	int count;
+	u8 status, err;
+
+	count = 0;
+	while (count++ < 2500) {
+		status = port[7];
+		barrier();
+		if ((status & BUSY) == 0)
+			break;
+		msleep(1);
+	}
+
+	DBG( 1, "%s: port=%p, count=%d, status=%02x\n", __FUNCTION__,
+			port, count, status );
+
+	if ( (status & ERROR) || (status & WRITE_FAULT) ) {
+		err = port[1];
+		barrier();
+		printf( "ide: busy_wait: err = %2x\n", err );
+		return -1;
+	}
+
+	return 0;
+}
+
+static void ide_fixstring (u8 *s, const int bytecount, const int byteswap)
+{
+	u8 *p = s, *end = &s[bytecount & ~1]; /* bytecount must be even */
+
+	if (byteswap) {
+		/* convert from big-endian to host byte order */
+		for (p = end ; p != s;) {
+			unsigned short *pp = (unsigned short *) (p -= 2);
+			//			*pp = ntohs(*pp);
+			*pp = ((*pp >> 8) & 0xff) | ((*pp & 0xff) << 8);
+		}
+	}
+
+	/* strip leading blanks */
+	while (s != end && *s == ' ')
+		++s;
+
+	/* compress internal blanks and strip trailing blanks */
+	while (s != end && *s) {
+		if (*s++ != ' ' || (s != end && *s && *s != ' '))
+			*p++ = *(s-1);
+	}
+
+	/* wipe out trailing garbage */
+	while (p != end)
+		*p++ = '\0';
+}
Index: build_tree/bootLoader/src/lib/init.c
diff -u build_tree/bootLoader/src/lib/init.c:1.1.1.1 build_tree/bootLoader/src/lib/init.c:1.1.1.3
--- build_tree/bootLoader/src/lib/init.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/init.c	Fri Nov  9 10:37:08 2007
@@ -3,7 +3,7 @@
  *
  * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: init.c,v 1.3 2002/01/03 16:07:18 erikm Exp $
+ * $Id: init.c,v 1.5 2002/02/13 00:10:57 erikm Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,17 +21,18 @@
  *
  */
 
-#ident "$Id: init.c,v 1.3 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: init.c,v 1.5 2002/02/13 00:10:57 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/debug.h>
 #include <blob/errno.h>
 #include <blob/error.h>
 #include <blob/init.h>
-#include <blob/serial.h>
 #include <blob/types.h>
+#include <blob/util.h>
 
 
 /* int and exit list start and end. filled in by the linker */
@@ -48,13 +49,10 @@
 
 	for(item = start; item != end; item++) {
 		if(item->magic != magic) {
+			deprintf("init magic failed at 0x%08x\n",
+				 (unsigned int)item);
 			printerror(EMAGIC, NULL);
-#ifdef BLOB_DEBUG
-			printerrprefix();
-			SerialOutputString("Address = 0x");
-			SerialOutputHex((u32)item);
-			serial_write('\n');
-#endif
+
 			return;
 		}
 		
@@ -72,9 +70,13 @@
 	
 	/* call all subsystem init functions */
 	for(i = INIT_LEVEL_MIN; i <= INIT_LEVEL_MAX; i++)
+	{
 		call_funcs((initlist_t *)&__initlist_start, 
 			   (initlist_t *)&__initlist_end,
 			   INIT_MAGIC, i);
+
+
+	}
 }
 
 
Index: build_tree/bootLoader/src/lib/ip_bits.c
diff -u /dev/null build_tree/bootLoader/src/lib/ip_bits.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/ip_bits.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,138 @@
+/*
+ *  ip_bits.c
+ *
+ *  Copyright 1996-2001 Russell King
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+#include <blob/util.h>
+#include <blob/serial.h>
+#include <net/net.h>
+#include <net/ether.h>
+#include <net/arp.h>
+#include <net/ip_bits.h>
+
+unsigned long ip_sequence = 0;
+
+unsigned int checksum (unsigned char *ptr, int len, unsigned int cksum)
+{
+	int i;
+
+	for (i = 0; i < len - 1; i += 2)
+		cksum += (ptr[i] << 8) | ptr[i + 1];
+
+	if (len & 1)
+		cksum += ptr[len - 1] << 8;
+
+	cksum = (cksum & 0xffff) + (cksum >> 16);
+	cksum = (cksum & 0xffff) + (cksum >> 16);
+	return cksum;
+}
+
+void printip (char *msg, unsigned char *ip)
+{
+	int i;
+	printascii (msg);
+	for (i = 0; i < 4; i++) {
+		printf( "%02x", ip[i]);
+		printch (i == 3 ? ' ' : '.');
+	}
+}
+
+int ipbits_tx (unsigned char *ptr, unsigned int size)
+{
+	unsigned int cksum;
+
+	ptr[OFF_ETHER + 12] = 8;
+	ptr[OFF_ETHER + 13] = 0;
+	ptr[OFF_UDP + 6] = 0;
+	ptr[OFF_UDP + 7] = 0;
+	ptr[OFF_IP + 4]  = ip_sequence >> 8;
+	ptr[OFF_IP + 5]  = ip_sequence;
+	ptr[OFF_IP + 10] = 0;
+	ptr[OFF_IP + 11] = 0;
+	ip_sequence ++;
+
+	cksum = checksum (ptr + OFF_IP + 12, 8, 0x11 + size);
+	cksum = ~checksum (ptr + OFF_UDP, size, cksum);
+	if (cksum == 0)
+		cksum = -1;
+	ptr[OFF_UDP + 6] = cksum >> 8;
+	ptr[OFF_UDP + 7] = cksum;
+
+	cksum = ~checksum (ptr + OFF_IP, SIZE_IP, 0);
+	if (cksum == 0)
+		cksum = -1;
+	ptr[OFF_IP + 10] = cksum >> 8;
+	ptr[OFF_IP + 11] = cksum;
+
+	if (size < 32)
+		size = 32;
+	return ether_snd (ptr, size + OFF_UDP);
+}
+
+/* handle broadcast packets. For arp requests */
+int do_bcast( unsigned char *ptr, unsigned int size )
+{
+	struct ether_hdr *ether = (struct ether_hdr*)ptr;
+
+	/* check whether or not ARP proto */
+	if ( ether->proto != HTON(0x0806) )
+		return 0;		/* not ARP */
+
+	/* ok, its an arp. handle it. */
+	return do_arp_reply( ptr, size );
+}
+
+int ipbits_rcv (unsigned char *ptr, unsigned int size, unsigned int *dsz, int sport, int dport)
+{
+	unsigned int cksum, hdrlen, off_udp;
+	u8 bcast[6] = { [0 ... 5] 0xff };
+
+	size = ether_rcv(ptr, size);
+	if (!size)
+		return 0;
+
+	if (size < MIN_UDPPKTSIZE)	/* must be at least this size for UDP */
+		return 0;
+
+	if (memeq (ptr + OFF_ETHER, bcast, 6)) {
+		return do_bcast( ptr, size );
+	}
+
+	if (!memeq (ptr + OFF_ETHER, hwaddress, 6))
+		return 0;		/* not for us */
+
+	if (((ptr[OFF_ETHER + 12] << 8) | ptr[OFF_ETHER + 13]) != 0x800)
+		return 0;		/* not IP */
+
+	hdrlen = (ptr[OFF_IP] - 0x40) * 4;
+	if (hdrlen < 20 || hdrlen > 60)
+		return 0;		/* not an IP packet we know about */
+
+	cksum = checksum (ptr + OFF_IP, hdrlen, 0);
+	if (cksum != 0xffff)
+		return 0;		/* bad ip header checksum */
+
+	if (ptr[OFF_IP + 9] != 0x11)
+		return 0;		/* not UDP */
+
+	off_udp = OFF_IP + hdrlen;
+	hdrlen = (ptr[off_udp + 4] << 8) | ptr[off_udp + 5];
+
+	if ((ptr[off_udp + 6] | ptr[off_udp + 7]) != 0) {
+		cksum = checksum (ptr + OFF_IP + 12, 8, 0x11 + hdrlen);
+		cksum = checksum (ptr + off_udp, hdrlen, cksum);
+		if (cksum != 0xffff)
+			return 0;	/* bad udp checksum */
+	}
+
+	if (sport != -1 && sport != ((ptr[off_udp] << 8) | ptr[off_udp + 1]))
+		return 0;
+	if (((ptr[off_udp + 2] << 8) | ptr[off_udp + 3]) != dport)
+		return 0;		/* wrong UDP ports */
+	*dsz = hdrlen - SIZE_UDP;
+	return off_udp + SIZE_UDP;
+}
Index: build_tree/bootLoader/src/lib/led-mmap.c
diff -u /dev/null build_tree/bootLoader/src/lib/led-mmap.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/led-mmap.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,92 @@
+/*
+ * led_mmap.c: simple memory mapped LED control functions
+ * 
+ * Copyright (C) 2002, 2003 by SOMA Networks Inc.
+ *
+ * $Id: led-mmap.c,v 1.1 2003/02/13 01:10:53 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+/* AER Lets make this do nothing
+
+#ident "$Id: led-mmap.c,v 1.1 2003/02/13 01:10:53 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/led.h>
+#include <blob/init.h>
+
+static int led_state;
+static int led_locked;
+
+static void mmap_led_on(void)
+{
+	volatile u16 *ledp;
+
+	if(led_locked)
+		return;
+
+	ledp = (volatile u16 *)LED_ADDR;
+	*ledp = LED_ON;
+
+	led_state = 1;
+}
+
+static void mmap_led_off(void)
+{
+	volatile u16 *ledp;
+
+	if(led_locked)
+		return;
+
+	ledp = (volatile u16 *)LED_ADDR;
+	*ledp = LED_OFF;
+
+	led_state = 0;
+}
+
+static void mmap_led_toggle(void)
+{
+	if(led_state)
+		mmap_led_off();
+	else
+		mmap_led_on();
+
+	return;
+}
+
+static void mmap_led_lock(void)
+{
+	led_locked = 1;
+}
+
+static void mmap_led_unlock(void)
+{
+	led_locked = 0;
+}
+
+led_driver_t mmap_led_driver = {
+	led_on: 	mmap_led_on,
+	led_off:	mmap_led_off,
+	led_toggle:	mmap_led_toggle,
+	led_lock:  	mmap_led_lock,
+	led_unlock:	mmap_led_unlock,
+};
+*/
\ No newline at end of file
Index: build_tree/bootLoader/src/lib/led.c
diff -u build_tree/bootLoader/src/lib/led.c:1.1.1.1 build_tree/bootLoader/src/lib/led.c:1.1.1.2
--- build_tree/bootLoader/src/lib/led.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/led.c	Fri Nov  9 09:44:05 2007
@@ -1,17 +1,9 @@
-/*-------------------------------------------------------------------------
- * Filename:      led.c
- * Version:       $Id: led.c,v 1.5 2001/10/15 21:27:05 erikm Exp $
- * Copyright:     Copyright (C) 1999, Erik Mouw
- * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- * Description:   
- * Created at:    Mon Aug 16 15:39:12 1999
- * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- * Modified at:   Mon Aug 16 16:55:21 1999
- *-----------------------------------------------------------------------*/
 /*
  * led.c: simple LED control functions
  *
- * Copyright (C) 1999 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2002, 2003 by SOMA Networks Inc.
+ *
+ * $Id: led.c,v 1.9 2003/08/06 22:55:41 abz Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -28,84 +20,65 @@
  * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
  *
  */
-/*
- * All functions assume that the LED is properly initialised by the code
- * in ledasm.S.
- *
- */
 
-#ident "$Id: led.c,v 1.5 2001/10/15 21:27:05 erikm Exp $"
+#ident "$Id: led.c,v 1.9 2003/08/06 22:55:41 abz Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
-#endif
+#endif 
 
-#include <blob/arch.h>
+#include <blob/debug.h>
 #include <blob/led.h>
-#include <blob/sa1100.h>
-#include <blob/init.h>
-
-
-
-static int led_state;
-static int led_locked;
-
-
+#include <blob/types.h>
 
+led_driver_t *led_driver;
 
 void led_init(void)
 {
-	led_unlock();
-	led_on();
-}
-
-
-
-
-void led_on(void)
-{
-	if(led_locked)
+	if (led_driver == NULL){
+		deprintf("No LED driver defined in arch specific file\n");
 		return;
+	}
 
-	GPSR = LED_GPIO;
-	led_state = 1;
+    led_driver->led_unlock();
+    led_driver->led_on();
 }
 
-
-
-
-void led_off(void)
+int led_on(void)
 {
-	if(led_locked)
-		return;
+	if (led_driver == NULL){
+		deprintf("No LED driver defined in arch specific file\n");
+		return -1;
+	}
+
+    led_driver->led_on();
 
-	GPCR = LED_GPIO;
-	led_state = 0;
+	return 0;
 }
 
+int led_off(void)
+{
+	if (led_driver == NULL){
+		deprintf("No LED driver defined in arch specific file\n");
+		return -1;
+	}
 
+    led_driver->led_off();
 
+	return 0;
+}
 
 void led_toggle(void)
 {
-	if(led_state)
-		led_off();
-	else
-		led_on();
+    led_driver->led_toggle();
 }
 
-
-
-
 void led_lock(void)
 {
-	led_locked = 1;
+    led_driver->led_lock();
 }
 
-
-
-
 void led_unlock(void)
 {
-	led_locked = 0;
+    led_driver->led_unlock();
 }
Index: build_tree/bootLoader/src/lib/md5.c
diff -u build_tree/bootLoader/src/lib/md5.c:1.1.1.1 build_tree/bootLoader/src/lib/md5.c:1.1.1.2
--- build_tree/bootLoader/src/lib/md5.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/md5.c	Fri Nov  9 09:44:05 2007
@@ -1,5 +1,5 @@
 /* Taken from textutils-2.0 -ch */
-/* $Id: md5.c,v 1.1 2002/01/06 18:59:40 erikm Exp $ */
+/* $Id: md5.c,v 1.2 2002/04/27 11:17:42 timriker Exp $ */
 
 /* md5.c - Functions to compute MD5 message digest of files or memory blocks
    according to the definition of MD5 in RFC 1321 from April 1992.
@@ -24,7 +24,7 @@
 /* Written by Ulrich Drepper <drepper@gnu.ai.mit.edu>, 1995.  */
 
 #ifdef HAVE_CONFIG_H
-# include <config.h>
+# include <blob/config.h>
 #endif
 
 #include <blob/md5.h>
Index: build_tree/bootLoader/src/lib/md5support.c
diff -u build_tree/bootLoader/src/lib/md5support.c:1.1.1.1 build_tree/bootLoader/src/lib/md5support.c:1.1.1.2
--- build_tree/bootLoader/src/lib/md5support.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/md5support.c	Fri Nov  9 09:44:05 2007
@@ -5,7 +5,7 @@
  * Written by Christopher Hoover <ch@hpl.hp.com>
  * Minor modifications by Erik Mouw
  *
- * $Id: md5support.c,v 1.1 2002/01/06 18:59:40 erikm Exp $
+ * $Id: md5support.c,v 1.3 2002/04/29 18:08:33 choover Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -23,7 +23,7 @@
  *
  */
 
-#ident "$Id: md5support.c,v 1.1 2002/01/06 18:59:40 erikm Exp $"
+#ident "$Id: md5support.c,v 1.3 2002/04/29 18:08:33 choover Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -32,7 +32,7 @@
 #include <blob/md5support.h>
 #include <blob/serial.h>
 #include <blob/types.h>
-
+#include <blob/util.h>
 
 
 
@@ -53,7 +53,7 @@
 		else
 			c += '0';
 
-		serial_write(c);
+		printf("%c",c);
 		
 		c = d[i] & 0x0f;
 		if(c > 9)
@@ -61,7 +61,7 @@
 		else
 			c += '0';
 
-		serial_write(c);
+		printf("%c",c);
 	}
 
 	return i;
Index: build_tree/bootLoader/src/lib/memcmp.c
diff -u /dev/null build_tree/bootLoader/src/lib/memcmp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/memcmp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,49 @@
+/*
+ * memcmp.c:  compare two memory regions. From linux/lib/string.c
+ *
+ * Copyright (C) 1991, 1992  Linus Torvalds
+ * Copyright (C) 2003  Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * $Id: memcmp.c,v 1.1 2003/03/17 14:57:25 seletz Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: memcmp.c,v 1.1 2003/03/17 14:57:25 seletz Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/util.h>
+#include <blob/types.h>
+
+/**
+ * memcmp - Compare two areas of memory
+ * @cs: One area of memory
+ * @ct: Another area of memory
+ * @count: The size of the area.
+ */
+int memcmp(const void * cs,const void * ct,size_t count)
+{
+	const unsigned char *su1, *su2;
+	int res = 0;
+
+	for( su1 = cs, su2 = ct; 0 < count; ++su1, ++su2, count--)
+		if ((res = *su1 - *su2) != 0)
+			break;
+	return res;
+}
Index: build_tree/bootLoader/src/lib/memset.c
diff -u /dev/null build_tree/bootLoader/src/lib/memset.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/memset.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,43 @@
+/*
+ * memset.c:  fill memory with a constant byte
+ *
+ * Copyright (C) 2002  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: memset.c,v 1.1 2002/02/15 23:08:20 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: memset.c,v 1.1 2002/02/15 23:08:20 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/util.h>
+#include <blob/types.h>
+
+
+
+void *memset(void *dest, int c, size_t n)
+{
+	u8 *tmp = (u8 *)dest;
+
+	while(n-- > 0)
+		*tmp++ = (u8)c;
+
+	return dest;
+}
Index: build_tree/bootLoader/src/lib/mini_inflate.c
diff -u /dev/null build_tree/bootLoader/src/lib/mini_inflate.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/mini_inflate.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,442 @@
+/*-------------------------------------------------------------------------
+ * Filename:      mini_inflate.c
+ * Version:       $Id: mini_inflate.c,v 1.2 2002/04/26 07:01:05 russd Exp $
+ * Copyright:     Copyright (C) 2001, Russ Dill
+ * Author:        Russ Dill <Russ.Dill@asu.edu>
+ * Description:   Mini inflate implementation (RFC 1951)
+ *-----------------------------------------------------------------------*/
+/*
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+#ident "$Id: mini_inflate.c,v 1.2 2002/04/26 07:01:05 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/mini_inflate.h>
+#include <blob/util.h>
+
+
+
+#define NO_ERROR 0
+#define COMP_UNKNOWN 1	 /* The specififed bytype is invalid */
+#define CODE_NOT_FOUND 2 /* a huffman code in the stream could not be decoded */
+#define TOO_MANY_BITS 3	 /* pull_bits was passed an argument that is too 
+			  * large */ 
+
+/* This struct represents an entire huffman code set. It has various lookup
+ * tables to speed decoding */
+struct huffman_set {
+	int bits;	 /* maximum bit length */
+	int num_symbols; /* Number of symbols this code can represent */
+	int *lengths;	 /* The bit length of symbols */
+	int *symbols;	 /* All of the symbols, sorted by the huffman code */
+	int *count;	 /* the number of codes of this bit length */
+	int *first;	 /* the first code of this bit length */
+	int *pos;	 /* the symbol that first represents (in the symbols
+			  * array) */
+};
+
+struct bitstream {
+	unsigned char *data; /* increments as we move from byte to byte */
+	unsigned char bit;   /* 0 to 7 */
+	unsigned long decoded; /* The number of bytes decoded */
+	int error;
+
+	int  distance_count[16];
+	int  distance_first[16];
+	int  distance_pos[16];
+	int  distance_lengths[32];
+	int  distance_symbols[32];
+
+	int  code_count[8];
+	int  code_first[8];
+	int  code_pos[8];
+	int  code_lengths[19];
+	int  code_symbols[19];
+	
+	int  length_count[16];
+	int  length_first[16];
+	int  length_pos[16];
+	int  length_lengths[288];
+	int  length_symbols[288];
+	
+	struct huffman_set codes;
+	struct huffman_set lengths;
+	struct huffman_set distance;
+};
+	
+#define NO_COMP 0
+#define FIXED_COMP 1
+#define DYNAMIC_COMP 2
+
+
+
+
+/* The order that the code lengths in section 3.2.7 are in */
+static unsigned char huffman_order[] = {16, 17, 18,  0,  8,  7,  9,  6, 10,  5,
+					11,  4, 12,  3, 13,  2, 14,  1, 15};
+
+
+static void int_memset(int *s, const int c, long n)
+{
+	n--;
+	for (;n > 0; n--) s[n] = c;
+	s[0] = c;
+}
+
+
+/* associate a stream with a block of data and reset the stream */
+static void init_stream(struct bitstream *stream, unsigned char *data)
+{
+	stream->error = NO_ERROR;
+	stream->decoded = 0;
+	stream->data = data;
+	stream->bit = 0;	/* The first bit of the stream is the lsb of the
+				 * first byte */
+
+	/* really sorry about all this initialization, think of a better way,
+	 * let me know and it will get cleaned up */
+	stream->codes.bits = 8;
+	stream->codes.num_symbols = 19;
+	stream->codes.lengths = stream->code_lengths;
+	stream->codes.symbols = stream->code_symbols;
+	stream->codes.count = stream->code_count;
+	stream->codes.first = stream->code_first;
+	stream->codes.pos = stream->code_pos;
+
+	stream->lengths.bits = 16;
+	stream->lengths.num_symbols = 288;
+	stream->lengths.lengths = stream->length_lengths;
+	stream->lengths.symbols = stream->length_symbols;
+	stream->lengths.count = stream->length_count;
+	stream->lengths.first = stream->length_first;
+	stream->lengths.pos = stream->length_pos;
+
+	stream->distance.bits = 16;
+	stream->distance.num_symbols = 32;
+	stream->distance.lengths = stream->distance_lengths;
+	stream->distance.symbols = stream->distance_symbols;
+	stream->distance.count = stream->distance_count;
+	stream->distance.first = stream->distance_first;
+	stream->distance.pos = stream->distance_pos;
+
+}
+
+/* pull 'bits' bits out of the stream. The last bit pulled it returned as the
+ * msb. (section 3.1.1)
+ */
+static unsigned long pull_bits(struct bitstream *stream, 
+			       const unsigned int bits)
+{
+	unsigned long ret;
+	int i;
+
+	ret = 0;
+	for (i = 0; i < bits; i++) {
+		ret += ((*(stream->data) >> stream->bit) & 1) << i;
+
+		/* if, before incrementing, we are on bit 7, 
+		 * go to the lsb of the next byte */
+		if (stream->bit++ == 7) {
+			stream->bit = 0;
+			stream->data++;
+		}
+	}
+	return ret;
+}
+
+static int pull_bit(struct bitstream *stream)
+{
+	int ret = ((*(stream->data) >> stream->bit) & 1);
+	if (stream->bit++ == 7) {
+		stream->bit = 0;
+		stream->data++;
+	}
+	return ret;
+}
+
+/* discard bits up to the next whole byte */
+static void discard_bits(struct bitstream *stream)
+{
+	if (stream->bit != 0) {
+		stream->bit = 0;
+		stream->data++;
+	}
+}
+
+/* No decompression, the data is all literals (section 3.2.4) */
+static void decompress_none(struct bitstream *stream, unsigned char *dest)
+{
+	unsigned int length;
+
+	discard_bits(stream);
+	length = *(stream->data++);
+	length += *(stream->data++) << 8;
+	pull_bits(stream, 16);	/* throw away the inverse of the size */
+
+	stream->decoded += length;
+	memcpy(dest, stream->data, length);
+	stream->data += length;
+}
+
+/* Read in a symbol from the stream (section 3.2.2) */
+static int read_symbol(struct bitstream *stream, struct huffman_set *set)
+{
+	int bits = 0;
+	int code = 0;
+	while (!(set->count[bits] && code < set->first[bits] + 
+					     set->count[bits])) {
+		code = (code << 1) + pull_bit(stream);
+		if (++bits > set->bits) {
+			/* error decoding (corrupted data?) */
+			stream->error = CODE_NOT_FOUND;
+			return -1;
+		}
+	}
+	return set->symbols[set->pos[bits] + code - set->first[bits]];
+}
+
+/* decompress a stream of data encoded with the passed length and distance
+ * huffman codes */
+static void decompress_huffman(struct bitstream *stream, unsigned char *dest)
+{
+	struct huffman_set *lengths = &(stream->lengths);
+	struct huffman_set *distance = &(stream->distance);
+
+	int symbol, length, dist, i;
+
+	do {
+		if ((symbol = read_symbol(stream, lengths)) < 0) return;
+		if (symbol < 256) {
+			*(dest++) = symbol; /* symbol is a literal */
+			stream->decoded++;
+		} else if (symbol > 256) {
+			/* Determine the length of the repitition 
+			 * (section 3.2.5) */
+			if (symbol < 265) length = symbol - 254;
+			else if (symbol == 285) length = 258;
+			else {
+				length = pull_bits(stream, (symbol - 261) >> 2);
+				length += (4 << ((symbol - 261) >> 2)) + 3;
+				length += ((symbol - 1) % 4) << 
+					  ((symbol - 261) >> 2);
+			}
+
+			/* Determine how far back to go */
+			if ((symbol = read_symbol(stream, distance)) < 0) 
+				return;
+			if (symbol < 4) dist = symbol + 1;
+			else {
+				dist = pull_bits(stream, (symbol - 2) >> 1);
+				dist += (2 << ((symbol - 2) >> 1)) + 1;
+				dist += (symbol % 2) << ((symbol - 2) >> 1);
+			}
+			stream->decoded += length;
+			for (i = 0; i < length; i++) *(dest++) = dest[-dist];
+		}
+	} while (symbol != 256); /* 256 is the end of the data block */
+}
+
+/* Fill the lookup tables (section 3.2.2) */
+static void fill_code_tables(struct huffman_set *set)
+{
+	int code = 0, i, length;
+
+	/* fill in the first code of each bit length, and the pos pointer */
+	set->pos[0] = 0;
+	for (i = 1; i < set->bits; i++) {
+		code = (code + set->count[i - 1]) << 1;
+		set->first[i] = code;
+		set->pos[i] = set->pos[i - 1] + set->count[i - 1];
+	}
+
+	/* Fill in the table of symbols in order of their huffman code */
+	for (i = 0; i < set->num_symbols; i++) {
+		if ((length = set->lengths[i]))
+			set->symbols[set->pos[length]++] = i;
+	}
+
+	/* reset the pos pointer */
+	for (i = 1; i < set->bits; i++) set->pos[i] -= set->count[i];
+}
+
+static void init_code_tables(struct huffman_set *set)
+{
+	int_memset(set->lengths, 0, set->num_symbols);
+	int_memset(set->count, 0, set->bits);
+	int_memset(set->first, 0, set->bits);
+}
+
+/* read in the huffman codes for dynamic decoding (section 3.2.7) */
+static void decompress_dynamic(struct bitstream *stream, unsigned char *dest)
+{
+	/* I tried my best to minimize the memory footprint here, while still
+	 * keeping up performance. I really dislike the _lengths[] tables, but
+	 * I see no way of eliminating them without a sizable performance
+	 * impact. The first struct table keeps track of stats on each bit
+	 * length. The _length table keeps a record of the bit length of each
+	 * symbol. The _symbols table is for looking up symbols by the huffman
+	 * code (the pos element points to the first place in the symbol table
+	 * where that bit length occurs). I also hate the initization of these
+	 * structs, if someone knows how to compact these, lemme know. */
+
+	struct huffman_set *codes = &(stream->codes);
+	struct huffman_set *lengths = &(stream->lengths);
+	struct huffman_set *distance = &(stream->distance);
+
+	int hlit = pull_bits(stream, 5) + 257;
+	int hdist = pull_bits(stream, 5) + 1;
+	int hclen = pull_bits(stream, 4) + 4;
+	int length, curr_code, symbol, i, last_code;
+
+	last_code = 0;
+
+	init_code_tables(codes);
+	init_code_tables(lengths);
+	init_code_tables(distance);
+
+	/* fill in the count of each bit length' as well as the lengths 
+	 * table */
+	for (i = 0; i < hclen; i++) {
+		length = pull_bits(stream, 3);
+		codes->lengths[huffman_order[i]] = length; 
+		if (length) codes->count[length]++;
+
+	}
+	fill_code_tables(codes);
+
+	/* Do the same for the length codes, being carefull of wrap through
+	 * to the distance table */
+	curr_code = 0;
+	while (curr_code < hlit) {
+		if ((symbol = read_symbol(stream, codes)) < 0) return;
+		if (symbol == 0) {
+			curr_code++;
+			last_code = 0;
+		} else if (symbol < 16) { /* Literal length */
+			lengths->lengths[curr_code] =  last_code = symbol;
+			lengths->count[symbol]++;
+			curr_code++;
+		} else if (symbol == 16) { /* repeat the last symbol 3 - 6
+					    * times */
+			length = 3 + pull_bits(stream, 2);
+			for (;length; length--, curr_code++)
+				if (curr_code < hlit) {
+					lengths->lengths[curr_code] = 
+						last_code;
+					lengths->count[last_code]++;
+				} else { /* wrap to the distance table */
+					distance->lengths[curr_code - hlit] =
+						last_code;
+					distance->count[last_code]++;
+				}
+		} else if (symbol == 17) { /* repeat a bit length 0 */
+			curr_code += 3 + pull_bits(stream, 3);
+			last_code = 0;
+		} else { /* same, but more times */
+			curr_code += 11 + pull_bits(stream, 7);
+			last_code = 0;
+		}
+	}
+	fill_code_tables(lengths);
+
+	/* Fill the distance table, don't need to worry about wrapthrough
+	 * here */
+	curr_code -= hlit;
+	while (curr_code < hdist) {
+		if ((symbol = read_symbol(stream, codes)) < 0) return;
+		if (symbol == 0) {
+			curr_code++;
+			last_code = 0;
+		} else if (symbol < 16) {
+			distance->lengths[curr_code] = last_code = symbol;
+			distance->count[symbol]++;
+			curr_code++;
+		} else if (symbol == 16) {
+			length = 3 + pull_bits(stream, 2);
+			for (;length; length--, curr_code++) {
+				distance->lengths[curr_code] =
+					last_code;
+				distance->count[last_code]++;
+			}
+		} else if (symbol == 17) {
+			curr_code += 3 + pull_bits(stream, 3);
+			last_code = 0;
+		} else {
+			curr_code += 11 + pull_bits(stream, 7);
+			last_code = 0;
+		}
+	}
+	fill_code_tables(distance);
+
+	decompress_huffman(stream, dest);
+}
+
+/* fill in the length and distance huffman codes for fixed encoding 
+ * (section 3.2.6) */
+static void decompress_fixed(struct bitstream *stream, unsigned char *dest)
+{
+	/* let gcc fill in the initial values */
+	struct huffman_set *lengths = &(stream->lengths);
+	struct huffman_set *distance = &(stream->distance);
+
+	int_memset(lengths->count, 0, 16);
+	int_memset(lengths->first, 0, 16);
+	int_memset(lengths->lengths, 8, 144);
+	int_memset(lengths->lengths + 144, 9, 112);
+	int_memset(lengths->lengths + 256, 7, 24);
+	int_memset(lengths->lengths + 280, 8, 8);
+	lengths->count[7] = 24;
+	lengths->count[8] = 152;
+	lengths->count[9] = 112;
+
+	int_memset(distance->count, 0, 16);
+	int_memset(distance->first, 0, 16);
+	int_memset(distance->lengths, 5, 32);
+	distance->count[5] = 32;
+
+
+	fill_code_tables(lengths);
+	fill_code_tables(distance);
+
+
+	decompress_huffman(stream, dest);
+}
+
+/* returns the number of bytes decoded, < 0 if there was an error. Note that
+ * this function assumes that the block starts on a byte boundry
+ * (non-compliant, but I don't see where this would happen). section 3.2.3 */
+long decompress_block(unsigned char *dest, unsigned char *source)
+{
+	int bfinal, btype;
+	struct bitstream stream;
+
+	init_stream(&stream, source);
+	do {
+		bfinal = pull_bit(&stream);
+		btype = pull_bits(&stream, 2);
+		if (btype == NO_COMP) decompress_none(&stream, dest + stream.decoded);
+		else if (btype == DYNAMIC_COMP) 
+			decompress_dynamic(&stream, dest + stream.decoded);
+		else if (btype == FIXED_COMP) decompress_fixed(&stream, dest + stream.decoded);
+		else stream.error = COMP_UNKNOWN;
+	} while (!bfinal && !stream.error);
+
+	return stream.error ? -stream.error : stream.decoded;
+}
Index: build_tree/bootLoader/src/lib/pcmcia.c
diff -u /dev/null build_tree/bootLoader/src/lib/pcmcia.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pcmcia.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,689 @@
+/**********************************************************************
+ * pcmcia framework
+ *
+ * Provides an raw pcmcia/cf framework for blob. Based on original
+ * work from Brad Parker.
+ *
+ * Copyright (C) 2001, Brad Parker (brad@heeltoe.com)
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: pcmcia.c,v 1.8 2003/08/20 23:12:22 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/time.h>
+#include <blob/serial.h>
+#include <blob/arch.h>
+#include <blob/pcmcia.h>
+
+#ifdef SA1111_BASE
+#include <blob/proc/sa1111.h>
+#endif
+
+/**********************************************************************
+ * Defines / Makros
+ */
+#define WEAK_SYM __attribute__ (( weak ))
+
+#define MEMb(adr)	(*((u8 *)(adr)))
+
+#define PCMCIA_DEBUG 1
+
+#ifdef PCMCIA_DEBUG
+#	define DBG( x, args... )	if ( pcmcia_dbg>x ) printf( args );
+#else
+#	define DBG( x, args... )	
+#endif
+
+/**********************************************************************
+ * types
+ */
+typedef struct {
+	u16				status;
+	int				vcc;
+	int				vpp;
+	u32				attr_base;
+	u32				base;
+	volatile u8	*ident;
+	volatile u8	*feature_p[PCMCIA_MAX_FEATURES];
+	int				n_features;
+	u16				config_base;
+} pcmcia_slot_t;
+
+/**********************************************************************
+ * program globals
+ */
+
+pcmcia_slot_t pcmcia_slots[ PCMCIA_MAX_SLOTS ] = {
+	{
+		status:		0,
+		vcc:		0,
+		vpp:		0,
+		attr_base:	PCMCIA_S0_ATTR_BASE,
+		base:		PCMCIA_S0_BASE,
+	},{
+		status:		0,
+		vcc:		0,
+		vpp:		0,
+		attr_base:	PCMCIA_S1_ATTR_BASE,
+		base:		PCMCIA_S1_BASE,
+	},
+};
+
+
+/**********************************************************************
+ * module globals
+ */
+#ident "$Id: pcmcia.c,v 1.8 2003/08/20 23:12:22 seletz Exp $"
+
+#ifdef	PCMCIA_DEBUG
+static int pcmcia_dbg = 1;
+#else
+static int pcmcia_dbg = 0;
+#endif
+
+/**********************************************************************
+ * prototypes
+ */
+static int pcmcia_print_fixed(volatile u8 *p);
+static int pcmcia_print_funcid(int func);
+
+/**********************************************************************
+ * exported functions
+ */
+
+void pcmcia_dbg_set( int level )
+{
+	pcmcia_dbg = level;
+}
+
+/* do whatever is needed to get pcmcia initialized */
+int WEAK_SYM pcmcia_init()
+{
+	return 0;
+}
+
+/* set pcmcia slot voltage levels */
+int WEAK_SYM pcmcia_voltage_set( int slot, int vcc, int vpp )
+{
+	return 0;
+}
+
+/* detect slot */
+int WEAK_SYM pcmcia_slot_detect( int slot )
+{
+	int	detect = 0;
+#ifdef SA1111_BASE
+	unsigned int flags = PCSR;
+
+	switch ( slot ) {
+		case 0:
+			detect = (flags & PCSR_S0_DETECT) == 0;
+			break;
+		case 1:
+			detect = (flags & PCSR_S1_DETECT) == 0;
+			break;
+		default:
+			detect = -1;
+			goto DONE;
+			break;
+	}
+
+	if ( detect ) {
+		pcmcia_slots[slot].status |= PCMCIA_SS_DETECT;
+	} else {
+		pcmcia_slots[slot].status &= ~PCMCIA_SS_DETECT;
+	}
+
+	DBG( 1, "%s: slot %d status: %x\n", __FUNCTION__, slot, pcmcia_slots[slot].status );
+DONE:
+#else
+#warning "FIXME: non sa1111 systems not yet supported"
+#endif
+	return detect;
+}
+
+/* enable slot */
+int WEAK_SYM pcmcia_slot_enable( int slot )
+{
+	int ret = 0;
+
+#ifdef SA1111_BASE
+	switch ( slot ) {
+		case 0:
+			PCCR = (PCCR & ~PCCR_S0_PSE) | PCCR_S0_FLT | PCCR_S0_PWAITEN;
+			break;
+		case 1:
+			PCCR = (PCCR & ~PCCR_S1_PSE) | PCCR_S1_FLT | PCCR_S1_PWAITEN;
+			break;
+		default:
+			ret = -1;
+			goto DONE;
+			break;
+	}
+
+	pcmcia_slots[slot].status |= PCMCIA_SS_ENABLED;
+
+	DBG( 1, "%s: slot %d status: %x\n", __FUNCTION__, slot, pcmcia_slots[slot].status );
+DONE:
+#else
+#warning "FIXME: non sa1111 systems not yet supported"
+#endif
+	return ret;
+}
+
+/* disable slot */
+int WEAK_SYM pcmcia_slot_disable( int slot )
+{
+	int ret = 0;
+
+#ifdef SA1111_BASE
+	switch ( slot ) {
+		case 0:
+			PCCR = PCCR | PCCR_S0_PSE;
+			break;
+		case 1:
+			PCCR = PCCR | PCCR_S1_PSE;
+			break;
+		default:
+			ret = -1;
+			goto DONE;
+			break;
+	}
+
+	pcmcia_slots[slot].status &= ~PCMCIA_SS_ENABLED;
+
+	DBG( 1, "%s: slot %d status: %x\n", __FUNCTION__, slot, pcmcia_slots[slot].status );
+DONE:
+#else
+#warning "FIXME: non sa1111 systems not yet supported"
+#endif
+	return ret;
+}
+
+/* reset pcmcia slot */
+int WEAK_SYM pcmcia_slot_reset(int slot)
+{
+	int ret = 0;
+
+#ifdef SA1111_BASE
+	switch ( slot ) {
+		case 0:
+			PCCR |= PCCR_S0_RST;
+			msleep(20);
+			PCCR &= ~PCCR_S0_RST;
+			msleep(20);
+			break;
+		case 1:
+			PCCR |= PCCR_S1_RST;
+			msleep(20);
+			PCCR &= ~PCCR_S1_RST;
+			msleep(20);
+			break;
+		default:
+			ret = -1;
+			break;
+	}
+
+	DBG( 1, "%s: slot %d reset\n", __FUNCTION__, slot );
+#else
+#warning "FIXME: non sa1111 systems not yet supported"
+#endif
+	return ret;
+}
+
+/* dump slot HW line stati */
+int pcmcia_dump_stati( void )
+{
+#ifdef SA1111_BASE
+	int status = PCSR;
+
+	printf("s0: ");
+	if (status & PCSR_S0_READY) printf("ready "); else printf("      ");
+	if (status & PCSR_S0_DETECT) printf("detect "); else printf("       ");
+	if (status & PCSR_S0_VS1) printf("vs1 "); else printf("    ");
+	if (status & PCSR_S0_VS2) printf("vs2 "); else printf("    ");
+	if (status & PCSR_S0_WP) printf("wp "); else printf("   ");
+	if (status & PCSR_S0_BVD1) printf("bvd1 "); else printf("     ");
+	if (status & PCSR_S0_BVD2) printf("bvd2 "); else printf("     ");
+	printf(";  ");
+
+	printf("s1: ");
+	if (status & PCSR_S1_READY) printf("ready "); else printf("      ");
+	if (status & PCSR_S1_DETECT) printf("detect "); else printf("       ");
+	if (status & PCSR_S1_VS1) printf("vs1 "); else printf("    ");
+	if (status & PCSR_S1_VS2) printf("vs2 "); else printf("    ");
+	if (status & PCSR_S1_WP) printf("wp "); else printf("   ");
+	if (status & PCSR_S1_BVD1) printf("bvd1 "); else printf("     ");
+	if (status & PCSR_S1_BVD2) printf("bvd2 "); else printf("     ");
+	printf("\n");
+#else
+#warning "FIXME: non sa1111 systems not yet supported"
+#endif
+
+	return 0;
+}
+
+/* identify pcmcia card */
+int pcmcia_identify( volatile unsigned char *p )
+{
+	unsigned char id_str[PCMCIA_MAX_IDENT_CHARS];
+	unsigned char data;
+	unsigned char *t;
+	int i, done;
+
+	if (p == NULL)
+		return (0);     /* Don't know */
+
+	t = id_str;
+	done =0;
+
+	for (i=0; i<=4 && !done; ++i, p+=2) {
+		while ((data = *p) != '\0') {
+			if (data == 0xFF) {
+				done = 1;
+				break;
+			}
+			*t++ = data;
+			if (t == &id_str[PCMCIA_MAX_IDENT_CHARS-1]) {
+				done = 1;
+				break;
+			}
+			p += 2;
+		}
+		if (!done)
+			*t++ = ' ';
+	}
+	*t = '\0';
+	while (--t > id_str) {
+		if (*t == ' ')
+			*t = '\0';
+		else
+			break;
+	}
+	DBG( 1, "%s: id_str='%s'\n", __FUNCTION__, id_str);
+
+	return (1);     /* don't know */
+}
+
+/* parse cis tuples of card in slot <slot> */
+int pcmcia_cis_parse( int slot )
+{
+	int	ret					= 0;
+	void *cfg_mem_addr		= NULL;
+	volatile u8 *ident	= NULL;
+	volatile u8 *p		= NULL;
+	volatile u8 *start	= NULL;
+	int n_features			= 0;
+	u8 func_id			= ~0;
+	u8 len				= 0;
+	u8 code				= 0;
+	u16 config_base			= 0;
+	int found				= 0;
+	int i					= 0;
+	volatile u8 **feature_p;
+
+	/* sanity check */
+	if ( slot < 0 ) {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+	if ( slot > PCMCIA_MAX_SLOTS )  {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	if ( !( pcmcia_slots[slot].status & PCMCIA_SS_ENABLED ) ||
+			!( pcmcia_slots[slot].status & PCMCIA_SS_DETECT )) {
+		printf( "pcmcia: slot %d not detected and enabled\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	cfg_mem_addr = (void *)pcmcia_slots[slot].attr_base;
+	feature_p = pcmcia_slots[slot].feature_p;
+	ident = pcmcia_slots[slot].ident;
+
+
+	DBG( 1, "%s: PCMCIA MEM: %p\n", __FUNCTION__, cfg_mem_addr);
+
+	start = p = (volatile u8 *)cfg_mem_addr;
+
+	while ((p - start) < PCMCIA_MAX_TUPEL_SZ) {
+
+		code = *p; p += 2;
+
+		if (code == 0xFF) { /* End of chain */
+			break;
+		}
+		len = *p; p += 2;
+
+#if PCMCIA_DEBUG
+		if (pcmcia_dbg > 10) {
+			volatile u8 *q = p;
+			printf("\nTuple code %2x  length %d\n\tData:",
+					code, len);
+
+			for (i = 0; i < len; ++i) {
+				printf (" %2x", *q);
+				q+= 2;
+			}
+		}
+#endif
+
+		switch (code) {
+			case CISTPL_VERS_1:
+				ident = p + 4;
+				DBG( 1, "%s: ident=%p\n", __FUNCTION__, ident );
+				break;
+			case CISTPL_FUNCID:
+				func_id = *p;
+				DBG( 1, "%s: func_id=%d\n", __FUNCTION__, func_id );
+				break;
+			case CISTPL_FUNCE:
+				if (n_features < PCMCIA_MAX_FEATURES)
+					feature_p[n_features++] = p;
+				break;
+			case CISTPL_CONFIG:
+				config_base = (*(p+6) << 8) + (*(p+4));
+				pcmcia_slots[slot].config_base = config_base;
+				DBG( 1, "%s: config_base=0x%04x\n", __FUNCTION__, config_base );
+			default:
+				break;
+		}
+		p += 2 * len;
+	}
+
+	found = pcmcia_identify( ident );
+
+	if (func_id != ((u8)~0)) {
+		pcmcia_print_funcid(func_id);
+
+		if (func_id == CISTPL_FUNCID_FIXED)
+			found = 1;
+	}
+
+	if ( found ) {
+		for (i=0; i<n_features; ++i) {
+			pcmcia_print_fixed (feature_p[i]);
+		}
+	}
+
+	ret = 0;
+DONE:
+	return ret;
+}
+
+int pcmcia_slot_address_get( int slot, u32 *base, u32 *attr )
+{
+	int ret = 0;
+
+	/* sanity check */
+	if ( slot < 0 ) {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+	if ( slot > PCMCIA_MAX_SLOTS )  {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	if ( !( pcmcia_slots[slot].status & PCMCIA_SS_ENABLED ) ||
+			!( pcmcia_slots[slot].status & PCMCIA_SS_DETECT )) {
+		printf( "pcmcia: slot %d not detected and enabled\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	DBG( 1, "%s: base=%p\n", __FUNCTION__, (void *)pcmcia_slots[slot].base);
+	DBG( 1, "%s: attr_base=%p\n", __FUNCTION__, (void *)pcmcia_slots[slot].attr_base);
+
+	if ( base )	*base = pcmcia_slots[slot].base;
+	if ( attr )	*attr = pcmcia_slots[slot].attr_base;
+
+	ret = 0;
+DONE:
+	return ret;
+}
+
+int pcmcia_slot_cfg_reg_get( int slot, u16 *cfg_base )
+{
+	int ret = 0;
+
+	/* sanity check */
+	if ( slot < 0 ) {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+	if ( slot > PCMCIA_MAX_SLOTS )  {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	if ( !( pcmcia_slots[slot].status & PCMCIA_SS_ENABLED ) ||
+			!( pcmcia_slots[slot].status & PCMCIA_SS_DETECT )) {
+		printf( "pcmcia: slot %d not detected and enabled\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	DBG( 1, "%s: cfg_base=0x%03x\n", __FUNCTION__, pcmcia_slots[slot].config_base);
+
+	if ( cfg_base )	*cfg_base = pcmcia_slots[slot].config_base;
+
+	ret = 0;
+DONE:
+	return ret;
+}
+
+int pcmcia_slot_attr_read( int slot, u16 offset, u8 *value )
+{
+	int ret = 0;
+
+	/* sanity check */
+	if ( slot < 0 ) {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+	if ( slot > PCMCIA_MAX_SLOTS )  {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+	if ( !value ) {
+		printf( "pcmcia: value==NULL\n" );
+		ret = -1;
+		goto DONE;
+	}
+
+	if ( !( pcmcia_slots[slot].status & PCMCIA_SS_ENABLED ) ||
+			!( pcmcia_slots[slot].status & PCMCIA_SS_DETECT )) {
+		printf( "pcmcia: slot %d not detected and enabled\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	*value = MEMb(
+			pcmcia_slots[slot].attr_base +
+			pcmcia_slots[slot].config_base +
+			offset
+			);
+
+	DBG( 1, "%s: ATTR_REG(0x%02x) => 0x%02x\n", __FUNCTION__,
+			offset, *value );
+
+	ret = 0;
+DONE:
+	return ret;
+}
+
+int pcmcia_slot_attr_write( int slot, u16 offset, u8 value )
+{
+	int ret = 0;
+
+	/* sanity check */
+	if ( slot < 0 ) {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+	if ( slot > PCMCIA_MAX_SLOTS )  {
+		printf( "pcmcia: invalid slot slot %d\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	if ( !( pcmcia_slots[slot].status & PCMCIA_SS_ENABLED ) ||
+			!( pcmcia_slots[slot].status & PCMCIA_SS_DETECT )) {
+		printf( "pcmcia: slot %d not detected and enabled\n", slot );
+		ret = -1;
+		goto DONE;
+	}
+
+	DBG( 1, "%s: ATTR_REG(0x%02x) <= 0x%02x\n", __FUNCTION__,
+			offset, value );
+
+	MEMb( pcmcia_slots[slot].attr_base +
+			pcmcia_slots[slot].config_base +
+			offset
+			) = value;
+
+	ret = 0;
+DONE:
+	return ret;
+}
+
+/**********************************************************************
+ * static functions
+ */
+
+/* print function id strings */
+static int pcmcia_print_funcid(int func)
+{
+	printf("\t     ");
+	switch (func) {
+		case CISTPL_FUNCID_MULTI:
+			printf("Multi-Function");
+			break;
+		case CISTPL_FUNCID_MEMORY:
+			printf("Memory");
+			break;
+		case CISTPL_FUNCID_SERIAL:
+			printf("Serial Port");
+			break;
+		case CISTPL_FUNCID_PARALLEL:
+			printf("Parallel Port");
+			break;
+		case CISTPL_FUNCID_FIXED:
+			printf("Fixed Disk");
+			break;
+		case CISTPL_FUNCID_VIDEO:
+			printf("Video Adapter");
+			break;
+		case CISTPL_FUNCID_NETWORK:
+			printf("Network Adapter");
+			break;
+		case CISTPL_FUNCID_AIMS:
+			printf("AIMS Card");
+			break;
+		case CISTPL_FUNCID_SCSI:
+			printf("SCSI Adapter");
+			break;
+		default:
+			printf("Unknown");
+			break;
+	}
+	printf(" Card\n");
+
+	return 0;
+}
+
+/* print info for FIXED_DISK function type card */
+static int pcmcia_print_fixed(volatile u8 *p)
+{
+	if (p == NULL)
+		return -1;
+
+	printf("\t    ");
+
+	switch (*p) {
+		case CISTPL_FUNCE_IDE_IFACE:
+			{   u8 iface = *(p+2);
+
+				printf((iface == CISTPL_IDE_INTERFACE) ? " IDE" : " unknown");
+				printf(" interface ");
+				break;
+			}
+		case CISTPL_FUNCE_IDE_MASTER:
+		case CISTPL_FUNCE_IDE_SLAVE:
+			{   u8 f1 = *(p+2);
+				u8 f2 = *(p+4);
+
+				printf((f1 & CISTPL_IDE_SILICON) ? " [silicon]" : " [rotating]");
+
+				if (f1 & CISTPL_IDE_UNIQUE)
+					printf(" [unique]");
+
+				printf((f1 & CISTPL_IDE_DUAL) ? " [dual]" : " [single]");
+
+				if (f2 & CISTPL_IDE_HAS_SLEEP)
+					printf(" [sleep]");
+
+				if (f2 & CISTPL_IDE_HAS_STANDBY)
+					printf(" [standby]");
+
+				if (f2 & CISTPL_IDE_HAS_IDLE)
+					printf(" [idle]");
+
+				if (f2 & CISTPL_IDE_LOW_POWER)
+					printf(" [low power]");
+
+				if (f2 & CISTPL_IDE_REG_INHIBIT)
+					printf(" [reg inhibit]");
+
+				if (f2 & CISTPL_IDE_HAS_INDEX)
+					printf(" [index]");
+
+				if (f2 & CISTPL_IDE_IOIS16)
+					printf(" [IOis16]");
+
+				break;
+			}
+	}
+	printf("\n");
+
+	return 0;
+}
+
Index: build_tree/bootLoader/src/lib/printf.c
diff -u /dev/null build_tree/bootLoader/src/lib/printf.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/printf.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,480 @@
+/*
+ * printf.c: printf implementation
+ *
+ * $Id: printf.c,v 1.1 2002/02/08 12:49:03 erikm Exp $
+ *
+ *  Copyright (C) 1991, 1992  Linus Torvalds
+ *
+ * vsprintf.c -- Lars Wirzenius & Linus Torvalds.
+ *
+ * Wirzenius wrote this portably, Torvalds fucked it up :-)
+ * 
+ * Fri Jul 13 2001 Crutcher Dunnavant <crutcher+kernel@datastacks.com>
+ * - changed to provide snprintf and vsnprintf functions
+ *
+ * Taken from linux-2.4.17-rmk3 by Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ *
+ * Note that this code is licensed under GPLv2 only! -- Erik
+ *
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: printf.c,v 1.1 2002/02/08 12:49:03 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/util.h>
+#include <blob/serial.h>
+#include <asm/div64.h>
+#include <stdarg.h>
+
+#define do_div(n,base)                             \
+({                                                 \
+ int __res;                                        \
+ __res = ((unsigned long)n) % (unsigned int)base;  \
+ n = ((unsigned long)n) / (unsigned int)base;      \
+ __res;                                            \
+})
+
+
+
+#define ZEROPAD	1		/* pad with zero */
+#define SIGN	2		/* unsigned/signed long */
+#define PLUS	4		/* show plus */
+#define SPACE	8		/* space if plus */
+#define LEFT	16		/* left justified */
+#define SPECIAL	32		/* 0x */
+#define LARGE	64		/* use 'ABCDEF' instead of 'abcdef' */
+
+
+
+
+static inline int isdigit(char digit)
+{
+	if (digit >= '0' && digit <= '9' )
+		return 1;
+	else
+		return 0;
+}
+
+
+
+
+static inline int strnlen(const char *s, size_t maxlen)
+{
+	int len;
+
+	len = strlen(s);
+
+	if(len > maxlen)
+		return maxlen;
+	else
+		return len;
+}
+
+
+
+
+static int skip_atoi(const char **s)
+{
+	int i=0;
+
+	while (isdigit(**s))
+		i = i*10 + *((*s)++) - '0';
+	return i;
+}
+
+
+
+
+static char * number(char * buf, char * end, long long num, int base, int size, int precision, int type)
+{
+	char c,sign,tmp[66];
+	const char *digits;
+	const char small_digits[] = "0123456789abcdefghijklmnopqrstuvwxyz";
+	const char large_digits[] = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";
+	int i;
+
+	digits = (type & LARGE) ? large_digits : small_digits;
+	if (type & LEFT)
+		type &= ~ZEROPAD;
+	if (base < 2 || base > 36)
+		return 0;
+	c = (type & ZEROPAD) ? '0' : ' ';
+	sign = 0;
+	if (type & SIGN) {
+		if (num < 0) {
+			sign = '-';
+			num = -num;
+			size--;
+		} else if (type & PLUS) {
+			sign = '+';
+			size--;
+		} else if (type & SPACE) {
+			sign = ' ';
+			size--;
+		}
+	}
+	if (type & SPECIAL) {
+		if (base == 16)
+			size -= 2;
+		else if (base == 8)
+			size--;
+	}
+	i = 0;
+	if (num == 0)
+		tmp[i++]='0';
+	else while (num != 0)
+		tmp[i++] = digits[do_div(num,base)];
+	if (i > precision)
+		precision = i;
+	size -= precision;
+	if (!(type&(ZEROPAD+LEFT))) {
+		while(size-->0) {
+			if (buf <= end)
+				*buf = ' ';
+			++buf;
+		}
+	}
+	if (sign) {
+		if (buf <= end)
+			*buf = sign;
+		++buf;
+	}
+	if (type & SPECIAL) {
+		if (base==8) {
+			if (buf <= end)
+				*buf = '0';
+			++buf;
+		} else if (base==16) {
+			if (buf <= end)
+				*buf = '0';
+			++buf;
+			if (buf <= end)
+				*buf = digits[33];
+			++buf;
+		}
+	}
+	if (!(type & LEFT)) {
+		while (size-- > 0) {
+			if (buf <= end)
+				*buf = c;
+			++buf;
+		}
+	}
+	while (i < precision--) {
+		if (buf <= end)
+			*buf = '0';
+		++buf;
+	}
+	while (i-- > 0) {
+		if (buf <= end)
+			*buf = tmp[i];
+		++buf;
+	}
+	while (size-- > 0) {
+		if (buf <= end)
+			*buf = ' ';
+		++buf;
+	}
+	return buf;
+}
+
+
+
+
+/**
+* vsnprintf - Format a string and place it in a buffer
+* @buf: The buffer to place the result into
+* @size: The size of the buffer, including the trailing null space
+* @fmt: The format string to use
+* @args: Arguments for the format string
+*
+* Call this function if you are already dealing with a va_list.
+* You probably want snprintf instead.
+ */
+static int vsnprintf(char *buf, size_t size, const char *fmt, va_list args)
+{
+	int len;
+	unsigned long long num;
+	int i, base;
+	char *str, *end, c;
+	const char *s;
+
+	int flags;		/* flags to number() */
+
+	int field_width;	/* width of output field */
+	int precision;		/* min. # of digits for integers; max
+				   number of chars for from string */
+	int qualifier;		/* 'h', 'l', or 'L' for integer fields */
+				/* 'z' support added 23/7/1999 S.H.    */
+				/* 'z' changed to 'Z' --davidm 1/25/99 */
+
+	str = buf;
+	end = buf + size - 1;
+
+	if (end < buf - 1) {
+		end = ((void *) -1);
+		size = end - buf + 1;
+	}
+
+	for (; *fmt ; ++fmt) {
+		if (*fmt != '%') {
+			if (str <= end)
+				*str = *fmt;
+			++str;
+			continue;
+		}
+
+		/* process flags */
+		flags = 0;
+		repeat:
+			++fmt;		/* this also skips first '%' */
+			switch (*fmt) {
+				case '-': flags |= LEFT; goto repeat;
+				case '+': flags |= PLUS; goto repeat;
+				case ' ': flags |= SPACE; goto repeat;
+				case '#': flags |= SPECIAL; goto repeat;
+				case '0': flags |= ZEROPAD; goto repeat;
+			}
+
+		/* get field width */
+		field_width = -1;
+		if (isdigit(*fmt))
+			field_width = skip_atoi(&fmt);
+		else if (*fmt == '*') {
+			++fmt;
+			/* it's the next argument */
+			field_width = va_arg(args, int);
+			if (field_width < 0) {
+				field_width = -field_width;
+				flags |= LEFT;
+			}
+		}
+
+		/* get the precision */
+		precision = -1;
+		if (*fmt == '.') {
+			++fmt;	
+			if (isdigit(*fmt))
+				precision = skip_atoi(&fmt);
+			else if (*fmt == '*') {
+				++fmt;
+				/* it's the next argument */
+				precision = va_arg(args, int);
+			}
+			if (precision < 0)
+				precision = 0;
+		}
+
+		/* get the conversion qualifier */
+		qualifier = -1;
+		if (*fmt == 'h' || *fmt == 'l' || *fmt == 'L' || *fmt =='Z') {
+			qualifier = *fmt;
+			++fmt;
+			if (qualifier == 'l' && *fmt == 'l') {
+				qualifier = 'L';
+				++fmt;
+			}
+		}
+
+		/* default base */
+		base = 10;
+
+		switch (*fmt) {
+			case 'c':
+				if (!(flags & LEFT)) {
+					while (--field_width > 0) {
+						if (str <= end)
+							*str = ' ';
+						++str;
+					}
+				}
+				c = (unsigned char) va_arg(args, int);
+				if (str <= end)
+					*str = c;
+				++str;
+				while (--field_width > 0) {
+					if (str <= end)
+						*str = ' ';
+					++str;
+				}
+				continue;
+
+			case 's':
+				s = va_arg(args, char *);
+				if (!s)
+					s = "<NULL>";
+
+				len = strnlen(s, precision);
+
+				if (!(flags & LEFT)) {
+					while (len < field_width--) {
+						if (str <= end)
+							*str = ' ';
+						++str;
+					}
+				}
+				for (i = 0; i < len; ++i) {
+					if (str <= end)
+						*str = *s;
+					++str; ++s;
+				}
+				while (len < field_width--) {
+					if (str <= end)
+						*str = ' ';
+					++str;
+				}
+				continue;
+
+			case 'p':
+				if (field_width == -1) {
+					field_width = 2*sizeof(void *);
+					flags |= ZEROPAD;
+				}
+				str = number(str, end,
+						(unsigned long) va_arg(args, void *),
+						16, field_width, precision, flags);
+				continue;
+
+
+			case 'n':
+				/* FIXME:
+				* What does C99 say about the overflow case here? */
+				if (qualifier == 'l') {
+					long * ip = va_arg(args, long *);
+					*ip = (str - buf);
+				} else if (qualifier == 'Z') {
+					size_t * ip = va_arg(args, size_t *);
+					*ip = (str - buf);
+				} else {
+					int * ip = va_arg(args, int *);
+					*ip = (str - buf);
+				}
+				continue;
+
+			case '%':
+				if (str <= end)
+					*str = '%';
+				++str;
+				continue;
+
+				/* integer number formats - set up the flags and "break" */
+			case 'o':
+				base = 8;
+				break;
+
+			case 'X':
+				flags |= LARGE;
+			case 'x':
+				base = 16;
+				break;
+
+			case 'd':
+			case 'i':
+				flags |= SIGN;
+			case 'u':
+				break;
+
+			default:
+				if (str <= end)
+					*str = '%';
+				++str;
+				if (*fmt) {
+					if (str <= end)
+						*str = *fmt;
+					++str;
+				} else {
+					--fmt;
+				}
+				continue;
+		}
+		if (qualifier == 'L')
+			num = va_arg(args, long long);
+		else if (qualifier == 'l') {
+			num = va_arg(args, unsigned long);
+			if (flags & SIGN)
+				num = (signed long) num;
+		} else if (qualifier == 'Z') {
+			num = va_arg(args, size_t);
+		} else if (qualifier == 'h') {
+			num = (unsigned short) va_arg(args, int);
+			if (flags & SIGN)
+				num = (signed short) num;
+		} else {
+			num = va_arg(args, unsigned int);
+			if (flags & SIGN)
+				num = (signed int) num;
+		}
+		str = number(str, end, num, base,
+				field_width, precision, flags);
+	}
+	if (str <= end)
+		*str = '\0';
+	else if (size > 0)
+		/* don't write out a null byte if the buf size is zero */
+		*end = '\0';
+	/* the trailing null byte doesn't count towards the total
+	* ++str;
+	*/
+	return str-buf;
+}
+
+
+
+
+/**
+ * snprintf - Format a string and place it in a buffer
+ * @buf: The buffer to place the result into
+ * @size: The size of the buffer, including the trailing null space
+ * @fmt: The format string to use
+ * @...: Arguments for the format string
+ */
+int snprintf(char * buf, size_t size, const char *fmt, ...)
+{
+	va_list args;
+	int i;
+
+	va_start(args, fmt);
+	i=vsnprintf(buf,size,fmt,args);
+	va_end(args);
+	return i;
+}
+
+
+
+#define PRINTF_BUFFER_LENGTH 1024
+static char printf_buffer[PRINTF_BUFFER_LENGTH];
+
+
+
+
+int printf(const char *fmt, ...)
+{
+	va_list args;
+	int i;
+
+	va_start(args, fmt);
+	i = vsnprintf(printf_buffer, PRINTF_BUFFER_LENGTH, fmt, args);
+	va_end(args);
+
+	SerialOutputString(printf_buffer);
+
+	return i;
+}
Index: build_tree/bootLoader/src/lib/pxa-bb-spi.c
diff -u /dev/null build_tree/bootLoader/src/lib/pxa-bb-spi.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa-bb-spi.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,157 @@
+/*
+ * reboot-pxa.c: Reboot PXA 250 board
+ *
+ * Copyright (C) 2003  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: reboot-pxa.c,v 1.1 2003/01/04 02:11:43 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: reboot-pxa.c,v 1.1 2003/01/04 02:11:43 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/proc/pxa.h>
+#include <blob/arch/pxa-regs.h>
+
+static void SPI_SetCsLow()
+{
+	// GPIO 88
+	GPCR2 = (1 << 24);
+}
+
+static void SPI_SetCsHigh()
+{
+	// GPIO 88
+	GPSR2 = (1 << 24);
+}
+
+static void SPI_SetSckLow()
+{
+	// GPIO 22
+	GPCR0 = (1 << 22);
+}
+
+static void SPI_SetSckHigh()
+{
+	// GPIO 22
+	GPSR0 = (1 << 22);
+}
+
+static void SPI_SetMosiLow()
+{
+	// GPIO 13
+	GPCR0 = (1 << 13);
+}
+
+static void SPI_SetMosiHigh()
+{
+	// GPIO 13
+	GPSR0 = (1 << 13);
+}
+
+static int SPI_IsMisoHigh()
+{
+	// GPIO 40
+	if(GPLR1 & (1 << 8))
+	{
+		return 1;
+	}
+	else
+	{
+		return 0;
+	}
+}
+
+void Micro_Delay(unsigned long ulMicrosecs)
+{
+	// 1us = 3.25 ticks, so 4 us = 13 ticks
+	unsigned long ulStart = OSCR;
+	unsigned long ulTicks = (ulMicrosecs * 4 / 13) + 1;
+	while(OSCR < (ulStart + ulTicks));
+}
+
+static void WriteBit(unsigned char * pOutputData, unsigned long ulByteOffset, unsigned long ulWriteBitPosition)
+{
+	if(pOutputData)
+	{
+		if( pOutputData[ ulByteOffset ] & ( 1 << ulWriteBitPosition ) )
+		{
+			SPI_SetMosiHigh();
+		}
+		else
+		{
+			SPI_SetMosiLow();
+		}
+	}
+}
+
+static void ReadBit(unsigned char * pInputData, unsigned long ulByteOffset, unsigned long ulReadBitPosition)
+{
+	if( pInputData )
+	{
+		if( SPI_IsMisoHigh() )
+		{
+			pInputData[ ulByteOffset ] |= ( 1 << ulReadBitPosition );
+		}
+		else
+		{
+			pInputData[ ulByteOffset ] &= ~( 1 << ulReadBitPosition );
+		}
+	}
+}
+
+int GpioSPITransferData( unsigned char * pOutputData, unsigned char * pInputData, unsigned long ulNumberOfBytesToTransfer, unsigned long ulDelayInMicroseconds )
+{
+	if( ulNumberOfBytesToTransfer == 0 ) 
+	{
+		return 0;
+	}
+
+	SPI_SetCsLow();
+	Micro_Delay( 10 );
+
+	unsigned long i;
+	for( i = 0; i < ( ulNumberOfBytesToTransfer * 8 ); i++ )
+	{
+		Micro_Delay( ulDelayInMicroseconds );
+		SPI_SetSckLow();
+
+		unsigned long ulByteOffset =  (i / 8);
+		unsigned long ulBitPosition = ( 7 - ( i % 8 ) );	// MSB first
+
+		Micro_Delay( ulDelayInMicroseconds );
+		WriteBit(pOutputData, ulByteOffset, ulBitPosition ); // Write out MSB first
+		
+		Micro_Delay( ulDelayInMicroseconds );
+		SPI_SetSckHigh();
+		
+		ReadBit(pInputData, ulByteOffset, ulBitPosition ); // Read in MSB first
+	}
+
+	Micro_Delay( 50 );
+	SPI_SetCsHigh();
+	SPI_SetMosiHigh();
+	Micro_Delay( 50 );
+
+	return 1;
+}
Index: build_tree/bootLoader/src/lib/pxa-lcd.c
diff -u /dev/null build_tree/bootLoader/src/lib/pxa-lcd.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa-lcd.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,425 @@
+/**********************************************************************
+ * pxa-lcd.c
+ *
+ * pxa lcd framework
+ *
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ */
+
+/**********************************************************************
+ * includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+#include <blob/serial.h>
+#include <blob/arch.h>
+
+#include <blob/pxa-lcd.h>
+
+extern int GpioSPITransferData( unsigned char * pOutputData, unsigned char * pInputData, unsigned long ulNumberOfBytesToTransfer, unsigned long ulDelayInMicroseconds );
+extern void Micro_Delay(unsigned long ulMicrosecs);
+
+/**********************************************************************
+ * defines
+ */
+#define WEAK_SYM __attribute__ (( weak ))
+
+#define MEM(adr)		(*((u32 *)adr))
+#define SET(reg,bit)	((reg) |= (1<<(bit)))
+#define CLR(reg,bit)	((reg) &= ~(1<<(bit)))
+
+#define LCD_DEBUG 1
+
+#define OUTHEX( val ) SerialOutputString( #val"=0x" ); \
+	SerialOutputHex( val ); \
+	serial_write( '\n' );
+
+#ifdef MINIPRINT
+# define LCD_GRADIENT
+#endif
+
+/**********************************************************************
+ * program globals
+ */
+
+/**********************************************************************
+ * module globals
+ */
+
+u16 *lcd_palette = (u16*)(LCD_PALETTE_DMA_ADR);
+u32 *lcd_vram = (u32*)(LCD_VIDEORAM_START);
+
+/**********************************************************************
+ * Prototypes
+ */
+void lcd_palette_set( int no, int val );
+
+/**********************************************************************/
+/**********************************************************************/
+/**********************************************************************/
+
+/**********************************************************************
+ * Do whatever necessary to power up lcd display
+ */
+typedef struct 
+{
+	unsigned char ucReg;
+	unsigned short usValue;
+	unsigned long ulMsDelayAfter;
+} regWrite;
+
+regWrite dispPowerOn[] =
+{
+	{ 0x07, 0x0000, 0 },
+	{ 0x13, 0x0000, 10 },
+
+	{ 0x11, 0x3004, 0 },
+	{ 0x14, 0x200F, 0 },
+	{ 0x10, 0x1a20, 0 },
+	{ 0x13, 0x0040, 50 },
+
+	{ 0x13, 0x0060, 0 },
+	{ 0x13, 0x0070, 200 },
+
+	{ 0x01, 0x0127, 0 },
+	{ 0x02,	0x0700, 0 },
+	{ 0x03, 0x1030, 0 },
+	{ 0x08, 0x0208, 0 },
+	{ 0x0B, 0x0620, 0 },
+	{ 0x0C, 0x0110, 0 },
+	{ 0x30, 0x0120, 0 },
+	{ 0x31, 0x0127, 0 },
+	{ 0x32, 0x0000, 0 },
+	{ 0x33, 0x0503, 0 },
+	{ 0x34, 0x0727, 0 },
+	{ 0x35, 0x0124, 0 },
+	{ 0x36, 0x0706, 0 },
+	{ 0x37, 0x0701, 0 },
+	{ 0x38, 0x0F00, 0 },
+	{ 0x39, 0x0F00, 0 },
+	{ 0x40, 0x0000, 0 },
+	{ 0x41, 0x0000, 0 },
+	{ 0x42, 0x013f, 0 },
+	{ 0x43, 0x0000, 0 },
+	{ 0x44, 0x013f, 0 },
+	{ 0x45, 0x0000, 0 },
+	{ 0x46, 0xef00, 0 },
+	{ 0x47, 0x013f, 0 },
+	{ 0x48, 0x0000, 0 },
+	{ 0x07, 0x0015, 30 },
+
+	{ 0x07, 0x0017, 00 },
+
+	{ 0x20, 0x0000, 00 },
+	{ 0x21, 0x0000, 00 },
+	{ 0x22, 0x0000, 00 }
+};
+
+int lcd_init(void)
+{
+	SerialOutputString( "LCD: init ..." );
+
+	lcd_power_up();
+//	lcd_backlight_on();
+}
+int WEAK_SYM lcd_power_up( void )
+{
+    unsigned char			wr_buf[3];
+    const unsigned long		ulDELAY_IN_MICROSECONDS = 10;
+
+	// Reset the LCD first
+	//LCD_RST gpio 19
+	GPSR0 = (1 << 19);
+	Micro_Delay(100 * 1000);
+	GPCR0 = (1 << 19);
+	Micro_Delay(20 * 1000);
+	GPSR0 = (1 << 19);
+	Micro_Delay(20 * 1000);
+
+//	if(CAerBoardIo::instance()->GetBoardRevNumber() == 0)
+	{
+		int i;
+		for(i = 0; i < sizeof(dispPowerOn) / sizeof(regWrite); i++)
+		{
+			// send Address
+			wr_buf[0]  = 0x74;  
+			wr_buf[1]  = 0x00;  
+			wr_buf[2]  = dispPowerOn[i].ucReg;
+			GpioSPITransferData( wr_buf, 0, 3, ulDELAY_IN_MICROSECONDS );
+
+			//	send Data
+			wr_buf[0]  = 0x76;  
+			wr_buf[1]  = dispPowerOn[i].usValue >> 8;  
+			wr_buf[2]  = dispPowerOn[i].usValue & 0xFF;
+			GpioSPITransferData( wr_buf, 0, 3, ulDELAY_IN_MICROSECONDS );
+
+			if(dispPowerOn[i].ulMsDelayAfter)
+			{
+				Micro_Delay(dispPowerOn[i].ulMsDelayAfter * 1000);	
+			}
+		}
+	}
+	return 0;
+}
+
+int WEAK_SYM lcd_power_down( void )
+{
+	return 0;
+}
+
+int WEAK_SYM lcd_gpio_setup( void )
+{
+//	GPDR |= 0x3FC;
+//	GAFR |= 0x3FC;
+
+	return 0;
+}
+
+int WEAK_SYM lcd_controller_setup( void )
+{
+#if 0
+	lcd_palette[0] &= 0xcfff;
+	lcd_palette[0] |= 2<<16;	// 8 bpp
+
+	/* Sequence from 11.7.10 */
+	LCCR3 = LCD_LCCR3;
+	LCCR2 = LCD_LCCR2;
+	LCCR1 = LCD_LCCR1;
+	LCCR0 = LCD_LCCR0 & ~LCCR0_LEN;
+	DBAR1 = (u32)LCD_PALETTE_DMA_ADR;
+	DBAR2 = (u32)LCD_VIDEORAM_DMA_ADR;
+#endif
+	return 0;
+}
+
+int WEAK_SYM lcd_controller_enable( void )
+{
+//	LCCR0 |= LCCR0_LEN;
+	return 0;
+}
+
+int WEAK_SYM lcd_controller_disable( void )
+{
+//	LCCR0 &= ~LCCR0_LEN;
+	return 0;
+}
+
+int WEAK_SYM lcd_backlight_on( void )
+{
+//	GPSR0 = (1 << 11);
+	return 0;
+}
+
+int WEAK_SYM lcd_backlight_off( void )
+{
+	return 0;
+}
+
+int WEAK_SYM lcd_palette_setup( void )
+{
+	unsigned int n;
+
+#ifdef LCD_GRADIENT
+	for ( n = 0 ; n < 256 ; n++ ) {
+		lcd_palette_set(n, 0x1000+(n<<4) );
+	}
+#else
+	for ( n = 0 ; n < 128 ; n++ ) {
+		lcd_palette_set(n, 0x1FFF );
+	}
+	for ( n = 128 ; n < 256 ; n++ ) {
+		lcd_palette_set(n, 0x1000 );
+	}
+#endif
+	return 0;
+}
+
+int WEAK_SYM lcd_contrast( int value )
+{
+	return 0;
+}
+
+int WEAK_SYM lcd_brightness( int value )
+{
+	return 0;
+}
+
+int WEAK_SYM lcd_fill (int color)
+{
+  int i = 0;
+
+  if (color>0xFF)return -EINVAL;
+
+  color += (color<<8) + (color<<16) + (color<<24);
+  for(; i<(LCD_COLS*LCD_ROWS/4);i++)
+    lcd_vram[i] = color;
+
+  return 0;
+}
+
+int WEAK_SYM lcd_set_pixel (unsigned int x, unsigned int y, unsigned int color)
+{
+
+#ifdef LCD_REVERSE
+  x = LCD_COLS - 1 - x;
+  y = LCD_ROWS - 1 - y;
+#endif
+
+  if ((color>0xFF)||(y>=LCD_ROWS)||(x>=LCD_COLS))  return -EINVAL;
+
+  switch(x%4)
+  {
+    case 0:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0xFFFFFF00)|color;
+	  break;
+    case 1:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0xFFFF00FF)|(color<<8);
+	  break;
+    case 2:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0xFF00FFFF)|(color<<16);
+	  break;
+    case 3:
+      lcd_vram[(x>>2)+y*(LCD_COLS>>2)] =
+        (lcd_vram[(x>>2)+((y*LCD_COLS)>>2)]&0x00FFFFFF)|(color<<24);
+	  break;
+  }
+
+  return 0;
+}
+
+/**********************************************************************
+ * Statische Funktionen
+ */
+
+
+static int lcd_test( int argc, char *argv[] )
+{
+	int ret = 0;
+	int x,y;
+	int c;
+
+#if LCD_DEBUG
+	OUTHEX( LCD_LCCR0 );
+	OUTHEX( LCD_LCCR1 );
+	OUTHEX( LCD_LCCR2 );
+	OUTHEX( LCD_LCCR3 );
+	OUTHEX( LCD_BPP );
+	OUTHEX( LCD_COLS );
+	OUTHEX( LCD_ROWS );
+	OUTHEX( LCD_PALETTE_ENTRIES );
+	OUTHEX( LCD_PALETTE_SIZE );
+	OUTHEX( LCD_RAM_BASE );
+	OUTHEX( LCD_VIDEORAM_SIZE );
+	OUTHEX( LCD_VIDEORAM_START );
+	OUTHEX( LCD_VIDEORAM_END );
+	OUTHEX( LCD_VIDEORAM_DMA_ADR );
+	OUTHEX( LCD_PALETTE_DMA_ADR );
+#endif
+
+	SerialOutputString( "LCD: power up ..." );
+	ret = lcd_power_up();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: gpio setup ..." );
+	ret = lcd_gpio_setup();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: controller setup ..." );
+	ret = lcd_controller_setup();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: palette setup ..." );
+	ret = lcd_palette_setup();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: controller enable ..." );
+	ret = lcd_controller_enable();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: backlight on ..." );
+	ret = lcd_backlight_on();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+#ifdef LCD_GRADIENT
+	/* Gradient (bastel-code weil fixe aufloesung) */
+	SerialOutputString( "LCD: Gradient test pattern ..." );
+	lcd_fill(0x00);
+        for ( y=0; y<240; y++ )
+          	for ( x=0; x<320; x++ )
+           		lcd_set_pixel(x,y,(x/20)+((y/15)*16));
+#else
+	/* vertical lines */
+	SerialOutputString( "LCD: vertical lines test pattern ..." );
+	for ( y=0; y<LCD_ROWS; y++ ) {
+		for ( x=0; x<(LCD_COLS>>2); x++ ) {
+			if ( x%2 == 0 ) {
+				lcd_vram[y*(LCD_COLS>>2) + x ] = 0xffffffff;
+			} else {
+				lcd_vram[y*(LCD_COLS>>2) + x ] = 0x00000000;
+			}
+		}
+	}
+#endif
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: press any key to proceed\n" );
+	c = serial_read();
+
+	SerialOutputString( "LCD: backlight off ..." );
+	ret = lcd_backlight_off();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: controller disable ..." );
+	ret = lcd_controller_disable();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	SerialOutputString( "LCD: power down ..." );
+	ret = lcd_power_down();
+	if ( ret != 0 )		return ret;
+	SerialOutputString( "done\n" );
+
+	return 0;
+}
+
+static char testlcdhelp[] = "lcdtest\nTests lcd display\n";
+__commandlist(lcd_test, "lcdtest", testlcdhelp);
+
+void lcd_palette_set( int no, int val )
+{
+	if ( no < 0 || no > 255 )
+		return;
+
+	lcd_palette[ no ] = val;
+
+	return;
+}
Index: build_tree/bootLoader/src/lib/pxa_usb.h
diff -u /dev/null build_tree/bootLoader/src/lib/pxa_usb.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa_usb.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,245 @@
+/*
+ * pxa_usb.h
+ *
+ * Public interface to the pxa USB core. For use by client modules
+ * like usb-eth and usb-char.
+ *
+ * 02-May-2002
+ *   Frank Becker (Intrinsyc) - derived from sa1100_usb.h
+ *
+ */
+
+#ifndef _PXA_USB_H
+#define _PXA_USB_H
+#include <asm/byteorder.h>
+
+#define MAX_CONFIGS	3
+#define MAX_INTERFACES	2
+#define MAX_ENDPOINTS	4
+
+typedef void (*usb_callback_t)(int flag, int size);
+
+/* in usb_ctl.c (see also descriptor methods at bottom of file) */
+
+// Open the USB client for client and initialize data structures
+// to default values, but _do not_ start UDC.
+int pxa_usb_open( const char * client_name );
+
+// Start UDC running
+int pxa_usb_start( void );
+
+// Immediately stop udc, fire off completion routines w/-EINTR
+int pxa_usb_stop( void ) ;
+
+// Disconnect client from usb core
+int pxa_usb_close( void ) ;
+
+// set notify callback for when core reaches configured state
+// return previous pointer (if any)
+typedef void (*usb_notify_t)(void);
+usb_notify_t pxa_set_configured_callback( usb_notify_t callback );
+
+/* in usb_send.c */
+int pxa_usb_xmitter_avail( void );
+int pxa_usb_send(char *buf, int len, usb_callback_t callback);
+void sa110a_usb_send_reset(void);
+
+/* in usb_recev.c */
+int pxa_usb_recv(char *buf, int len, usb_callback_t callback);
+void pxa_usb_recv_reset(void);
+
+//////////////////////////////////////////////////////////////////////////////
+// Descriptor Management
+//////////////////////////////////////////////////////////////////////////////
+
+#define DescriptorHeader \
+	__u8 bLength;        \
+	__u8 bDescriptorType
+
+
+// --- Device Descriptor -------------------
+
+typedef struct {
+	 DescriptorHeader;
+	 __u16 bcdUSB;		   	/* USB specification revision number in BCD */
+	 __u8  bDeviceClass;	/* USB class for entire device */
+	 __u8  bDeviceSubClass; /* USB subclass information for entire device */
+	 __u8  bDeviceProtocol; /* USB protocol information for entire device */
+	 __u8  bMaxPacketSize0; /* Max packet size for endpoint zero */
+	 __u16 idVendor;        /* USB vendor ID */
+	 __u16 idProduct;       /* USB product ID */
+	 __u16 bcdDevice;       /* vendor assigned device release number */
+	 __u8  iManufacturer;	/* index of manufacturer string */
+	 __u8  iProduct;        /* index of string that describes product */
+	 __u8  iSerialNumber;	/* index of string containing device serial number */
+	 __u8  bNumConfigurations; /* number fo configurations */
+} __attribute__ ((packed)) device_desc_t;
+
+// --- Configuration Descriptor ------------
+
+typedef struct {
+	 DescriptorHeader;
+	 __u16 wTotalLength;	    /* total # of bytes returned in the cfg buf 4 this cfg */
+	 __u8  bNumInterfaces;      /* number of interfaces in this cfg */
+	 __u8  bConfigurationValue; /* used to uniquely ID this cfg */
+	 __u8  iConfiguration;      /* index of string describing configuration */
+	 __u8  bmAttributes;        /* bitmap of attributes for ths cfg */
+	 __u8  MaxPower;		    /* power draw in 2ma units */
+} __attribute__ ((packed)) config_desc_t;
+
+// bmAttributes:
+enum { 
+	USB_CONFIG_REMOTEWAKE=0xA0, 
+	USB_CONFIG_SELFPOWERED=0xC0,
+	USB_CONFIG_BUSPOWERED=0x80 
+};
+
+// MaxPower:
+#define USB_POWER( x)  ((x)>>1) /* convert mA to descriptor units of A for MaxPower */
+
+// --- Interface Descriptor ---------------
+
+typedef struct {
+	 DescriptorHeader;
+	 __u8  bInterfaceNumber;   /* Index uniquely identfying this interface */
+	 __u8  bAlternateSetting;  /* ids an alternate setting for this interface */
+	 __u8  bNumEndpoints;      /* number of endpoints in this interface */
+	 __u8  bInterfaceClass;    /* USB class info applying to this interface */
+	 __u8  bInterfaceSubClass; /* USB subclass info applying to this interface */
+	 __u8  bInterfaceProtocol; /* USB protocol info applying to this interface */
+	 __u8  iInterface;         /* index of string describing interface */
+} __attribute__ ((packed)) intf_desc_t;
+
+// --- Endpoint  Descriptor ---------------
+
+typedef struct {
+	 DescriptorHeader;
+	 __u8  bEndpointAddress;  /* 0..3 ep num, bit 7: 0 = 0ut 1= in */
+	 __u8  bmAttributes;      /* 0..1 = 0: ctrl, 1: isoc, 2: bulk 3: intr */
+	 __u16 wMaxPacketSize;    /* data payload size for this ep in this cfg */
+	 __u8  bInterval;         /* polling interval for this ep in this cfg */
+} __attribute__ ((packed)) ep_desc_t;
+
+// bEndpointAddress:
+enum { 
+	USB_OUT	=0, 
+	USB_IN	=1 
+};
+
+#define USB_EP_ADDRESS(a,d) (((a)&0xf) | ((d) << 7))
+// bmAttributes:
+enum { 
+	USB_EP_CNTRL	=0, 
+	USB_EP_BULK	=2, 
+	USB_EP_INT	=3, 
+	USB_EP_ISO	=4 
+};
+
+// --- String Descriptor -------------------
+
+typedef struct {
+	 DescriptorHeader;
+	 __u16 bString[1];		  /* unicode string .. actaully 'n' __u16s */
+} __attribute__ ((packed)) string_desc_t;
+
+/*=======================================================
+ * Handy helpers when working with above
+ *
+ */
+// these are x86-style 16 bit "words" ...
+#define make_word_c( w ) __constant_cpu_to_le16(w)
+#define make_word( w )   __cpu_to_le16(w)
+
+// descriptor types
+enum { 
+    USB_DESC_DEVICE	= 1,
+    USB_DESC_CONFIG	= 2,
+    USB_DESC_STRING	= 3,
+    USB_DESC_INTERFACE	= 4,
+    USB_DESC_ENDPOINT	= 5
+};
+
+
+/*=======================================================
+ * Default descriptor layout for SA-1100 and SA-1110 UDC
+ */
+
+enum {
+  UNUSED = 0,
+
+  BULK_IN1  =  1,
+  BULK_OUT1 =  2,
+  ISO_IN1   =  3,
+  ISO_OUT1  =  4,
+  INT_IN1   =  5,
+
+  BULK_IN2  =  6,
+  BULK_OUT2 =  7,
+  ISO_IN2   =  8,
+  ISO_OUT2  =  9,
+  INT_IN2   = 10,
+
+  BULK_IN3  = 11,
+  BULK_OUT3 = 12,
+  ISO_IN3   = 13,
+  ISO_OUT3  = 14,
+  INT_IN3   = 15
+} /*endpoint_type*/;
+
+/* "config descriptor buffer" - that is, one config,
+   ..one interface and 2 endpoints */
+//struct cdb {
+//	 config_desc_t cfg;
+//	 intf_desc_t   intf;
+//	 ep_desc_t     ep1;
+//	 ep_desc_t     ep2;
+//} __attribute__ ((packed));
+
+/* all SA device descriptors */
+//typedef struct {
+//	 device_desc_t dev;   /* device descriptor */
+//	 struct cdb b;        /* bundle of descriptors for this cfg */
+//} __attribute__ ((packed)) desc_t;
+
+
+typedef struct {
+	device_desc_t 	dev;	/* device descriptor */	
+	char		cdb[1024]; /* FIXME */
+} desc_t;
+
+/*=======================================================
+ * Descriptor API
+ */
+
+/* Get the address of the statically allocated desc_t structure
+   in the usb core driver. Clients can modify this between
+   the time they call pxa_usb_open() and pxa_usb_start()
+*/
+desc_t *
+pxa_usb_get_descriptor_ptr( void );
+
+/* Set a pointer to the string descriptor at "index". The driver
+ ..has room for 8 string indicies internally. Index zero holds
+ ..a LANGID code and is set to US English by default. Inidices
+ ..1-7 are available for use in the config descriptors as client's
+ ..see fit. This pointer is assumed to be good as long as the
+ ..SA usb core is open (so statically allocate them). Returnes -EINVAL
+ ..if index out of range */
+int pxa_usb_set_string_descriptor( int index, string_desc_t * p );
+
+/* reverse of above */
+string_desc_t *
+pxa_usb_get_string_descriptor( int index );
+
+config_desc_t * 
+pxa_usb_get_config(int cfgval);
+
+intf_desc_t *
+pxa_usb_get_intf(config_desc_t *cfg, int idx);
+
+ep_desc_t * 
+pxa_usb_get_endpoint(intf_desc_t *intf, int idx);
+
+
+
+#endif /* _PXA_USB_H */
Index: build_tree/bootLoader/src/lib/pxa_usb_ctl.c
diff -u /dev/null build_tree/bootLoader/src/lib/pxa_usb_ctl.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa_usb_ctl.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,627 @@
+/*
+ *  Copyright (C) Compaq Computer Corporation, 1998, 1999
+ *  Copyright (C) Extenex Corporation, 2001
+ *  Copyright (C) Intrinsyc, Inc., 2002
+ *
+ *  PXA USB controller core driver.
+ *
+ *  This file provides interrupt routing and overall coordination
+ *  of the endpoints.
+ *
+ *  Please see:
+ *    linux/Documentation/arm/SA1100/SA1100_USB 
+ *  for more info.
+ *
+ *  02-May-2002
+ *   Frank Becker (Intrinsyc) - derived from sa1100 usb_ctl.c
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+#include <blob/arch.h>
+#include <blob/init.h>
+#include <blob/types.h>
+#include <blob/time.h>
+
+#include "linux/errno.h"
+#include "pxa_usb.h"
+#include "pxa_usb_ctl.h"
+
+#undef DEBUG 
+#if DEBUG
+static unsigned int usb_debug = DEBUG;
+#else
+#define usb_debug 0     /* gcc will remove all the debug code for us */
+#endif
+
+//////////////////////////////////////////////////////////////////////////////
+// Prototypes
+//////////////////////////////////////////////////////////////////////////////
+
+int usbctl_next_state_on_event( int event );
+void udc_int_hndlr(int, void *);
+static void initialize_descriptors( void );
+static void soft_connect_hook( int enable );
+static void udc_disable(void);
+static void udc_enable(void);
+
+#if CONFIG_PROC_FS
+#define PROC_NODE_NAME "driver/pxausb"
+static int usbctl_read_proc(char *page, char **start, off_t off,
+							int count, int *eof, void *data);
+#endif
+
+//////////////////////////////////////////////////////////////////////////////
+// Globals
+//////////////////////////////////////////////////////////////////////////////
+static const char pszMe[] = "usbctl: ";
+struct usb_info_t usbd_info;  /* global to ep0, usb_recv, usb_send */
+
+/* device descriptors */
+static desc_t desc;
+
+#define MAX_STRING_DESC 16
+static string_desc_t * string_desc_array[ MAX_STRING_DESC ];
+static string_desc_t sd_zero;  /* special sd_zero holds language codes */
+
+// called when configured
+static usb_notify_t configured_callback = NULL;
+
+enum {
+    kStateZombie		= 0,
+    kStateZombieSuspend		= 1,
+    kStateDefault		= 2,
+    kStateDefaultSuspend	= 3,
+    kStateAddr			= 4,
+    kStateAddrSuspend		= 5,
+    kStateConfig		= 6,
+    kStateConfigSuspend		= 7
+};
+
+/*
+ * FIXME: The PXA UDC handles several host device requests without user 
+ * notification/intervention. The table could be collapsed quite a bit...
+ */
+static int device_state_machine[8][6] = {
+//              suspend               reset          resume         adddr       config        deconfig
+/* zombie */  { kStateZombieSuspend , kStateDefault, kStateZombie , kError    , kError      , kError },
+/* zom sus */ { kStateZombieSuspend , kStateDefault, kStateZombie , kError    , kError      , kError },
+/* default */ { kStateDefaultSuspend, kStateDefault, kStateDefault, kStateAddr, kStateConfig, kError },
+/* def sus */ { kStateDefaultSuspend, kStateDefault, kStateDefault, kError    , kError      , kError },
+/* addr */    { kStateAddrSuspend   , kStateDefault, kStateAddr   , kError    , kStateConfig, kError },
+/* addr sus */{ kStateAddrSuspend   , kStateDefault, kStateAddr   , kError    , kError      , kError },
+/* config */  { kStateConfigSuspend , kStateDefault, kStateConfig , kError    , kError      , kStateDefault },
+/* cfg sus */ { kStateConfigSuspend , kStateDefault, kStateConfig , kError    , kError      , kError }
+};
+
+/* "device state" is the usb device framework state, as opposed to the
+   "state machine state" which is whatever the driver needs and is much
+   more fine grained
+*/
+static int sm_state_to_device_state[8] = { 
+//  zombie            zom suspend       
+USB_STATE_POWERED, USB_STATE_SUSPENDED, 
+//  default           default sus
+USB_STATE_DEFAULT, USB_STATE_SUSPENDED,
+//  addr              addr sus         
+USB_STATE_ADDRESS, USB_STATE_SUSPENDED, 
+//  config            config sus
+USB_STATE_CONFIGURED, USB_STATE_SUSPENDED
+};
+
+static char * state_names[8] =
+{ "zombie", "zombie suspended", 
+  "default", "default suspended",
+  "address", "address suspended", 
+  "configured", "config suspended"
+};
+
+static char * event_names[6] =
+{ "suspend", "reset", "resume",
+  "address assigned", "configure", "de-configure"
+};
+
+static char * device_state_names[] =
+{ "not attached", "attached", "powered", "default",
+  "address", "configured", "suspended" };
+
+static int sm_state = kStateZombie;
+
+//////////////////////////////////////////////////////////////////////////////
+// Async
+//////////////////////////////////////////////////////////////////////////////
+
+/* The UDCCR reg contains mask and interrupt status bits,
+ * so using '|=' isn't safe as it may ack an interrupt.
+ */
+
+void udc_set_mask_UDCCR( int mask )
+{
+	UDCCR = (UDCCR & UDCCR_MASK_BITS) | (mask & UDCCR_MASK_BITS);
+}
+
+void udc_clear_mask_UDCCR( int mask)
+{
+	UDCCR = (UDCCR & UDCCR_MASK_BITS) & ~(mask & UDCCR_MASK_BITS);
+}
+
+void udc_ack_int_UDCCR( int mask)
+{
+	/* udccr contains the bits we dont want to change */
+	__u32 udccr = UDCCR & UDCCR_MASK_BITS; 
+
+	UDCCR = udccr | (mask & ~UDCCR_MASK_BITS);
+}
+
+void
+udc_int_hndlr(int irq, void *dev_id)
+{
+  	__u32 status = UDCCR;
+  	__u32 ir0_status = USIR0;
+  	__u32 ir1_status = USIR1;
+  	__u32 uicr0 = UICR0;
+  	__u32 uicr1 = UICR1;
+
+	//mask ints
+	udc_set_mask_UDCCR( UDCCR_REM | UDCCR_SRM);
+	UICR0 = 0xff;
+	UICR1 = 0xff;
+
+	if( usb_debug > 2)
+	{
+		printf("%s--- udc_int_hndlr\n"
+		   "UDCCR=0x%08x UDCCS0=0x%08x UDCCS1=0x%08x UDCCS2=0x%08x\n"
+		   "USIR0=0x%08x USIR1=0x%08x UICR0=0x%08x UICR1=0x%08x\n", 
+		    pszMe, status, UDCCS0, UDCCS1, UDCCS2, ir0_status, ir1_status, uicr0, uicr1);
+	}
+
+	/* SUSpend Interrupt Request */
+	if ( status & UDCCR_SUSIR )
+	{
+		udc_ack_int_UDCCR( UDCCR_SUSIR);
+		if (usb_debug) printf("%sSuspend...\n", pszMe);
+		usbctl_next_state_on_event( kEvSuspend );
+	}
+
+	/* RESume Interrupt Request */
+	if ( status & UDCCR_RESIR )
+	{
+		udc_ack_int_UDCCR( UDCCR_RESIR);
+		if( usb_debug) printf("%sResume...\n", pszMe);
+		usbctl_next_state_on_event( kEvResume );
+	}
+
+	/* ReSeT Interrupt Request - UDC has been reset */
+	if ( status & UDCCR_RSTIR )
+	{
+		/* clear the reset interrupt */
+		udc_ack_int_UDCCR( UDCCR_RSTIR);
+
+		/* check type of reset */
+		if( (UDCCR & UDCCR_UDA) == 0)
+		{
+			/* reset assertion took place, nothing to do */
+			if (usb_debug) printf("%sReset assertion...\n", pszMe);
+		}
+
+		/* ok, it's a reset negation, go on with reset */
+		else if ( usbctl_next_state_on_event( kEvReset ) != kError )
+		{
+			/* starting reset sequence now... */
+			if( usb_debug) printf("%sResetting\n", pszMe);
+
+			ep0_reset();
+			ep1_reset();
+			ep2_reset();
+
+			usbctl_next_state_on_event( kEvConfig );
+
+			/* reset driver */
+			usb_driver_reset();
+		}
+		else
+		{
+			printf("%sUnexpected reset\n", pszMe);
+		}
+	}
+	else
+	{
+		/* ep0 int */
+		if (ir0_status & USIR0_IR0) {
+			ep0_int_hndlr();
+		}
+
+		/* transmit bulk */
+		if (ir0_status & USIR0_IR1) {
+			ep1_int_hndlr(ir0_status);
+		}
+
+		/* receive bulk */
+		if ( ir0_status & USIR0_IR2) {
+			ep2_int_hndlr(ir0_status);
+		}
+
+		while (UDCCS2 & UDCCS_BO_RNE) {
+			ep2_int_hndlr(ir0_status);
+		}
+
+	}
+
+	UICR0 = uicr0;
+	UICR1 = uicr1;
+	udc_clear_mask_UDCCR( UDCCR_SRM | UDCCR_REM); /* enable suspend/resume, reset */
+
+	/* clear all endpoint ints */
+	USIR0 |= 0xff;
+	USIR1 |= 0xff;
+
+
+	if( usb_debug > 2)
+		printf("%sudc_int_hndlr\n"
+		       "UDCCR=0x%08x UDCCS0=0x%08x UDCCS1=0x%08x UDCCS2=0x%08x\n"
+		       "USIR0=0x%08x USIR1=0x%08x UICR0=0x%08x UICR1=0x%08x\n", 
+			pszMe, UDCCR, UDCCS0, UDCCS1, UDCCS2, USIR0, USIR1, UICR0, UICR1);
+
+}
+
+//////////////////////////////////////////////////////////////////////////////
+// Public Interface
+//////////////////////////////////////////////////////////////////////////////
+
+/* Open PXA usb core on behalf of a client, but don't start running */
+
+int
+pxa_usb_open( const char * client )
+{
+	usbd_info.client_name = (char*) client;
+	memset(&usbd_info.stats, 0, sizeof(struct usb_stats_t));
+	memset(string_desc_array, 0, sizeof(string_desc_array));
+
+	/* hack to start in zombie suspended state */
+	sm_state = kStateZombieSuspend;
+	usbd_info.state = USB_STATE_SUSPENDED;
+
+	/* create descriptors for enumeration */
+	initialize_descriptors();
+
+	if (usb_debug) printf( "%s%s registered.\n", pszMe, client );
+	return 0;
+}
+
+/* Start running. Must have called usb_open (above) first */
+int
+pxa_usb_start( void )
+{
+	if ( usbd_info.client_name == NULL ) {
+		printf( "%s%s - no client registered\n",
+				pszMe, __FUNCTION__ );
+		return -EPERM;
+	}
+
+	/* start UDC internal machinery running */
+	udc_enable();
+	//udelay( 100 );
+	msleep(1);
+
+	/* flush DMA and fire through some -EAGAINs */
+	//ep2_init( usbd_info.dmach_rx );
+	//ep1_init( usbd_info.dmach_tx );
+
+	/* give endpoint notification we are starting */
+	ep1_state_change_notify( USB_STATE_SUSPENDED );
+	ep2_state_change_notify( USB_STATE_SUSPENDED );
+
+	/* enable any platform specific hardware */
+	soft_connect_hook( 1 );
+
+	/* enable suspend/resume, reset */
+	udc_clear_mask_UDCCR( UDCCR_SRM | UDCCR_REM); 
+	/* enable ep0, ep1, ep2 */
+	UICR0 &= ~(UICR0_IM0 | UICR0_IM1 | UICR0_IM2) ;
+
+	if (usb_debug) printf( "%sStarted %s\n", pszMe, usbd_info.client_name );
+	return 0;
+}
+
+/* Stop USB core from running */
+int
+pxa_usb_stop( void )
+{
+	if ( usbd_info.client_name == NULL ) {
+		printf( "%s%s - no client registered\n",
+				pszMe, __FUNCTION__ );
+		return -EPERM;
+	}
+	/* mask everything */
+	/* disable suspend/resume, reset */
+	udc_set_mask_UDCCR( UDCCR_SRM | UDCCR_REM); 
+	/* disable ep0, ep1, ep2 */
+	UICR0 |= (UICR0_IM0 | UICR0_IM1 | UICR0_IM2) ;
+
+	ep1_reset();
+	ep2_reset();
+
+	udc_disable();
+	if( usb_debug) printf( "%sStopped %s\n", pszMe, usbd_info.client_name );
+	return 0;
+}
+
+/* Tell PXA core client is through using it */
+int
+pxa_usb_close( void )
+{
+	 if ( usbd_info.client_name == NULL ) {
+		   printf( "%s%s - no client registered\n",
+				  pszMe, __FUNCTION__ );
+		  return -EPERM;
+	 }
+	 printf( "%s%s closed.\n", pszMe, (char*)usbd_info.client_name );
+	 usbd_info.client_name = NULL;
+	 return 0;
+}
+
+/* set a proc to be called when device is configured */
+usb_notify_t pxa_set_configured_callback( usb_notify_t func )
+{
+	 usb_notify_t retval = configured_callback;
+	 configured_callback = func;
+	 return retval;
+}
+
+/*====================================================
+ * Descriptor Manipulation.
+ * Use these between open() and start() above to setup
+ * the descriptors for your device.
+ *
+ */
+
+/* get pointer to static default descriptor */
+desc_t *
+pxa_usb_get_descriptor_ptr( void ) { return &desc; }
+
+/* optional: set a string descriptor */
+int
+pxa_usb_set_string_descriptor( int i, string_desc_t * p )
+{
+	 int retval;
+	 if ( i < MAX_STRING_DESC ) {
+		  string_desc_array[i] = p;
+		  retval = 0;
+	 } else {
+		  retval = -EINVAL;
+	 }
+	 return retval;
+}
+
+/* optional: get a previously set string descriptor */
+string_desc_t *
+pxa_usb_get_string_descriptor( int i )
+{
+	 return ( i < MAX_STRING_DESC )
+		    ? string_desc_array[i]
+		    : NULL;
+}
+
+config_desc_t *
+pxa_usb_get_config(int cfgval) 
+{
+	int i;
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();
+	config_desc_t *cfg = (config_desc_t*) (pdesc->cdb);
+
+	for( i=0; i<pdesc->dev.bNumConfigurations; i++) {
+		if( cfg->bConfigurationValue == cfgval ) return cfg;
+		cfg = (config_desc_t*) ((unsigned char*)cfg + cfg->wTotalLength);
+	}
+
+	return NULL;
+}
+
+intf_desc_t *
+pxa_usb_get_interface( config_desc_t *cfg, int idx)
+{
+	int i;
+	intf_desc_t *intf = (intf_desc_t*) (cfg + 1);
+	
+	for( i=0; i < cfg->bNumInterfaces; i++) {
+		if( idx == intf->bInterfaceNumber) return intf;
+		intf++;
+	}
+
+	return NULL;
+}
+
+
+ep_desc_t *
+pxa_usb_get_endpoint( intf_desc_t *intf, int idx)
+{
+	int i;
+	ep_desc_t *ep = (ep_desc_t *) (intf+1);
+
+
+	for( i=0; i< intf->bNumEndpoints; i++) {
+		if( idx == (ep->bEndpointAddress & 0xF) ) return ep;
+		ep++;
+	}
+	return NULL;
+}
+
+//////////////////////////////////////////////////////////////////////////////
+// Exports to rest of driver
+//////////////////////////////////////////////////////////////////////////////
+
+/* called by the int handler here and the two endpoint files when interesting
+   .."events" happen */
+
+int
+usbctl_next_state_on_event( int event )
+{
+	int next_state = device_state_machine[ sm_state ][ event ];
+	if ( next_state != kError )
+	{
+		int next_device_state = sm_state_to_device_state[ next_state ];
+		if (usb_debug) printf( "%s%s --> [%s] --> %s. Device in %s state.\n",
+				pszMe, state_names[ sm_state ], event_names[ event ],
+				state_names[ next_state ], device_state_names[ next_device_state ] );
+
+		sm_state = next_state;
+		if ( usbd_info.state != next_device_state )
+		{
+			if ( configured_callback != NULL
+				 &&
+				 next_device_state == USB_STATE_CONFIGURED
+				 &&
+				 usbd_info.state != USB_STATE_SUSPENDED
+			   ) {
+			  configured_callback();
+			}
+			usbd_info.state = next_device_state;
+
+			ep1_state_change_notify( next_device_state );
+			ep2_state_change_notify( next_device_state );
+		}
+	}
+	else
+		printf( "%s%s --> [%s] --> ??? is an error.\n",
+				pszMe, state_names[ sm_state ], event_names[ event ] );
+	return next_state;
+}
+
+//////////////////////////////////////////////////////////////////////////////
+// Private Helpers
+//////////////////////////////////////////////////////////////////////////////
+
+/* setup default descriptors */
+
+static void
+initialize_descriptors(void)
+{
+
+	desc.dev.bLength               = sizeof( device_desc_t );
+	desc.dev.bDescriptorType       = USB_DESC_DEVICE;
+	desc.dev.bcdUSB                = 0x100; /* 1.0 */
+	desc.dev.bDeviceClass          = 0xFF;	/* vendor specific */
+	desc.dev.bDeviceSubClass       = 0;
+	desc.dev.bDeviceProtocol       = 0;
+	desc.dev.bMaxPacketSize0       = 16;	/* ep0 max fifo size */
+	desc.dev.idVendor              = 0;	/* vendor ID undefined */
+	desc.dev.idProduct             = 0; 	/* product */
+	desc.dev.bcdDevice             = 0; 	/* vendor assigned device release num */
+	desc.dev.iManufacturer         = 0;	/* index of manufacturer string */
+	desc.dev.iProduct              = 0; 	/* index of product description string */
+	desc.dev.iSerialNumber         = 0;	/* index of string holding product s/n */
+	desc.dev.bNumConfigurations    = 1;	/* configurations we have */
+
+	/*
+	desc.b.cfg.bLength             = sizeof( config_desc_t );
+	desc.b.cfg.bDescriptorType     = USB_DESC_CONFIG;
+	desc.b.cfg.wTotalLength        = make_word_c( sizeof(struct cdb) );
+	desc.b.cfg.bNumInterfaces      = 1;
+	desc.b.cfg.bConfigurationValue = 1;
+	desc.b.cfg.iConfiguration      = 0;
+	desc.b.cfg.bmAttributes        = USB_CONFIG_BUSPOWERED;
+	desc.b.cfg.MaxPower            = USB_POWER( 500 );
+
+	desc.b.intf.bLength            = sizeof( intf_desc_t );
+	desc.b.intf.bDescriptorType    = USB_DESC_INTERFACE;
+	desc.b.intf.bInterfaceNumber   = 0; 
+	desc.b.intf.bAlternateSetting  = 0;
+	desc.b.intf.bNumEndpoints      = 2;
+	desc.b.intf.bInterfaceClass    = 0xFF; 
+	desc.b.intf.bInterfaceSubClass = 0;
+	desc.b.intf.bInterfaceProtocol = 0;
+	desc.b.intf.iInterface         = 0;
+	*/
+
+/*
+ * FIXME...
+ * The host usbnet driver expects EP1=out EP2=in. On the PXA UDC EP1=in, EP2=out
+ */
+	/*
+	desc.b.ep1.bLength             = sizeof( ep_desc_t );
+	desc.b.ep1.bDescriptorType     = USB_DESC_ENDPOINT;
+	desc.b.ep1.bEndpointAddress    = USB_EP_ADDRESS( 1, USB_IN );
+	desc.b.ep1.bmAttributes        = USB_EP_BULK;
+	desc.b.ep1.wMaxPacketSize      = make_word_c( 64 );
+	desc.b.ep1.bInterval           = 0;
+
+	desc.b.ep2.bLength             = sizeof( ep_desc_t );
+	desc.b.ep2.bDescriptorType     = USB_DESC_ENDPOINT;
+	desc.b.ep2.bEndpointAddress    = USB_EP_ADDRESS( 2, USB_OUT );
+	desc.b.ep2.bmAttributes        = USB_EP_BULK;
+	desc.b.ep2.wMaxPacketSize      = make_word_c( 64 );
+	desc.b.ep2.bInterval           = 0;
+	*/
+
+// FIXME: Add support for all endpoint...
+
+	/* set language */
+	/* See: http://www.usb.org/developers/data/USB_LANGIDs.pdf */
+	sd_zero.bDescriptorType = USB_DESC_STRING;
+	sd_zero.bLength         = sizeof( string_desc_t );
+	sd_zero.bString[0]      = make_word_c( 0x409 ); /* American English */
+	pxa_usb_set_string_descriptor( 0, &sd_zero );
+}
+
+/* soft_connect_hook()
+ * Some devices have platform-specific circuitry to make USB
+ * not seem to be plugged in, even when it is. This allows
+ * software to control when a device 'appears' on the USB bus
+ * (after Linux has booted and this driver has loaded, for
+ * example). If you have such a circuit, control it here.
+ */
+static void
+soft_connect_hook( int enable )
+{
+}
+
+/* disable the UDC at the source */
+static void
+udc_disable(void)
+{
+	soft_connect_hook( 0 );
+	/* clear UDC-enable */
+	udc_clear_mask_UDCCR( UDCCR_UDE); 
+
+        /* Disable clock for USB device */
+        CKEN &= ~CKEN11_USB;
+}
+
+
+/*  enable the udc at the source */
+static void
+udc_enable(void)
+{
+        /* Enable clock for USB device */
+        CKEN |= CKEN11_USB;
+
+	/* try to clear these bits before we enable the udc */
+	udc_ack_int_UDCCR( UDCCR_SUSIR);
+	udc_ack_int_UDCCR( UDCCR_RSTIR);
+	udc_ack_int_UDCCR( UDCCR_RESIR);
+
+	/* set UDC-enable */
+	udc_set_mask_UDCCR( UDCCR_UDE); 
+	if( (UDCCR & UDCCR_UDA) == 0)
+	{
+		/* There's a reset on the bus,
+		 * clear the interrupt bit and keep going
+		 */
+		printf("reset on bus\n");
+		udc_ack_int_UDCCR( UDCCR_RSTIR);
+	}
+	
+	/* "USB test mode" to work around errata 40-42 (stepping a0, a1) 
+	 * which could result in missing packets and interrupts. 
+	 * Supposedly this turns off double buffering for all endpoints.
+	 */
+	if( usb_debug) printf( "USB RES1=%x RES2=%x RES3=%x\n", UDC_RES1, UDC_RES2, UDC_RES3);
+
+
+	UDC_RES1 = 0x00;
+	UDC_RES2 = 0x00;
+	if( usb_debug) printf( "USB RES1=%x RES2=%x RES3=%x\n", UDC_RES1, UDC_RES2, UDC_RES3);
+}
+
Index: build_tree/bootLoader/src/lib/pxa_usb_ctl.h
diff -u /dev/null build_tree/bootLoader/src/lib/pxa_usb_ctl.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa_usb_ctl.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,89 @@
+/*
+ *  Copyright (C) Compaq Computer Corporation, 1998, 1999
+ *  Copyright (C) Extenex Corporation 2001
+ *  Copyright (C) Intrinsyc, Inc., 2002
+ *
+ *  usb_ctl.h
+ *
+ *  PRIVATE interface used to share info among components of the PXA USB
+ *  core: usb_ctl, usb_ep0, usb_recv and usb_send. Clients of the USB core
+ *  should use pxa_usb.h.
+ *
+ *  02-May-2002
+ *   Frank Becker (Intrinsyc) - derived from sa1100 usb_ctl.h
+ *
+ */
+
+#ifndef _USB_CTL_H
+#define _USB_CTL_H
+
+/* Interrupt mask bits and UDC enable bit */
+#define UDCCR_MASK_BITS         (UDCCR_REM | UDCCR_SRM | UDCCR_UDE)
+
+/*
+ * These states correspond to those in the USB specification v1.0
+ * in chapter 8, Device Framework.
+ */
+enum { 
+	USB_STATE_NOTATTACHED	=0,
+	USB_STATE_ATTACHED	=1,
+	USB_STATE_POWERED	=2,
+	USB_STATE_DEFAULT	=3,
+	USB_STATE_ADDRESS	=4,
+	USB_STATE_CONFIGURED	=5,
+	USB_STATE_SUSPENDED	=6
+};
+
+struct usb_stats_t {
+	 unsigned long ep0_fifo_write_failures;
+	 unsigned long ep0_bytes_written;
+	 unsigned long ep0_fifo_read_failures;
+	 unsigned long ep0_bytes_read;
+};
+
+struct usb_info_t
+{
+	 char * client_name;
+	 int state;
+	 unsigned char address;
+	 struct usb_stats_t stats;
+};
+
+/* in usb_ctl.c */
+extern struct usb_info_t usbd_info;
+
+/*
+ * Function Prototypes
+ */
+enum { 
+	kError		=-1,
+	kEvSuspend	=0,
+	kEvReset	=1,
+	kEvResume	=2,
+	kEvAddress	=3,
+	kEvConfig	=4,
+	kEvDeConfig	=5 
+};
+int usbctl_next_state_on_event( int event );
+
+/* endpoint zero */
+void ep0_reset(void);
+void ep0_int_hndlr(void);
+
+/* receiver */
+void ep2_state_change_notify( int new_state );
+int  ep2_recv(char *buf, int len, usb_callback_t callback);
+int  ep2_init(int chn);
+void ep2_int_hndlr(int status);
+void ep2_reset(void);
+void ep2_stall(void);
+
+/* xmitter */
+void ep1_state_change_notify( int new_state );
+int  ep1_send(char *buf, int len, usb_callback_t callback);
+void ep1_reset(void);
+int  ep1_init(int chn);
+void ep1_int_hndlr(int status);
+void ep1_stall(void);
+
+#endif /* _USB_CTL_H */
Index: build_tree/bootLoader/src/lib/pxa_usb_ep0.c
diff -u /dev/null build_tree/bootLoader/src/lib/pxa_usb_ep0.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa_usb_ep0.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,559 @@
+/*
+ *  Copyright (C) Extenex Corporation 2001
+ *  Copyright (C) Compaq Computer Corporation, 1998, 1999
+ *  Copyright (C) Intrinsyc, Inc., 2002
+ *
+ *  PXA USB controller driver - Endpoint zero management
+ *
+ *  Please see:
+ *    linux/Documentation/arm/SA1100/SA1100_USB 
+ *  for more info.
+ *
+ *  02-May-2002
+ *   Frank Becker (Intrinsyc) - derived from sa1100 usb_ctl.c
+ * 
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/types.h>
+#include <blob/serial.h>
+
+#include "linux/errno.h"
+#include "pxa_usb.h"  /* public interface */
+#include "pxa_usb_ctl.h"  /* private stuff */
+#include "pxa_usb_ep0.h"
+
+#undef	DEBUG 
+#if DEBUG
+static unsigned int usb_debug = DEBUG;
+#else
+#define usb_debug 0     /* gcc will remove all the debug code for us */
+#endif
+
+enum { true = 1, false = 0 };
+typedef int bool;
+#ifndef MIN
+#define MIN( a, b ) ((a)<(b)?(a):(b))
+#endif
+
+static EP0_state ep0_state = EP0_IDLE;
+
+static int current_cfg_index = 0;
+/***************************************************************************
+  Prototypes
+ ***************************************************************************/
+/* "setup handlers" -- the main functions dispatched to by the
+   .. isr. These represent the major "modes" of endpoint 0 operation */
+static void sh_setup_begin(void);				/* setup begin (idle) */
+static void sh_write( void );      				/* writing data */
+static int  read_fifo( usb_dev_request_t * p );
+static void write_fifo( void );
+static void get_descriptor( usb_dev_request_t * pReq );
+static void queue_and_start_write( void * p, int req, int act );
+
+/***************************************************************************
+  Inline Helpers
+ ***************************************************************************/
+
+inline int type_code_from_request( __u8 by ) { return (( by >> 4 ) & 3); }
+
+/* print string descriptor */
+static inline void psdesc( string_desc_t * p )
+{
+	int i;
+	int nchars = ( p->bLength - 2 ) / sizeof( __u16 );
+	printf( "'" );
+	for( i = 0 ; i < nchars ; i++ ) {
+		printf( "%c", (char) p->bString[i] );
+	}
+	printf( "'\n" );
+}
+
+#if VERBOSITY
+/* "pcs" == "print control status" */
+static inline void pcs( void )
+{
+	__u32 foo = UDCCS0;
+	printf( "%08x: %s %s %s %s %s %s\n",
+			foo,
+			foo & UDCCS0_SA   ? "SA" : "",
+			foo & UDCCS0_OPR  ? "OPR" : "",
+			foo & UDCCS0_RNE  ? "RNE" : "",
+			foo & UDCCS0_SST  ? "SST" : "",
+			foo & UDCCS0_FST  ? "FST" : "",
+			foo & UDCCS0_DRWF ? "DRWF" : ""
+	      );
+}
+static inline void preq( usb_dev_request_t * pReq )
+{
+	static char * tnames[] = { "dev", "intf", "ep", "oth" };
+	static char * rnames[] = { "std", "class", "vendor", "???" };
+	char * psz;
+	switch( pReq->bRequest ) {
+		case GET_STATUS:        psz = "get stat"; break;
+		case CLEAR_FEATURE:     psz = "clr feat"; break;
+		case SET_FEATURE:       psz = "set feat"; break;
+		case SET_ADDRESS:       psz = "set addr"; break;
+		case GET_DESCRIPTOR:    psz = "get desc"; break;
+		case SET_DESCRIPTOR:    psz = "set desc"; break;
+		case GET_CONFIGURATION: psz = "get cfg"; break;
+		case SET_CONFIGURATION: psz = "set cfg"; break;
+		case GET_INTERFACE:     psz = "get intf"; break;
+		case SET_INTERFACE:     psz = "set intf"; break;
+		case SYNCH_FRAME:       psz = "synch frame"; break;
+		default:                psz = "unknown"; break;
+	}
+	printf( "- [%s: %s req to %s. dir=%s]\n", psz,
+			rnames[ (pReq->bmRequestType >> 5) & 3 ],
+			tnames[ pReq->bmRequestType & 3 ],
+			( pReq->bmRequestType & 0x80 ) ? "in" : "out" );
+}
+
+#else
+static inline void pcs( void ){}
+static inline void preq( usb_dev_request_t *x){}
+#endif
+
+/***************************************************************************
+  Globals
+ ***************************************************************************/
+static const char pszMe[] = "usbep0: ";
+
+/* pointer to current setup handler */
+static void (*current_handler)(void) = sh_setup_begin;
+
+/* global write struct to keep write
+   ..state around across interrupts */
+static struct {
+	unsigned char *p;
+	int bytes_left;
+} wr;
+
+/***************************************************************************
+  Public Interface
+ ***************************************************************************/
+
+/* reset received from HUB (or controller just went nuts and reset by itself!)
+   so udc core has been reset, track this state here  */
+void ep0_reset(void)
+{
+	if (usb_debug) ( "%sep0_reset\n", pszMe);
+	/* reset state machine */
+	current_handler = sh_setup_begin;
+	wr.p = 0;
+	wr.bytes_left = 0;
+	usbd_info.address=0;
+}
+
+/* handle interrupt for endpoint zero */
+void ep0_int_hndlr( void )
+{
+	if (usb_debug) printf( "%sep0_int_hndlr\n", pszMe);
+	pcs();
+	(*current_handler)();
+}
+
+/***************************************************************************
+  Setup Handlers
+ ***************************************************************************/
+/*
+ * sh_setup_begin()
+ * This setup handler is the "idle" state of endpoint zero. It looks for OPR
+ * (OUT packet ready) to see if a setup request has been been received from the
+ * host. 
+ *
+ */
+static void sh_setup_begin( void )
+{
+	usb_dev_request_t req;
+	int request_type;
+	int n;
+	__u32 cs_reg_in = UDCCS0;
+
+	if (usb_debug) printf( "%ssh_setup_begin\n", pszMe);
+
+	/* Be sure out packet ready, otherwise something is wrong */
+	if ( (cs_reg_in & UDCCS0_OPR) == 0 ) {
+		/* we can get here early...if so, we'll int again in a moment  */
+		if (usb_debug) printf( "%ssetup begin: no OUT packet available. Exiting\n", pszMe );
+		goto sh_sb_end;
+	}
+
+	if( ((cs_reg_in & UDCCS0_SA) == 0) && (ep0_state == EP0_IN_DATA_PHASE))
+	{
+		if (usb_debug) printf( "%ssetup begin: premature status\n", pszMe );
+
+		/* premature status, reset tx fifo and go back to idle state*/
+		UDCCS0 = UDCCS0_OPR | UDCCS0_FTF;
+
+		ep0_state = EP0_IDLE;
+		return;
+	}
+
+	if( (UDCCS0 & UDCCS0_RNE) == 0)
+	{
+		/* zero-length OUT? */
+		printf( "%ssetup begin: zero-length OUT?\n", pszMe );
+		goto sh_sb_end;
+	}
+
+	/* read the setup request */
+	n = read_fifo( &req );
+	if ( n != sizeof( req ) ) {
+		printf( "%ssetup begin: fifo READ ERROR wanted %d bytes got %d. "
+				" Stalling out...\n",
+				pszMe, sizeof( req ), n );
+		/* force stall, serviced out */
+		UDCCS0 = UDCCS0_FST;
+		goto sh_sb_end;
+	}
+
+	/* Is it a standard request? (not vendor or class request) */
+	request_type = type_code_from_request( req.bmRequestType );
+	if ( request_type != 0 ) {
+		printf( "%ssetup begin: unsupported bmRequestType: %d ignored\n",
+				pszMe, request_type );
+		goto sh_sb_end;
+	}
+
+
+#if 0
+	{
+		unsigned char * pdb = (unsigned char *) &req;
+		if (usb_debug) printf( "%2.2X %2.2X %2.2X %2.2X %2.2X %2.2X %2.2X %2.2X ",
+				pdb[0], pdb[1], pdb[2], pdb[3], pdb[4], pdb[5], pdb[6], pdb[7]
+		       );
+		preq( &req );
+	}
+#endif
+
+	/* Handle it */
+	switch( req.bRequest ) {
+
+		case SET_ADDRESS:
+			if (usb_debug) printf( "%sSET_ADDRESS handled by UDC\n", pszMe);
+			break;
+#if 0 /* NOT_NEEDED */
+
+		case SET_FEATURE:
+			if (usb_debug) printf( "%sSET_FEATURE handled by UDC\n", pszMe);
+			break;
+
+		case CLEAR_FEATURE:
+			if (usb_debug) printf( "%sCLEAR_FEATURE handled by UDC\n", pszMe);
+			break;
+
+		case GET_CONFIGURATION:
+			if (usb_debug) printf( "%sGET_CONFIGURATION handled by UDC\n", pszMe );
+			break;
+
+		case GET_STATUS:
+			if (usb_debug) printf( "%s%sGET_STATUS handled by UDC\n", pszMe );
+			break;
+
+		case GET_INTERFACE:
+			if (usb_debug) printf( "%sGET_INTERFACE handled by UDC\n", pszMe);
+			break;
+
+		case SYNCH_FRAME:
+			if (usb_debug) printf( "%sSYNCH_FRAME handled by UDC\n", pszMe );
+			break;
+#endif
+
+		case GET_DESCRIPTOR:
+			if (usb_debug) printf( "%sGET_DESCRIPTOR\n", pszMe );
+			get_descriptor( &req );
+			break;
+
+		case SET_INTERFACE:
+			if (usb_debug) printf( "%sSET_INTERFACE TODO...\n", pszMe);
+			break;
+
+		case SET_DESCRIPTOR:
+			if (usb_debug) printf( "%sSET_DESCRIPTOR TODO...\n", pszMe );
+			break;
+
+		case SET_CONFIGURATION:
+			if (usb_debug) printf( "%sSET_CONFIGURATION %d\n", pszMe, req.wValue);
+
+/*
+ * FIXME: Something is not quite right here... I only ever get a 
+ * de-configure from the host. Ignoring it for now, since usb
+ * ethernet won't do anything unless usb is 'configured'.
+ *
+ */
+#if 0
+			switch( req.wValue)
+			{
+				case 0:
+					/* configured */
+					usbctl_next_state_on_event( kEvConfig );
+					break;
+				case 1:
+					/* de-configured */
+					usbctl_next_state_on_event( kEvDeConfig );
+					break;
+				default:
+					if (usb_debug) printf( "%sSET_CONFIGURATION: unknown configuration value (%d)\n", pszMe, req.wValue);
+					break;
+			}
+#endif
+			break;
+		default :
+			printf("%sunknown request 0x%x\n", pszMe, req.bRequest);
+			break;
+	} /* switch( bRequest ) */
+
+sh_sb_end:
+	return;
+}
+
+/*
+ * sh_write()
+ * 
+ * Due to UDC bugs we push everything into the fifo in one go.
+ * Using interrupts just didn't work right...
+ * This should be ok, since control request are small.
+ */
+static void sh_write()
+{
+	if (usb_debug) printf( "sh_write\n" );
+	do
+	{
+	    write_fifo();
+	} while( ep0_state != EP0_END_XFER);
+}
+
+/***************************************************************************
+  Other Private Subroutines
+ ***************************************************************************/
+/*
+ * queue_and_start_write()
+ * data == data to send
+ * req == bytes host requested
+ * act == bytes we actually have
+ *
+ * Sets up the global "wr"-ite structure and load the outbound FIFO 
+ * with data.
+ *
+ */
+static void queue_and_start_write( void * data, int req, int act )
+{
+	if (usb_debug) printf( "write start: bytes requested=%d actual=%d\n", req, act);
+
+	wr.p = (unsigned char*) data;
+	wr.bytes_left = MIN( act, req );
+
+	ep0_state = EP0_IN_DATA_PHASE;
+	sh_write();
+
+	return;
+}
+/*
+ * write_fifo()
+ * Stick bytes in the endpoint zero FIFO.
+ *
+ */
+static void write_fifo( void )
+{
+	int bytes_this_time = MIN( wr.bytes_left, EP0_FIFO_SIZE );
+	int bytes_written = 0;
+
+	while( bytes_this_time-- ) {
+		if (usb_debug) printf( "%2.2X ", *wr.p );
+		UDDR0 = *wr.p++;
+		bytes_written++;
+	}
+	wr.bytes_left -= bytes_written;
+
+	usbd_info.stats.ep0_bytes_written += bytes_written;
+
+	if( (wr.bytes_left==0))
+	{
+		wr.p = 0;  				/* be anal */
+
+ 		if(bytes_written < EP0_FIFO_SIZE)
+		{
+			int count;
+			int udccs0;
+
+			/* We always end the transfer with a short or zero length packet */
+			ep0_state = EP0_END_XFER;
+			current_handler = sh_setup_begin;
+
+			/* Let the packet go... */
+			UDCCS0 = UDCCS0_IPR;
+
+			/* Wait until we get to status-stage, then ack.
+			 *
+			 * When the UDC sets the UDCCS0[OPR] bit, an interrupt
+			 * is supposed to be generated (see 12.5.1 step 14ff, PXA Dev Manual).   
+			 * That approach didn't work out. Usually a new SETUP command was
+			 * already in the fifo. I tried many approaches but was always losing 
+			 * at least some OPR interrupts. Thus the polling below...
+			 */
+			count = 1000;
+			udccs0 = UDCCS0;
+			do
+			{
+				if( (UDCCS0 & UDCCS0_OPR)) 
+				{
+					/* clear OPR, generate ack */
+					UDCCS0 = UDCCS0_OPR;
+					break;
+				}
+				count--;	
+				msleep(1);
+				//udelay(1);
+			} while( count);
+
+			if (usb_debug) printf( "write fifo: count=%d UDCCS0=%x UDCCS0=%x\n", count, udccs0, UDCCS0);
+		}
+	}
+	/* something goes poopy if I dont wait here ... */
+	msleep(1);
+	//udelay(500);
+
+	if (usb_debug) printf( "write fifo: bytes sent=%d, bytes left=%d\n", bytes_written, wr.bytes_left);
+}
+
+/*
+ * read_fifo()
+ * Read bytes out of FIFO and put in request.
+ * Called to do the initial read of setup requests
+ * from the host. Return number of bytes read.
+ *
+ */
+static int read_fifo( usb_dev_request_t * request )
+{
+	int bytes_read = 0;
+	unsigned char * pOut = (unsigned char*) request;
+
+	int udccs0 = UDCCS0;
+
+	if( (udccs0 & SETUP_READY) == SETUP_READY)
+	{
+		/* ok it's a setup command */
+		while( UDCCS0 & UDCCS0_RNE)
+		{
+			if( bytes_read >= sizeof( usb_dev_request_t))
+			{
+				/* We've already read enought o fill usb_dev_request_t.
+				 * Our tummy is full. Go barf... 
+				 */
+				printf( "%sread_fifo(): read failure\n", pszMe );
+				usbd_info.stats.ep0_fifo_read_failures++;
+				break;
+			}
+
+			*pOut++ = UDDR0;
+			bytes_read++;
+		}
+	}
+	if (usb_debug) printf( "read_fifo %d bytes\n", bytes_read );
+
+	/* clear SA & OPR */
+	UDCCS0 = SETUP_READY;
+
+	usbd_info.stats.ep0_bytes_read += bytes_read;
+	return bytes_read;
+}
+
+/*
+ * get_descriptor()
+ * Called from sh_setup_begin to handle data return
+ * for a GET_DESCRIPTOR setup request.
+ *
+ * +-----+------------------------------------------------+-----------------+
+ * | dev | cfg1 | intf 1 | ep 1..N | intf 2 | ep 1..N |...| cfg2 .......... |
+ * +-----+------------------------------------------------+-----------------+
+ */
+static void get_descriptor( usb_dev_request_t * pReq )
+{
+	string_desc_t * pString;
+	ep_desc_t * pEndpoint = 0;
+	config_desc_t *pcfg = 0;
+
+	desc_t * pDesc = pxa_usb_get_descriptor_ptr();
+	int type = pReq->wValue >> 8;
+	int idx  = pReq->wValue & 0xFF;
+
+	if (usb_debug) printf( "%sget_descriptor for %d\n", pszMe, type );
+	switch( type ) {
+		case USB_DESC_DEVICE:
+			/* return device descritpor */
+			queue_and_start_write( &pDesc->dev,
+					pReq->wLength,
+					pDesc->dev.bLength );
+			break;
+
+			// return config descriptor buffer, cfg, intf 1..N,  ep 1..N
+		case USB_DESC_CONFIG:
+			{
+				int i,len;
+				config_desc_t *cfg =(config_desc_t*) (pDesc->cdb);
+
+				len=0;
+				for( i=0; i<pDesc->dev.bNumConfigurations; i++) {
+					len += __le16_to_cpu(cfg->wTotalLength);
+					cfg = (config_desc_t*) ( (unsigned char*) cfg 
+							+ __le16_to_cpu(cfg->wTotalLength)) ;
+				}
+					
+				queue_and_start_write( pDesc->cdb,
+						pReq->wLength,
+						len);
+			}
+			break;
+
+			// not quite right, since doesn't do language code checking
+		case USB_DESC_STRING:
+			pString = pxa_usb_get_string_descriptor( idx );
+			if ( pString ) {
+				if ( idx != 0 ) {  // if not language index
+					printf( "%sReturn string %d: ", pszMe, idx );
+					psdesc( pString );
+				}
+				queue_and_start_write( pString,
+						pReq->wLength,
+						pString->bLength );
+			}
+			else {
+				printf("%sunkown string index %d Stall.\n", pszMe, idx );
+			}
+			break;
+
+			/*
+		case USB_DESC_INTERFACE:
+			for( i = 0; i < pDesc->intf_num; i++) {
+				if ( idx == pDesc->intf[i].bInterfaceNumber ) {
+					queue_and_start_write( &pDesc->intf[i],
+							pReq->wLength,
+							pDesc->intf[i].bLength );
+				}
+			}
+			break;
+
+		case USB_DESC_ENDPOINT: 
+			for( i = 0; i < pDesc->ep_num; i++) {
+				if ( idx == (0x0F & pDesc->ep[i].bEndpointAddress)) {
+					queue_and_start_write( &pDesc->ep[i],
+							pReq->wLength,
+							pDesc->ep[i].bLength );
+				}
+			}
+			break;
+			*/
+
+		default :
+			printf("%sunknown descriptor type %d. Stall.\n", pszMe, type );
+			break;
+
+	}
+}
+
+/* end usb_ep0.c - who needs this comment? */
Index: build_tree/bootLoader/src/lib/pxa_usb_ep0.h
diff -u /dev/null build_tree/bootLoader/src/lib/pxa_usb_ep0.h:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa_usb_ep0.h	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,66 @@
+/*
+ *  Copyright (C) Intrinsyc, Inc., 2002
+ *
+ *  usb_ep0.h - PXA USB controller driver.
+ *              Endpoint zero management
+ *
+ *  Please see:
+ *    linux/Documentation/arm/SA1100/SA1100_USB
+ *  for details.
+ *
+ *  02-May-2002
+ *   Frank Becker (Intrinsyc) - 
+ * 
+ */
+
+#ifndef __USB_EP0_H
+#define __USB_EP0_H
+
+#define EP0_FIFO_SIZE	16
+#define SETUP_READY (UDCCS0_SA | UDCCS0_OPR)
+
+/*================================================
+ * USB Protocol Stuff
+ */
+
+/* Request Codes   */
+enum { 
+	GET_STATUS		=0,
+	CLEAR_FEATURE		=1,
+	/* reserved		=2 */
+	SET_FEATURE		=3,
+	/* reserved		=4 */
+	SET_ADDRESS		=5,        
+	GET_DESCRIPTOR		=6,
+	SET_DESCRIPTOR		=7,
+	GET_CONFIGURATION	=8,
+	SET_CONFIGURATION	=9,
+	GET_INTERFACE		=10,
+	SET_INTERFACE		=11,
+	SYNCH_FRAME		=12
+};
+
+typedef enum {
+	EP0_IDLE,
+	EP0_IN_DATA_PHASE,
+	EP0_END_XFER,
+	EP0_OUT_DATA_PHASE
+} EP0_state;
+
+/* USB Device Requests */
+typedef struct
+{
+	__u8 bmRequestType;
+	__u8 bRequest;
+	__u16 wValue;
+	__u16 wIndex;
+	__u16 wLength;
+} usb_dev_request_t  __attribute__ ((packed));
+
+/* Data extraction from usb_request_t fields */
+enum { 
+	kTargetDevice	=0,
+	kTargetInterface=1,
+	kTargetEndpoint	=2 
+};
+#endif
Index: build_tree/bootLoader/src/lib/pxa_usb_ep1.c
diff -u /dev/null build_tree/bootLoader/src/lib/pxa_usb_ep1.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa_usb_ep1.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,202 @@
+/*
+ * Generic xmit layer for the PXA USB client function
+ *
+ * This code was loosely inspired by the original version which was
+ * Copyright (c) Compaq Computer Corporation, 1998-1999
+ * Copyright (c) 2001 by Nicolas Pitre
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+ * 02-May-2002
+ *   Frank Becker (Intrinsyc) - derived from sa1100 usb_send.c
+ *
+ * TODO: Add support for DMA.
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/types.h>
+#include <blob/init.h>
+
+#include <linux/errno.h>
+#include "pxa_usb.h"
+#include "pxa_usb_ctl.h"
+
+#undef DEBUG
+#if DEBUG
+static unsigned int usb_debug = DEBUG;
+#else
+#define usb_debug 0     /* gcc will remove all the debug code for us */
+#endif
+
+static char *ep1_buf;
+static int   ep1_len;
+static int   ep1_remain;
+static usb_callback_t ep1_callback;
+static int tx_pktsize;
+
+/* device state is changing, async */
+void
+ep1_state_change_notify( int new_state )
+{
+}
+
+/* set feature stall executing, async */
+void
+ep1_stall( void )
+{
+	UDCCS1 |= UDCCS_BI_FST;
+}
+
+static void
+ep1_send_packet(void)
+{
+	int i;
+	char *buf = ep1_buf + ep1_len - ep1_remain;
+	int out_size = tx_pktsize;
+
+	if( usb_debug) printf( "ep1_send_packet: UICR0=%x UDCCS1=%x\n", UICR0, UDCCS1);
+
+	if( out_size > ep1_remain) 
+	{
+		out_size = ep1_remain;
+	}
+
+	for( i=0; i<out_size; i++)
+	{
+		UDDR1 = *buf++;	
+	}
+
+	UDCCS1 = UDCCS_BI_TPC;
+	if( out_size < tx_pktsize)
+	{
+		/* short packet */
+		UDCCS1 = UDCCS_BI_TSP;
+	}
+	ep1_remain -= out_size;
+
+	if( usb_debug) printf( "ep1_send_packet: "
+		"UICR0=%x UDCCS1=%x send bytes=%d left=%d\n", 
+		UICR0, UDCCS1, out_size, ep1_remain);
+}
+
+static void
+ep1_start(void)
+{
+	if (!ep1_len)
+		return;
+
+        UICR0 &= ~UICR0_IM1;
+
+	ep1_send_packet();
+}
+
+static void
+ep1_done(int flag)
+{
+	int size = ep1_len - ep1_remain;
+	if (ep1_len) {
+		ep1_len = 0;
+		if (ep1_callback)
+			ep1_callback(flag, size);
+	}
+}
+
+int
+ep1_init(int chn)
+{
+	/*
+	int i;
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();
+	for ( i = 0; i < pdesc->ep_num; i++ ) {
+		if( BULK_IN1 == ( 0xF & pdesc->ep[i].bEndpointAddress) ) {
+			tx_pktsize = __le16_to_cpu( pdesc->ep[i].wMaxPacketSize );
+		}
+	}
+	*/
+
+	/* FIXME */
+	tx_pktsize = 64;
+	ep1_done(-EAGAIN);
+	return 0;
+}
+
+void
+ep1_reset(void)
+{
+	/*
+	int i;
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();	
+	for ( i = 0; i < pdesc->ep_num; i++ ) {
+		if( BULK_IN1 == ( 0xF & pdesc->ep[i].bEndpointAddress) ) {
+			tx_pktsize = __le16_to_cpu( pdesc->ep[i].wMaxPacketSize );
+		}
+	}
+	*/
+
+	/* FIXME */
+	tx_pktsize = 64;
+
+	UDCCS1 &= ~UDCCS_BI_FST;
+	ep1_done(-EINTR);
+}
+
+void
+ep1_int_hndlr(int usir0)
+{
+	int status = UDCCS1;
+
+
+	if (ep1_remain != 0) {
+		/* more data to go */
+		ep1_start();
+	} else {
+		if( status & UDCCS_BI_TPC)
+		{
+			UDCCS1 = UDCCS_BI_TPC;
+		}
+		ep1_done(0);
+	}
+}
+
+int
+ep1_send(char *buf, int len, usb_callback_t callback)
+{
+	int i=0;
+	int flags;
+
+	if( usb_debug) printf( "pxa_usb_send: "
+		"data len=%d state=%d blen=%d\n", 
+		len, usbd_info.state, ep1_len);
+
+	if (usbd_info.state != USB_STATE_CONFIGURED)
+		return -ENODEV;
+
+	if (ep1_len) {
+		return -EBUSY;
+	}
+
+	ep1_buf = buf;
+	ep1_len = len;
+	ep1_callback = callback;
+	ep1_remain = len;
+	ep1_start();
+
+	return 0;
+}
+
+int 
+ep1_xmitter_avail( void )
+{
+	if (usbd_info.state != USB_STATE_CONFIGURED)
+		return -ENODEV;
+	if (ep1_len)
+		return -EBUSY;
+	return 0;
+}
Index: build_tree/bootLoader/src/lib/pxa_usb_ep2.c
diff -u /dev/null build_tree/bootLoader/src/lib/pxa_usb_ep2.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/pxa_usb_ep2.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,189 @@
+/*
+ * Generic receive layer for the PXA USB client function
+ *
+ * This code was loosely inspired by the original version which was
+ * Copyright (c) Compaq Computer Corporation, 1998-1999
+ * Copyright (c) 2001 by Nicolas Pitre
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ *
+ * 02-May-2002
+ *   Frank Becker (Intrinsyc) - derived from sa1100 usb_recv.c
+ * 
+ * TODO: Add support for DMA.
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/types.h>
+#include <blob/init.h>
+
+#include <linux/errno.h>
+#include "pxa_usb.h"
+#include "pxa_usb_ctl.h"
+
+#undef DEBUG
+#if DEBUG
+static unsigned int usb_debug = DEBUG;
+#else
+#define usb_debug 0     /* gcc will remove all the debug code for us */
+#endif
+
+static char *ep2_buf;
+static int   ep2_len;
+static int   ep2_remain;
+static usb_callback_t ep2_callback;
+static int rx_pktsize;
+
+static void
+ep2_start(void)
+{
+	/* disable DMA, RPC & SST should not be cleared */
+	UDCCS2 &= ~( UDCCS_BO_DME | UDCCS_BO_RPC | UDCCS_BO_SST );
+
+	/* enable interrupts for endpoint 2 (bulk out) */
+        UICR0 &= ~UICR0_IM2;
+}
+
+static void
+ep2_done(int flag)
+{
+	int size = ep2_len - ep2_remain;
+
+	if (!ep2_len)
+		return;
+
+	ep2_len = 0;
+	if (ep2_callback) {
+		ep2_callback(flag, size);
+	}
+}
+
+void
+ep2_state_change_notify( int new_state )
+{
+}
+
+void
+ep2_stall( void )
+{
+	/* SET_FEATURE force stall at UDC */
+	UDCCS2 |= UDCCS_BO_FST;
+}
+
+int
+ep2_init(int chn)
+{
+	/*
+	int i;
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();
+
+	for ( i = 0; i < pdesc->ep_num; i++ ) {
+		if( BULK_OUT1 == ( 0xF & pdesc->ep[i].bEndpointAddress) ) {
+			rx_pktsize = __le16_to_cpu( pdesc->ep[i].wMaxPacketSize );
+		}
+	}
+	*/
+
+	/* FIXME */
+	rx_pktsize = 64;
+	ep2_done(-EAGAIN);
+	return 0;
+}
+
+void
+ep2_reset(void)
+{
+	/*
+	int i;
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();
+
+	for ( i = 0; i < pdesc->ep_num; i++ ) {
+		if( BULK_OUT1 == ( 0xF & pdesc->ep[i].bEndpointAddress) ) {
+			rx_pktsize = __le16_to_cpu( pdesc->ep[i].wMaxPacketSize );
+		}
+	}
+	*/
+	/* FIXME */
+	rx_pktsize = 64;
+	UDCCS2 &= ~UDCCS_BO_FST;
+	ep2_done(-EINTR);
+}
+
+void
+ep2_int_hndlr(int udcsr)
+{
+	int status = UDCCS2;
+	if( usb_debug) printf("ep2_int_hndlr: UDCCS2=%x\n", status);
+
+	if( (status & (UDCCS_BO_RNE | UDCCS_BO_RSP)) == UDCCS_BO_RSP)
+	{
+		/* zero-length packet */
+	}
+
+	if( status & UDCCS_BO_RNE)
+	{
+		int len, ignlen;
+		int i;
+		char *buf = ep2_buf + ep2_len - ep2_remain;
+
+		/* bytes in FIFO */
+		len = (UBCR2 & 0xff) +1;
+		
+		if( usb_debug) printf("usb_recv: "
+			"len=%d out1_len=%d out1_remain=%d\n",
+			len,ep2_len,ep2_remain);
+
+		if( len > ep2_remain)
+		{
+			ignlen = len - ep2_remain;
+			/* FIXME: if this happens, we need a temporary overflow buffer */
+			if (usb_debug) printf("usb_recv: Buffer overwrite warning...\n");
+			len = ep2_remain;
+		}
+
+		/* read data out of fifo */
+		for( i=0; i<len; i++)
+		{
+			*buf++ = UDDR2 & 0xff;
+		}
+
+		/* empty fifo */
+		for( i=0; i<ignlen; i++)
+		{
+			char c = UDDR2 & 0xff;
+		}
+
+		ep2_remain -= len;
+		ep2_done((len) ? 0 : -EPIPE);
+	}
+
+	/* ack RPC - FIXME: '|=' we may ack SST here, too */
+	UDCCS2 |= UDCCS_BO_RPC;
+
+	return;
+}
+
+int
+ep2_recv(char *buf, int len, usb_callback_t callback)
+{
+	int flags;
+
+	if (ep2_len)
+		return -EBUSY;
+
+	ep2_buf = buf;
+	ep2_len = len;
+	ep2_callback = callback;
+	ep2_remain = len;
+	ep2_start();
+
+	return 0;
+}
+
Index: build_tree/bootLoader/src/lib/reboot-pxa.c
diff -u /dev/null build_tree/bootLoader/src/lib/reboot-pxa.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/reboot-pxa.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,54 @@
+/*
+ * reboot-pxa.c: Reboot PXA 250 board
+ *
+ * Copyright (C) 2003  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * $Id: reboot-pxa.c,v 1.1 2003/01/04 02:11:43 erikm Exp $
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: reboot-pxa.c,v 1.1 2003/01/04 02:11:43 erikm Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/util.h>
+#include <blob/reboot.h>
+#include <blob/serial.h>
+#include <blob/proc/pxa.h>
+#include <blob/arch/pxa-regs.h>
+
+void pxa_reboot(void)
+{
+	OWER = OWER_WME;
+	OSSR = OSSR_M3;
+	OSMR3 = OSCR + 368640;  /* ... in 100 ms */
+
+//	asm("mov r0, #0");
+//	asm("mov pc, r0");
+	
+	for(;;);
+}
+
+
+
+
+/* export reboot driver */
+reboot_driver_t pxa_reboot_driver = {
+	reboot:	pxa_reboot
+};
Index: build_tree/bootLoader/src/lib/reboot.c
diff -u build_tree/bootLoader/src/lib/reboot.c:1.1.1.1 build_tree/bootLoader/src/lib/reboot.c:1.1.1.2
--- build_tree/bootLoader/src/lib/reboot.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/reboot.c	Fri Nov  9 09:44:05 2007
@@ -1,9 +1,9 @@
 /*
  * reboot.c: Reboot board
  *
- * Copyright (C) 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ * Copyright (C) 2001-2003  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
- * $Id: reboot.c,v 1.2 2002/01/06 15:46:17 erikm Exp $
+ * $Id: reboot.c,v 1.6 2003/01/04 02:15:07 erikm Exp $
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -21,32 +21,30 @@
  *
  */
 
-#ident "$Id: reboot.c,v 1.2 2002/01/06 15:46:17 erikm Exp $"
+#ident "$Id: reboot.c,v 1.6 2003/01/04 02:15:07 erikm Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
-#include <blob/serial.h>
-#include <blob/sa1100.h>
+#include <blob/debug.h>
+#include <blob/util.h>
+#include <blob/reboot.h>
 
 
 
 
-char reboothelp[] = "reboot\n"
-"Reboot system\n";
+reboot_driver_t *reboot_driver;
 
 
 
 
-int reboot(int argc, char *argv[])
+void reboot_system(void)
 {
-	SerialOutputString("Rebooting...\n\n");
-	serial_flush_output();
-	
-	RCSR = 0;
-	RSRR = 1;
+	if(reboot_driver == NULL) {
+		deprintf("reboot_driver == NULL, can't reboot!\n");
+		return;
+	}
 
-	/* never reached, but anyway... */
-	return 0;
+	reboot_driver->reboot();
 }
Index: build_tree/bootLoader/src/lib/serial-bvdusb.c
diff -u /dev/null build_tree/bootLoader/src/lib/serial-bvdusb.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/serial-bvdusb.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,253 @@
+/*
+ *  serial-pxausb.c : "serial-over-usb" driver for BLOB
+ *
+ *  Copyright (c) 2004, Intel Corporation (alek.du@intel.com)
+ *  slightly modified from Ether-bvdusb.c which is from 
+ *  Copyright (c) 2003, Intel Corporation (yu.tang@intel.com)
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/types.h>
+#include <blob/time.h>
+#include <blob/serial.h>
+#include <blob/util.h>
+#include <blob/init.h>
+#include <blob/serial_usb.h>
+
+#include <pxa_usb.h>
+
+static int usb_rsize=64;
+static int usb_wsize=64;
+
+/* cable connection : defined in bvd_usb_ctl.c */
+extern int usb_connected;
+
+/* receive buffer management */
+static u8  rx_buf[1024*64];
+static int  rx_size = 0;
+static int  rx_done = 0 ;
+
+/* transmit buffer management */
+static int tx_done = 0 ;
+
+#define SERIAL_VENDOR_ID 0x8086
+#define SERIAL_PRODUCT_ID 0x07d3
+
+static void usb_serial_tx_callback(int flag, int size)
+{
+	tx_done = 1;
+}
+
+static void usb_serial_rx_callback(int flag, int size)
+{
+	int left;
+
+	if( flag != 0 ) return;
+
+	if (rx_done) { 
+		/* drop */
+		rx_done = 0;
+		rx_size = 0;
+	}
+
+	rx_size += size;
+
+	/* end-of-packet? */
+	if(size == usb_rsize) {
+		left = sizeof(rx_buf) - rx_size;
+		if (!left) 
+			goto done;
+
+		ep2_recv(rx_buf+rx_size, (left<usb_rsize)?left:usb_rsize, usb_serial_rx_callback);
+		return;
+	}
+
+done:
+	rx_done = 1;
+
+	/* setup to receive */
+	ep2_recv(rx_buf, sizeof(rx_buf), usb_serial_rx_callback);
+
+	return;
+}
+
+void usb_driver_reset(void)
+{
+	desc_t * pdesc = pxa_usb_get_descriptor_ptr();
+	config_desc_t *cfg;
+	intf_desc_t *intf;
+	ep_desc_t *ep;
+
+	/* setup device descriptor */
+	pdesc->dev.idVendor	= SERIAL_VENDOR_ID;
+	pdesc->dev.idProduct    = SERIAL_PRODUCT_ID;
+	pdesc->dev.bNumConfigurations = 1;
+
+	cfg = (config_desc_t*) (pdesc->cdb);
+
+	cfg->bLength             = sizeof( config_desc_t );
+	cfg->bDescriptorType     = USB_DESC_CONFIG;
+	cfg->wTotalLength        = make_word_c( sizeof(config_desc_t) +
+						   sizeof(intf_desc_t) * 1+
+						   sizeof(ep_desc_t) * 2);
+	cfg->bNumInterfaces      = 1;
+	cfg->bConfigurationValue = 1;
+	cfg->iConfiguration      = 0;
+	cfg->bmAttributes        = USB_CONFIG_BUSPOWERED;
+	cfg->MaxPower            = USB_POWER( 500 );
+
+	intf = (intf_desc_t *) ( cfg + 1);
+	intf->bLength            = sizeof( intf_desc_t );
+	intf->bDescriptorType    = USB_DESC_INTERFACE;
+	intf->bInterfaceNumber   = 0; 
+	intf->bAlternateSetting  = 0;
+	intf->bNumEndpoints      = 2;
+	intf->bInterfaceClass    = 0xFF; 
+	intf->bInterfaceSubClass = 0x02;
+	intf->bInterfaceProtocol = 0x01;
+	intf->iInterface         = 0;
+
+	ep = (ep_desc_t *) (intf + 1);
+	ep[0].bLength             = sizeof( ep_desc_t );
+	ep[0].bDescriptorType     = USB_DESC_ENDPOINT;
+	ep[0].bEndpointAddress    = USB_EP_ADDRESS( 1, USB_IN );
+	ep[0].bmAttributes        = USB_EP_BULK;
+	ep[0].wMaxPacketSize      = make_word( 64 );
+	ep[0].bInterval           = 0;
+
+	ep[1].bLength             = sizeof( ep_desc_t );
+	ep[1].bDescriptorType     = USB_DESC_ENDPOINT;
+	ep[1].bEndpointAddress    = USB_EP_ADDRESS( 2, USB_OUT );
+	ep[1].bmAttributes        = USB_EP_BULK;
+	ep[1].wMaxPacketSize      = make_word( 64 );
+	ep[1].bInterval           = 0;
+
+	/* reset buffer */
+	rx_done = 0;
+	rx_size = 0;
+
+	/* setup to receive */
+	ep2_recv(rx_buf, sizeof(rx_buf), usb_serial_rx_callback);
+}
+
+static int usb_serial_init()
+{
+	usb_connected = 0;
+
+	/* initialize PXA USB controller */
+	pxa_usb_open("usb-serial");
+	pxa_usb_start();
+
+	return 0;
+}
+
+static int usb_serial_rx(char *inbuf, int size)
+{
+	int i=0;
+	static int left=0;
+	static char* lastpos=NULL;
+	
+	if (left){// last time left some bytes not read
+		if (size>left)
+			size=left;
+		memcpy(inbuf,lastpos,size);
+		left-=size;
+		lastpos+=size;
+		return size;
+	}
+
+	check_usb_connection();
+
+	for ( i=0; i<0x1000 && !rx_done; i++) {
+		if ( ICPR & 0x800 ) {
+			udc_int_hndlr(0x11, 0);
+			i=0;
+		}
+	}
+	if (!rx_done){//timeout exit then reset setup for receive
+		ep2_recv(rx_buf, sizeof(rx_buf), usb_serial_rx_callback);
+	}
+	if (size > rx_size) 
+		size = rx_size;
+
+	memcpy(inbuf, rx_buf, size);
+
+	left=rx_size-size;
+	lastpos=rx_buf+size;
+	
+	rx_done = 0;
+	rx_size = 0;
+
+	return size;
+}
+
+static int check_usb_connection(void)
+{
+	int cnt;
+
+	if (usb_connected) return 0;
+
+	/* waiting util connected */
+	printf("***** Plug-in USB cable now ****** \n");
+	
+	while (!usb_connected) {
+		if ( ICPR & 0x800 ) 
+			udc_int_hndlr(0x11, 0);
+	}
+	printf("***** Capture USB cable event ****** \n");
+	
+	while ( cnt < 0x1000) {
+		if ( ICPR & 0x800 ) {
+			udc_int_hndlr(0x11, 0);
+			cnt = 0;
+		}
+		cnt ++;
+	}
+	return 0;
+}
+
+static int usb_serial_tx(char *outbuf, int size) 
+{
+	int tx_size = size;
+
+	check_usb_connection();
+
+	if ( 0 == (size % usb_wsize) ) 
+		size ++;
+
+	tx_done = 0;
+
+	ep1_send(outbuf, size, usb_serial_tx_callback);
+
+	while (!tx_done) {
+		if ( ICPR & 0x800 ) 
+			udc_int_hndlr(0x11, 0);
+	}
+	
+	return tx_size;
+}
+
+/* export usb_serial_driver driver */
+usb_serial_driver_t bvd_usb_serial_driver={
+	init:usb_serial_init,
+	read:usb_serial_rx,
+	write:usb_serial_tx
+};
\ No newline at end of file
Index: build_tree/bootLoader/src/lib/serial-pxa.c
diff -u /dev/null build_tree/bootLoader/src/lib/serial-pxa.c:1.1.1.2
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/serial-pxa.c	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,210 @@
+/*
+ * serial-pxa.c: PXA250/210 serial port driver
+ *
+ * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Copyright (C) 2002  Jeff Sutherland <jeffs@accelent.com>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/serial.h>
+#include <blob/types.h>
+
+
+/* using an Xscale CPU and not having any serial port defined is an
+ * error, but because we're using the driver in the library we can't
+ * bail out over here
+ */
+
+# define SerialDATA  STRBR
+# define SerialFIFO  STFCR
+# define SerialLCR   STLCR
+# define SerialMCR   STMCR
+# define SerialLSR   STLSR
+# define SerialIER   STIER
+# define SerialMSR   STMSR
+
+
+/* flush serial input queue. returns 0 on success or negative error
+ * number otherwise
+ */
+static int pxa_serial_flush_input(void)
+{
+	volatile u32 tmp;
+
+	/* keep on reading as long as the receiver is not empty */
+	while(SerialLSR & LSR_DR) {
+		if(SerialLSR & (LSR_FE | LSR_PE | LSR_OE))
+			return -ESERIAL;
+
+		tmp = SerialDATA;
+	}
+
+	return 0;
+}
+
+
+/* flush output queue. returns 0 on success or negative error number
+ * otherwise.  This only waits for space in the tx fifo, NOT until the fifo
+ * has completely emptied.
+ */
+static int pxa_serial_flush_output(void)
+{
+	/* wait until the transmitter is no longer busy */
+	while(SerialLSR & ~LSR_TDRQ) ;
+
+	return 0;
+}
+
+
+/* initialise serial port at the request baudrate. returns 0 on
+ * success, or a negative error number otherwise
+ */
+static int pxa_serial_init(serial_baud_t baud)
+{
+	u32 divisor;
+
+	/* Use Standard UART */
+
+	/* Aeronix: enable STUART clock */
+	CKEN |= CKEN5_STUART;
+
+	/* get correct divisor */
+	switch(baud) {
+	case baud_1200:
+		divisor = 768;
+		break;
+
+	case baud_9600:
+		divisor = 96;
+		break;
+
+	case baud_19200:
+		divisor = 48;
+		break;
+
+	case baud_38400:
+		divisor = 24;
+		break;
+
+	case baud_57600:
+		divisor = 16;
+		break;
+
+	case baud_115200:
+		divisor = 8;
+		break;
+
+	case baud_230400:
+		divisor = 4;
+		break;
+
+	default:
+		return -ERANGE;
+	}
+
+	/* switch receiver and transmitter off */
+	SerialLCR = 0;
+	SerialIER = 0;
+	SerialFIFO = 0;
+	
+	/* Gain access to divisor latch */
+	SerialLCR = LCR_WLS0 | LCR_WLS1 | LCR_DLAB;
+
+	/* Load baud rate divisor in two steps, lsb, then msb of value */
+
+	SerialDATA = divisor & 0xff;
+	SerialIER = (divisor >> 8) & 0xff;
+	
+
+	/* set the port to sensible defaults (no break, no interrupts,
+	 * no parity, 8 databits, 1 stopbit, transmitter and receiver
+	 * enabled), reset dlab bit:
+	 */
+	SerialLCR = LCR_WLS1 | LCR_WLS0;
+
+	/* turn the receiver and transmitter back on */
+	SerialIER = IER_UUE;
+
+	return 0;
+}
+
+
+/* check if there is a character available to read. returns 1 if there
+ * is a character available, 0 if not, and negative error number on
+ * failure */
+static int pxa_serial_poll(void)
+{
+	/* check for errors */
+	if(SerialLSR & (LSR_FE | LSR_PE | LSR_OE))
+		return -ESERIAL;
+
+	if(SerialLSR & LSR_DR)
+		return 1;
+	else
+		return 0;
+}
+
+
+/* read one character from the serial port. return character (between
+ * 0 and 255) on success, or negative error number on failure. this
+ * function is blocking */
+static int pxa_serial_read(void)
+{
+	int rv;
+
+	for(;;) {
+		rv = pxa_serial_poll();
+
+		if(rv < 0)
+			return rv;
+
+		if(rv > 0)
+			return SerialDATA & 0xff;
+	}
+}
+
+
+/* write character to serial port. return 0 on success, or negative
+ * error number on failure. this function is blocking
+ */
+static int pxa_serial_write(int c)
+{
+	/* wait for room in the transmit FIFO */
+	while((SerialLSR & LSR_TDRQ) == 0) {
+	}
+
+	SerialDATA = c & 0xff;
+
+	return 0;
+}
+
+
+/* export serial driver */
+serial_driver_t pxa_serial_driver = {
+	init:		pxa_serial_init,
+	read:		pxa_serial_read,
+	write:		pxa_serial_write,
+	poll:		pxa_serial_poll,
+	flush_input:	pxa_serial_flush_input,
+	flush_output:	pxa_serial_flush_output
+};
Index: build_tree/bootLoader/src/lib/serial-sa11x0.c
diff -u build_tree/bootLoader/src/lib/serial-sa11x0.c:1.1.1.1 build_tree/bootLoader/src/lib/serial-sa11x0.c:removed
--- build_tree/bootLoader/src/lib/serial-sa11x0.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/serial-sa11x0.c	Tue Jan  8 14:21:47 2008
@@ -1,245 +0,0 @@
-/*
- * serial-sa11x0.c: StrongARM SA11x0 serial port driver
- *
- * Copyright (C) 2002  Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- *
- * $Id: serial-sa11x0.c,v 1.2 2002/01/03 16:07:18 erikm Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-#ident "$Id: serial-sa11x0.c,v 1.2 2002/01/03 16:07:18 erikm Exp $"
-
-#ifdef HAVE_CONFIG_H
-# include <blob/config.h>
-#endif
-
-#include <blob/arch.h>
-#include <blob/errno.h>
-#include <blob/sa1100.h>
-#include <blob/serial.h>
-#include <blob/types.h>
-
-
-
-
-#if defined USE_SERIAL1
-
-# define SerialUTSR0 Ser1UTSR0
-# define SerialUTSR1 Ser1UTSR1
-
-# define SerialUTDR Ser1UTDR
-
-# define SerialUTCR0 Ser1UTCR0
-# define SerialUTCR1 Ser1UTCR1
-# define SerialUTCR2 Ser1UTCR2
-# define SerialUTCR3 Ser1UTCR3
-
-#else /* defined USE_SERIAL3 */
-
-/* using an SA11x0 CPU and not having any serial port defined is an
- * error, but because we're using the driver in the library we can't
- * bail out over here
- */
-
-# define SerialUTSR0 Ser3UTSR0
-# define SerialUTSR1 Ser3UTSR1
-
-# define SerialUTDR Ser3UTDR
-
-# define SerialUTCR0 Ser3UTCR0
-# define SerialUTCR1 Ser3UTCR1
-# define SerialUTCR2 Ser3UTCR2
-# define SerialUTCR3 Ser3UTCR3
-
-#endif
-
-
-
-
-/* flush serial input queue. returns 0 on success or negative error
- * number otherwise
- */
-static int sa11x0_serial_flush_input(void)
-{
-	volatile u32 tmp;
-
-	/* keep on reading as long as the receiver is not empty */
-	while(SerialUTSR1 & UTSR1_RNE) {
-		if(SerialUTSR1 & (UTSR1_PRE | UTSR1_FRE | UTSR1_ROR))
-			return -ESERIAL;
-
-		tmp = SerialUTDR;
-	}
-
-	return 0;
-}
-
-
-
-
-/* flush output queue. returns 0 on success or negative error number
- * otherwise
- */
-static int sa11x0_serial_flush_output(void)
-{
-	/* wait until the transmitter is no longer busy */
-	while(SerialUTSR1 & UTSR1_TBY) {
-	}
-
-	return 0;
-}
-
-
-
-
-/* initialise serial port at the request baudrate. returns 0 on
- * success, or a negative error number otherwise
- */
-static int sa11x0_serial_init(serial_baud_t baud)
-{
-	u32 divisor;
-
-	/* get correct divisor */
-	switch(baud) {
-	case baud_1200:
-		divisor = 191;
-		break;
-
-	case baud_9600:
-		divisor = 23;
-		break;
-
-	case baud_19200:
-		divisor = 11;
-		break;
-
-	case baud_38400:
-		divisor = 5;
-		break;
-
-	case baud_57600:
-		divisor = 3;
-		break;
-
-	case baud_115200:
-		divisor = 1;
-		break;
-
-	case baud_230400:
-		divisor = 0;
-		break;
-
-	default:
-		return -ERANGE;
-	}
-
-#if defined USE_SERIAL1
-	/* select UART use for serial port 1 or otherwise we won't see
-	 * anything at all */
-	Ser1SDCR0 = SDCR0_UART;
-#endif	
-
-	sa11x0_serial_flush_output();
-
-	/* switch receiver and transmitter off */
-	SerialUTCR3 = 0x00;
-	
-	/* clear sticky bits in control register 3 */
-	SerialUTSR0 = 0xff;
-
-	/* set the port to sensible defaults (no break, no interrupts,
-	 * no parity, 8 databits, 1 stopbit, transmitter and receiver
-	 * enabled)
-	 */
-	SerialUTCR0 = ( UTCR0_1StpBit | UTCR0_8BitData );
-	SerialUTCR1 = 0;
-	SerialUTCR2 = divisor;
-
-	/* turn the receiver and transmitter back on */
-	SerialUTCR3 = ( UTCR3_RXE | UTCR3_TXE );
-
-	return 0;
-}
-
-
-
-
-/* check if there is a character available to read. returns 1 if there
- * is a character available, 0 if not, and negative error number on
- * failure */
-static int sa11x0_serial_poll(void)
-{
-	/* check for errors */
-	if(SerialUTSR1 & (UTSR1_PRE | UTSR1_FRE | UTSR1_ROR))
-		return -ESERIAL;
-
-	if(SerialUTSR1 & UTSR1_RNE)
-		return 1;
-	else
-		return 0;
-}
-
-
-
-
-/* read one character from the serial port. return character (between
- * 0 and 255) on success, or negative error number on failure. this
- * function is blocking */
-static int sa11x0_serial_read(void)
-{
-	int rv;
-
-	for(;;) {
-		rv = sa11x0_serial_poll();
-
-		if(rv < 0)
-			return rv;
-
-		if(rv > 0)
-			return SerialUTDR & 0xff;
-	}
-}
-
-
-
-
-/* write character to serial port. return 0 on success, or negative
- * error number on failure. this function is blocking
- */
-static int sa11x0_serial_write(int c)
-{
-	/* wait for room in the transmit FIFO */
-	while((SerialUTSR0 & UTSR0_TFS) == 0) {
-	}
-
-	SerialUTDR = c & 0xff;
-
-	return 0;
-}
-
-
-
-
-/* export serial driver */
-serial_driver_t sa11x0_serial_driver = {
-	init:		sa11x0_serial_init,
-	read:		sa11x0_serial_read,
-	write:		sa11x0_serial_write,
-	poll:		sa11x0_serial_poll,
-	flush_input:	sa11x0_serial_flush_input,
-	flush_output:	sa11x0_serial_flush_output
-};
Index: build_tree/bootLoader/src/lib/serial.c
diff -u build_tree/bootLoader/src/lib/serial.c:1.1.1.1 build_tree/bootLoader/src/lib/serial.c:1.1.1.2
--- build_tree/bootLoader/src/lib/serial.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/serial.c	Fri Nov  9 09:44:05 2007
@@ -1,12 +1,12 @@
 /*-------------------------------------------------------------------------
  * Filename:      serial.c
- * Version:       $Id: serial.c,v 1.7 2002/01/05 20:14:34 erikm Exp $
+ * Version:       $Id: serial.c,v 1.12 2003/09/04 17:42:56 russd Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   Serial utilities for blob
  * Created at:    Tue Aug 24 20:25:00 1999
  * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
- * Modified at:   Mon Oct  4 20:11:14 1999
+ *                Abraham van der Merwe <abraham@2d3d.co.za>
  *-----------------------------------------------------------------------*/
 /*
  * serial.c: Serial utilities for blob
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: serial.c,v 1.7 2002/01/05 20:14:34 erikm Exp $"
+#ident "$Id: serial.c,v 1.12 2003/09/04 17:42:56 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -39,17 +39,22 @@
 #include <blob/arch.h>
 #include <blob/errno.h>
 #include <blob/led.h>
-#include <blob/sa1100.h>
 #include <blob/serial.h>
 #include <blob/time.h>
 
-
-
-
 serial_driver_t *serial_driver;
 
-
-
+const int baud_rates[] = {
+	1200,
+	2400,
+	4800,
+	9600,
+	19200,
+	38400,
+	57600,
+	115200,
+	230400
+};
 
 /* initialise serial port at the request baudrate. returns 0 on
  * success, or a negative error number on failure
@@ -228,6 +233,17 @@
 
 
 /*
+ * Write a single character to the serial port.
+ */
+void SerialOutputChar (const char c)
+{
+   serial_write (c);
+}
+
+
+
+
+/*
  * read a string with maximum length len from the serial port
  * using a timeout of timeout seconds
  *
@@ -235,7 +251,7 @@
  * the function returns the number of bytes read _excluding_
  * the trailing zero
  */
-int  SerialInputString(char *s, const int len, const int timeout)
+int  SerialInputString(char *s, const int len, int timeout)
 {
 	u32 startTime, currentTime;
 	int c;
@@ -243,17 +259,17 @@
 	int numRead;
 	int skipNewline = 1;
 	int maxRead = len - 1;
-	
-	startTime = TimerGetTime();
+
+	timeout *= timer_tps();
+	startTime = timer_read();
 
 	for(numRead = 0, i = 0; numRead < maxRead;) {
 		/* try to get a byte from the serial port */
 		while(serial_poll() == 0) {
-			currentTime = TimerGetTime();
+			currentTime = timer_read();
 
 			/* check timeout value */
-			if((currentTime - startTime) > 
-			   (timeout * TICKS_PER_SECOND)) {
+			if((currentTime - startTime) > timeout) {
 				/* timeout */
 				s[i++] = '\0';
 				return(numRead);
@@ -294,7 +310,7 @@
  * this one just reads a block of characters without looking at
  * special characters.
  */
-int  SerialInputBlock(char *buf, int bufsize, const int timeout)
+int  SerialInputBlock(char *buf, int bufsize, int timeout)
 {
 	u32 startTime, currentTime;
 	int c;
@@ -302,16 +318,16 @@
 	int numRead;
 	int maxRead = bufsize;
 	
-	startTime = TimerGetTime();
+	timeout *= timer_tps();
+	startTime = timer_read();
 
 	for(numRead = 0, i = 0; numRead < maxRead;) {
 		/* try to get a byte from the serial port */
 		while(serial_poll() == 0) {
-			currentTime = TimerGetTime();
+			currentTime = timer_read();
 
 			/* check timeout value */
-			if((currentTime - startTime) > 
-			   (timeout * TICKS_PER_SECOND)) {
+			if((currentTime - startTime) > timeout) {
 				/* timeout! */
 				return(numRead);
 			}
Index: build_tree/bootLoader/src/lib/serial_usb.c
diff -u /dev/null build_tree/bootLoader/src/lib/serial_usb.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/serial_usb.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,67 @@
+/*
+ * serial_usb.c: Serial over usb utilities for blob
+ *
+ * Copyright (c) 2004, Intel Corporation (alek.du@intel.com)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: serial_usb.c,v 1.3 2004/09/07 02:44:16 bvd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+
+#include <blob/arch.h>
+#include <blob/errno.h>
+#include <blob/led.h>
+#include <blob/serial_usb.h>
+#include <blob/time.h>
+
+usb_serial_driver_t *usb_serial_driver;
+
+
+
+int usb_serial_init()
+{
+#ifdef BLOB_DEBUG
+	if(usb_serial_driver == NULL) {
+		printf("Serial over USB driver handle is NULL!\n");
+		return -ERANGE;
+	}
+#endif
+
+	return usb_serial_driver->init();
+}
+
+
+
+
+int usb_serial_read(char *buf,int size)
+{
+	return usb_serial_driver->read(buf,size);
+}
+
+
+
+
+int usb_serial_write(const char *buf,int size)
+{
+	return usb_serial_driver->write(buf,size);
+}
+
+
Index: build_tree/bootLoader/src/lib/tar.c
diff -u /dev/null build_tree/bootLoader/src/lib/tar.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/tar.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,486 @@
+/**********************************************************************
+ * tar archive framework
+ *
+ * Copyright (C) 2002, Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ * $Id: tar.c,v 1.5 2002/07/25 14:08:00 seletz Exp $
+ *
+ */
+
+/**********************************************************************
+ * Includes
+ */
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/types.h>
+#include <blob/errno.h>
+#include <blob/util.h>
+#include <blob/command.h>
+
+#include <blob/init.h>
+#include <blob/generic_io.h>
+#include <blob/tar.h>
+
+/**********************************************************************
+ * defines
+ */
+#define TAR_DEBUG 0
+
+#if TAR_DEBUG
+#	define DBG( x, args... )	if ( tar_dbg>x ) printf( args );
+#else
+#	define DBG( x, args... )	
+#endif
+
+/**********************************************************************
+ * module globals
+ */
+#if TAR_DEBUG
+static int tar_dbg = 1;
+#else
+static int tar_dbg = 0;
+#endif
+
+static char module_version[] = "$Id: tar.c,v 1.5 2002/07/25 14:08:00 seletz Exp $";
+
+/**********************************************************************
+ * static functions
+ */
+static int tar_skip_file( tar_arch_t *arch );
+static int tar_file_search( tar_arch_t *arch, char *file );
+static int tar_xtract_blocks( tar_arch_t *arch, char *dest );
+static int tar_fileinfo_get( tar_arch_t *arch );
+static int tar_hdr_chk( tar_hdr_posix_t *hdr );
+static int tar_hdr_fname_get( tar_hdr_posix_t *hdr, char **fname );
+static int tar_hdr_fsize_get( tar_hdr_posix_t *hdr, unsigned long *size );
+static int tar_from_oct( unsigned char *start, size_t digits, unsigned long *value );
+
+/* io driver stuff */
+static int tar_io_conf( io_driver_t * io, void *conf );
+static int tar_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+static int tar_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io );
+
+/**********************************************************************/
+/**********************************************************************/
+/**********************************************************************/
+
+/* set debug level */
+void tar_dbg_set( int lvl )
+{
+	tar_dbg = lvl;
+}
+
+/**********************************************************************
+ * io driver for tar archives
+ */
+static void init_tar_default_io( void )
+{
+	int ret;
+	static io_driver_t	def_tar_io_driver;
+	static tar_arch_t	def_tar_arch;
+
+	tar_dbg_set(0);
+
+	/* init default tar drv */
+	ret = tar_io_init( &def_tar_io_driver, &def_tar_arch );
+	if ( ret ) return;
+
+	ret = io_register( &def_tar_io_driver, "TAR" );
+	if ( ret ) return;
+}
+__initlist(init_tar_default_io, INIT_LEVEL_OTHER_STUFF + 2);
+
+int tar_io_init( io_driver_t *io, tar_arch_t *arch )
+{
+	if ( !io || !arch )
+		return -EINVAL;
+
+	DBG( 5, "%s: io=%p, arch=%p\n", __FUNCTION__,
+	  io, arch );
+
+	io->conf = tar_io_conf;
+	io->read = tar_io_read;
+	io->write = tar_io_write;
+	io->private_data = (void *)arch;
+
+	/* filled by configure */
+	io->io_size = 0;
+	
+	/* filled for us by io_chain() */
+	io->child_io = NULL;
+
+	return 0;
+}
+
+/* the user gives us a filename in conf */
+static int tar_io_conf( io_driver_t * io, void *conf )
+{
+	int ret;
+	char *name;
+	io_driver_t *child;
+	tar_arch_t *arch;
+
+	DBG( 5, "%s: io=%p, conf=%p\n", __FUNCTION__,
+	  io, conf );
+
+	if ( !io || !conf )
+		return -EINVAL;
+
+	arch = (tar_arch_t*)io->private_data;
+	if ( !arch )
+		return -EINVAL;
+
+	child = io_get_child( io );
+	if ( !child )
+		return -EINVAL;
+
+	name = (char *)conf;
+	DBG( 5, "%s: name=%s\n", __FUNCTION__, name );
+
+	/* init new archive struct */
+	ret = tar_init( arch, child );
+	if ( ret )
+		return -EINVAL;
+
+	/* try to find file */
+	ret = tar_file_search( arch, name );
+	if ( ret )
+		return -EINVAL;
+
+	/* set io_size to filesize */
+	io->io_size = arch->f_size;
+
+	return 0;
+}
+
+static int tar_io_read( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	io_driver_t *child;
+	tar_arch_t *arch;
+	u32 offset;
+
+	arch = (tar_arch_t*)io->private_data;
+	if ( !arch )
+		return -EINVAL;
+
+	child = io_get_child( io );
+	if ( !child )
+		return -EINVAL;
+
+	offset = arch->f_start_block*TAR_BLOCKSIZE;
+
+	DBG( 3, "%s: dest=%p, src=%p(=%p), amount=%d, child=%p\n", __FUNCTION__,
+			dest, src, (char *)((u32)src + offset), amount, child );
+
+	return io_read(dest, (unsigned char *)(offset + (u32)src), amount, child );
+}
+
+static int tar_io_write( unsigned char *dest, unsigned char *src, size_t amount, io_driver_t *io )
+{
+	return -EINVAL;
+}
+
+/**********************************************************************
+ * TAR functions
+ */
+/* init archive struct */
+int tar_init( tar_arch_t *arch, io_driver_t *io )
+{
+	DBG( 1, "%s: arch=%p, io=%p\n", __FUNCTION__, arch, io );
+
+	DBG( 1, "tar: version %s\n", module_version );
+
+	if ( !arch ) {
+		return -EINVAL;
+	}
+
+	arch->io_driver=io;
+	arch->block = 0;
+	arch->f_size=0l;
+	arch->f_blocks=0l;
+	arch->filename[0]=0;
+
+	return 0;
+}
+
+/* do a "tar tv" */
+int tar_tell( tar_arch_t *arch )
+{
+	int ret = 0;
+	int fini = 0;
+	int files = 0;
+
+	DBG( 1, "%s: arch=%p\n", __FUNCTION__, arch );
+
+	if ( !arch )
+		return -EINVAL;
+
+	/* reset to block 0 */
+	arch->block = 0;
+
+	while ( !fini ) {
+		ret = tar_fileinfo_get( arch );
+		if ( ret ) {
+			fini = 1;
+			continue;
+		}
+
+		files++;
+
+		printf( "%s %ld bytes, %d blocks\n",
+				arch->filename,
+				arch->f_size,
+				arch->f_blocks );
+
+		/* skip file */
+		ret = tar_skip_file( arch );
+		if ( ret ) {
+			printf( "tar: tar_skip_file: %d\n", ret );
+			return -EINVAL;
+		}
+	}
+
+	printf( "tar: %d files.\n", files );
+
+	return 0;
+}
+
+/* do a "tar xv" */
+int tar_xtract( tar_arch_t *arch, char *filename, char *dest )
+{
+	int ret = 0;
+
+	DBG( 1, "%s: arch=%p, filename=%p, dest=%p\n", __FUNCTION__, arch, filename,
+	  dest );
+
+	if ( !arch || !filename )
+		return -EINVAL;
+
+	/* reset to block 0 */
+	arch->block = 0;
+
+	ret = tar_file_search( arch, filename );
+	if ( ret ) {
+		printf( "tar: cant find file '%s' in archive (%d).\n",
+			   filename, ret );	
+		return -EINVAL;
+	}
+
+	ret = tar_xtract_blocks( arch, dest );
+	if ( ret ) {
+		printf( "tar: cant extract file '%s' from archive (%d).\n",
+			   filename, ret );	
+		return -EINVAL;
+	}
+
+	printf( "tar: extracted file '%s', %ld bytes (%d blocks).\n",
+			arch->filename, arch->f_size, arch->f_blocks );
+
+	return 0;
+}
+
+/**********************************************************************
+ * Static functions
+ */
+
+static int tar_file_search( tar_arch_t *arch, char *file )
+{
+	int ret = 0;
+	int fini = 0;
+	int found = 0;
+
+	DBG( 1, "%s: arch=%p, file=%p\n", __FUNCTION__, arch, file );
+
+	if ( !arch || !file )
+		return -EINVAL;
+
+	while ( !fini ) {
+		ret = tar_fileinfo_get( arch );
+		if ( ret ) {
+			fini = 1;
+			continue;
+		}
+
+		DBG( 5, "%s %ld bytes, %d blocks\n",
+				arch->filename,
+				arch->f_size,
+				arch->f_blocks );
+
+		if ( strncmp( arch->filename, file, 255 ) == 0 ) {
+			found = 1;
+			fini = 1;
+			continue;
+		}
+
+		/* skip file */
+		ret = tar_skip_file( arch );
+		if ( ret ) {
+			printf( "tar: tar_skip_file: %d\n", ret );
+			return -EINVAL;
+		}
+	}
+
+	return found?0:1;
+}
+/* skip to next file, if any */
+static int tar_skip_file( tar_arch_t *arch )
+{
+	DBG( 1, "%s: arch=%p\n", __FUNCTION__, arch );
+
+	if ( !arch )
+		return -EINVAL;
+
+	/* skip data */
+	arch->block += arch->f_blocks;
+	return 0;
+}
+
+/* extract current file to memory. */
+static int tar_xtract_blocks( tar_arch_t *arch, char *dest )
+{
+	int ret = 0;
+	unsigned long size;
+
+	DBG( 1, "%s: arch=%p, dest=%p\n", __FUNCTION__, arch, dest );
+
+	if ( !arch || !dest )
+		return -EINVAL;
+
+	size = arch->f_size;
+	if ( !size )
+		return -EINVAL;
+
+	ret = io_read( dest, (unsigned char*)(arch->f_start_block*TAR_BLOCKSIZE), arch->f_size, arch->io_driver );
+	if ( ret )
+		return ret;
+
+	return 0;
+}
+
+/* get current file infos out of tar header */
+static int tar_fileinfo_get( tar_arch_t *arch )
+{
+	int ret = 0;
+	tar_hdr_posix_t *phdr = NULL;
+
+	if ( !arch )
+		return -EINVAL;
+
+	/* get header */
+	ret = io_read( arch->buffer, (unsigned char *)(arch->block*TAR_BLOCKSIZE), TAR_BLOCKSIZE, arch->io_driver );
+	if ( ret ) {
+		printf( "tar: cant get block: %d\n", ret );
+		goto DONE;
+	}
+	arch->block++;
+
+	/* and decode infos */
+	phdr = (tar_hdr_posix_t*)arch->buffer;
+	ret = tar_hdr_chk( phdr );
+	if ( ret ) {
+		printf( "tar: no posix tar header: %d\n", ret );
+		ret = -EINVAL;
+		goto DONE;
+	}
+
+	ret = tar_hdr_fsize_get( phdr, &arch->f_size );
+	if ( ret ) {
+		printf( "tar: cant decode file size: %d\n", ret );
+		ret = ret;
+		goto DONE;
+	}
+
+	arch->f_start_block = arch->block;
+	arch->f_blocks = (arch->f_size/TAR_BLOCKSIZE) + (arch->f_size%TAR_BLOCKSIZE?1:0);
+	printf( "tar: %s %ld bytes, %d blocks\n",  phdr->name,
+			arch->f_size, arch->f_blocks );
+
+	strncpy( arch->filename, phdr->name, 100 );
+	arch->filename[100] = 0;
+
+	ret = 0;
+DONE:
+	/* reset fileinfos on error */
+	if ( ret ) {
+		arch->f_size=0;
+		arch->f_start_block = 0;
+		arch->f_blocks=0;
+		arch->filename[0]=0;
+	}
+	return ret;
+}
+
+/* check wether or not we have a posix tar header */
+static int tar_hdr_chk( tar_hdr_posix_t *hdr )
+{
+	int ret = 0;
+
+	if ( !hdr )
+		return -EINVAL;
+
+	/* check magic */
+	ret = strncmp( hdr->magic, TMAGIC, 5 ); // "ustar"
+	if ( ret != 0 )
+		return -EINVAL;
+
+	return 0;
+}
+
+/* get file size from header */
+static int tar_hdr_fsize_get( tar_hdr_posix_t *hdr, unsigned long *size )
+{
+	return tar_from_oct( hdr->size, 11, size );
+}
+
+/* get filename from header */
+static int tar_hdr_fname_get( tar_hdr_posix_t *hdr, char **fname )
+{
+	if ( !hdr || !fname )
+		return -EINVAL;
+
+	*fname = hdr->name;
+	return 0;
+}
+
+/* decode octal BCD data from header */
+static int tar_from_oct( unsigned char *start, size_t digits, unsigned long *value )
+{
+	unsigned long val = 0l;
+
+	DBG( 5, "%s: start=%p, digits=%d, value=%p\n", __FUNCTION__,
+			start, digits, value );
+
+	if ( !start || !value )
+		return -EINVAL;
+
+	while ( digits ) {
+		if ( (*start > '7') || (*start < '0') )
+			return -EINVAL;
+
+		DBG( 5, "%s: %c, val=%ld\n", __FUNCTION__, *start, val );
+
+		val = ( val << 3 ) | (*start - '0');
+		--digits;
+		++start;
+	}
+
+	*value = val;
+	return 0;
+}
+
Index: build_tree/bootLoader/src/lib/terminal.c
diff -u build_tree/bootLoader/src/lib/terminal.c:1.1.1.1 build_tree/bootLoader/src/lib/terminal.c:removed
--- build_tree/bootLoader/src/lib/terminal.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/terminal.c	Tue Jan  8 14:21:47 2008
@@ -1,53 +0,0 @@
-/*
- * terminal.c: terminal reset functions
- *
- * Copyright (C) 1999 2000 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
- *
- * $Id: terminal.c,v 1.5 2002/01/03 16:07:18 erikm Exp $
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 2 of the License, or
- * (at your option) any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program; if not, write to the Free Software
- * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
- *
- */
-
-#ident "$Id: terminal.c,v 1.5 2002/01/03 16:07:18 erikm Exp $"
-
-#ifdef HAVE_CONFIG_H
-# include <blob/config.h>
-#endif
-
-#include <blob/serial.h>
-#include <blob/terminal.h>
-
-
-
-
-char resethelp[] = "reset\n"
-"Reset terminal\n";
-
-
-
-
-int reset_terminal(int argc, char *argv[])
-{
-	int i;
-
-	SerialOutputString("          c");
-	for(i = 0; i < 100; i++)
-		serial_write('\n');
-
-	SerialOutputString("c");
-
-	return 0;
-}
Index: build_tree/bootLoader/src/lib/tftp.c
diff -u /dev/null build_tree/bootLoader/src/lib/tftp.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/tftp.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,176 @@
+/*
+ *  tftp.c
+ *
+ *  Copyright 1996-2001 Russell King
+ *  Copyright 2002,2003 Stefan Eletzhofer <stefan.eletzhofer@eletztrick.de>
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License version 2 as
+ * published by the Free Software Foundation.
+ */
+#include <blob/util.h>
+#include <blob/serial.h>
+#include <blob/errno.h>
+
+#include <net/net.h>
+#include <net/ip_bits.h>
+#include <net/arp.h>
+#include <net/tftp.h>
+
+#undef TFTP_DEBUG
+#ifdef TFTP_DEBUG
+static int dbg = 1;
+#	define DBG( x, args... )	if ( dbg>=x ) printf( args )
+#else
+#	define DBG( x, args... ) ;
+#endif
+
+static const unsigned char tftp_txpacket[] =
+	{					/*+destination				*/
+	 					/*+source				*/
+	 					/* proto				*/
+	 /* IP */
+	 0x45, 0x00, 0x00, 0xa4,		/* ver/ihl, TOS, length			*/
+	 0x00, 0x00,				/*+id					*/
+	 0x00, 0x00, 0x40, 0x11,		/* frag off, ttl, proto			*/
+	 0x00, 0x00,				/*+checksum				*/
+	 0x00, 0x00, 0x00, 0x00,		/*+source address			*/
+	 0x00, 0x00, 0x00, 0x00,		/*+destination address			*/
+	 /* UDP */
+	 0x80, 0x00,				/* source port				*/
+	 0x00, 0x45,				/* destination port			*/
+	 0x00, 0x90,				/* length (inc header)			*/
+	 0x00, 0x00,				/*+checksum				*/
+	 /* TFTP */
+	 0x00, 0x01				/* opcode: RRQ				*/
+	 					/* filename				*/
+	};
+
+static unsigned char serverhwaddress[6];
+static char octet[] = "octet";
+static unsigned char tftp_tx[200];
+static unsigned char tftp_rx[800];
+static          int  serverport;
+static unsigned int  tftp_length;
+static unsigned int  block;
+static unsigned long tftp_received;
+
+int tftp_rcv(unsigned long *addr)
+{
+	unsigned int tftp_off, tftp_sz, nblk;
+	unsigned char *tftp;
+
+	DBG( 5, "%s: addr=%p\n", __FUNCTION__, addr );
+
+	tftp_off = ipbits_rcv (tftp_rx, 800, &tftp_sz, serverport, 0x8000);
+	if (!tftp_off || tftp_rx[tftp_off] != 0)
+		return 0;
+
+	tftp = tftp_rx + tftp_off;
+	switch (tftp[1]) {
+	case 5: /* error */
+		printascii ("\nTFTP error: ");
+		printascii (tftp + 4);
+		printch ('\n');
+		return -2;
+		break;
+
+	case 3:	/* OpCode: DATA, acknowledge block */
+		if (block == 0) {
+			serverport = (tftp[-8] << 8) | tftp[-7];
+							/* copy replied-source port	*/
+			tftp_tx[OFF_UDP + 2] = serverport >> 8;
+			tftp_tx[OFF_UDP + 3] = serverport;
+			tftp_tx[OFF_UDP + 5] = 12;
+			tftp_tx[OFF_IP + 3] = 32;
+			tftp_tx[OFF_TFTP + 1] = 4;	/* OpCode: ACK */
+			block = 1;
+			tftp_length = 12;
+		}
+		nblk = (tftp[2] << 8) | tftp[3];
+		if (nblk == (block%(1<<16))) {
+			tftp_tx[OFF_TFTP + 2] = nblk >> 8;
+			tftp_tx[OFF_TFTP + 3] = nblk;
+			ipbits_tx (tftp_tx, tftp_length );
+			memcpy((void *)*addr, tftp + 4, tftp_sz - 4);
+			*addr += tftp_sz - 4;
+			tftp_received += tftp_sz - 4;
+			if ((block & 31) == 1) {
+				printch ('.');
+				DBG( 5, "%s: nblk=%d, block=%d, sz=%d\n", __FUNCTION__, nblk, block, tftp_sz );
+			}
+			block ++;
+		} else {
+			if (nblk == ((block-1)%(1<<16)))
+				ipbits_tx (tftp_tx, tftp_length );
+		}
+		if (tftp_sz != 516)
+			return 1;
+		return -1;
+	default:
+		return 0;
+	}
+}	
+
+int do_tftp(char *file, unsigned long addr, unsigned long *size )
+{
+	int ret;
+	int finished;
+	unsigned int i;
+	int retry = 8;
+
+	DBG( 1, "%s: file='%s', addr=%08lx\n", __FUNCTION__, file, addr );
+
+	if (do_arp(serverhwaddress, serveripaddress) < 0)
+		return -ETIMEOUT;
+
+	serverport = -1;
+	tftp_length = 144;
+	block = 0;
+	tftp_received = 0;
+
+	memzero(tftp_tx, sizeof (tftp_tx));
+	memcpy(tftp_tx + 14, tftp_txpacket, sizeof (tftp_txpacket));
+	memcpy(tftp_tx + OFF_ETHER, serverhwaddress, 6);
+	memcpy(tftp_tx + OFF_IP + 12, clientipaddress, 4);
+	memcpy(tftp_tx + OFF_IP + 16, serveripaddress, 4);
+
+	for (i = 0; file[i]; i++)
+		tftp_tx[OFF_TFTP + 2 + i] = file[i];
+	memcpy(tftp_tx + OFF_TFTP + 3 + i, octet, 6);
+
+	printascii("TFTPing ");
+	printascii(file);
+
+	finished = 0;
+	do {
+		printch('*');
+		ipbits_tx(tftp_tx, tftp_length);
+		for (i = 0; i < 0x00040000 && !finished; i++) {
+			ret = tftp_rcv(&addr);
+			switch (ret) {
+			case 1:
+				finished = 1;
+				break;
+			case -1:
+				i = 0;
+				break;
+			case -2:
+				i = 0x00040000;
+				retry = 0;
+				break;
+			}
+		}
+	} while (retry-- && !finished);
+
+	if ( finished ) {
+		printf( " OK.\n" );
+		printf( "received %d blocks (%ld bytes)\n", block, tftp_received );
+		*size = tftp_received;
+		ret = 0;
+	} else {
+		printf( " ERROR\n" );
+		ret = -1;
+	}
+	return ret;
+}
Index: build_tree/bootLoader/src/lib/time-intelarm.c
diff -u /dev/null build_tree/bootLoader/src/lib/time-intelarm.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/time-intelarm.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,85 @@
+/*-------------------------------------------------------------------------
+ * Filename:      time-intelarm.c
+ * Version:       $Id: time-intelarm.c,v 1.1 2003/09/04 17:39:01 russd Exp $
+ * Copyright:     Copyright (C) 1999, Erik Mouw
+ * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Description:   Some easy timer functions for blob
+ * Created at:    Tue Aug 24 21:08:25 1999
+ * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Modified at:   Sun Oct  3 21:10:21 1999
+ *-----------------------------------------------------------------------*/
+/*
+ * timer.c: Timer functions for blob
+ *
+ * Copyright (C) 1999 2000 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: time-intelarm.c,v 1.1 2003/09/04 17:39:01 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/led.h>
+#include <blob/arch.h>
+#include <blob/time.h>
+
+static void intelarm_timer_init(void)
+{
+	/* clear counter */
+	OSCR = 0;
+
+	/* we don't want to be interrupted */
+	OIER = 0;
+
+	/* wait until OSCR > 0 */
+	while(OSCR == 0) ;
+
+	/* clear match register 0 */
+	OSMR0 = 0;
+
+	/* clear match bit for OSMR0 */
+	OSSR = OSSR_M0;
+}
+
+/* returns the time in 1/TICKS_PER_SECOND seconds */
+static u32 intelarm_timer_read(void)
+{
+	return((u32) OSCR);
+}
+
+static int intelarm_timer_overflow(void)
+{
+	return(OSSR & OSSR_M0);
+}
+
+static void intelarm_timer_overflow_clear(void)
+{
+	OSSR = OSSR_M0;
+}
+
+/* export time driver */
+timer_driver_t intelarm_timer_driver = {
+	init:		intelarm_timer_init,
+	read:		intelarm_timer_read,
+	overflow:	intelarm_timer_overflow,
+	overflow_clear:	intelarm_timer_overflow_clear,
+	tps:		TICKS_PER_SECOND,
+};
+
Index: build_tree/bootLoader/src/lib/time-null.c
diff -u /dev/null build_tree/bootLoader/src/lib/time-null.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/time-null.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,75 @@
+/*-------------------------------------------------------------------------
+ * Filename:      time-null.c
+ * Version:       $Id: time-null.c,v 1.1 2003/09/04 17:39:01 russd Exp $
+ * Copyright:     Copyright (C) 1999, Erik Mouw
+ * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Description:   Best alternative? fake it (for development)
+ * Created at:    Tue Aug 24 21:08:25 1999
+ * Modified by:   Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Modified at:   Sun Oct  3 21:10:21 1999
+ *-----------------------------------------------------------------------*/
+/*
+ * timer.c: Timer functions for blob
+ *
+ * Copyright (C) 1999 2000 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#warning This is for development only, it has problems...
+
+#ident "$Id: time-null.c,v 1.1 2003/09/04 17:39:01 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/led.h>
+#include <blob/arch.h>
+#include <blob/time.h>
+
+static u32 timer;
+
+static void null_timer_init(void)
+{
+	timer = 0;
+}
+
+/* returns the time in 1/TICKS_PER_SECOND seconds */
+static u32 null_timer_read(void)
+{
+	return(timer++);
+}
+
+static int null_timer_overflow(void)
+{
+	return(0);
+}
+
+static void null_timer_overflow_clear(void)
+{
+}
+
+/* export time driver */
+timer_driver_t null_timer_driver = {
+	init:		null_timer_init,
+	read:		null_timer_read,
+	overflow:	null_timer_overflow,
+	overflow_clear:	null_timer_overflow_clear,
+	tps:		10000,
+};
+
Index: build_tree/bootLoader/src/lib/time-s3c2500.c
diff -u /dev/null build_tree/bootLoader/src/lib/time-s3c2500.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/src/lib/time-s3c2500.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,93 @@
+/*-------------------------------------------------------------------------
+ * Filename:      time-s3c2500.c
+ * Version:       $Id: time-s3c2500.c,v 1.1 2003/09/04 18:03:10 russd Exp $
+ * Copyright:     Copyright (C) 1999, Erik Mouw
+ * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
+ * Description:   Timer for the s3c2500
+ * Created at:    Tue Aug 24 21:08:25 1999
+ * Modified by:   Russ Dill <Russ.Dill@asu.edu>
+ * Modified at:   Sat Aug 23 17:50:00 2003
+ *-----------------------------------------------------------------------*/
+/*
+ * time-s3c2500.c: Timer functions for blob
+ *
+ * Copyright (C) 1999 2000 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 2 of the License, or
+ * (at your option) any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program; if not, write to the Free Software
+ * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ *
+ */
+
+#ident "$Id: time-s3c2500.c,v 1.1 2003/09/04 18:03:10 russd Exp $"
+
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+
+#include <blob/init.h>
+#include <blob/led.h>
+#include <blob/arch.h>
+#include <blob/time.h>
+#include <blob/util.h>
+
+#ifndef BUS_SPEED
+#  error You must define BUS_SPEED in your arch file
+#endif
+
+/* at a 133MHz bus speed, this will only count up to 32.2s, so
+ * do a weird counter thing. As long as its checked every 32.2s
+ * it should work fine */
+
+
+static u32 timer;
+static u32 last_val;
+
+static void s3c2500_timer_init(void)
+{
+	TMOD = 0;
+	barrier();
+	TDATA0 = 0xFFFFFFFFL;
+	barrier();
+	TMOD = TIMER_TE0;
+	last_val = timer = 0;
+}
+
+/* returns the time in 1/TICKS_PER_SECOND seconds */
+static u32 s3c2500_timer_read(void)
+{
+	u32 val = -TCNT0;
+	if (last_val >= val) timer++;
+	last_val = val;
+	return (timer << 24) | (val >> 8);
+}
+
+/* not sure what these overflow functions are supposed to do
+ * but I can't tell if there is an overflow */
+static int s3c2500_timer_overflow(void)
+{
+	return 0;
+}
+
+static void s3c2500_timer_overflow_clear(void)
+{
+}
+
+/* export time driver */
+timer_driver_t s3c2500_timer_driver = {
+	init:		s3c2500_timer_init,
+	read:		s3c2500_timer_read,
+	overflow:	s3c2500_timer_overflow,
+	overflow_clear:	s3c2500_timer_overflow_clear,
+	tps:		(GET_MHz(BUS_SPEED) * 1000000) >> 8,
+};
Index: build_tree/bootLoader/src/lib/time.c
diff -u build_tree/bootLoader/src/lib/time.c:1.1.1.1 build_tree/bootLoader/src/lib/time.c:1.1.1.2
--- build_tree/bootLoader/src/lib/time.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/time.c	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      time.c
- * Version:       $Id: time.c,v 1.3 2001/10/07 20:16:57 erikm Exp $
+ * Version:       $Id: time.c,v 1.5 2003/09/04 17:39:01 russd Exp $
  * Copyright:     Copyright (C) 1999, Erik Mouw
  * Author:        Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
  * Description:   Some easy timer functions for blob
@@ -9,7 +9,7 @@
  * Modified at:   Sun Oct  3 21:10:21 1999
  *-----------------------------------------------------------------------*/
 /*
- * timer.c: Timer functions for blob
+ * time.c: Timer functions for blob
  *
  * Copyright (C) 1999 2000 2001  Erik Mouw (J.A.K.Mouw@its.tudelft.nl)
  *
@@ -29,7 +29,7 @@
  *
  */
 
-#ident "$Id: time.c,v 1.3 2001/10/07 20:16:57 erikm Exp $"
+#ident "$Id: time.c,v 1.5 2003/09/04 17:39:01 russd Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
@@ -37,72 +37,55 @@
 
 #include <blob/init.h>
 #include <blob/led.h>
-#include <blob/sa1100.h>
+#include <blob/arch.h>
 #include <blob/time.h>
-
-
-
+#include <blob/debug.h>
 
 static int numOverflows;
+timer_driver_t *timer_driver;
 
-
-
-
-void TimerInit(void)
+void timer_init(void)
 {
-	/* clear counter */
-	OSCR = 0;
-
-	/* we don't want to be interrupted */
-	OIER = 0;
-
-	/* wait until OSCR > 0 */
-	while(OSCR == 0)
-		;
-
-	/* clear match register 0 */
-	OSMR0 = 0;
-
-	/* clear match bit for OSMR0 */
-	OSSR = OSSR_M0;
-
+	if (!timer_driver) {
+		deprintf("No timer driver defined in arch "
+			 "specific file\n");
+		return;
+	}
+	timer_driver->init();
 	numOverflows = 0;
 }
 
-
-
-
-/* returns the time in 1/TICKS_PER_SECOND seconds */
-u32  TimerGetTime(void)
+/* returns the time in 1/TICKS_PER_SECOND (tps) seconds */
+u32 timer_read(void)
 {
+	u32 ret = timer_driver->read();
+
 	/* turn LED always on after one second so the user knows that
          * the board is on
 	 */
-	if((OSCR % TICKS_PER_SECOND) < (TICKS_PER_SECOND >>7))
+	if((ret % timer_driver->tps) < (timer_driver->tps >> 7))
 		led_on();
 
-	return((u32) OSCR);
+	return ret;
 }
 
-
-
-
-int TimerDetectOverflow(void)
+int timer_overflow(void)
 {
-	return(OSSR & OSSR_M0);
+	return timer_driver->overflow();
 }
 
-
-
-void TimerClearOverflow(void)
+void timer_overflow_clear(void)
 {
-	if(TimerDetectOverflow())
+	if(timer_overflow())
 		numOverflows++;
 
-	OSSR = OSSR_M0;
+	timer_driver->overflow_clear();
 }
 
-
+int timer_tps(void)
+{
+	return timer_driver->tps;
+}
 
 void msleep(unsigned int msec)
 {
@@ -114,9 +97,9 @@
 	if(msec == 0)
 		return;
 
-	ticks = (TICKS_PER_SECOND * msec) / 1000;
+	ticks = (timer_driver->tps * msec) / 1000;
 	
-	start = TimerGetTime();
+	start = timer_read();
 
 	/* this could overflow, but it nicely wraps around which is
          * exactly what we want
@@ -125,19 +108,19 @@
 	
 	/* detect the overflow */
 	if(end < start) {
-		TimerClearOverflow();
+		timer_overflow_clear();
 		will_overflow = 1;
 	}
 	
 	do {
 		if(will_overflow && !has_overflow) {
-			if(TimerDetectOverflow())
+			if (timer_overflow())
 				has_overflow = 1;
 
 			continue;
 		}
 
-		if(TimerGetTime() >= end)
-			reached = 1;
+		if (timer_read() >= end) reached = 1;
 	} while(!reached);
 }
+
Index: build_tree/bootLoader/src/lib/util.c
diff -u build_tree/bootLoader/src/lib/util.c:1.1.1.1 build_tree/bootLoader/src/lib/util.c:1.1.1.2
--- build_tree/bootLoader/src/lib/util.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/src/lib/util.c	Fri Nov  9 09:44:05 2007
@@ -1,6 +1,6 @@
 /*-------------------------------------------------------------------------
  * Filename:      util.c
- * Version:       $Id: util.c,v 1.4 2002/01/03 16:07:18 erikm Exp $
+ * Version:       $Id: util.c,v 1.7 2002/04/26 04:43:31 timriker Exp $
  * Copyright:     Copyright (C) 1999, Jan-Derk Bakker
  * Author:        Jan-Derk Bakker <J.D.Bakker@its.tudelft.nl>
  * Description:   Simple utility functions for blob
@@ -29,15 +29,15 @@
  *
  */
 
-#ident "$Id: util.c,v 1.4 2002/01/03 16:07:18 erikm Exp $"
+#ident "$Id: util.c,v 1.7 2002/04/26 04:43:31 timriker Exp $"
 
 #ifdef HAVE_CONFIG_H
 # include <blob/config.h>
 #endif
 
+#include <blob/serial.h>
 #include <blob/types.h>
 #include <blob/util.h>
-#include <blob/serial.h>
 
 
 
@@ -45,45 +45,18 @@
 void MyMemCpy(u32 *dest, const u32 *src, int numWords) 
 {
 #ifdef BLOB_DEBUG
-	SerialOutputString("\n### Now copying 0x");
-	SerialOutputHex(numWords);
-	SerialOutputString(" words from 0x");
-	SerialOutputHex((int)src);
-	SerialOutputString(" to 0x");
-	SerialOutputHex((int)dest);
-	serial_write('\n');
+	printf("### copying 0x%08x words from 0x%08x to 0x%08x ...",
+	       (unsigned int)numWords, (unsigned int)src, (unsigned int)dest);
 #endif
 
 	while(numWords--) {
 		if((numWords & 0xffff) == 0x0)
-			serial_write('.');
+			printf(".");
 
 		*dest++ = *src++;
 	}
 
 #ifdef BLOB_DEBUG
-	SerialOutputString(" done\n");
+	printf(" done\n");
 #endif
 } /* MyMemCpy */
-
-
-
-
-void MyMemCpyChar(char *dest, const char *src, int numBytes)
-{
-	char *destLim = dest + numBytes;
-	
-	while(dest < destLim)
-		*dest++ = *src++;
-} /* MyMemCpyChar */
-
-
-
-
-void MyMemSet(u32 *dest, const u32 wordToWrite, int numWords)
-{
-	u32 *limit = dest + numWords;
-	
-	while(dest < limit)
-		*dest++ = wordToWrite;
-} /* MyMemSet */
Index: build_tree/bootLoader/tools/.cvsignore
diff -u /dev/null build_tree/bootLoader/tools/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/tools/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile.in
+Makefile
Index: build_tree/bootLoader/tools/Makefile.in
diff -u build_tree/bootLoader/tools/Makefile.in:1.1.1.1 build_tree/bootLoader/tools/Makefile.in:1.2
--- build_tree/bootLoader/tools/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/tools/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,183 +12,318 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # Process this file with automake to produce Makefile.in -*- makefile -*-
 #
 # $Id: Makefile.am,v 1.1.1.1 2001/06/27 19:47:42 erikm Exp $
 # 
-
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = tools
+DIST_COMMON = README $(srcdir)/Makefile.am $(srcdir)/Makefile.in \
+	compile config.guess config.sub depcomp install-sh missing
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
 CLEANFILES = *~
+EXTRA_DIST = \
+	rebuild \
+	rebuild-gcc \
+	README
 
-EXTRA_DIST =  	rebuild 	rebuild-gcc 	README
-
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-DIST_COMMON =  README Makefile.am Makefile.in config.guess config.sub \
-install-sh missing mkinstalldirs
+all: all-am
 
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps tools/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  tools/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  tools/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
 tags: TAGS
 TAGS:
 
+ctags: CTAGS
+CTAGS:
 
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = tools
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
 check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am:
+all-am: Makefile
+installdirs:
+install: install-am
 install-exec: install-exec-am
-
-install-data-am:
 install-data: install-data-am
+uninstall: uninstall-am
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am:
-uninstall: uninstall-am
-all-am: Makefile
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-
 
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
 
-mostlyclean: mostlyclean-am
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-generic mostlyclean-am
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic
 
-clean: clean-am
+dvi: dvi-am
 
-distclean-am:  distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-am
+html: html-am
 
-maintainer-clean-am:  maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
 
-.PHONY: tags distdir info-am info dvi-am dvi check check-am \
-installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+uninstall-am: uninstall-info-am
 
+.PHONY: all all-am check check-am clean clean-generic distclean \
+	distclean-generic distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-generic pdf pdf-am ps ps-am uninstall uninstall-am \
+	uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/tools/blob-real-clean
diff -u /dev/null build_tree/bootLoader/tools/blob-real-clean:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/tools/blob-real-clean	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,48 @@
+#!/bin/bash
+
+if [ -f Makefile ] ; then
+  make maintainer-clean-recursive
+fi
+
+rm -f configure config.status config.log aclocal.m4 INSTALL
+
+rm -rf autom4te-2.53.cache
+
+rm -f include/blob/config.h.in
+
+for f in `find . -name Makefile`
+do
+rm -f $f
+done
+
+for f in `find . -name Makefile.in`
+do
+rm -f $f
+done
+
+for f in `find . -name "*~"`
+do
+rm -f $f
+done
+
+for f in `find . -name "#*#"`
+do
+rm -f $f
+done
+
+for f in `find . -name .deps`
+do
+rm -rf $f
+done
+
+cd tools
+rm -f config.guess
+rm -f config.sub
+rm -f depcomp
+rm -f install-sh
+rm -f missing
+rm -f mkinstalldirs
+rm -rf compile
+
+
+
Index: build_tree/bootLoader/tools/compile
diff -u /dev/null build_tree/bootLoader/tools/compile:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/tools/compile	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,136 @@
+#! /bin/sh
+# Wrapper for compilers which do not understand `-c -o'.
+
+scriptversion=2003-11-09.00
+
+# Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
+# Written by Tom Tromey <tromey@cygnus.com>.
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+#
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111-1307, USA.
+
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program that contains a
+# configuration script generated by Autoconf, you may include it under
+# the same distribution terms that you use for the rest of that program.
+
+# This file is maintained in Automake, please report
+# bugs to <bug-automake@gnu.org> or send patches to
+# <automake-patches@gnu.org>.
+
+case $1 in
+  '')
+     echo "$0: No command.  Try \`$0 --help' for more information." 1>&2
+     exit 1;
+     ;;
+  -h | --h*)
+    cat <<\EOF
+Usage: compile [--help] [--version] PROGRAM [ARGS]
+
+Wrapper for compilers which do not understand `-c -o'.
+Remove `-o dest.o' from ARGS, run PROGRAM with the remaining
+arguments, and rename the output as expected.
+
+If you are trying to build a whole package this is not the
+right script to run: please start by reading the file `INSTALL'.
+
+Report bugs to <bug-automake@gnu.org>.
+EOF
+    exit 0
+    ;;
+  -v | --v*)
+    echo "compile $scriptversion"
+    exit 0
+    ;;
+esac
+
+
+prog=$1
+shift
+
+ofile=
+cfile=
+args=
+while test $# -gt 0; do
+  case "$1" in
+    -o)
+      # configure might choose to run compile as `compile cc -o foo foo.c'.
+      # So we do something ugly here.
+      ofile=$2
+      shift
+      case "$ofile" in
+	*.o | *.obj)
+	  ;;
+	*)
+	  args="$args -o $ofile"
+	  ofile=
+	  ;;
+      esac
+       ;;
+    *.c)
+      cfile=$1
+      args="$args $1"
+      ;;
+    *)
+      args="$args $1"
+      ;;
+  esac
+  shift
+done
+
+if test -z "$ofile" || test -z "$cfile"; then
+  # If no `-o' option was seen then we might have been invoked from a
+  # pattern rule where we don't need one.  That is ok -- this is a
+  # normal compilation that the losing compiler can handle.  If no
+  # `.c' file was seen then we are probably linking.  That is also
+  # ok.
+  exec "$prog" $args
+fi
+
+# Name of file we expect compiler to create.
+cofile=`echo $cfile | sed -e 's|^.*/||' -e 's/\.c$/.o/'`
+
+# Create the lock directory.
+# Note: use `[/.-]' here to ensure that we don't use the same name
+# that we are using for the .o file.  Also, base the name on the expected
+# object file name, since that is what matters with a parallel build.
+lockdir=`echo $cofile | sed -e 's|[/.-]|_|g'`.d
+while true; do
+  if mkdir $lockdir > /dev/null 2>&1; then
+    break
+  fi
+  sleep 1
+done
+# FIXME: race condition here if user kills between mkdir and trap.
+trap "rmdir $lockdir; exit 1" 1 2 15
+
+# Run the compile.
+"$prog" $args
+status=$?
+
+if test -f "$cofile"; then
+  mv "$cofile" "$ofile"
+fi
+
+rmdir $lockdir
+exit $status
+
+# Local Variables:
+# mode: shell-script
+# sh-indentation: 2
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "scriptversion="
+# time-stamp-format: "%:y-%02m-%02d.%02H"
+# time-stamp-end: "$"
+# End:
Index: build_tree/bootLoader/tools/config.guess
diff -u build_tree/bootLoader/tools/config.guess:1.1.1.1 build_tree/bootLoader/tools/config.guess:1.1.1.2
--- build_tree/bootLoader/tools/config.guess:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/tools/config.guess	Fri Nov  9 10:37:08 2007
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Attempt to guess a canonical system name.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
 
-timestamp='2002-01-02'
+timestamp='2004-03-03'
 
 # This file is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by
@@ -24,7 +24,7 @@
 # configuration script generated by Autoconf, you may include it under
 # the same distribution terms that you use for the rest of that program.
 
-# Originally written by Per Bothner <bothner@cygnus.com>.
+# Originally written by Per Bothner <per@bothner.com>.
 # Please send patches to <config-patches@gnu.org>.  Submit a context
 # diff and a properly formatted ChangeLog entry.
 #
@@ -88,30 +88,42 @@
   exit 1
 fi
 
+trap 'exit 1' 1 2 15
 
-dummy=dummy-$$
-trap 'rm -f $dummy.c $dummy.o $dummy.rel $dummy; exit 1' 1 2 15
+# CC_FOR_BUILD -- compiler used by this script. Note that the use of a
+# compiler to aid in system detection is discouraged as it requires
+# temporary files to be created and, as you can see below, it is a
+# headache to deal with in a portable fashion.
 
-# CC_FOR_BUILD -- compiler used by this script.
 # Historically, `CC_FOR_BUILD' used to be named `HOST_CC'. We still
 # use `HOST_CC' if defined, but it is deprecated.
 
-set_cc_for_build='case $CC_FOR_BUILD,$HOST_CC,$CC in
- ,,)    echo "int dummy(){}" > $dummy.c ;
-	for c in cc gcc c89 ; do
-	  ($c $dummy.c -c -o $dummy.o) >/dev/null 2>&1 ;
-	  if test $? = 0 ; then
+# Portable tmp directory creation inspired by the Autoconf team.
+
+set_cc_for_build='
+trap "exitcode=\$?; (rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null) && exit \$exitcode" 0 ;
+trap "rm -f \$tmpfiles 2>/dev/null; rmdir \$tmp 2>/dev/null; exit 1" 1 2 13 15 ;
+: ${TMPDIR=/tmp} ;
+ { tmp=`(umask 077 && mktemp -d -q "$TMPDIR/cgXXXXXX") 2>/dev/null` && test -n "$tmp" && test -d "$tmp" ; } ||
+ { test -n "$RANDOM" && tmp=$TMPDIR/cg$$-$RANDOM && (umask 077 && mkdir $tmp) ; } ||
+ { tmp=$TMPDIR/cg-$$ && (umask 077 && mkdir $tmp) && echo "Warning: creating insecure temp directory" >&2 ; } ||
+ { echo "$me: cannot create a temporary directory in $TMPDIR" >&2 ; exit 1 ; } ;
+dummy=$tmp/dummy ;
+tmpfiles="$dummy.c $dummy.o $dummy.rel $dummy" ;
+case $CC_FOR_BUILD,$HOST_CC,$CC in
+ ,,)    echo "int x;" > $dummy.c ;
+	for c in cc gcc c89 c99 ; do
+	  if ($c -c -o $dummy.o $dummy.c) >/dev/null 2>&1 ; then
 	     CC_FOR_BUILD="$c"; break ;
 	  fi ;
 	done ;
-	rm -f $dummy.c $dummy.o $dummy.rel ;
 	if test x"$CC_FOR_BUILD" = x ; then
 	  CC_FOR_BUILD=no_compiler_found ;
 	fi
 	;;
  ,,*)   CC_FOR_BUILD=$CC ;;
  ,*,*)  CC_FOR_BUILD=$HOST_CC ;;
-esac'
+esac ;'
 
 # This is needed to find uname on a Pyramid OSx when run in the BSD universe.
 # (ghazi@noc.rutgers.edu 1994-08-24)
@@ -138,9 +150,11 @@
 	#
 	# Note: NetBSD doesn't particularly care about the vendor
 	# portion of the name.  We always set it to "unknown".
-	UNAME_MACHINE_ARCH=`(uname -p) 2>/dev/null` || \
-	    UNAME_MACHINE_ARCH=unknown
+	sysctl="sysctl -n hw.machine_arch"
+	UNAME_MACHINE_ARCH=`(/sbin/$sysctl 2>/dev/null || \
+	    /usr/sbin/$sysctl 2>/dev/null || echo unknown)`
 	case "${UNAME_MACHINE_ARCH}" in
+	    armeb) machine=armeb-unknown ;;
 	    arm*) machine=arm-unknown ;;
 	    sh3el) machine=shl-unknown ;;
 	    sh3eb) machine=sh-unknown ;;
@@ -166,18 +180,35 @@
 		;;
 	esac
 	# The OS release
-	release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+	# Debian GNU/NetBSD machines have a different userland, and
+	# thus, need a distinct triplet. However, they do not need
+	# kernel version information, so it can be replaced with a
+	# suitable tag, in the style of linux-gnu.
+	case "${UNAME_VERSION}" in
+	    Debian*)
+		release='-gnu'
+		;;
+	    *)
+		release=`echo ${UNAME_RELEASE}|sed -e 's/[-_].*/\./'`
+		;;
+	esac
 	# Since CPU_TYPE-MANUFACTURER-KERNEL-OPERATING_SYSTEM:
 	# contains redundant information, the shorter form:
 	# CPU_TYPE-MANUFACTURER-OPERATING_SYSTEM is used.
 	echo "${machine}-${os}${release}"
 	exit 0 ;;
+    amd64:OpenBSD:*:*)
+	echo x86_64-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
     amiga:OpenBSD:*:*)
 	echo m68k-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
     arc:OpenBSD:*:*)
 	echo mipsel-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
+    cats:OpenBSD:*:*)
+	echo arm-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
     hp300:OpenBSD:*:*)
 	echo m68k-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
@@ -196,6 +227,9 @@
     mvmeppc:OpenBSD:*:*)
 	echo powerpc-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
+    pegasos:OpenBSD:*:*)
+	echo powerpc-unknown-openbsd${UNAME_RELEASE}
+	exit 0 ;;
     pmax:OpenBSD:*:*)
 	echo mipsel-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
@@ -211,68 +245,70 @@
     *:OpenBSD:*:*)
 	echo ${UNAME_MACHINE}-unknown-openbsd${UNAME_RELEASE}
 	exit 0 ;;
+    *:ekkoBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-ekkobsd${UNAME_RELEASE}
+	exit 0 ;;
+    macppc:MirBSD:*:*)
+	echo powerppc-unknown-mirbsd${UNAME_RELEASE}
+	exit 0 ;;
+    *:MirBSD:*:*)
+	echo ${UNAME_MACHINE}-unknown-mirbsd${UNAME_RELEASE}
+	exit 0 ;;
     alpha:OSF1:*:*)
-	if test $UNAME_RELEASE = "V4.0"; then
+	case $UNAME_RELEASE in
+	*4.0)
 		UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $3}'`
-	fi
+		;;
+	*5.*)
+	        UNAME_RELEASE=`/usr/sbin/sizer -v | awk '{print $4}'`
+		;;
+	esac
+	# According to Compaq, /usr/sbin/psrinfo has been available on
+	# OSF/1 and Tru64 systems produced since 1995.  I hope that
+	# covers most systems running today.  This code pipes the CPU
+	# types through head -n 1, so we only detect the type of CPU 0.
+	ALPHA_CPU_TYPE=`/usr/sbin/psrinfo -v | sed -n -e 's/^  The alpha \(.*\) processor.*$/\1/p' | head -n 1`
+	case "$ALPHA_CPU_TYPE" in
+	    "EV4 (21064)")
+		UNAME_MACHINE="alpha" ;;
+	    "EV4.5 (21064)")
+		UNAME_MACHINE="alpha" ;;
+	    "LCA4 (21066/21068)")
+		UNAME_MACHINE="alpha" ;;
+	    "EV5 (21164)")
+		UNAME_MACHINE="alphaev5" ;;
+	    "EV5.6 (21164A)")
+		UNAME_MACHINE="alphaev56" ;;
+	    "EV5.6 (21164PC)")
+		UNAME_MACHINE="alphapca56" ;;
+	    "EV5.7 (21164PC)")
+		UNAME_MACHINE="alphapca57" ;;
+	    "EV6 (21264)")
+		UNAME_MACHINE="alphaev6" ;;
+	    "EV6.7 (21264A)")
+		UNAME_MACHINE="alphaev67" ;;
+	    "EV6.8CB (21264C)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.8AL (21264B)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.8CX (21264D)")
+		UNAME_MACHINE="alphaev68" ;;
+	    "EV6.9A (21264/EV69A)")
+		UNAME_MACHINE="alphaev69" ;;
+	    "EV7 (21364)")
+		UNAME_MACHINE="alphaev7" ;;
+	    "EV7.9 (21364A)")
+		UNAME_MACHINE="alphaev79" ;;
+	esac
+	# A Pn.n version is a patched version.
 	# A Vn.n version is a released version.
 	# A Tn.n version is a released field test version.
 	# A Xn.n version is an unreleased experimental baselevel.
 	# 1.2 uses "1.2" for uname -r.
-	cat <<EOF >$dummy.s
-	.data
-\$Lformat:
-	.byte 37,100,45,37,120,10,0	# "%d-%x\n"
-
-	.text
-	.globl main
-	.align 4
-	.ent main
-main:
-	.frame \$30,16,\$26,0
-	ldgp \$29,0(\$27)
-	.prologue 1
-	.long 0x47e03d80 # implver \$0
-	lda \$2,-1
-	.long 0x47e20c21 # amask \$2,\$1
-	lda \$16,\$Lformat
-	mov \$0,\$17
-	not \$1,\$18
-	jsr \$26,printf
-	ldgp \$29,0(\$26)
-	mov 0,\$16
-	jsr \$26,exit
-	.end main
-EOF
-	eval $set_cc_for_build
-	$CC_FOR_BUILD $dummy.s -o $dummy 2>/dev/null
-	if test "$?" = 0 ; then
-		case `./$dummy` in
-			0-0)
-				UNAME_MACHINE="alpha"
-				;;
-			1-0)
-				UNAME_MACHINE="alphaev5"
-				;;
-			1-1)
-				UNAME_MACHINE="alphaev56"
-				;;
-			1-101)
-				UNAME_MACHINE="alphapca56"
-				;;
-			2-303)
-				UNAME_MACHINE="alphaev6"
-				;;
-			2-307)
-				UNAME_MACHINE="alphaev67"
-				;;
-			2-1307)
-				UNAME_MACHINE="alphaev68"
-				;;
-		esac
-	fi
-	rm -f $dummy.s $dummy
-	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[VTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+	echo ${UNAME_MACHINE}-dec-osf`echo ${UNAME_RELEASE} | sed -e 's/^[PVTX]//' | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
+	exit 0 ;;
+    Alpha*:OpenVMS:*:*)
+	echo alpha-hp-vms
 	exit 0 ;;
     Alpha\ *:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
@@ -295,6 +331,9 @@
     *:OS/390:*:*)
 	echo i370-ibm-openedition
 	exit 0 ;;
+    *:OS400:*:*)
+        echo powerpc-ibm-os400
+	exit 0 ;;
     arm:RISC*:1.[012]*:*|arm:riscix:1.[012]*:*)
 	echo arm-acorn-riscix${UNAME_RELEASE}
 	exit 0;;
@@ -312,6 +351,13 @@
     NILE*:*:*:dcosx)
 	echo pyramid-pyramid-svr4
 	exit 0 ;;
+    DRS?6000:unix:4.0:6*)
+	echo sparc-icl-nx6
+	exit 0 ;;
+    DRS?6000:UNIX_SV:4.2*:7*)
+	case `/usr/bin/uname -p` in
+	    sparc) echo sparc-icl-nx7 && exit 0 ;;
+	esac ;;
     sun4H:SunOS:5.*:*)
 	echo sparc-hal-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit 0 ;;
@@ -340,7 +386,7 @@
 	echo m68k-sun-sunos${UNAME_RELEASE}
 	exit 0 ;;
     sun*:*:4.2BSD:*)
-	UNAME_RELEASE=`(head -1 /etc/motd | awk '{print substr($5,1,3)}') 2>/dev/null`
+	UNAME_RELEASE=`(sed 1q /etc/motd | awk '{print substr($5,1,3)}') 2>/dev/null`
 	test "x${UNAME_RELEASE}" = "x" && UNAME_RELEASE=3
 	case "`/bin/arch`" in
 	    sun3)
@@ -380,6 +426,9 @@
     *:*MiNT:*:* | *:*mint:*:* | *:*TOS:*:*)
         echo m68k-unknown-mint${UNAME_RELEASE}
         exit 0 ;;
+    m68k:machten:*:*)
+	echo m68k-apple-machten${UNAME_RELEASE}
+	exit 0 ;;
     powerpc:machten:*:*)
 	echo powerpc-apple-machten${UNAME_RELEASE}
 	exit 0 ;;
@@ -418,15 +467,20 @@
 	  exit (-1);
 	}
 EOF
-	$CC_FOR_BUILD $dummy.c -o $dummy \
-	  && ./$dummy `echo "${UNAME_RELEASE}" | sed -n 's/\([0-9]*\).*/\1/p'` \
-	  && rm -f $dummy.c $dummy && exit 0
-	rm -f $dummy.c $dummy
+	$CC_FOR_BUILD -o $dummy $dummy.c \
+	  && $dummy `echo "${UNAME_RELEASE}" | sed -n 's/\([0-9]*\).*/\1/p'` \
+	  && exit 0
 	echo mips-mips-riscos${UNAME_RELEASE}
 	exit 0 ;;
     Motorola:PowerMAX_OS:*:*)
 	echo powerpc-motorola-powermax
 	exit 0 ;;
+    Motorola:*:4.3:PL8-*)
+	echo powerpc-harris-powermax
+	exit 0 ;;
+    Night_Hawk:*:*:PowerMAX_OS | Synergy:PowerMAX_OS:*:*)
+	echo powerpc-harris-powermax
+	exit 0 ;;
     Night_Hawk:Power_UNIX:*:*)
 	echo powerpc-harris-powerunix
 	exit 0 ;;
@@ -499,8 +553,7 @@
 			exit(0);
 			}
 EOF
-		$CC_FOR_BUILD $dummy.c -o $dummy && ./$dummy && rm -f $dummy.c $dummy && exit 0
-		rm -f $dummy.c $dummy
+		$CC_FOR_BUILD -o $dummy $dummy.c && $dummy && exit 0
 		echo rs6000-ibm-aix3.2.5
 	elif grep bos324 /usr/include/stdio.h >/dev/null 2>&1; then
 		echo rs6000-ibm-aix3.2.4
@@ -509,7 +562,7 @@
 	fi
 	exit 0 ;;
     *:AIX:*:[45])
-	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | head -1 | awk '{ print $1 }'`
+	IBM_CPU_ID=`/usr/sbin/lsdev -C -c processor -S available | sed 1q | awk '{ print $1 }'`
 	if /usr/sbin/lsattr -El ${IBM_CPU_ID} | grep ' POWER' >/dev/null 2>&1; then
 		IBM_ARCH=rs6000
 	else
@@ -598,11 +651,21 @@
                   exit (0);
               }
 EOF
-		    (CCOPTS= $CC_FOR_BUILD $dummy.c -o $dummy 2>/dev/null) && HP_ARCH=`./$dummy`
-		    if test -z "$HP_ARCH"; then HP_ARCH=hppa; fi
-		    rm -f $dummy.c $dummy
+		    (CCOPTS= $CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null) && HP_ARCH=`$dummy`
+		    test -z "$HP_ARCH" && HP_ARCH=hppa
 		fi ;;
 	esac
+	if [ ${HP_ARCH} = "hppa2.0w" ]
+	then
+	    # avoid double evaluation of $set_cc_for_build
+	    test -n "$CC_FOR_BUILD" || eval $set_cc_for_build
+	    if echo __LP64__ | (CCOPTS= $CC_FOR_BUILD -E -) | grep __LP64__ >/dev/null
+	    then
+		HP_ARCH="hppa2.0w"
+	    else
+		HP_ARCH="hppa64"
+	    fi
+	fi
 	echo ${HP_ARCH}-hp-hpux${HPUX_REV}
 	exit 0 ;;
     ia64:HP-UX:*:*)
@@ -636,8 +699,7 @@
 	  exit (0);
 	}
 EOF
-	$CC_FOR_BUILD $dummy.c -o $dummy && ./$dummy && rm -f $dummy.c $dummy && exit 0
-	rm -f $dummy.c $dummy
+	$CC_FOR_BUILD -o $dummy $dummy.c && $dummy && exit 0
 	echo unknown-hitachi-hiuxwe2
 	exit 0 ;;
     9000/7??:4.3bsd:*:* | 9000/8?[79]:4.3bsd:*:* )
@@ -683,9 +745,6 @@
     C4*:ConvexOS:*:* | convex:ConvexOS:C4*:*)
 	echo c4-convex-bsd
         exit 0 ;;
-    CRAY*X-MP:*:*:*)
-	echo xmp-cray-unicos
-        exit 0 ;;
     CRAY*Y-MP:*:*:*)
 	echo ymp-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
@@ -698,24 +757,26 @@
     CRAY*TS:*:*:*)
 	echo t90-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
-    CRAY*T3D:*:*:*)
-	echo alpha-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
-	exit 0 ;;
     CRAY*T3E:*:*:*)
 	echo alphaev5-cray-unicosmk${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
     CRAY*SV1:*:*:*)
 	echo sv1-cray-unicos${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
 	exit 0 ;;
-    CRAY-2:*:*:*)
-	echo cray2-cray-unicos
-        exit 0 ;;
+    *:UNICOS/mp:*:*)
+	echo nv1-cray-unicosmp${UNAME_RELEASE} | sed -e 's/\.[^.]*$/.X/'
+	exit 0 ;;
     F30[01]:UNIX_System_V:*:* | F700:UNIX_System_V:*:*)
 	FUJITSU_PROC=`uname -m | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz'`
         FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
         FUJITSU_REL=`echo ${UNAME_RELEASE} | sed -e 's/ /_/'`
         echo "${FUJITSU_PROC}-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
         exit 0 ;;
+    5000:UNIX_System_V:4.*:*)
+        FUJITSU_SYS=`uname -p | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/\///'`
+        FUJITSU_REL=`echo ${UNAME_RELEASE} | tr 'ABCDEFGHIJKLMNOPQRSTUVWXYZ' 'abcdefghijklmnopqrstuvwxyz' | sed -e 's/ /_/'`
+        echo "sparc-fujitsu-${FUJITSU_SYS}${FUJITSU_REL}"
+	exit 0 ;;
     i*86:BSD/386:*:* | i*86:BSD/OS:*:* | *:Ascend\ Embedded/OS:*:*)
 	echo ${UNAME_MACHINE}-pc-bsdi${UNAME_RELEASE}
 	exit 0 ;;
@@ -726,7 +787,21 @@
 	echo ${UNAME_MACHINE}-unknown-bsdi${UNAME_RELEASE}
 	exit 0 ;;
     *:FreeBSD:*:*)
-	echo ${UNAME_MACHINE}-unknown-freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
+	# Determine whether the default compiler uses glibc.
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#include <features.h>
+	#if __GLIBC__ >= 2
+	LIBC=gnu
+	#else
+	LIBC=
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^LIBC=`
+	# GNU/KFreeBSD systems have a "k" prefix to indicate we are using
+	# FreeBSD's kernel, but not the complete OS.
+	case ${LIBC} in gnu) kernel_only='k' ;; esac
+	echo ${UNAME_MACHINE}-unknown-${kernel_only}freebsd`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`${LIBC:+-$LIBC}
 	exit 0 ;;
     i*:CYGWIN*:*)
 	echo ${UNAME_MACHINE}-pc-cygwin
@@ -737,14 +812,17 @@
     i*:PW*:*)
 	echo ${UNAME_MACHINE}-pc-pw32
 	exit 0 ;;
-    x86:Interix*:3*)
-	echo i386-pc-interix3
+    x86:Interix*:[34]*)
+	echo i586-pc-interix${UNAME_RELEASE}|sed -e 's/\..*//'
+	exit 0 ;;
+    [345]86:Windows_95:* | [345]86:Windows_98:* | [345]86:Windows_NT:*)
+	echo i${UNAME_MACHINE}-pc-mks
 	exit 0 ;;
     i*:Windows_NT*:* | Pentium*:Windows_NT*:*)
 	# How do we know it's Interix rather than the generic POSIX subsystem?
 	# It also conflicts with pre-2.0 versions of AT&T UWIN. Should we
 	# UNAME_MACHINE based on the output of uname instead of i386?
-	echo i386-pc-interix
+	echo i586-pc-interix
 	exit 0 ;;
     i*:UWIN*:*)
 	echo ${UNAME_MACHINE}-pc-uwin
@@ -756,16 +834,24 @@
 	echo powerpcle-unknown-solaris2`echo ${UNAME_RELEASE}|sed -e 's/[^.]*//'`
 	exit 0 ;;
     *:GNU:*:*)
+	# the GNU system
 	echo `echo ${UNAME_MACHINE}|sed -e 's,[-/].*$,,'`-unknown-gnu`echo ${UNAME_RELEASE}|sed -e 's,/.*$,,'`
 	exit 0 ;;
+    *:GNU/*:*:*)
+	# other systems with GNU libc and userland
+	echo ${UNAME_MACHINE}-unknown-`echo ${UNAME_SYSTEM} | sed 's,^[^/]*/,,' | tr '[A-Z]' '[a-z]'``echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`-gnu
+	exit 0 ;;
     i*86:Minix:*:*)
 	echo ${UNAME_MACHINE}-pc-minix
 	exit 0 ;;
     arm*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit 0 ;;
+    cris:Linux:*:*)
+	echo cris-axis-linux-gnu
+	exit 0 ;;
     ia64:Linux:*:*)
-	echo ${UNAME_MACHINE}-unknown-linux
+	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit 0 ;;
     m68*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
@@ -776,19 +862,37 @@
 	#undef CPU
 	#undef mips
 	#undef mipsel
-	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL) 
-	CPU=mipsel 
+	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
+	CPU=mipsel
 	#else
-	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB) 
+	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
 	CPU=mips
 	#else
 	CPU=
 	#endif
-	#endif 
+	#endif
+EOF
+	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^CPU=`
+	test x"${CPU}" != x && echo "${CPU}-unknown-linux-gnu" && exit 0
+	;;
+    mips64:Linux:*:*)
+	eval $set_cc_for_build
+	sed 's/^	//' << EOF >$dummy.c
+	#undef CPU
+	#undef mips64
+	#undef mips64el
+	#if defined(__MIPSEL__) || defined(__MIPSEL) || defined(_MIPSEL) || defined(MIPSEL)
+	CPU=mips64el
+	#else
+	#if defined(__MIPSEB__) || defined(__MIPSEB) || defined(_MIPSEB) || defined(MIPSEB)
+	CPU=mips64
+	#else
+	CPU=
+	#endif
+	#endif
 EOF
 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^CPU=`
-	rm -f $dummy.c
-	test x"${CPU}" != x && echo "${CPU}-pc-linux-gnu" && exit 0
+	test x"${CPU}" != x && echo "${CPU}-unknown-linux-gnu" && exit 0
 	;;
     ppc:Linux:*:*)
 	echo powerpc-unknown-linux-gnu
@@ -824,6 +928,9 @@
     s390:Linux:*:* | s390x:Linux:*:*)
 	echo ${UNAME_MACHINE}-ibm-linux
 	exit 0 ;;
+    sh64*:Linux:*:*)
+    	echo ${UNAME_MACHINE}-unknown-linux-gnu
+	exit 0 ;;
     sh*:Linux:*:*)
 	echo ${UNAME_MACHINE}-unknown-linux-gnu
 	exit 0 ;;
@@ -837,7 +944,8 @@
 	# The BFD linker knows what the default object file format is, so
 	# first see if it will tell us. cd to the root directory to prevent
 	# problems with other programs or directories called `ld' in the path.
-	ld_supported_targets=`cd /; ld --help 2>&1 \
+	# Set LC_ALL=C to ensure ld outputs messages in English.
+	ld_supported_targets=`cd /; LC_ALL=C ld --help 2>&1 \
 			 | sed -ne '/supported targets:/!d
 				    s/[ 	][ 	]*/ /g
 				    s/.*supported targets: *//
@@ -849,7 +957,7 @@
 		;;
 	  a.out-i386-linux)
 		echo "${UNAME_MACHINE}-pc-linux-gnuaout"
-		exit 0 ;;		
+		exit 0 ;;
 	  coff-i386)
 		echo "${UNAME_MACHINE}-pc-linux-gnucoff"
 		exit 0 ;;
@@ -874,11 +982,17 @@
 	LIBC=gnulibc1
 	# endif
 	#else
+	#ifdef __INTEL_COMPILER
+	LIBC=gnu
+	#else
 	LIBC=gnuaout
 	#endif
+	#endif
+	#ifdef __dietlibc__
+	LIBC=dietlibc
+	#endif
 EOF
 	eval `$CC_FOR_BUILD -E $dummy.c 2>/dev/null | grep ^LIBC=`
-	rm -f $dummy.c
 	test x"${LIBC}" != x && echo "${UNAME_MACHINE}-pc-linux-${LIBC}" && exit 0
 	test x"${TENTATIVE}" != x && echo "${TENTATIVE}" && exit 0
 	;;
@@ -896,6 +1010,26 @@
         # Use sysv4.2uw... so that sysv4* matches it.
 	echo ${UNAME_MACHINE}-pc-sysv4.2uw${UNAME_VERSION}
 	exit 0 ;;
+    i*86:OS/2:*:*)
+	# If we were able to find `uname', then EMX Unix compatibility
+	# is probably installed.
+	echo ${UNAME_MACHINE}-pc-os2-emx
+	exit 0 ;;
+    i*86:XTS-300:*:STOP)
+	echo ${UNAME_MACHINE}-unknown-stop
+	exit 0 ;;
+    i*86:atheos:*:*)
+	echo ${UNAME_MACHINE}-unknown-atheos
+	exit 0 ;;
+	i*86:syllable:*:*)
+	echo ${UNAME_MACHINE}-pc-syllable
+	exit 0 ;;
+    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
+	echo i386-unknown-lynxos${UNAME_RELEASE}
+	exit 0 ;;
+    i*86:*DOS:*:*)
+	echo ${UNAME_MACHINE}-pc-msdosdjgpp
+	exit 0 ;;
     i*86:*:4.*:* | i*86:SYSTEM_V:4.*:*)
 	UNAME_REL=`echo ${UNAME_RELEASE} | sed 's/\/MP$//'`
 	if grep Novell /usr/include/link.h >/dev/null 2>/dev/null; then
@@ -917,22 +1051,19 @@
 		UNAME_REL=`sed -n 's/.*Version //p' </usr/options/cb.name`
 		echo ${UNAME_MACHINE}-pc-isc$UNAME_REL
 	elif /bin/uname -X 2>/dev/null >/dev/null ; then
-		UNAME_REL=`(/bin/uname -X|egrep Release|sed -e 's/.*= //')`
-		(/bin/uname -X|egrep i80486 >/dev/null) && UNAME_MACHINE=i486
-		(/bin/uname -X|egrep '^Machine.*Pentium' >/dev/null) \
+		UNAME_REL=`(/bin/uname -X|grep Release|sed -e 's/.*= //')`
+		(/bin/uname -X|grep i80486 >/dev/null) && UNAME_MACHINE=i486
+		(/bin/uname -X|grep '^Machine.*Pentium' >/dev/null) \
 			&& UNAME_MACHINE=i586
-		(/bin/uname -X|egrep '^Machine.*Pent ?II' >/dev/null) \
+		(/bin/uname -X|grep '^Machine.*Pent *II' >/dev/null) \
 			&& UNAME_MACHINE=i686
-		(/bin/uname -X|egrep '^Machine.*Pentium Pro' >/dev/null) \
+		(/bin/uname -X|grep '^Machine.*Pentium Pro' >/dev/null) \
 			&& UNAME_MACHINE=i686
 		echo ${UNAME_MACHINE}-pc-sco$UNAME_REL
 	else
 		echo ${UNAME_MACHINE}-pc-sysv32
 	fi
 	exit 0 ;;
-    i*86:*DOS:*:*)
-	echo ${UNAME_MACHINE}-pc-msdosdjgpp
-	exit 0 ;;
     pc:*:*:*)
 	# Left here for compatibility:
         # uname -m prints for DJGPP always 'pc', but it prints nothing about
@@ -956,9 +1087,15 @@
 	# "miniframe"
 	echo m68010-convergent-sysv
 	exit 0 ;;
+    mc68k:UNIX:SYSTEM5:3.51m)
+	echo m68k-convergent-sysv
+	exit 0 ;;
+    M680?0:D-NIX:5.3:*)
+	echo m68k-diab-dnix
+	exit 0 ;;
     M68*:*:R3V[567]*:*)
 	test -r /sysV68 && echo 'm68k-motorola-sysv' && exit 0 ;;
-    3[34]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0)
+    3[345]??:*:4.0:3.0 | 3[34]??A:*:4.0:3.0 | 3[34]??,*:*:4.0:3.0 | 3[34]??/*:*:4.0:3.0 | 4400:*:4.0:3.0 | 4850:*:4.0:3.0 | SKA40:*:4.0:3.0 | SDS2:*:4.0:3.0 | SHG2:*:4.0:3.0)
 	OS_REL=''
 	test -r /etc/.relid \
 	&& OS_REL=.`sed -n 's/[^ ]* [^ ]* \([0-9][0-9]\).*/\1/p' < /etc/.relid`
@@ -975,9 +1112,6 @@
     mc68030:UNIX_System_V:4.*:*)
 	echo m68k-atari-sysv4
 	exit 0 ;;
-    i*86:LynxOS:2.*:* | i*86:LynxOS:3.[01]*:* | i*86:LynxOS:4.0*:*)
-	echo i386-unknown-lynxos${UNAME_RELEASE}
-	exit 0 ;;
     TSUNAMI:LynxOS:2.*:*)
 	echo sparc-unknown-lynxos${UNAME_RELEASE}
 	exit 0 ;;
@@ -1049,6 +1183,9 @@
     SX-5:SUPER-UX:*:*)
 	echo sx5-nec-superux${UNAME_RELEASE}
 	exit 0 ;;
+    SX-6:SUPER-UX:*:*)
+	echo sx6-nec-superux${UNAME_RELEASE}
+	exit 0 ;;
     Power*:Rhapsody:*:*)
 	echo powerpc-apple-rhapsody${UNAME_RELEASE}
 	exit 0 ;;
@@ -1056,18 +1193,24 @@
 	echo ${UNAME_MACHINE}-apple-rhapsody${UNAME_RELEASE}
 	exit 0 ;;
     *:Darwin:*:*)
-	echo `uname -p`-apple-darwin${UNAME_RELEASE}
+	case `uname -p` in
+	    *86) UNAME_PROCESSOR=i686 ;;
+	    powerpc) UNAME_PROCESSOR=powerpc ;;
+	esac
+	echo ${UNAME_PROCESSOR}-apple-darwin${UNAME_RELEASE}
 	exit 0 ;;
     *:procnto*:*:* | *:QNX:[0123456789]*:*)
-	if test "${UNAME_MACHINE}" = "x86pc"; then
+	UNAME_PROCESSOR=`uname -p`
+	if test "$UNAME_PROCESSOR" = "x86"; then
+		UNAME_PROCESSOR=i386
 		UNAME_MACHINE=pc
 	fi
-	echo `uname -p`-${UNAME_MACHINE}-nto-qnx
+	echo ${UNAME_PROCESSOR}-${UNAME_MACHINE}-nto-qnx${UNAME_RELEASE}
 	exit 0 ;;
     *:QNX:*:4*)
 	echo i386-pc-qnx
 	exit 0 ;;
-    NSR-[GKLNPTVW]:NONSTOP_KERNEL:*:*)
+    NSR-?:NONSTOP_KERNEL:*:*)
 	echo nsr-tandem-nsk${UNAME_RELEASE}
 	exit 0 ;;
     *:NonStop-UX:*:*)
@@ -1090,11 +1233,6 @@
 	fi
 	echo ${UNAME_MACHINE}-unknown-plan9
 	exit 0 ;;
-    i*86:OS/2:*:*)
-	# If we were able to find `uname', then EMX Unix compatibility
-	# is probably installed.
-	echo ${UNAME_MACHINE}-pc-os2-emx
-	exit 0 ;;
     *:TOPS-10:*:*)
 	echo pdp10-unknown-tops10
 	exit 0 ;;
@@ -1113,11 +1251,11 @@
     *:ITS:*:*)
 	echo pdp10-unknown-its
 	exit 0 ;;
-    i*86:XTS-300:*:STOP)
-	echo ${UNAME_MACHINE}-unknown-stop
+    SEI:*:*:SEIUX)
+        echo mips-sei-seiux${UNAME_RELEASE}
 	exit 0 ;;
-    i*86:atheos:*:*)
-	echo ${UNAME_MACHINE}-unknown-atheos
+    *:DragonFly:*:*)
+	echo ${UNAME_MACHINE}-unknown-dragonfly`echo ${UNAME_RELEASE}|sed -e 's/[-(].*//'`
 	exit 0 ;;
 esac
 
@@ -1239,8 +1377,7 @@
 }
 EOF
 
-$CC_FOR_BUILD $dummy.c -o $dummy 2>/dev/null && ./$dummy && rm -f $dummy.c $dummy && exit 0
-rm -f $dummy.c $dummy
+$CC_FOR_BUILD -o $dummy $dummy.c 2>/dev/null && $dummy && exit 0
 
 # Apollos put the system type in the environment.
 
Index: build_tree/bootLoader/tools/config.sub
diff -u build_tree/bootLoader/tools/config.sub:1.1.1.1 build_tree/bootLoader/tools/config.sub:1.1.1.2
--- build_tree/bootLoader/tools/config.sub:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/tools/config.sub	Fri Nov  9 10:37:08 2007
@@ -1,9 +1,9 @@
 #! /bin/sh
 # Configuration validation subroutine script.
 #   Copyright (C) 1992, 1993, 1994, 1995, 1996, 1997, 1998, 1999,
-#   2000, 2001, 2002 Free Software Foundation, Inc.
+#   2000, 2001, 2002, 2003 Free Software Foundation, Inc.
 
-timestamp='2002-01-02'
+timestamp='2004-02-23'
 
 # This file is (in principle) common to ALL GNU software.
 # The presence of a machine in this file suggests that SOME GNU software
@@ -118,7 +118,8 @@
 # Here we must recognize all the valid KERNEL-OS combinations.
 maybe_os=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\2/'`
 case $maybe_os in
-  nto-qnx* | linux-gnu* | storm-chaos* | os2-emx* | windows32-*)
+  nto-qnx* | linux-gnu* | linux-dietlibc | linux-uclibc* | uclinux-uclibc* | uclinux-gnu* | \
+  kfreebsd*-gnu* | knetbsd*-gnu* | netbsd*-gnu* | storm-chaos* | os2-emx* | rtmk-nova*)
     os=-$maybe_os
     basic_machine=`echo $1 | sed 's/^\(.*\)-\([^-]*-[^-]*\)$/\1/'`
     ;;
@@ -228,28 +229,42 @@
 	| a29k \
 	| alpha | alphaev[4-8] | alphaev56 | alphaev6[78] | alphapca5[67] \
 	| alpha64 | alpha64ev[4-8] | alpha64ev56 | alpha64ev6[78] | alpha64pca5[67] \
+	| am33_2.0 \
 	| arc | arm | arm[bl]e | arme[lb] | armv[2345] | armv[345][lb] | avr \
 	| c4x | clipper \
-	| d10v | d30v | dsp16xx \
-	| fr30 \
+	| d10v | d30v | dlx | dsp16xx \
+	| fr30 | frv \
 	| h8300 | h8500 | hppa | hppa1.[01] | hppa2.0 | hppa2.0[nw] | hppa64 \
 	| i370 | i860 | i960 | ia64 \
+	| ip2k | iq2000 \
 	| m32r | m68000 | m68k | m88k | mcore \
-	| mips16 | mips64 | mips64el | mips64orion | mips64orionel \
-	| mips64vr4100 | mips64vr4100el | mips64vr4300 \
-	| mips64vr4300el | mips64vr5000 | mips64vr5000el \
-	| mipsbe | mipseb | mipsel | mipsle | mipstx39 | mipstx39el \
-	| mipsisa32 \
+	| mips | mipsbe | mipseb | mipsel | mipsle \
+	| mips16 \
+	| mips64 | mips64el \
+	| mips64vr | mips64vrel \
+	| mips64orion | mips64orionel \
+	| mips64vr4100 | mips64vr4100el \
+	| mips64vr4300 | mips64vr4300el \
+	| mips64vr5000 | mips64vr5000el \
+	| mipsisa32 | mipsisa32el \
+	| mipsisa32r2 | mipsisa32r2el \
+	| mipsisa64 | mipsisa64el \
+	| mipsisa64r2 | mipsisa64r2el \
+	| mipsisa64sb1 | mipsisa64sb1el \
+	| mipsisa64sr71k | mipsisa64sr71kel \
+	| mipstx39 | mipstx39el \
 	| mn10200 | mn10300 \
+	| msp430 \
 	| ns16k | ns32k \
-	| openrisc \
+	| openrisc | or32 \
 	| pdp10 | pdp11 | pj | pjl \
 	| powerpc | powerpc64 | powerpc64le | powerpcle | ppcbe \
 	| pyramid \
-	| sh | sh[34] | sh[34]eb | shbe | shle \
-	| sparc | sparc64 | sparclet | sparclite | sparcv9 | sparcv9b \
+	| sh | sh[1234] | sh[23]e | sh[34]eb | shbe | shle | sh[1234]le | sh3ele \
+	| sh64 | sh64le \
+	| sparc | sparc64 | sparc86x | sparclet | sparclite | sparcv9 | sparcv9b \
 	| strongarm \
-	| tahoe | thumb | tic80 | tron \
+	| tahoe | thumb | tic4x | tic80 | tron \
 	| v850 | v850e \
 	| we32k \
 	| x86 | xscale | xstormy16 | xtensa \
@@ -281,37 +296,53 @@
 	| alpha-* | alphaev[4-8]-* | alphaev56-* | alphaev6[78]-* \
 	| alpha64-* | alpha64ev[4-8]-* | alpha64ev56-* | alpha64ev6[78]-* \
 	| alphapca5[67]-* | alpha64pca5[67]-* | arc-* \
-	| arm-*  | armbe-* | armle-* | armv*-* \
+	| arm-*  | armbe-* | armle-* | armeb-* | armv*-* \
 	| avr-* \
 	| bs2000-* \
-	| c[123]* | c30-* | [cjt]90-* | c54x-* \
-	| clipper-* | cray2-* | cydra-* \
-	| d10v-* | d30v-* \
+	| c[123]* | c30-* | [cjt]90-* | c4x-* | c54x-* | c55x-* | c6x-* \
+	| clipper-* | cydra-* \
+	| d10v-* | d30v-* | dlx-* \
 	| elxsi-* \
-	| f30[01]-* | f700-* | fr30-* | fx80-* \
+	| f30[01]-* | f700-* | fr30-* | frv-* | fx80-* \
 	| h8300-* | h8500-* \
 	| hppa-* | hppa1.[01]-* | hppa2.0-* | hppa2.0[nw]-* | hppa64-* \
 	| i*86-* | i860-* | i960-* | ia64-* \
+	| ip2k-* | iq2000-* \
 	| m32r-* \
-	| m68000-* | m680[01234]0-* | m68360-* | m683?2-* | m68k-* \
+	| m68000-* | m680[012346]0-* | m68360-* | m683?2-* | m68k-* \
 	| m88110-* | m88k-* | mcore-* \
-	| mips-* | mips16-* | mips64-* | mips64el-* | mips64orion-* \
-	| mips64orionel-* | mips64vr4100-* | mips64vr4100el-* \
-	| mips64vr4300-* | mips64vr4300el-* | mipsbe-* | mipseb-* \
-	| mipsle-* | mipsel-* | mipstx39-* | mipstx39el-* \
-	| none-* | np1-* | ns16k-* | ns32k-* \
+	| mips-* | mipsbe-* | mipseb-* | mipsel-* | mipsle-* \
+	| mips16-* \
+	| mips64-* | mips64el-* \
+	| mips64vr-* | mips64vrel-* \
+	| mips64orion-* | mips64orionel-* \
+	| mips64vr4100-* | mips64vr4100el-* \
+	| mips64vr4300-* | mips64vr4300el-* \
+	| mips64vr5000-* | mips64vr5000el-* \
+	| mipsisa32-* | mipsisa32el-* \
+	| mipsisa32r2-* | mipsisa32r2el-* \
+	| mipsisa64-* | mipsisa64el-* \
+	| mipsisa64r2-* | mipsisa64r2el-* \
+	| mipsisa64sb1-* | mipsisa64sb1el-* \
+	| mipsisa64sr71k-* | mipsisa64sr71kel-* \
+	| mipstx39-* | mipstx39el-* \
+	| msp430-* \
+	| none-* | np1-* | nv1-* | ns16k-* | ns32k-* \
 	| orion-* \
 	| pdp10-* | pdp11-* | pj-* | pjl-* | pn-* | power-* \
 	| powerpc-* | powerpc64-* | powerpc64le-* | powerpcle-* | ppcbe-* \
 	| pyramid-* \
 	| romp-* | rs6000-* \
-	| sh-* | sh[34]-* | sh[34]eb-* | shbe-* | shle-* \
-	| sparc-* | sparc64-* | sparc86x-* | sparclite-* \
-	| sparcv9-* | sparcv9b-* | strongarm-* | sv1-* \
-	| t3e-* | tahoe-* | thumb-* | tic30-* | tic54x-* | tic80-* | tron-* \
+	| sh-* | sh[1234]-* | sh[23]e-* | sh[34]eb-* | shbe-* \
+	| shle-* | sh[1234]le-* | sh3ele-* | sh64-* | sh64le-* \
+	| sparc-* | sparc64-* | sparc86x-* | sparclet-* | sparclite-* \
+	| sparcv9-* | sparcv9b-* | strongarm-* | sv1-* | sx?-* \
+	| tahoe-* | thumb-* \
+	| tic30-* | tic4x-* | tic54x-* | tic55x-* | tic6x-* | tic80-* \
+	| tron-* \
 	| v850-* | v850e-* | vax-* \
 	| we32k-* \
-	| x86-* | x86_64-* | xmp-* | xps100-* | xscale-* | xstormy16-* \
+	| x86-* | x86_64-* | xps100-* | xscale-* | xstormy16-* \
 	| xtensa-* \
 	| ymp-* \
 	| z8k-*)
@@ -332,6 +363,9 @@
 		basic_machine=a29k-amd
 		os=-udi
 		;;
+    	abacus)
+		basic_machine=abacus-unknown
+		;;
 	adobe68k)
 		basic_machine=m68010-adobe
 		os=-scout
@@ -346,6 +380,12 @@
 		basic_machine=a29k-none
 		os=-bsd
 		;;
+	amd64)
+		basic_machine=x86_64-pc
+		;;
+	amd64-*)
+		basic_machine=x86_64-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	amdahl)
 		basic_machine=580-amdahl
 		os=-sysv
@@ -377,6 +417,10 @@
 		basic_machine=ns32k-sequent
 		os=-dynix
 		;;
+	c90)
+		basic_machine=c90-cray
+		os=-unicos
+		;;
 	convex-c1)
 		basic_machine=c1-convex
 		os=-bsd
@@ -397,17 +441,13 @@
 		basic_machine=c38-convex
 		os=-bsd
 		;;
-	cray | ymp)
-		basic_machine=ymp-cray
-		os=-unicos
-		;;
-	cray2)
-		basic_machine=cray2-cray
+	cray | j90)
+		basic_machine=j90-cray
 		os=-unicos
 		;;
-	[cjt]90)
-		basic_machine=${basic_machine}-cray
-		os=-unicos
+	cr16c)
+		basic_machine=cr16c-unknown
+		os=-elf
 		;;
 	crds | unos)
 		basic_machine=m68k-crds
@@ -415,6 +455,10 @@
 	cris | cris-* | etrax*)
 		basic_machine=cris-axis
 		;;
+	crx)
+		basic_machine=crx-unknown
+		os=-elf
+		;;
 	da30 | da30-*)
 		basic_machine=m68k-da30
 		;;
@@ -609,14 +653,6 @@
 		basic_machine=m68k-atari
 		os=-mint
 		;;
-	mipsel*-linux*)
-		basic_machine=mipsel-unknown
-		os=-linux-gnu
-		;;
-	mips*-linux*)
-		basic_machine=mips-unknown
-		os=-linux-gnu
-		;;
 	mips3*-*)
 		basic_machine=`echo $basic_machine | sed -e 's/mips3/mips64/'`
 		;;
@@ -707,6 +743,10 @@
 	np1)
 		basic_machine=np1-gould
 		;;
+	nv1)
+		basic_machine=nv1-cray
+		os=-unicosmp
+		;;
 	nsr-tandem)
 		basic_machine=nsr-tandem
 		;;
@@ -714,6 +754,14 @@
 		basic_machine=hppa1.1-oki
 		os=-proelf
 		;;
+	or32 | or32-*)
+		basic_machine=or32-unknown
+		os=-coff
+		;;
+	os400)
+		basic_machine=powerpc-ibm
+		os=-os400
+		;;
 	OSE68000 | ose68000)
 		basic_machine=m68000-ericsson
 		os=-ose
@@ -736,49 +784,55 @@
 	pbb)
 		basic_machine=m68k-tti
 		;;
-        pc532 | pc532-*)
+	pc532 | pc532-*)
 		basic_machine=ns32k-pc532
 		;;
 	pentium | p5 | k5 | k6 | nexgen | viac3)
 		basic_machine=i586-pc
 		;;
-	pentiumpro | p6 | 6x86 | athlon)
+	pentiumpro | p6 | 6x86 | athlon | athlon_*)
 		basic_machine=i686-pc
 		;;
-	pentiumii | pentium2)
+	pentiumii | pentium2 | pentiumiii | pentium3)
 		basic_machine=i686-pc
 		;;
+	pentium4)
+		basic_machine=i786-pc
+		;;
 	pentium-* | p5-* | k5-* | k6-* | nexgen-* | viac3-*)
 		basic_machine=i586-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	pentiumpro-* | p6-* | 6x86-* | athlon-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
-	pentiumii-* | pentium2-*)
+	pentiumii-* | pentium2-* | pentiumiii-* | pentium3-*)
 		basic_machine=i686-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
+	pentium4-*)
+		basic_machine=i786-`echo $basic_machine | sed 's/^[^-]*-//'`
+		;;
 	pn)
 		basic_machine=pn-gould
 		;;
 	power)	basic_machine=power-ibm
 		;;
 	ppc)	basic_machine=powerpc-unknown
-	        ;;
+		;;
 	ppc-*)	basic_machine=powerpc-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppcle | powerpclittle | ppc-le | powerpc-little)
 		basic_machine=powerpcle-unknown
-	        ;;
+		;;
 	ppcle-* | powerpclittle-*)
 		basic_machine=powerpcle-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64)	basic_machine=powerpc64-unknown
-	        ;;
+		;;
 	ppc64-*) basic_machine=powerpc64-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
 	ppc64le | powerpc64little | ppc64-le | powerpc64-little)
 		basic_machine=powerpc64le-unknown
-	        ;;
+		;;
 	ppc64le-* | powerpc64little-*)
 		basic_machine=powerpc64le-`echo $basic_machine | sed 's/^[^-]*-//'`
 		;;
@@ -809,6 +863,16 @@
 		basic_machine=a29k-amd
 		os=-udi
 		;;
+	sb1)
+		basic_machine=mipsisa64sb1-unknown
+		;;
+	sb1el)
+		basic_machine=mipsisa64sb1el-unknown
+		;;
+	sei)
+		basic_machine=mips-sei
+		os=-seiux
+		;;
 	sequent)
 		basic_machine=i386-sequent
 		;;
@@ -816,6 +880,9 @@
 		basic_machine=sh-hitachi
 		os=-hms
 		;;
+	sh64)
+		basic_machine=sh64-unknown
+		;;
 	sparclite-wrs | simso-wrs)
 		basic_machine=sparclite-wrs
 		os=-vxworks
@@ -883,13 +950,25 @@
 		os=-dynix
 		;;
 	t3e)
-		basic_machine=t3e-cray
+		basic_machine=alphaev5-cray
+		os=-unicos
+		;;
+	t90)
+		basic_machine=t90-cray
 		os=-unicos
 		;;
 	tic54x | c54x*)
 		basic_machine=tic54x-unknown
 		os=-coff
 		;;
+	tic55x | c55x*)
+		basic_machine=tic55x-unknown
+		os=-coff
+		;;
+	tic6x | c6x*)
+		basic_machine=tic6x-unknown
+		os=-coff
+		;;
 	tx39)
 		basic_machine=mipstx39-unknown
 		;;
@@ -903,6 +982,10 @@
 	tower | tower-32)
 		basic_machine=m68k-ncr
 		;;
+	tpf)
+		basic_machine=s390x-ibm
+		os=-tpf
+		;;
 	udi29k)
 		basic_machine=a29k-amd
 		os=-udi
@@ -924,8 +1007,8 @@
 		os=-vms
 		;;
 	vpp*|vx|vx-*)
-               basic_machine=f301-fujitsu
-               ;;
+		basic_machine=f301-fujitsu
+		;;
 	vxworks960)
 		basic_machine=i960-wrs
 		os=-vxworks
@@ -946,17 +1029,13 @@
 		basic_machine=hppa1.1-winbond
 		os=-proelf
 		;;
-	windows32)
-		basic_machine=i386-pc
-		os=-windows32-msvcrt
+	xps | xps100)
+		basic_machine=xps100-honeywell
 		;;
-	xmp)
-		basic_machine=xmp-cray
+	ymp)
+		basic_machine=ymp-cray
 		os=-unicos
 		;;
-        xps | xps100)
-		basic_machine=xps100-honeywell
-		;;
 	z8k-*-coff)
 		basic_machine=z8k-unknown
 		os=-sim
@@ -977,13 +1056,6 @@
 	op60c)
 		basic_machine=hppa1.1-oki
 		;;
-	mips)
-		if [ x$os = x-linux-gnu ]; then
-			basic_machine=mips-unknown
-		else
-			basic_machine=mips-mips
-		fi
-		;;
 	romp)
 		basic_machine=romp-ibm
 		;;
@@ -1003,13 +1075,16 @@
 	we32k)
 		basic_machine=we32k-att
 		;;
-	sh3 | sh4 | sh3eb | sh4eb)
+	sh3 | sh4 | sh[34]eb | sh[1234]le | sh[23]ele)
 		basic_machine=sh-unknown
 		;;
+	sh64)
+		basic_machine=sh64-unknown
+		;;
 	sparc | sparcv9 | sparcv9b)
 		basic_machine=sparc-sun
 		;;
-        cydra)
+	cydra)
 		basic_machine=cydra-cydrome
 		;;
 	orion)
@@ -1024,10 +1099,6 @@
 	pmac | pmac-mpw)
 		basic_machine=powerpc-apple
 		;;
-	c4x*)
-		basic_machine=c4x-none
-		os=-coff
-		;;
 	*-unknown)
 		# Make sure to match an already-canonicalized machine name.
 		;;
@@ -1083,17 +1154,20 @@
 	      | -aos* \
 	      | -nindy* | -vxsim* | -vxworks* | -ebmon* | -hms* | -mvs* \
 	      | -clix* | -riscos* | -uniplus* | -iris* | -rtu* | -xenix* \
-	      | -hiux* | -386bsd* | -netbsd* | -openbsd* | -freebsd* | -riscix* \
-	      | -lynxos* | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
+	      | -hiux* | -386bsd* | -knetbsd* | -mirbsd* | -netbsd* | -openbsd* \
+	      | -ekkobsd* | -kfreebsd* | -freebsd* | -riscix* | -lynxos* \
+	      | -bosx* | -nextstep* | -cxux* | -aout* | -elf* | -oabi* \
 	      | -ptx* | -coff* | -ecoff* | -winnt* | -domain* | -vsta* \
 	      | -udi* | -eabi* | -lites* | -ieee* | -go32* | -aux* \
 	      | -chorusos* | -chorusrdb* \
 	      | -cygwin* | -pe* | -psos* | -moss* | -proelf* | -rtems* \
-	      | -mingw32* | -linux-gnu* | -uxpv* | -beos* | -mpeix* | -udk* \
-	      | -interix* | -uwin* | -rhapsody* | -darwin* | -opened* \
+	      | -mingw32* | -linux-gnu* | -linux-uclibc* | -uxpv* | -beos* | -mpeix* | -udk* \
+	      | -interix* | -uwin* | -mks* | -rhapsody* | -darwin* | -opened* \
 	      | -openstep* | -oskit* | -conix* | -pw32* | -nonstopux* \
 	      | -storm-chaos* | -tops10* | -tenex* | -tops20* | -its* \
-	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* | -morphos*)
+	      | -os2* | -vos* | -palmos* | -uclinux* | -nucleus* \
+	      | -morphos* | -superux* | -rtmk* | -rtmk-nova* | -windiss* \
+	      | -powermax* | -dnix* | -nx6 | -nx7 | -sei* | -dragonfly*)
 	# Remember, each alternative MUST END IN *, to match a version number.
 		;;
 	-qnx*)
@@ -1105,8 +1179,10 @@
 			;;
 		esac
 		;;
+	-nto-qnx*)
+		;;
 	-nto*)
-		os=-nto-qnx
+		os=`echo $os | sed -e 's|nto|nto-qnx|'`
 		;;
 	-sim | -es1800* | -hms* | -xray | -os68k* | -none* | -v88r* \
 	      | -windows* | -osx | -abug | -netware* | -os9* | -beos* \
@@ -1115,6 +1191,9 @@
 	-mac*)
 		os=`echo $os | sed -e 's|mac|macos|'`
 		;;
+	-linux-dietlibc)
+		os=-linux-dietlibc
+		;;
 	-linux*)
 		os=`echo $os | sed -e 's|linux|linux-gnu|'`
 		;;
@@ -1127,6 +1206,9 @@
 	-opened*)
 		os=-openedition
 		;;
+        -os400*)
+		os=-os400
+		;;
 	-wince*)
 		os=-wince
 		;;
@@ -1148,14 +1230,20 @@
 	-atheos*)
 		os=-atheos
 		;;
+	-syllable*)
+		os=-syllable
+		;;
 	-386bsd)
 		os=-bsd
 		;;
 	-ctix* | -uts*)
 		os=-sysv
 		;;
+	-nova*)
+		os=-rtmk-nova
+		;;
 	-ns2 )
-	        os=-nextstep2
+		os=-nextstep2
 		;;
 	-nsk*)
 		os=-nsk
@@ -1167,6 +1255,9 @@
 	-sinix*)
 		os=-sysv4
 		;;
+        -tpf*)
+		os=-tpf
+		;;
 	-triton*)
 		os=-sysv3
 		;;
@@ -1194,8 +1285,14 @@
 	-xenix)
 		os=-xenix
 		;;
-        -*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
-	        os=-mint
+	-*mint | -mint[0-9]* | -*MiNT | -MiNT[0-9]*)
+		os=-mint
+		;;
+	-aros*)
+		os=-aros
+		;;
+	-kaos*)
+		os=-kaos
 		;;
 	-none)
 		;;
@@ -1228,11 +1325,14 @@
 	arm*-semi)
 		os=-aout
 		;;
+    c4x-* | tic4x-*)
+        os=-coff
+        ;;
 	# This must come before the *-dec entry.
 	pdp10-*)
 		os=-tops20
 		;;
-        pdp11-*)
+	pdp11-*)
 		os=-none
 		;;
 	*-dec | vax-*)
@@ -1259,6 +1359,9 @@
 	mips*-*)
 		os=-elf
 		;;
+	or32-*)
+		os=-coff
+		;;
 	*-tti)	# must be before sparc entry or we get the wrong os.
 		os=-sysv3
 		;;
@@ -1322,19 +1425,19 @@
 	*-next)
 		os=-nextstep3
 		;;
-        *-gould)
+	*-gould)
 		os=-sysv
 		;;
-        *-highlevel)
+	*-highlevel)
 		os=-bsd
 		;;
 	*-encore)
 		os=-bsd
 		;;
-        *-sgi)
+	*-sgi)
 		os=-irix
 		;;
-        *-siemens)
+	*-siemens)
 		os=-sysv4
 		;;
 	*-masscomp)
@@ -1403,10 +1506,16 @@
 			-mvs* | -opened*)
 				vendor=ibm
 				;;
+			-os400*)
+				vendor=ibm
+				;;
 			-ptx*)
 				vendor=sequent
 				;;
-			-vxsim* | -vxworks*)
+			-tpf*)
+				vendor=ibm
+				;;
+			-vxsim* | -vxworks* | -windiss*)
 				vendor=wrs
 				;;
 			-aux*)
Index: build_tree/bootLoader/tools/depcomp
diff -u /dev/null build_tree/bootLoader/tools/depcomp:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/tools/depcomp	Fri Nov  9 10:37:08 2007
@@ -0,0 +1,520 @@
+#! /bin/sh
+# depcomp - compile a program generating dependencies as side-effects
+
+scriptversion=2003-11-08.23
+
+# Copyright (C) 1999, 2000, 2003 Free Software Foundation, Inc.
+
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2, or (at your option)
+# any later version.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
+# 02111-1307, USA.
+
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program that contains a
+# configuration script generated by Autoconf, you may include it under
+# the same distribution terms that you use for the rest of that program.
+
+# Originally written by Alexandre Oliva <oliva@dcc.unicamp.br>.
+
+case $1 in
+  '')
+     echo "$0: No command.  Try \`$0 --help' for more information." 1>&2
+     exit 1;
+     ;;
+  -h | --h*)
+    cat <<\EOF
+Usage: depcomp [--help] [--version] PROGRAM [ARGS]
+
+Run PROGRAMS ARGS to compile a file, generating dependencies
+as side-effects.
+
+Environment variables:
+  depmode     Dependency tracking mode.
+  source      Source file read by `PROGRAMS ARGS'.
+  object      Object file output by `PROGRAMS ARGS'.
+  depfile     Dependency file to output.
+  tmpdepfile  Temporary file to use when outputing dependencies.
+  libtool     Whether libtool is used (yes/no).
+
+Report bugs to <bug-automake@gnu.org>.
+EOF
+    exit 0
+    ;;
+  -v | --v*)
+    echo "depcomp $scriptversion"
+    exit 0
+    ;;
+esac
+
+if test -z "$depmode" || test -z "$source" || test -z "$object"; then
+  echo "depcomp: Variables source, object and depmode must be set" 1>&2
+  exit 1
+fi
+# `libtool' can also be set to `yes' or `no'.
+
+if test -z "$depfile"; then
+   base=`echo "$object" | sed -e 's,^.*/,,' -e 's,\.\([^.]*\)$,.P\1,'`
+   dir=`echo "$object" | sed 's,/.*$,/,'`
+   if test "$dir" = "$object"; then
+      dir=
+   fi
+   # FIXME: should be _deps on DOS.
+   depfile="$dir.deps/$base"
+fi
+
+tmpdepfile=${tmpdepfile-`echo "$depfile" | sed 's/\.\([^.]*\)$/.T\1/'`}
+
+rm -f "$tmpdepfile"
+
+# Some modes work just like other modes, but use different flags.  We
+# parameterize here, but still list the modes in the big case below,
+# to make depend.m4 easier to write.  Note that we *cannot* use a case
+# here, because this file can only contain one case statement.
+if test "$depmode" = hp; then
+  # HP compiler uses -M and no extra arg.
+  gccflag=-M
+  depmode=gcc
+fi
+
+if test "$depmode" = dashXmstdout; then
+   # This is just like dashmstdout with a different argument.
+   dashmflag=-xM
+   depmode=dashmstdout
+fi
+
+case "$depmode" in
+gcc3)
+## gcc 3 implements dependency tracking that does exactly what
+## we want.  Yay!  Note: for some reason libtool 1.4 doesn't like
+## it if -MD -MP comes after the -MF stuff.  Hmm.
+  "$@" -MT "$object" -MD -MP -MF "$tmpdepfile"
+  stat=$?
+  if test $stat -eq 0; then :
+  else
+    rm -f "$tmpdepfile"
+    exit $stat
+  fi
+  mv "$tmpdepfile" "$depfile"
+  ;;
+
+gcc)
+## There are various ways to get dependency output from gcc.  Here's
+## why we pick this rather obscure method:
+## - Don't want to use -MD because we'd like the dependencies to end
+##   up in a subdir.  Having to rename by hand is ugly.
+##   (We might end up doing this anyway to support other compilers.)
+## - The DEPENDENCIES_OUTPUT environment variable makes gcc act like
+##   -MM, not -M (despite what the docs say).
+## - Using -M directly means running the compiler twice (even worse
+##   than renaming).
+  if test -z "$gccflag"; then
+    gccflag=-MD,
+  fi
+  "$@" -Wp,"$gccflag$tmpdepfile"
+  stat=$?
+  if test $stat -eq 0; then :
+  else
+    rm -f "$tmpdepfile"
+    exit $stat
+  fi
+  rm -f "$depfile"
+  echo "$object : \\" > "$depfile"
+  alpha=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz
+## The second -e expression handles DOS-style file names with drive letters.
+  sed -e 's/^[^:]*: / /' \
+      -e 's/^['$alpha']:\/[^:]*: / /' < "$tmpdepfile" >> "$depfile"
+## This next piece of magic avoids the `deleted header file' problem.
+## The problem is that when a header file which appears in a .P file
+## is deleted, the dependency causes make to die (because there is
+## typically no way to rebuild the header).  We avoid this by adding
+## dummy dependencies for each header file.  Too bad gcc doesn't do
+## this for us directly.
+  tr ' ' '
+' < "$tmpdepfile" |
+## Some versions of gcc put a space before the `:'.  On the theory
+## that the space means something, we add a space to the output as
+## well.
+## Some versions of the HPUX 10.20 sed can't process this invocation
+## correctly.  Breaking it into two sed invocations is a workaround.
+    sed -e 's/^\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> "$depfile"
+  rm -f "$tmpdepfile"
+  ;;
+
+hp)
+  # This case exists only to let depend.m4 do its work.  It works by
+  # looking at the text of this script.  This case will never be run,
+  # since it is checked for above.
+  exit 1
+  ;;
+
+sgi)
+  if test "$libtool" = yes; then
+    "$@" "-Wp,-MDupdate,$tmpdepfile"
+  else
+    "$@" -MDupdate "$tmpdepfile"
+  fi
+  stat=$?
+  if test $stat -eq 0; then :
+  else
+    rm -f "$tmpdepfile"
+    exit $stat
+  fi
+  rm -f "$depfile"
+
+  if test -f "$tmpdepfile"; then  # yes, the sourcefile depend on other files
+    echo "$object : \\" > "$depfile"
+
+    # Clip off the initial element (the dependent).  Don't try to be
+    # clever and replace this with sed code, as IRIX sed won't handle
+    # lines with more than a fixed number of characters (4096 in
+    # IRIX 6.2 sed, 8192 in IRIX 6.5).  We also remove comment lines;
+    # the IRIX cc adds comments like `#:fec' to the end of the
+    # dependency line.
+    tr ' ' '
+' < "$tmpdepfile" \
+    | sed -e 's/^.*\.o://' -e 's/#.*$//' -e '/^$/ d' | \
+    tr '
+' ' ' >> $depfile
+    echo >> $depfile
+
+    # The second pass generates a dummy entry for each header file.
+    tr ' ' '
+' < "$tmpdepfile" \
+   | sed -e 's/^.*\.o://' -e 's/#.*$//' -e '/^$/ d' -e 's/$/:/' \
+   >> $depfile
+  else
+    # The sourcefile does not contain any dependencies, so just
+    # store a dummy comment line, to avoid errors with the Makefile
+    # "include basename.Plo" scheme.
+    echo "#dummy" > "$depfile"
+  fi
+  rm -f "$tmpdepfile"
+  ;;
+
+aix)
+  # The C for AIX Compiler uses -M and outputs the dependencies
+  # in a .u file.  In older versions, this file always lives in the
+  # current directory.  Also, the AIX compiler puts `$object:' at the
+  # start of each line; $object doesn't have directory information.
+  # Version 6 uses the directory in both cases.
+  stripped=`echo "$object" | sed 's/\(.*\)\..*$/\1/'`
+  tmpdepfile="$stripped.u"
+  if test "$libtool" = yes; then
+    "$@" -Wc,-M
+  else
+    "$@" -M
+  fi
+  stat=$?
+
+  if test -f "$tmpdepfile"; then :
+  else
+    stripped=`echo "$stripped" | sed 's,^.*/,,'`
+    tmpdepfile="$stripped.u"
+  fi
+
+  if test $stat -eq 0; then :
+  else
+    rm -f "$tmpdepfile"
+    exit $stat
+  fi
+
+  if test -f "$tmpdepfile"; then
+    outname="$stripped.o"
+    # Each line is of the form `foo.o: dependent.h'.
+    # Do two passes, one to just change these to
+    # `$object: dependent.h' and one to simply `dependent.h:'.
+    sed -e "s,^$outname:,$object :," < "$tmpdepfile" > "$depfile"
+    sed -e "s,^$outname: \(.*\)$,\1:," < "$tmpdepfile" >> "$depfile"
+  else
+    # The sourcefile does not contain any dependencies, so just
+    # store a dummy comment line, to avoid errors with the Makefile
+    # "include basename.Plo" scheme.
+    echo "#dummy" > "$depfile"
+  fi
+  rm -f "$tmpdepfile"
+  ;;
+
+icc)
+  # Intel's C compiler understands `-MD -MF file'.  However on
+  #    icc -MD -MF foo.d -c -o sub/foo.o sub/foo.c
+  # ICC 7.0 will fill foo.d with something like
+  #    foo.o: sub/foo.c
+  #    foo.o: sub/foo.h
+  # which is wrong.  We want:
+  #    sub/foo.o: sub/foo.c
+  #    sub/foo.o: sub/foo.h
+  #    sub/foo.c:
+  #    sub/foo.h:
+  # ICC 7.1 will output
+  #    foo.o: sub/foo.c sub/foo.h
+  # and will wrap long lines using \ :
+  #    foo.o: sub/foo.c ... \
+  #     sub/foo.h ... \
+  #     ...
+
+  "$@" -MD -MF "$tmpdepfile"
+  stat=$?
+  if test $stat -eq 0; then :
+  else
+    rm -f "$tmpdepfile"
+    exit $stat
+  fi
+  rm -f "$depfile"
+  # Each line is of the form `foo.o: dependent.h',
+  # or `foo.o: dep1.h dep2.h \', or ` dep3.h dep4.h \'.
+  # Do two passes, one to just change these to
+  # `$object: dependent.h' and one to simply `dependent.h:'.
+  sed "s,^[^:]*:,$object :," < "$tmpdepfile" > "$depfile"
+  # Some versions of the HPUX 10.20 sed can't process this invocation
+  # correctly.  Breaking it into two sed invocations is a workaround.
+  sed 's,^[^:]*: \(.*\)$,\1,;s/^\\$//;/^$/d;/:$/d' < "$tmpdepfile" |
+    sed -e 's/$/ :/' >> "$depfile"
+  rm -f "$tmpdepfile"
+  ;;
+
+tru64)
+   # The Tru64 compiler uses -MD to generate dependencies as a side
+   # effect.  `cc -MD -o foo.o ...' puts the dependencies into `foo.o.d'.
+   # At least on Alpha/Redhat 6.1, Compaq CCC V6.2-504 seems to put
+   # dependencies in `foo.d' instead, so we check for that too.
+   # Subdirectories are respected.
+   dir=`echo "$object" | sed -e 's|/[^/]*$|/|'`
+   test "x$dir" = "x$object" && dir=
+   base=`echo "$object" | sed -e 's|^.*/||' -e 's/\.o$//' -e 's/\.lo$//'`
+
+   if test "$libtool" = yes; then
+      tmpdepfile1="$dir.libs/$base.lo.d"
+      tmpdepfile2="$dir.libs/$base.d"
+      "$@" -Wc,-MD
+   else
+      tmpdepfile1="$dir$base.o.d"
+      tmpdepfile2="$dir$base.d"
+      "$@" -MD
+   fi
+
+   stat=$?
+   if test $stat -eq 0; then :
+   else
+      rm -f "$tmpdepfile1" "$tmpdepfile2"
+      exit $stat
+   fi
+
+   if test -f "$tmpdepfile1"; then
+      tmpdepfile="$tmpdepfile1"
+   else
+      tmpdepfile="$tmpdepfile2"
+   fi
+   if test -f "$tmpdepfile"; then
+      sed -e "s,^.*\.[a-z]*:,$object:," < "$tmpdepfile" > "$depfile"
+      # That's a tab and a space in the [].
+      sed -e 's,^.*\.[a-z]*:[	 ]*,,' -e 's,$,:,' < "$tmpdepfile" >> "$depfile"
+   else
+      echo "#dummy" > "$depfile"
+   fi
+   rm -f "$tmpdepfile"
+   ;;
+
+#nosideeffect)
+  # This comment above is used by automake to tell side-effect
+  # dependency tracking mechanisms from slower ones.
+
+dashmstdout)
+  # Important note: in order to support this mode, a compiler *must*
+  # always write the preprocessed file to stdout, regardless of -o.
+  "$@" || exit $?
+
+  # Remove the call to Libtool.
+  if test "$libtool" = yes; then
+    while test $1 != '--mode=compile'; do
+      shift
+    done
+    shift
+  fi
+
+  # Remove `-o $object'.
+  IFS=" "
+  for arg
+  do
+    case $arg in
+    -o)
+      shift
+      ;;
+    $object)
+      shift
+      ;;
+    *)
+      set fnord "$@" "$arg"
+      shift # fnord
+      shift # $arg
+      ;;
+    esac
+  done
+
+  test -z "$dashmflag" && dashmflag=-M
+  # Require at least two characters before searching for `:'
+  # in the target name.  This is to cope with DOS-style filenames:
+  # a dependency such as `c:/foo/bar' could be seen as target `c' otherwise.
+  "$@" $dashmflag |
+    sed 's:^[  ]*[^: ][^:][^:]*\:[    ]*:'"$object"'\: :' > "$tmpdepfile"
+  rm -f "$depfile"
+  cat < "$tmpdepfile" > "$depfile"
+  tr ' ' '
+' < "$tmpdepfile" | \
+## Some versions of the HPUX 10.20 sed can't process this invocation
+## correctly.  Breaking it into two sed invocations is a workaround.
+    sed -e 's/^\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> "$depfile"
+  rm -f "$tmpdepfile"
+  ;;
+
+dashXmstdout)
+  # This case only exists to satisfy depend.m4.  It is never actually
+  # run, as this mode is specially recognized in the preamble.
+  exit 1
+  ;;
+
+makedepend)
+  "$@" || exit $?
+  # Remove any Libtool call
+  if test "$libtool" = yes; then
+    while test $1 != '--mode=compile'; do
+      shift
+    done
+    shift
+  fi
+  # X makedepend
+  shift
+  cleared=no
+  for arg in "$@"; do
+    case $cleared in
+    no)
+      set ""; shift
+      cleared=yes ;;
+    esac
+    case "$arg" in
+    -D*|-I*)
+      set fnord "$@" "$arg"; shift ;;
+    # Strip any option that makedepend may not understand.  Remove
+    # the object too, otherwise makedepend will parse it as a source file.
+    -*|$object)
+      ;;
+    *)
+      set fnord "$@" "$arg"; shift ;;
+    esac
+  done
+  obj_suffix="`echo $object | sed 's/^.*\././'`"
+  touch "$tmpdepfile"
+  ${MAKEDEPEND-makedepend} -o"$obj_suffix" -f"$tmpdepfile" "$@"
+  rm -f "$depfile"
+  cat < "$tmpdepfile" > "$depfile"
+  sed '1,2d' "$tmpdepfile" | tr ' ' '
+' | \
+## Some versions of the HPUX 10.20 sed can't process this invocation
+## correctly.  Breaking it into two sed invocations is a workaround.
+    sed -e 's/^\\$//' -e '/^$/d' -e '/:$/d' | sed -e 's/$/ :/' >> "$depfile"
+  rm -f "$tmpdepfile" "$tmpdepfile".bak
+  ;;
+
+cpp)
+  # Important note: in order to support this mode, a compiler *must*
+  # always write the preprocessed file to stdout.
+  "$@" || exit $?
+
+  # Remove the call to Libtool.
+  if test "$libtool" = yes; then
+    while test $1 != '--mode=compile'; do
+      shift
+    done
+    shift
+  fi
+
+  # Remove `-o $object'.
+  IFS=" "
+  for arg
+  do
+    case $arg in
+    -o)
+      shift
+      ;;
+    $object)
+      shift
+      ;;
+    *)
+      set fnord "$@" "$arg"
+      shift # fnord
+      shift # $arg
+      ;;
+    esac
+  done
+
+  "$@" -E |
+    sed -n '/^# [0-9][0-9]* "\([^"]*\)".*/ s:: \1 \\:p' |
+    sed '$ s: \\$::' > "$tmpdepfile"
+  rm -f "$depfile"
+  echo "$object : \\" > "$depfile"
+  cat < "$tmpdepfile" >> "$depfile"
+  sed < "$tmpdepfile" '/^$/d;s/^ //;s/ \\$//;s/$/ :/' >> "$depfile"
+  rm -f "$tmpdepfile"
+  ;;
+
+msvisualcpp)
+  # Important note: in order to support this mode, a compiler *must*
+  # always write the preprocessed file to stdout, regardless of -o,
+  # because we must use -o when running libtool.
+  "$@" || exit $?
+  IFS=" "
+  for arg
+  do
+    case "$arg" in
+    "-Gm"|"/Gm"|"-Gi"|"/Gi"|"-ZI"|"/ZI")
+	set fnord "$@"
+	shift
+	shift
+	;;
+    *)
+	set fnord "$@" "$arg"
+	shift
+	shift
+	;;
+    esac
+  done
+  "$@" -E |
+  sed -n '/^#line [0-9][0-9]* "\([^"]*\)"/ s::echo "`cygpath -u \\"\1\\"`":p' | sort | uniq > "$tmpdepfile"
+  rm -f "$depfile"
+  echo "$object : \\" > "$depfile"
+  . "$tmpdepfile" | sed 's% %\\ %g' | sed -n '/^\(.*\)$/ s::	\1 \\:p' >> "$depfile"
+  echo "	" >> "$depfile"
+  . "$tmpdepfile" | sed 's% %\\ %g' | sed -n '/^\(.*\)$/ s::\1\::p' >> "$depfile"
+  rm -f "$tmpdepfile"
+  ;;
+
+none)
+  exec "$@"
+  ;;
+
+*)
+  echo "Unknown depmode $depmode" 1>&2
+  exit 1
+  ;;
+esac
+
+exit 0
+
+# Local Variables:
+# mode: shell-script
+# sh-indentation: 2
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "scriptversion="
+# time-stamp-format: "%:y-%02m-%02d.%02H"
+# time-stamp-end: "$"
+# End:
Index: build_tree/bootLoader/tools/install-sh
diff -u build_tree/bootLoader/tools/install-sh:1.1.1.1 build_tree/bootLoader/tools/install-sh:1.1.1.2
--- build_tree/bootLoader/tools/install-sh:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/tools/install-sh	Fri Nov  9 10:37:08 2007
@@ -1,19 +1,38 @@
 #!/bin/sh
-#
 # install - install a program, script, or datafile
-# This comes from X11R5 (mit/util/scripts/install.sh).
+
+scriptversion=2004-02-15.20
+
+# This originates from X11R5 (mit/util/scripts/install.sh), which was
+# later released in X11R6 (xc/config/util/install.sh) with the
+# following copyright and license.
+#
+# Copyright (C) 1994 X Consortium
+#
+# Permission is hereby granted, free of charge, to any person obtaining a copy
+# of this software and associated documentation files (the "Software"), to
+# deal in the Software without restriction, including without limitation the
+# rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
+# sell copies of the Software, and to permit persons to whom the Software is
+# furnished to do so, subject to the following conditions:
 #
-# Copyright 1991 by the Massachusetts Institute of Technology
+# The above copyright notice and this permission notice shall be included in
+# all copies or substantial portions of the Software.
 #
-# Permission to use, copy, modify, distribute, and sell this software and its
-# documentation for any purpose is hereby granted without fee, provided that
-# the above copyright notice appear in all copies and that both that
-# copyright notice and this permission notice appear in supporting
-# documentation, and that the name of M.I.T. not be used in advertising or
-# publicity pertaining to distribution of the software without specific,
-# written prior permission.  M.I.T. makes no representations about the
-# suitability of this software for any purpose.  It is provided "as is"
-# without express or implied warranty.
+# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
+# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
+# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
+# X CONSORTIUM BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
+# AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNEC-
+# TION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+#
+# Except as contained in this notice, the name of the X Consortium shall not
+# be used in advertising or otherwise to promote the sale, use or other deal-
+# ings in this Software without prior written authorization from the X Consor-
+# tium.
+#
+#
+# FSF changes to this file are in the public domain.
 #
 # Calling this script install-sh is preferred over install.sh, to prevent
 # `make' implicit rules from creating a file called install from it
@@ -23,13 +42,11 @@
 # from scratch.  It can only install one file at a time, a restriction
 # shared with many OS's install programs.
 
-
 # set DOITPROG to echo to test this script
 
 # Don't use :- since 4.3BSD and earlier shells don't like it.
 doit="${DOITPROG-}"
 
-
 # put in absolute paths if you don't have them in your path; or use env. vars.
 
 mvprog="${MVPROG-mv}"
@@ -41,211 +58,259 @@
 rmprog="${RMPROG-rm}"
 mkdirprog="${MKDIRPROG-mkdir}"
 
-transformbasename=""
-transform_arg=""
+transformbasename=
+transform_arg=
 instcmd="$mvprog"
 chmodcmd="$chmodprog 0755"
-chowncmd=""
-chgrpcmd=""
-stripcmd=""
+chowncmd=
+chgrpcmd=
+stripcmd=
 rmcmd="$rmprog -f"
 mvcmd="$mvprog"
-src=""
-dst=""
-dir_arg=""
-
-while [ x"$1" != x ]; do
-    case $1 in
-	-c) instcmd="$cpprog"
-	    shift
-	    continue;;
-
-	-d) dir_arg=true
-	    shift
-	    continue;;
-
-	-m) chmodcmd="$chmodprog $2"
-	    shift
-	    shift
-	    continue;;
-
-	-o) chowncmd="$chownprog $2"
-	    shift
-	    shift
-	    continue;;
-
-	-g) chgrpcmd="$chgrpprog $2"
-	    shift
-	    shift
-	    continue;;
-
-	-s) stripcmd="$stripprog"
-	    shift
-	    continue;;
-
-	-t=*) transformarg=`echo $1 | sed 's/-t=//'`
-	    shift
-	    continue;;
-
-	-b=*) transformbasename=`echo $1 | sed 's/-b=//'`
-	    shift
-	    continue;;
-
-	*)  if [ x"$src" = x ]
-	    then
-		src=$1
-	    else
-		# this colon is to work around a 386BSD /bin/sh bug
-		:
-		dst=$1
-	    fi
-	    shift
-	    continue;;
-    esac
+src=
+dst=
+dir_arg=
+
+usage="Usage: $0 [OPTION]... SRCFILE DSTFILE
+   or: $0 [OPTION]... SRCFILES... DIRECTORY
+   or: $0 -d DIRECTORIES...
+
+In the first form, install SRCFILE to DSTFILE, removing SRCFILE by default.
+In the second, create the directory path DIR.
+
+Options:
+-b=TRANSFORMBASENAME
+-c         copy source (using $cpprog) instead of moving (using $mvprog).
+-d         create directories instead of installing files.
+-g GROUP   $chgrp installed files to GROUP.
+-m MODE    $chmod installed files to MODE.
+-o USER    $chown installed files to USER.
+-s         strip installed files (using $stripprog).
+-t=TRANSFORM
+--help     display this help and exit.
+--version  display version info and exit.
+
+Environment variables override the default commands:
+  CHGRPPROG CHMODPROG CHOWNPROG CPPROG MKDIRPROG MVPROG RMPROG STRIPPROG
+"
+
+while test -n "$1"; do
+  case $1 in
+    -b=*) transformbasename=`echo $1 | sed 's/-b=//'`
+        shift
+        continue;;
+
+    -c) instcmd=$cpprog
+        shift
+        continue;;
+
+    -d) dir_arg=true
+        shift
+        continue;;
+
+    -g) chgrpcmd="$chgrpprog $2"
+        shift
+        shift
+        continue;;
+
+    --help) echo "$usage"; exit 0;;
+
+    -m) chmodcmd="$chmodprog $2"
+        shift
+        shift
+        continue;;
+
+    -o) chowncmd="$chownprog $2"
+        shift
+        shift
+        continue;;
+
+    -s) stripcmd=$stripprog
+        shift
+        continue;;
+
+    -t=*) transformarg=`echo $1 | sed 's/-t=//'`
+        shift
+        continue;;
+
+    --version) echo "$0 $scriptversion"; exit 0;;
+
+    *)  # When -d is used, all remaining arguments are directories to create.
+	test -n "$dir_arg" && break
+        # Otherwise, the last argument is the destination.  Remove it from $@.
+	for arg
+	do
+          if test -n "$dstarg"; then
+	    # $@ is not empty: it contains at least $arg.
+	    set fnord "$@" "$dstarg"
+	    shift # fnord
+	  fi
+	  shift # arg
+	  dstarg=$arg
+	done
+	break;;
+  esac
 done
 
-if [ x"$src" = x ]
-then
-	echo "install:	no input file specified"
-	exit 1
-else
-	true
+if test -z "$1"; then
+  if test -z "$dir_arg"; then
+    echo "$0: no input file specified." >&2
+    exit 1
+  fi
+  # It's OK to call `install-sh -d' without argument.
+  # This can happen when creating conditional directories.
+  exit 0
 fi
 
-if [ x"$dir_arg" != x ]; then
-	dst=$src
-	src=""
-	
-	if [ -d $dst ]; then
-		instcmd=:
-		chmodcmd=""
-	else
-		instcmd=mkdir
-	fi
-else
-
-# Waiting for this to be detected by the "$instcmd $src $dsttmp" command
-# might cause directories to be created, which would be especially bad 
-# if $src (and thus $dsttmp) contains '*'.
-
-	if [ -f $src -o -d $src ]
-	then
-		true
-	else
-		echo "install:  $src does not exist"
-		exit 1
-	fi
-	
-	if [ x"$dst" = x ]
-	then
-		echo "install:	no destination specified"
-		exit 1
-	else
-		true
-	fi
-
-# If destination is a directory, append the input filename; if your system
-# does not like double slashes in filenames, you may need to add some logic
-
-	if [ -d $dst ]
-	then
-		dst="$dst"/`basename $src`
-	else
-		true
-	fi
-fi
-
-## this sed command emulates the dirname command
-dstdir=`echo $dst | sed -e 's,[^/]*$,,;s,/$,,;s,^$,.,'`
-
-# Make sure that the destination directory exists.
-#  this part is taken from Noah Friedman's mkinstalldirs script
-
-# Skip lots of stat calls in the usual case.
-if [ ! -d "$dstdir" ]; then
-defaultIFS='	
-'
-IFS="${IFS-${defaultIFS}}"
-
-oIFS="${IFS}"
-# Some sh's can't handle IFS=/ for some reason.
-IFS='%'
-set - `echo ${dstdir} | sed -e 's@/@%@g' -e 's@^%@/@'`
-IFS="${oIFS}"
-
-pathcomp=''
-
-while [ $# -ne 0 ] ; do
-	pathcomp="${pathcomp}${1}"
-	shift
-
-	if [ ! -d "${pathcomp}" ] ;
-        then
-		$mkdirprog "${pathcomp}"
-	else
-		true
-	fi
+for src
+do
+  # Protect names starting with `-'.
+  case $src in
+    -*) src=./$src ;;
+  esac
+
+  if test -n "$dir_arg"; then
+    dst=$src
+    src=
+
+    if test -d "$dst"; then
+      instcmd=:
+      chmodcmd=
+    else
+      instcmd=$mkdirprog
+    fi
+  else
+    # Waiting for this to be detected by the "$instcmd $src $dsttmp" command
+    # might cause directories to be created, which would be especially bad
+    # if $src (and thus $dsttmp) contains '*'.
+    if test ! -f "$src" && test ! -d "$src"; then
+      echo "$0: $src does not exist." >&2
+      exit 1
+    fi
+
+    if test -z "$dstarg"; then
+      echo "$0: no destination specified." >&2
+      exit 1
+    fi
+
+    dst=$dstarg
+    # Protect names starting with `-'.
+    case $dst in
+      -*) dst=./$dst ;;
+    esac
 
-	pathcomp="${pathcomp}/"
+    # If destination is a directory, append the input filename; won't work
+    # if double slashes aren't ignored.
+    if test -d "$dst"; then
+      dst=$dst/`basename "$src"`
+    fi
+  fi
+
+  # This sed command emulates the dirname command.
+  dstdir=`echo "$dst" | sed -e 's,[^/]*$,,;s,/$,,;s,^$,.,'`
+
+  # Make sure that the destination directory exists.
+
+  # Skip lots of stat calls in the usual case.
+  if test ! -d "$dstdir"; then
+    defaultIFS='
+	 '
+    IFS="${IFS-$defaultIFS}"
+
+    oIFS=$IFS
+    # Some sh's can't handle IFS=/ for some reason.
+    IFS='%'
+    set - `echo "$dstdir" | sed -e 's@/@%@g' -e 's@^%@/@'`
+    IFS=$oIFS
+
+    pathcomp=
+
+    while test $# -ne 0 ; do
+      pathcomp=$pathcomp$1
+      shift
+      if test ! -d "$pathcomp"; then
+        $mkdirprog "$pathcomp" || lasterr=$?
+	# mkdir can fail with a `File exist' error in case several
+	# install-sh are creating the directory concurrently.  This
+	# is OK.
+	test ! -d "$pathcomp" && { (exit ${lasterr-1}); exit; }
+      fi
+      pathcomp=$pathcomp/
+    done
+  fi
+
+  if test -n "$dir_arg"; then
+    $doit $instcmd "$dst" \
+      && { test -z "$chowncmd" || $doit $chowncmd "$dst"; } \
+      && { test -z "$chgrpcmd" || $doit $chgrpcmd "$dst"; } \
+      && { test -z "$stripcmd" || $doit $stripcmd "$dst"; } \
+      && { test -z "$chmodcmd" || $doit $chmodcmd "$dst"; }
+
+  else
+    # If we're going to rename the final executable, determine the name now.
+    if test -z "$transformarg"; then
+      dstfile=`basename "$dst"`
+    else
+      dstfile=`basename "$dst" $transformbasename \
+               | sed $transformarg`$transformbasename
+    fi
+
+    # don't allow the sed command to completely eliminate the filename.
+    test -z "$dstfile" && dstfile=`basename "$dst"`
+
+    # Make a couple of temp file names in the proper directory.
+    dsttmp=$dstdir/_inst.$$_
+    rmtmp=$dstdir/_rm.$$_
+
+    # Trap to clean up those temp files at exit.
+    trap 'status=$?; rm -f "$dsttmp" "$rmtmp" && exit $status' 0
+    trap '(exit $?); exit' 1 2 13 15
+
+    # Move or copy the file name to the temp name
+    $doit $instcmd "$src" "$dsttmp" &&
+
+    # and set any options; do chmod last to preserve setuid bits.
+    #
+    # If any of these fail, we abort the whole thing.  If we want to
+    # ignore errors from any of these, just make sure not to ignore
+    # errors from the above "$doit $instcmd $src $dsttmp" command.
+    #
+    { test -z "$chowncmd" || $doit $chowncmd "$dsttmp"; } \
+      && { test -z "$chgrpcmd" || $doit $chgrpcmd "$dsttmp"; } \
+      && { test -z "$stripcmd" || $doit $stripcmd "$dsttmp"; } \
+      && { test -z "$chmodcmd" || $doit $chmodcmd "$dsttmp"; } &&
+
+    # Now remove or move aside any old file at destination location.  We
+    # try this two ways since rm can't unlink itself on some systems and
+    # the destination file might be busy for other reasons.  In this case,
+    # the final cleanup might fail but the new file should still install
+    # successfully.
+    {
+      if test -f "$dstdir/$dstfile"; then
+        $doit $rmcmd -f "$dstdir/$dstfile" 2>/dev/null \
+        || $doit $mvcmd -f "$dstdir/$dstfile" "$rmtmp" 2>/dev/null \
+        || {
+	  echo "$0: cannot unlink or rename $dstdir/$dstfile" >&2
+	  (exit 1); exit
+        }
+      else
+        :
+      fi
+    } &&
+
+    # Now rename the file to the real destination.
+    $doit $mvcmd "$dsttmp" "$dstdir/$dstfile"
+  fi || { (exit 1); exit; }
 done
-fi
-
-if [ x"$dir_arg" != x ]
-then
-	$doit $instcmd $dst &&
-
-	if [ x"$chowncmd" != x ]; then $doit $chowncmd $dst; else true ; fi &&
-	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd $dst; else true ; fi &&
-	if [ x"$stripcmd" != x ]; then $doit $stripcmd $dst; else true ; fi &&
-	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd $dst; else true ; fi
-else
-
-# If we're going to rename the final executable, determine the name now.
-
-	if [ x"$transformarg" = x ] 
-	then
-		dstfile=`basename $dst`
-	else
-		dstfile=`basename $dst $transformbasename | 
-			sed $transformarg`$transformbasename
-	fi
-
-# don't allow the sed command to completely eliminate the filename
-
-	if [ x"$dstfile" = x ] 
-	then
-		dstfile=`basename $dst`
-	else
-		true
-	fi
-
-# Make a temp file name in the proper directory.
-
-	dsttmp=$dstdir/#inst.$$#
-
-# Move or copy the file name to the temp name
-
-	$doit $instcmd $src $dsttmp &&
-
-	trap "rm -f ${dsttmp}" 0 &&
-
-# and set any options; do chmod last to preserve setuid bits
-
-# If any of these fail, we abort the whole thing.  If we want to
-# ignore errors from any of these, just make sure not to ignore
-# errors from the above "$doit $instcmd $src $dsttmp" command.
-
-	if [ x"$chowncmd" != x ]; then $doit $chowncmd $dsttmp; else true;fi &&
-	if [ x"$chgrpcmd" != x ]; then $doit $chgrpcmd $dsttmp; else true;fi &&
-	if [ x"$stripcmd" != x ]; then $doit $stripcmd $dsttmp; else true;fi &&
-	if [ x"$chmodcmd" != x ]; then $doit $chmodcmd $dsttmp; else true;fi &&
-
-# Now rename the file to the real destination.
-
-	$doit $rmcmd -f $dstdir/$dstfile &&
-	$doit $mvcmd $dsttmp $dstdir/$dstfile 
-
-fi &&
-
 
-exit 0
+# The final little trick to "correctly" pass the exit status to the exit trap.
+{
+  (exit 0); exit
+}
+
+# Local variables:
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "scriptversion="
+# time-stamp-format: "%:y-%02m-%02d.%02H"
+# time-stamp-end: "$"
+# End:
Index: build_tree/bootLoader/tools/missing
diff -u build_tree/bootLoader/tools/missing:1.1.1.1 build_tree/bootLoader/tools/missing:1.1.1.2
--- build_tree/bootLoader/tools/missing:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/tools/missing	Fri Nov  9 10:37:08 2007
@@ -1,7 +1,11 @@
 #! /bin/sh
 # Common stub for a few missing GNU programs while installing.
-# Copyright (C) 1996, 1997 Free Software Foundation, Inc.
-# Franc,ois Pinard <pinard@iro.umontreal.ca>, 1996.
+
+scriptversion=2003-09-02.23
+
+# Copyright (C) 1996, 1997, 1999, 2000, 2002, 2003 
+#   Free Software Foundation, Inc.
+# Originally by Fran,cois Pinard <pinard@iro.umontreal.ca>, 1996.
 
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License as published by
@@ -18,11 +22,48 @@
 # Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA
 # 02111-1307, USA.
 
+# As a special exception to the GNU General Public License, if you
+# distribute this file as part of a program that contains a
+# configuration script generated by Autoconf, you may include it under
+# the same distribution terms that you use for the rest of that program.
+
 if test $# -eq 0; then
   echo 1>&2 "Try \`$0 --help' for more information"
   exit 1
 fi
 
+run=:
+
+# In the cases where this matters, `missing' is being run in the
+# srcdir already.
+if test -f configure.ac; then
+  configure_ac=configure.ac
+else
+  configure_ac=configure.in
+fi
+
+msg="missing on your system"
+
+case "$1" in
+--run)
+  # Try to run requested program, and just exit if it succeeds.
+  run=
+  shift
+  "$@" && exit 0
+  # Exit code 63 means version mismatch.  This often happens
+  # when the user try to use an ancient version of a tool on
+  # a file that requires a minimum version.  In this case we
+  # we should proceed has if the program had been absent, or
+  # if --run hadn't been passed.
+  if test $? = 63; then
+    run=:
+    msg="probably too old"
+  fi
+  ;;
+esac
+
+# If it does not exist, or fails to run (possibly an outdated version),
+# try to emulate it.
 case "$1" in
 
   -h|--h|--he|--hel|--help)
@@ -35,6 +76,7 @@
 Options:
   -h, --help      display this help and exit
   -v, --version   output version information and exit
+  --run           try to run the given command, and emulate it if it fails
 
 Supported PROGRAM values:
   aclocal      touch file \`aclocal.m4'
@@ -43,13 +85,17 @@
   automake     touch all \`Makefile.in' files
   bison        create \`y.tab.[ch]', if possible, from existing .[ch]
   flex         create \`lex.yy.c', if possible, from existing .c
+  help2man     touch the output file
   lex          create \`lex.yy.c', if possible, from existing .c
   makeinfo     touch the output file
-  yacc         create \`y.tab.[ch]', if possible, from existing .[ch]"
+  tar          try tar, gnutar, gtar, then tar without non-portable flags
+  yacc         create \`y.tab.[ch]', if possible, from existing .[ch]
+
+Send bug reports to <bug-automake@gnu.org>."
     ;;
 
   -v|--v|--ve|--ver|--vers|--versi|--versio|--version)
-    echo "missing - GNU libit 0.0"
+    echo "missing $scriptversion (GNU Automake)"
     ;;
 
   -*)
@@ -58,31 +104,46 @@
     exit 1
     ;;
 
-  aclocal)
+  aclocal*)
+    if test -z "$run" && ($1 --version) > /dev/null 2>&1; then
+       # We have it, but it failed.
+       exit 1
+    fi
+
     echo 1>&2 "\
-WARNING: \`$1' is missing on your system.  You should only need it if
-         you modified \`acinclude.m4' or \`configure.in'.  You might want
+WARNING: \`$1' is $msg.  You should only need it if
+         you modified \`acinclude.m4' or \`${configure_ac}'.  You might want
          to install the \`Automake' and \`Perl' packages.  Grab them from
          any GNU archive site."
     touch aclocal.m4
     ;;
 
   autoconf)
+    if test -z "$run" && ($1 --version) > /dev/null 2>&1; then
+       # We have it, but it failed.
+       exit 1
+    fi
+
     echo 1>&2 "\
-WARNING: \`$1' is missing on your system.  You should only need it if
-         you modified \`configure.in'.  You might want to install the
+WARNING: \`$1' is $msg.  You should only need it if
+         you modified \`${configure_ac}'.  You might want to install the
          \`Autoconf' and \`GNU m4' packages.  Grab them from any GNU
          archive site."
     touch configure
     ;;
 
   autoheader)
+    if test -z "$run" && ($1 --version) > /dev/null 2>&1; then
+       # We have it, but it failed.
+       exit 1
+    fi
+
     echo 1>&2 "\
-WARNING: \`$1' is missing on your system.  You should only need it if
-         you modified \`acconfig.h' or \`configure.in'.  You might want
+WARNING: \`$1' is $msg.  You should only need it if
+         you modified \`acconfig.h' or \`${configure_ac}'.  You might want
          to install the \`Autoconf' and \`GNU m4' packages.  Grab them
          from any GNU archive site."
-    files=`sed -n 's/^[ ]*A[CM]_CONFIG_HEADER(\([^)]*\)).*/\1/p' configure.in`
+    files=`sed -n 's/^[ ]*A[CM]_CONFIG_HEADER(\([^)]*\)).*/\1/p' ${configure_ac}`
     test -z "$files" && files="config.h"
     touch_files=
     for f in $files; do
@@ -95,10 +156,15 @@
     touch $touch_files
     ;;
 
-  automake)
+  automake*)
+    if test -z "$run" && ($1 --version) > /dev/null 2>&1; then
+       # We have it, but it failed.
+       exit 1
+    fi
+
     echo 1>&2 "\
-WARNING: \`$1' is missing on your system.  You should only need it if
-         you modified \`Makefile.am', \`acinclude.m4' or \`configure.in'.
+WARNING: \`$1' is $msg.  You should only need it if
+         you modified \`Makefile.am', \`acinclude.m4' or \`${configure_ac}'.
          You might want to install the \`Automake' and \`Perl' packages.
          Grab them from any GNU archive site."
     find . -type f -name Makefile.am -print |
@@ -106,9 +172,37 @@
 	   while read f; do touch "$f"; done
     ;;
 
+  autom4te)
+    if test -z "$run" && ($1 --version) > /dev/null 2>&1; then
+       # We have it, but it failed.
+       exit 1
+    fi
+
+    echo 1>&2 "\
+WARNING: \`$1' is needed, but is $msg.
+         You might have modified some files without having the
+         proper tools for further handling them.
+         You can get \`$1' as part of \`Autoconf' from any GNU
+         archive site."
+
+    file=`echo "$*" | sed -n 's/.*--output[ =]*\([^ ]*\).*/\1/p'`
+    test -z "$file" && file=`echo "$*" | sed -n 's/.*-o[ ]*\([^ ]*\).*/\1/p'`
+    if test -f "$file"; then
+	touch $file
+    else
+	test -z "$file" || exec >$file
+	echo "#! /bin/sh"
+	echo "# Created by GNU Automake missing as a replacement of"
+	echo "#  $ $@"
+	echo "exit 0"
+	chmod +x $file
+	exit 1
+    fi
+    ;;
+
   bison|yacc)
     echo 1>&2 "\
-WARNING: \`$1' is missing on your system.  You should only need it if
+WARNING: \`$1' $msg.  You should only need it if
          you modified a \`.y' file.  You may need the \`Bison' package
          in order for those modifications to take effect.  You can get
          \`Bison' from any GNU archive site."
@@ -138,7 +232,7 @@
 
   lex|flex)
     echo 1>&2 "\
-WARNING: \`$1' is missing on your system.  You should only need it if
+WARNING: \`$1' is $msg.  You should only need it if
          you modified a \`.l' file.  You may need the \`Flex' package
          in order for those modifications to take effect.  You can get
          \`Flex' from any GNU archive site."
@@ -159,9 +253,39 @@
     fi
     ;;
 
+  help2man)
+    if test -z "$run" && ($1 --version) > /dev/null 2>&1; then
+       # We have it, but it failed.
+       exit 1
+    fi
+
+    echo 1>&2 "\
+WARNING: \`$1' is $msg.  You should only need it if
+	 you modified a dependency of a manual page.  You may need the
+	 \`Help2man' package in order for those modifications to take
+	 effect.  You can get \`Help2man' from any GNU archive site."
+
+    file=`echo "$*" | sed -n 's/.*-o \([^ ]*\).*/\1/p'`
+    if test -z "$file"; then
+	file=`echo "$*" | sed -n 's/.*--output=\([^ ]*\).*/\1/p'`
+    fi
+    if [ -f "$file" ]; then
+	touch $file
+    else
+	test -z "$file" || exec >$file
+	echo ".ab help2man is required to generate this page"
+	exit 1
+    fi
+    ;;
+
   makeinfo)
+    if test -z "$run" && (makeinfo --version) > /dev/null 2>&1; then
+       # We have makeinfo, but it failed.
+       exit 1
+    fi
+
     echo 1>&2 "\
-WARNING: \`$1' is missing on your system.  You should only need it if
+WARNING: \`$1' is $msg.  You should only need it if
          you modified a \`.texi' or \`.texinfo' file, or any other file
          indirectly affecting the aspect of the manual.  The spurious
          call might also be the consequence of using a buggy \`make' (AIX,
@@ -175,12 +299,51 @@
     touch $file
     ;;
 
+  tar)
+    shift
+    if test -n "$run"; then
+      echo 1>&2 "ERROR: \`tar' requires --run"
+      exit 1
+    fi
+
+    # We have already tried tar in the generic part.
+    # Look for gnutar/gtar before invocation to avoid ugly error
+    # messages.
+    if (gnutar --version > /dev/null 2>&1); then
+       gnutar "$@" && exit 0
+    fi
+    if (gtar --version > /dev/null 2>&1); then
+       gtar "$@" && exit 0
+    fi
+    firstarg="$1"
+    if shift; then
+	case "$firstarg" in
+	*o*)
+	    firstarg=`echo "$firstarg" | sed s/o//`
+	    tar "$firstarg" "$@" && exit 0
+	    ;;
+	esac
+	case "$firstarg" in
+	*h*)
+	    firstarg=`echo "$firstarg" | sed s/h//`
+	    tar "$firstarg" "$@" && exit 0
+	    ;;
+	esac
+    fi
+
+    echo 1>&2 "\
+WARNING: I can't seem to be able to run \`tar' with the given arguments.
+         You may want to install GNU tar or Free paxutils, or check the
+         command line arguments."
+    exit 1
+    ;;
+
   *)
     echo 1>&2 "\
-WARNING: \`$1' is needed, and you do not seem to have it handy on your
-         system.  You might have modified some files without having the
+WARNING: \`$1' is needed, and is $msg.
+         You might have modified some files without having the
          proper tools for further handling them.  Check the \`README' file,
-         it often tells you about the needed prerequirements for installing
+         it often tells you about the needed prerequisites for installing
          this package.  You may also peek at any GNU archive site, in case
          some other package would contain this missing \`$1' program."
     exit 1
@@ -188,3 +351,10 @@
 esac
 
 exit 0
+
+# Local variables:
+# eval: (add-hook 'write-file-hooks 'time-stamp)
+# time-stamp-start: "scriptversion="
+# time-stamp-format: "%:y-%02m-%02d.%02H"
+# time-stamp-end: "$"
+# End:
Index: build_tree/bootLoader/tools/mkinstalldirs
diff -u build_tree/bootLoader/tools/mkinstalldirs:1.1.1.1 build_tree/bootLoader/tools/mkinstalldirs:removed
--- build_tree/bootLoader/tools/mkinstalldirs:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/tools/mkinstalldirs	Tue Jan  8 14:21:47 2008
@@ -1,40 +0,0 @@
-#! /bin/sh
-# mkinstalldirs --- make directory hierarchy
-# Author: Noah Friedman <friedman@prep.ai.mit.edu>
-# Created: 1993-05-16
-# Public domain
-
-# $Id: mkinstalldirs,v 1.13 1999/01/05 03:18:55 bje Exp $
-
-errstatus=0
-
-for file
-do
-   set fnord `echo ":$file" | sed -ne 's/^:\//#/;s/^://;s/\// /g;s/^#/\//;p'`
-   shift
-
-   pathcomp=
-   for d
-   do
-     pathcomp="$pathcomp$d"
-     case "$pathcomp" in
-       -* ) pathcomp=./$pathcomp ;;
-     esac
-
-     if test ! -d "$pathcomp"; then
-        echo "mkdir $pathcomp"
-
-        mkdir "$pathcomp" || lasterr=$?
-
-        if test ! -d "$pathcomp"; then
-  	  errstatus=$lasterr
-        fi
-     fi
-
-     pathcomp="$pathcomp/"
-   done
-done
-
-exit $errstatus
-
-# mkinstalldirs ends here
Index: build_tree/bootLoader/utils/.cvsignore
diff -u /dev/null build_tree/bootLoader/utils/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile.in
+Makefile
Index: build_tree/bootLoader/utils/Makefile.am
diff -u build_tree/bootLoader/utils/Makefile.am:1.1.1.1 build_tree/bootLoader/utils/Makefile.am:1.1.1.3
--- build_tree/bootLoader/utils/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/Makefile.am	Fri Nov  9 10:37:08 2007
@@ -1,14 +1,16 @@
 # Process this file with automake to produce Makefile.in -*- makefile -*-
 #
-# $Id: Makefile.am,v 1.3 2001/08/31 06:21:52 russd Exp $
+# $Id: Makefile.am,v 1.7 2002/05/25 17:09:57 erikm Exp $
 # 
 
 SUBDIRS		= \
 	build \
 	mkparamblock
 
+
 CLEANFILES	= *~
 
-EXTRA_DIST	= \
-	README
 
+EXTRA_DIST	= \
+	README \
+	upload.sh
Index: build_tree/bootLoader/utils/Makefile.in
diff -u build_tree/bootLoader/utils/Makefile.in:1.1.1.1 build_tree/bootLoader/utils/Makefile.in:1.2
--- build_tree/bootLoader/utils/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,105 +12,212 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # Process this file with automake to produce Makefile.in -*- makefile -*-
 #
-# $Id: Makefile.am,v 1.3 2001/08/31 06:21:52 russd Exp $
+# $Id: Makefile.am,v 1.7 2002/05/25 17:09:57 erikm Exp $
 # 
-
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = utils
+DIST_COMMON = README $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+RECURSIVE_TARGETS = all-recursive check-recursive dvi-recursive \
+	html-recursive info-recursive install-data-recursive \
+	install-exec-recursive install-info-recursive \
+	install-recursive installcheck-recursive installdirs-recursive \
+	pdf-recursive ps-recursive uninstall-info-recursive \
+	uninstall-recursive
+ETAGS = etags
+CTAGS = ctags
+DIST_SUBDIRS = $(SUBDIRS)
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
-SUBDIRS =  	build 	mkparamblock
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+SUBDIRS = \
+	build \
+	mkparamblock \
 
 CLEANFILES = *~
+EXTRA_DIST = \
+	README \
+	upload.sh
 
-EXTRA_DIST =  	README
+all: all-recursive
 
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-DIST_COMMON =  README Makefile.am Makefile.in
-
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps utils/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  utils/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  utils/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
 
 # This directory's subdirectories are mostly independent; you can cd
 # into them and run `make' without going through this Makefile.
@@ -116,13 +225,8 @@
 # (1) if the variable is set in `config.status', edit `config.status'
 #     (which will cause the Makefiles to be regenerated when you run `make');
 # (2) otherwise, pass the desired values on the `make' command line.
-
-@SET_MAKE@
-
-all-recursive install-data-recursive install-exec-recursive \
-installdirs-recursive install-recursive uninstall-recursive  \
-check-recursive installcheck-recursive info-recursive dvi-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+$(RECURSIVE_TARGETS):
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
 	target=`echo $@ | sed s/-recursive//`; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
@@ -142,13 +246,18 @@
 
 mostlyclean-recursive clean-recursive distclean-recursive \
 maintainer-clean-recursive:
-	@set fnord $(MAKEFLAGS); amf=$$2; \
+	@set fnord $$MAKEFLAGS; amf=$$2; \
 	dot_seen=no; \
-	rev=''; list='$(SUBDIRS)'; for subdir in $$list; do \
-	  rev="$$subdir $$rev"; \
-	  test "$$subdir" = "." && dot_seen=yes; \
+	case "$@" in \
+	  distclean-* | maintainer-clean-*) list='$(DIST_SUBDIRS)' ;; \
+	  *) list='$(SUBDIRS)' ;; \
+	esac; \
+	rev=''; for subdir in $$list; do \
+	  if test "$$subdir" = "."; then :; else \
+	    rev="$$subdir $$rev"; \
+	  fi; \
 	done; \
-	test "$$dot_seen" = "no" && rev=". $$rev"; \
+	rev="$$rev ."; \
 	target=`echo $@ | sed s/-recursive//`; \
 	for subdir in $$rev; do \
 	  echo "Making $$target in $$subdir"; \
@@ -164,135 +273,197 @@
 	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) tags); \
 	done
+ctags-recursive:
+	list='$(SUBDIRS)'; for subdir in $$list; do \
+	  test "$$subdir" = . || (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) ctags); \
+	done
 
-tags: TAGS
-
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
+	mkid -fID $$unique
+tags: TAGS
 
-TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+TAGS: tags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
+	if (etags --etags-include --version) >/dev/null 2>&1; then \
+	  include_option=--etags-include; \
+	else \
+	  include_option=--include; \
+	fi; \
 	list='$(SUBDIRS)'; for subdir in $$list; do \
-   if test "$$subdir" = .; then :; else \
-	    test -f $$subdir/TAGS && tags="$$tags -i $$here/$$subdir/TAGS"; \
-   fi; \
+	  if test "$$subdir" = .; then :; else \
+	    test -f $$subdir/TAGS && \
+	      tags="$$tags $$include_option=$$here/$$subdir/TAGS"; \
+	  fi; \
 	done; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS: ctags-recursive $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = utils
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-	for subdir in $(SUBDIRS); do \
+	list='$(SUBDIRS)'; for subdir in $$list; do \
 	  if test "$$subdir" = .; then :; else \
-	    test -d $(distdir)/$$subdir \
-	    || mkdir $(distdir)/$$subdir \
+	    test -d "$(distdir)/$$subdir" \
+	    || mkdir "$(distdir)/$$subdir" \
 	    || exit 1; \
-	    chmod 777 $(distdir)/$$subdir; \
-	    (cd $$subdir && $(MAKE) $(AM_MAKEFLAGS) top_distdir=../$(top_distdir) distdir=../$(distdir)/$$subdir distdir) \
+	    (cd $$subdir && \
+	      $(MAKE) $(AM_MAKEFLAGS) \
+	        top_distdir="../$(top_distdir)" \
+	        distdir="../$(distdir)/$$subdir" \
+	        distdir) \
 	      || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-recursive
-dvi-am:
-dvi: dvi-recursive
 check-am: all-am
 check: check-recursive
-installcheck-am:
-installcheck: installcheck-recursive
-install-exec-am:
+all-am: Makefile
+installdirs: installdirs-recursive
+installdirs-am:
+install: install-recursive
 install-exec: install-exec-recursive
-
-install-data-am:
 install-data: install-data-recursive
+uninstall: uninstall-recursive
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-recursive
-uninstall-am:
-uninstall: uninstall-recursive
-all-am: Makefile
-all-redirect: all-recursive
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs: installdirs-recursive
-installdirs-am:
-
 
+installcheck: installcheck-recursive
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-recursive
 
-mostlyclean: mostlyclean-recursive
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-tags clean-generic mostlyclean-am
+distclean: distclean-recursive
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic distclean-tags
 
-clean: clean-recursive
+dvi: dvi-recursive
+
+dvi-am:
 
-distclean-am:  distclean-tags distclean-generic clean-am
+html: html-recursive
 
-distclean: distclean-recursive
+info: info-recursive
 
-maintainer-clean-am:  maintainer-clean-tags maintainer-clean-generic \
-		distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-recursive
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-recursive
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-recursive
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-recursive
+
+pdf-am:
+
+ps: ps-recursive
+
+ps-am:
+
+uninstall-am: uninstall-info-am
 
-.PHONY: install-data-recursive uninstall-data-recursive \
-install-exec-recursive uninstall-exec-recursive installdirs-recursive \
-uninstalldirs-recursive all-recursive check-recursive \
-installcheck-recursive info-recursive dvi-recursive \
-mostlyclean-recursive distclean-recursive clean-recursive \
-maintainer-clean-recursive tags tags-recursive mostlyclean-tags \
-distclean-tags clean-tags maintainer-clean-tags distdir info-am info \
-dvi-am dvi check check-am installcheck-am installcheck install-exec-am \
-install-exec install-data-am install-data install-am install \
-uninstall-am uninstall all-redirect all-am all installdirs-am \
-installdirs mostlyclean-generic distclean-generic clean-generic \
-maintainer-clean-generic clean mostlyclean distclean maintainer-clean
+uninstall-info: uninstall-info-recursive
 
+.PHONY: $(RECURSIVE_TARGETS) CTAGS GTAGS all all-am check check-am \
+	clean clean-generic clean-recursive ctags ctags-recursive \
+	distclean distclean-generic distclean-recursive distclean-tags \
+	distdir dvi dvi-am html html-am info info-am install \
+	install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	installdirs-am maintainer-clean maintainer-clean-generic \
+	maintainer-clean-recursive mostlyclean mostlyclean-generic \
+	mostlyclean-recursive pdf pdf-am ps ps-am tags tags-recursive \
+	uninstall uninstall-am uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/utils/dontdiff
diff -u /dev/null build_tree/bootLoader/utils/dontdiff:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/dontdiff	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,34 @@
+*~
+*.a
+*.o
+*.rej
+configure
+Makefile
+INSTALL
+Makefile.in
+config.cache
+aclocal.m4
+config.log
+config.status
+frodo-cfg.sh
+CVS
+config.h
+stamp-h
+stamp-h.in
+.deps
+*.map
+rest-ld-script
+config.guess
+config.sub
+install-sh
+missing
+mkinstalldirs
+mkparamblock
+blob-start-elf32
+blob-start-chain-elf32
+blob-start-chain
+blob-start
+blob-rest-elf32
+blob-rest
+blob-chain
+diag-elf32
Index: build_tree/bootLoader/utils/upload.sh
diff -u /dev/null build_tree/bootLoader/utils/upload.sh:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/upload.sh	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,81 @@
+#!/bin/sh
+
+# Written by Abraham van der Merwe
+# Last updated: 2002/02/04
+#
+# This script is based on a script I got from someone
+# (Wookey?) a couple of months ago. I just can't remember
+# who it is :P
+#
+# The script does the tedious job of setting serial port
+# speeds and uploading files. The sleeps allow blob to keep
+# up without screen corruption on serial speed changes.
+#
+# Todo:
+#
+#   1. Make flashing optional
+#   2. Add optional "boot" parameter
+
+# usage: set_9600 <device>
+function set_9600()
+{
+	sleep 1
+	stty 1:0:cbd:0:3:1c:7f:15:4:5:1:0:11:13:1a:0:12:f:17:16:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0 < $1
+	sleep 1
+}
+
+# usage: set_115200 <device>
+function set_115200()
+{
+	sleep 1
+	stty 1:0:1cb2:0:3:1c:7f:15:4:5:1:0:11:13:1a:0:12:f:17:16:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0:0 < $1
+	sleep 1
+}
+
+# usage: upload <name> <filename> <device>
+function upload()
+{
+	local uu
+	uu=$(tempfile -p upload)
+	cat $2 | uuencode $2 > $uu
+	echo "Starting $1 upload"
+	set_9600 $3
+	echo "download $1" > $3
+	set_115200 $3
+	dd if=$uu > $3
+	rm -f $uu
+	set_9600 $3
+	echo "flash $1" > $3
+	set_9600 $3
+}
+
+# usage: help
+function help()
+{
+	echo "usage: ${0/*\//} [-d DEVICE] [-k KERNEL] [-r RAMDISK] [-b BLOB] [-p PARAM]"
+	echo
+	echo "   By default, /dev/ttyS0 is used"
+	echo
+	exit 1
+}
+
+dev=/dev/ttyS0
+i=$#
+
+[[ $i -lt 2 || $1 -eq "--help" ]] && help
+
+while [[ $i -ne 0 ]]
+do
+	[[ $# -lt 2 ]] && help
+	case $1 in
+		"-d") dev=$2 ;;
+		"-k") upload kernel $2 $dev ;;
+		"-r") upload ramdisk $2 $dev ;;
+		"-b") upload blob $2 $dev ;;
+		"-p") upload param $2 $dev ;;
+		   *) help ;;
+	esac
+	shift 2
+	i=$(($i-2))
+done
+
Index: build_tree/bootLoader/utils/build/.cvsignore
diff -u /dev/null build_tree/bootLoader/utils/build/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/build/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,2 @@
+Makefile.in
+Makefile
Index: build_tree/bootLoader/utils/build/Makefile.in
diff -u build_tree/bootLoader/utils/build/Makefile.in:1.1.1.1 build_tree/bootLoader/utils/build/Makefile.in:1.2
--- build_tree/bootLoader/utils/build/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/build/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,182 +12,317 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # Process this file with automake to produce Makefile.in -*- makefile -*-
 #
 # $Id: Makefile.am,v 1.2 2001/08/29 21:08:51 erikm Exp $
 # 
-
-
-SHELL = @SHELL@
-
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ../..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+subdir = utils/build
+DIST_COMMON = README $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+SOURCES =
+DIST_SOURCES =
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
 CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
-
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
 CLEANFILES = *~
+EXTRA_DIST = \
+	README \
+	build_Makefile \
+	build_all
 
-EXTRA_DIST =  	README 	build_Makefile 	build_all
-
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-DIST_COMMON =  README Makefile.am Makefile.in
+all: all-am
 
-
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-all: all-redirect
 .SUFFIXES:
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps utils/build/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  utils/build/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  utils/build/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+uninstall-info-am:
 tags: TAGS
 TAGS:
 
+ctags: CTAGS
+CTAGS:
 
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = utils/build
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
 check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am:
+all-am: Makefile
+installdirs:
+install: install-am
 install-exec: install-exec-am
-
-install-data-am:
 install-data: install-data-am
+uninstall: uninstall-am
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am:
-uninstall: uninstall-am
-all-am: Makefile
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-
 
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
 	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
 
-mostlyclean: mostlyclean-am
+clean-am: clean-generic mostlyclean-am
 
-clean-am:  clean-generic mostlyclean-am
+distclean: distclean-am
+	-rm -f Makefile
+distclean-am: clean-am distclean-generic
 
-clean: clean-am
+dvi: dvi-am
 
-distclean-am:  distclean-generic clean-am
+dvi-am:
 
-distclean: distclean-am
+html: html-am
 
-maintainer-clean-am:  maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am:
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
 
-.PHONY: tags distdir info-am info dvi-am dvi check check-am \
-installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+uninstall-am: uninstall-info-am
 
+.PHONY: all all-am check check-am clean clean-generic distclean \
+	distclean-generic distdir dvi dvi-am html html-am info info-am \
+	install install-am install-data install-data-am install-exec \
+	install-exec-am install-info install-info-am install-man \
+	install-strip installcheck installcheck-am installdirs \
+	maintainer-clean maintainer-clean-generic mostlyclean \
+	mostlyclean-generic pdf pdf-am ps ps-am uninstall uninstall-am \
+	uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/utils/build/build_Makefile
diff -u build_tree/bootLoader/utils/build/build_Makefile:1.1.1.1 build_tree/bootLoader/utils/build/build_Makefile:1.1.1.2
--- build_tree/bootLoader/utils/build/build_Makefile:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/build/build_Makefile	Fri Nov  9 09:44:05 2007
@@ -5,7 +5,7 @@
 #
 # Copyright (C) 2001, Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 #
-# $Id: build_Makefile,v 1.8 2002/01/07 13:30:48 erikm Exp $
+# $Id: build_Makefile,v 1.16 2003/08/06 22:55:41 abz Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License version 2 as
@@ -13,9 +13,9 @@
 #
 
 archs		= \
-	assabet badge4 brutus creditlart h3600 idr\
-	jornada720 lart neponset nesa pleb shannon\
-	system3
+	accelent_sa assabet neponset badge4 brutus cep creditlart frodo \
+	hackkit h3600 idr jornada720 lart lubbock miniprint nesa pleb \
+	pxa_idp csir_ims shannon system3 trizeps
 debug-archs	= $(foreach a, $(archs), $(a)-debug)
 all-archs	= $(archs) $(debug-archs)
 
Index: build_tree/bootLoader/utils/build/build_all
diff -u build_tree/bootLoader/utils/build/build_all:1.1.1.1 build_tree/bootLoader/utils/build/build_all:1.1.1.2
--- build_tree/bootLoader/utils/build/build_all:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/build/build_all	Fri Nov  9 09:44:05 2007
@@ -5,17 +5,17 @@
 #
 # Copyright (C) 2001, Erik Mouw <J.A.K.Mouw@its.tudelft.nl>
 #
-# $Id: build_all,v 1.8 2002/01/07 13:30:48 erikm Exp $
+# $Id: build_all,v 1.17 2003/08/15 06:55:34 holgerschurig Exp $
 #
 # This program is free software; you can redistribute it and/or modify
 # it under the terms of the GNU General Public License version 2 as
 # published by the Free Software Foundation.
 #
 
-archs="assabet badge4 brutus creditlart h3600 idr jornada720 lart neponset nesa pleb shannon system3"
+archs="accelent_sa assabet neponset badge4 brutus cep creditlart frodo hackkit h3600 idr jornada720 lart lubbock miniprint nesa pleb pxa_idp csir_ims ramses shannon system3 trizeps"
 linux_prefix=~/LART/build/linux/elinux
 blob_src=~/src/sourceforge/blob
-extra_flags="--enable-all-features"
+extra_flags="--enable-all-features --with-commands=all"
 
 
 export CC=arm-linux-gcc
Index: build_tree/bootLoader/utils/mkparamblock/.cvsignore
diff -u /dev/null build_tree/bootLoader/utils/mkparamblock/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/mkparamblock/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,4 @@
+Makefile.in
+Makefile
+mkparamblock
+.deps
Index: build_tree/bootLoader/utils/mkparamblock/Makefile.am
diff -u build_tree/bootLoader/utils/mkparamblock/Makefile.am:1.1.1.1 build_tree/bootLoader/utils/mkparamblock/Makefile.am:1.1.1.2
--- build_tree/bootLoader/utils/mkparamblock/Makefile.am:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/mkparamblock/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -1,15 +1,27 @@
 # -*- makefile -*-
 #
-# $Id: Makefile.am,v 1.2 2001/09/18 19:45:29 erikm Exp $
+# $Id: Makefile.am,v 1.6 2003/09/01 20:13:10 russd Exp $
 #
 
+DEFAULT_INCLUDES =
+CC = gcc
+
+
 bin_PROGRAMS	= \
 	mkparamblock
 
+
 mkparamblock_SOURCES	= \
 	mkparamblock.c
 
-mkparamblock: mkparamblock.c
-	gcc -Wall -O2 -I${top_builddir}/include -I${top_srcdir}/include -o $@ $<
+mkparamblock_CFLAGS = -g -O2 -Wall \
+	-DHAVE_CONFIG_H -DUSER_SPACE_TEST -DUSE_BLOB_TOGETHER_WITH_LIBC \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include \
+	-I@LINUX_INCLUDE@
+
+mkparamblock_LDFLAGS = 
+
+
 
-CLEANFILE	= mkparamblock *~
+CLEANFILES	= ${srcdir}/*~
Index: build_tree/bootLoader/utils/mkparamblock/Makefile.in
diff -u build_tree/bootLoader/utils/mkparamblock/Makefile.in:1.1.1.1 build_tree/bootLoader/utils/mkparamblock/Makefile.in:1.2
--- build_tree/bootLoader/utils/mkparamblock/Makefile.in:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/mkparamblock/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -1,6 +1,8 @@
-# Makefile.in generated automatically by automake 1.4-p4 from Makefile.am
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
 
-# Copyright (C) 1994, 1995-8, 1999 Free Software Foundation, Inc.
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
 # This Makefile.in is free software; the Free Software Foundation
 # gives unlimited permission to copy and/or distribute it,
 # with or without modifications, as long as this notice is preserved.
@@ -10,287 +12,457 @@
 # even the implied warranty of MERCHANTABILITY or FITNESS FOR A
 # PARTICULAR PURPOSE.
 
+@SET_MAKE@
+
 # -*- makefile -*-
 #
-# $Id: Makefile.am,v 1.2 2001/09/18 19:45:29 erikm Exp $
+# $Id: Makefile.am,v 1.6 2003/09/01 20:13:10 russd Exp $
 #
 
-
-SHELL = @SHELL@
+SOURCES = $(mkparamblock_SOURCES)
 
 srcdir = @srcdir@
 top_srcdir = @top_srcdir@
 VPATH = @srcdir@
-prefix = @prefix@
-exec_prefix = @exec_prefix@
-
-bindir = @bindir@
-sbindir = @sbindir@
-libexecdir = @libexecdir@
-datadir = @datadir@
-sysconfdir = @sysconfdir@
-sharedstatedir = @sharedstatedir@
-localstatedir = @localstatedir@
-libdir = @libdir@
-infodir = @infodir@
-mandir = @mandir@
-includedir = @includedir@
-oldincludedir = /usr/include
-
-DESTDIR =
-
 pkgdatadir = $(datadir)/@PACKAGE@
 pkglibdir = $(libdir)/@PACKAGE@
 pkgincludedir = $(includedir)/@PACKAGE@
-
 top_builddir = ../..
-
-ACLOCAL = @ACLOCAL@
-AUTOCONF = @AUTOCONF@
-AUTOMAKE = @AUTOMAKE@
-AUTOHEADER = @AUTOHEADER@
-
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
 INSTALL = @INSTALL@
-INSTALL_PROGRAM = @INSTALL_PROGRAM@ $(AM_INSTALL_PROGRAM_FLAGS)
-INSTALL_DATA = @INSTALL_DATA@
-INSTALL_SCRIPT = @INSTALL_SCRIPT@
-transform = @program_transform_name@
-
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
 NORMAL_INSTALL = :
 PRE_INSTALL = :
 POST_INSTALL = :
 NORMAL_UNINSTALL = :
 PRE_UNINSTALL = :
 POST_UNINSTALL = :
-host_alias = @host_alias@
 host_triplet = @host@
+bin_PROGRAMS = mkparamblock$(EXEEXT)
+subdir = utils/mkparamblock
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+am__installdirs = "$(DESTDIR)$(bindir)"
+binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
+PROGRAMS = $(bin_PROGRAMS)
+am_mkparamblock_OBJECTS = mkparamblock-mkparamblock.$(OBJEXT)
+mkparamblock_OBJECTS = $(am_mkparamblock_OBJECTS)
+mkparamblock_LDADD = $(LDADD)
+depcomp = $(SHELL) $(top_srcdir)/tools/depcomp
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/mkparamblock-mkparamblock.Po
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(mkparamblock_SOURCES)
+DIST_SOURCES = $(mkparamblock_SOURCES)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
 AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
 BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
-BLOB_PLATFORM_OBJ = @BLOB_PLATFORM_OBJ@
-CC = @CC@
-CHKMEM = @CHKMEM@
-CLOCK = @CLOCK@
-DEBUG = @DEBUG@
-DIAG_PLATFORM_OBJ = @DIAG_PLATFORM_OBJ@
-LCD = @LCD@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
+CC = gcc
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
 LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
 MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
 MAKEINFO = @MAKEINFO@
-MEMSETUP = @MEMSETUP@
 OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
 OCFLAGS = @OCFLAGS@
 PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
 RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
 VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+DEFAULT_INCLUDES = 
+mkparamblock_SOURCES = \
+	mkparamblock.c
+
+mkparamblock_CFLAGS = -g -O2 -Wall \
+	-DHAVE_CONFIG_H -DUSER_SPACE_TEST -DUSE_BLOB_TOGETHER_WITH_LIBC \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include \
+	-I@LINUX_INCLUDE@
 
-bin_PROGRAMS =  	mkparamblock
-
-
-mkparamblock_SOURCES =  	mkparamblock.c
-
-
-CLEANFILE = mkparamblock *~
-mkinstalldirs = $(SHELL) $(top_srcdir)/tools/mkinstalldirs
-CONFIG_HEADER = ../../include/blob/config.h
-CONFIG_CLEAN_FILES = 
-PROGRAMS =  $(bin_PROGRAMS)
-
-
-DEFS = @DEFS@ -I. -I$(srcdir) -I../../include/blob
-CPPFLAGS = @CPPFLAGS@
-LDFLAGS = @LDFLAGS@
-LIBS = @LIBS@
-mkparamblock_OBJECTS =  mkparamblock.o
-mkparamblock_LDADD = $(LDADD)
-mkparamblock_DEPENDENCIES = 
 mkparamblock_LDFLAGS = 
-CFLAGS = @CFLAGS@
-COMPILE = $(CC) $(DEFS) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
-CCLD = $(CC)
-LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(LDFLAGS) -o $@
-DIST_COMMON =  Makefile.am Makefile.in
-
+CLEANFILES = ${srcdir}/*~
+all: all-am
 
-DISTFILES = $(DIST_COMMON) $(SOURCES) $(HEADERS) $(TEXINFOS) $(EXTRA_DIST)
-
-TAR = tar
-GZIP_ENV = --best
-SOURCES = $(mkparamblock_SOURCES)
-OBJECTS = $(mkparamblock_OBJECTS)
-
-all: all-redirect
 .SUFFIXES:
-.SUFFIXES: .S .c .o .s
-$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ Makefile.am $(top_srcdir)/configure.in $(ACLOCAL_M4) 
-	cd $(top_srcdir) && $(AUTOMAKE) --gnu --include-deps utils/mkparamblock/Makefile
-
-Makefile: $(srcdir)/Makefile.in  $(top_builddir)/config.status
-	cd $(top_builddir) \
-	  && CONFIG_FILES=$(subdir)/$@ CONFIG_HEADERS= $(SHELL) ./config.status
-
-
-mostlyclean-binPROGRAMS:
-
-clean-binPROGRAMS:
-	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
-
-distclean-binPROGRAMS:
-
-maintainer-clean-binPROGRAMS:
-
+.SUFFIXES: .c .o .obj
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  utils/mkparamblock/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  utils/mkparamblock/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
 install-binPROGRAMS: $(bin_PROGRAMS)
 	@$(NORMAL_INSTALL)
-	$(mkinstalldirs) $(DESTDIR)$(bindir)
+	test -z "$(bindir)" || $(mkdir_p) "$(DESTDIR)$(bindir)"
 	@list='$(bin_PROGRAMS)'; for p in $$list; do \
-	  if test -f $$p; then \
-	    echo "  $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`"; \
-	     $(INSTALL_PROGRAM) $$p $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`; \
+	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
+	  if test -f $$p \
+	  ; then \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) '$$p' '$(DESTDIR)$(bindir)/$$f'"; \
+	   $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) "$$p" "$(DESTDIR)$(bindir)/$$f" || exit 1; \
 	  else :; fi; \
 	done
 
 uninstall-binPROGRAMS:
 	@$(NORMAL_UNINSTALL)
-	list='$(bin_PROGRAMS)'; for p in $$list; do \
-	  rm -f $(DESTDIR)$(bindir)/`echo $$p|sed 's/$(EXEEXT)$$//'|sed '$(transform)'|sed 's/$$/$(EXEEXT)/'`; \
+	@list='$(bin_PROGRAMS)'; for p in $$list; do \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  echo " rm -f '$(DESTDIR)$(bindir)/$$f'"; \
+	  rm -f "$(DESTDIR)$(bindir)/$$f"; \
 	done
 
-.c.o:
-	$(COMPILE) -c $<
-
-.s.o:
-	$(COMPILE) -c $<
-
-.S.o:
-	$(COMPILE) -c $<
+clean-binPROGRAMS:
+	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
+mkparamblock$(EXEEXT): $(mkparamblock_OBJECTS) $(mkparamblock_DEPENDENCIES) 
+	@rm -f mkparamblock$(EXEEXT)
+	$(LINK) $(mkparamblock_LDFLAGS) $(mkparamblock_OBJECTS) $(mkparamblock_LDADD) $(LIBS)
 
 mostlyclean-compile:
-	-rm -f *.o core *.core
-
-clean-compile:
+	-rm -f *.$(OBJEXT)
 
 distclean-compile:
 	-rm -f *.tab.c
 
-maintainer-clean-compile:
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/mkparamblock-mkparamblock.Po@am__quote@
 
+.c.o:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c `$(CYGPATH_W) '$<'`
+
+mkparamblock-mkparamblock.o: mkparamblock.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(mkparamblock_CFLAGS) $(CFLAGS) -MT mkparamblock-mkparamblock.o -MD -MP -MF "$(DEPDIR)/mkparamblock-mkparamblock.Tpo" -c -o mkparamblock-mkparamblock.o `test -f 'mkparamblock.c' || echo '$(srcdir)/'`mkparamblock.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/mkparamblock-mkparamblock.Tpo" "$(DEPDIR)/mkparamblock-mkparamblock.Po"; else rm -f "$(DEPDIR)/mkparamblock-mkparamblock.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='mkparamblock.c' object='mkparamblock-mkparamblock.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/mkparamblock-mkparamblock.Po' tmpdepfile='$(DEPDIR)/mkparamblock-mkparamblock.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(mkparamblock_CFLAGS) $(CFLAGS) -c -o mkparamblock-mkparamblock.o `test -f 'mkparamblock.c' || echo '$(srcdir)/'`mkparamblock.c
+
+mkparamblock-mkparamblock.obj: mkparamblock.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(mkparamblock_CFLAGS) $(CFLAGS) -MT mkparamblock-mkparamblock.obj -MD -MP -MF "$(DEPDIR)/mkparamblock-mkparamblock.Tpo" -c -o mkparamblock-mkparamblock.obj `if test -f 'mkparamblock.c'; then $(CYGPATH_W) 'mkparamblock.c'; else $(CYGPATH_W) '$(srcdir)/mkparamblock.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/mkparamblock-mkparamblock.Tpo" "$(DEPDIR)/mkparamblock-mkparamblock.Po"; else rm -f "$(DEPDIR)/mkparamblock-mkparamblock.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='mkparamblock.c' object='mkparamblock-mkparamblock.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/mkparamblock-mkparamblock.Po' tmpdepfile='$(DEPDIR)/mkparamblock-mkparamblock.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(mkparamblock_CFLAGS) $(CFLAGS) -c -o mkparamblock-mkparamblock.obj `if test -f 'mkparamblock.c'; then $(CYGPATH_W) 'mkparamblock.c'; else $(CYGPATH_W) '$(srcdir)/mkparamblock.c'; fi`
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
 tags: TAGS
 
-ID: $(HEADERS) $(SOURCES) $(LISP)
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	here=`pwd` && cd $(srcdir) \
-	  && mkid -f$$here/ID $$unique $(LISP)
-
-TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) $(LISP)
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
 	tags=; \
 	here=`pwd`; \
-	list='$(SOURCES) $(HEADERS)'; \
-	unique=`for i in $$list; do echo $$i; done | \
-	  awk '    { files[$$0] = 1; } \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
 	       END { for (i in files) print i; }'`; \
-	test -z "$(ETAGS_ARGS)$$unique$(LISP)$$tags" \
-	  || (cd $(srcdir) && etags $(ETAGS_ARGS) $$tags  $$unique $(LISP) -o $$here/TAGS)
-
-mostlyclean-tags:
-
-clean-tags:
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
 
 distclean-tags:
-	-rm -f TAGS ID
-
-maintainer-clean-tags:
-
-distdir = $(top_builddir)/$(PACKAGE)-$(VERSION)/$(subdir)
-
-subdir = utils/mkparamblock
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
 
 distdir: $(DISTFILES)
-	@for file in $(DISTFILES); do \
-	  d=$(srcdir); \
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
 	  if test -d $$d/$$file; then \
-	    cp -pr $$d/$$file $(distdir)/$$file; \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
 	  else \
 	    test -f $(distdir)/$$file \
-	    || ln $$d/$$file $(distdir)/$$file 2> /dev/null \
-	    || cp -p $$d/$$file $(distdir)/$$file || :; \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
 	  fi; \
 	done
-
-info-am:
-info: info-am
-dvi-am:
-dvi: dvi-am
 check-am: all-am
 check: check-am
-installcheck-am:
-installcheck: installcheck-am
-install-exec-am: install-binPROGRAMS
+all-am: Makefile $(PROGRAMS)
+installdirs:
+	for dir in "$(DESTDIR)$(bindir)"; do \
+	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
+	done
+install: install-am
 install-exec: install-exec-am
-
-install-data-am:
 install-data: install-data-am
+uninstall: uninstall-am
 
 install-am: all-am
 	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
-install: install-am
-uninstall-am: uninstall-binPROGRAMS
-uninstall: uninstall-am
-all-am: Makefile $(PROGRAMS)
-all-redirect: all-am
-install-strip:
-	$(MAKE) $(AM_MAKEFLAGS) AM_INSTALL_PROGRAM_FLAGS=-s install
-installdirs:
-	$(mkinstalldirs)  $(DESTDIR)$(bindir)
-
 
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
 mostlyclean-generic:
 
 clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
 
 distclean-generic:
-	-rm -f Makefile $(CONFIG_CLEAN_FILES)
-	-rm -f config.cache config.log stamp-h stamp-h[0-9]*
+	-rm -f $(CONFIG_CLEAN_FILES)
 
 maintainer-clean-generic:
-mostlyclean-am:  mostlyclean-binPROGRAMS mostlyclean-compile \
-		mostlyclean-tags mostlyclean-generic
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
 
-mostlyclean: mostlyclean-am
+clean-am: clean-binPROGRAMS clean-generic mostlyclean-am
 
-clean-am:  clean-binPROGRAMS clean-compile clean-tags clean-generic \
-		mostlyclean-am
+distclean: distclean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
 
-clean: clean-am
+dvi: dvi-am
+
+dvi-am:
 
-distclean-am:  distclean-binPROGRAMS distclean-compile distclean-tags \
-		distclean-generic clean-am
+html: html-am
 
-distclean: distclean-am
+info: info-am
 
-maintainer-clean-am:  maintainer-clean-binPROGRAMS \
-		maintainer-clean-compile maintainer-clean-tags \
-		maintainer-clean-generic distclean-am
-	@echo "This command is intended for maintainers to use;"
-	@echo "it deletes files that may require special tools to rebuild."
+info-am:
+
+install-data-am:
+
+install-exec-am: install-binPROGRAMS
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
 
 maintainer-clean: maintainer-clean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
 
-.PHONY: mostlyclean-binPROGRAMS distclean-binPROGRAMS clean-binPROGRAMS \
-maintainer-clean-binPROGRAMS uninstall-binPROGRAMS install-binPROGRAMS \
-mostlyclean-compile distclean-compile clean-compile \
-maintainer-clean-compile tags mostlyclean-tags distclean-tags \
-clean-tags maintainer-clean-tags distdir info-am info dvi-am dvi check \
-check-am installcheck-am installcheck install-exec-am install-exec \
-install-data-am install-data install-am install uninstall-am uninstall \
-all-redirect all-am all installdirs mostlyclean-generic \
-distclean-generic clean-generic maintainer-clean-generic clean \
-mostlyclean distclean maintainer-clean
+ps-am:
 
+uninstall-am: uninstall-binPROGRAMS uninstall-info-am
 
-mkparamblock: mkparamblock.c
-	gcc -Wall -O2 -I${top_builddir}/include -I${top_srcdir}/include -o $@ $<
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-binPROGRAMS \
+	clean-generic ctags distclean distclean-compile \
+	distclean-generic distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-binPROGRAMS \
+	install-data install-data-am install-exec install-exec-am \
+	install-info install-info-am install-man install-strip \
+	installcheck installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-binPROGRAMS uninstall-info-am
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: build_tree/bootLoader/utils/mkparamblock/mkparamblock.c
diff -u build_tree/bootLoader/utils/mkparamblock/mkparamblock.c:1.1.1.1 build_tree/bootLoader/utils/mkparamblock/mkparamblock.c:1.1.1.3
--- build_tree/bootLoader/utils/mkparamblock/mkparamblock.c:1.1.1.1	Thu Nov  8 14:15:45 2007
+++ build_tree/bootLoader/utils/mkparamblock/mkparamblock.c	Fri Nov  9 10:37:08 2007
@@ -3,8 +3,8 @@
 #include <stdio.h>
 #include <string.h>
 #include <stdlib.h>
+#include <limits.h>
 #include <sys/stat.h>
-#define USE_BLOB_TOGETHER_WITH_LIBC
 #include <blob/param_block.h>
 #include <blob/serial.h>
 
@@ -63,13 +63,29 @@
 	return -1;
 }
 
+int read_mac(char *token, char *mac)
+{
+	int i;
+	unsigned long retval;
+	char *endptr;
+
+	for (i = 0; i < 6; i++) {
+		retval = strtoul(token, &endptr, 16);
+		if (endptr == token) break;
+		if (retval < 0 || retval > 0xFF) break;
+		mac[i] = retval;
+		if (*endptr != ':' && i < 5) break;
+		token = endptr + 1;
+	}
+	if (i != 6) return -1;
+	return 0;
+}		
 
 int tack_ramdisk(char *line, FILE *fp)
 {
 	struct ptag tag;
 	tag.hdr.ptag = PTAG_RAMDISK;
 	tag.hdr.size = ptag_size(ptag_ramdisk);
-	tag.hdr.conf_mask = 0;
 	tag.hdr.conf = 0;
 
 	if ((tag.u.ramdisk.flags = read_yn(line)) == -1) return -1;
@@ -84,10 +100,10 @@
 	struct ptag tag;
 	tag.hdr.ptag = PTAG_BOOTDELAY;
 	tag.hdr.size = ptag_size(ptag_bootdelay);
-	tag.hdr.conf_mask = 0;
 	tag.hdr.conf = 0;
 
-	if ((tag.u.bootdelay.delay = strtoul(line, 0, 0)) <= 0) return -1;
+	if ((tag.u.bootdelay.delay = strtoul(line, 0, 0)) == ULONG_MAX) 
+		return -1;
 
 	fwrite(&tag, ptag_size(ptag_bootdelay), 4, fp);
 	return 0;
@@ -100,7 +116,6 @@
 	int zero = 0;
 	tag.hdr.ptag = PTAG_CMDLINE;
 	tag.hdr.size = (sizeof(tag.hdr) + strlen(line) + 1 + 4) >> 2;
-	tag.hdr.conf_mask = 0;
 	tag.hdr.conf = 0;
 
 	fwrite(&tag, sizeof(tag.hdr), 1, fp);
@@ -116,11 +131,10 @@
 	char *arg;
 	u32 terminal, download;
 	fpos_t bookmark;
+	tag.hdr.conf = 0;
 	
 	tag.hdr.ptag = PTAG_BAUD;
 	tag.hdr.size = ptag_size(ptag_baud);
-	tag.hdr.conf_mask = 0;
-	tag.hdr.conf = 0;
 
 	if (!(arg = strtok(line, "\t =,"))) return -1;
 	if ((terminal = convert_baud(arg)) < 0) return -1;
@@ -138,27 +152,44 @@
 	return 0;
 }
 
+int tack_hwaddr(char *line, FILE *fp)
+{
+	char *token;
+	struct ptag tag;
+	tag.hdr.ptag = PTAG_HWADDR;
+	tag.hdr.size = ptag_size(ptag_hwaddr);
+	tag.hdr.conf = 0;
+	
+	token = strtok(line, "\t\n ");
+	if (!token) return -1;
+	strncpy(tag.u.hwaddr.name, token, 10);
+	tag.u.hwaddr.name[9] = '\0';
+	token = strtok(NULL, "\t\n ");
+	if (!token) return -1;
+	if (read_mac(token, tag.u.hwaddr.hwaddr) < 0) return -1;
+	
+	fwrite(&tag, ptag_size(ptag_hwaddr), 4, fp);
+	return 0;
+}
 
 void tack_core(FILE *fp)
 {
 	struct ptag tag;
 	tag.hdr.ptag = PTAG_CORE;
 	tag.hdr.size = ptag_size(ptag_core);
-	tag.hdr.conf_mask = 0;
 	tag.hdr.conf = 0;
 
-	tag.u.core.terminal = baud_9600;
+	/* FIXME: default is not always 9600 */
+	tag.u.core.terminal = baud_115200;
 	
 	fwrite(&tag, ptag_size(ptag_core), 4, fp);
 }
 
-
 void tack_none(FILE *fp)
 {
 	struct ptag tag;
 	tag.hdr.ptag = PTAG_NONE;
 	tag.hdr.size = 0;
-	tag.hdr.conf_mask = 0;
 	tag.hdr.conf = 0;
 	
 	fwrite(&tag, sizeof(tag.hdr), 1, fp);
@@ -171,6 +202,7 @@
 	{"bootdelay",	tack_bootdelay},
 	{"cmdline",	tack_cmdline},
 	{"baud",	tack_baud},
+	{"hwaddr",	tack_hwaddr},
 };
 
 
Index: build_tree/bootLoader/utils/mkparamblock/sample.config
diff -u /dev/null build_tree/bootLoader/utils/mkparamblock/sample.config:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/mkparamblock/sample.config	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,8 @@
+# Sample paramater block configuration file
+
+ramdisk		no		# default is yes
+bootdelay	1		# default is 10
+cmdline		console=ttySA0,9600 console=tty1 root=/dev/mtdblock2 init=/linuxrc
+baud		9600, 115k2	# these are the defaults
+hwaddr		eth0	00:11:22:33:44:55
+
Index: build_tree/bootLoader/utils/test/.cvsignore
diff -u /dev/null build_tree/bootLoader/utils/test/.cvsignore:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/test/.cvsignore	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,10 @@
+aclocal.m4
+configure
+config.cache
+config.log
+config.status
+Makefile.in
+Makefile
+junk
+load_kernel_test
+.deps
Index: build_tree/bootLoader/utils/test/Makefile.am
diff -u /dev/null build_tree/bootLoader/utils/test/Makefile.am:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/test/Makefile.am	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,51 @@
+# -*- makefile -*-
+#
+# $Id: Makefile.am,v 1.10 2003/09/01 20:13:10 russd Exp $
+#
+# This is a special Makefile because it plays with a CC and CFLAGS
+# to compile with the native C compiler (which we assume is gcc).
+# The manipulation of the VPATH is needed to be able to compile
+# sources from other directories. -- Erik
+#
+
+
+VPATH = $(top_srcdir)/utils/test:$(top_srcdir)/src/blob:$(top_srcdir)/src/lib
+
+
+DEFAULT_INCLUDES = 
+CC = gcc
+
+
+bin_PROGRAMS	= \
+	load_kernel_test
+
+
+load_kernel_test_SOURCES =  \
+	load_kernel_test.c \
+	${top_srcdir}/src/blob/load_kernel.c \
+	${top_srcdir}/src/lib/md5.c \
+	${top_srcdir}/src/lib/md5support.c \
+	${top_srcdir}/src/lib/mini_inflate.c \
+	${top_srcdir}/src/lib/error.c \
+	${top_srcdir}/src/blob/flash.c \
+	${top_srcdir}/src/blob/partition.c \
+	${top_srcdir}/src/lib/util.c \
+	${top_srcdir}/src/blob/jffs2.c \
+	${top_srcdir}/src/blob/compr_rtime.c \
+	${top_srcdir}/src/blob/compr_rubin.c \
+	${top_srcdir}/src/blob/cramfs.c \
+	${top_srcdir}/src/blob/zImage.c \
+	${top_srcdir}/src/lib/crc32.c
+
+load_kernel_test_CFLAGS = -g -O2 -Wall \
+	-DHAVE_CONFIG_H -DUSER_SPACE_TEST -DUSE_BLOB_TOGETHER_WITH_LIBC \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include \
+	-I@LINUX_INCLUDE@
+
+
+load_kernel_test_LDFLAGS = 
+
+
+
+CLEANFILES = ${srcdir}/*~
Index: build_tree/bootLoader/utils/test/Makefile.in
diff -u /dev/null build_tree/bootLoader/utils/test/Makefile.in:1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/test/Makefile.in	Mon Nov 12 16:25:56 2007
@@ -0,0 +1,755 @@
+# Makefile.in generated by automake 1.8.3 from Makefile.am.
+# @configure_input@
+
+# Copyright (C) 1994, 1995, 1996, 1997, 1998, 1999, 2000, 2001, 2002,
+# 2003, 2004  Free Software Foundation, Inc.
+# This Makefile.in is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+@SET_MAKE@
+
+# -*- makefile -*-
+#
+# $Id: Makefile.am,v 1.10 2003/09/01 20:13:10 russd Exp $
+#
+# This is a special Makefile because it plays with a CC and CFLAGS
+# to compile with the native C compiler (which we assume is gcc).
+# The manipulation of the VPATH is needed to be able to compile
+# sources from other directories. -- Erik
+#
+
+SOURCES = $(load_kernel_test_SOURCES)
+
+srcdir = @srcdir@
+top_srcdir = @top_srcdir@
+pkgdatadir = $(datadir)/@PACKAGE@
+pkglibdir = $(libdir)/@PACKAGE@
+pkgincludedir = $(includedir)/@PACKAGE@
+top_builddir = ../..
+am__cd = CDPATH="$${ZSH_VERSION+.}$(PATH_SEPARATOR)" && cd
+INSTALL = @INSTALL@
+install_sh_DATA = $(install_sh) -c -m 644
+install_sh_PROGRAM = $(install_sh) -c
+install_sh_SCRIPT = $(install_sh) -c
+INSTALL_HEADER = $(INSTALL_DATA)
+transform = $(program_transform_name)
+NORMAL_INSTALL = :
+PRE_INSTALL = :
+POST_INSTALL = :
+NORMAL_UNINSTALL = :
+PRE_UNINSTALL = :
+POST_UNINSTALL = :
+host_triplet = @host@
+bin_PROGRAMS = load_kernel_test$(EXEEXT)
+subdir = utils/test
+DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
+ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
+am__aclocal_m4_deps = $(top_srcdir)/configure.in
+am__configure_deps = $(am__aclocal_m4_deps) $(CONFIGURE_DEPENDENCIES) \
+	$(ACLOCAL_M4)
+mkinstalldirs = $(mkdir_p)
+CONFIG_HEADER = $(top_builddir)/include/blob/config.h
+CONFIG_CLEAN_FILES =
+am__installdirs = "$(DESTDIR)$(bindir)"
+binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
+PROGRAMS = $(bin_PROGRAMS)
+am_load_kernel_test_OBJECTS =  \
+	load_kernel_test-load_kernel_test.$(OBJEXT) \
+	load_kernel_test-load_kernel.$(OBJEXT) \
+	load_kernel_test-md5.$(OBJEXT) \
+	load_kernel_test-md5support.$(OBJEXT) \
+	load_kernel_test-mini_inflate.$(OBJEXT) \
+	load_kernel_test-error.$(OBJEXT) \
+	load_kernel_test-flash.$(OBJEXT) \
+	load_kernel_test-partition.$(OBJEXT) \
+	load_kernel_test-util.$(OBJEXT) \
+	load_kernel_test-jffs2.$(OBJEXT) \
+	load_kernel_test-compr_rtime.$(OBJEXT) \
+	load_kernel_test-compr_rubin.$(OBJEXT) \
+	load_kernel_test-cramfs.$(OBJEXT) \
+	load_kernel_test-zImage.$(OBJEXT) \
+	load_kernel_test-crc32.$(OBJEXT)
+load_kernel_test_OBJECTS = $(am_load_kernel_test_OBJECTS)
+load_kernel_test_LDADD = $(LDADD)
+depcomp = $(SHELL) $(top_srcdir)/tools/depcomp
+am__depfiles_maybe = depfiles
+@AMDEP_TRUE@DEP_FILES = ./$(DEPDIR)/load_kernel_test-compr_rtime.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-compr_rubin.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-cramfs.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-crc32.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-error.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-flash.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-jffs2.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-load_kernel.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-load_kernel_test.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-md5.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-md5support.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-mini_inflate.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-partition.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-util.Po \
+@AMDEP_TRUE@	./$(DEPDIR)/load_kernel_test-zImage.Po
+COMPILE = $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) \
+	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
+CCLD = $(CC)
+LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
+SOURCES = $(load_kernel_test_SOURCES)
+DIST_SOURCES = $(load_kernel_test_SOURCES)
+ETAGS = etags
+CTAGS = ctags
+DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
+VPATH = $(top_srcdir)/utils/test:$(top_srcdir)/src/blob:$(top_srcdir)/src/lib
+ACLOCAL = @ACLOCAL@
+ALL_COMMANDS = @ALL_COMMANDS@
+AMDEP_FALSE = @AMDEP_FALSE@
+AMDEP_TRUE = @AMDEP_TRUE@
+AMTAR = @AMTAR@
+AR = @AR@
+AUTOCONF = @AUTOCONF@
+AUTOHEADER = @AUTOHEADER@
+AUTOMAKE = @AUTOMAKE@
+AWK = @AWK@
+BLOB_CF_OBJS = @BLOB_CF_OBJS@
+BLOB_CHKMEM_OBJS = @BLOB_CHKMEM_OBJS@
+BLOB_CLOCK_OBJS = @BLOB_CLOCK_OBJS@
+BLOB_COMMANDS = @BLOB_COMMANDS@
+BLOB_CRAMFS_OBJS = @BLOB_CRAMFS_OBJS@
+BLOB_FLASH_OBJS = @BLOB_FLASH_OBJS@
+BLOB_GIO_OBJS = @BLOB_GIO_OBJS@
+BLOB_IDE_OBJS = @BLOB_IDE_OBJS@
+BLOB_JFFS2_OBJS = @BLOB_JFFS2_OBJS@
+BLOB_LED_DRIVER_OBJS = @BLOB_LED_DRIVER_OBJS@
+BLOB_LED_STARTCODE = @BLOB_LED_STARTCODE@
+BLOB_MEMSETUP_OBJS = @BLOB_MEMSETUP_OBJS@
+BLOB_NETWORK_DRIVER_OBJS = @BLOB_NETWORK_DRIVER_OBJS@
+BLOB_NETWORK_OBJS = @BLOB_NETWORK_OBJS@
+BLOB_PCMCIA_OBJS = @BLOB_PCMCIA_OBJS@
+BLOB_PLATFORM_OBJS = @BLOB_PLATFORM_OBJS@
+BLOB_REBOOT_DRIVER_OBJS = @BLOB_REBOOT_DRIVER_OBJS@
+BLOB_SERIAL_DRIVER_OBJS = @BLOB_SERIAL_DRIVER_OBJS@
+BLOB_STARTCODE_OBJS = @BLOB_STARTCODE_OBJS@
+BLOB_TARGET = @BLOB_TARGET@
+BLOB_TIMER_DRIVER_OBJS = @BLOB_TIMER_DRIVER_OBJS@
+BLOB_USBSERIAL_OBJS = @BLOB_USBSERIAL_OBJS@
+BLOB_UUCODEC_OBJS = @BLOB_UUCODEC_OBJS@
+BLOB_XMODEM_OBJS = @BLOB_XMODEM_OBJS@
+BLOB_ZIMAGE_OBJS = @BLOB_ZIMAGE_OBJS@
+CC = gcc
+CCAS = @CCAS@
+CCASFLAGS = @CCASFLAGS@
+CCDEPMODE = @CCDEPMODE@
+CFLAGS = @CFLAGS@
+CPPFLAGS = @CPPFLAGS@
+CYGPATH_W = @CYGPATH_W@
+DEFS = @DEFS@
+DEPDIR = @DEPDIR@
+DIAG_LCD_OBJS = @DIAG_LCD_OBJS@
+DIAG_PLATFORM_OBJS = @DIAG_PLATFORM_OBJS@
+ECHO_C = @ECHO_C@
+ECHO_N = @ECHO_N@
+ECHO_T = @ECHO_T@
+EXEEXT = @EXEEXT@
+INSTALL_DATA = @INSTALL_DATA@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_SCRIPT = @INSTALL_SCRIPT@
+INSTALL_STRIP_PROGRAM = @INSTALL_STRIP_PROGRAM@
+LD = @LD@
+LDFLAGS = @LDFLAGS@
+LIBOBJS = @LIBOBJS@
+LIBS = @LIBS@
+LINUX_INCLUDE = @LINUX_INCLUDE@
+LN_S = @LN_S@
+LTLIBOBJS = @LTLIBOBJS@
+MAINT = @MAINT@
+MAINTAINER_MODE_FALSE = @MAINTAINER_MODE_FALSE@
+MAINTAINER_MODE_TRUE = @MAINTAINER_MODE_TRUE@
+MAKEINFO = @MAKEINFO@
+OBJCOPY = @OBJCOPY@
+OBJEXT = @OBJEXT@
+OCFLAGS = @OCFLAGS@
+PACKAGE = @PACKAGE@
+PACKAGE_BUGREPORT = @PACKAGE_BUGREPORT@
+PACKAGE_NAME = @PACKAGE_NAME@
+PACKAGE_STRING = @PACKAGE_STRING@
+PACKAGE_TARNAME = @PACKAGE_TARNAME@
+PACKAGE_VERSION = @PACKAGE_VERSION@
+PATH_SEPARATOR = @PATH_SEPARATOR@
+RANLIB = @RANLIB@
+SET_MAKE = @SET_MAKE@
+SHELL = @SHELL@
+STRIP = @STRIP@
+VERSION = @VERSION@
+ac_ct_CC = @ac_ct_CC@
+ac_ct_RANLIB = @ac_ct_RANLIB@
+ac_ct_STRIP = @ac_ct_STRIP@
+am__fastdepCC_FALSE = @am__fastdepCC_FALSE@
+am__fastdepCC_TRUE = @am__fastdepCC_TRUE@
+am__include = @am__include@
+am__leading_dot = @am__leading_dot@
+am__quote = @am__quote@
+bindir = @bindir@
+build = @build@
+build_alias = @build_alias@
+build_cpu = @build_cpu@
+build_os = @build_os@
+build_vendor = @build_vendor@
+datadir = @datadir@
+exec_prefix = @exec_prefix@
+host = @host@
+host_alias = @host_alias@
+host_cpu = @host_cpu@
+host_os = @host_os@
+host_vendor = @host_vendor@
+includedir = @includedir@
+infodir = @infodir@
+install_sh = @install_sh@
+libdir = @libdir@
+libexecdir = @libexecdir@
+localstatedir = @localstatedir@
+mandir = @mandir@
+mkdir_p = @mkdir_p@
+oldincludedir = @oldincludedir@
+prefix = @prefix@
+program_transform_name = @program_transform_name@
+sbindir = @sbindir@
+sharedstatedir = @sharedstatedir@
+sysconfdir = @sysconfdir@
+target_alias = @target_alias@
+DEFAULT_INCLUDES = 
+load_kernel_test_SOURCES = \
+	load_kernel_test.c \
+	${top_srcdir}/src/blob/load_kernel.c \
+	${top_srcdir}/src/lib/md5.c \
+	${top_srcdir}/src/lib/md5support.c \
+	${top_srcdir}/src/lib/mini_inflate.c \
+	${top_srcdir}/src/lib/error.c \
+	${top_srcdir}/src/blob/flash.c \
+	${top_srcdir}/src/blob/partition.c \
+	${top_srcdir}/src/lib/util.c \
+	${top_srcdir}/src/blob/jffs2.c \
+	${top_srcdir}/src/blob/compr_rtime.c \
+	${top_srcdir}/src/blob/compr_rubin.c \
+	${top_srcdir}/src/blob/cramfs.c \
+	${top_srcdir}/src/blob/zImage.c \
+	${top_srcdir}/src/lib/crc32.c
+
+load_kernel_test_CFLAGS = -g -O2 -Wall \
+	-DHAVE_CONFIG_H -DUSER_SPACE_TEST -DUSE_BLOB_TOGETHER_WITH_LIBC \
+	-I${top_builddir}/include \
+	-I${top_srcdir}/include \
+	-I@LINUX_INCLUDE@
+
+load_kernel_test_LDFLAGS = 
+CLEANFILES = ${srcdir}/*~
+all: all-am
+
+.SUFFIXES:
+.SUFFIXES: .c .o .obj
+$(srcdir)/Makefile.in: @MAINTAINER_MODE_TRUE@ $(srcdir)/Makefile.am  $(am__configure_deps)
+	@for dep in $?; do \
+	  case '$(am__configure_deps)' in \
+	    *$$dep*) \
+	      cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh \
+		&& exit 0; \
+	      exit 1;; \
+	  esac; \
+	done; \
+	echo ' cd $(top_srcdir) && $(AUTOMAKE) --gnu  utils/test/Makefile'; \
+	cd $(top_srcdir) && \
+	  $(AUTOMAKE) --gnu  utils/test/Makefile
+.PRECIOUS: Makefile
+Makefile: $(srcdir)/Makefile.in $(top_builddir)/config.status
+	@case '$?' in \
+	  *config.status*) \
+	    cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh;; \
+	  *) \
+	    echo ' cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe)'; \
+	    cd $(top_builddir) && $(SHELL) ./config.status $(subdir)/$@ $(am__depfiles_maybe);; \
+	esac;
+
+$(top_builddir)/config.status: $(top_srcdir)/configure $(CONFIG_STATUS_DEPENDENCIES)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+
+$(top_srcdir)/configure: @MAINTAINER_MODE_TRUE@ $(am__configure_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+$(ACLOCAL_M4): @MAINTAINER_MODE_TRUE@ $(am__aclocal_m4_deps)
+	cd $(top_builddir) && $(MAKE) $(AM_MAKEFLAGS) am--refresh
+install-binPROGRAMS: $(bin_PROGRAMS)
+	@$(NORMAL_INSTALL)
+	test -z "$(bindir)" || $(mkdir_p) "$(DESTDIR)$(bindir)"
+	@list='$(bin_PROGRAMS)'; for p in $$list; do \
+	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
+	  if test -f $$p \
+	  ; then \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) '$$p' '$(DESTDIR)$(bindir)/$$f'"; \
+	   $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) "$$p" "$(DESTDIR)$(bindir)/$$f" || exit 1; \
+	  else :; fi; \
+	done
+
+uninstall-binPROGRAMS:
+	@$(NORMAL_UNINSTALL)
+	@list='$(bin_PROGRAMS)'; for p in $$list; do \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  echo " rm -f '$(DESTDIR)$(bindir)/$$f'"; \
+	  rm -f "$(DESTDIR)$(bindir)/$$f"; \
+	done
+
+clean-binPROGRAMS:
+	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
+load_kernel_test$(EXEEXT): $(load_kernel_test_OBJECTS) $(load_kernel_test_DEPENDENCIES) 
+	@rm -f load_kernel_test$(EXEEXT)
+	$(LINK) $(load_kernel_test_LDFLAGS) $(load_kernel_test_OBJECTS) $(load_kernel_test_LDADD) $(LIBS)
+
+mostlyclean-compile:
+	-rm -f *.$(OBJEXT)
+
+distclean-compile:
+	-rm -f *.tab.c
+
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-compr_rtime.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-compr_rubin.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-cramfs.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-crc32.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-error.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-flash.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-jffs2.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-load_kernel.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-load_kernel_test.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-md5.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-md5support.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-mini_inflate.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-partition.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-util.Po@am__quote@
+@AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/load_kernel_test-zImage.Po@am__quote@
+
+.c.o:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ $<; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c $<
+
+.c.obj:
+@am__fastdepCC_TRUE@	if $(COMPILE) -MT $@ -MD -MP -MF "$(DEPDIR)/$*.Tpo" -c -o $@ `$(CYGPATH_W) '$<'`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/$*.Tpo" "$(DEPDIR)/$*.Po"; else rm -f "$(DEPDIR)/$*.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='$<' object='$@' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/$*.Po' tmpdepfile='$(DEPDIR)/$*.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(COMPILE) -c `$(CYGPATH_W) '$<'`
+
+load_kernel_test-load_kernel_test.o: load_kernel_test.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-load_kernel_test.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-load_kernel_test.Tpo" -c -o load_kernel_test-load_kernel_test.o `test -f 'load_kernel_test.c' || echo '$(srcdir)/'`load_kernel_test.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-load_kernel_test.Tpo" "$(DEPDIR)/load_kernel_test-load_kernel_test.Po"; else rm -f "$(DEPDIR)/load_kernel_test-load_kernel_test.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='load_kernel_test.c' object='load_kernel_test-load_kernel_test.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-load_kernel_test.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-load_kernel_test.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-load_kernel_test.o `test -f 'load_kernel_test.c' || echo '$(srcdir)/'`load_kernel_test.c
+
+load_kernel_test-load_kernel_test.obj: load_kernel_test.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-load_kernel_test.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-load_kernel_test.Tpo" -c -o load_kernel_test-load_kernel_test.obj `if test -f 'load_kernel_test.c'; then $(CYGPATH_W) 'load_kernel_test.c'; else $(CYGPATH_W) '$(srcdir)/load_kernel_test.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-load_kernel_test.Tpo" "$(DEPDIR)/load_kernel_test-load_kernel_test.Po"; else rm -f "$(DEPDIR)/load_kernel_test-load_kernel_test.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='load_kernel_test.c' object='load_kernel_test-load_kernel_test.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-load_kernel_test.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-load_kernel_test.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-load_kernel_test.obj `if test -f 'load_kernel_test.c'; then $(CYGPATH_W) 'load_kernel_test.c'; else $(CYGPATH_W) '$(srcdir)/load_kernel_test.c'; fi`
+
+load_kernel_test-load_kernel.o: ${top_srcdir}/src/blob/load_kernel.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-load_kernel.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-load_kernel.Tpo" -c -o load_kernel_test-load_kernel.o `test -f '${top_srcdir}/src/blob/load_kernel.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/load_kernel.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-load_kernel.Tpo" "$(DEPDIR)/load_kernel_test-load_kernel.Po"; else rm -f "$(DEPDIR)/load_kernel_test-load_kernel.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/load_kernel.c' object='load_kernel_test-load_kernel.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-load_kernel.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-load_kernel.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-load_kernel.o `test -f '${top_srcdir}/src/blob/load_kernel.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/load_kernel.c
+
+load_kernel_test-load_kernel.obj: ${top_srcdir}/src/blob/load_kernel.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-load_kernel.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-load_kernel.Tpo" -c -o load_kernel_test-load_kernel.obj `if test -f '${top_srcdir}/src/blob/load_kernel.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/load_kernel.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/load_kernel.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-load_kernel.Tpo" "$(DEPDIR)/load_kernel_test-load_kernel.Po"; else rm -f "$(DEPDIR)/load_kernel_test-load_kernel.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/load_kernel.c' object='load_kernel_test-load_kernel.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-load_kernel.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-load_kernel.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-load_kernel.obj `if test -f '${top_srcdir}/src/blob/load_kernel.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/load_kernel.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/load_kernel.c'; fi`
+
+load_kernel_test-md5.o: ${top_srcdir}/src/lib/md5.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-md5.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-md5.Tpo" -c -o load_kernel_test-md5.o `test -f '${top_srcdir}/src/lib/md5.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/md5.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-md5.Tpo" "$(DEPDIR)/load_kernel_test-md5.Po"; else rm -f "$(DEPDIR)/load_kernel_test-md5.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/md5.c' object='load_kernel_test-md5.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-md5.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-md5.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-md5.o `test -f '${top_srcdir}/src/lib/md5.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/md5.c
+
+load_kernel_test-md5.obj: ${top_srcdir}/src/lib/md5.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-md5.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-md5.Tpo" -c -o load_kernel_test-md5.obj `if test -f '${top_srcdir}/src/lib/md5.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/md5.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/md5.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-md5.Tpo" "$(DEPDIR)/load_kernel_test-md5.Po"; else rm -f "$(DEPDIR)/load_kernel_test-md5.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/md5.c' object='load_kernel_test-md5.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-md5.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-md5.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-md5.obj `if test -f '${top_srcdir}/src/lib/md5.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/md5.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/md5.c'; fi`
+
+load_kernel_test-md5support.o: ${top_srcdir}/src/lib/md5support.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-md5support.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-md5support.Tpo" -c -o load_kernel_test-md5support.o `test -f '${top_srcdir}/src/lib/md5support.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/md5support.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-md5support.Tpo" "$(DEPDIR)/load_kernel_test-md5support.Po"; else rm -f "$(DEPDIR)/load_kernel_test-md5support.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/md5support.c' object='load_kernel_test-md5support.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-md5support.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-md5support.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-md5support.o `test -f '${top_srcdir}/src/lib/md5support.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/md5support.c
+
+load_kernel_test-md5support.obj: ${top_srcdir}/src/lib/md5support.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-md5support.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-md5support.Tpo" -c -o load_kernel_test-md5support.obj `if test -f '${top_srcdir}/src/lib/md5support.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/md5support.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/md5support.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-md5support.Tpo" "$(DEPDIR)/load_kernel_test-md5support.Po"; else rm -f "$(DEPDIR)/load_kernel_test-md5support.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/md5support.c' object='load_kernel_test-md5support.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-md5support.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-md5support.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-md5support.obj `if test -f '${top_srcdir}/src/lib/md5support.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/md5support.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/md5support.c'; fi`
+
+load_kernel_test-mini_inflate.o: ${top_srcdir}/src/lib/mini_inflate.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-mini_inflate.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-mini_inflate.Tpo" -c -o load_kernel_test-mini_inflate.o `test -f '${top_srcdir}/src/lib/mini_inflate.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/mini_inflate.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-mini_inflate.Tpo" "$(DEPDIR)/load_kernel_test-mini_inflate.Po"; else rm -f "$(DEPDIR)/load_kernel_test-mini_inflate.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/mini_inflate.c' object='load_kernel_test-mini_inflate.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-mini_inflate.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-mini_inflate.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-mini_inflate.o `test -f '${top_srcdir}/src/lib/mini_inflate.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/mini_inflate.c
+
+load_kernel_test-mini_inflate.obj: ${top_srcdir}/src/lib/mini_inflate.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-mini_inflate.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-mini_inflate.Tpo" -c -o load_kernel_test-mini_inflate.obj `if test -f '${top_srcdir}/src/lib/mini_inflate.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/mini_inflate.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/mini_inflate.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-mini_inflate.Tpo" "$(DEPDIR)/load_kernel_test-mini_inflate.Po"; else rm -f "$(DEPDIR)/load_kernel_test-mini_inflate.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/mini_inflate.c' object='load_kernel_test-mini_inflate.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-mini_inflate.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-mini_inflate.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-mini_inflate.obj `if test -f '${top_srcdir}/src/lib/mini_inflate.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/mini_inflate.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/mini_inflate.c'; fi`
+
+load_kernel_test-error.o: ${top_srcdir}/src/lib/error.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-error.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-error.Tpo" -c -o load_kernel_test-error.o `test -f '${top_srcdir}/src/lib/error.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/error.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-error.Tpo" "$(DEPDIR)/load_kernel_test-error.Po"; else rm -f "$(DEPDIR)/load_kernel_test-error.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/error.c' object='load_kernel_test-error.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-error.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-error.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-error.o `test -f '${top_srcdir}/src/lib/error.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/error.c
+
+load_kernel_test-error.obj: ${top_srcdir}/src/lib/error.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-error.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-error.Tpo" -c -o load_kernel_test-error.obj `if test -f '${top_srcdir}/src/lib/error.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/error.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/error.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-error.Tpo" "$(DEPDIR)/load_kernel_test-error.Po"; else rm -f "$(DEPDIR)/load_kernel_test-error.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/error.c' object='load_kernel_test-error.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-error.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-error.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-error.obj `if test -f '${top_srcdir}/src/lib/error.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/error.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/error.c'; fi`
+
+load_kernel_test-flash.o: ${top_srcdir}/src/blob/flash.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-flash.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-flash.Tpo" -c -o load_kernel_test-flash.o `test -f '${top_srcdir}/src/blob/flash.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/flash.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-flash.Tpo" "$(DEPDIR)/load_kernel_test-flash.Po"; else rm -f "$(DEPDIR)/load_kernel_test-flash.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/flash.c' object='load_kernel_test-flash.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-flash.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-flash.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-flash.o `test -f '${top_srcdir}/src/blob/flash.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/flash.c
+
+load_kernel_test-flash.obj: ${top_srcdir}/src/blob/flash.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-flash.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-flash.Tpo" -c -o load_kernel_test-flash.obj `if test -f '${top_srcdir}/src/blob/flash.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/flash.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/flash.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-flash.Tpo" "$(DEPDIR)/load_kernel_test-flash.Po"; else rm -f "$(DEPDIR)/load_kernel_test-flash.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/flash.c' object='load_kernel_test-flash.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-flash.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-flash.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-flash.obj `if test -f '${top_srcdir}/src/blob/flash.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/flash.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/flash.c'; fi`
+
+load_kernel_test-partition.o: ${top_srcdir}/src/blob/partition.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-partition.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-partition.Tpo" -c -o load_kernel_test-partition.o `test -f '${top_srcdir}/src/blob/partition.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/partition.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-partition.Tpo" "$(DEPDIR)/load_kernel_test-partition.Po"; else rm -f "$(DEPDIR)/load_kernel_test-partition.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/partition.c' object='load_kernel_test-partition.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-partition.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-partition.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-partition.o `test -f '${top_srcdir}/src/blob/partition.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/partition.c
+
+load_kernel_test-partition.obj: ${top_srcdir}/src/blob/partition.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-partition.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-partition.Tpo" -c -o load_kernel_test-partition.obj `if test -f '${top_srcdir}/src/blob/partition.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/partition.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/partition.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-partition.Tpo" "$(DEPDIR)/load_kernel_test-partition.Po"; else rm -f "$(DEPDIR)/load_kernel_test-partition.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/partition.c' object='load_kernel_test-partition.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-partition.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-partition.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-partition.obj `if test -f '${top_srcdir}/src/blob/partition.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/partition.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/partition.c'; fi`
+
+load_kernel_test-util.o: ${top_srcdir}/src/lib/util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-util.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-util.Tpo" -c -o load_kernel_test-util.o `test -f '${top_srcdir}/src/lib/util.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/util.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-util.Tpo" "$(DEPDIR)/load_kernel_test-util.Po"; else rm -f "$(DEPDIR)/load_kernel_test-util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/util.c' object='load_kernel_test-util.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-util.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-util.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-util.o `test -f '${top_srcdir}/src/lib/util.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/util.c
+
+load_kernel_test-util.obj: ${top_srcdir}/src/lib/util.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-util.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-util.Tpo" -c -o load_kernel_test-util.obj `if test -f '${top_srcdir}/src/lib/util.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/util.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/util.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-util.Tpo" "$(DEPDIR)/load_kernel_test-util.Po"; else rm -f "$(DEPDIR)/load_kernel_test-util.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/util.c' object='load_kernel_test-util.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-util.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-util.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-util.obj `if test -f '${top_srcdir}/src/lib/util.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/util.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/util.c'; fi`
+
+load_kernel_test-jffs2.o: ${top_srcdir}/src/blob/jffs2.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-jffs2.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-jffs2.Tpo" -c -o load_kernel_test-jffs2.o `test -f '${top_srcdir}/src/blob/jffs2.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/jffs2.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-jffs2.Tpo" "$(DEPDIR)/load_kernel_test-jffs2.Po"; else rm -f "$(DEPDIR)/load_kernel_test-jffs2.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/jffs2.c' object='load_kernel_test-jffs2.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-jffs2.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-jffs2.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-jffs2.o `test -f '${top_srcdir}/src/blob/jffs2.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/jffs2.c
+
+load_kernel_test-jffs2.obj: ${top_srcdir}/src/blob/jffs2.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-jffs2.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-jffs2.Tpo" -c -o load_kernel_test-jffs2.obj `if test -f '${top_srcdir}/src/blob/jffs2.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/jffs2.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/jffs2.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-jffs2.Tpo" "$(DEPDIR)/load_kernel_test-jffs2.Po"; else rm -f "$(DEPDIR)/load_kernel_test-jffs2.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/jffs2.c' object='load_kernel_test-jffs2.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-jffs2.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-jffs2.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-jffs2.obj `if test -f '${top_srcdir}/src/blob/jffs2.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/jffs2.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/jffs2.c'; fi`
+
+load_kernel_test-compr_rtime.o: ${top_srcdir}/src/blob/compr_rtime.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-compr_rtime.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-compr_rtime.Tpo" -c -o load_kernel_test-compr_rtime.o `test -f '${top_srcdir}/src/blob/compr_rtime.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/compr_rtime.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-compr_rtime.Tpo" "$(DEPDIR)/load_kernel_test-compr_rtime.Po"; else rm -f "$(DEPDIR)/load_kernel_test-compr_rtime.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/compr_rtime.c' object='load_kernel_test-compr_rtime.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-compr_rtime.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-compr_rtime.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-compr_rtime.o `test -f '${top_srcdir}/src/blob/compr_rtime.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/compr_rtime.c
+
+load_kernel_test-compr_rtime.obj: ${top_srcdir}/src/blob/compr_rtime.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-compr_rtime.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-compr_rtime.Tpo" -c -o load_kernel_test-compr_rtime.obj `if test -f '${top_srcdir}/src/blob/compr_rtime.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/compr_rtime.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/compr_rtime.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-compr_rtime.Tpo" "$(DEPDIR)/load_kernel_test-compr_rtime.Po"; else rm -f "$(DEPDIR)/load_kernel_test-compr_rtime.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/compr_rtime.c' object='load_kernel_test-compr_rtime.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-compr_rtime.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-compr_rtime.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-compr_rtime.obj `if test -f '${top_srcdir}/src/blob/compr_rtime.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/compr_rtime.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/compr_rtime.c'; fi`
+
+load_kernel_test-compr_rubin.o: ${top_srcdir}/src/blob/compr_rubin.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-compr_rubin.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-compr_rubin.Tpo" -c -o load_kernel_test-compr_rubin.o `test -f '${top_srcdir}/src/blob/compr_rubin.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/compr_rubin.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-compr_rubin.Tpo" "$(DEPDIR)/load_kernel_test-compr_rubin.Po"; else rm -f "$(DEPDIR)/load_kernel_test-compr_rubin.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/compr_rubin.c' object='load_kernel_test-compr_rubin.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-compr_rubin.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-compr_rubin.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-compr_rubin.o `test -f '${top_srcdir}/src/blob/compr_rubin.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/compr_rubin.c
+
+load_kernel_test-compr_rubin.obj: ${top_srcdir}/src/blob/compr_rubin.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-compr_rubin.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-compr_rubin.Tpo" -c -o load_kernel_test-compr_rubin.obj `if test -f '${top_srcdir}/src/blob/compr_rubin.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/compr_rubin.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/compr_rubin.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-compr_rubin.Tpo" "$(DEPDIR)/load_kernel_test-compr_rubin.Po"; else rm -f "$(DEPDIR)/load_kernel_test-compr_rubin.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/compr_rubin.c' object='load_kernel_test-compr_rubin.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-compr_rubin.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-compr_rubin.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-compr_rubin.obj `if test -f '${top_srcdir}/src/blob/compr_rubin.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/compr_rubin.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/compr_rubin.c'; fi`
+
+load_kernel_test-cramfs.o: ${top_srcdir}/src/blob/cramfs.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-cramfs.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-cramfs.Tpo" -c -o load_kernel_test-cramfs.o `test -f '${top_srcdir}/src/blob/cramfs.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/cramfs.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-cramfs.Tpo" "$(DEPDIR)/load_kernel_test-cramfs.Po"; else rm -f "$(DEPDIR)/load_kernel_test-cramfs.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/cramfs.c' object='load_kernel_test-cramfs.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-cramfs.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-cramfs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-cramfs.o `test -f '${top_srcdir}/src/blob/cramfs.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/cramfs.c
+
+load_kernel_test-cramfs.obj: ${top_srcdir}/src/blob/cramfs.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-cramfs.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-cramfs.Tpo" -c -o load_kernel_test-cramfs.obj `if test -f '${top_srcdir}/src/blob/cramfs.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/cramfs.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/cramfs.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-cramfs.Tpo" "$(DEPDIR)/load_kernel_test-cramfs.Po"; else rm -f "$(DEPDIR)/load_kernel_test-cramfs.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/cramfs.c' object='load_kernel_test-cramfs.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-cramfs.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-cramfs.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-cramfs.obj `if test -f '${top_srcdir}/src/blob/cramfs.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/cramfs.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/cramfs.c'; fi`
+
+load_kernel_test-zImage.o: ${top_srcdir}/src/blob/zImage.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-zImage.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-zImage.Tpo" -c -o load_kernel_test-zImage.o `test -f '${top_srcdir}/src/blob/zImage.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/zImage.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-zImage.Tpo" "$(DEPDIR)/load_kernel_test-zImage.Po"; else rm -f "$(DEPDIR)/load_kernel_test-zImage.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/zImage.c' object='load_kernel_test-zImage.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-zImage.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-zImage.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-zImage.o `test -f '${top_srcdir}/src/blob/zImage.c' || echo '$(srcdir)/'`${top_srcdir}/src/blob/zImage.c
+
+load_kernel_test-zImage.obj: ${top_srcdir}/src/blob/zImage.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-zImage.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-zImage.Tpo" -c -o load_kernel_test-zImage.obj `if test -f '${top_srcdir}/src/blob/zImage.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/zImage.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/zImage.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-zImage.Tpo" "$(DEPDIR)/load_kernel_test-zImage.Po"; else rm -f "$(DEPDIR)/load_kernel_test-zImage.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/blob/zImage.c' object='load_kernel_test-zImage.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-zImage.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-zImage.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-zImage.obj `if test -f '${top_srcdir}/src/blob/zImage.c'; then $(CYGPATH_W) '${top_srcdir}/src/blob/zImage.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/blob/zImage.c'; fi`
+
+load_kernel_test-crc32.o: ${top_srcdir}/src/lib/crc32.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-crc32.o -MD -MP -MF "$(DEPDIR)/load_kernel_test-crc32.Tpo" -c -o load_kernel_test-crc32.o `test -f '${top_srcdir}/src/lib/crc32.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/crc32.c; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-crc32.Tpo" "$(DEPDIR)/load_kernel_test-crc32.Po"; else rm -f "$(DEPDIR)/load_kernel_test-crc32.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/crc32.c' object='load_kernel_test-crc32.o' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-crc32.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-crc32.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-crc32.o `test -f '${top_srcdir}/src/lib/crc32.c' || echo '$(srcdir)/'`${top_srcdir}/src/lib/crc32.c
+
+load_kernel_test-crc32.obj: ${top_srcdir}/src/lib/crc32.c
+@am__fastdepCC_TRUE@	if $(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -MT load_kernel_test-crc32.obj -MD -MP -MF "$(DEPDIR)/load_kernel_test-crc32.Tpo" -c -o load_kernel_test-crc32.obj `if test -f '${top_srcdir}/src/lib/crc32.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/crc32.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/crc32.c'; fi`; \
+@am__fastdepCC_TRUE@	then mv -f "$(DEPDIR)/load_kernel_test-crc32.Tpo" "$(DEPDIR)/load_kernel_test-crc32.Po"; else rm -f "$(DEPDIR)/load_kernel_test-crc32.Tpo"; exit 1; fi
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	source='${top_srcdir}/src/lib/crc32.c' object='load_kernel_test-crc32.obj' libtool=no @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	depfile='$(DEPDIR)/load_kernel_test-crc32.Po' tmpdepfile='$(DEPDIR)/load_kernel_test-crc32.TPo' @AMDEPBACKSLASH@
+@AMDEP_TRUE@@am__fastdepCC_FALSE@	$(CCDEPMODE) $(depcomp) @AMDEPBACKSLASH@
+@am__fastdepCC_FALSE@	$(CC) $(DEFS) $(DEFAULT_INCLUDES) $(INCLUDES) $(AM_CPPFLAGS) $(CPPFLAGS) $(load_kernel_test_CFLAGS) $(CFLAGS) -c -o load_kernel_test-crc32.obj `if test -f '${top_srcdir}/src/lib/crc32.c'; then $(CYGPATH_W) '${top_srcdir}/src/lib/crc32.c'; else $(CYGPATH_W) '$(srcdir)/${top_srcdir}/src/lib/crc32.c'; fi`
+uninstall-info-am:
+
+ID: $(HEADERS) $(SOURCES) $(LISP) $(TAGS_FILES)
+	list='$(SOURCES) $(HEADERS) $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	mkid -fID $$unique
+tags: TAGS
+
+TAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(ETAGS_ARGS)$$tags$$unique" \
+	  || $(ETAGS) $(ETAGSFLAGS) $(AM_ETAGSFLAGS) $(ETAGS_ARGS) \
+	     $$tags $$unique
+ctags: CTAGS
+CTAGS:  $(HEADERS) $(SOURCES)  $(TAGS_DEPENDENCIES) \
+		$(TAGS_FILES) $(LISP)
+	tags=; \
+	here=`pwd`; \
+	list='$(SOURCES) $(HEADERS)  $(LISP) $(TAGS_FILES)'; \
+	unique=`for i in $$list; do \
+	    if test -f "$$i"; then echo $$i; else echo $(srcdir)/$$i; fi; \
+	  done | \
+	  $(AWK) '    { files[$$0] = 1; } \
+	       END { for (i in files) print i; }'`; \
+	test -z "$(CTAGS_ARGS)$$tags$$unique" \
+	  || $(CTAGS) $(CTAGSFLAGS) $(AM_CTAGSFLAGS) $(CTAGS_ARGS) \
+	     $$tags $$unique
+
+GTAGS:
+	here=`$(am__cd) $(top_builddir) && pwd` \
+	  && cd $(top_srcdir) \
+	  && gtags -i $(GTAGS_ARGS) $$here
+
+distclean-tags:
+	-rm -f TAGS ID GTAGS GRTAGS GSYMS GPATH tags
+
+distdir: $(DISTFILES)
+	@srcdirstrip=`echo "$(srcdir)" | sed 's|.|.|g'`; \
+	topsrcdirstrip=`echo "$(top_srcdir)" | sed 's|.|.|g'`; \
+	list='$(DISTFILES)'; for file in $$list; do \
+	  case $$file in \
+	    $(srcdir)/*) file=`echo "$$file" | sed "s|^$$srcdirstrip/||"`;; \
+	    $(top_srcdir)/*) file=`echo "$$file" | sed "s|^$$topsrcdirstrip/|$(top_builddir)/|"`;; \
+	  esac; \
+	  if test -f $$file || test -d $$file; then d=.; else d=$(srcdir); fi; \
+	  dir=`echo "$$file" | sed -e 's,/[^/]*$$,,'`; \
+	  if test "$$dir" != "$$file" && test "$$dir" != "."; then \
+	    dir="/$$dir"; \
+	    $(mkdir_p) "$(distdir)$$dir"; \
+	  else \
+	    dir=''; \
+	  fi; \
+	  if test -d $$d/$$file; then \
+	    if test -d $(srcdir)/$$file && test $$d != $(srcdir); then \
+	      cp -pR $(srcdir)/$$file $(distdir)$$dir || exit 1; \
+	    fi; \
+	    cp -pR $$d/$$file $(distdir)$$dir || exit 1; \
+	  else \
+	    test -f $(distdir)/$$file \
+	    || cp -p $$d/$$file $(distdir)/$$file \
+	    || exit 1; \
+	  fi; \
+	done
+check-am: all-am
+check: check-am
+all-am: Makefile $(PROGRAMS)
+installdirs:
+	for dir in "$(DESTDIR)$(bindir)"; do \
+	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
+	done
+install: install-am
+install-exec: install-exec-am
+install-data: install-data-am
+uninstall: uninstall-am
+
+install-am: all-am
+	@$(MAKE) $(AM_MAKEFLAGS) install-exec-am install-data-am
+
+installcheck: installcheck-am
+install-strip:
+	$(MAKE) $(AM_MAKEFLAGS) INSTALL_PROGRAM="$(INSTALL_STRIP_PROGRAM)" \
+	  install_sh_PROGRAM="$(INSTALL_STRIP_PROGRAM)" INSTALL_STRIP_FLAG=-s \
+	  `test -z '$(STRIP)' || \
+	    echo "INSTALL_PROGRAM_ENV=STRIPPROG='$(STRIP)'"` install
+mostlyclean-generic:
+
+clean-generic:
+	-test -z "$(CLEANFILES)" || rm -f $(CLEANFILES)
+
+distclean-generic:
+	-rm -f $(CONFIG_CLEAN_FILES)
+
+maintainer-clean-generic:
+	@echo "This command is intended for maintainers to use"
+	@echo "it deletes files that may require special tools to rebuild."
+clean: clean-am
+
+clean-am: clean-binPROGRAMS clean-generic mostlyclean-am
+
+distclean: distclean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+distclean-am: clean-am distclean-compile distclean-generic \
+	distclean-tags
+
+dvi: dvi-am
+
+dvi-am:
+
+html: html-am
+
+info: info-am
+
+info-am:
+
+install-data-am:
+
+install-exec-am: install-binPROGRAMS
+
+install-info: install-info-am
+
+install-man:
+
+installcheck-am:
+
+maintainer-clean: maintainer-clean-am
+	-rm -rf ./$(DEPDIR)
+	-rm -f Makefile
+maintainer-clean-am: distclean-am maintainer-clean-generic
+
+mostlyclean: mostlyclean-am
+
+mostlyclean-am: mostlyclean-compile mostlyclean-generic
+
+pdf: pdf-am
+
+pdf-am:
+
+ps: ps-am
+
+ps-am:
+
+uninstall-am: uninstall-binPROGRAMS uninstall-info-am
+
+.PHONY: CTAGS GTAGS all all-am check check-am clean clean-binPROGRAMS \
+	clean-generic ctags distclean distclean-compile \
+	distclean-generic distclean-tags distdir dvi dvi-am html \
+	html-am info info-am install install-am install-binPROGRAMS \
+	install-data install-data-am install-exec install-exec-am \
+	install-info install-info-am install-man install-strip \
+	installcheck installcheck-am installdirs maintainer-clean \
+	maintainer-clean-generic mostlyclean mostlyclean-compile \
+	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
+	uninstall-am uninstall-binPROGRAMS uninstall-info-am
+
+# Tell versions [3.59,3.63) of GNU make to not export all variables.
+# Otherwise a system limit (for SysV at least) may be exceeded.
+.NOEXPORT:
Index: build_tree/bootLoader/utils/test/load_kernel_test.c
diff -u /dev/null build_tree/bootLoader/utils/test/load_kernel_test.c:1.1.1.1
--- /dev/null	Tue Jan  8 14:21:47 2008
+++ build_tree/bootLoader/utils/test/load_kernel_test.c	Fri Nov  9 09:44:05 2007
@@ -0,0 +1,82 @@
+#ifdef HAVE_CONFIG_H
+# include <blob/config.h>
+#endif
+#include <stdio.h>
+#include <stdlib.h>
+#include <sys/stat.h>
+#include <unistd.h>
+#include <libgen.h>
+#include <string.h>
+#include <blob/load_kernel.h>
+
+
+int main(int argc, char *argv[])
+{
+	char *out;
+	FILE *fp;
+	struct stat st;
+	const struct kernel_loader *loader;
+	struct part_info part;
+	int i;
+	unsigned long size = 0;
+
+	part.erasesize = 0x20000;
+	fodder_ram_base = malloc(0x10000);
+	out = malloc(0xe00000);
+
+	if (argc < 3) {
+		printf("not enough arguments usage:\n");
+		printf("%s: <fs_image> <kernel_filename> <outfile>\n", basename(argv[0]));
+		return 0;
+	}
+
+	if (stat(argv[1], &st)) {
+		perror("could not stat fs_image");
+		return 0;
+	}
+
+	if (!(fp = fopen(argv[1], "r"))) {
+		perror("could not open fs_image");
+		return 0;
+	}
+
+	part.size = st.st_size + part.erasesize - ((st.st_size - 1) % part.erasesize) - 1;
+	part.offset = malloc(part.size);
+	fread(part.offset, 1, st.st_size, fp);
+	memset(part.offset + st.st_size, 0xff, part.size - st.st_size);
+	fclose(fp);
+
+	printf("flash emulation region is 0x%x bytes\n", part.size);
+
+	for (i = 0; ;i++) {
+		loader = known_loaders[i];
+
+		if (!loader) 
+			break;
+
+		if (loader->check_magic(&part))
+			break;
+	}
+
+	if (!loader) {
+		printf("unable to find magic\n");
+	} else {
+		printf("loading kernel from ");
+		printf(loader->name);
+		if ((size = loader->load_kernel((u32 *) out, &part, argv[2])) == 0) {
+			printf(" error loading kernel \"%s\"!\n", argv[2]);
+			return 0;
+		}
+	}
+	printf("loaded 0x%08lx bytes\n", size);
+
+	if (!(fp = fopen(argv[3], "w"))) {
+		perror("could not open outfile");
+		return 0;
+	}
+
+	fwrite(out, 1, size, fp);
+	fclose(fp);
+
+	return 0;
+}
